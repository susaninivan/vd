(self["webpackChunkvt"]=self["webpackChunkvt"]||[]).push([[504],{6928:function(t,e,n){"use strict";n.r(e),n.d(e,{userAgent:function(){return s}});const s=""},4845:function(t,e,n){"use strict";n.r(e),n.d(e,{now:function(){return r},timing:function(){return o}});const s=1e9,i=n.g.process.hrtime(),r=()=>{const t=n.g.process.hrtime(i);return t[0]+t[1]/s},o={navigationStart:Date.now()}},1835:function(t,e,n){"use strict";n(4114);var s=n(3081),i=s.Reader,r=s.Writer,o=s.util,a=s.roots["default"]||(s.roots["default"]={});a.tensorflow=function(){var t={};return t.magenta=function(){var t={};return t.NoteSequence=function(){function t(t){if(this.timeSignatures=[],this.keySignatures=[],this.tempos=[],this.notes=[],this.pitchBends=[],this.controlChanges=[],this.partInfos=[],this.textAnnotations=[],this.sectionAnnotations=[],this.sectionGroups=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.id="",t.prototype.filename="",t.prototype.referenceNumber=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.collectionName="",t.prototype.ticksPerQuarter=0,t.prototype.timeSignatures=o.emptyArray,t.prototype.keySignatures=o.emptyArray,t.prototype.tempos=o.emptyArray,t.prototype.notes=o.emptyArray,t.prototype.totalTime=0,t.prototype.totalQuantizedSteps=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.pitchBends=o.emptyArray,t.prototype.controlChanges=o.emptyArray,t.prototype.partInfos=o.emptyArray,t.prototype.sourceInfo=null,t.prototype.textAnnotations=o.emptyArray,t.prototype.sectionAnnotations=o.emptyArray,t.prototype.sectionGroups=o.emptyArray,t.prototype.quantizationInfo=null,t.prototype.subsequenceInfo=null,t.prototype.sequenceMetadata=null,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.id&&t.hasOwnProperty("id")&&e.uint32(10).string(t.id),null!=t.filename&&t.hasOwnProperty("filename")&&e.uint32(18).string(t.filename),null!=t.collectionName&&t.hasOwnProperty("collectionName")&&e.uint32(26).string(t.collectionName),null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&e.uint32(32).int32(t.ticksPerQuarter),null!=t.timeSignatures&&t.timeSignatures.length)for(var n=0;n<t.timeSignatures.length;++n)a.tensorflow.magenta.NoteSequence.TimeSignature.encode(t.timeSignatures[n],e.uint32(42).fork()).ldelim();if(null!=t.keySignatures&&t.keySignatures.length)for(n=0;n<t.keySignatures.length;++n)a.tensorflow.magenta.NoteSequence.KeySignature.encode(t.keySignatures[n],e.uint32(50).fork()).ldelim();if(null!=t.tempos&&t.tempos.length)for(n=0;n<t.tempos.length;++n)a.tensorflow.magenta.NoteSequence.Tempo.encode(t.tempos[n],e.uint32(58).fork()).ldelim();if(null!=t.notes&&t.notes.length)for(n=0;n<t.notes.length;++n)a.tensorflow.magenta.NoteSequence.Note.encode(t.notes[n],e.uint32(66).fork()).ldelim();if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&e.uint32(73).double(t.totalTime),null!=t.pitchBends&&t.pitchBends.length)for(n=0;n<t.pitchBends.length;++n)a.tensorflow.magenta.NoteSequence.PitchBend.encode(t.pitchBends[n],e.uint32(82).fork()).ldelim();if(null!=t.controlChanges&&t.controlChanges.length)for(n=0;n<t.controlChanges.length;++n)a.tensorflow.magenta.NoteSequence.ControlChange.encode(t.controlChanges[n],e.uint32(90).fork()).ldelim();if(null!=t.partInfos&&t.partInfos.length)for(n=0;n<t.partInfos.length;++n)a.tensorflow.magenta.NoteSequence.PartInfo.encode(t.partInfos[n],e.uint32(98).fork()).ldelim();if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")&&a.tensorflow.magenta.NoteSequence.SourceInfo.encode(t.sourceInfo,e.uint32(106).fork()).ldelim(),null!=t.textAnnotations&&t.textAnnotations.length)for(n=0;n<t.textAnnotations.length;++n)a.tensorflow.magenta.NoteSequence.TextAnnotation.encode(t.textAnnotations[n],e.uint32(114).fork()).ldelim();if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")&&a.tensorflow.magenta.NoteSequence.QuantizationInfo.encode(t.quantizationInfo,e.uint32(122).fork()).ldelim(),null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&e.uint32(128).int64(t.totalQuantizedSteps),null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")&&a.tensorflow.magenta.NoteSequence.SubsequenceInfo.encode(t.subsequenceInfo,e.uint32(138).fork()).ldelim(),null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&e.uint32(144).int64(t.referenceNumber),null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")&&a.tensorflow.magenta.SequenceMetadata.encode(t.sequenceMetadata,e.uint32(154).fork()).ldelim(),null!=t.sectionAnnotations&&t.sectionAnnotations.length)for(n=0;n<t.sectionAnnotations.length;++n)a.tensorflow.magenta.NoteSequence.SectionAnnotation.encode(t.sectionAnnotations[n],e.uint32(162).fork()).ldelim();if(null!=t.sectionGroups&&t.sectionGroups.length)for(n=0;n<t.sectionGroups.length;++n)a.tensorflow.magenta.NoteSequence.SectionGroup.encode(t.sectionGroups[n],e.uint32(170).fork()).ldelim();return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.id=t.string();break;case 2:s.filename=t.string();break;case 18:s.referenceNumber=o.Long?t.int64().toNumber():t.int64();break;case 3:s.collectionName=t.string();break;case 4:s.ticksPerQuarter=t.int32();break;case 5:s.timeSignatures&&s.timeSignatures.length||(s.timeSignatures=[]),s.timeSignatures.push(a.tensorflow.magenta.NoteSequence.TimeSignature.decode(t,t.uint32()));break;case 6:s.keySignatures&&s.keySignatures.length||(s.keySignatures=[]),s.keySignatures.push(a.tensorflow.magenta.NoteSequence.KeySignature.decode(t,t.uint32()));break;case 7:s.tempos&&s.tempos.length||(s.tempos=[]),s.tempos.push(a.tensorflow.magenta.NoteSequence.Tempo.decode(t,t.uint32()));break;case 8:s.notes&&s.notes.length||(s.notes=[]),s.notes.push(a.tensorflow.magenta.NoteSequence.Note.decode(t,t.uint32()));break;case 9:s.totalTime=t.double();break;case 16:s.totalQuantizedSteps=o.Long?t.int64().toNumber():t.int64();break;case 10:s.pitchBends&&s.pitchBends.length||(s.pitchBends=[]),s.pitchBends.push(a.tensorflow.magenta.NoteSequence.PitchBend.decode(t,t.uint32()));break;case 11:s.controlChanges&&s.controlChanges.length||(s.controlChanges=[]),s.controlChanges.push(a.tensorflow.magenta.NoteSequence.ControlChange.decode(t,t.uint32()));break;case 12:s.partInfos&&s.partInfos.length||(s.partInfos=[]),s.partInfos.push(a.tensorflow.magenta.NoteSequence.PartInfo.decode(t,t.uint32()));break;case 13:s.sourceInfo=a.tensorflow.magenta.NoteSequence.SourceInfo.decode(t,t.uint32());break;case 14:s.textAnnotations&&s.textAnnotations.length||(s.textAnnotations=[]),s.textAnnotations.push(a.tensorflow.magenta.NoteSequence.TextAnnotation.decode(t,t.uint32()));break;case 20:s.sectionAnnotations&&s.sectionAnnotations.length||(s.sectionAnnotations=[]),s.sectionAnnotations.push(a.tensorflow.magenta.NoteSequence.SectionAnnotation.decode(t,t.uint32()));break;case 21:s.sectionGroups&&s.sectionGroups.length||(s.sectionGroups=[]),s.sectionGroups.push(a.tensorflow.magenta.NoteSequence.SectionGroup.decode(t,t.uint32()));break;case 15:s.quantizationInfo=a.tensorflow.magenta.NoteSequence.QuantizationInfo.decode(t,t.uint32());break;case 17:s.subsequenceInfo=a.tensorflow.magenta.NoteSequence.SubsequenceInfo.decode(t,t.uint32());break;case 19:s.sequenceMetadata=a.tensorflow.magenta.SequenceMetadata.decode(t,t.uint32());break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.id&&t.hasOwnProperty("id")&&!o.isString(t.id))return"id: string expected";if(null!=t.filename&&t.hasOwnProperty("filename")&&!o.isString(t.filename))return"filename: string expected";if(null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&!o.isInteger(t.referenceNumber)&&!(t.referenceNumber&&o.isInteger(t.referenceNumber.low)&&o.isInteger(t.referenceNumber.high)))return"referenceNumber: integer|Long expected";if(null!=t.collectionName&&t.hasOwnProperty("collectionName")&&!o.isString(t.collectionName))return"collectionName: string expected";if(null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&!o.isInteger(t.ticksPerQuarter))return"ticksPerQuarter: integer expected";if(null!=t.timeSignatures&&t.hasOwnProperty("timeSignatures")){if(!Array.isArray(t.timeSignatures))return"timeSignatures: array expected";for(var e=0;e<t.timeSignatures.length;++e){var n=a.tensorflow.magenta.NoteSequence.TimeSignature.verify(t.timeSignatures[e]);if(n)return"timeSignatures."+n}}if(null!=t.keySignatures&&t.hasOwnProperty("keySignatures")){if(!Array.isArray(t.keySignatures))return"keySignatures: array expected";for(e=0;e<t.keySignatures.length;++e){n=a.tensorflow.magenta.NoteSequence.KeySignature.verify(t.keySignatures[e]);if(n)return"keySignatures."+n}}if(null!=t.tempos&&t.hasOwnProperty("tempos")){if(!Array.isArray(t.tempos))return"tempos: array expected";for(e=0;e<t.tempos.length;++e){n=a.tensorflow.magenta.NoteSequence.Tempo.verify(t.tempos[e]);if(n)return"tempos."+n}}if(null!=t.notes&&t.hasOwnProperty("notes")){if(!Array.isArray(t.notes))return"notes: array expected";for(e=0;e<t.notes.length;++e){n=a.tensorflow.magenta.NoteSequence.Note.verify(t.notes[e]);if(n)return"notes."+n}}if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&"number"!==typeof t.totalTime)return"totalTime: number expected";if(null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&!o.isInteger(t.totalQuantizedSteps)&&!(t.totalQuantizedSteps&&o.isInteger(t.totalQuantizedSteps.low)&&o.isInteger(t.totalQuantizedSteps.high)))return"totalQuantizedSteps: integer|Long expected";if(null!=t.pitchBends&&t.hasOwnProperty("pitchBends")){if(!Array.isArray(t.pitchBends))return"pitchBends: array expected";for(e=0;e<t.pitchBends.length;++e){n=a.tensorflow.magenta.NoteSequence.PitchBend.verify(t.pitchBends[e]);if(n)return"pitchBends."+n}}if(null!=t.controlChanges&&t.hasOwnProperty("controlChanges")){if(!Array.isArray(t.controlChanges))return"controlChanges: array expected";for(e=0;e<t.controlChanges.length;++e){n=a.tensorflow.magenta.NoteSequence.ControlChange.verify(t.controlChanges[e]);if(n)return"controlChanges."+n}}if(null!=t.partInfos&&t.hasOwnProperty("partInfos")){if(!Array.isArray(t.partInfos))return"partInfos: array expected";for(e=0;e<t.partInfos.length;++e){n=a.tensorflow.magenta.NoteSequence.PartInfo.verify(t.partInfos[e]);if(n)return"partInfos."+n}}if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")){n=a.tensorflow.magenta.NoteSequence.SourceInfo.verify(t.sourceInfo);if(n)return"sourceInfo."+n}if(null!=t.textAnnotations&&t.hasOwnProperty("textAnnotations")){if(!Array.isArray(t.textAnnotations))return"textAnnotations: array expected";for(e=0;e<t.textAnnotations.length;++e){n=a.tensorflow.magenta.NoteSequence.TextAnnotation.verify(t.textAnnotations[e]);if(n)return"textAnnotations."+n}}if(null!=t.sectionAnnotations&&t.hasOwnProperty("sectionAnnotations")){if(!Array.isArray(t.sectionAnnotations))return"sectionAnnotations: array expected";for(e=0;e<t.sectionAnnotations.length;++e){n=a.tensorflow.magenta.NoteSequence.SectionAnnotation.verify(t.sectionAnnotations[e]);if(n)return"sectionAnnotations."+n}}if(null!=t.sectionGroups&&t.hasOwnProperty("sectionGroups")){if(!Array.isArray(t.sectionGroups))return"sectionGroups: array expected";for(e=0;e<t.sectionGroups.length;++e){n=a.tensorflow.magenta.NoteSequence.SectionGroup.verify(t.sectionGroups[e]);if(n)return"sectionGroups."+n}}if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")){n=a.tensorflow.magenta.NoteSequence.QuantizationInfo.verify(t.quantizationInfo);if(n)return"quantizationInfo."+n}if(null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")){n=a.tensorflow.magenta.NoteSequence.SubsequenceInfo.verify(t.subsequenceInfo);if(n)return"subsequenceInfo."+n}if(null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")){n=a.tensorflow.magenta.SequenceMetadata.verify(t.sequenceMetadata);if(n)return"sequenceMetadata."+n}return null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence)return t;var e=new a.tensorflow.magenta.NoteSequence;if(null!=t.id&&(e.id=String(t.id)),null!=t.filename&&(e.filename=String(t.filename)),null!=t.referenceNumber&&(o.Long?(e.referenceNumber=o.Long.fromValue(t.referenceNumber)).unsigned=!1:"string"===typeof t.referenceNumber?e.referenceNumber=parseInt(t.referenceNumber,10):"number"===typeof t.referenceNumber?e.referenceNumber=t.referenceNumber:"object"===typeof t.referenceNumber&&(e.referenceNumber=new o.LongBits(t.referenceNumber.low>>>0,t.referenceNumber.high>>>0).toNumber())),null!=t.collectionName&&(e.collectionName=String(t.collectionName)),null!=t.ticksPerQuarter&&(e.ticksPerQuarter=0|t.ticksPerQuarter),t.timeSignatures){if(!Array.isArray(t.timeSignatures))throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: array expected");e.timeSignatures=[];for(var n=0;n<t.timeSignatures.length;++n){if("object"!==typeof t.timeSignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.timeSignatures: object expected");e.timeSignatures[n]=a.tensorflow.magenta.NoteSequence.TimeSignature.fromObject(t.timeSignatures[n])}}if(t.keySignatures){if(!Array.isArray(t.keySignatures))throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: array expected");e.keySignatures=[];for(n=0;n<t.keySignatures.length;++n){if("object"!==typeof t.keySignatures[n])throw TypeError(".tensorflow.magenta.NoteSequence.keySignatures: object expected");e.keySignatures[n]=a.tensorflow.magenta.NoteSequence.KeySignature.fromObject(t.keySignatures[n])}}if(t.tempos){if(!Array.isArray(t.tempos))throw TypeError(".tensorflow.magenta.NoteSequence.tempos: array expected");e.tempos=[];for(n=0;n<t.tempos.length;++n){if("object"!==typeof t.tempos[n])throw TypeError(".tensorflow.magenta.NoteSequence.tempos: object expected");e.tempos[n]=a.tensorflow.magenta.NoteSequence.Tempo.fromObject(t.tempos[n])}}if(t.notes){if(!Array.isArray(t.notes))throw TypeError(".tensorflow.magenta.NoteSequence.notes: array expected");e.notes=[];for(n=0;n<t.notes.length;++n){if("object"!==typeof t.notes[n])throw TypeError(".tensorflow.magenta.NoteSequence.notes: object expected");e.notes[n]=a.tensorflow.magenta.NoteSequence.Note.fromObject(t.notes[n])}}if(null!=t.totalTime&&(e.totalTime=Number(t.totalTime)),null!=t.totalQuantizedSteps&&(o.Long?(e.totalQuantizedSteps=o.Long.fromValue(t.totalQuantizedSteps)).unsigned=!1:"string"===typeof t.totalQuantizedSteps?e.totalQuantizedSteps=parseInt(t.totalQuantizedSteps,10):"number"===typeof t.totalQuantizedSteps?e.totalQuantizedSteps=t.totalQuantizedSteps:"object"===typeof t.totalQuantizedSteps&&(e.totalQuantizedSteps=new o.LongBits(t.totalQuantizedSteps.low>>>0,t.totalQuantizedSteps.high>>>0).toNumber())),t.pitchBends){if(!Array.isArray(t.pitchBends))throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: array expected");e.pitchBends=[];for(n=0;n<t.pitchBends.length;++n){if("object"!==typeof t.pitchBends[n])throw TypeError(".tensorflow.magenta.NoteSequence.pitchBends: object expected");e.pitchBends[n]=a.tensorflow.magenta.NoteSequence.PitchBend.fromObject(t.pitchBends[n])}}if(t.controlChanges){if(!Array.isArray(t.controlChanges))throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: array expected");e.controlChanges=[];for(n=0;n<t.controlChanges.length;++n){if("object"!==typeof t.controlChanges[n])throw TypeError(".tensorflow.magenta.NoteSequence.controlChanges: object expected");e.controlChanges[n]=a.tensorflow.magenta.NoteSequence.ControlChange.fromObject(t.controlChanges[n])}}if(t.partInfos){if(!Array.isArray(t.partInfos))throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: array expected");e.partInfos=[];for(n=0;n<t.partInfos.length;++n){if("object"!==typeof t.partInfos[n])throw TypeError(".tensorflow.magenta.NoteSequence.partInfos: object expected");e.partInfos[n]=a.tensorflow.magenta.NoteSequence.PartInfo.fromObject(t.partInfos[n])}}if(null!=t.sourceInfo){if("object"!==typeof t.sourceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.sourceInfo: object expected");e.sourceInfo=a.tensorflow.magenta.NoteSequence.SourceInfo.fromObject(t.sourceInfo)}if(t.textAnnotations){if(!Array.isArray(t.textAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: array expected");e.textAnnotations=[];for(n=0;n<t.textAnnotations.length;++n){if("object"!==typeof t.textAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.textAnnotations: object expected");e.textAnnotations[n]=a.tensorflow.magenta.NoteSequence.TextAnnotation.fromObject(t.textAnnotations[n])}}if(t.sectionAnnotations){if(!Array.isArray(t.sectionAnnotations))throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: array expected");e.sectionAnnotations=[];for(n=0;n<t.sectionAnnotations.length;++n){if("object"!==typeof t.sectionAnnotations[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionAnnotations: object expected");e.sectionAnnotations[n]=a.tensorflow.magenta.NoteSequence.SectionAnnotation.fromObject(t.sectionAnnotations[n])}}if(t.sectionGroups){if(!Array.isArray(t.sectionGroups))throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: array expected");e.sectionGroups=[];for(n=0;n<t.sectionGroups.length;++n){if("object"!==typeof t.sectionGroups[n])throw TypeError(".tensorflow.magenta.NoteSequence.sectionGroups: object expected");e.sectionGroups[n]=a.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(t.sectionGroups[n])}}if(null!=t.quantizationInfo){if("object"!==typeof t.quantizationInfo)throw TypeError(".tensorflow.magenta.NoteSequence.quantizationInfo: object expected");e.quantizationInfo=a.tensorflow.magenta.NoteSequence.QuantizationInfo.fromObject(t.quantizationInfo)}if(null!=t.subsequenceInfo){if("object"!==typeof t.subsequenceInfo)throw TypeError(".tensorflow.magenta.NoteSequence.subsequenceInfo: object expected");e.subsequenceInfo=a.tensorflow.magenta.NoteSequence.SubsequenceInfo.fromObject(t.subsequenceInfo)}if(null!=t.sequenceMetadata){if("object"!==typeof t.sequenceMetadata)throw TypeError(".tensorflow.magenta.NoteSequence.sequenceMetadata: object expected");e.sequenceMetadata=a.tensorflow.magenta.SequenceMetadata.fromObject(t.sequenceMetadata)}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.timeSignatures=[],n.keySignatures=[],n.tempos=[],n.notes=[],n.pitchBends=[],n.controlChanges=[],n.partInfos=[],n.textAnnotations=[],n.sectionAnnotations=[],n.sectionGroups=[]),e.defaults){if(n.id="",n.filename="",n.collectionName="",n.ticksPerQuarter=0,n.totalTime=0,n.sourceInfo=null,n.quantizationInfo=null,o.Long){var s=new o.Long(0,0,!1);n.totalQuantizedSteps=e.longs===String?s.toString():e.longs===Number?s.toNumber():s}else n.totalQuantizedSteps=e.longs===String?"0":0;if(n.subsequenceInfo=null,o.Long){s=new o.Long(0,0,!1);n.referenceNumber=e.longs===String?s.toString():e.longs===Number?s.toNumber():s}else n.referenceNumber=e.longs===String?"0":0;n.sequenceMetadata=null}if(null!=t.id&&t.hasOwnProperty("id")&&(n.id=t.id),null!=t.filename&&t.hasOwnProperty("filename")&&(n.filename=t.filename),null!=t.collectionName&&t.hasOwnProperty("collectionName")&&(n.collectionName=t.collectionName),null!=t.ticksPerQuarter&&t.hasOwnProperty("ticksPerQuarter")&&(n.ticksPerQuarter=t.ticksPerQuarter),t.timeSignatures&&t.timeSignatures.length){n.timeSignatures=[];for(var i=0;i<t.timeSignatures.length;++i)n.timeSignatures[i]=a.tensorflow.magenta.NoteSequence.TimeSignature.toObject(t.timeSignatures[i],e)}if(t.keySignatures&&t.keySignatures.length){n.keySignatures=[];for(i=0;i<t.keySignatures.length;++i)n.keySignatures[i]=a.tensorflow.magenta.NoteSequence.KeySignature.toObject(t.keySignatures[i],e)}if(t.tempos&&t.tempos.length){n.tempos=[];for(i=0;i<t.tempos.length;++i)n.tempos[i]=a.tensorflow.magenta.NoteSequence.Tempo.toObject(t.tempos[i],e)}if(t.notes&&t.notes.length){n.notes=[];for(i=0;i<t.notes.length;++i)n.notes[i]=a.tensorflow.magenta.NoteSequence.Note.toObject(t.notes[i],e)}if(null!=t.totalTime&&t.hasOwnProperty("totalTime")&&(n.totalTime=e.json&&!isFinite(t.totalTime)?String(t.totalTime):t.totalTime),t.pitchBends&&t.pitchBends.length){n.pitchBends=[];for(i=0;i<t.pitchBends.length;++i)n.pitchBends[i]=a.tensorflow.magenta.NoteSequence.PitchBend.toObject(t.pitchBends[i],e)}if(t.controlChanges&&t.controlChanges.length){n.controlChanges=[];for(i=0;i<t.controlChanges.length;++i)n.controlChanges[i]=a.tensorflow.magenta.NoteSequence.ControlChange.toObject(t.controlChanges[i],e)}if(t.partInfos&&t.partInfos.length){n.partInfos=[];for(i=0;i<t.partInfos.length;++i)n.partInfos[i]=a.tensorflow.magenta.NoteSequence.PartInfo.toObject(t.partInfos[i],e)}if(null!=t.sourceInfo&&t.hasOwnProperty("sourceInfo")&&(n.sourceInfo=a.tensorflow.magenta.NoteSequence.SourceInfo.toObject(t.sourceInfo,e)),t.textAnnotations&&t.textAnnotations.length){n.textAnnotations=[];for(i=0;i<t.textAnnotations.length;++i)n.textAnnotations[i]=a.tensorflow.magenta.NoteSequence.TextAnnotation.toObject(t.textAnnotations[i],e)}if(null!=t.quantizationInfo&&t.hasOwnProperty("quantizationInfo")&&(n.quantizationInfo=a.tensorflow.magenta.NoteSequence.QuantizationInfo.toObject(t.quantizationInfo,e)),null!=t.totalQuantizedSteps&&t.hasOwnProperty("totalQuantizedSteps")&&("number"===typeof t.totalQuantizedSteps?n.totalQuantizedSteps=e.longs===String?String(t.totalQuantizedSteps):t.totalQuantizedSteps:n.totalQuantizedSteps=e.longs===String?o.Long.prototype.toString.call(t.totalQuantizedSteps):e.longs===Number?new o.LongBits(t.totalQuantizedSteps.low>>>0,t.totalQuantizedSteps.high>>>0).toNumber():t.totalQuantizedSteps),null!=t.subsequenceInfo&&t.hasOwnProperty("subsequenceInfo")&&(n.subsequenceInfo=a.tensorflow.magenta.NoteSequence.SubsequenceInfo.toObject(t.subsequenceInfo,e)),null!=t.referenceNumber&&t.hasOwnProperty("referenceNumber")&&("number"===typeof t.referenceNumber?n.referenceNumber=e.longs===String?String(t.referenceNumber):t.referenceNumber:n.referenceNumber=e.longs===String?o.Long.prototype.toString.call(t.referenceNumber):e.longs===Number?new o.LongBits(t.referenceNumber.low>>>0,t.referenceNumber.high>>>0).toNumber():t.referenceNumber),null!=t.sequenceMetadata&&t.hasOwnProperty("sequenceMetadata")&&(n.sequenceMetadata=a.tensorflow.magenta.SequenceMetadata.toObject(t.sequenceMetadata,e)),t.sectionAnnotations&&t.sectionAnnotations.length){n.sectionAnnotations=[];for(i=0;i<t.sectionAnnotations.length;++i)n.sectionAnnotations[i]=a.tensorflow.magenta.NoteSequence.SectionAnnotation.toObject(t.sectionAnnotations[i],e)}if(t.sectionGroups&&t.sectionGroups.length){n.sectionGroups=[];for(i=0;i<t.sectionGroups.length;++i)n.sectionGroups[i]=a.tensorflow.magenta.NoteSequence.SectionGroup.toObject(t.sectionGroups[i],e)}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.Note=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.pitch=0,t.prototype.pitchName=0,t.prototype.velocity=0,t.prototype.startTime=0,t.prototype.quantizedStartStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.endTime=0,t.prototype.quantizedEndStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.numerator=0,t.prototype.denominator=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.prototype.part=0,t.prototype.voice=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.pitch&&t.hasOwnProperty("pitch")&&e.uint32(8).int32(t.pitch),null!=t.velocity&&t.hasOwnProperty("velocity")&&e.uint32(16).int32(t.velocity),null!=t.startTime&&t.hasOwnProperty("startTime")&&e.uint32(25).double(t.startTime),null!=t.endTime&&t.hasOwnProperty("endTime")&&e.uint32(33).double(t.endTime),null!=t.numerator&&t.hasOwnProperty("numerator")&&e.uint32(40).int32(t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&e.uint32(48).int32(t.denominator),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(56).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(64).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(72).bool(t.isDrum),null!=t.part&&t.hasOwnProperty("part")&&e.uint32(80).int32(t.part),null!=t.pitchName&&t.hasOwnProperty("pitchName")&&e.uint32(88).int32(t.pitchName),null!=t.voice&&t.hasOwnProperty("voice")&&e.uint32(96).int32(t.voice),null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&e.uint32(104).int64(t.quantizedStartStep),null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&e.uint32(112).int64(t.quantizedEndStep),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.Note;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.pitch=t.int32();break;case 11:s.pitchName=t.int32();break;case 2:s.velocity=t.int32();break;case 3:s.startTime=t.double();break;case 13:s.quantizedStartStep=o.Long?t.int64().toNumber():t.int64();break;case 4:s.endTime=t.double();break;case 14:s.quantizedEndStep=o.Long?t.int64().toNumber():t.int64();break;case 5:s.numerator=t.int32();break;case 6:s.denominator=t.int32();break;case 7:s.instrument=t.int32();break;case 8:s.program=t.int32();break;case 9:s.isDrum=t.bool();break;case 10:s.part=t.int32();break;case 12:s.voice=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.pitch&&t.hasOwnProperty("pitch")&&!o.isInteger(t.pitch))return"pitch: integer expected";if(null!=t.pitchName&&t.hasOwnProperty("pitchName"))switch(t.pitchName){default:return"pitchName: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:case 10:case 11:case 12:case 13:case 14:case 15:case 16:case 17:case 18:case 19:case 20:case 21:case 22:case 23:case 24:case 25:case 26:case 27:case 28:case 29:case 30:case 31:case 32:case 33:case 34:case 35:break}return null!=t.velocity&&t.hasOwnProperty("velocity")&&!o.isInteger(t.velocity)?"velocity: integer expected":null!=t.startTime&&t.hasOwnProperty("startTime")&&"number"!==typeof t.startTime?"startTime: number expected":null==t.quantizedStartStep||!t.hasOwnProperty("quantizedStartStep")||o.isInteger(t.quantizedStartStep)||t.quantizedStartStep&&o.isInteger(t.quantizedStartStep.low)&&o.isInteger(t.quantizedStartStep.high)?null!=t.endTime&&t.hasOwnProperty("endTime")&&"number"!==typeof t.endTime?"endTime: number expected":null==t.quantizedEndStep||!t.hasOwnProperty("quantizedEndStep")||o.isInteger(t.quantizedEndStep)||t.quantizedEndStep&&o.isInteger(t.quantizedEndStep.low)&&o.isInteger(t.quantizedEndStep.high)?null!=t.numerator&&t.hasOwnProperty("numerator")&&!o.isInteger(t.numerator)?"numerator: integer expected":null!=t.denominator&&t.hasOwnProperty("denominator")&&!o.isInteger(t.denominator)?"denominator: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!o.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!o.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!==typeof t.isDrum?"isDrum: boolean expected":null!=t.part&&t.hasOwnProperty("part")&&!o.isInteger(t.part)?"part: integer expected":null!=t.voice&&t.hasOwnProperty("voice")&&!o.isInteger(t.voice)?"voice: integer expected":null:"quantizedEndStep: integer|Long expected":"quantizedStartStep: integer|Long expected"},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.Note)return t;var e=new a.tensorflow.magenta.NoteSequence.Note;switch(null!=t.pitch&&(e.pitch=0|t.pitch),t.pitchName){case"UNKNOWN_PITCH_NAME":case 0:e.pitchName=0;break;case"F_FLAT_FLAT":case 1:e.pitchName=1;break;case"C_FLAT_FLAT":case 2:e.pitchName=2;break;case"G_FLAT_FLAT":case 3:e.pitchName=3;break;case"D_FLAT_FLAT":case 4:e.pitchName=4;break;case"A_FLAT_FLAT":case 5:e.pitchName=5;break;case"E_FLAT_FLAT":case 6:e.pitchName=6;break;case"B_FLAT_FLAT":case 7:e.pitchName=7;break;case"F_FLAT":case 8:e.pitchName=8;break;case"C_FLAT":case 9:e.pitchName=9;break;case"G_FLAT":case 10:e.pitchName=10;break;case"D_FLAT":case 11:e.pitchName=11;break;case"A_FLAT":case 12:e.pitchName=12;break;case"E_FLAT":case 13:e.pitchName=13;break;case"B_FLAT":case 14:e.pitchName=14;break;case"F":case 15:e.pitchName=15;break;case"C":case 16:e.pitchName=16;break;case"G":case 17:e.pitchName=17;break;case"D":case 18:e.pitchName=18;break;case"A":case 19:e.pitchName=19;break;case"E":case 20:e.pitchName=20;break;case"B":case 21:e.pitchName=21;break;case"F_SHARP":case 22:e.pitchName=22;break;case"C_SHARP":case 23:e.pitchName=23;break;case"G_SHARP":case 24:e.pitchName=24;break;case"D_SHARP":case 25:e.pitchName=25;break;case"A_SHARP":case 26:e.pitchName=26;break;case"E_SHARP":case 27:e.pitchName=27;break;case"B_SHARP":case 28:e.pitchName=28;break;case"F_SHARP_SHARP":case 29:e.pitchName=29;break;case"C_SHARP_SHARP":case 30:e.pitchName=30;break;case"G_SHARP_SHARP":case 31:e.pitchName=31;break;case"D_SHARP_SHARP":case 32:e.pitchName=32;break;case"A_SHARP_SHARP":case 33:e.pitchName=33;break;case"E_SHARP_SHARP":case 34:e.pitchName=34;break;case"B_SHARP_SHARP":case 35:e.pitchName=35;break}return null!=t.velocity&&(e.velocity=0|t.velocity),null!=t.startTime&&(e.startTime=Number(t.startTime)),null!=t.quantizedStartStep&&(o.Long?(e.quantizedStartStep=o.Long.fromValue(t.quantizedStartStep)).unsigned=!1:"string"===typeof t.quantizedStartStep?e.quantizedStartStep=parseInt(t.quantizedStartStep,10):"number"===typeof t.quantizedStartStep?e.quantizedStartStep=t.quantizedStartStep:"object"===typeof t.quantizedStartStep&&(e.quantizedStartStep=new o.LongBits(t.quantizedStartStep.low>>>0,t.quantizedStartStep.high>>>0).toNumber())),null!=t.endTime&&(e.endTime=Number(t.endTime)),null!=t.quantizedEndStep&&(o.Long?(e.quantizedEndStep=o.Long.fromValue(t.quantizedEndStep)).unsigned=!1:"string"===typeof t.quantizedEndStep?e.quantizedEndStep=parseInt(t.quantizedEndStep,10):"number"===typeof t.quantizedEndStep?e.quantizedEndStep=t.quantizedEndStep:"object"===typeof t.quantizedEndStep&&(e.quantizedEndStep=new o.LongBits(t.quantizedEndStep.low>>>0,t.quantizedEndStep.high>>>0).toNumber())),null!=t.numerator&&(e.numerator=0|t.numerator),null!=t.denominator&&(e.denominator=0|t.denominator),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),null!=t.part&&(e.part=0|t.part),null!=t.voice&&(e.voice=0|t.voice),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults){if(n.pitch=0,n.velocity=0,n.startTime=0,n.endTime=0,n.numerator=0,n.denominator=0,n.instrument=0,n.program=0,n.isDrum=!1,n.part=0,n.pitchName=e.enums===String?"UNKNOWN_PITCH_NAME":0,n.voice=0,o.Long){var s=new o.Long(0,0,!1);n.quantizedStartStep=e.longs===String?s.toString():e.longs===Number?s.toNumber():s}else n.quantizedStartStep=e.longs===String?"0":0;if(o.Long){s=new o.Long(0,0,!1);n.quantizedEndStep=e.longs===String?s.toString():e.longs===Number?s.toNumber():s}else n.quantizedEndStep=e.longs===String?"0":0}return null!=t.pitch&&t.hasOwnProperty("pitch")&&(n.pitch=t.pitch),null!=t.velocity&&t.hasOwnProperty("velocity")&&(n.velocity=t.velocity),null!=t.startTime&&t.hasOwnProperty("startTime")&&(n.startTime=e.json&&!isFinite(t.startTime)?String(t.startTime):t.startTime),null!=t.endTime&&t.hasOwnProperty("endTime")&&(n.endTime=e.json&&!isFinite(t.endTime)?String(t.endTime):t.endTime),null!=t.numerator&&t.hasOwnProperty("numerator")&&(n.numerator=t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&(n.denominator=t.denominator),null!=t.instrument&&t.hasOwnProperty("instrument")&&(n.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(n.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(n.isDrum=t.isDrum),null!=t.part&&t.hasOwnProperty("part")&&(n.part=t.part),null!=t.pitchName&&t.hasOwnProperty("pitchName")&&(n.pitchName=e.enums===String?a.tensorflow.magenta.NoteSequence.PitchName[t.pitchName]:t.pitchName),null!=t.voice&&t.hasOwnProperty("voice")&&(n.voice=t.voice),null!=t.quantizedStartStep&&t.hasOwnProperty("quantizedStartStep")&&("number"===typeof t.quantizedStartStep?n.quantizedStartStep=e.longs===String?String(t.quantizedStartStep):t.quantizedStartStep:n.quantizedStartStep=e.longs===String?o.Long.prototype.toString.call(t.quantizedStartStep):e.longs===Number?new o.LongBits(t.quantizedStartStep.low>>>0,t.quantizedStartStep.high>>>0).toNumber():t.quantizedStartStep),null!=t.quantizedEndStep&&t.hasOwnProperty("quantizedEndStep")&&("number"===typeof t.quantizedEndStep?n.quantizedEndStep=e.longs===String?String(t.quantizedEndStep):t.quantizedEndStep:n.quantizedEndStep=e.longs===String?o.Long.prototype.toString.call(t.quantizedEndStep):e.longs===Number?new o.LongBits(t.quantizedEndStep.low>>>0,t.quantizedEndStep.high>>>0).toNumber():t.quantizedEndStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.PitchName=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_PITCH_NAME"]=0,e[t[1]="F_FLAT_FLAT"]=1,e[t[2]="C_FLAT_FLAT"]=2,e[t[3]="G_FLAT_FLAT"]=3,e[t[4]="D_FLAT_FLAT"]=4,e[t[5]="A_FLAT_FLAT"]=5,e[t[6]="E_FLAT_FLAT"]=6,e[t[7]="B_FLAT_FLAT"]=7,e[t[8]="F_FLAT"]=8,e[t[9]="C_FLAT"]=9,e[t[10]="G_FLAT"]=10,e[t[11]="D_FLAT"]=11,e[t[12]="A_FLAT"]=12,e[t[13]="E_FLAT"]=13,e[t[14]="B_FLAT"]=14,e[t[15]="F"]=15,e[t[16]="C"]=16,e[t[17]="G"]=17,e[t[18]="D"]=18,e[t[19]="A"]=19,e[t[20]="E"]=20,e[t[21]="B"]=21,e[t[22]="F_SHARP"]=22,e[t[23]="C_SHARP"]=23,e[t[24]="G_SHARP"]=24,e[t[25]="D_SHARP"]=25,e[t[26]="A_SHARP"]=26,e[t[27]="E_SHARP"]=27,e[t[28]="B_SHARP"]=28,e[t[29]="F_SHARP_SHARP"]=29,e[t[30]="C_SHARP_SHARP"]=30,e[t[31]="G_SHARP_SHARP"]=31,e[t[32]="D_SHARP_SHARP"]=32,e[t[33]="A_SHARP_SHARP"]=33,e[t[34]="E_SHARP_SHARP"]=34,e[t[35]="B_SHARP_SHARP"]=35,e}(),t.TimeSignature=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.numerator=0,t.prototype.denominator=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.numerator&&t.hasOwnProperty("numerator")&&e.uint32(16).int32(t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&e.uint32(24).int32(t.denominator),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.TimeSignature;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.time=t.double();break;case 2:s.numerator=t.int32();break;case 3:s.denominator=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!==typeof t.time?"time: number expected":null!=t.numerator&&t.hasOwnProperty("numerator")&&!o.isInteger(t.numerator)?"numerator: integer expected":null!=t.denominator&&t.hasOwnProperty("denominator")&&!o.isInteger(t.denominator)?"denominator: integer expected":null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.TimeSignature)return t;var e=new a.tensorflow.magenta.NoteSequence.TimeSignature;return null!=t.time&&(e.time=Number(t.time)),null!=t.numerator&&(e.numerator=0|t.numerator),null!=t.denominator&&(e.denominator=0|t.denominator),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.numerator=0,n.denominator=0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.numerator&&t.hasOwnProperty("numerator")&&(n.numerator=t.numerator),null!=t.denominator&&t.hasOwnProperty("denominator")&&(n.denominator=t.denominator),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.KeySignature=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.key=0,t.prototype.mode=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.key&&t.hasOwnProperty("key")&&e.uint32(16).int32(t.key),null!=t.mode&&t.hasOwnProperty("mode")&&e.uint32(24).int32(t.mode),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.KeySignature;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.time=t.double();break;case 2:s.key=t.int32();break;case 3:s.mode=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.time&&t.hasOwnProperty("time")&&"number"!==typeof t.time)return"time: number expected";if(null!=t.key&&t.hasOwnProperty("key"))switch(t.key){default:return"key: enum value expected";case 0:case 1:case 1:case 2:case 3:case 3:case 4:case 5:case 6:case 6:case 7:case 8:case 8:case 9:case 10:case 10:case 11:break}if(null!=t.mode&&t.hasOwnProperty("mode"))switch(t.mode){default:return"mode: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:break}return null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.KeySignature)return t;var e=new a.tensorflow.magenta.NoteSequence.KeySignature;switch(null!=t.time&&(e.time=Number(t.time)),t.key){case"C":case 0:e.key=0;break;case"C_SHARP":case 1:e.key=1;break;case"D_FLAT":case 1:e.key=1;break;case"D":case 2:e.key=2;break;case"D_SHARP":case 3:e.key=3;break;case"E_FLAT":case 3:e.key=3;break;case"E":case 4:e.key=4;break;case"F":case 5:e.key=5;break;case"F_SHARP":case 6:e.key=6;break;case"G_FLAT":case 6:e.key=6;break;case"G":case 7:e.key=7;break;case"G_SHARP":case 8:e.key=8;break;case"A_FLAT":case 8:e.key=8;break;case"A":case 9:e.key=9;break;case"A_SHARP":case 10:e.key=10;break;case"B_FLAT":case 10:e.key=10;break;case"B":case 11:e.key=11;break}switch(t.mode){case"MAJOR":case 0:e.mode=0;break;case"MINOR":case 1:e.mode=1;break;case"NOT_SPECIFIED":case 2:e.mode=2;break;case"MIXOLYDIAN":case 3:e.mode=3;break;case"DORIAN":case 4:e.mode=4;break;case"PHRYGIAN":case 5:e.mode=5;break;case"LYDIAN":case 6:e.mode=6;break;case"LOCRIAN":case 7:e.mode=7;break}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.key=e.enums===String?"C":0,n.mode=e.enums===String?"MAJOR":0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.key&&t.hasOwnProperty("key")&&(n.key=e.enums===String?a.tensorflow.magenta.NoteSequence.KeySignature.Key[t.key]:t.key),null!=t.mode&&t.hasOwnProperty("mode")&&(n.mode=e.enums===String?a.tensorflow.magenta.NoteSequence.KeySignature.Mode[t.mode]:t.mode),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.Key=function(){var t={},e=Object.create(t);return e[t[0]="C"]=0,e[t[1]="C_SHARP"]=1,e["D_FLAT"]=1,e[t[2]="D"]=2,e[t[3]="D_SHARP"]=3,e["E_FLAT"]=3,e[t[4]="E"]=4,e[t[5]="F"]=5,e[t[6]="F_SHARP"]=6,e["G_FLAT"]=6,e[t[7]="G"]=7,e[t[8]="G_SHARP"]=8,e["A_FLAT"]=8,e[t[9]="A"]=9,e[t[10]="A_SHARP"]=10,e["B_FLAT"]=10,e[t[11]="B"]=11,e}(),t.Mode=function(){var t={},e=Object.create(t);return e[t[0]="MAJOR"]=0,e[t[1]="MINOR"]=1,e[t[2]="NOT_SPECIFIED"]=2,e[t[3]="MIXOLYDIAN"]=3,e[t[4]="DORIAN"]=4,e[t[5]="PHRYGIAN"]=5,e[t[6]="LYDIAN"]=6,e[t[7]="LOCRIAN"]=7,e}(),t}(),t.Tempo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.qpm=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.qpm&&t.hasOwnProperty("qpm")&&e.uint32(17).double(t.qpm),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.Tempo;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.time=t.double();break;case 2:s.qpm=t.double();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!==typeof t.time?"time: number expected":null!=t.qpm&&t.hasOwnProperty("qpm")&&"number"!==typeof t.qpm?"qpm: number expected":null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.Tempo)return t;var e=new a.tensorflow.magenta.NoteSequence.Tempo;return null!=t.time&&(e.time=Number(t.time)),null!=t.qpm&&(e.qpm=Number(t.qpm)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.qpm=0),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.qpm&&t.hasOwnProperty("qpm")&&(n.qpm=e.json&&!isFinite(t.qpm)?String(t.qpm):t.qpm),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.PitchBend=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.bend=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.bend&&t.hasOwnProperty("bend")&&e.uint32(16).int32(t.bend),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(24).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(32).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(40).bool(t.isDrum),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.PitchBend;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.time=t.double();break;case 2:s.bend=t.int32();break;case 3:s.instrument=t.int32();break;case 4:s.program=t.int32();break;case 5:s.isDrum=t.bool();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!==typeof t.time?"time: number expected":null!=t.bend&&t.hasOwnProperty("bend")&&!o.isInteger(t.bend)?"bend: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!o.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!o.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!==typeof t.isDrum?"isDrum: boolean expected":null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.PitchBend)return t;var e=new a.tensorflow.magenta.NoteSequence.PitchBend;return null!=t.time&&(e.time=Number(t.time)),null!=t.bend&&(e.bend=0|t.bend),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.time=0,n.bend=0,n.instrument=0,n.program=0,n.isDrum=!1),null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.bend&&t.hasOwnProperty("bend")&&(n.bend=t.bend),null!=t.instrument&&t.hasOwnProperty("instrument")&&(n.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(n.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(n.isDrum=t.isDrum),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.ControlChange=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.quantizedStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.controlNumber=0,t.prototype.controlValue=0,t.prototype.instrument=0,t.prototype.program=0,t.prototype.isDrum=!1,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&e.uint32(16).int32(t.controlNumber),null!=t.controlValue&&t.hasOwnProperty("controlValue")&&e.uint32(24).int32(t.controlValue),null!=t.instrument&&t.hasOwnProperty("instrument")&&e.uint32(32).int32(t.instrument),null!=t.program&&t.hasOwnProperty("program")&&e.uint32(40).int32(t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&e.uint32(48).bool(t.isDrum),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&e.uint32(56).int64(t.quantizedStep),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.ControlChange;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.time=t.double();break;case 7:s.quantizedStep=o.Long?t.int64().toNumber():t.int64();break;case 2:s.controlNumber=t.int32();break;case 3:s.controlValue=t.int32();break;case 4:s.instrument=t.int32();break;case 5:s.program=t.int32();break;case 6:s.isDrum=t.bool();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!==typeof t.time?"time: number expected":null==t.quantizedStep||!t.hasOwnProperty("quantizedStep")||o.isInteger(t.quantizedStep)||t.quantizedStep&&o.isInteger(t.quantizedStep.low)&&o.isInteger(t.quantizedStep.high)?null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&!o.isInteger(t.controlNumber)?"controlNumber: integer expected":null!=t.controlValue&&t.hasOwnProperty("controlValue")&&!o.isInteger(t.controlValue)?"controlValue: integer expected":null!=t.instrument&&t.hasOwnProperty("instrument")&&!o.isInteger(t.instrument)?"instrument: integer expected":null!=t.program&&t.hasOwnProperty("program")&&!o.isInteger(t.program)?"program: integer expected":null!=t.isDrum&&t.hasOwnProperty("isDrum")&&"boolean"!==typeof t.isDrum?"isDrum: boolean expected":null:"quantizedStep: integer|Long expected"},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.ControlChange)return t;var e=new a.tensorflow.magenta.NoteSequence.ControlChange;return null!=t.time&&(e.time=Number(t.time)),null!=t.quantizedStep&&(o.Long?(e.quantizedStep=o.Long.fromValue(t.quantizedStep)).unsigned=!1:"string"===typeof t.quantizedStep?e.quantizedStep=parseInt(t.quantizedStep,10):"number"===typeof t.quantizedStep?e.quantizedStep=t.quantizedStep:"object"===typeof t.quantizedStep&&(e.quantizedStep=new o.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber())),null!=t.controlNumber&&(e.controlNumber=0|t.controlNumber),null!=t.controlValue&&(e.controlValue=0|t.controlValue),null!=t.instrument&&(e.instrument=0|t.instrument),null!=t.program&&(e.program=0|t.program),null!=t.isDrum&&(e.isDrum=Boolean(t.isDrum)),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults)if(n.time=0,n.controlNumber=0,n.controlValue=0,n.instrument=0,n.program=0,n.isDrum=!1,o.Long){var s=new o.Long(0,0,!1);n.quantizedStep=e.longs===String?s.toString():e.longs===Number?s.toNumber():s}else n.quantizedStep=e.longs===String?"0":0;return null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.controlNumber&&t.hasOwnProperty("controlNumber")&&(n.controlNumber=t.controlNumber),null!=t.controlValue&&t.hasOwnProperty("controlValue")&&(n.controlValue=t.controlValue),null!=t.instrument&&t.hasOwnProperty("instrument")&&(n.instrument=t.instrument),null!=t.program&&t.hasOwnProperty("program")&&(n.program=t.program),null!=t.isDrum&&t.hasOwnProperty("isDrum")&&(n.isDrum=t.isDrum),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&("number"===typeof t.quantizedStep?n.quantizedStep=e.longs===String?String(t.quantizedStep):t.quantizedStep:n.quantizedStep=e.longs===String?o.Long.prototype.toString.call(t.quantizedStep):e.longs===Number?new o.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber():t.quantizedStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.PartInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.part=0,t.prototype.name="",t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.part&&t.hasOwnProperty("part")&&e.uint32(8).int32(t.part),null!=t.name&&t.hasOwnProperty("name")&&e.uint32(18).string(t.name),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.PartInfo;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.part=t.int32();break;case 2:s.name=t.string();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.part&&t.hasOwnProperty("part")&&!o.isInteger(t.part)?"part: integer expected":null!=t.name&&t.hasOwnProperty("name")&&!o.isString(t.name)?"name: string expected":null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.PartInfo)return t;var e=new a.tensorflow.magenta.NoteSequence.PartInfo;return null!=t.part&&(e.part=0|t.part),null!=t.name&&(e.name=String(t.name)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.part=0,n.name=""),null!=t.part&&t.hasOwnProperty("part")&&(n.part=t.part),null!=t.name&&t.hasOwnProperty("name")&&(n.name=t.name),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SourceInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sourceType=0,t.prototype.encodingType=0,t.prototype.parser=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.sourceType&&t.hasOwnProperty("sourceType")&&e.uint32(8).int32(t.sourceType),null!=t.encodingType&&t.hasOwnProperty("encodingType")&&e.uint32(16).int32(t.encodingType),null!=t.parser&&t.hasOwnProperty("parser")&&e.uint32(24).int32(t.parser),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.SourceInfo;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.sourceType=t.int32();break;case 2:s.encodingType=t.int32();break;case 3:s.parser=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.sourceType&&t.hasOwnProperty("sourceType"))switch(t.sourceType){default:return"sourceType: enum value expected";case 0:case 1:case 2:break}if(null!=t.encodingType&&t.hasOwnProperty("encodingType"))switch(t.encodingType){default:return"encodingType: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(null!=t.parser&&t.hasOwnProperty("parser"))switch(t.parser){default:return"parser: enum value expected";case 0:case 1:case 2:case 3:case 4:case 5:case 6:break}return null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.SourceInfo)return t;var e=new a.tensorflow.magenta.NoteSequence.SourceInfo;switch(t.sourceType){case"UNKNOWN_SOURCE_TYPE":case 0:e.sourceType=0;break;case"SCORE_BASED":case 1:e.sourceType=1;break;case"PERFORMANCE_BASED":case 2:e.sourceType=2;break}switch(t.encodingType){case"UNKNOWN_ENCODING_TYPE":case 0:e.encodingType=0;break;case"MUSIC_XML":case 1:e.encodingType=1;break;case"ABC":case 2:e.encodingType=2;break;case"MIDI":case 3:e.encodingType=3;break;case"MUSICNET":case 4:e.encodingType=4;break}switch(t.parser){case"UNKNOWN_PARSER":case 0:e.parser=0;break;case"MUSIC21":case 1:e.parser=1;break;case"PRETTY_MIDI":case 2:e.parser=2;break;case"MAGENTA_MUSIC_XML":case 3:e.parser=3;break;case"MAGENTA_MUSICNET":case 4:e.parser=4;break;case"MAGENTA_ABC":case 5:e.parser=5;break;case"TONEJS_MIDI_CONVERT":case 6:e.parser=6;break}return e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.sourceType=e.enums===String?"UNKNOWN_SOURCE_TYPE":0,n.encodingType=e.enums===String?"UNKNOWN_ENCODING_TYPE":0,n.parser=e.enums===String?"UNKNOWN_PARSER":0),null!=t.sourceType&&t.hasOwnProperty("sourceType")&&(n.sourceType=e.enums===String?a.tensorflow.magenta.NoteSequence.SourceInfo.SourceType[t.sourceType]:t.sourceType),null!=t.encodingType&&t.hasOwnProperty("encodingType")&&(n.encodingType=e.enums===String?a.tensorflow.magenta.NoteSequence.SourceInfo.EncodingType[t.encodingType]:t.encodingType),null!=t.parser&&t.hasOwnProperty("parser")&&(n.parser=e.enums===String?a.tensorflow.magenta.NoteSequence.SourceInfo.Parser[t.parser]:t.parser),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.SourceType=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_SOURCE_TYPE"]=0,e[t[1]="SCORE_BASED"]=1,e[t[2]="PERFORMANCE_BASED"]=2,e}(),t.EncodingType=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_ENCODING_TYPE"]=0,e[t[1]="MUSIC_XML"]=1,e[t[2]="ABC"]=2,e[t[3]="MIDI"]=3,e[t[4]="MUSICNET"]=4,e}(),t.Parser=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN_PARSER"]=0,e[t[1]="MUSIC21"]=1,e[t[2]="PRETTY_MIDI"]=2,e[t[3]="MAGENTA_MUSIC_XML"]=3,e[t[4]="MAGENTA_MUSICNET"]=4,e[t[5]="MAGENTA_ABC"]=5,e[t[6]="TONEJS_MIDI_CONVERT"]=6,e}(),t}(),t.TextAnnotation=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.quantizedStep=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.text="",t.prototype.annotationType=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.text&&t.hasOwnProperty("text")&&e.uint32(18).string(t.text),null!=t.annotationType&&t.hasOwnProperty("annotationType")&&e.uint32(24).int32(t.annotationType),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&e.uint32(32).int64(t.quantizedStep),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.TextAnnotation;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.time=t.double();break;case 4:s.quantizedStep=o.Long?t.int64().toNumber():t.int64();break;case 2:s.text=t.string();break;case 3:s.annotationType=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.time&&t.hasOwnProperty("time")&&"number"!==typeof t.time)return"time: number expected";if(null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&!o.isInteger(t.quantizedStep)&&!(t.quantizedStep&&o.isInteger(t.quantizedStep.low)&&o.isInteger(t.quantizedStep.high)))return"quantizedStep: integer|Long expected";if(null!=t.text&&t.hasOwnProperty("text")&&!o.isString(t.text))return"text: string expected";if(null!=t.annotationType&&t.hasOwnProperty("annotationType"))switch(t.annotationType){default:return"annotationType: enum value expected";case 0:case 1:case 2:break}return null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.TextAnnotation)return t;var e=new a.tensorflow.magenta.NoteSequence.TextAnnotation;switch(null!=t.time&&(e.time=Number(t.time)),null!=t.quantizedStep&&(o.Long?(e.quantizedStep=o.Long.fromValue(t.quantizedStep)).unsigned=!1:"string"===typeof t.quantizedStep?e.quantizedStep=parseInt(t.quantizedStep,10):"number"===typeof t.quantizedStep?e.quantizedStep=t.quantizedStep:"object"===typeof t.quantizedStep&&(e.quantizedStep=new o.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber())),null!=t.text&&(e.text=String(t.text)),t.annotationType){case"UNKNOWN":case 0:e.annotationType=0;break;case"CHORD_SYMBOL":case 1:e.annotationType=1;break;case"BEAT":case 2:e.annotationType=2;break}return e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults)if(n.time=0,n.text="",n.annotationType=e.enums===String?"UNKNOWN":0,o.Long){var s=new o.Long(0,0,!1);n.quantizedStep=e.longs===String?s.toString():e.longs===Number?s.toNumber():s}else n.quantizedStep=e.longs===String?"0":0;return null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.text&&t.hasOwnProperty("text")&&(n.text=t.text),null!=t.annotationType&&t.hasOwnProperty("annotationType")&&(n.annotationType=e.enums===String?a.tensorflow.magenta.NoteSequence.TextAnnotation.TextAnnotationType[t.annotationType]:t.annotationType),null!=t.quantizedStep&&t.hasOwnProperty("quantizedStep")&&("number"===typeof t.quantizedStep?n.quantizedStep=e.longs===String?String(t.quantizedStep):t.quantizedStep:n.quantizedStep=e.longs===String?o.Long.prototype.toString.call(t.quantizedStep):e.longs===Number?new o.LongBits(t.quantizedStep.low>>>0,t.quantizedStep.high>>>0).toNumber():t.quantizedStep),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t.TextAnnotationType=function(){var t={},e=Object.create(t);return e[t[0]="UNKNOWN"]=0,e[t[1]="CHORD_SYMBOL"]=1,e[t[2]="BEAT"]=2,e}(),t}(),t.QuantizationInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.stepsPerQuarter=0,t.prototype.stepsPerSecond=0,Object.defineProperty(t.prototype,"resolution",{get:o.oneOfGetter(e=["stepsPerQuarter","stepsPerSecond"]),set:o.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&e.uint32(8).int32(t.stepsPerQuarter),null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")&&e.uint32(16).int32(t.stepsPerSecond),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.QuantizationInfo;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.stepsPerQuarter=t.int32();break;case 2:s.stepsPerSecond=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";var e={};if(null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&(e.resolution=1,!o.isInteger(t.stepsPerQuarter)))return"stepsPerQuarter: integer expected";if(null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")){if(1===e.resolution)return"resolution: multiple values";if(e.resolution=1,!o.isInteger(t.stepsPerSecond))return"stepsPerSecond: integer expected"}return null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.QuantizationInfo)return t;var e=new a.tensorflow.magenta.NoteSequence.QuantizationInfo;return null!=t.stepsPerQuarter&&(e.stepsPerQuarter=0|t.stepsPerQuarter),null!=t.stepsPerSecond&&(e.stepsPerSecond=0|t.stepsPerSecond),e},t.toObject=function(t,e){e||(e={});var n={};return null!=t.stepsPerQuarter&&t.hasOwnProperty("stepsPerQuarter")&&(n.stepsPerQuarter=t.stepsPerQuarter,e.oneofs&&(n.resolution="stepsPerQuarter")),null!=t.stepsPerSecond&&t.hasOwnProperty("stepsPerSecond")&&(n.stepsPerSecond=t.stepsPerSecond,e.oneofs&&(n.resolution="stepsPerSecond")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SubsequenceInfo=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.startTimeOffset=0,t.prototype.endTimeOffset=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&e.uint32(9).double(t.startTimeOffset),null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&e.uint32(17).double(t.endTimeOffset),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.SubsequenceInfo;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.startTimeOffset=t.double();break;case 2:s.endTimeOffset=t.double();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&"number"!==typeof t.startTimeOffset?"startTimeOffset: number expected":null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&"number"!==typeof t.endTimeOffset?"endTimeOffset: number expected":null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.SubsequenceInfo)return t;var e=new a.tensorflow.magenta.NoteSequence.SubsequenceInfo;return null!=t.startTimeOffset&&(e.startTimeOffset=Number(t.startTimeOffset)),null!=t.endTimeOffset&&(e.endTimeOffset=Number(t.endTimeOffset)),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.startTimeOffset=0,n.endTimeOffset=0),null!=t.startTimeOffset&&t.hasOwnProperty("startTimeOffset")&&(n.startTimeOffset=e.json&&!isFinite(t.startTimeOffset)?String(t.startTimeOffset):t.startTimeOffset),null!=t.endTimeOffset&&t.hasOwnProperty("endTimeOffset")&&(n.endTimeOffset=e.json&&!isFinite(t.endTimeOffset)?String(t.endTimeOffset):t.endTimeOffset),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SectionAnnotation=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.time=0,t.prototype.sectionId=o.Long?o.Long.fromBits(0,0,!1):0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.time&&t.hasOwnProperty("time")&&e.uint32(9).double(t.time),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&e.uint32(32).int64(t.sectionId),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.SectionAnnotation;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.time=t.double();break;case 4:s.sectionId=o.Long?t.int64().toNumber():t.int64();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.time&&t.hasOwnProperty("time")&&"number"!==typeof t.time?"time: number expected":null==t.sectionId||!t.hasOwnProperty("sectionId")||o.isInteger(t.sectionId)||t.sectionId&&o.isInteger(t.sectionId.low)&&o.isInteger(t.sectionId.high)?null:"sectionId: integer|Long expected"},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.SectionAnnotation)return t;var e=new a.tensorflow.magenta.NoteSequence.SectionAnnotation;return null!=t.time&&(e.time=Number(t.time)),null!=t.sectionId&&(o.Long?(e.sectionId=o.Long.fromValue(t.sectionId)).unsigned=!1:"string"===typeof t.sectionId?e.sectionId=parseInt(t.sectionId,10):"number"===typeof t.sectionId?e.sectionId=t.sectionId:"object"===typeof t.sectionId&&(e.sectionId=new o.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber())),e},t.toObject=function(t,e){e||(e={});var n={};if(e.defaults)if(n.time=0,o.Long){var s=new o.Long(0,0,!1);n.sectionId=e.longs===String?s.toString():e.longs===Number?s.toNumber():s}else n.sectionId=e.longs===String?"0":0;return null!=t.time&&t.hasOwnProperty("time")&&(n.time=e.json&&!isFinite(t.time)?String(t.time):t.time),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&("number"===typeof t.sectionId?n.sectionId=e.longs===String?String(t.sectionId):t.sectionId:n.sectionId=e.longs===String?o.Long.prototype.toString.call(t.sectionId):e.longs===Number?new o.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber():t.sectionId),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.Section=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}var e;return t.prototype.sectionId=o.Long?o.Long.fromBits(0,0,!1):0,t.prototype.sectionGroup=null,Object.defineProperty(t.prototype,"sectionType",{get:o.oneOfGetter(e=["sectionId","sectionGroup"]),set:o.oneOfSetter(e)}),t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.sectionId&&t.hasOwnProperty("sectionId")&&e.uint32(8).int64(t.sectionId),null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")&&a.tensorflow.magenta.NoteSequence.SectionGroup.encode(t.sectionGroup,e.uint32(18).fork()).ldelim(),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.Section;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.sectionId=o.Long?t.int64().toNumber():t.int64();break;case 2:s.sectionGroup=a.tensorflow.magenta.NoteSequence.SectionGroup.decode(t,t.uint32());break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";var e={};if(null!=t.sectionId&&t.hasOwnProperty("sectionId")&&(e.sectionType=1,!o.isInteger(t.sectionId)&&!(t.sectionId&&o.isInteger(t.sectionId.low)&&o.isInteger(t.sectionId.high))))return"sectionId: integer|Long expected";if(null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")){if(1===e.sectionType)return"sectionType: multiple values";e.sectionType=1;var n=a.tensorflow.magenta.NoteSequence.SectionGroup.verify(t.sectionGroup);if(n)return"sectionGroup."+n}return null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.Section)return t;var e=new a.tensorflow.magenta.NoteSequence.Section;if(null!=t.sectionId&&(o.Long?(e.sectionId=o.Long.fromValue(t.sectionId)).unsigned=!1:"string"===typeof t.sectionId?e.sectionId=parseInt(t.sectionId,10):"number"===typeof t.sectionId?e.sectionId=t.sectionId:"object"===typeof t.sectionId&&(e.sectionId=new o.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber())),null!=t.sectionGroup){if("object"!==typeof t.sectionGroup)throw TypeError(".tensorflow.magenta.NoteSequence.Section.sectionGroup: object expected");e.sectionGroup=a.tensorflow.magenta.NoteSequence.SectionGroup.fromObject(t.sectionGroup)}return e},t.toObject=function(t,e){e||(e={});var n={};return null!=t.sectionId&&t.hasOwnProperty("sectionId")&&("number"===typeof t.sectionId?n.sectionId=e.longs===String?String(t.sectionId):t.sectionId:n.sectionId=e.longs===String?o.Long.prototype.toString.call(t.sectionId):e.longs===Number?new o.LongBits(t.sectionId.low>>>0,t.sectionId.high>>>0).toNumber():t.sectionId,e.oneofs&&(n.sectionType="sectionId")),null!=t.sectionGroup&&t.hasOwnProperty("sectionGroup")&&(n.sectionGroup=a.tensorflow.magenta.NoteSequence.SectionGroup.toObject(t.sectionGroup,e),e.oneofs&&(n.sectionType="sectionGroup")),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.SectionGroup=function(){function t(t){if(this.sections=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.sections=o.emptyArray,t.prototype.numTimes=0,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.sections&&t.sections.length)for(var n=0;n<t.sections.length;++n)a.tensorflow.magenta.NoteSequence.Section.encode(t.sections[n],e.uint32(10).fork()).ldelim();return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&e.uint32(16).int32(t.numTimes),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.NoteSequence.SectionGroup;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.sections&&s.sections.length||(s.sections=[]),s.sections.push(a.tensorflow.magenta.NoteSequence.Section.decode(t,t.uint32()));break;case 2:s.numTimes=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.sections&&t.hasOwnProperty("sections")){if(!Array.isArray(t.sections))return"sections: array expected";for(var e=0;e<t.sections.length;++e){var n=a.tensorflow.magenta.NoteSequence.Section.verify(t.sections[e]);if(n)return"sections."+n}}return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&!o.isInteger(t.numTimes)?"numTimes: integer expected":null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.NoteSequence.SectionGroup)return t;var e=new a.tensorflow.magenta.NoteSequence.SectionGroup;if(t.sections){if(!Array.isArray(t.sections))throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: array expected");e.sections=[];for(var n=0;n<t.sections.length;++n){if("object"!==typeof t.sections[n])throw TypeError(".tensorflow.magenta.NoteSequence.SectionGroup.sections: object expected");e.sections[n]=a.tensorflow.magenta.NoteSequence.Section.fromObject(t.sections[n])}}return null!=t.numTimes&&(e.numTimes=0|t.numTimes),e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.sections=[]),e.defaults&&(n.numTimes=0),t.sections&&t.sections.length){n.sections=[];for(var s=0;s<t.sections.length;++s)n.sections[s]=a.tensorflow.magenta.NoteSequence.Section.toObject(t.sections[s],e)}return null!=t.numTimes&&t.hasOwnProperty("numTimes")&&(n.numTimes=t.numTimes),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t}(),t.SequenceMetadata=function(){function t(t){if(this.genre=[],this.composers=[],t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.title="",t.prototype.artist="",t.prototype.genre=o.emptyArray,t.prototype.composers=o.emptyArray,t.create=function(e){return new t(e)},t.encode=function(t,e){if(e||(e=r.create()),null!=t.title&&t.hasOwnProperty("title")&&e.uint32(10).string(t.title),null!=t.artist&&t.hasOwnProperty("artist")&&e.uint32(18).string(t.artist),null!=t.genre&&t.genre.length)for(var n=0;n<t.genre.length;++n)e.uint32(26).string(t.genre[n]);if(null!=t.composers&&t.composers.length)for(n=0;n<t.composers.length;++n)e.uint32(34).string(t.composers[n]);return e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.SequenceMetadata;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.title=t.string();break;case 2:s.artist=t.string();break;case 3:s.genre&&s.genre.length||(s.genre=[]),s.genre.push(t.string());break;case 4:s.composers&&s.composers.length||(s.composers=[]),s.composers.push(t.string());break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){if("object"!==typeof t||null===t)return"object expected";if(null!=t.title&&t.hasOwnProperty("title")&&!o.isString(t.title))return"title: string expected";if(null!=t.artist&&t.hasOwnProperty("artist")&&!o.isString(t.artist))return"artist: string expected";if(null!=t.genre&&t.hasOwnProperty("genre")){if(!Array.isArray(t.genre))return"genre: array expected";for(var e=0;e<t.genre.length;++e)if(!o.isString(t.genre[e]))return"genre: string[] expected"}if(null!=t.composers&&t.hasOwnProperty("composers")){if(!Array.isArray(t.composers))return"composers: array expected";for(e=0;e<t.composers.length;++e)if(!o.isString(t.composers[e]))return"composers: string[] expected"}return null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.SequenceMetadata)return t;var e=new a.tensorflow.magenta.SequenceMetadata;if(null!=t.title&&(e.title=String(t.title)),null!=t.artist&&(e.artist=String(t.artist)),t.genre){if(!Array.isArray(t.genre))throw TypeError(".tensorflow.magenta.SequenceMetadata.genre: array expected");e.genre=[];for(var n=0;n<t.genre.length;++n)e.genre[n]=String(t.genre[n])}if(t.composers){if(!Array.isArray(t.composers))throw TypeError(".tensorflow.magenta.SequenceMetadata.composers: array expected");e.composers=[];for(n=0;n<t.composers.length;++n)e.composers[n]=String(t.composers[n])}return e},t.toObject=function(t,e){e||(e={});var n={};if((e.arrays||e.defaults)&&(n.genre=[],n.composers=[]),e.defaults&&(n.title="",n.artist=""),null!=t.title&&t.hasOwnProperty("title")&&(n.title=t.title),null!=t.artist&&t.hasOwnProperty("artist")&&(n.artist=t.artist),t.genre&&t.genre.length){n.genre=[];for(var s=0;s<t.genre.length;++s)n.genre[s]=t.genre[s]}if(t.composers&&t.composers.length){n.composers=[];for(s=0;s<t.composers.length;++s)n.composers[s]=t.composers[s]}return n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t.VelocityRange=function(){function t(t){if(t)for(var e=Object.keys(t),n=0;n<e.length;++n)null!=t[e[n]]&&(this[e[n]]=t[e[n]])}return t.prototype.min=0,t.prototype.max=0,t.create=function(e){return new t(e)},t.encode=function(t,e){return e||(e=r.create()),null!=t.min&&t.hasOwnProperty("min")&&e.uint32(8).int32(t.min),null!=t.max&&t.hasOwnProperty("max")&&e.uint32(16).int32(t.max),e},t.encodeDelimited=function(t,e){return this.encode(t,e).ldelim()},t.decode=function(t,e){t instanceof i||(t=i.create(t));var n=void 0===e?t.len:t.pos+e,s=new a.tensorflow.magenta.VelocityRange;while(t.pos<n){var r=t.uint32();switch(r>>>3){case 1:s.min=t.int32();break;case 2:s.max=t.int32();break;default:t.skipType(7&r);break}}return s},t.decodeDelimited=function(t){return t instanceof i||(t=new i(t)),this.decode(t,t.uint32())},t.verify=function(t){return"object"!==typeof t||null===t?"object expected":null!=t.min&&t.hasOwnProperty("min")&&!o.isInteger(t.min)?"min: integer expected":null!=t.max&&t.hasOwnProperty("max")&&!o.isInteger(t.max)?"max: integer expected":null},t.fromObject=function(t){if(t instanceof a.tensorflow.magenta.VelocityRange)return t;var e=new a.tensorflow.magenta.VelocityRange;return null!=t.min&&(e.min=0|t.min),null!=t.max&&(e.max=0|t.max),e},t.toObject=function(t,e){e||(e={});var n={};return e.defaults&&(n.min=0,n.max=0),null!=t.min&&t.hasOwnProperty("min")&&(n.min=t.min),null!=t.max&&t.hasOwnProperty("max")&&(n.max=t.max),n},t.prototype.toJSON=function(){return this.constructor.toObject(this,s.util.toJSONOptions)},t}(),t}(),t}(),t.exports=a},2544:function(t){"use strict";function e(t,e){var n=new Array(arguments.length-1),s=0,i=2,r=!0;while(i<arguments.length)n[s++]=arguments[i++];return new Promise((function(i,o){n[s]=function(t){if(r)if(r=!1,t)o(t);else{var e=new Array(arguments.length-1),n=0;while(n<e.length)e[n++]=arguments[n];i.apply(null,e)}};try{t.apply(e||null,n)}catch(a){r&&(r=!1,o(a))}}))}t.exports=e},3304:function(t,e,n){"use strict";n(4114);var s=e;s.length=function(t){var e=t.length;if(!e)return 0;var n=0;while(--e%4>1&&"="===t.charAt(e))++n;return Math.ceil(3*t.length)/4-n};for(var i=new Array(64),r=new Array(123),o=0;o<64;)r[i[o]=o<26?o+65:o<52?o+71:o<62?o-4:o-59|43]=o++;s.encode=function(t,e,n){var s,r=null,o=[],a=0,u=0;while(e<n){var c=t[e++];switch(u){case 0:o[a++]=i[c>>2],s=(3&c)<<4,u=1;break;case 1:o[a++]=i[s|c>>4],s=(15&c)<<2,u=2;break;case 2:o[a++]=i[s|c>>6],o[a++]=i[63&c],u=0;break}a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),a=0)}return u&&(o[a++]=i[s],o[a++]=61,1===u&&(o[a++]=61)),r?(a&&r.push(String.fromCharCode.apply(String,o.slice(0,a))),r.join("")):String.fromCharCode.apply(String,o.slice(0,a))};var a="invalid encoding";s.decode=function(t,e,n){for(var s,i=n,o=0,u=0;u<t.length;){var c=t.charCodeAt(u++);if(61===c&&o>1)break;if(void 0===(c=r[c]))throw Error(a);switch(o){case 0:s=c,o=1;break;case 1:e[n++]=s<<2|(48&c)>>4,s=c,o=2;break;case 2:e[n++]=(15&s)<<4|(60&c)>>2,s=c,o=3;break;case 3:e[n++]=(3&s)<<6|c,o=0;break}}if(1===o)throw Error(a);return n-i},s.test=function(t){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(t)}},277:function(t,e,n){"use strict";function s(){this._listeners={}}n(4114),t.exports=s,s.prototype.on=function(t,e,n){return(this._listeners[t]||(this._listeners[t]=[])).push({fn:e,ctx:n||this}),this},s.prototype.off=function(t,e){if(void 0===t)this._listeners={};else if(void 0===e)this._listeners[t]=[];else for(var n=this._listeners[t],s=0;s<n.length;)n[s].fn===e?n.splice(s,1):++s;return this},s.prototype.emit=function(t){var e=this._listeners[t];if(e){for(var n=[],s=1;s<arguments.length;)n.push(arguments[s++]);for(s=0;s<e.length;)e[s].fn.apply(e[s++].ctx,n)}return this}},4543:function(t,e,n){"use strict";function s(t){return"undefined"!==typeof Float32Array?function(){var e=new Float32Array([-0]),n=new Uint8Array(e.buffer),s=128===n[3];function i(t,s,i){e[0]=t,s[i]=n[0],s[i+1]=n[1],s[i+2]=n[2],s[i+3]=n[3]}function r(t,s,i){e[0]=t,s[i]=n[3],s[i+1]=n[2],s[i+2]=n[1],s[i+3]=n[0]}function o(t,s){return n[0]=t[s],n[1]=t[s+1],n[2]=t[s+2],n[3]=t[s+3],e[0]}function a(t,s){return n[3]=t[s],n[2]=t[s+1],n[1]=t[s+2],n[0]=t[s+3],e[0]}t.writeFloatLE=s?i:r,t.writeFloatBE=s?r:i,t.readFloatLE=s?o:a,t.readFloatBE=s?a:o}():function(){function e(t,e,n,s){var i=e<0?1:0;if(i&&(e=-e),0===e)t(1/e>0?0:2147483648,n,s);else if(isNaN(e))t(2143289344,n,s);else if(e>34028234663852886e22)t((i<<31|2139095040)>>>0,n,s);else if(e<11754943508222875e-54)t((i<<31|Math.round(e/1401298464324817e-60))>>>0,n,s);else{var r=Math.floor(Math.log(e)/Math.LN2),o=8388607&Math.round(e*Math.pow(2,-r)*8388608);t((i<<31|r+127<<23|o)>>>0,n,s)}}function n(t,e,n){var s=t(e,n),i=2*(s>>31)+1,r=s>>>23&255,o=8388607&s;return 255===r?o?NaN:i*(1/0):0===r?1401298464324817e-60*i*o:i*Math.pow(2,r-150)*(o+8388608)}t.writeFloatLE=e.bind(null,i),t.writeFloatBE=e.bind(null,r),t.readFloatLE=n.bind(null,o),t.readFloatBE=n.bind(null,a)}(),"undefined"!==typeof Float64Array?function(){var e=new Float64Array([-0]),n=new Uint8Array(e.buffer),s=128===n[7];function i(t,s,i){e[0]=t,s[i]=n[0],s[i+1]=n[1],s[i+2]=n[2],s[i+3]=n[3],s[i+4]=n[4],s[i+5]=n[5],s[i+6]=n[6],s[i+7]=n[7]}function r(t,s,i){e[0]=t,s[i]=n[7],s[i+1]=n[6],s[i+2]=n[5],s[i+3]=n[4],s[i+4]=n[3],s[i+5]=n[2],s[i+6]=n[1],s[i+7]=n[0]}function o(t,s){return n[0]=t[s],n[1]=t[s+1],n[2]=t[s+2],n[3]=t[s+3],n[4]=t[s+4],n[5]=t[s+5],n[6]=t[s+6],n[7]=t[s+7],e[0]}function a(t,s){return n[7]=t[s],n[6]=t[s+1],n[5]=t[s+2],n[4]=t[s+3],n[3]=t[s+4],n[2]=t[s+5],n[1]=t[s+6],n[0]=t[s+7],e[0]}t.writeDoubleLE=s?i:r,t.writeDoubleBE=s?r:i,t.readDoubleLE=s?o:a,t.readDoubleBE=s?a:o}():function(){function e(t,e,n,s,i,r){var o=s<0?1:0;if(o&&(s=-s),0===s)t(0,i,r+e),t(1/s>0?0:2147483648,i,r+n);else if(isNaN(s))t(0,i,r+e),t(2146959360,i,r+n);else if(s>17976931348623157e292)t(0,i,r+e),t((o<<31|2146435072)>>>0,i,r+n);else{var a;if(s<22250738585072014e-324)a=s/5e-324,t(a>>>0,i,r+e),t((o<<31|a/4294967296)>>>0,i,r+n);else{var u=Math.floor(Math.log(s)/Math.LN2);1024===u&&(u=1023),a=s*Math.pow(2,-u),t(4503599627370496*a>>>0,i,r+e),t((o<<31|u+1023<<20|1048576*a&1048575)>>>0,i,r+n)}}}function n(t,e,n,s,i){var r=t(s,i+e),o=t(s,i+n),a=2*(o>>31)+1,u=o>>>20&2047,c=4294967296*(1048575&o)+r;return 2047===u?c?NaN:a*(1/0):0===u?5e-324*a*c:a*Math.pow(2,u-1075)*(c+4503599627370496)}t.writeDoubleLE=e.bind(null,i,0,4),t.writeDoubleBE=e.bind(null,r,4,0),t.readDoubleLE=n.bind(null,o,0,4),t.readDoubleBE=n.bind(null,a,4,0)}(),t}function i(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}function r(t,e,n){e[n]=t>>>24,e[n+1]=t>>>16&255,e[n+2]=t>>>8&255,e[n+3]=255&t}function o(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16|t[e+3]<<24)>>>0}function a(t,e){return(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),t.exports=s(s)},6120:function(module){"use strict";function inquire(moduleName){try{var mod=eval("quire".replace(/^/,"re"))(moduleName);if(mod&&(mod.length||Object.keys(mod).length))return mod}catch(e){}return null}module.exports=inquire},9133:function(t){"use strict";function e(t,e,n){var s=n||8192,i=s>>>1,r=null,o=s;return function(n){if(n<1||n>i)return t(n);o+n>s&&(r=t(s),o=0);var a=e.call(r,o,o+=n);return 7&o&&(o=1+(7|o)),a}}t.exports=e},1856:function(t,e,n){"use strict";n(4114);var s=e;s.length=function(t){for(var e=0,n=0,s=0;s<t.length;++s)n=t.charCodeAt(s),n<128?e+=1:n<2048?e+=2:55296===(64512&n)&&56320===(64512&t.charCodeAt(s+1))?(++s,e+=4):e+=3;return e},s.read=function(t,e,n){var s=n-e;if(s<1)return"";var i,r=null,o=[],a=0;while(e<n)i=t[e++],i<128?o[a++]=i:i>191&&i<224?o[a++]=(31&i)<<6|63&t[e++]:i>239&&i<365?(i=((7&i)<<18|(63&t[e++])<<12|(63&t[e++])<<6|63&t[e++])-65536,o[a++]=55296+(i>>10),o[a++]=56320+(1023&i)):o[a++]=(15&i)<<12|(63&t[e++])<<6|63&t[e++],a>8191&&((r||(r=[])).push(String.fromCharCode.apply(String,o)),a=0);return r?(a&&r.push(String.fromCharCode.apply(String,o.slice(0,a))),r.join("")):String.fromCharCode.apply(String,o.slice(0,a))},s.write=function(t,e,n){for(var s,i,r=n,o=0;o<t.length;++o)s=t.charCodeAt(o),s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296===(64512&s)&&56320===(64512&(i=t.charCodeAt(o+1)))?(s=65536+((1023&s)<<10)+(1023&i),++o,e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128);return n-r}},733:function(t,e,n){var s=n(7090),i=n(4935),r=n(5601),o=n(5129),a=n(1799),u=n(887),c=n(3191);c.alea=s,c.xor128=i,c.xorwow=r,c.xorshift7=o,c.xor4096=a,c.tychei=u,t.exports=c},7090:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n=c();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new o(t),s=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}function c(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){t+=e.charCodeAt(n);var s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=4294967296*s}return 2.3283064365386963e-10*(t>>>0)};return e}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.alea=u}(0,t,n.amdD)},887:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,s=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-s|0,s=s<<24^s>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-s|0,e.d=s<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var s=0;s<n.length+20;s++)e.b^=0|n.charCodeAt(s),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.tychei=u}(0,t,n.amdD)},4935:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var s=0;s<n.length+64;s++)e.x^=0|n.charCodeAt(s),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xor128=u}(0,t,n.amdD)},1799:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this;function n(t,e){var n,s,i,r,o,a=[],u=128;for(e===(0|e)?(s=e,e=null):(e+="\0",s=0,u=Math.max(u,e.length)),i=0,r=-32;r<u;++r)e&&(s^=e.charCodeAt((r+32)%e.length)),0===r&&(o=s),s^=s<<10,s^=s>>>15,s^=s<<4,s^=s>>>13,r>=0&&(o=o+1640531527|0,n=a[127&r]^=s+o,i=0==n?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,r=512;r>0;--r)s=a[i+34&127],n=a[i=i+1&127],s^=s<<13,n^=n<<17,s^=s>>>15,n^=n>>>12,a[i]=s^n;t.w=o,t.X=a,t.i=i}e.next=function(){var t,n,s=e.w,i=e.X,r=e.i;return e.w=s=s+1640531527|0,n=i[r+34&127],t=i[r=r+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[r]=n^t,e.i=r,n+(s^s>>>16)|0},n(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&(s.X&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xor4096=u}(0,t,n.amdD)},5129:function(t,e,n){var s;t=n.nmd(t),n(4114),function(t,i,r){function o(t){var e=this;function n(t,e){var n,s=[];if(e===(0|e))s[0]=e;else for(e=""+e,n=0;n<e.length;++n)s[7&n]=s[7&n]<<15^e.charCodeAt(n)+s[n+1&7]<<13;while(s.length<8)s.push(0);for(n=0;n<8&&0===s[n];++n);for(8==n?s[7]=-1:s[n],t.x=s,t.i=0,n=256;n>0;--n)t.next()}e.next=function(){var t,n,s=e.x,i=e.i;return t=s[i],t^=t>>>7,n=t^t<<24,t=s[i+1&7],n^=t^t>>>10,t=s[i+3&7],n^=t^t>>>3,t=s[i+4&7],n^=t^t<<7,t=s[i+7&7],t^=t<<13,n^=t^t<<9,s[i]=n,e.i=i+1&7,n},n(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&(s.x&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xorshift7=u}(0,t,n.amdD)},5601:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var s=0;s<n.length+64;s++)e.x^=0|n.charCodeAt(s),s==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xorwow=u}(0,t,n.amdD)},3191:function(t,e,n){var s;n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),function(i,r){var o,a=this,u=256,c=6,l=52,h="random",p=r.pow(u,c),d=r.pow(2,l),f=2*d,m=u-1;function g(t,e,n){var s=[];e=1==e?{entropy:!0}:e||{};var o=w(v(e.entropy?[t,_(i)]:null==t?x():t,3),s),a=new y(s),l=function(){var t=a.g(c),e=p,n=0;while(t<d)t=(t+n)*u,e*=u,n=a.g(1);while(t>=f)t/=2,e/=2,n>>>=1;return(t+n)/e};return l.int32=function(){return 0|a.g(4)},l.quick=function(){return a.g(4)/4294967296},l.double=l,w(_(a.S),i),(e.pass||n||function(t,e,n,s){return s&&(s.S&&b(s,a),t.state=function(){return b(a,{})}),n?(r[h]=t,e):t})(l,o,"global"in e?e.global:this==r,e.state)}function y(t){var e,n=t.length,s=this,i=0,r=s.i=s.j=0,o=s.S=[];n||(t=[n++]);while(i<u)o[i]=i++;for(i=0;i<u;i++)o[i]=o[r=m&r+t[i%n]+(e=o[i])],o[r]=e;(s.g=function(t){var e,n=0,i=s.i,r=s.j,o=s.S;while(t--)e=o[i=m&i+1],n=n*u+o[m&(o[i]=o[r=m&r+e])+(o[r]=e)];return s.i=i,s.j=r,n})(u)}function b(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){var n,s=[],i=typeof t;if(e&&"object"==i)for(n in t)try{s.push(v(t[n],e-1))}catch(r){}return s.length?s:"string"==i?t:t+"\0"}function w(t,e){var n,s=t+"",i=0;while(i<s.length)e[m&i]=m&(n^=19*e[m&i])+s.charCodeAt(i++);return _(e)}function x(){try{var t;return o&&(t=o.randomBytes)?t=t(u):(t=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(t)),_(t)}catch(s){var e=a.navigator,n=e&&e.plugins;return[+new Date,a,n,a.screen,_(i)]}}function _(t){return String.fromCharCode.apply(0,t)}if(r["seed"+h]=g,w(r.random(),i),t.exports){t.exports=g;try{o=n(1351)}catch(k){}}else s=function(){return g}.call(e,n,e,t),void 0===s||(t.exports=s)}([],Math)},7577:function(t,e,n){var s=n(3998),i=n(8075),r=n(1805),o=n(3085),a=n(9331),u=n(3651),c=n(5963);c.alea=s,c.xor128=i,c.xorwow=r,c.xorshift7=o,c.xor4096=a,c.tychei=u,t.exports=c},3998:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n=c();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new o(t),s=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}function c(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){t+=e.charCodeAt(n);var s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=4294967296*s}return 2.3283064365386963e-10*(t>>>0)};return e}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.alea=u}(0,t,n.amdD)},3651:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,s=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-s|0,s=s<<24^s>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-s|0,e.d=s<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var s=0;s<n.length+20;s++)e.b^=0|n.charCodeAt(s),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.tychei=u}(0,t,n.amdD)},8075:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var s=0;s<n.length+64;s++)e.x^=0|n.charCodeAt(s),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xor128=u}(0,t,n.amdD)},9331:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this;function n(t,e){var n,s,i,r,o,a=[],u=128;for(e===(0|e)?(s=e,e=null):(e+="\0",s=0,u=Math.max(u,e.length)),i=0,r=-32;r<u;++r)e&&(s^=e.charCodeAt((r+32)%e.length)),0===r&&(o=s),s^=s<<10,s^=s>>>15,s^=s<<4,s^=s>>>13,r>=0&&(o=o+1640531527|0,n=a[127&r]^=s+o,i=0==n?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,r=512;r>0;--r)s=a[i+34&127],n=a[i=i+1&127],s^=s<<13,n^=n<<17,s^=s>>>15,n^=n>>>12,a[i]=s^n;t.w=o,t.X=a,t.i=i}e.next=function(){var t,n,s=e.w,i=e.X,r=e.i;return e.w=s=s+1640531527|0,n=i[r+34&127],t=i[r=r+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[r]=n^t,e.i=r,n+(s^s>>>16)|0},n(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&(s.X&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xor4096=u}(0,t,n.amdD)},3085:function(t,e,n){var s;t=n.nmd(t),n(4114),function(t,i,r){function o(t){var e=this;function n(t,e){var n,s=[];if(e===(0|e))s[0]=e;else for(e=""+e,n=0;n<e.length;++n)s[7&n]=s[7&n]<<15^e.charCodeAt(n)+s[n+1&7]<<13;while(s.length<8)s.push(0);for(n=0;n<8&&0===s[n];++n);for(8==n?s[7]=-1:s[n],t.x=s,t.i=0,n=256;n>0;--n)t.next()}e.next=function(){var t,n,s=e.x,i=e.i;return t=s[i],t^=t>>>7,n=t^t<<24,t=s[i+1&7],n^=t^t>>>10,t=s[i+3&7],n^=t^t>>>3,t=s[i+4&7],n^=t^t<<7,t=s[i+7&7],t^=t<<13,n^=t^t<<9,s[i]=n,e.i=i+1&7,n},n(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&(s.x&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xorshift7=u}(0,t,n.amdD)},1805:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var s=0;s<n.length+64;s++)e.x^=0|n.charCodeAt(s),s==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xorwow=u}(0,t,n.amdD)},5963:function(t,e,n){var s;n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),function(i,r){var o,a=this,u=256,c=6,l=52,h="random",p=r.pow(u,c),d=r.pow(2,l),f=2*d,m=u-1;function g(t,e,n){var s=[];e=1==e?{entropy:!0}:e||{};var o=w(v(e.entropy?[t,_(i)]:null==t?x():t,3),s),a=new y(s),l=function(){var t=a.g(c),e=p,n=0;while(t<d)t=(t+n)*u,e*=u,n=a.g(1);while(t>=f)t/=2,e/=2,n>>>=1;return(t+n)/e};return l.int32=function(){return 0|a.g(4)},l.quick=function(){return a.g(4)/4294967296},l.double=l,w(_(a.S),i),(e.pass||n||function(t,e,n,s){return s&&(s.S&&b(s,a),t.state=function(){return b(a,{})}),n?(r[h]=t,e):t})(l,o,"global"in e?e.global:this==r,e.state)}function y(t){var e,n=t.length,s=this,i=0,r=s.i=s.j=0,o=s.S=[];n||(t=[n++]);while(i<u)o[i]=i++;for(i=0;i<u;i++)o[i]=o[r=m&r+t[i%n]+(e=o[i])],o[r]=e;(s.g=function(t){var e,n=0,i=s.i,r=s.j,o=s.S;while(t--)e=o[i=m&i+1],n=n*u+o[m&(o[i]=o[r=m&r+e])+(o[r]=e)];return s.i=i,s.j=r,n})(u)}function b(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){var n,s=[],i=typeof t;if(e&&"object"==i)for(n in t)try{s.push(v(t[n],e-1))}catch(r){}return s.length?s:"string"==i?t:t+"\0"}function w(t,e){var n,s=t+"",i=0;while(i<s.length)e[m&i]=m&(n^=19*e[m&i])+s.charCodeAt(i++);return _(e)}function x(){try{var t;return o&&(t=o.randomBytes)?t=t(u):(t=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(t)),_(t)}catch(s){var e=a.navigator,n=e&&e.plugins;return[+new Date,a,n,a.screen,_(i)]}}function _(t){return String.fromCharCode.apply(0,t)}if(r["seed"+h]=g,w(r.random(),i),t.exports){t.exports=g;try{o=n(3857)}catch(k){}}else s=function(){return g}.call(e,n,e,t),void 0===s||(t.exports=s)}([],Math)},5035:function(t,e,n){"use strict";function s(t,e,n){void 0===n&&(n="ticks");var s=0,i=t.length,r=i;if(i>0&&t[i-1][n]<=e)return i-1;while(s<r){var o=Math.floor(s+(r-s)/2),a=t[o],u=t[o+1];if(a[n]===e){for(var c=o;c<t.length;c++){var l=t[c];l[n]===e&&(o=c)}return o}if(a[n]<e&&u[n]>e)return o;a[n]>e?r=o:a[n]<e&&(s=o+1)}return-1}function i(t,e,n){if(void 0===n&&(n="ticks"),t.length){var i=s(t,e[n],n);t.splice(i+1,0,e)}else t.push(e)}n(4114),Object.defineProperty(e,"__esModule",{value:!0}),e.insert=e.search=void 0,e.search=s,e.insert=i},8073:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ControlChange=e.controlChangeIds=e.controlChangeNames=void 0,e.controlChangeNames={1:"modulationWheel",2:"breath",4:"footController",5:"portamentoTime",7:"volume",8:"balance",10:"pan",64:"sustain",65:"portamentoTime",66:"sostenuto",67:"softPedal",68:"legatoFootswitch",84:"portamentoControl"},e.controlChangeIds=Object.keys(e.controlChangeNames).reduce((function(t,n){return t[e.controlChangeNames[n]]=n,t}),{});var n=new WeakMap,s=new WeakMap,i=function(){function t(t,e){n.set(this,e),s.set(this,t.controllerType),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"number",{get:function(){return s.get(this)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return e.controlChangeNames[this.number]?e.controlChangeNames[this.number]:null},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var t=n.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var e=n.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{number:this.number,ticks:this.ticks,time:this.time,value:this.value}},t}();e.ControlChange=i},4268:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.createControlChanges=void 0;var s=n(8073);function i(){return new Proxy({},{get:function(t,e){return t[e]?t[e]:s.controlChangeIds.hasOwnProperty(e)?t[s.controlChangeIds[e]]:void 0},set:function(t,e,n){return s.controlChangeIds.hasOwnProperty(e)?t[s.controlChangeIds[e]]=n:t[e]=n,!0}})}e.createControlChanges=i},2336:function(t,e,n){"use strict";n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var s=this&&this.__spreadArray||function(t,e,n){if(n||2===arguments.length)for(var s,i=0,r=e.length;i<r;i++)!s&&i in e||(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))};Object.defineProperty(e,"__esModule",{value:!0}),e.encode=void 0;var i=n(8664),r=n(9515),o=n(4618);function a(t,e){return[{absoluteTime:t.ticks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOn",velocity:Math.floor(127*t.velocity)},{absoluteTime:t.ticks+t.durationTicks,channel:e,deltaTime:0,noteNumber:t.midi,type:"noteOff",velocity:Math.floor(127*t.noteOffVelocity)}]}function u(t){return(0,o.flatten)(t.notes.map((function(e){return a(e,t.channel)})))}function c(t,e){return{absoluteTime:t.ticks,channel:e,controllerType:t.number,deltaTime:0,type:"controller",value:Math.floor(127*t.value)}}function l(t){for(var e=[],n=0;n<127;n++)t.controlChanges.hasOwnProperty(n)&&t.controlChanges[n].forEach((function(n){e.push(c(n,t.channel))}));return e}function h(t,e){return{absoluteTime:t.ticks,channel:e,deltaTime:0,type:"pitchBend",value:t.value}}function p(t){var e=[];return t.pitchBends.forEach((function(n){e.push(h(n,t.channel))})),e}function d(t){return{absoluteTime:0,channel:t.channel,deltaTime:0,programNumber:t.instrument.number,type:"programChange"}}function f(t){return{absoluteTime:0,deltaTime:0,meta:!0,text:t,type:"trackName"}}function m(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,microsecondsPerBeat:Math.floor(6e7/t.bpm),type:"setTempo"}}function g(t){return{absoluteTime:t.ticks,deltaTime:0,denominator:t.timeSignature[1],meta:!0,metronome:24,numerator:t.timeSignature[0],thirtyseconds:8,type:"timeSignature"}}function y(t){var e=r.keySignatureKeys.indexOf(t.key);return{absoluteTime:t.ticks,deltaTime:0,key:e+7,meta:!0,scale:"major"===t.scale?0:1,type:"keySignature"}}function b(t){return{absoluteTime:t.ticks,deltaTime:0,meta:!0,text:t.text,type:t.type}}function v(t){var e={header:{format:1,numTracks:t.tracks.length+1,ticksPerBeat:t.header.ppq},tracks:s([s(s(s(s([{absoluteTime:0,deltaTime:0,meta:!0,text:t.header.name,type:"trackName"}],t.header.keySignatures.map((function(t){return y(t)})),!0),t.header.meta.map((function(t){return b(t)})),!0),t.header.tempos.map((function(t){return m(t)})),!0),t.header.timeSignatures.map((function(t){return g(t)})),!0)],t.tracks.map((function(t){return s(s(s([f(t.name),d(t)],u(t),!0),l(t),!0),p(t),!0)})),!0)};return e.tracks=e.tracks.map((function(t){t=t.sort((function(t,e){return t.absoluteTime-e.absoluteTime}));var e=0;return t.forEach((function(t){t.deltaTime=t.absoluteTime-e,e=t.absoluteTime,delete t.absoluteTime})),t.push({deltaTime:0,meta:!0,type:"endOfTrack"}),t})),new Uint8Array((0,i.writeMidi)(e))}e.encode=v},9515:function(t,e,n){"use strict";n(4114),Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.keySignatureKeys=void 0;var s=n(5035),i=new WeakMap;e.keySignatureKeys=["Cb","Gb","Db","Ab","Eb","Bb","F","C","G","D","A","E","B","F#","C#"];var r=function(){function t(t){var n=this;if(this.tempos=[],this.timeSignatures=[],this.keySignatures=[],this.meta=[],this.name="",i.set(this,480),t){i.set(this,t.header.ticksPerBeat),t.tracks.forEach((function(t){t.forEach((function(t){t.meta&&("timeSignature"===t.type?n.timeSignatures.push({ticks:t.absoluteTime,timeSignature:[t.numerator,t.denominator]}):"setTempo"===t.type?n.tempos.push({bpm:6e7/t.microsecondsPerBeat,ticks:t.absoluteTime}):"keySignature"===t.type&&n.keySignatures.push({key:e.keySignatureKeys[t.key+7],scale:0===t.scale?"major":"minor",ticks:t.absoluteTime}))}))}));var s=0;t.tracks[0].forEach((function(t){s+=t.deltaTime,t.meta&&("trackName"===t.type?n.name=t.text:"text"!==t.type&&"cuePoint"!==t.type&&"marker"!==t.type&&"lyrics"!==t.type||n.meta.push({text:t.text,ticks:s,type:t.type}))})),this.update()}}return t.prototype.update=function(){var t=this,e=0,n=0;this.tempos.sort((function(t,e){return t.ticks-e.ticks})),this.tempos.forEach((function(s,i){var r=i>0?t.tempos[i-1].bpm:t.tempos[0].bpm,o=s.ticks/t.ppq-n,a=60/r*o;s.time=a+e,e=s.time,n+=o})),this.timeSignatures.sort((function(t,e){return t.ticks-e.ticks})),this.timeSignatures.forEach((function(e,n){var s=n>0?t.timeSignatures[n-1]:t.timeSignatures[0],i=(e.ticks-s.ticks)/t.ppq,r=i/s.timeSignature[0]/(s.timeSignature[1]/4);s.measures=s.measures||0,e.measures=r+s.measures}))},t.prototype.ticksToSeconds=function(t){var e=(0,s.search)(this.tempos,t);if(-1!==e){var n=this.tempos[e],i=n.time,r=(t-n.ticks)/this.ppq;return i+60/n.bpm*r}var o=t/this.ppq;return.5*o},t.prototype.ticksToMeasures=function(t){var e=(0,s.search)(this.timeSignatures,t);if(-1!==e){var n=this.timeSignatures[e],i=(t-n.ticks)/this.ppq;return n.measures+i/(n.timeSignature[0]/n.timeSignature[1])/4}return t/this.ppq/4},Object.defineProperty(t.prototype,"ppq",{get:function(){return i.get(this)},enumerable:!1,configurable:!0}),t.prototype.secondsToTicks=function(t){var e=(0,s.search)(this.tempos,t,"time");if(-1!==e){var n=this.tempos[e],i=n.time,r=t-i,o=r/(60/n.bpm);return Math.round(n.ticks+o*this.ppq)}var a=t/.5;return Math.round(a*this.ppq)},t.prototype.toJSON=function(){return{keySignatures:this.keySignatures,meta:this.meta,name:this.name,ppq:this.ppq,tempos:this.tempos.map((function(t){return{bpm:t.bpm,ticks:t.ticks}})),timeSignatures:this.timeSignatures}},t.prototype.fromJSON=function(t){this.name=t.name,this.tempos=t.tempos.map((function(t){return Object.assign({},t)})),this.timeSignatures=t.timeSignatures.map((function(t){return Object.assign({},t)})),this.keySignatures=t.keySignatures.map((function(t){return Object.assign({},t)})),this.meta=t.meta.map((function(t){return Object.assign({},t)})),i.set(this,t.ppq),this.update()},t.prototype.setTempo=function(t){this.tempos=[{bpm:t,ticks:0}],this.update()},t}();e.Header=r},1995:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Instrument=void 0;var s=n(4760),i=new WeakMap,r=function(){function t(t,e){if(this.number=0,i.set(this,e),this.number=0,t){var n=t.find((function(t){return"programChange"===t.type}));n&&(this.number=n.programNumber)}}return Object.defineProperty(t.prototype,"name",{get:function(){return this.percussion?s.DrumKitByPatchID[this.number]:s.instrumentByPatchID[this.number]},set:function(t){var e=s.instrumentByPatchID.indexOf(t);-1!==e&&(this.number=e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"family",{get:function(){return this.percussion?"drums":s.InstrumentFamilyByID[Math.floor(this.number/8)]},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"percussion",{get:function(){var t=i.get(this);return 9===t.channel},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{family:this.family,number:this.number,name:this.name}},t.prototype.fromJSON=function(t){this.number=t.number},t}();e.Instrument=r},4760:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.DrumKitByPatchID=e.InstrumentFamilyByID=e.instrumentByPatchID=void 0,e.instrumentByPatchID=["acoustic grand piano","bright acoustic piano","electric grand piano","honky-tonk piano","electric piano 1","electric piano 2","harpsichord","clavi","celesta","glockenspiel","music box","vibraphone","marimba","xylophone","tubular bells","dulcimer","drawbar organ","percussive organ","rock organ","church organ","reed organ","accordion","harmonica","tango accordion","acoustic guitar (nylon)","acoustic guitar (steel)","electric guitar (jazz)","electric guitar (clean)","electric guitar (muted)","overdriven guitar","distortion guitar","guitar harmonics","acoustic bass","electric bass (finger)","electric bass (pick)","fretless bass","slap bass 1","slap bass 2","synth bass 1","synth bass 2","violin","viola","cello","contrabass","tremolo strings","pizzicato strings","orchestral harp","timpani","string ensemble 1","string ensemble 2","synthstrings 1","synthstrings 2","choir aahs","voice oohs","synth voice","orchestra hit","trumpet","trombone","tuba","muted trumpet","french horn","brass section","synthbrass 1","synthbrass 2","soprano sax","alto sax","tenor sax","baritone sax","oboe","english horn","bassoon","clarinet","piccolo","flute","recorder","pan flute","blown bottle","shakuhachi","whistle","ocarina","lead 1 (square)","lead 2 (sawtooth)","lead 3 (calliope)","lead 4 (chiff)","lead 5 (charang)","lead 6 (voice)","lead 7 (fifths)","lead 8 (bass + lead)","pad 1 (new age)","pad 2 (warm)","pad 3 (polysynth)","pad 4 (choir)","pad 5 (bowed)","pad 6 (metallic)","pad 7 (halo)","pad 8 (sweep)","fx 1 (rain)","fx 2 (soundtrack)","fx 3 (crystal)","fx 4 (atmosphere)","fx 5 (brightness)","fx 6 (goblins)","fx 7 (echoes)","fx 8 (sci-fi)","sitar","banjo","shamisen","koto","kalimba","bag pipe","fiddle","shanai","tinkle bell","agogo","steel drums","woodblock","taiko drum","melodic tom","synth drum","reverse cymbal","guitar fret noise","breath noise","seashore","bird tweet","telephone ring","helicopter","applause","gunshot"],e.InstrumentFamilyByID=["piano","chromatic percussion","organ","guitar","bass","strings","ensemble","brass","reed","pipe","synth lead","synth pad","synth effects","world","percussive","sound effects"],e.DrumKitByPatchID={0:"standard kit",8:"room kit",16:"power kit",24:"electronic kit",25:"tr-808 kit",32:"jazz kit",40:"brush kit",48:"orchestra kit",56:"sound fx kit"}},103:function(t,e,n){"use strict";n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var s=this&&this.__awaiter||function(t,e,n,s){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function o(t){try{u(s.next(t))}catch(e){r(e)}}function a(t){try{u(s["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):i(t.value).then(o,a)}u((s=s.apply(t,e||[])).next())}))},i=this&&this.__generator||function(t,e){var n,s,i,r,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return r={next:a(0),throw:a(1),return:a(2)},"function"===typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function a(t){return function(e){return u([t,e])}}function u(r){if(n)throw new TypeError("Generator is already executing.");while(o)try{if(n=1,s&&(i=2&r[0]?s["return"]:r[0]?s["throw"]||((i=s["return"])&&i.call(s),0):s.next)&&!(i=i.call(s,r[1])).done)return i;switch(s=0,i&&(r=[2&r[0],i.value]),r[0]){case 0:case 1:i=r;break;case 4:return o.label++,{value:r[1],done:!1};case 5:o.label++,s=r[1],r=[0];continue;case 7:r=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===r[0]||2===r[0])){o=0;continue}if(3===r[0]&&(!i||r[1]>i[0]&&r[1]<i[3])){o.label=r[1];break}if(6===r[0]&&o.label<i[1]){o.label=i[1],i=r;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(r);break}i[2]&&o.ops.pop(),o.trys.pop();continue}r=e.call(t,o)}catch(a){r=[6,a],s=0}finally{n=i=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}};Object.defineProperty(e,"__esModule",{value:!0}),e.Header=e.Track=e.Midi=void 0;var r=n(8664),o=n(9515),a=n(3615),u=n(2336),c=function(){function t(t){var e=this,n=null;if(t){var s=t instanceof ArrayBuffer?new Uint8Array(t):t;n=(0,r.parseMidi)(s),n.tracks.forEach((function(t){var e=0;t.forEach((function(t){e+=t.deltaTime,t.absoluteTime=e}))})),n.tracks=p(n.tracks)}this.header=new o.Header(n),this.tracks=[],t&&(this.tracks=n.tracks.map((function(t){return new a.Track(t,e.header)})),1===n.header.format&&0===this.tracks[0].duration&&this.tracks.shift())}return t.fromUrl=function(e){return s(this,void 0,void 0,(function(){var n,s;return i(this,(function(i){switch(i.label){case 0:return[4,fetch(e)];case 1:return n=i.sent(),n.ok?[4,n.arrayBuffer()]:[3,3];case 2:return s=i.sent(),[2,new t(s)];case 3:throw new Error("Could not load '".concat(e,"'"))}}))}))},Object.defineProperty(t.prototype,"name",{get:function(){return this.header.name},set:function(t){this.header.name=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=this.tracks.map((function(t){return t.duration}));return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){var t=this.tracks.map((function(t){return t.durationTicks}));return Math.max.apply(Math,t)},enumerable:!1,configurable:!0}),t.prototype.addTrack=function(){var t=new a.Track(void 0,this.header);return this.tracks.push(t),t},t.prototype.toArray=function(){return(0,u.encode)(this)},t.prototype.toJSON=function(){return{header:this.header.toJSON(),tracks:this.tracks.map((function(t){return t.toJSON()}))}},t.prototype.fromJSON=function(t){var e=this;this.header=new o.Header,this.header.fromJSON(t.header),this.tracks=t.tracks.map((function(t){var n=new a.Track(void 0,e.header);return n.fromJSON(t),n}))},t.prototype.clone=function(){var e=new t;return e.fromJSON(this.toJSON()),e},t}();e.Midi=c;var l=n(3615);Object.defineProperty(e,"Track",{enumerable:!0,get:function(){return l.Track}});var h=n(9515);function p(t){for(var e=[],n=0;n<t.length;n++)for(var s=e.length,i=new Map,r=Array(16).fill(0),o=0,a=t[n];o<a.length;o++){var u=a[o],c=s,l=u.channel;if(void 0!==l){"programChange"===u.type&&(r[l]=u.programNumber);var h=r[l],p="".concat(h," ").concat(l);i.has(p)?c=i.get(p):(c=s+i.size,i.set(p,c))}e[c]||e.push([]),e[c].push(u)}return e}Object.defineProperty(e,"Header",{enumerable:!0,get:function(){return h.Header}})},3482:function(t,e){"use strict";function n(t){var e=Math.floor(t/12)-1;return s(t)+e.toString()}function s(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"],n=t%12;return e[n]}function i(t){var e=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];return e.indexOf(t)}Object.defineProperty(e,"__esModule",{value:!0}),e.Note=void 0;var r=function(){var t=/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,e={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13};return function(n){var s=t.exec(n),i=s[1],r=s[2],o=e[i.toLowerCase()];return o+12*(parseInt(r,10)+1)}}(),o=new WeakMap,a=function(){function t(t,e,n){o.set(this,n),this.midi=t.midi,this.velocity=t.velocity,this.noteOffVelocity=e.velocity,this.ticks=t.ticks,this.durationTicks=e.ticks-t.ticks}return Object.defineProperty(t.prototype,"name",{get:function(){return n(this.midi)},set:function(t){this.midi=r(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"octave",{get:function(){return Math.floor(this.midi/12)-1},set:function(t){var e=t-this.octave;this.midi+=12*e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"pitch",{get:function(){return s(this.midi)},set:function(t){this.midi=12*(this.octave+1)+i(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"duration",{get:function(){var t=o.get(this);return t.ticksToSeconds(this.ticks+this.durationTicks)-t.ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this),n=e.secondsToTicks(this.time+t);this.durationTicks=n-this.ticks},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"time",{get:function(){var t=o.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var e=o.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bars",{get:function(){var t=o.get(this);return t.ticksToMeasures(this.ticks)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{duration:this.duration,durationTicks:this.durationTicks,midi:this.midi,name:this.name,ticks:this.ticks,time:this.time,velocity:this.velocity}},t}();e.Note=a},1189:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.PitchBend=void 0;var n=new WeakMap,s=function(){function t(t,e){n.set(this,e),this.ticks=t.absoluteTime,this.value=t.value}return Object.defineProperty(t.prototype,"time",{get:function(){var t=n.get(this);return t.ticksToSeconds(this.ticks)},set:function(t){var e=n.get(this);this.ticks=e.secondsToTicks(t)},enumerable:!1,configurable:!0}),t.prototype.toJSON=function(){return{ticks:this.ticks,time:this.time,value:this.value}},t}();e.PitchBend=s},3615:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Track=void 0;var s=n(5035),i=n(8073),r=n(4268),o=n(1189),a=n(1995),u=n(3482),c=new WeakMap,l=function(){function t(t,e){var n=this;if(this.name="",this.notes=[],this.controlChanges=(0,r.createControlChanges)(),this.pitchBends=[],c.set(this,e),t){var s=t.find((function(t){return"trackName"===t.type}));this.name=s?s.text:""}if(this.instrument=new a.Instrument(t,this),this.channel=0,t){var i=t.filter((function(t){return"noteOn"===t.type})),o=t.filter((function(t){return"noteOff"===t.type})),u=function(){var t=i.shift();l.channel=t.channel;var e=o.findIndex((function(e){return e.noteNumber===t.noteNumber&&e.absoluteTime>=t.absoluteTime}));if(-1!==e){var n=o.splice(e,1)[0];l.addNote({durationTicks:n.absoluteTime-t.absoluteTime,midi:t.noteNumber,noteOffVelocity:n.velocity/127,ticks:t.absoluteTime,velocity:t.velocity/127})}},l=this;while(i.length)u();var h=t.filter((function(t){return"controller"===t.type}));h.forEach((function(t){n.addCC({number:t.controllerType,ticks:t.absoluteTime,value:t.value/127})}));var p=t.filter((function(t){return"pitchBend"===t.type}));p.forEach((function(t){n.addPitchBend({ticks:t.absoluteTime,value:t.value/Math.pow(2,13)})}));var d=t.find((function(t){return"endOfTrack"===t.type}));this.endOfTrackTicks=void 0!==d?d.absoluteTime:void 0}}return t.prototype.addNote=function(t){var e=c.get(this),n=new u.Note({midi:0,ticks:0,velocity:1},{ticks:0,velocity:0},e);return Object.assign(n,t),(0,s.insert)(this.notes,n,"ticks"),this},t.prototype.addCC=function(t){var e=c.get(this),n=new i.ControlChange({controllerType:t.number},e);return delete t.number,Object.assign(n,t),Array.isArray(this.controlChanges[n.number])||(this.controlChanges[n.number]=[]),(0,s.insert)(this.controlChanges[n.number],n,"ticks"),this},t.prototype.addPitchBend=function(t){var e=c.get(this),n=new o.PitchBend({},e);return Object.assign(n,t),(0,s.insert)(this.pitchBends,n,"ticks"),this},Object.defineProperty(t.prototype,"duration",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].time+this.notes[this.notes.length-1].duration,e=0;e<this.notes.length-1;e++){var n=this.notes[e].time+this.notes[e].duration;t<n&&(t=n)}return t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"durationTicks",{get:function(){if(!this.notes.length)return 0;for(var t=this.notes[this.notes.length-1].ticks+this.notes[this.notes.length-1].durationTicks,e=0;e<this.notes.length-1;e++){var n=this.notes[e].ticks+this.notes[e].durationTicks;t<n&&(t=n)}return t},enumerable:!1,configurable:!0}),t.prototype.fromJSON=function(t){var e=this;for(var n in this.name=t.name,this.channel=t.channel,this.instrument=new a.Instrument(void 0,this),this.instrument.fromJSON(t.instrument),void 0!==t.endOfTrackTicks&&(this.endOfTrackTicks=t.endOfTrackTicks),t.controlChanges)t.controlChanges[n]&&t.controlChanges[n].forEach((function(t){e.addCC({number:t.number,ticks:t.ticks,value:t.value})}));t.notes.forEach((function(t){e.addNote({durationTicks:t.durationTicks,midi:t.midi,ticks:t.ticks,velocity:t.velocity})}))},t.prototype.toJSON=function(){for(var t={},e=0;e<127;e++)this.controlChanges.hasOwnProperty(e)&&(t[e]=this.controlChanges[e].map((function(t){return t.toJSON()})));var n={channel:this.channel,controlChanges:t,pitchBends:this.pitchBends.map((function(t){return t.toJSON()})),instrument:this.instrument.toJSON(),name:this.name,notes:this.notes.map((function(t){return t.toJSON()}))};return void 0!==this.endOfTrackTicks&&(n.endOfTrackTicks=this.endOfTrackTicks),n},t}();e.Track=l},4618:function(t,e,n){"use strict";n.r(e),n.d(e,{flatten:function(){return s}});n(4114);function s(t){var e=[];return i(t,e),e}function i(t,e){for(var n=0;n<t.length;n++){var s=t[n];Array.isArray(s)?i(s,e):e.push(s)}}},144:function(t,e,n){"use strict";n.d(e,{C4:function(){return y},EW:function(){return Ct},Gc:function(){return mt},IG:function(){return kt},IJ:function(){return $t},KR:function(){return Ot},Kh:function(){return ft},Pr:function(){return Ft},R1:function(){return Mt},X2:function(){return c},bl:function(){return b},fE:function(){return wt},g8:function(){return bt},hZ:function(){return N},i9:function(){return Et},ju:function(){return xt},o5:function(){return u},u4:function(){return A},ux:function(){return _t},yC:function(){return o}});n(4114);var s=n(4232);let i,r;class o{constructor(t=!1){this.detached=t,this._active=!0,this.effects=[],this.cleanups=[],this.parent=i,!t&&i&&(this.index=(i.scopes||(i.scopes=[])).push(this)-1)}get active(){return this._active}run(t){if(this._active){const e=i;try{return i=this,t()}finally{i=e}}else 0}on(){i=this}off(){i=this.parent}stop(t){if(this._active){let e,n;for(e=0,n=this.effects.length;e<n;e++)this.effects[e].stop();for(e=0,n=this.cleanups.length;e<n;e++)this.cleanups[e]();if(this.scopes)for(e=0,n=this.scopes.length;e<n;e++)this.scopes[e].stop(!0);if(!this.detached&&this.parent&&!t){const t=this.parent.scopes.pop();t&&t!==this&&(this.parent.scopes[this.index]=t,t.index=this.index)}this.parent=void 0,this._active=!1}}}function a(t,e=i){e&&e.active&&e.effects.push(t)}function u(){return i}class c{constructor(t,e,n,s){this.fn=t,this.trigger=e,this.scheduler=n,this.active=!0,this.deps=[],this._dirtyLevel=4,this._trackId=0,this._runnings=0,this._shouldSchedule=!1,this._depsLength=0,a(this,s)}get dirty(){if(2===this._dirtyLevel||3===this._dirtyLevel){this._dirtyLevel=1,y();for(let t=0;t<this._depsLength;t++){const e=this.deps[t];if(e.computed&&(l(e.computed),this._dirtyLevel>=4))break}1===this._dirtyLevel&&(this._dirtyLevel=0),b()}return this._dirtyLevel>=4}set dirty(t){this._dirtyLevel=t?4:0}run(){if(this._dirtyLevel=0,!this.active)return this.fn();let t=f,e=r;try{return f=!0,r=this,this._runnings++,h(this),this.fn()}finally{p(this),this._runnings--,r=e,f=t}}stop(){var t;this.active&&(h(this),p(this),null==(t=this.onStop)||t.call(this),this.active=!1)}}function l(t){return t.value}function h(t){t._trackId++,t._depsLength=0}function p(t){if(t.deps.length>t._depsLength){for(let e=t._depsLength;e<t.deps.length;e++)d(t.deps[e],t);t.deps.length=t._depsLength}}function d(t,e){const n=t.get(e);void 0!==n&&e._trackId!==n&&(t.delete(e),0===t.size&&t.cleanup())}let f=!0,m=0;const g=[];function y(){g.push(f),f=!1}function b(){const t=g.pop();f=void 0===t||t}function v(){m++}function w(){m--;while(!m&&_.length)_.shift()()}function x(t,e,n){if(e.get(t)!==t._trackId){e.set(t,t._trackId);const n=t.deps[t._depsLength];n!==e?(n&&d(n,t),t.deps[t._depsLength++]=e):t._depsLength++}}const _=[];function k(t,e,n){v();for(const s of t.keys()){let n;s._dirtyLevel<e&&(null!=n?n:n=t.get(s)===s._trackId)&&(s._shouldSchedule||(s._shouldSchedule=0===s._dirtyLevel),s._dirtyLevel=e),s._shouldSchedule&&(null!=n?n:n=t.get(s)===s._trackId)&&(s.trigger(),s._runnings&&!s.allowRecurse||2===s._dirtyLevel||(s._shouldSchedule=!1,s.scheduler&&_.push(s.scheduler)))}w()}const S=(t,e)=>{const n=new Map;return n.cleanup=t,n.computed=e,n},T=new WeakMap,I=Symbol(""),C=Symbol("");function A(t,e,n){if(f&&r){let e=T.get(t);e||T.set(t,e=new Map);let s=e.get(n);s||e.set(n,s=S((()=>e.delete(n)))),x(r,s,void 0)}}function N(t,e,n,i,r,o){const a=T.get(t);if(!a)return;let u=[];if("clear"===e)u=[...a.values()];else if("length"===n&&(0,s.cy)(t)){const t=Number(i);a.forEach(((e,n)=>{("length"===n||!(0,s.Bm)(n)&&n>=t)&&u.push(e)}))}else switch(void 0!==n&&u.push(a.get(n)),e){case"add":(0,s.cy)(t)?(0,s.yI)(n)&&u.push(a.get("length")):(u.push(a.get(I)),(0,s.CE)(t)&&u.push(a.get(C)));break;case"delete":(0,s.cy)(t)||(u.push(a.get(I)),(0,s.CE)(t)&&u.push(a.get(C)));break;case"set":(0,s.CE)(t)&&u.push(a.get(I));break}v();for(const s of u)s&&k(s,4,void 0);w()}const E=(0,s.pD)("__proto__,__v_isRef,__isVue"),O=new Set(Object.getOwnPropertyNames(Symbol).filter((t=>"arguments"!==t&&"caller"!==t)).map((t=>Symbol[t])).filter(s.Bm)),$=R();function R(){const t={};return["includes","indexOf","lastIndexOf"].forEach((e=>{t[e]=function(...t){const n=_t(this);for(let e=0,i=this.length;e<i;e++)A(n,"get",e+"");const s=n[e](...t);return-1===s||!1===s?n[e](...t.map(_t)):s}})),["push","pop","shift","unshift","splice"].forEach((e=>{t[e]=function(...t){y(),v();const n=_t(this)[e].apply(this,t);return w(),b(),n}})),t}function D(t){const e=_t(this);return A(e,"has",t),e.hasOwnProperty(t)}class M{constructor(t=!1,e=!1){this._isReadonly=t,this._isShallow=e}get(t,e,n){const i=this._isReadonly,r=this._isShallow;if("__v_isReactive"===e)return!i;if("__v_isReadonly"===e)return i;if("__v_isShallow"===e)return r;if("__v_raw"===e)return n===(i?r?ht:lt:r?ct:ut).get(t)||Object.getPrototypeOf(t)===Object.getPrototypeOf(n)?t:void 0;const o=(0,s.cy)(t);if(!i){if(o&&(0,s.$3)($,e))return Reflect.get($,e,n);if("hasOwnProperty"===e)return D}const a=Reflect.get(t,e,n);return((0,s.Bm)(e)?O.has(e):E(e))?a:(i||A(t,"get",e),r?a:Et(a)?o&&(0,s.yI)(e)?a:a.value:(0,s.Gv)(a)?i?gt(a):ft(a):a)}}class P extends M{constructor(t=!1){super(!1,t)}set(t,e,n,i){let r=t[e];if(!this._isShallow){const e=vt(r);if(wt(n)||vt(n)||(r=_t(r),n=_t(n)),!(0,s.cy)(t)&&Et(r)&&!Et(n))return!e&&(r.value=n,!0)}const o=(0,s.cy)(t)&&(0,s.yI)(e)?Number(e)<t.length:(0,s.$3)(t,e),a=Reflect.set(t,e,n,i);return t===_t(i)&&(o?(0,s.$H)(n,r)&&N(t,"set",e,n,r):N(t,"add",e,n)),a}deleteProperty(t,e){const n=(0,s.$3)(t,e),i=t[e],r=Reflect.deleteProperty(t,e);return r&&n&&N(t,"delete",e,void 0,i),r}has(t,e){const n=Reflect.has(t,e);return(0,s.Bm)(e)&&O.has(e)||A(t,"has",e),n}ownKeys(t){return A(t,"iterate",(0,s.cy)(t)?"length":I),Reflect.ownKeys(t)}}class F extends M{constructor(t=!1){super(!0,t)}set(t,e){return!0}deleteProperty(t,e){return!0}}const L=new P,z=new F,B=new P(!0),q=t=>t,V=t=>Reflect.getPrototypeOf(t);function W(t,e,n=!1,i=!1){t=t["__v_raw"];const r=_t(t),o=_t(e);n||((0,s.$H)(e,o)&&A(r,"get",e),A(r,"get",o));const{has:a}=V(r),u=i?q:n?Tt:St;return a.call(r,e)?u(t.get(e)):a.call(r,o)?u(t.get(o)):void(t!==r&&t.get(e))}function j(t,e=!1){const n=this["__v_raw"],i=_t(n),r=_t(t);return e||((0,s.$H)(t,r)&&A(i,"has",t),A(i,"has",r)),t===r?n.has(t):n.has(t)||n.has(r)}function U(t,e=!1){return t=t["__v_raw"],!e&&A(_t(t),"iterate",I),Reflect.get(t,"size",t)}function G(t){t=_t(t);const e=_t(this),n=V(e),s=n.has.call(e,t);return s||(e.add(t),N(e,"add",t,t)),this}function H(t,e){e=_t(e);const n=_t(this),{has:i,get:r}=V(n);let o=i.call(n,t);o||(t=_t(t),o=i.call(n,t));const a=r.call(n,t);return n.set(t,e),o?(0,s.$H)(e,a)&&N(n,"set",t,e,a):N(n,"add",t,e),this}function K(t){const e=_t(this),{has:n,get:s}=V(e);let i=n.call(e,t);i||(t=_t(t),i=n.call(e,t));const r=s?s.call(e,t):void 0,o=e.delete(t);return i&&N(e,"delete",t,void 0,r),o}function X(){const t=_t(this),e=0!==t.size,n=void 0,s=t.clear();return e&&N(t,"clear",void 0,void 0,n),s}function Q(t,e){return function(n,s){const i=this,r=i["__v_raw"],o=_t(r),a=e?q:t?Tt:St;return!t&&A(o,"iterate",I),r.forEach(((t,e)=>n.call(s,a(t),a(e),i)))}}function Y(t,e,n){return function(...i){const r=this["__v_raw"],o=_t(r),a=(0,s.CE)(o),u="entries"===t||t===Symbol.iterator&&a,c="keys"===t&&a,l=r[t](...i),h=n?q:e?Tt:St;return!e&&A(o,"iterate",c?C:I),{next(){const{value:t,done:e}=l.next();return e?{value:t,done:e}:{value:u?[h(t[0]),h(t[1])]:h(t),done:e}},[Symbol.iterator](){return this}}}}function Z(t){return function(...e){return"delete"!==t&&("clear"===t?void 0:this)}}function J(){const t={get(t){return W(this,t)},get size(){return U(this)},has:j,add:G,set:H,delete:K,clear:X,forEach:Q(!1,!1)},e={get(t){return W(this,t,!1,!0)},get size(){return U(this)},has:j,add:G,set:H,delete:K,clear:X,forEach:Q(!1,!0)},n={get(t){return W(this,t,!0)},get size(){return U(this,!0)},has(t){return j.call(this,t,!0)},add:Z("add"),set:Z("set"),delete:Z("delete"),clear:Z("clear"),forEach:Q(!0,!1)},s={get(t){return W(this,t,!0,!0)},get size(){return U(this,!0)},has(t){return j.call(this,t,!0)},add:Z("add"),set:Z("set"),delete:Z("delete"),clear:Z("clear"),forEach:Q(!0,!0)},i=["keys","values","entries",Symbol.iterator];return i.forEach((i=>{t[i]=Y(i,!1,!1),n[i]=Y(i,!0,!1),e[i]=Y(i,!1,!0),s[i]=Y(i,!0,!0)})),[t,n,e,s]}const[tt,et,nt,st]=J();function it(t,e){const n=e?t?st:nt:t?et:tt;return(e,i,r)=>"__v_isReactive"===i?!t:"__v_isReadonly"===i?t:"__v_raw"===i?e:Reflect.get((0,s.$3)(n,i)&&i in e?n:e,i,r)}const rt={get:it(!1,!1)},ot={get:it(!1,!0)},at={get:it(!0,!1)};const ut=new WeakMap,ct=new WeakMap,lt=new WeakMap,ht=new WeakMap;function pt(t){switch(t){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function dt(t){return t["__v_skip"]||!Object.isExtensible(t)?0:pt((0,s.Zf)(t))}function ft(t){return vt(t)?t:yt(t,!1,L,rt,ut)}function mt(t){return yt(t,!1,B,ot,ct)}function gt(t){return yt(t,!0,z,at,lt)}function yt(t,e,n,i,r){if(!(0,s.Gv)(t))return t;if(t["__v_raw"]&&(!e||!t["__v_isReactive"]))return t;const o=r.get(t);if(o)return o;const a=dt(t);if(0===a)return t;const u=new Proxy(t,2===a?i:n);return r.set(t,u),u}function bt(t){return vt(t)?bt(t["__v_raw"]):!(!t||!t["__v_isReactive"])}function vt(t){return!(!t||!t["__v_isReadonly"])}function wt(t){return!(!t||!t["__v_isShallow"])}function xt(t){return bt(t)||vt(t)}function _t(t){const e=t&&t["__v_raw"];return e?_t(e):t}function kt(t){return Object.isExtensible(t)&&(0,s.yQ)(t,"__v_skip",!0),t}const St=t=>(0,s.Gv)(t)?ft(t):t,Tt=t=>(0,s.Gv)(t)?gt(t):t;class It{constructor(t,e,n,s){this.getter=t,this._setter=e,this.dep=void 0,this.__v_isRef=!0,this["__v_isReadonly"]=!1,this.effect=new c((()=>t(this._value)),(()=>Nt(this,2===this.effect._dirtyLevel?2:3))),this.effect.computed=this,this.effect.active=this._cacheable=!s,this["__v_isReadonly"]=n}get value(){const t=_t(this);return t._cacheable&&!t.effect.dirty||!(0,s.$H)(t._value,t._value=t.effect.run())||Nt(t,4),At(t),t.effect._dirtyLevel>=2&&Nt(t,2),t._value}set value(t){this._setter(t)}get _dirty(){return this.effect.dirty}set _dirty(t){this.effect.dirty=t}}function Ct(t,e,n=!1){let i,r;const o=(0,s.Tn)(t);o?(i=t,r=s.tE):(i=t.get,r=t.set);const a=new It(i,r,o||!r,n);return a}function At(t){var e;f&&r&&(t=_t(t),x(r,null!=(e=t.dep)?e:t.dep=S((()=>t.dep=void 0),t instanceof It?t:void 0),void 0))}function Nt(t,e=4,n){t=_t(t);const s=t.dep;s&&k(s,e,void 0)}function Et(t){return!(!t||!0!==t.__v_isRef)}function Ot(t){return Rt(t,!1)}function $t(t){return Rt(t,!0)}function Rt(t,e){return Et(t)?t:new Dt(t,e)}class Dt{constructor(t,e){this.__v_isShallow=e,this.dep=void 0,this.__v_isRef=!0,this._rawValue=e?t:_t(t),this._value=e?t:St(t)}get value(){return At(this),this._value}set value(t){const e=this.__v_isShallow||wt(t)||vt(t);t=e?t:_t(t),(0,s.$H)(t,this._rawValue)&&(this._rawValue=t,this._value=e?t:St(t),Nt(this,4,t))}}function Mt(t){return Et(t)?t.value:t}const Pt={get:(t,e,n)=>Mt(Reflect.get(t,e,n)),set:(t,e,n,s)=>{const i=t[e];return Et(i)&&!Et(n)?(i.value=n,!0):Reflect.set(t,e,n,s)}};function Ft(t){return bt(t)?t:new Proxy(t,Pt)}},6768:function(t,e,n){"use strict";n.d(e,{$u:function(){return Dt},CE:function(){return tn},Df:function(){return bt},EW:function(){return Wn},FK:function(){return We},Fv:function(){return fn},Gt:function(){return de},Gy:function(){return ut},K9:function(){return De},Lk:function(){return un},MZ:function(){return yt},OW:function(){return ft},Q3:function(){return mn},QP:function(){return lt},Qi:function(){return M},RG:function(){return qt},WQ:function(){return fe},Wv:function(){return en},bF:function(){return cn},dY:function(){return b},eW:function(){return dn},g2:function(){return U},h:function(){return jn},jt:function(){return P},k6:function(){return F},nI:function(){return Tn},pM:function(){return vt},pR:function(){return pt},qL:function(){return o},uX:function(){return Xe},wB:function(){return tt}});n(4114);var s=n(144),i=n(4232);function r(t,e,n,s){try{return s?t(...s):t()}catch(i){a(i,e,n)}}function o(t,e,n,s){if((0,i.Tn)(t)){const o=r(t,e,n,s);return o&&(0,i.yL)(o)&&o.catch((t=>{a(t,e,n)})),o}const u=[];for(let i=0;i<t.length;i++)u.push(o(t[i],e,n,s));return u}function a(t,e,n,s=!0){const i=e?e.vnode:null;if(e){let s=e.parent;const i=e.proxy,o=`https://vuejs.org/error-reference/#runtime-${n}`;while(s){const e=s.ec;if(e)for(let n=0;n<e.length;n++)if(!1===e[n](t,i,o))return;s=s.parent}const a=e.appContext.config.errorHandler;if(a)return void r(a,null,10,[t,i,o])}u(t,n,i,s)}function u(t,e,n,s=!0){console.error(t)}let c=!1,l=!1;const h=[];let p=0;const d=[];let f=null,m=0;const g=Promise.resolve();let y=null;function b(t){const e=y||g;return t?e.then(this?t.bind(this):t):e}function v(t){let e=p+1,n=h.length;while(e<n){const s=e+n>>>1,i=h[s],r=I(i);r<t||r===t&&i.pre?e=s+1:n=s}return e}function w(t){h.length&&h.includes(t,c&&t.allowRecurse?p+1:p)||(null==t.id?h.push(t):h.splice(v(t.id),0,t),x())}function x(){c||l||(l=!0,y=g.then(A))}function _(t){const e=h.indexOf(t);e>p&&h.splice(e,1)}function k(t){(0,i.cy)(t)?d.push(...t):f&&f.includes(t,t.allowRecurse?m+1:m)||d.push(t),x()}function S(t,e,n=(c?p+1:0)){for(0;n<h.length;n++){const e=h[n];if(e&&e.pre){if(t&&e.id!==t.uid)continue;0,h.splice(n,1),n--,e()}}}function T(t){if(d.length){const t=[...new Set(d)].sort(((t,e)=>I(t)-I(e)));if(d.length=0,f)return void f.push(...t);for(f=t,m=0;m<f.length;m++)f[m]();f=null,m=0}}const I=t=>null==t.id?1/0:t.id,C=(t,e)=>{const n=I(t)-I(e);if(0===n){if(t.pre&&!e.pre)return-1;if(e.pre&&!t.pre)return 1}return n};function A(t){l=!1,c=!0,h.sort(C);i.tE;try{for(p=0;p<h.length;p++){const t=h[p];t&&!1!==t.active&&r(t,null,14)}}finally{p=0,h.length=0,T(t),c=!1,y=null,(h.length||d.length)&&A(t)}}function N(t,e,...n){if(t.isUnmounted)return;const s=t.vnode.props||i.MZ;let r=n;const a=e.startsWith("update:"),u=a&&e.slice(7);if(u&&u in s){const t=`${"modelValue"===u?"model":u}Modifiers`,{number:e,trim:o}=s[t]||i.MZ;o&&(r=n.map((t=>(0,i.Kg)(t)?t.trim():t))),e&&(r=n.map(i.bB))}let c;let l=s[c=(0,i.rU)(e)]||s[c=(0,i.rU)((0,i.PT)(e))];!l&&a&&(l=s[c=(0,i.rU)((0,i.Tg)(e))]),l&&o(l,t,6,r);const h=s[c+"Once"];if(h){if(t.emitted){if(t.emitted[c])return}else t.emitted={};t.emitted[c]=!0,o(h,t,6,r)}}function E(t,e,n=!1){const s=e.emitsCache,r=s.get(t);if(void 0!==r)return r;const o=t.emits;let a={},u=!1;if(!(0,i.Tn)(t)){const s=t=>{const n=E(t,e,!0);n&&(u=!0,(0,i.X$)(a,n))};!n&&e.mixins.length&&e.mixins.forEach(s),t.extends&&s(t.extends),t.mixins&&t.mixins.forEach(s)}return o||u?((0,i.cy)(o)?o.forEach((t=>a[t]=null)):(0,i.X$)(a,o),(0,i.Gv)(t)&&s.set(t,a),a):((0,i.Gv)(t)&&s.set(t,null),null)}function O(t,e){return!(!t||!(0,i.Mp)(e))&&(e=e.slice(2).replace(/Once$/,""),(0,i.$3)(t,e[0].toLowerCase()+e.slice(1))||(0,i.$3)(t,(0,i.Tg)(e))||(0,i.$3)(t,e))}let $=null,R=null;function D(t){const e=$;return $=t,R=t&&t.type.__scopeId||null,e}function M(t){R=t}function P(){R=null}function F(t,e=$,n){if(!e)return t;if(t._n)return t;const s=(...n)=>{s._d&&Ze(-1);const i=D(e);let r;try{r=t(...n)}finally{D(i),s._d&&Ze(1)}return r};return s._n=!0,s._c=!0,s._d=!0,s}function L(t){const{type:e,vnode:n,proxy:s,withProxy:r,props:o,propsOptions:[u],slots:c,attrs:l,emit:h,render:p,renderCache:d,data:f,setupState:m,ctx:g,inheritAttrs:y}=t;let b,v;const w=D(t);try{if(4&n.shapeFlag){const t=r||s,e=t;b=gn(p.call(e,t,d,o,m,f,g)),v=l}else{const t=e;0,b=gn(t.length>1?t(o,{attrs:l,slots:c,emit:h}):t(o,null)),v=e.props?l:z(l)}}catch(_){He.length=0,a(_,t,1),b=cn(Ue)}let x=b;if(v&&!1!==y){const t=Object.keys(v),{shapeFlag:e}=x;t.length&&7&e&&(u&&t.some(i.CP)&&(v=B(v,u)),x=pn(x,v))}return n.dirs&&(x=pn(x),x.dirs=x.dirs?x.dirs.concat(n.dirs):n.dirs),n.transition&&(x.transition=n.transition),b=x,D(w),b}const z=t=>{let e;for(const n in t)("class"===n||"style"===n||(0,i.Mp)(n))&&((e||(e={}))[n]=t[n]);return e},B=(t,e)=>{const n={};for(const s in t)(0,i.CP)(s)&&s.slice(9)in e||(n[s]=t[s]);return n};function q(t,e,n){const{props:s,children:i,component:r}=t,{props:o,children:a,patchFlag:u}=e,c=r.emitsOptions;if(e.dirs||e.transition)return!0;if(!(n&&u>=0))return!(!i&&!a||a&&a.$stable)||s!==o&&(s?!o||V(s,o,c):!!o);if(1024&u)return!0;if(16&u)return s?V(s,o,c):!!o;if(8&u){const t=e.dynamicProps;for(let e=0;e<t.length;e++){const n=t[e];if(o[n]!==s[n]&&!O(c,n))return!0}}return!1}function V(t,e,n){const s=Object.keys(e);if(s.length!==Object.keys(t).length)return!0;for(let i=0;i<s.length;i++){const r=s[i];if(e[r]!==t[r]&&!O(n,r))return!0}return!1}function W({vnode:t,parent:e},n){while(e){const s=e.subTree;if(s.suspense&&s.suspense.activeBranch===t&&(s.el=t.el),s!==t)break;(t=e.vnode).el=n,e=e.parent}}const j="components";function U(t,e){return H(j,t,!0,e)||t}const G=Symbol.for("v-ndc");function H(t,e,n=!0,s=!1){const r=$||Sn;if(r){const n=r.type;if(t===j){const t=qn(n,!1);if(t&&(t===e||t===(0,i.PT)(e)||t===(0,i.ZH)((0,i.PT)(e))))return n}const o=K(r[t]||n[t],e)||K(r.appContext[t],e);return!o&&s?n:o}}function K(t,e){return t&&(t[e]||t[(0,i.PT)(e)]||t[(0,i.ZH)((0,i.PT)(e))])}const X=t=>t.__isSuspense;function Q(t,e){e&&e.pendingBranch?(0,i.cy)(t)?e.effects.push(...t):e.effects.push(t):k(t)}const Y=Symbol.for("v-scx"),Z=()=>{{const t=fe(Y);return t}};const J={};function tt(t,e,n){return et(t,e,n)}function et(t,e,{immediate:n,deep:a,flush:u,once:c,onTrack:l,onTrigger:h}=i.MZ){if(e&&c){const t=e;e=(...e)=>{t(...e),I()}}const p=Sn,d=t=>!0===a?t:it(t,!1===a?1:void 0);let f,m,g=!1,y=!1;if((0,s.i9)(t)?(f=()=>t.value,g=(0,s.fE)(t)):(0,s.g8)(t)?(f=()=>d(t),g=!0):(0,i.cy)(t)?(y=!0,g=t.some((t=>(0,s.g8)(t)||(0,s.fE)(t))),f=()=>t.map((t=>(0,s.i9)(t)?t.value:(0,s.g8)(t)?d(t):(0,i.Tn)(t)?r(t,p,2):void 0))):f=(0,i.Tn)(t)?e?()=>r(t,p,2):()=>(m&&m(),o(t,p,3,[v])):i.tE,e&&a){const t=f;f=()=>it(t())}let b,v=t=>{m=S.onStop=()=>{r(t,p,4),m=S.onStop=void 0}};if(Rn){if(v=i.tE,e?n&&o(e,p,3,[f(),y?[]:void 0,v]):f(),"sync"!==u)return i.tE;{const t=Z();b=t.__watcherHandles||(t.__watcherHandles=[])}}let x=y?new Array(t.length).fill(J):J;const _=()=>{if(S.active&&S.dirty)if(e){const t=S.run();(a||g||(y?t.some(((t,e)=>(0,i.$H)(t,x[e]))):(0,i.$H)(t,x)))&&(m&&m(),o(e,p,3,[t,x===J?void 0:y&&x[0]===J?[]:x,v]),x=t)}else S.run()};let k;_.allowRecurse=!!e,"sync"===u?k=_:"post"===u?k=()=>Re(_,p&&p.suspense):(_.pre=!0,p&&(_.id=p.uid),k=()=>w(_));const S=new s.X2(f,i.tE,k),T=(0,s.o5)(),I=()=>{S.stop(),T&&(0,i.TF)(T.effects,S)};return e?n?_():x=S.run():"post"===u?Re(S.run.bind(S),p&&p.suspense):S.run(),b&&b.push(I),I}function nt(t,e,n){const s=this.proxy,r=(0,i.Kg)(t)?t.includes(".")?st(s,t):()=>s[t]:t.bind(s,s);let o;(0,i.Tn)(e)?o=e:(o=e.handler,n=e);const a=An(this),u=et(r,o.bind(s),n);return a(),u}function st(t,e){const n=e.split(".");return()=>{let e=t;for(let t=0;t<n.length&&e;t++)e=e[n[t]];return e}}function it(t,e,n=0,r){if(!(0,i.Gv)(t)||t["__v_skip"])return t;if(e&&e>0){if(n>=e)return t;n++}if(r=r||new Set,r.has(t))return t;if(r.add(t),(0,s.i9)(t))it(t.value,e,n,r);else if((0,i.cy)(t))for(let s=0;s<t.length;s++)it(t[s],e,n,r);else if((0,i.vM)(t)||(0,i.CE)(t))t.forEach((t=>{it(t,e,n,r)}));else if((0,i.Qd)(t))for(const s in t)it(t[s],e,n,r);return t}function rt(t,e,n,i){const r=t.dirs,a=e&&e.dirs;for(let u=0;u<r.length;u++){const c=r[u];a&&(c.oldValue=a[u].value);let l=c.dir[i];l&&((0,s.C4)(),o(l,n,8,[t.el,c,t,e]),(0,s.bl)())}}const ot=Symbol("_leaveCb"),at=Symbol("_enterCb");function ut(){const t={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return $t((()=>{t.isMounted=!0})),Mt((()=>{t.isUnmounting=!0})),t}const ct=[Function,Array],lt={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:ct,onEnter:ct,onAfterEnter:ct,onEnterCancelled:ct,onBeforeLeave:ct,onLeave:ct,onAfterLeave:ct,onLeaveCancelled:ct,onBeforeAppear:ct,onAppear:ct,onAfterAppear:ct,onAppearCancelled:ct},ht={name:"BaseTransition",props:lt,setup(t,{slots:e}){const n=Tn(),i=ut();return()=>{const r=e.default&&bt(e.default(),!0);if(!r||!r.length)return;let o=r[0];if(r.length>1){let t=!1;for(const e of r)if(e.type!==Ue){0,o=e,t=!0;break}}const a=(0,s.ux)(t),{mode:u}=a;if(i.isLeaving)return mt(o);const c=gt(o);if(!c)return mt(o);const l=ft(c,a,i,n);yt(c,l);const h=n.subTree,p=h&&gt(h);if(p&&p.type!==Ue&&!sn(c,p)){const t=ft(p,a,i,n);if(yt(p,t),"out-in"===u)return i.isLeaving=!0,t.afterLeave=()=>{i.isLeaving=!1,!1!==n.update.active&&(n.effect.dirty=!0,n.update())},mt(o);"in-out"===u&&c.type!==Ue&&(t.delayLeave=(t,e,n)=>{const s=dt(i,p);s[String(p.key)]=p,t[ot]=()=>{e(),t[ot]=void 0,delete l.delayedLeave},l.delayedLeave=n})}return o}}},pt=ht;function dt(t,e){const{leavingVNodes:n}=t;let s=n.get(e.type);return s||(s=Object.create(null),n.set(e.type,s)),s}function ft(t,e,n,s){const{appear:r,mode:a,persisted:u=!1,onBeforeEnter:c,onEnter:l,onAfterEnter:h,onEnterCancelled:p,onBeforeLeave:d,onLeave:f,onAfterLeave:m,onLeaveCancelled:g,onBeforeAppear:y,onAppear:b,onAfterAppear:v,onAppearCancelled:w}=e,x=String(t.key),_=dt(n,t),k=(t,e)=>{t&&o(t,s,9,e)},S=(t,e)=>{const n=e[1];k(t,e),(0,i.cy)(t)?t.every((t=>t.length<=1))&&n():t.length<=1&&n()},T={mode:a,persisted:u,beforeEnter(e){let s=c;if(!n.isMounted){if(!r)return;s=y||c}e[ot]&&e[ot](!0);const i=_[x];i&&sn(t,i)&&i.el[ot]&&i.el[ot](),k(s,[e])},enter(t){let e=l,s=h,i=p;if(!n.isMounted){if(!r)return;e=b||l,s=v||h,i=w||p}let o=!1;const a=t[at]=e=>{o||(o=!0,k(e?i:s,[t]),T.delayedLeave&&T.delayedLeave(),t[at]=void 0)};e?S(e,[t,a]):a()},leave(e,s){const i=String(t.key);if(e[at]&&e[at](!0),n.isUnmounting)return s();k(d,[e]);let r=!1;const o=e[ot]=n=>{r||(r=!0,s(),k(n?g:m,[e]),e[ot]=void 0,_[i]===t&&delete _[i])};_[i]=t,f?S(f,[e,o]):o()},clone(t){return ft(t,e,n,s)}};return T}function mt(t){if(xt(t))return t=pn(t),t.children=null,t}function gt(t){return xt(t)?t.children?t.children[0]:void 0:t}function yt(t,e){6&t.shapeFlag&&t.component?yt(t.component.subTree,e):128&t.shapeFlag?(t.ssContent.transition=e.clone(t.ssContent),t.ssFallback.transition=e.clone(t.ssFallback)):t.transition=e}function bt(t,e=!1,n){let s=[],i=0;for(let r=0;r<t.length;r++){let o=t[r];const a=null==n?o.key:String(n)+String(null!=o.key?o.key:r);o.type===We?(128&o.patchFlag&&i++,s=s.concat(bt(o.children,e,a))):(e||o.type!==Ue)&&s.push(null!=a?pn(o,{key:a}):o)}if(i>1)for(let r=0;r<s.length;r++)s[r].patchFlag=-2;return s}
/*! #__NO_SIDE_EFFECTS__ */function vt(t,e){return(0,i.Tn)(t)?(()=>(0,i.X$)({name:t.name},e,{setup:t}))():t}const wt=t=>!!t.type.__asyncLoader
/*! #__NO_SIDE_EFFECTS__ */;const xt=t=>t.type.__isKeepAlive;RegExp,RegExp;function _t(t,e){return(0,i.cy)(t)?t.some((t=>_t(t,e))):(0,i.Kg)(t)?t.split(",").includes(e):!!(0,i.gd)(t)&&t.test(e)}function kt(t,e){Tt(t,"a",e)}function St(t,e){Tt(t,"da",e)}function Tt(t,e,n=Sn){const s=t.__wdc||(t.__wdc=()=>{let e=n;while(e){if(e.isDeactivated)return;e=e.parent}return t()});if(Nt(e,s,n),n){let t=n.parent;while(t&&t.parent)xt(t.parent.vnode)&&It(s,e,n,t),t=t.parent}}function It(t,e,n,s){const r=Nt(e,t,s,!0);Pt((()=>{(0,i.TF)(s[e],r)}),n)}function Ct(t){t.shapeFlag&=-257,t.shapeFlag&=-513}function At(t){return 128&t.shapeFlag?t.ssContent:t}function Nt(t,e,n=Sn,i=!1){if(n){const r=n[t]||(n[t]=[]),a=e.__weh||(e.__weh=(...i)=>{if(n.isUnmounted)return;(0,s.C4)();const r=An(n),a=o(e,n,t,i);return r(),(0,s.bl)(),a});return i?r.unshift(a):r.push(a),a}}const Et=t=>(e,n=Sn)=>(!Rn||"sp"===t)&&Nt(t,((...t)=>e(...t)),n),Ot=Et("bm"),$t=Et("m"),Rt=Et("bu"),Dt=Et("u"),Mt=Et("bum"),Pt=Et("um"),Ft=Et("sp"),Lt=Et("rtg"),zt=Et("rtc");function Bt(t,e=Sn){Nt("ec",t,e)}function qt(t,e,n={},s,i){if($.isCE||$.parent&&wt($.parent)&&$.parent.isCE)return"default"!==e&&(n.name=e),cn("slot",n,s&&s());let r=t[e];r&&r._c&&(r._d=!1),Xe();const o=r&&Vt(r(n)),a=en(We,{key:n.key||o&&o.key||`_${e}`},o||(s?s():[]),o&&1===t._?64:-2);return!i&&a.scopeId&&(a.slotScopeIds=[a.scopeId+"-s"]),r&&r._c&&(r._d=!0),a}function Vt(t){return t.some((t=>!nn(t)||t.type!==Ue&&!(t.type===We&&!Vt(t.children))))?t:null}const Wt=t=>t?En(t)?Bn(t)||t.proxy:Wt(t.parent):null,jt=(0,i.X$)(Object.create(null),{$:t=>t,$el:t=>t.vnode.el,$data:t=>t.data,$props:t=>t.props,$attrs:t=>t.attrs,$slots:t=>t.slots,$refs:t=>t.refs,$parent:t=>Wt(t.parent),$root:t=>Wt(t.root),$emit:t=>t.emit,$options:t=>Jt(t),$forceUpdate:t=>t.f||(t.f=()=>{t.effect.dirty=!0,w(t.update)}),$nextTick:t=>t.n||(t.n=b.bind(t.proxy)),$watch:t=>nt.bind(t)}),Ut=(t,e)=>t!==i.MZ&&!t.__isScriptSetup&&(0,i.$3)(t,e),Gt={get({_:t},e){const{ctx:n,setupState:r,data:o,props:a,accessCache:u,type:c,appContext:l}=t;let h;if("$"!==e[0]){const s=u[e];if(void 0!==s)switch(s){case 1:return r[e];case 2:return o[e];case 4:return n[e];case 3:return a[e]}else{if(Ut(r,e))return u[e]=1,r[e];if(o!==i.MZ&&(0,i.$3)(o,e))return u[e]=2,o[e];if((h=t.propsOptions[0])&&(0,i.$3)(h,e))return u[e]=3,a[e];if(n!==i.MZ&&(0,i.$3)(n,e))return u[e]=4,n[e];Kt&&(u[e]=0)}}const p=jt[e];let d,f;return p?("$attrs"===e&&(0,s.u4)(t,"get",e),p(t)):(d=c.__cssModules)&&(d=d[e])?d:n!==i.MZ&&(0,i.$3)(n,e)?(u[e]=4,n[e]):(f=l.config.globalProperties,(0,i.$3)(f,e)?f[e]:void 0)},set({_:t},e,n){const{data:s,setupState:r,ctx:o}=t;return Ut(r,e)?(r[e]=n,!0):s!==i.MZ&&(0,i.$3)(s,e)?(s[e]=n,!0):!(0,i.$3)(t.props,e)&&(("$"!==e[0]||!(e.slice(1)in t))&&(o[e]=n,!0))},has({_:{data:t,setupState:e,accessCache:n,ctx:s,appContext:r,propsOptions:o}},a){let u;return!!n[a]||t!==i.MZ&&(0,i.$3)(t,a)||Ut(e,a)||(u=o[0])&&(0,i.$3)(u,a)||(0,i.$3)(s,a)||(0,i.$3)(jt,a)||(0,i.$3)(r.config.globalProperties,a)},defineProperty(t,e,n){return null!=n.get?t._.accessCache[e]=0:(0,i.$3)(n,"value")&&this.set(t,e,n.value,null),Reflect.defineProperty(t,e,n)}};function Ht(t){return(0,i.cy)(t)?t.reduce(((t,e)=>(t[e]=null,t)),{}):t}let Kt=!0;function Xt(t){const e=Jt(t),n=t.proxy,r=t.ctx;Kt=!1,e.beforeCreate&&Yt(e.beforeCreate,t,"bc");const{data:o,computed:a,methods:u,watch:c,provide:l,inject:h,created:p,beforeMount:d,mounted:f,beforeUpdate:m,updated:g,activated:y,deactivated:b,beforeDestroy:v,beforeUnmount:w,destroyed:x,unmounted:_,render:k,renderTracked:S,renderTriggered:T,errorCaptured:I,serverPrefetch:C,expose:A,inheritAttrs:N,components:E,directives:O,filters:$}=e,R=null;if(h&&Qt(h,r,R),u)for(const s in u){const t=u[s];(0,i.Tn)(t)&&(r[s]=t.bind(n))}if(o){0;const e=o.call(n,n);0,(0,i.Gv)(e)&&(t.data=(0,s.Kh)(e))}if(Kt=!0,a)for(const s in a){const t=a[s],e=(0,i.Tn)(t)?t.bind(n,n):(0,i.Tn)(t.get)?t.get.bind(n,n):i.tE;0;const o=!(0,i.Tn)(t)&&(0,i.Tn)(t.set)?t.set.bind(n):i.tE,u=Wn({get:e,set:o});Object.defineProperty(r,s,{enumerable:!0,configurable:!0,get:()=>u.value,set:t=>u.value=t})}if(c)for(const s in c)Zt(c[s],r,n,s);if(l){const t=(0,i.Tn)(l)?l.call(n):l;Reflect.ownKeys(t).forEach((e=>{de(e,t[e])}))}function D(t,e){(0,i.cy)(e)?e.forEach((e=>t(e.bind(n)))):e&&t(e.bind(n))}if(p&&Yt(p,t,"c"),D(Ot,d),D($t,f),D(Rt,m),D(Dt,g),D(kt,y),D(St,b),D(Bt,I),D(zt,S),D(Lt,T),D(Mt,w),D(Pt,_),D(Ft,C),(0,i.cy)(A))if(A.length){const e=t.exposed||(t.exposed={});A.forEach((t=>{Object.defineProperty(e,t,{get:()=>n[t],set:e=>n[t]=e})}))}else t.exposed||(t.exposed={});k&&t.render===i.tE&&(t.render=k),null!=N&&(t.inheritAttrs=N),E&&(t.components=E),O&&(t.directives=O)}function Qt(t,e,n=i.tE){(0,i.cy)(t)&&(t=ie(t));for(const r in t){const n=t[r];let o;o=(0,i.Gv)(n)?"default"in n?fe(n.from||r,n.default,!0):fe(n.from||r):fe(n),(0,s.i9)(o)?Object.defineProperty(e,r,{enumerable:!0,configurable:!0,get:()=>o.value,set:t=>o.value=t}):e[r]=o}}function Yt(t,e,n){o((0,i.cy)(t)?t.map((t=>t.bind(e.proxy))):t.bind(e.proxy),e,n)}function Zt(t,e,n,s){const r=s.includes(".")?st(n,s):()=>n[s];if((0,i.Kg)(t)){const n=e[t];(0,i.Tn)(n)&&tt(r,n)}else if((0,i.Tn)(t))tt(r,t.bind(n));else if((0,i.Gv)(t))if((0,i.cy)(t))t.forEach((t=>Zt(t,e,n,s)));else{const s=(0,i.Tn)(t.handler)?t.handler.bind(n):e[t.handler];(0,i.Tn)(s)&&tt(r,s,t)}else 0}function Jt(t){const e=t.type,{mixins:n,extends:s}=e,{mixins:r,optionsCache:o,config:{optionMergeStrategies:a}}=t.appContext,u=o.get(e);let c;return u?c=u:r.length||n||s?(c={},r.length&&r.forEach((t=>te(c,t,a,!0))),te(c,e,a)):c=e,(0,i.Gv)(e)&&o.set(e,c),c}function te(t,e,n,s=!1){const{mixins:i,extends:r}=e;r&&te(t,r,n,!0),i&&i.forEach((e=>te(t,e,n,!0)));for(const o in e)if(s&&"expose"===o);else{const s=ee[o]||n&&n[o];t[o]=s?s(t[o],e[o]):e[o]}return t}const ee={data:ne,props:ae,emits:ae,methods:oe,computed:oe,beforeCreate:re,created:re,beforeMount:re,mounted:re,beforeUpdate:re,updated:re,beforeDestroy:re,beforeUnmount:re,destroyed:re,unmounted:re,activated:re,deactivated:re,errorCaptured:re,serverPrefetch:re,components:oe,directives:oe,watch:ue,provide:ne,inject:se};function ne(t,e){return e?t?function(){return(0,i.X$)((0,i.Tn)(t)?t.call(this,this):t,(0,i.Tn)(e)?e.call(this,this):e)}:e:t}function se(t,e){return oe(ie(t),ie(e))}function ie(t){if((0,i.cy)(t)){const e={};for(let n=0;n<t.length;n++)e[t[n]]=t[n];return e}return t}function re(t,e){return t?[...new Set([].concat(t,e))]:e}function oe(t,e){return t?(0,i.X$)(Object.create(null),t,e):e}function ae(t,e){return t?(0,i.cy)(t)&&(0,i.cy)(e)?[...new Set([...t,...e])]:(0,i.X$)(Object.create(null),Ht(t),Ht(null!=e?e:{})):e}function ue(t,e){if(!t)return e;if(!e)return t;const n=(0,i.X$)(Object.create(null),t);for(const s in e)n[s]=re(t[s],e[s]);return n}function ce(){return{app:null,config:{isNativeTag:i.NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let le=0;function he(t,e){return function(n,s=null){(0,i.Tn)(n)||(n=(0,i.X$)({},n)),null==s||(0,i.Gv)(s)||(s=null);const r=ce(),o=new WeakSet;let a=!1;const u=r.app={_uid:le++,_component:n,_props:s,_container:null,_context:r,_instance:null,version:Un,get config(){return r.config},set config(t){0},use(t,...e){return o.has(t)||(t&&(0,i.Tn)(t.install)?(o.add(t),t.install(u,...e)):(0,i.Tn)(t)&&(o.add(t),t(u,...e))),u},mixin(t){return r.mixins.includes(t)||r.mixins.push(t),u},component(t,e){return e?(r.components[t]=e,u):r.components[t]},directive(t,e){return e?(r.directives[t]=e,u):r.directives[t]},mount(i,o,c){if(!a){0;const l=cn(n,s);return l.appContext=r,!0===c?c="svg":!1===c&&(c=void 0),o&&e?e(l,i):t(l,i,c),a=!0,u._container=i,i.__vue_app__=u,Bn(l.component)||l.component.proxy}},unmount(){a&&(t(null,u._container),delete u._container.__vue_app__)},provide(t,e){return r.provides[t]=e,u},runWithContext(t){const e=pe;pe=u;try{return t()}finally{pe=e}}};return u}}let pe=null;function de(t,e){if(Sn){let n=Sn.provides;const s=Sn.parent&&Sn.parent.provides;s===n&&(n=Sn.provides=Object.create(s)),n[t]=e}else 0}function fe(t,e,n=!1){const s=Sn||$;if(s||pe){const r=s?null==s.parent?s.vnode.appContext&&s.vnode.appContext.provides:s.parent.provides:pe._context.provides;if(r&&t in r)return r[t];if(arguments.length>1)return n&&(0,i.Tn)(e)?e.call(s&&s.proxy):e}else 0}function me(t,e,n,r=!1){const o={},a={};(0,i.yQ)(a,rn,1),t.propsDefaults=Object.create(null),ye(t,e,o,a);for(const s in t.propsOptions[0])s in o||(o[s]=void 0);n?t.props=r?o:(0,s.Gc)(o):t.type.props?t.props=o:t.props=a,t.attrs=a}function ge(t,e,n,r){const{props:o,attrs:a,vnode:{patchFlag:u}}=t,c=(0,s.ux)(o),[l]=t.propsOptions;let h=!1;if(!(r||u>0)||16&u){let s;ye(t,e,o,a)&&(h=!0);for(const r in c)e&&((0,i.$3)(e,r)||(s=(0,i.Tg)(r))!==r&&(0,i.$3)(e,s))||(l?!n||void 0===n[r]&&void 0===n[s]||(o[r]=be(l,c,r,void 0,t,!0)):delete o[r]);if(a!==c)for(const t in a)e&&(0,i.$3)(e,t)||(delete a[t],h=!0)}else if(8&u){const n=t.vnode.dynamicProps;for(let s=0;s<n.length;s++){let r=n[s];if(O(t.emitsOptions,r))continue;const u=e[r];if(l)if((0,i.$3)(a,r))u!==a[r]&&(a[r]=u,h=!0);else{const e=(0,i.PT)(r);o[e]=be(l,c,e,u,t,!1)}else u!==a[r]&&(a[r]=u,h=!0)}}h&&(0,s.hZ)(t,"set","$attrs")}function ye(t,e,n,r){const[o,a]=t.propsOptions;let u,c=!1;if(e)for(let s in e){if((0,i.SU)(s))continue;const l=e[s];let h;o&&(0,i.$3)(o,h=(0,i.PT)(s))?a&&a.includes(h)?(u||(u={}))[h]=l:n[h]=l:O(t.emitsOptions,s)||s in r&&l===r[s]||(r[s]=l,c=!0)}if(a){const e=(0,s.ux)(n),r=u||i.MZ;for(let s=0;s<a.length;s++){const u=a[s];n[u]=be(o,e,u,r[u],t,!(0,i.$3)(r,u))}}return c}function be(t,e,n,s,r,o){const a=t[n];if(null!=a){const t=(0,i.$3)(a,"default");if(t&&void 0===s){const t=a.default;if(a.type!==Function&&!a.skipFactory&&(0,i.Tn)(t)){const{propsDefaults:i}=r;if(n in i)s=i[n];else{const o=An(r);s=i[n]=t.call(null,e),o()}}else s=t}a[0]&&(o&&!t?s=!1:!a[1]||""!==s&&s!==(0,i.Tg)(n)||(s=!0))}return s}function ve(t,e,n=!1){const s=e.propsCache,r=s.get(t);if(r)return r;const o=t.props,a={},u=[];let c=!1;if(!(0,i.Tn)(t)){const s=t=>{c=!0;const[n,s]=ve(t,e,!0);(0,i.X$)(a,n),s&&u.push(...s)};!n&&e.mixins.length&&e.mixins.forEach(s),t.extends&&s(t.extends),t.mixins&&t.mixins.forEach(s)}if(!o&&!c)return(0,i.Gv)(t)&&s.set(t,i.Oj),i.Oj;if((0,i.cy)(o))for(let h=0;h<o.length;h++){0;const t=(0,i.PT)(o[h]);we(t)&&(a[t]=i.MZ)}else if(o){0;for(const t in o){const e=(0,i.PT)(t);if(we(e)){const n=o[t],s=a[e]=(0,i.cy)(n)||(0,i.Tn)(n)?{type:n}:(0,i.X$)({},n);if(s){const t=ke(Boolean,s.type),n=ke(String,s.type);s[0]=t>-1,s[1]=n<0||t<n,(t>-1||(0,i.$3)(s,"default"))&&u.push(e)}}}}const l=[a,u];return(0,i.Gv)(t)&&s.set(t,l),l}function we(t){return"$"!==t[0]&&!(0,i.SU)(t)}function xe(t){if(null===t)return"null";if("function"===typeof t)return t.name||"";if("object"===typeof t){const e=t.constructor&&t.constructor.name;return e||""}return""}function _e(t,e){return xe(t)===xe(e)}function ke(t,e){return(0,i.cy)(e)?e.findIndex((e=>_e(e,t))):(0,i.Tn)(e)&&_e(e,t)?0:-1}const Se=t=>"_"===t[0]||"$stable"===t,Te=t=>(0,i.cy)(t)?t.map(gn):[gn(t)],Ie=(t,e,n)=>{if(e._n)return e;const s=F(((...t)=>Te(e(...t))),n);return s._c=!1,s},Ce=(t,e,n)=>{const s=t._ctx;for(const r in t){if(Se(r))continue;const n=t[r];if((0,i.Tn)(n))e[r]=Ie(r,n,s);else if(null!=n){0;const t=Te(n);e[r]=()=>t}}},Ae=(t,e)=>{const n=Te(e);t.slots.default=()=>n},Ne=(t,e)=>{if(32&t.vnode.shapeFlag){const n=e._;n?(t.slots=(0,s.ux)(e),(0,i.yQ)(e,"_",n)):Ce(e,t.slots={})}else t.slots={},e&&Ae(t,e);(0,i.yQ)(t.slots,rn,1)},Ee=(t,e,n)=>{const{vnode:s,slots:r}=t;let o=!0,a=i.MZ;if(32&s.shapeFlag){const t=e._;t?n&&1===t?o=!1:((0,i.X$)(r,e),n||1!==t||delete r._):(o=!e.$stable,Ce(e,r)),a=e}else e&&(Ae(t,e),a={default:1});if(o)for(const i in r)Se(i)||null!=a[i]||delete r[i]};function Oe(t,e,n,o,a=!1){if((0,i.cy)(t))return void t.forEach(((t,s)=>Oe(t,e&&((0,i.cy)(e)?e[s]:e),n,o,a)));if(wt(o)&&!a)return;const u=4&o.shapeFlag?Bn(o.component)||o.component.proxy:o.el,c=a?null:u,{i:l,r:h}=t;const p=e&&e.r,d=l.refs===i.MZ?l.refs={}:l.refs,f=l.setupState;if(null!=p&&p!==h&&((0,i.Kg)(p)?(d[p]=null,(0,i.$3)(f,p)&&(f[p]=null)):(0,s.i9)(p)&&(p.value=null)),(0,i.Tn)(h))r(h,l,12,[c,d]);else{const e=(0,i.Kg)(h),r=(0,s.i9)(h);if(e||r){const s=()=>{if(t.f){const n=e?(0,i.$3)(f,h)?f[h]:d[h]:h.value;a?(0,i.cy)(n)&&(0,i.TF)(n,u):(0,i.cy)(n)?n.includes(u)||n.push(u):e?(d[h]=[u],(0,i.$3)(f,h)&&(f[h]=d[h])):(h.value=[u],t.k&&(d[t.k]=h.value))}else e?(d[h]=c,(0,i.$3)(f,h)&&(f[h]=c)):r&&(h.value=c,t.k&&(d[t.k]=c))};c?(s.id=-1,Re(s,n)):s()}else 0}}function $e(){"boolean"!==typeof __VUE_PROD_HYDRATION_MISMATCH_DETAILS__&&((0,i.We)().__VUE_PROD_HYDRATION_MISMATCH_DETAILS__=!1)}const Re=Q;function De(t){return Me(t)}function Me(t,e){$e();const n=(0,i.We)();n.__VUE__=!0;const{insert:r,remove:o,patchProp:a,createElement:u,createText:c,createComment:l,setText:h,setElementText:p,parentNode:d,nextSibling:f,setScopeId:m=i.tE,insertStaticContent:g}=t,y=(t,e,n,s=null,i=null,r=null,o=void 0,a=null,u=!!e.dynamicChildren)=>{if(t===e)return;t&&!sn(t,e)&&(s=Z(t),H(t,i,r,!0),t=null),-2===e.patchFlag&&(u=!1,e.dynamicChildren=null);const{type:c,ref:l,shapeFlag:h}=e;switch(c){case je:b(t,e,n,s);break;case Ue:v(t,e,n,s);break;case Ge:null==t&&x(e,n,s,o);break;case We:D(t,e,n,s,i,r,o,a,u);break;default:1&h?C(t,e,n,s,i,r,o,a,u):6&h?M(t,e,n,s,i,r,o,a,u):(64&h||128&h)&&c.process(t,e,n,s,i,r,o,a,u,et)}null!=l&&i&&Oe(l,t&&t.ref,r,e||t,!e)},b=(t,e,n,s)=>{if(null==t)r(e.el=c(e.children),n,s);else{const n=e.el=t.el;e.children!==t.children&&h(n,e.children)}},v=(t,e,n,s)=>{null==t?r(e.el=l(e.children||""),n,s):e.el=t.el},x=(t,e,n,s)=>{[t.el,t.anchor]=g(t.children,e,n,s,t.el,t.anchor)},k=({el:t,anchor:e},n,s)=>{let i;while(t&&t!==e)i=f(t),r(t,n,s),t=i;r(e,n,s)},I=({el:t,anchor:e})=>{let n;while(t&&t!==e)n=f(t),o(t),t=n;o(e)},C=(t,e,n,s,i,r,o,a,u)=>{"svg"===e.type?o="svg":"math"===e.type&&(o="mathml"),null==t?A(e,n,s,i,r,o,a,u):O(t,e,i,r,o,a,u)},A=(t,e,n,s,o,c,l,h)=>{let d,f;const{props:m,shapeFlag:g,transition:y,dirs:b}=t;if(d=t.el=u(t.type,c,m&&m.is,m),8&g?p(d,t.children):16&g&&E(t.children,d,null,s,o,Pe(t,c),l,h),b&&rt(t,null,s,"created"),N(d,t,t.scopeId,l,s),m){for(const e in m)"value"===e||(0,i.SU)(e)||a(d,e,null,m[e],c,t.children,s,o,Y);"value"in m&&a(d,"value",null,m.value,c),(f=m.onVnodeBeforeMount)&&wn(f,s,t)}b&&rt(t,null,s,"beforeMount");const v=Le(o,y);v&&y.beforeEnter(d),r(d,e,n),((f=m&&m.onVnodeMounted)||v||b)&&Re((()=>{f&&wn(f,s,t),v&&y.enter(d),b&&rt(t,null,s,"mounted")}),o)},N=(t,e,n,s,i)=>{if(n&&m(t,n),s)for(let r=0;r<s.length;r++)m(t,s[r]);if(i){let n=i.subTree;if(e===n){const e=i.vnode;N(t,e,e.scopeId,e.slotScopeIds,i.parent)}}},E=(t,e,n,s,i,r,o,a,u=0)=>{for(let c=u;c<t.length;c++){const u=t[c]=a?yn(t[c]):gn(t[c]);y(null,u,e,n,s,i,r,o,a)}},O=(t,e,n,s,r,o,u)=>{const c=e.el=t.el;let{patchFlag:l,dynamicChildren:h,dirs:d}=e;l|=16&t.patchFlag;const f=t.props||i.MZ,m=e.props||i.MZ;let g;if(n&&Fe(n,!1),(g=m.onVnodeBeforeUpdate)&&wn(g,n,e,t),d&&rt(e,t,n,"beforeUpdate"),n&&Fe(n,!0),h?$(t.dynamicChildren,h,c,n,s,Pe(e,r),o):u||V(t,e,c,null,n,s,Pe(e,r),o,!1),l>0){if(16&l)R(c,e,f,m,n,s,r);else if(2&l&&f.class!==m.class&&a(c,"class",null,m.class,r),4&l&&a(c,"style",f.style,m.style,r),8&l){const i=e.dynamicProps;for(let e=0;e<i.length;e++){const o=i[e],u=f[o],l=m[o];l===u&&"value"!==o||a(c,o,u,l,r,t.children,n,s,Y)}}1&l&&t.children!==e.children&&p(c,e.children)}else u||null!=h||R(c,e,f,m,n,s,r);((g=m.onVnodeUpdated)||d)&&Re((()=>{g&&wn(g,n,e,t),d&&rt(e,t,n,"updated")}),s)},$=(t,e,n,s,i,r,o)=>{for(let a=0;a<e.length;a++){const u=t[a],c=e[a],l=u.el&&(u.type===We||!sn(u,c)||70&u.shapeFlag)?d(u.el):n;y(u,c,l,null,s,i,r,o,!0)}},R=(t,e,n,s,r,o,u)=>{if(n!==s){if(n!==i.MZ)for(const c in n)(0,i.SU)(c)||c in s||a(t,c,n[c],null,u,e.children,r,o,Y);for(const c in s){if((0,i.SU)(c))continue;const l=s[c],h=n[c];l!==h&&"value"!==c&&a(t,c,h,l,u,e.children,r,o,Y)}"value"in s&&a(t,"value",n.value,s.value,u)}},D=(t,e,n,s,i,o,a,u,l)=>{const h=e.el=t?t.el:c(""),p=e.anchor=t?t.anchor:c("");let{patchFlag:d,dynamicChildren:f,slotScopeIds:m}=e;m&&(u=u?u.concat(m):m),null==t?(r(h,n,s),r(p,n,s),E(e.children||[],n,p,i,o,a,u,l)):d>0&&64&d&&f&&t.dynamicChildren?($(t.dynamicChildren,f,n,i,o,a,u),(null!=e.key||i&&e===i.subTree)&&ze(t,e,!0)):V(t,e,n,p,i,o,a,u,l)},M=(t,e,n,s,i,r,o,a,u)=>{e.slotScopeIds=a,null==t?512&e.shapeFlag?i.ctx.activate(e,n,s,o,u):P(e,n,s,i,r,o,u):F(t,e,u)},P=(t,e,n,s,i,r,o)=>{const a=t.component=kn(t,s,i);if(xt(t)&&(a.ctx.renderer=et),Dn(a),a.asyncDep){if(i&&i.registerDep(a,z),!t.el){const t=a.subTree=cn(Ue);v(null,t,e,n)}}else z(a,t,e,n,i,r,o)},F=(t,e,n)=>{const s=e.component=t.component;if(q(t,e,n)){if(s.asyncDep&&!s.asyncResolved)return void B(s,e,n);s.next=e,_(s.update),s.effect.dirty=!0,s.update()}else e.el=t.el,s.vnode=e},z=(t,e,n,r,o,a,u)=>{const c=()=>{if(t.isMounted){let{next:e,bu:n,u:s,parent:r,vnode:l}=t;{const n=qe(t);if(n)return e&&(e.el=l.el,B(t,e,u)),void n.asyncDep.then((()=>{t.isUnmounted||c()}))}let h,p=e;0,Fe(t,!1),e?(e.el=l.el,B(t,e,u)):e=l,n&&(0,i.DY)(n),(h=e.props&&e.props.onVnodeBeforeUpdate)&&wn(h,r,e,l),Fe(t,!0);const f=L(t);0;const m=t.subTree;t.subTree=f,y(m,f,d(m.el),Z(m),t,o,a),e.el=f.el,null===p&&W(t,f.el),s&&Re(s,o),(h=e.props&&e.props.onVnodeUpdated)&&Re((()=>wn(h,r,e,l)),o)}else{let s;const{el:u,props:c}=e,{bm:l,m:h,parent:p}=t,d=wt(e);if(Fe(t,!1),l&&(0,i.DY)(l),!d&&(s=c&&c.onVnodeBeforeMount)&&wn(s,p,e),Fe(t,!0),u&&st){const n=()=>{t.subTree=L(t),st(u,t.subTree,t,o,null)};d?e.type.__asyncLoader().then((()=>!t.isUnmounted&&n())):n()}else{0;const s=t.subTree=L(t);0,y(null,s,n,r,t,o,a),e.el=s.el}if(h&&Re(h,o),!d&&(s=c&&c.onVnodeMounted)){const t=e;Re((()=>wn(s,p,t)),o)}(256&e.shapeFlag||p&&wt(p.vnode)&&256&p.vnode.shapeFlag)&&t.a&&Re(t.a,o),t.isMounted=!0,e=n=r=null}},l=t.effect=new s.X2(c,i.tE,(()=>w(h)),t.scope),h=t.update=()=>{l.dirty&&l.run()};h.id=t.uid,Fe(t,!0),h()},B=(t,e,n)=>{e.component=t;const i=t.vnode.props;t.vnode=e,t.next=null,ge(t,e.props,i,n),Ee(t,e.children,n),(0,s.C4)(),S(t),(0,s.bl)()},V=(t,e,n,s,i,r,o,a,u=!1)=>{const c=t&&t.children,l=t?t.shapeFlag:0,h=e.children,{patchFlag:d,shapeFlag:f}=e;if(d>0){if(128&d)return void U(c,h,n,s,i,r,o,a,u);if(256&d)return void j(c,h,n,s,i,r,o,a,u)}8&f?(16&l&&Y(c,i,r),h!==c&&p(n,h)):16&l?16&f?U(c,h,n,s,i,r,o,a,u):Y(c,i,r,!0):(8&l&&p(n,""),16&f&&E(h,n,s,i,r,o,a,u))},j=(t,e,n,s,r,o,a,u,c)=>{t=t||i.Oj,e=e||i.Oj;const l=t.length,h=e.length,p=Math.min(l,h);let d;for(d=0;d<p;d++){const s=e[d]=c?yn(e[d]):gn(e[d]);y(t[d],s,n,null,r,o,a,u,c)}l>h?Y(t,r,o,!0,!1,p):E(e,n,s,r,o,a,u,c,p)},U=(t,e,n,s,r,o,a,u,c)=>{let l=0;const h=e.length;let p=t.length-1,d=h-1;while(l<=p&&l<=d){const s=t[l],i=e[l]=c?yn(e[l]):gn(e[l]);if(!sn(s,i))break;y(s,i,n,null,r,o,a,u,c),l++}while(l<=p&&l<=d){const s=t[p],i=e[d]=c?yn(e[d]):gn(e[d]);if(!sn(s,i))break;y(s,i,n,null,r,o,a,u,c),p--,d--}if(l>p){if(l<=d){const t=d+1,i=t<h?e[t].el:s;while(l<=d)y(null,e[l]=c?yn(e[l]):gn(e[l]),n,i,r,o,a,u,c),l++}}else if(l>d)while(l<=p)H(t[l],r,o,!0),l++;else{const f=l,m=l,g=new Map;for(l=m;l<=d;l++){const t=e[l]=c?yn(e[l]):gn(e[l]);null!=t.key&&g.set(t.key,l)}let b,v=0;const w=d-m+1;let x=!1,_=0;const k=new Array(w);for(l=0;l<w;l++)k[l]=0;for(l=f;l<=p;l++){const s=t[l];if(v>=w){H(s,r,o,!0);continue}let i;if(null!=s.key)i=g.get(s.key);else for(b=m;b<=d;b++)if(0===k[b-m]&&sn(s,e[b])){i=b;break}void 0===i?H(s,r,o,!0):(k[i-m]=l+1,i>=_?_=i:x=!0,y(s,e[i],n,null,r,o,a,u,c),v++)}const S=x?Be(k):i.Oj;for(b=S.length-1,l=w-1;l>=0;l--){const t=m+l,i=e[t],p=t+1<h?e[t+1].el:s;0===k[l]?y(null,i,n,p,r,o,a,u,c):x&&(b<0||l!==S[b]?G(i,n,p,2):b--)}}},G=(t,e,n,s,i=null)=>{const{el:o,type:a,transition:u,children:c,shapeFlag:l}=t;if(6&l)return void G(t.component.subTree,e,n,s);if(128&l)return void t.suspense.move(e,n,s);if(64&l)return void a.move(t,e,n,et);if(a===We){r(o,e,n);for(let t=0;t<c.length;t++)G(c[t],e,n,s);return void r(t.anchor,e,n)}if(a===Ge)return void k(t,e,n);const h=2!==s&&1&l&&u;if(h)if(0===s)u.beforeEnter(o),r(o,e,n),Re((()=>u.enter(o)),i);else{const{leave:t,delayLeave:s,afterLeave:i}=u,a=()=>r(o,e,n),c=()=>{t(o,(()=>{a(),i&&i()}))};s?s(o,a,c):c()}else r(o,e,n)},H=(t,e,n,s=!1,i=!1)=>{const{type:r,props:o,ref:a,children:u,dynamicChildren:c,shapeFlag:l,patchFlag:h,dirs:p}=t;if(null!=a&&Oe(a,null,n,t,!0),256&l)return void e.ctx.deactivate(t);const d=1&l&&p,f=!wt(t);let m;if(f&&(m=o&&o.onVnodeBeforeUnmount)&&wn(m,e,t),6&l)Q(t.component,n,s);else{if(128&l)return void t.suspense.unmount(n,s);d&&rt(t,null,e,"beforeUnmount"),64&l?t.type.remove(t,e,n,i,et,s):c&&(r!==We||h>0&&64&h)?Y(c,e,n,!1,!0):(r===We&&384&h||!i&&16&l)&&Y(u,e,n),s&&K(t)}(f&&(m=o&&o.onVnodeUnmounted)||d)&&Re((()=>{m&&wn(m,e,t),d&&rt(t,null,e,"unmounted")}),n)},K=t=>{const{type:e,el:n,anchor:s,transition:i}=t;if(e===We)return void X(n,s);if(e===Ge)return void I(t);const r=()=>{o(n),i&&!i.persisted&&i.afterLeave&&i.afterLeave()};if(1&t.shapeFlag&&i&&!i.persisted){const{leave:e,delayLeave:s}=i,o=()=>e(n,r);s?s(t.el,r,o):o()}else r()},X=(t,e)=>{let n;while(t!==e)n=f(t),o(t),t=n;o(e)},Q=(t,e,n)=>{const{bum:s,scope:r,update:o,subTree:a,um:u}=t;s&&(0,i.DY)(s),r.stop(),o&&(o.active=!1,H(a,t,e,n)),u&&Re(u,e),Re((()=>{t.isUnmounted=!0}),e),e&&e.pendingBranch&&!e.isUnmounted&&t.asyncDep&&!t.asyncResolved&&t.suspenseId===e.pendingId&&(e.deps--,0===e.deps&&e.resolve())},Y=(t,e,n,s=!1,i=!1,r=0)=>{for(let o=r;o<t.length;o++)H(t[o],e,n,s,i)},Z=t=>6&t.shapeFlag?Z(t.component.subTree):128&t.shapeFlag?t.suspense.next():f(t.anchor||t.el);let J=!1;const tt=(t,e,n)=>{null==t?e._vnode&&H(e._vnode,null,null,!0):y(e._vnode||null,t,e,null,null,null,n),J||(J=!0,S(),T(),J=!1),e._vnode=t},et={p:y,um:H,m:G,r:K,mt:P,mc:E,pc:V,pbc:$,n:Z,o:t};let nt,st;return e&&([nt,st]=e(et)),{render:tt,hydrate:nt,createApp:he(tt,nt)}}function Pe({type:t,props:e},n){return"svg"===n&&"foreignObject"===t||"mathml"===n&&"annotation-xml"===t&&e&&e.encoding&&e.encoding.includes("html")?void 0:n}function Fe({effect:t,update:e},n){t.allowRecurse=e.allowRecurse=n}function Le(t,e){return(!t||t&&!t.pendingBranch)&&e&&!e.persisted}function ze(t,e,n=!1){const s=t.children,r=e.children;if((0,i.cy)(s)&&(0,i.cy)(r))for(let i=0;i<s.length;i++){const t=s[i];let e=r[i];1&e.shapeFlag&&!e.dynamicChildren&&((e.patchFlag<=0||32===e.patchFlag)&&(e=r[i]=yn(r[i]),e.el=t.el),n||ze(t,e)),e.type===je&&(e.el=t.el)}}function Be(t){const e=t.slice(),n=[0];let s,i,r,o,a;const u=t.length;for(s=0;s<u;s++){const u=t[s];if(0!==u){if(i=n[n.length-1],t[i]<u){e[s]=i,n.push(s);continue}r=0,o=n.length-1;while(r<o)a=r+o>>1,t[n[a]]<u?r=a+1:o=a;u<t[n[r]]&&(r>0&&(e[s]=n[r-1]),n[r]=s)}}r=n.length,o=n[r-1];while(r-- >0)n[r]=o,o=e[o];return n}function qe(t){const e=t.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:qe(e)}const Ve=t=>t.__isTeleport;const We=Symbol.for("v-fgt"),je=Symbol.for("v-txt"),Ue=Symbol.for("v-cmt"),Ge=Symbol.for("v-stc"),He=[];let Ke=null;function Xe(t=!1){He.push(Ke=t?null:[])}function Qe(){He.pop(),Ke=He[He.length-1]||null}let Ye=1;function Ze(t){Ye+=t}function Je(t){return t.dynamicChildren=Ye>0?Ke||i.Oj:null,Qe(),Ye>0&&Ke&&Ke.push(t),t}function tn(t,e,n,s,i,r){return Je(un(t,e,n,s,i,r,!0))}function en(t,e,n,s,i){return Je(cn(t,e,n,s,i,!0))}function nn(t){return!!t&&!0===t.__v_isVNode}function sn(t,e){return t.type===e.type&&t.key===e.key}const rn="__vInternal",on=({key:t})=>null!=t?t:null,an=({ref:t,ref_key:e,ref_for:n})=>("number"===typeof t&&(t=""+t),null!=t?(0,i.Kg)(t)||(0,s.i9)(t)||(0,i.Tn)(t)?{i:$,r:t,k:e,f:!!n}:t:null);function un(t,e=null,n=null,s=0,r=null,o=(t===We?0:1),a=!1,u=!1){const c={__v_isVNode:!0,__v_skip:!0,type:t,props:e,key:e&&on(e),ref:e&&an(e),scopeId:R,slotScopeIds:null,children:n,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetAnchor:null,staticCount:0,shapeFlag:o,patchFlag:s,dynamicProps:r,dynamicChildren:null,appContext:null,ctx:$};return u?(bn(c,n),128&o&&t.normalize(c)):n&&(c.shapeFlag|=(0,i.Kg)(n)?8:16),Ye>0&&!a&&Ke&&(c.patchFlag>0||6&o)&&32!==c.patchFlag&&Ke.push(c),c}const cn=ln;function ln(t,e=null,n=null,r=0,o=null,a=!1){if(t&&t!==G||(t=Ue),nn(t)){const s=pn(t,e,!0);return n&&bn(s,n),Ye>0&&!a&&Ke&&(6&s.shapeFlag?Ke[Ke.indexOf(t)]=s:Ke.push(s)),s.patchFlag|=-2,s}if(Vn(t)&&(t=t.__vccOpts),e){e=hn(e);let{class:t,style:n}=e;t&&!(0,i.Kg)(t)&&(e.class=(0,i.C4)(t)),(0,i.Gv)(n)&&((0,s.ju)(n)&&!(0,i.cy)(n)&&(n=(0,i.X$)({},n)),e.style=(0,i.Tr)(n))}const u=(0,i.Kg)(t)?1:X(t)?128:Ve(t)?64:(0,i.Gv)(t)?4:(0,i.Tn)(t)?2:0;return un(t,e,n,r,o,u,a,!0)}function hn(t){return t?(0,s.ju)(t)||rn in t?(0,i.X$)({},t):t:null}function pn(t,e,n=!1){const{props:s,ref:r,patchFlag:o,children:a}=t,u=e?vn(s||{},e):s,c={__v_isVNode:!0,__v_skip:!0,type:t.type,props:u,key:u&&on(u),ref:e&&e.ref?n&&r?(0,i.cy)(r)?r.concat(an(e)):[r,an(e)]:an(e):r,scopeId:t.scopeId,slotScopeIds:t.slotScopeIds,children:a,target:t.target,targetAnchor:t.targetAnchor,staticCount:t.staticCount,shapeFlag:t.shapeFlag,patchFlag:e&&t.type!==We?-1===o?16:16|o:o,dynamicProps:t.dynamicProps,dynamicChildren:t.dynamicChildren,appContext:t.appContext,dirs:t.dirs,transition:t.transition,component:t.component,suspense:t.suspense,ssContent:t.ssContent&&pn(t.ssContent),ssFallback:t.ssFallback&&pn(t.ssFallback),el:t.el,anchor:t.anchor,ctx:t.ctx,ce:t.ce};return c}function dn(t=" ",e=0){return cn(je,null,t,e)}function fn(t,e){const n=cn(Ge,null,t);return n.staticCount=e,n}function mn(t="",e=!1){return e?(Xe(),en(Ue,null,t)):cn(Ue,null,t)}function gn(t){return null==t||"boolean"===typeof t?cn(Ue):(0,i.cy)(t)?cn(We,null,t.slice()):"object"===typeof t?yn(t):cn(je,null,String(t))}function yn(t){return null===t.el&&-1!==t.patchFlag||t.memo?t:pn(t)}function bn(t,e){let n=0;const{shapeFlag:s}=t;if(null==e)e=null;else if((0,i.cy)(e))n=16;else if("object"===typeof e){if(65&s){const n=e.default;return void(n&&(n._c&&(n._d=!1),bn(t,n()),n._c&&(n._d=!0)))}{n=32;const s=e._;s||rn in e?3===s&&$&&(1===$.slots._?e._=1:(e._=2,t.patchFlag|=1024)):e._ctx=$}}else(0,i.Tn)(e)?(e={default:e,_ctx:$},n=32):(e=String(e),64&s?(n=16,e=[dn(e)]):n=8);t.children=e,t.shapeFlag|=n}function vn(...t){const e={};for(let n=0;n<t.length;n++){const s=t[n];for(const t in s)if("class"===t)e.class!==s.class&&(e.class=(0,i.C4)([e.class,s.class]));else if("style"===t)e.style=(0,i.Tr)([e.style,s.style]);else if((0,i.Mp)(t)){const n=e[t],r=s[t];!r||n===r||(0,i.cy)(n)&&n.includes(r)||(e[t]=n?[].concat(n,r):r)}else""!==t&&(e[t]=s[t])}return e}function wn(t,e,n,s=null){o(t,e,7,[n,s])}const xn=ce();let _n=0;function kn(t,e,n){const r=t.type,o=(e?e.appContext:t.appContext)||xn,a={uid:_n++,vnode:t,type:r,parent:e,appContext:o,root:null,next:null,subTree:null,effect:null,update:null,scope:new s.yC(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(o.provides),accessCache:null,renderCache:[],components:null,directives:null,propsOptions:ve(r,o),emitsOptions:E(r,o),emit:null,emitted:null,propsDefaults:i.MZ,inheritAttrs:r.inheritAttrs,ctx:i.MZ,data:i.MZ,props:i.MZ,attrs:i.MZ,slots:i.MZ,refs:i.MZ,setupState:i.MZ,setupContext:null,attrsProxy:null,slotsProxy:null,suspense:n,suspenseId:n?n.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return a.ctx={_:a},a.root=e?e.root:a,a.emit=N.bind(null,a),t.ce&&t.ce(a),a}let Sn=null;const Tn=()=>Sn||$;let In,Cn;{const t=(0,i.We)(),e=(e,n)=>{let s;return(s=t[e])||(s=t[e]=[]),s.push(n),t=>{s.length>1?s.forEach((e=>e(t))):s[0](t)}};In=e("__VUE_INSTANCE_SETTERS__",(t=>Sn=t)),Cn=e("__VUE_SSR_SETTERS__",(t=>Rn=t))}const An=t=>{const e=Sn;return In(t),t.scope.on(),()=>{t.scope.off(),In(e)}},Nn=()=>{Sn&&Sn.scope.off(),In(null)};function En(t){return 4&t.vnode.shapeFlag}let On,$n,Rn=!1;function Dn(t,e=!1){e&&Cn(e);const{props:n,children:s}=t.vnode,i=En(t);me(t,n,i,e),Ne(t,s);const r=i?Mn(t,e):void 0;return e&&Cn(!1),r}function Mn(t,e){const n=t.type;t.accessCache=Object.create(null),t.proxy=(0,s.IG)(new Proxy(t.ctx,Gt));const{setup:o}=n;if(o){const n=t.setupContext=o.length>1?zn(t):null,u=An(t);(0,s.C4)();const c=r(o,t,0,[t.props,n]);if((0,s.bl)(),u(),(0,i.yL)(c)){if(c.then(Nn,Nn),e)return c.then((n=>{Pn(t,n,e)})).catch((e=>{a(e,t,0)}));t.asyncDep=c}else Pn(t,c,e)}else Fn(t,e)}function Pn(t,e,n){(0,i.Tn)(e)?t.type.__ssrInlineRender?t.ssrRender=e:t.render=e:(0,i.Gv)(e)&&(t.setupState=(0,s.Pr)(e)),Fn(t,n)}function Fn(t,e,n){const r=t.type;if(!t.render){if(!e&&On&&!r.render){const e=r.template||Jt(t).template;if(e){0;const{isCustomElement:n,compilerOptions:s}=t.appContext.config,{delimiters:o,compilerOptions:a}=r,u=(0,i.X$)((0,i.X$)({isCustomElement:n,delimiters:o},s),a);r.render=On(e,u)}}t.render=r.render||i.tE,$n&&$n(t)}{const e=An(t);(0,s.C4)();try{Xt(t)}finally{(0,s.bl)(),e()}}}function Ln(t){return t.attrsProxy||(t.attrsProxy=new Proxy(t.attrs,{get(e,n){return(0,s.u4)(t,"get","$attrs"),e[n]}}))}function zn(t){const e=e=>{t.exposed=e||{}};return{get attrs(){return Ln(t)},slots:t.slots,emit:t.emit,expose:e}}function Bn(t){if(t.exposed)return t.exposeProxy||(t.exposeProxy=new Proxy((0,s.Pr)((0,s.IG)(t.exposed)),{get(e,n){return n in e?e[n]:n in jt?jt[n](t):void 0},has(t,e){return e in t||e in jt}}))}function qn(t,e=!0){return(0,i.Tn)(t)?t.displayName||t.name:t.name||e&&t.__name}function Vn(t){return(0,i.Tn)(t)&&"__vccOpts"in t}const Wn=(t,e)=>{const n=(0,s.EW)(t,e,Rn);return n};function jn(t,e,n){const s=arguments.length;return 2===s?(0,i.Gv)(e)&&!(0,i.cy)(e)?nn(e)?cn(t,null,[e]):cn(t,e):cn(t,null,e):(s>3?n=Array.prototype.slice.call(arguments,2):3===s&&nn(n)&&(n=[n]),cn(t,e,n))}const Un="3.4.21"},5130:function(t,e,n){"use strict";n.d(e,{Ef:function(){return yt}});n(4114);var s=n(6768),i=n(4232),r=n(144);
/**
* @vue/runtime-dom v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
const o="http://www.w3.org/2000/svg",a="http://www.w3.org/1998/Math/MathML",u="undefined"!==typeof document?document:null,c=u&&u.createElement("template"),l={insert:(t,e,n)=>{e.insertBefore(t,n||null)},remove:t=>{const e=t.parentNode;e&&e.removeChild(t)},createElement:(t,e,n,s)=>{const i="svg"===e?u.createElementNS(o,t):"mathml"===e?u.createElementNS(a,t):u.createElement(t,n?{is:n}:void 0);return"select"===t&&s&&null!=s.multiple&&i.setAttribute("multiple",s.multiple),i},createText:t=>u.createTextNode(t),createComment:t=>u.createComment(t),setText:(t,e)=>{t.nodeValue=e},setElementText:(t,e)=>{t.textContent=e},parentNode:t=>t.parentNode,nextSibling:t=>t.nextSibling,querySelector:t=>u.querySelector(t),setScopeId(t,e){t.setAttribute(e,"")},insertStaticContent(t,e,n,s,i,r){const o=n?n.previousSibling:e.lastChild;if(i&&(i===r||i.nextSibling)){while(1)if(e.insertBefore(i.cloneNode(!0),n),i===r||!(i=i.nextSibling))break}else{c.innerHTML="svg"===s?`<svg>${t}</svg>`:"mathml"===s?`<math>${t}</math>`:t;const i=c.content;if("svg"===s||"mathml"===s){const t=i.firstChild;while(t.firstChild)i.appendChild(t.firstChild);i.removeChild(t)}e.insertBefore(i,n)}return[o?o.nextSibling:e.firstChild,n?n.previousSibling:e.lastChild]}},h="transition",p="animation",d=Symbol("_vtc"),f=(t,{slots:e})=>(0,s.h)(s.pR,v(t),e);f.displayName="Transition";const m={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},g=f.props=(0,i.X$)({},s.QP,m),y=(t,e=[])=>{(0,i.cy)(t)?t.forEach((t=>t(...e))):t&&t(...e)},b=t=>!!t&&((0,i.cy)(t)?t.some((t=>t.length>1)):t.length>1);function v(t){const e={};for(const i in t)i in m||(e[i]=t[i]);if(!1===t.css)return e;const{name:n="v",type:s,duration:r,enterFromClass:o=`${n}-enter-from`,enterActiveClass:a=`${n}-enter-active`,enterToClass:u=`${n}-enter-to`,appearFromClass:c=o,appearActiveClass:l=a,appearToClass:h=u,leaveFromClass:p=`${n}-leave-from`,leaveActiveClass:d=`${n}-leave-active`,leaveToClass:f=`${n}-leave-to`}=t,g=w(r),v=g&&g[0],x=g&&g[1],{onBeforeEnter:T,onEnter:C,onEnterCancelled:A,onLeave:N,onLeaveCancelled:O,onBeforeAppear:$=T,onAppear:R=C,onAppearCancelled:D=A}=e,M=(t,e,n)=>{k(t,e?h:u),k(t,e?l:a),n&&n()},P=(t,e)=>{t._isLeaving=!1,k(t,p),k(t,f),k(t,d),e&&e()},F=t=>(e,n)=>{const i=t?R:C,r=()=>M(e,t,n);y(i,[e,r]),S((()=>{k(e,t?c:o),_(e,t?h:u),b(i)||I(e,s,v,r)}))};return(0,i.X$)(e,{onBeforeEnter(t){y(T,[t]),_(t,o),_(t,a)},onBeforeAppear(t){y($,[t]),_(t,c),_(t,l)},onEnter:F(!1),onAppear:F(!0),onLeave(t,e){t._isLeaving=!0;const n=()=>P(t,e);_(t,p),E(),_(t,d),S((()=>{t._isLeaving&&(k(t,p),_(t,f),b(N)||I(t,s,x,n))})),y(N,[t,n])},onEnterCancelled(t){M(t,!1),y(A,[t])},onAppearCancelled(t){M(t,!0),y(D,[t])},onLeaveCancelled(t){P(t),y(O,[t])}})}function w(t){if(null==t)return null;if((0,i.Gv)(t))return[x(t.enter),x(t.leave)];{const e=x(t);return[e,e]}}function x(t){const e=(0,i.Ro)(t);return e}function _(t,e){e.split(/\s+/).forEach((e=>e&&t.classList.add(e))),(t[d]||(t[d]=new Set)).add(e)}function k(t,e){e.split(/\s+/).forEach((e=>e&&t.classList.remove(e)));const n=t[d];n&&(n.delete(e),n.size||(t[d]=void 0))}function S(t){requestAnimationFrame((()=>{requestAnimationFrame(t)}))}let T=0;function I(t,e,n,s){const i=t._endId=++T,r=()=>{i===t._endId&&s()};if(n)return setTimeout(r,n);const{type:o,timeout:a,propCount:u}=C(t,e);if(!o)return s();const c=o+"end";let l=0;const h=()=>{t.removeEventListener(c,p),r()},p=e=>{e.target===t&&++l>=u&&h()};setTimeout((()=>{l<u&&h()}),a+1),t.addEventListener(c,p)}function C(t,e){const n=window.getComputedStyle(t),s=t=>(n[t]||"").split(", "),i=s(`${h}Delay`),r=s(`${h}Duration`),o=A(i,r),a=s(`${p}Delay`),u=s(`${p}Duration`),c=A(a,u);let l=null,d=0,f=0;e===h?o>0&&(l=h,d=o,f=r.length):e===p?c>0&&(l=p,d=c,f=u.length):(d=Math.max(o,c),l=d>0?o>c?h:p:null,f=l?l===h?r.length:u.length:0);const m=l===h&&/\b(transform|all)(,|$)/.test(s(`${h}Property`).toString());return{type:l,timeout:d,propCount:f,hasTransform:m}}function A(t,e){while(t.length<e.length)t=t.concat(t);return Math.max(...e.map(((e,n)=>N(e)+N(t[n]))))}function N(t){return"auto"===t?0:1e3*Number(t.slice(0,-1).replace(",","."))}function E(){return document.body.offsetHeight}function O(t,e,n){const s=t[d];s&&(e=(e?[e,...s]:[...s]).join(" ")),null==e?t.removeAttribute("class"):n?t.setAttribute("class",e):t.className=e}const $=Symbol("_vod"),R=Symbol("_vsh");const D=Symbol("");const M=/(^|;)\s*display\s*:/;function P(t,e,n){const s=t.style,r=(0,i.Kg)(n);let o=!1;if(n&&!r){if(e)if((0,i.Kg)(e))for(const t of e.split(";")){const e=t.slice(0,t.indexOf(":")).trim();null==n[e]&&L(s,e,"")}else for(const t in e)null==n[t]&&L(s,t,"");for(const t in n)"display"===t&&(o=!0),L(s,t,n[t])}else if(r){if(e!==n){const t=s[D];t&&(n+=";"+t),s.cssText=n,o=M.test(n)}}else e&&t.removeAttribute("style");$ in t&&(t[$]=o?s.display:"",t[R]&&(s.display="none"))}const F=/\s*!important$/;function L(t,e,n){if((0,i.cy)(n))n.forEach((n=>L(t,e,n)));else if(null==n&&(n=""),e.startsWith("--"))t.setProperty(e,n);else{const s=q(t,e);F.test(n)?t.setProperty((0,i.Tg)(s),n.replace(F,""),"important"):t[s]=n}}const z=["Webkit","Moz","ms"],B={};function q(t,e){const n=B[e];if(n)return n;let s=(0,i.PT)(e);if("filter"!==s&&s in t)return B[e]=s;s=(0,i.ZH)(s);for(let i=0;i<z.length;i++){const n=z[i]+s;if(n in t)return B[e]=n}return e}const V="http://www.w3.org/1999/xlink";function W(t,e,n,s,r){if(s&&e.startsWith("xlink:"))null==n?t.removeAttributeNS(V,e.slice(6,e.length)):t.setAttributeNS(V,e,n);else{const s=(0,i.J$)(e);null==n||s&&!(0,i.Y2)(n)?t.removeAttribute(e):t.setAttribute(e,s?"":n)}}function j(t,e,n,s,r,o,a){if("innerHTML"===e||"textContent"===e)return s&&a(s,r,o),void(t[e]=null==n?"":n);const u=t.tagName;if("value"===e&&"PROGRESS"!==u&&!u.includes("-")){const s="OPTION"===u?t.getAttribute("value")||"":t.value,i=null==n?"":n;return s===i&&"_value"in t||(t.value=i),null==n&&t.removeAttribute(e),void(t._value=n)}let c=!1;if(""===n||null==n){const s=typeof t[e];"boolean"===s?n=(0,i.Y2)(n):null==n&&"string"===s?(n="",c=!0):"number"===s&&(n=0,c=!0)}try{t[e]=n}catch(l){0}c&&t.removeAttribute(e)}function U(t,e,n,s){t.addEventListener(e,n,s)}function G(t,e,n,s){t.removeEventListener(e,n,s)}const H=Symbol("_vei");function K(t,e,n,s,i=null){const r=t[H]||(t[H]={}),o=r[e];if(s&&o)o.value=s;else{const[n,a]=Q(e);if(s){const o=r[e]=tt(s,i);U(t,n,o,a)}else o&&(G(t,n,o,a),r[e]=void 0)}}const X=/(?:Once|Passive|Capture)$/;function Q(t){let e;if(X.test(t)){let n;e={};while(n=t.match(X))t=t.slice(0,t.length-n[0].length),e[n[0].toLowerCase()]=!0}const n=":"===t[2]?t.slice(3):(0,i.Tg)(t.slice(2));return[n,e]}let Y=0;const Z=Promise.resolve(),J=()=>Y||(Z.then((()=>Y=0)),Y=Date.now());function tt(t,e){const n=t=>{if(t._vts){if(t._vts<=n.attached)return}else t._vts=Date.now();(0,s.qL)(et(t,n.value),e,5,[t])};return n.value=t,n.attached=J(),n}function et(t,e){if((0,i.cy)(e)){const n=t.stopImmediatePropagation;return t.stopImmediatePropagation=()=>{n.call(t),t._stopped=!0},e.map((t=>e=>!e._stopped&&t&&t(e)))}return e}const nt=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&t.charCodeAt(2)>96&&t.charCodeAt(2)<123,st=(t,e,n,s,r,o,a,u,c)=>{const l="svg"===r;"class"===e?O(t,s,l):"style"===e?P(t,n,s):(0,i.Mp)(e)?(0,i.CP)(e)||K(t,e,n,s,a):("."===e[0]?(e=e.slice(1),1):"^"===e[0]?(e=e.slice(1),0):it(t,e,s,l))?j(t,e,s,o,a,u,c):("true-value"===e?t._trueValue=s:"false-value"===e&&(t._falseValue=s),W(t,e,s,l))};function it(t,e,n,s){if(s)return"innerHTML"===e||"textContent"===e||!!(e in t&&nt(e)&&(0,i.Tn)(n));if("spellcheck"===e||"draggable"===e||"translate"===e)return!1;if("form"===e)return!1;if("list"===e&&"INPUT"===t.tagName)return!1;if("type"===e&&"TEXTAREA"===t.tagName)return!1;if("width"===e||"height"===e){const e=t.tagName;if("IMG"===e||"VIDEO"===e||"CANVAS"===e||"SOURCE"===e)return!1}return(!nt(e)||!(0,i.Kg)(n))&&e in t}
/*! #__NO_SIDE_EFFECTS__ */
/*! #__NO_SIDE_EFFECTS__ */
"undefined"!==typeof HTMLElement&&HTMLElement;const rt=new WeakMap,ot=new WeakMap,at=Symbol("_moveCb"),ut=Symbol("_enterCb"),ct={name:"TransitionGroup",props:(0,i.X$)({},g,{tag:String,moveClass:String}),setup(t,{slots:e}){const n=(0,s.nI)(),i=(0,s.Gy)();let o,a;return(0,s.$u)((()=>{if(!o.length)return;const e=t.moveClass||`${t.name||"v"}-move`;if(!dt(o[0].el,n.vnode.el,e))return;o.forEach(lt),o.forEach(ht);const s=o.filter(pt);E(),s.forEach((t=>{const n=t.el,s=n.style;_(n,e),s.transform=s.webkitTransform=s.transitionDuration="";const i=n[at]=t=>{t&&t.target!==n||t&&!/transform$/.test(t.propertyName)||(n.removeEventListener("transitionend",i),n[at]=null,k(n,e))};n.addEventListener("transitionend",i)}))})),()=>{const u=(0,r.ux)(t),c=v(u);let l=u.tag||s.FK;o=a,a=e.default?(0,s.Df)(e.default()):[];for(let t=0;t<a.length;t++){const e=a[t];null!=e.key&&(0,s.MZ)(e,(0,s.OW)(e,c,i,n))}if(o)for(let t=0;t<o.length;t++){const e=o[t];(0,s.MZ)(e,(0,s.OW)(e,c,i,n)),rt.set(e,e.el.getBoundingClientRect())}return(0,s.bF)(l,null,a)}}};ct.props;function lt(t){const e=t.el;e[at]&&e[at](),e[ut]&&e[ut]()}function ht(t){ot.set(t,t.el.getBoundingClientRect())}function pt(t){const e=rt.get(t),n=ot.get(t),s=e.left-n.left,i=e.top-n.top;if(s||i){const e=t.el.style;return e.transform=e.webkitTransform=`translate(${s}px,${i}px)`,e.transitionDuration="0s",t}}function dt(t,e,n){const s=t.cloneNode(),i=t[d];i&&i.forEach((t=>{t.split(/\s+/).forEach((t=>t&&s.classList.remove(t)))})),n.split(/\s+/).forEach((t=>t&&s.classList.add(t))),s.style.display="none";const r=1===e.nodeType?e:e.parentNode;r.appendChild(s);const{hasTransform:o}=C(s);return r.removeChild(s),o}Symbol("_assign");const ft=(0,i.X$)({patchProp:st},l);let mt;function gt(){return mt||(mt=(0,s.K9)(ft))}const yt=(...t)=>{const e=gt().createApp(...t);const{mount:n}=e;return e.mount=t=>{const s=vt(t);if(!s)return;const r=e._component;(0,i.Tn)(r)||r.render||r.template||(r.template=s.innerHTML),s.innerHTML="";const o=n(s,!1,bt(s));return s instanceof Element&&(s.removeAttribute("v-cloak"),s.setAttribute("data-v-app","")),o},e};function bt(t){return t instanceof SVGElement?"svg":"function"===typeof MathMLElement&&t instanceof MathMLElement?"mathml":void 0}function vt(t){if((0,i.Kg)(t)){const e=document.querySelector(t);return e}return t}},4232:function(t,e,n){"use strict";n.d(e,{$3:function(){return d},$H:function(){return F},BH:function(){return U},BX:function(){return nt},Bm:function(){return x},C4:function(){return Y},CE:function(){return m},CP:function(){return c},DY:function(){return L},Gv:function(){return _},J$:function(){return J},Kg:function(){return w},MZ:function(){return i},Mp:function(){return u},NO:function(){return a},Oj:function(){return r},PT:function(){return $},Qd:function(){return C},Ro:function(){return q},SU:function(){return N},TF:function(){return h},Tg:function(){return D},Tn:function(){return v},Tr:function(){return G},We:function(){return W},X$:function(){return l},Y2:function(){return tt},ZH:function(){return M},Zf:function(){return I},bB:function(){return B},cy:function(){return f},gd:function(){return b},pD:function(){return s},rU:function(){return P},tE:function(){return o},u3:function(){return st},vM:function(){return g},v_:function(){return it},yI:function(){return A},yL:function(){return k},yQ:function(){return z}});n(4114);
/**
* @vue/shared v3.4.21
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/
function s(t,e){const n=new Set(t.split(","));return e?t=>n.has(t.toLowerCase()):t=>n.has(t)}const i={},r=[],o=()=>{},a=()=>!1,u=t=>111===t.charCodeAt(0)&&110===t.charCodeAt(1)&&(t.charCodeAt(2)>122||t.charCodeAt(2)<97),c=t=>t.startsWith("onUpdate:"),l=Object.assign,h=(t,e)=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)},p=Object.prototype.hasOwnProperty,d=(t,e)=>p.call(t,e),f=Array.isArray,m=t=>"[object Map]"===T(t),g=t=>"[object Set]"===T(t),y=t=>"[object Date]"===T(t),b=t=>"[object RegExp]"===T(t),v=t=>"function"===typeof t,w=t=>"string"===typeof t,x=t=>"symbol"===typeof t,_=t=>null!==t&&"object"===typeof t,k=t=>(_(t)||v(t))&&v(t.then)&&v(t.catch),S=Object.prototype.toString,T=t=>S.call(t),I=t=>T(t).slice(8,-1),C=t=>"[object Object]"===T(t),A=t=>w(t)&&"NaN"!==t&&"-"!==t[0]&&""+parseInt(t,10)===t,N=s(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),E=t=>{const e=Object.create(null);return n=>{const s=e[n];return s||(e[n]=t(n))}},O=/-(\w)/g,$=E((t=>t.replace(O,((t,e)=>e?e.toUpperCase():"")))),R=/\B([A-Z])/g,D=E((t=>t.replace(R,"-$1").toLowerCase())),M=E((t=>t.charAt(0).toUpperCase()+t.slice(1))),P=E((t=>{const e=t?`on${M(t)}`:"";return e})),F=(t,e)=>!Object.is(t,e),L=(t,e)=>{for(let n=0;n<t.length;n++)t[n](e)},z=(t,e,n)=>{Object.defineProperty(t,e,{configurable:!0,enumerable:!1,value:n})},B=t=>{const e=parseFloat(t);return isNaN(e)?t:e},q=t=>{const e=w(t)?Number(t):NaN;return isNaN(e)?t:e};let V;const W=()=>V||(V="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{});const j="Infinity,undefined,NaN,isFinite,isNaN,parseFloat,parseInt,decodeURI,decodeURIComponent,encodeURI,encodeURIComponent,Math,Number,Date,Array,Object,Boolean,String,RegExp,Map,Set,JSON,Intl,BigInt,console,Error",U=s(j);function G(t){if(f(t)){const e={};for(let n=0;n<t.length;n++){const s=t[n],i=w(s)?Q(s):G(s);if(i)for(const t in i)e[t]=i[t]}return e}if(w(t)||_(t))return t}const H=/;(?![^(]*\))/g,K=/:([^]+)/,X=/\/\*[^]*?\*\//g;function Q(t){const e={};return t.replace(X,"").split(H).forEach((t=>{if(t){const n=t.split(K);n.length>1&&(e[n[0].trim()]=n[1].trim())}})),e}function Y(t){let e="";if(w(t))e=t;else if(f(t))for(let n=0;n<t.length;n++){const s=Y(t[n]);s&&(e+=s+" ")}else if(_(t))for(const n in t)t[n]&&(e+=n+" ");return e.trim()}const Z="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",J=s(Z);function tt(t){return!!t||""===t}function et(t,e){if(t.length!==e.length)return!1;let n=!0;for(let s=0;n&&s<t.length;s++)n=nt(t[s],e[s]);return n}function nt(t,e){if(t===e)return!0;let n=y(t),s=y(e);if(n||s)return!(!n||!s)&&t.getTime()===e.getTime();if(n=x(t),s=x(e),n||s)return t===e;if(n=f(t),s=f(e),n||s)return!(!n||!s)&&et(t,e);if(n=_(t),s=_(e),n||s){if(!n||!s)return!1;const i=Object.keys(t).length,r=Object.keys(e).length;if(i!==r)return!1;for(const n in t){const s=t.hasOwnProperty(n),i=e.hasOwnProperty(n);if(s&&!i||!s&&i||!nt(t[n],e[n]))return!1}}return String(t)===String(e)}function st(t,e){return t.findIndex((t=>nt(t,e)))}const it=t=>w(t)?t:null==t?"":f(t)||_(t)&&(t.toString===S||!v(t.toString))?JSON.stringify(t,rt,2):String(t),rt=(t,e)=>e&&e.__v_isRef?rt(t,e.value):m(e)?{[`Map(${e.size})`]:[...e.entries()].reduce(((t,[e,n],s)=>(t[ot(e,s)+" =>"]=n,t)),{})}:g(e)?{[`Set(${e.size})`]:[...e.values()].map((t=>ot(t)))}:x(e)?ot(e):!_(e)||f(e)||C(e)?e:String(e),ot=(t,e="")=>{var n;return x(t)?`Symbol(${null!=(n=t.description)?n:e})`:t}},6404:function(t,e,n){n(4114),function(t,s){s(e,n(3686),n(7724),n(7362))}(0,(function(t,e,n,s){"use strict";var i=function(t,e,n){return{endTime:e,insertTime:n,type:"exponentialRampToValue",value:t}},r=function(t,e,n){return{endTime:e,insertTime:n,type:"linearRampToValue",value:t}},o=function(t,e){return{startTime:e,type:"setValue",value:t}},a=function(t,e,n){return{duration:n,startTime:e,type:"setValueCurve",values:t}},u=function(t,e,n){var s=n.startTime,i=n.target,r=n.timeConstant;return i+(e-i)*Math.exp((s-t)/r)},c=function(t){return"exponentialRampToValue"===t.type},l=function(t){return"linearRampToValue"===t.type},h=function(t){return c(t)||l(t)},p=function(t){return"setValue"===t.type},d=function(t){return"setValueCurve"===t.type},f=function t(e,n,s,i){var r=e[n];return void 0===r?i:h(r)||p(r)?r.value:d(r)?r.values[r.values.length-1]:u(s,t(e,n-1,r.startTime,i),r)},m=function(t,e,n,s,i){return void 0===n?[s.insertTime,i]:h(n)?[n.endTime,n.value]:p(n)?[n.startTime,n.value]:d(n)?[n.startTime+n.duration,n.values[n.values.length-1]]:[n.startTime,f(t,e-1,n.startTime,i)]},g=function(t){return"cancelAndHold"===t.type},y=function(t){return"cancelScheduledValues"===t.type},b=function(t){return g(t)||y(t)?t.cancelTime:c(t)||l(t)?t.endTime:t.startTime},v=function(t,e,n,s){var i=s.endTime,r=s.value;return n===r?r:0<n&&0<r||n<0&&r<0?n*Math.pow(r/n,(t-e)/(i-e)):0},w=function(t,e,n,s){var i=s.endTime,r=s.value;return n+(t-e)/(i-e)*(r-n)},x=function(t,e){var n=Math.floor(e),s=Math.ceil(e);return n===s?t[n]:(1-(e-n))*t[n]+(1-(s-e))*t[s]},_=function(t,e){var n=e.duration,s=e.startTime,i=e.values,r=(t-s)/n*(i.length-1);return x(i,r)},k=function(t){return"setTarget"===t.type},S=function(){function t(e){n(this,t),this._automationEvents=[],this._currenTime=0,this._defaultValue=e}return s(t,[{key:Symbol.iterator,value:function(){return this._automationEvents[Symbol.iterator]()}},{key:"add",value:function(t){var e=b(t);if(g(t)||y(t)){var n=this._automationEvents.findIndex((function(n){return y(t)&&d(n)?n.startTime+n.duration>=e:b(n)>=e})),s=this._automationEvents[n];if(-1!==n&&(this._automationEvents=this._automationEvents.slice(0,n)),g(t)){var u=this._automationEvents[this._automationEvents.length-1];if(void 0!==s&&h(s)){if(void 0!==u&&k(u))throw new Error("The internal list is malformed.");var p=void 0===u?s.insertTime:d(u)?u.startTime+u.duration:b(u),f=void 0===u?this._defaultValue:d(u)?u.values[u.values.length-1]:u.value,m=c(s)?v(e,p,f,s):w(e,p,f,s),x=c(s)?i(m,e,this._currenTime):r(m,e,this._currenTime);this._automationEvents.push(x)}if(void 0!==u&&k(u)&&this._automationEvents.push(o(this.getValue(e),e)),void 0!==u&&d(u)&&u.startTime+u.duration>e){var _=e-u.startTime,S=(u.values.length-1)/u.duration,T=Math.max(2,1+Math.ceil(_*S)),I=_/(T-1)*S,C=u.values.slice(0,T);if(I<1)for(var A=1;A<T;A+=1){var N=I*A%1;C[A]=u.values[A-1]*(1-N)+u.values[A]*N}this._automationEvents[this._automationEvents.length-1]=a(C,u.startTime,_)}}}else{var E=this._automationEvents.findIndex((function(t){return b(t)>e})),O=-1===E?this._automationEvents[this._automationEvents.length-1]:this._automationEvents[E-1];if(void 0!==O&&d(O)&&b(O)+O.duration>e)return!1;var $=c(t)?i(t.value,t.endTime,this._currenTime):l(t)?r(t.value,e,this._currenTime):t;if(-1===E)this._automationEvents.push($);else{if(d(t)&&e+t.duration>b(this._automationEvents[E]))return!1;this._automationEvents.splice(E,0,$)}}return!0}},{key:"flush",value:function(t){var e=this._automationEvents.findIndex((function(e){return b(e)>t}));if(e>1){var n=this._automationEvents.slice(e-1),s=n[0];k(s)&&n.unshift(o(f(this._automationEvents,e-2,s.startTime,this._defaultValue),s.startTime)),this._automationEvents=n}}},{key:"getValue",value:function(t){if(0===this._automationEvents.length)return this._defaultValue;var n=this._automationEvents.findIndex((function(e){return b(e)>t})),s=this._automationEvents[n],i=(-1===n?this._automationEvents.length:n)-1,r=this._automationEvents[i];if(void 0!==r&&k(r)&&(void 0===s||!h(s)||s.insertTime>t))return u(t,f(this._automationEvents,i-1,r.startTime,this._defaultValue),r);if(void 0!==r&&p(r)&&(void 0===s||!h(s)))return r.value;if(void 0!==r&&d(r)&&(void 0===s||!h(s)||r.startTime+r.duration>t))return t<r.startTime+r.duration?_(t,r):r.values[r.values.length-1];if(void 0!==r&&h(r)&&(void 0===s||!h(s)))return r.value;if(void 0!==s&&c(s)){var o=m(this._automationEvents,i,r,s,this._defaultValue),a=e(o,2),g=a[0],y=a[1];return v(t,g,y,s)}if(void 0!==s&&l(s)){var x=m(this._automationEvents,i,r,s,this._defaultValue),S=e(x,2),T=S[0],I=S[1];return w(t,T,I,s)}return this._defaultValue}}])}(),T=function(t){return{cancelTime:t,type:"cancelAndHold"}},I=function(t){return{cancelTime:t,type:"cancelScheduledValues"}},C=function(t,e){return{endTime:e,type:"exponentialRampToValue",value:t}},A=function(t,e){return{endTime:e,type:"linearRampToValue",value:t}},N=function(t,e,n){return{startTime:e,target:t,timeConstant:n,type:"setTarget"}};t.AutomationEventList=S,t.createCancelAndHoldAutomationEvent=T,t.createCancelScheduledValuesAutomationEvent=I,t.createExponentialRampToValueAutomationEvent=C,t.createLinearRampToValueAutomationEvent=A,t.createSetTargetAutomationEvent=N,t.createSetValueAutomationEvent=o,t.createSetValueCurveAutomationEvent=a}))},8077:function(t,e,n){"use strict";var s={};n.r(s),n.d(s,{afterMain:function(){return k},afterRead:function(){return w},afterWrite:function(){return I},applyStyles:function(){return M},arrow:function(){return at},auto:function(){return u},basePlacements:function(){return c},beforeMain:function(){return x},beforeRead:function(){return b},beforeWrite:function(){return S},bottom:function(){return r},clippingParents:function(){return p},computeStyles:function(){return dt},createPopper:function(){return le},createPopperBase:function(){return ue},createPopperLite:function(){return pe},detectOverflow:function(){return Dt},end:function(){return h},eventListeners:function(){return gt},flip:function(){return Lt},hide:function(){return Vt},left:function(){return a},main:function(){return _},modifierPhases:function(){return C},offset:function(){return Ut},placements:function(){return y},popper:function(){return f},popperGenerator:function(){return ae},popperOffsets:function(){return Ht},preventOverflow:function(){return Qt},read:function(){return v},reference:function(){return m},right:function(){return o},start:function(){return l},top:function(){return i},variationPlacements:function(){return g},viewport:function(){return d},write:function(){return T}});n(4114);var i="top",r="bottom",o="right",a="left",u="auto",c=[i,r,o,a],l="start",h="end",p="clippingParents",d="viewport",f="popper",m="reference",g=c.reduce((function(t,e){return t.concat([e+"-"+l,e+"-"+h])}),[]),y=[].concat(c,[u]).reduce((function(t,e){return t.concat([e,e+"-"+l,e+"-"+h])}),[]),b="beforeRead",v="read",w="afterRead",x="beforeMain",_="main",k="afterMain",S="beforeWrite",T="write",I="afterWrite",C=[b,v,w,x,_,k,S,T,I];function A(t){return t?(t.nodeName||"").toLowerCase():null}function N(t){if(null==t)return window;if("[object Window]"!==t.toString()){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function E(t){var e=N(t).Element;return t instanceof e||t instanceof Element}function O(t){var e=N(t).HTMLElement;return t instanceof e||t instanceof HTMLElement}function $(t){if("undefined"===typeof ShadowRoot)return!1;var e=N(t).ShadowRoot;return t instanceof e||t instanceof ShadowRoot}function R(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var n=e.styles[t]||{},s=e.attributes[t]||{},i=e.elements[t];O(i)&&A(i)&&(Object.assign(i.style,n),Object.keys(s).forEach((function(t){var e=s[t];!1===e?i.removeAttribute(t):i.setAttribute(t,!0===e?"":e)})))}))}function D(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach((function(t){var s=e.elements[t],i=e.attributes[t]||{},r=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]),o=r.reduce((function(t,e){return t[e]="",t}),{});O(s)&&A(s)&&(Object.assign(s.style,o),Object.keys(i).forEach((function(t){s.removeAttribute(t)})))}))}}var M={name:"applyStyles",enabled:!0,phase:"write",fn:R,effect:D,requires:["computeStyles"]};function P(t){return t.split("-")[0]}var F=Math.max,L=Math.min,z=Math.round;function B(){var t=navigator.userAgentData;return null!=t&&t.brands&&Array.isArray(t.brands)?t.brands.map((function(t){return t.brand+"/"+t.version})).join(" "):navigator.userAgent}function q(){return!/^((?!chrome|android).)*safari/i.test(B())}function V(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var s=t.getBoundingClientRect(),i=1,r=1;e&&O(t)&&(i=t.offsetWidth>0&&z(s.width)/t.offsetWidth||1,r=t.offsetHeight>0&&z(s.height)/t.offsetHeight||1);var o=E(t)?N(t):window,a=o.visualViewport,u=!q()&&n,c=(s.left+(u&&a?a.offsetLeft:0))/i,l=(s.top+(u&&a?a.offsetTop:0))/r,h=s.width/i,p=s.height/r;return{width:h,height:p,top:l,right:c+h,bottom:l+p,left:c,x:c,y:l}}function W(t){var e=V(t),n=t.offsetWidth,s=t.offsetHeight;return Math.abs(e.width-n)<=1&&(n=e.width),Math.abs(e.height-s)<=1&&(s=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:s}}function j(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&$(n)){var s=e;do{if(s&&t.isSameNode(s))return!0;s=s.parentNode||s.host}while(s)}return!1}function U(t){return N(t).getComputedStyle(t)}function G(t){return["table","td","th"].indexOf(A(t))>=0}function H(t){return((E(t)?t.ownerDocument:t.document)||window.document).documentElement}function K(t){return"html"===A(t)?t:t.assignedSlot||t.parentNode||($(t)?t.host:null)||H(t)}function X(t){return O(t)&&"fixed"!==U(t).position?t.offsetParent:null}function Q(t){var e=/firefox/i.test(B()),n=/Trident/i.test(B());if(n&&O(t)){var s=U(t);if("fixed"===s.position)return null}var i=K(t);$(i)&&(i=i.host);while(O(i)&&["html","body"].indexOf(A(i))<0){var r=U(i);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||e&&"filter"===r.willChange||e&&r.filter&&"none"!==r.filter)return i;i=i.parentNode}return null}function Y(t){var e=N(t),n=X(t);while(n&&G(n)&&"static"===U(n).position)n=X(n);return n&&("html"===A(n)||"body"===A(n)&&"static"===U(n).position)?e:n||Q(t)||e}function Z(t){return["top","bottom"].indexOf(t)>=0?"x":"y"}function J(t,e,n){return F(t,L(e,n))}function tt(t,e,n){var s=J(t,e,n);return s>n?n:s}function et(){return{top:0,right:0,bottom:0,left:0}}function nt(t){return Object.assign({},et(),t)}function st(t,e){return e.reduce((function(e,n){return e[n]=t,e}),{})}var it=function(t,e){return t="function"===typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t,nt("number"!==typeof t?t:st(t,c))};function rt(t){var e,n=t.state,s=t.name,u=t.options,c=n.elements.arrow,l=n.modifiersData.popperOffsets,h=P(n.placement),p=Z(h),d=[a,o].indexOf(h)>=0,f=d?"height":"width";if(c&&l){var m=it(u.padding,n),g=W(c),y="y"===p?i:a,b="y"===p?r:o,v=n.rects.reference[f]+n.rects.reference[p]-l[p]-n.rects.popper[f],w=l[p]-n.rects.reference[p],x=Y(c),_=x?"y"===p?x.clientHeight||0:x.clientWidth||0:0,k=v/2-w/2,S=m[y],T=_-g[f]-m[b],I=_/2-g[f]/2+k,C=J(S,I,T),A=p;n.modifiersData[s]=(e={},e[A]=C,e.centerOffset=C-I,e)}}function ot(t){var e=t.state,n=t.options,s=n.element,i=void 0===s?"[data-popper-arrow]":s;null!=i&&("string"!==typeof i||(i=e.elements.popper.querySelector(i),i))&&j(e.elements.popper,i)&&(e.elements.arrow=i)}var at={name:"arrow",enabled:!0,phase:"main",fn:rt,effect:ot,requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function ut(t){return t.split("-")[1]}var ct={top:"auto",right:"auto",bottom:"auto",left:"auto"};function lt(t,e){var n=t.x,s=t.y,i=e.devicePixelRatio||1;return{x:z(n*i)/i||0,y:z(s*i)/i||0}}function ht(t){var e,n=t.popper,s=t.popperRect,u=t.placement,c=t.variation,l=t.offsets,p=t.position,d=t.gpuAcceleration,f=t.adaptive,m=t.roundOffsets,g=t.isFixed,y=l.x,b=void 0===y?0:y,v=l.y,w=void 0===v?0:v,x="function"===typeof m?m({x:b,y:w}):{x:b,y:w};b=x.x,w=x.y;var _=l.hasOwnProperty("x"),k=l.hasOwnProperty("y"),S=a,T=i,I=window;if(f){var C=Y(n),A="clientHeight",E="clientWidth";if(C===N(n)&&(C=H(n),"static"!==U(C).position&&"absolute"===p&&(A="scrollHeight",E="scrollWidth")),u===i||(u===a||u===o)&&c===h){T=r;var O=g&&C===I&&I.visualViewport?I.visualViewport.height:C[A];w-=O-s.height,w*=d?1:-1}if(u===a||(u===i||u===r)&&c===h){S=o;var $=g&&C===I&&I.visualViewport?I.visualViewport.width:C[E];b-=$-s.width,b*=d?1:-1}}var R,D=Object.assign({position:p},f&&ct),M=!0===m?lt({x:b,y:w},N(n)):{x:b,y:w};return b=M.x,w=M.y,d?Object.assign({},D,(R={},R[T]=k?"0":"",R[S]=_?"0":"",R.transform=(I.devicePixelRatio||1)<=1?"translate("+b+"px, "+w+"px)":"translate3d("+b+"px, "+w+"px, 0)",R)):Object.assign({},D,(e={},e[T]=k?w+"px":"",e[S]=_?b+"px":"",e.transform="",e))}function pt(t){var e=t.state,n=t.options,s=n.gpuAcceleration,i=void 0===s||s,r=n.adaptive,o=void 0===r||r,a=n.roundOffsets,u=void 0===a||a,c={placement:P(e.placement),variation:ut(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,ht(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:o,roundOffsets:u})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,ht(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:u})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})}var dt={name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:pt,data:{}},ft={passive:!0};function mt(t){var e=t.state,n=t.instance,s=t.options,i=s.scroll,r=void 0===i||i,o=s.resize,a=void 0===o||o,u=N(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return r&&c.forEach((function(t){t.addEventListener("scroll",n.update,ft)})),a&&u.addEventListener("resize",n.update,ft),function(){r&&c.forEach((function(t){t.removeEventListener("scroll",n.update,ft)})),a&&u.removeEventListener("resize",n.update,ft)}}var gt={name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:mt,data:{}},yt={left:"right",right:"left",bottom:"top",top:"bottom"};function bt(t){return t.replace(/left|right|bottom|top/g,(function(t){return yt[t]}))}var vt={start:"end",end:"start"};function wt(t){return t.replace(/start|end/g,(function(t){return vt[t]}))}function xt(t){var e=N(t),n=e.pageXOffset,s=e.pageYOffset;return{scrollLeft:n,scrollTop:s}}function _t(t){return V(H(t)).left+xt(t).scrollLeft}function kt(t,e){var n=N(t),s=H(t),i=n.visualViewport,r=s.clientWidth,o=s.clientHeight,a=0,u=0;if(i){r=i.width,o=i.height;var c=q();(c||!c&&"fixed"===e)&&(a=i.offsetLeft,u=i.offsetTop)}return{width:r,height:o,x:a+_t(t),y:u}}function St(t){var e,n=H(t),s=xt(t),i=null==(e=t.ownerDocument)?void 0:e.body,r=F(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),o=F(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),a=-s.scrollLeft+_t(t),u=-s.scrollTop;return"rtl"===U(i||n).direction&&(a+=F(n.clientWidth,i?i.clientWidth:0)-r),{width:r,height:o,x:a,y:u}}function Tt(t){var e=U(t),n=e.overflow,s=e.overflowX,i=e.overflowY;return/auto|scroll|overlay|hidden/.test(n+i+s)}function It(t){return["html","body","#document"].indexOf(A(t))>=0?t.ownerDocument.body:O(t)&&Tt(t)?t:It(K(t))}function Ct(t,e){var n;void 0===e&&(e=[]);var s=It(t),i=s===(null==(n=t.ownerDocument)?void 0:n.body),r=N(s),o=i?[r].concat(r.visualViewport||[],Tt(s)?s:[]):s,a=e.concat(o);return i?a:a.concat(Ct(K(o)))}function At(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function Nt(t,e){var n=V(t,!1,"fixed"===e);return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}function Et(t,e,n){return e===d?At(kt(t,n)):E(e)?Nt(e,n):At(St(H(t)))}function Ot(t){var e=Ct(K(t)),n=["absolute","fixed"].indexOf(U(t).position)>=0,s=n&&O(t)?Y(t):t;return E(s)?e.filter((function(t){return E(t)&&j(t,s)&&"body"!==A(t)})):[]}function $t(t,e,n,s){var i="clippingParents"===e?Ot(t):[].concat(e),r=[].concat(i,[n]),o=r[0],a=r.reduce((function(e,n){var i=Et(t,n,s);return e.top=F(i.top,e.top),e.right=L(i.right,e.right),e.bottom=L(i.bottom,e.bottom),e.left=F(i.left,e.left),e}),Et(t,o,s));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function Rt(t){var e,n=t.reference,s=t.element,u=t.placement,c=u?P(u):null,p=u?ut(u):null,d=n.x+n.width/2-s.width/2,f=n.y+n.height/2-s.height/2;switch(c){case i:e={x:d,y:n.y-s.height};break;case r:e={x:d,y:n.y+n.height};break;case o:e={x:n.x+n.width,y:f};break;case a:e={x:n.x-s.width,y:f};break;default:e={x:n.x,y:n.y}}var m=c?Z(c):null;if(null!=m){var g="y"===m?"height":"width";switch(p){case l:e[m]=e[m]-(n[g]/2-s[g]/2);break;case h:e[m]=e[m]+(n[g]/2-s[g]/2);break;default:}}return e}function Dt(t,e){void 0===e&&(e={});var n=e,s=n.placement,a=void 0===s?t.placement:s,u=n.strategy,l=void 0===u?t.strategy:u,h=n.boundary,g=void 0===h?p:h,y=n.rootBoundary,b=void 0===y?d:y,v=n.elementContext,w=void 0===v?f:v,x=n.altBoundary,_=void 0!==x&&x,k=n.padding,S=void 0===k?0:k,T=nt("number"!==typeof S?S:st(S,c)),I=w===f?m:f,C=t.rects.popper,A=t.elements[_?I:w],N=$t(E(A)?A:A.contextElement||H(t.elements.popper),g,b,l),O=V(t.elements.reference),$=Rt({reference:O,element:C,strategy:"absolute",placement:a}),R=At(Object.assign({},C,$)),D=w===f?R:O,M={top:N.top-D.top+T.top,bottom:D.bottom-N.bottom+T.bottom,left:N.left-D.left+T.left,right:D.right-N.right+T.right},P=t.modifiersData.offset;if(w===f&&P){var F=P[a];Object.keys(M).forEach((function(t){var e=[o,r].indexOf(t)>=0?1:-1,n=[i,r].indexOf(t)>=0?"y":"x";M[t]+=F[n]*e}))}return M}function Mt(t,e){void 0===e&&(e={});var n=e,s=n.placement,i=n.boundary,r=n.rootBoundary,o=n.padding,a=n.flipVariations,u=n.allowedAutoPlacements,l=void 0===u?y:u,h=ut(s),p=h?a?g:g.filter((function(t){return ut(t)===h})):c,d=p.filter((function(t){return l.indexOf(t)>=0}));0===d.length&&(d=p);var f=d.reduce((function(e,n){return e[n]=Dt(t,{placement:n,boundary:i,rootBoundary:r,padding:o})[P(n)],e}),{});return Object.keys(f).sort((function(t,e){return f[t]-f[e]}))}function Pt(t){if(P(t)===u)return[];var e=bt(t);return[wt(t),e,wt(e)]}function Ft(t){var e=t.state,n=t.options,s=t.name;if(!e.modifiersData[s]._skip){for(var c=n.mainAxis,h=void 0===c||c,p=n.altAxis,d=void 0===p||p,f=n.fallbackPlacements,m=n.padding,g=n.boundary,y=n.rootBoundary,b=n.altBoundary,v=n.flipVariations,w=void 0===v||v,x=n.allowedAutoPlacements,_=e.options.placement,k=P(_),S=k===_,T=f||(S||!w?[bt(_)]:Pt(_)),I=[_].concat(T).reduce((function(t,n){return t.concat(P(n)===u?Mt(e,{placement:n,boundary:g,rootBoundary:y,padding:m,flipVariations:w,allowedAutoPlacements:x}):n)}),[]),C=e.rects.reference,A=e.rects.popper,N=new Map,E=!0,O=I[0],$=0;$<I.length;$++){var R=I[$],D=P(R),M=ut(R)===l,F=[i,r].indexOf(D)>=0,L=F?"width":"height",z=Dt(e,{placement:R,boundary:g,rootBoundary:y,altBoundary:b,padding:m}),B=F?M?o:a:M?r:i;C[L]>A[L]&&(B=bt(B));var q=bt(B),V=[];if(h&&V.push(z[D]<=0),d&&V.push(z[B]<=0,z[q]<=0),V.every((function(t){return t}))){O=R,E=!1;break}N.set(R,V)}if(E)for(var W=w?3:1,j=function(t){var e=I.find((function(e){var n=N.get(e);if(n)return n.slice(0,t).every((function(t){return t}))}));if(e)return O=e,"break"},U=W;U>0;U--){var G=j(U);if("break"===G)break}e.placement!==O&&(e.modifiersData[s]._skip=!0,e.placement=O,e.reset=!0)}}var Lt={name:"flip",enabled:!0,phase:"main",fn:Ft,requiresIfExists:["offset"],data:{_skip:!1}};function zt(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function Bt(t){return[i,o,r,a].some((function(e){return t[e]>=0}))}function qt(t){var e=t.state,n=t.name,s=e.rects.reference,i=e.rects.popper,r=e.modifiersData.preventOverflow,o=Dt(e,{elementContext:"reference"}),a=Dt(e,{altBoundary:!0}),u=zt(o,s),c=zt(a,i,r),l=Bt(u),h=Bt(c);e.modifiersData[n]={referenceClippingOffsets:u,popperEscapeOffsets:c,isReferenceHidden:l,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":h})}var Vt={name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:qt};function Wt(t,e,n){var s=P(t),r=[a,i].indexOf(s)>=0?-1:1,u="function"===typeof n?n(Object.assign({},e,{placement:t})):n,c=u[0],l=u[1];return c=c||0,l=(l||0)*r,[a,o].indexOf(s)>=0?{x:l,y:c}:{x:c,y:l}}function jt(t){var e=t.state,n=t.options,s=t.name,i=n.offset,r=void 0===i?[0,0]:i,o=y.reduce((function(t,n){return t[n]=Wt(n,e.rects,r),t}),{}),a=o[e.placement],u=a.x,c=a.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=u,e.modifiersData.popperOffsets.y+=c),e.modifiersData[s]=o}var Ut={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:jt};function Gt(t){var e=t.state,n=t.name;e.modifiersData[n]=Rt({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})}var Ht={name:"popperOffsets",enabled:!0,phase:"read",fn:Gt,data:{}};function Kt(t){return"x"===t?"y":"x"}function Xt(t){var e=t.state,n=t.options,s=t.name,u=n.mainAxis,c=void 0===u||u,h=n.altAxis,p=void 0!==h&&h,d=n.boundary,f=n.rootBoundary,m=n.altBoundary,g=n.padding,y=n.tether,b=void 0===y||y,v=n.tetherOffset,w=void 0===v?0:v,x=Dt(e,{boundary:d,rootBoundary:f,padding:g,altBoundary:m}),_=P(e.placement),k=ut(e.placement),S=!k,T=Z(_),I=Kt(T),C=e.modifiersData.popperOffsets,A=e.rects.reference,N=e.rects.popper,E="function"===typeof w?w(Object.assign({},e.rects,{placement:e.placement})):w,O="number"===typeof E?{mainAxis:E,altAxis:E}:Object.assign({mainAxis:0,altAxis:0},E),$=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,R={x:0,y:0};if(C){if(c){var D,M="y"===T?i:a,z="y"===T?r:o,B="y"===T?"height":"width",q=C[T],V=q+x[M],j=q-x[z],U=b?-N[B]/2:0,G=k===l?A[B]:N[B],H=k===l?-N[B]:-A[B],K=e.elements.arrow,X=b&&K?W(K):{width:0,height:0},Q=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:et(),nt=Q[M],st=Q[z],it=J(0,A[B],X[B]),rt=S?A[B]/2-U-it-nt-O.mainAxis:G-it-nt-O.mainAxis,ot=S?-A[B]/2+U+it+st+O.mainAxis:H+it+st+O.mainAxis,at=e.elements.arrow&&Y(e.elements.arrow),ct=at?"y"===T?at.clientTop||0:at.clientLeft||0:0,lt=null!=(D=null==$?void 0:$[T])?D:0,ht=q+rt-lt-ct,pt=q+ot-lt,dt=J(b?L(V,ht):V,q,b?F(j,pt):j);C[T]=dt,R[T]=dt-q}if(p){var ft,mt="x"===T?i:a,gt="x"===T?r:o,yt=C[I],bt="y"===I?"height":"width",vt=yt+x[mt],wt=yt-x[gt],xt=-1!==[i,a].indexOf(_),_t=null!=(ft=null==$?void 0:$[I])?ft:0,kt=xt?vt:yt-A[bt]-N[bt]-_t+O.altAxis,St=xt?yt+A[bt]+N[bt]-_t-O.altAxis:wt,Tt=b&&xt?tt(kt,yt,St):J(b?kt:vt,yt,b?St:wt);C[I]=Tt,R[I]=Tt-yt}e.modifiersData[s]=R}}var Qt={name:"preventOverflow",enabled:!0,phase:"main",fn:Xt,requiresIfExists:["offset"]};function Yt(t){return{scrollLeft:t.scrollLeft,scrollTop:t.scrollTop}}function Zt(t){return t!==N(t)&&O(t)?Yt(t):xt(t)}function Jt(t){var e=t.getBoundingClientRect(),n=z(e.width)/t.offsetWidth||1,s=z(e.height)/t.offsetHeight||1;return 1!==n||1!==s}function te(t,e,n){void 0===n&&(n=!1);var s=O(e),i=O(e)&&Jt(e),r=H(e),o=V(t,i,n),a={scrollLeft:0,scrollTop:0},u={x:0,y:0};return(s||!s&&!n)&&(("body"!==A(e)||Tt(r))&&(a=Zt(e)),O(e)?(u=V(e,!0),u.x+=e.clientLeft,u.y+=e.clientTop):r&&(u.x=_t(r))),{x:o.left+a.scrollLeft-u.x,y:o.top+a.scrollTop-u.y,width:o.width,height:o.height}}function ee(t){var e=new Map,n=new Set,s=[];function i(t){n.add(t.name);var r=[].concat(t.requires||[],t.requiresIfExists||[]);r.forEach((function(t){if(!n.has(t)){var s=e.get(t);s&&i(s)}})),s.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){n.has(t.name)||i(t)})),s}function ne(t){var e=ee(t);return C.reduce((function(t,n){return t.concat(e.filter((function(t){return t.phase===n})))}),[])}function se(t){var e;return function(){return e||(e=new Promise((function(n){Promise.resolve().then((function(){e=void 0,n(t())}))}))),e}}function ie(t){var e=t.reduce((function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign({},n,e,{options:Object.assign({},n.options,e.options),data:Object.assign({},n.data,e.data)}):e,t}),{});return Object.keys(e).map((function(t){return e[t]}))}var re={placement:"bottom",modifiers:[],strategy:"absolute"};function oe(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return!e.some((function(t){return!(t&&"function"===typeof t.getBoundingClientRect)}))}function ae(t){void 0===t&&(t={});var e=t,n=e.defaultModifiers,s=void 0===n?[]:n,i=e.defaultOptions,r=void 0===i?re:i;return function(t,e,n){void 0===n&&(n=r);var i={placement:"bottom",orderedModifiers:[],options:Object.assign({},re,r),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},o=[],a=!1,u={state:i,setOptions:function(n){var o="function"===typeof n?n(i.options):n;l(),i.options=Object.assign({},r,i.options,o),i.scrollParents={reference:E(t)?Ct(t):t.contextElement?Ct(t.contextElement):[],popper:Ct(e)};var a=ne(ie([].concat(s,i.options.modifiers)));return i.orderedModifiers=a.filter((function(t){return t.enabled})),c(),u.update()},forceUpdate:function(){if(!a){var t=i.elements,e=t.reference,n=t.popper;if(oe(e,n)){i.rects={reference:te(e,Y(n),"fixed"===i.options.strategy),popper:W(n)},i.reset=!1,i.placement=i.options.placement,i.orderedModifiers.forEach((function(t){return i.modifiersData[t.name]=Object.assign({},t.data)}));for(var s=0;s<i.orderedModifiers.length;s++)if(!0!==i.reset){var r=i.orderedModifiers[s],o=r.fn,c=r.options,l=void 0===c?{}:c,h=r.name;"function"===typeof o&&(i=o({state:i,options:l,name:h,instance:u})||i)}else i.reset=!1,s=-1}}},update:se((function(){return new Promise((function(t){u.forceUpdate(),t(i)}))})),destroy:function(){l(),a=!0}};if(!oe(t,e))return u;function c(){i.orderedModifiers.forEach((function(t){var e=t.name,n=t.options,s=void 0===n?{}:n,r=t.effect;if("function"===typeof r){var a=r({state:i,name:e,instance:u,options:s}),c=function(){};o.push(a||c)}}))}function l(){o.forEach((function(t){return t()})),o=[]}return u.setOptions(n).then((function(t){!a&&n.onFirstUpdate&&n.onFirstUpdate(t)})),u}}var ue=ae(),ce=[gt,Ht,dt,M,Ut,Lt,Qt,at,Vt],le=ae({defaultModifiers:ce}),he=[gt,Ht,dt,M],pe=ae({defaultModifiers:he});
/*!
  * Bootstrap v5.3.3 (https://getbootstrap.com/)
  * Copyright 2011-2024 The Bootstrap Authors (https://github.com/twbs/bootstrap/graphs/contributors)
  * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE)
  */
const de=new Map,fe={set(t,e,n){de.has(t)||de.set(t,new Map);const s=de.get(t);s.has(e)||0===s.size?s.set(e,n):console.error(`Bootstrap doesn't allow more than one instance per element. Bound instance: ${Array.from(s.keys())[0]}.`)},get(t,e){return de.has(t)&&de.get(t).get(e)||null},remove(t,e){if(!de.has(t))return;const n=de.get(t);n.delete(e),0===n.size&&de.delete(t)}},me=1e6,ge=1e3,ye="transitionend",be=t=>(t&&window.CSS&&window.CSS.escape&&(t=t.replace(/#([^\s"#']+)/g,((t,e)=>`#${CSS.escape(e)}`))),t),ve=t=>null===t||void 0===t?`${t}`:Object.prototype.toString.call(t).match(/\s([a-z]+)/i)[1].toLowerCase(),we=t=>{do{t+=Math.floor(Math.random()*me)}while(document.getElementById(t));return t},xe=t=>{if(!t)return 0;let{transitionDuration:e,transitionDelay:n}=window.getComputedStyle(t);const s=Number.parseFloat(e),i=Number.parseFloat(n);return s||i?(e=e.split(",")[0],n=n.split(",")[0],(Number.parseFloat(e)+Number.parseFloat(n))*ge):0},_e=t=>{t.dispatchEvent(new Event(ye))},ke=t=>!(!t||"object"!==typeof t)&&("undefined"!==typeof t.jquery&&(t=t[0]),"undefined"!==typeof t.nodeType),Se=t=>ke(t)?t.jquery?t[0]:t:"string"===typeof t&&t.length>0?document.querySelector(be(t)):null,Te=t=>{if(!ke(t)||0===t.getClientRects().length)return!1;const e="visible"===getComputedStyle(t).getPropertyValue("visibility"),n=t.closest("details:not([open])");if(!n)return e;if(n!==t){const e=t.closest("summary");if(e&&e.parentNode!==n)return!1;if(null===e)return!1}return e},Ie=t=>!t||t.nodeType!==Node.ELEMENT_NODE||(!!t.classList.contains("disabled")||("undefined"!==typeof t.disabled?t.disabled:t.hasAttribute("disabled")&&"false"!==t.getAttribute("disabled"))),Ce=t=>{if(!document.documentElement.attachShadow)return null;if("function"===typeof t.getRootNode){const e=t.getRootNode();return e instanceof ShadowRoot?e:null}return t instanceof ShadowRoot?t:t.parentNode?Ce(t.parentNode):null},Ae=()=>{},Ne=t=>{t.offsetHeight},Ee=()=>window.jQuery&&!document.body.hasAttribute("data-bs-no-jquery")?window.jQuery:null,Oe=[],$e=t=>{"loading"===document.readyState?(Oe.length||document.addEventListener("DOMContentLoaded",(()=>{for(const t of Oe)t()})),Oe.push(t)):t()},Re=()=>"rtl"===document.documentElement.dir,De=t=>{$e((()=>{const e=Ee();if(e){const n=t.NAME,s=e.fn[n];e.fn[n]=t.jQueryInterface,e.fn[n].Constructor=t,e.fn[n].noConflict=()=>(e.fn[n]=s,t.jQueryInterface)}}))},Me=(t,e=[],n=t)=>"function"===typeof t?t(...e):n,Pe=(t,e,n=!0)=>{if(!n)return void Me(t);const s=5,i=xe(e)+s;let r=!1;const o=({target:n})=>{n===e&&(r=!0,e.removeEventListener(ye,o),Me(t))};e.addEventListener(ye,o),setTimeout((()=>{r||_e(e)}),i)},Fe=(t,e,n,s)=>{const i=t.length;let r=t.indexOf(e);return-1===r?!n&&s?t[i-1]:t[0]:(r+=n?1:-1,s&&(r=(r+i)%i),t[Math.max(0,Math.min(r,i-1))])},Le=/[^.]*(?=\..*)\.|.*/,ze=/\..*/,Be=/::\d+$/,qe={};let Ve=1;const We={mouseenter:"mouseover",mouseleave:"mouseout"},je=new Set(["click","dblclick","mouseup","mousedown","contextmenu","mousewheel","DOMMouseScroll","mouseover","mouseout","mousemove","selectstart","selectend","keydown","keypress","keyup","orientationchange","touchstart","touchmove","touchend","touchcancel","pointerdown","pointermove","pointerup","pointerleave","pointercancel","gesturestart","gesturechange","gestureend","focus","blur","change","reset","select","submit","focusin","focusout","load","unload","beforeunload","resize","move","DOMContentLoaded","readystatechange","error","abort","scroll"]);function Ue(t,e){return e&&`${e}::${Ve++}`||t.uidEvent||Ve++}function Ge(t){const e=Ue(t);return t.uidEvent=e,qe[e]=qe[e]||{},qe[e]}function He(t,e){return function n(s){return nn(s,{delegateTarget:t}),n.oneOff&&en.off(t,s.type,e),e.apply(t,[s])}}function Ke(t,e,n){return function s(i){const r=t.querySelectorAll(e);for(let{target:o}=i;o&&o!==this;o=o.parentNode)for(const a of r)if(a===o)return nn(i,{delegateTarget:o}),s.oneOff&&en.off(t,i.type,e,n),n.apply(o,[i])}}function Xe(t,e,n=null){return Object.values(t).find((t=>t.callable===e&&t.delegationSelector===n))}function Qe(t,e,n){const s="string"===typeof e,i=s?n:e||n;let r=tn(t);return je.has(r)||(r=t),[s,i,r]}function Ye(t,e,n,s,i){if("string"!==typeof e||!t)return;let[r,o,a]=Qe(e,n,s);if(e in We){const t=t=>function(e){if(!e.relatedTarget||e.relatedTarget!==e.delegateTarget&&!e.delegateTarget.contains(e.relatedTarget))return t.call(this,e)};o=t(o)}const u=Ge(t),c=u[a]||(u[a]={}),l=Xe(c,o,r?n:null);if(l)return void(l.oneOff=l.oneOff&&i);const h=Ue(o,e.replace(Le,"")),p=r?Ke(t,n,o):He(t,o);p.delegationSelector=r?n:null,p.callable=o,p.oneOff=i,p.uidEvent=h,c[h]=p,t.addEventListener(a,p,r)}function Ze(t,e,n,s,i){const r=Xe(e[n],s,i);r&&(t.removeEventListener(n,r,Boolean(i)),delete e[n][r.uidEvent])}function Je(t,e,n,s){const i=e[n]||{};for(const[r,o]of Object.entries(i))r.includes(s)&&Ze(t,e,n,o.callable,o.delegationSelector)}function tn(t){return t=t.replace(ze,""),We[t]||t}const en={on(t,e,n,s){Ye(t,e,n,s,!1)},one(t,e,n,s){Ye(t,e,n,s,!0)},off(t,e,n,s){if("string"!==typeof e||!t)return;const[i,r,o]=Qe(e,n,s),a=o!==e,u=Ge(t),c=u[o]||{},l=e.startsWith(".");if("undefined"===typeof r){if(l)for(const n of Object.keys(u))Je(t,u,n,e.slice(1));for(const[n,s]of Object.entries(c)){const i=n.replace(Be,"");a&&!e.includes(i)||Ze(t,u,o,s.callable,s.delegationSelector)}}else{if(!Object.keys(c).length)return;Ze(t,u,o,r,i?n:null)}},trigger(t,e,n){if("string"!==typeof e||!t)return null;const s=Ee(),i=tn(e),r=e!==i;let o=null,a=!0,u=!0,c=!1;r&&s&&(o=s.Event(e,n),s(t).trigger(o),a=!o.isPropagationStopped(),u=!o.isImmediatePropagationStopped(),c=o.isDefaultPrevented());const l=nn(new Event(e,{bubbles:a,cancelable:!0}),n);return c&&l.preventDefault(),u&&t.dispatchEvent(l),l.defaultPrevented&&o&&o.preventDefault(),l}};function nn(t,e={}){for(const[s,i]of Object.entries(e))try{t[s]=i}catch(n){Object.defineProperty(t,s,{configurable:!0,get(){return i}})}return t}function sn(t){if("true"===t)return!0;if("false"===t)return!1;if(t===Number(t).toString())return Number(t);if(""===t||"null"===t)return null;if("string"!==typeof t)return t;try{return JSON.parse(decodeURIComponent(t))}catch(e){return t}}function rn(t){return t.replace(/[A-Z]/g,(t=>`-${t.toLowerCase()}`))}const on={setDataAttribute(t,e,n){t.setAttribute(`data-bs-${rn(e)}`,n)},removeDataAttribute(t,e){t.removeAttribute(`data-bs-${rn(e)}`)},getDataAttributes(t){if(!t)return{};const e={},n=Object.keys(t.dataset).filter((t=>t.startsWith("bs")&&!t.startsWith("bsConfig")));for(const s of n){let n=s.replace(/^bs/,"");n=n.charAt(0).toLowerCase()+n.slice(1,n.length),e[n]=sn(t.dataset[s])}return e},getDataAttribute(t,e){return sn(t.getAttribute(`data-bs-${rn(e)}`))}};class an{static get Default(){return{}}static get DefaultType(){return{}}static get NAME(){throw new Error('You have to implement the static method "NAME", for each component!')}_getConfig(t){return t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t}_mergeConfigObj(t,e){const n=ke(e)?on.getDataAttribute(e,"config"):{};return{...this.constructor.Default,..."object"===typeof n?n:{},...ke(e)?on.getDataAttributes(e):{},..."object"===typeof t?t:{}}}_typeCheckConfig(t,e=this.constructor.DefaultType){for(const[n,s]of Object.entries(e)){const e=t[n],i=ke(e)?"element":ve(e);if(!new RegExp(s).test(i))throw new TypeError(`${this.constructor.NAME.toUpperCase()}: Option "${n}" provided type "${i}" but expected type "${s}".`)}}}const un="5.3.3";class cn extends an{constructor(t,e){super(),t=Se(t),t&&(this._element=t,this._config=this._getConfig(e),fe.set(this._element,this.constructor.DATA_KEY,this))}dispose(){fe.remove(this._element,this.constructor.DATA_KEY),en.off(this._element,this.constructor.EVENT_KEY);for(const t of Object.getOwnPropertyNames(this))this[t]=null}_queueCallback(t,e,n=!0){Pe(t,e,n)}_getConfig(t){return t=this._mergeConfigObj(t,this._element),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}static getInstance(t){return fe.get(Se(t),this.DATA_KEY)}static getOrCreateInstance(t,e={}){return this.getInstance(t)||new this(t,"object"===typeof e?e:null)}static get VERSION(){return un}static get DATA_KEY(){return`bs.${this.NAME}`}static get EVENT_KEY(){return`.${this.DATA_KEY}`}static eventName(t){return`${t}${this.EVENT_KEY}`}}const ln=t=>{let e=t.getAttribute("data-bs-target");if(!e||"#"===e){let n=t.getAttribute("href");if(!n||!n.includes("#")&&!n.startsWith("."))return null;n.includes("#")&&!n.startsWith("#")&&(n=`#${n.split("#")[1]}`),e=n&&"#"!==n?n.trim():null}return e?e.split(",").map((t=>be(t))).join(","):null},hn={find(t,e=document.documentElement){return[].concat(...Element.prototype.querySelectorAll.call(e,t))},findOne(t,e=document.documentElement){return Element.prototype.querySelector.call(e,t)},children(t,e){return[].concat(...t.children).filter((t=>t.matches(e)))},parents(t,e){const n=[];let s=t.parentNode.closest(e);while(s)n.push(s),s=s.parentNode.closest(e);return n},prev(t,e){let n=t.previousElementSibling;while(n){if(n.matches(e))return[n];n=n.previousElementSibling}return[]},next(t,e){let n=t.nextElementSibling;while(n){if(n.matches(e))return[n];n=n.nextElementSibling}return[]},focusableChildren(t){const e=["a","button","input","textarea","select","details","[tabindex]",'[contenteditable="true"]'].map((t=>`${t}:not([tabindex^="-"])`)).join(",");return this.find(e,t).filter((t=>!Ie(t)&&Te(t)))},getSelectorFromElement(t){const e=ln(t);return e&&hn.findOne(e)?e:null},getElementFromSelector(t){const e=ln(t);return e?hn.findOne(e):null},getMultipleElementsFromSelector(t){const e=ln(t);return e?hn.find(e):[]}},pn=(t,e="hide")=>{const n=`click.dismiss${t.EVENT_KEY}`,s=t.NAME;en.on(document,n,`[data-bs-dismiss="${s}"]`,(function(n){if(["A","AREA"].includes(this.tagName)&&n.preventDefault(),Ie(this))return;const i=hn.getElementFromSelector(this)||this.closest(`.${s}`),r=t.getOrCreateInstance(i);r[e]()}))},dn="alert",fn="bs.alert",mn=`.${fn}`,gn=`close${mn}`,yn=`closed${mn}`,bn="fade",vn="show";class wn extends cn{static get NAME(){return dn}close(){const t=en.trigger(this._element,gn);if(t.defaultPrevented)return;this._element.classList.remove(vn);const e=this._element.classList.contains(bn);this._queueCallback((()=>this._destroyElement()),this._element,e)}_destroyElement(){this._element.remove(),en.trigger(this._element,yn),this.dispose()}static jQueryInterface(t){return this.each((function(){const e=wn.getOrCreateInstance(this);if("string"===typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}pn(wn,"close"),De(wn);const xn="button",_n="bs.button",kn=`.${_n}`,Sn=".data-api",Tn="active",In='[data-bs-toggle="button"]',Cn=`click${kn}${Sn}`;class An extends cn{static get NAME(){return xn}toggle(){this._element.setAttribute("aria-pressed",this._element.classList.toggle(Tn))}static jQueryInterface(t){return this.each((function(){const e=An.getOrCreateInstance(this);"toggle"===t&&e[t]()}))}}en.on(document,Cn,In,(t=>{t.preventDefault();const e=t.target.closest(In),n=An.getOrCreateInstance(e);n.toggle()})),De(An);const Nn="swipe",En=".bs.swipe",On=`touchstart${En}`,$n=`touchmove${En}`,Rn=`touchend${En}`,Dn=`pointerdown${En}`,Mn=`pointerup${En}`,Pn="touch",Fn="pen",Ln="pointer-event",zn=40,Bn={endCallback:null,leftCallback:null,rightCallback:null},qn={endCallback:"(function|null)",leftCallback:"(function|null)",rightCallback:"(function|null)"};class Vn extends an{constructor(t,e){super(),this._element=t,t&&Vn.isSupported()&&(this._config=this._getConfig(e),this._deltaX=0,this._supportPointerEvents=Boolean(window.PointerEvent),this._initEvents())}static get Default(){return Bn}static get DefaultType(){return qn}static get NAME(){return Nn}dispose(){en.off(this._element,En)}_start(t){this._supportPointerEvents?this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX):this._deltaX=t.touches[0].clientX}_end(t){this._eventIsPointerPenTouch(t)&&(this._deltaX=t.clientX-this._deltaX),this._handleSwipe(),Me(this._config.endCallback)}_move(t){this._deltaX=t.touches&&t.touches.length>1?0:t.touches[0].clientX-this._deltaX}_handleSwipe(){const t=Math.abs(this._deltaX);if(t<=zn)return;const e=t/this._deltaX;this._deltaX=0,e&&Me(e>0?this._config.rightCallback:this._config.leftCallback)}_initEvents(){this._supportPointerEvents?(en.on(this._element,Dn,(t=>this._start(t))),en.on(this._element,Mn,(t=>this._end(t))),this._element.classList.add(Ln)):(en.on(this._element,On,(t=>this._start(t))),en.on(this._element,$n,(t=>this._move(t))),en.on(this._element,Rn,(t=>this._end(t))))}_eventIsPointerPenTouch(t){return this._supportPointerEvents&&(t.pointerType===Fn||t.pointerType===Pn)}static isSupported(){return"ontouchstart"in document.documentElement||navigator.maxTouchPoints>0}}const Wn="carousel",jn="bs.carousel",Un=`.${jn}`,Gn=".data-api",Hn="ArrowLeft",Kn="ArrowRight",Xn=500,Qn="next",Yn="prev",Zn="left",Jn="right",ts=`slide${Un}`,es=`slid${Un}`,ns=`keydown${Un}`,ss=`mouseenter${Un}`,is=`mouseleave${Un}`,rs=`dragstart${Un}`,os=`load${Un}${Gn}`,as=`click${Un}${Gn}`,us="carousel",cs="active",ls="slide",hs="carousel-item-end",ps="carousel-item-start",ds="carousel-item-next",fs="carousel-item-prev",ms=".active",gs=".carousel-item",ys=ms+gs,bs=".carousel-item img",vs=".carousel-indicators",ws="[data-bs-slide], [data-bs-slide-to]",xs='[data-bs-ride="carousel"]',_s={[Hn]:Jn,[Kn]:Zn},ks={interval:5e3,keyboard:!0,pause:"hover",ride:!1,touch:!0,wrap:!0},Ss={interval:"(number|boolean)",keyboard:"boolean",pause:"(string|boolean)",ride:"(boolean|string)",touch:"boolean",wrap:"boolean"};class Ts extends cn{constructor(t,e){super(t,e),this._interval=null,this._activeElement=null,this._isSliding=!1,this.touchTimeout=null,this._swipeHelper=null,this._indicatorsElement=hn.findOne(vs,this._element),this._addEventListeners(),this._config.ride===us&&this.cycle()}static get Default(){return ks}static get DefaultType(){return Ss}static get NAME(){return Wn}next(){this._slide(Qn)}nextWhenVisible(){!document.hidden&&Te(this._element)&&this.next()}prev(){this._slide(Yn)}pause(){this._isSliding&&_e(this._element),this._clearInterval()}cycle(){this._clearInterval(),this._updateInterval(),this._interval=setInterval((()=>this.nextWhenVisible()),this._config.interval)}_maybeEnableCycle(){this._config.ride&&(this._isSliding?en.one(this._element,es,(()=>this.cycle())):this.cycle())}to(t){const e=this._getItems();if(t>e.length-1||t<0)return;if(this._isSliding)return void en.one(this._element,es,(()=>this.to(t)));const n=this._getItemIndex(this._getActive());if(n===t)return;const s=t>n?Qn:Yn;this._slide(s,e[t])}dispose(){this._swipeHelper&&this._swipeHelper.dispose(),super.dispose()}_configAfterMerge(t){return t.defaultInterval=t.interval,t}_addEventListeners(){this._config.keyboard&&en.on(this._element,ns,(t=>this._keydown(t))),"hover"===this._config.pause&&(en.on(this._element,ss,(()=>this.pause())),en.on(this._element,is,(()=>this._maybeEnableCycle()))),this._config.touch&&Vn.isSupported()&&this._addTouchEventListeners()}_addTouchEventListeners(){for(const n of hn.find(bs,this._element))en.on(n,rs,(t=>t.preventDefault()));const t=()=>{"hover"===this._config.pause&&(this.pause(),this.touchTimeout&&clearTimeout(this.touchTimeout),this.touchTimeout=setTimeout((()=>this._maybeEnableCycle()),Xn+this._config.interval))},e={leftCallback:()=>this._slide(this._directionToOrder(Zn)),rightCallback:()=>this._slide(this._directionToOrder(Jn)),endCallback:t};this._swipeHelper=new Vn(this._element,e)}_keydown(t){if(/input|textarea/i.test(t.target.tagName))return;const e=_s[t.key];e&&(t.preventDefault(),this._slide(this._directionToOrder(e)))}_getItemIndex(t){return this._getItems().indexOf(t)}_setActiveIndicatorElement(t){if(!this._indicatorsElement)return;const e=hn.findOne(ms,this._indicatorsElement);e.classList.remove(cs),e.removeAttribute("aria-current");const n=hn.findOne(`[data-bs-slide-to="${t}"]`,this._indicatorsElement);n&&(n.classList.add(cs),n.setAttribute("aria-current","true"))}_updateInterval(){const t=this._activeElement||this._getActive();if(!t)return;const e=Number.parseInt(t.getAttribute("data-bs-interval"),10);this._config.interval=e||this._config.defaultInterval}_slide(t,e=null){if(this._isSliding)return;const n=this._getActive(),s=t===Qn,i=e||Fe(this._getItems(),n,s,this._config.wrap);if(i===n)return;const r=this._getItemIndex(i),o=e=>en.trigger(this._element,e,{relatedTarget:i,direction:this._orderToDirection(t),from:this._getItemIndex(n),to:r}),a=o(ts);if(a.defaultPrevented)return;if(!n||!i)return;const u=Boolean(this._interval);this.pause(),this._isSliding=!0,this._setActiveIndicatorElement(r),this._activeElement=i;const c=s?ps:hs,l=s?ds:fs;i.classList.add(l),Ne(i),n.classList.add(c),i.classList.add(c);const h=()=>{i.classList.remove(c,l),i.classList.add(cs),n.classList.remove(cs,l,c),this._isSliding=!1,o(es)};this._queueCallback(h,n,this._isAnimated()),u&&this.cycle()}_isAnimated(){return this._element.classList.contains(ls)}_getActive(){return hn.findOne(ys,this._element)}_getItems(){return hn.find(gs,this._element)}_clearInterval(){this._interval&&(clearInterval(this._interval),this._interval=null)}_directionToOrder(t){return Re()?t===Zn?Yn:Qn:t===Zn?Qn:Yn}_orderToDirection(t){return Re()?t===Yn?Zn:Jn:t===Yn?Jn:Zn}static jQueryInterface(t){return this.each((function(){const e=Ts.getOrCreateInstance(this,t);if("number"!==typeof t){if("string"===typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}else e.to(t)}))}}en.on(document,as,ws,(function(t){const e=hn.getElementFromSelector(this);if(!e||!e.classList.contains(us))return;t.preventDefault();const n=Ts.getOrCreateInstance(e),s=this.getAttribute("data-bs-slide-to");return s?(n.to(s),void n._maybeEnableCycle()):"next"===on.getDataAttribute(this,"slide")?(n.next(),void n._maybeEnableCycle()):(n.prev(),void n._maybeEnableCycle())})),en.on(window,os,(()=>{const t=hn.find(xs);for(const e of t)Ts.getOrCreateInstance(e)})),De(Ts);const Is="collapse",Cs="bs.collapse",As=`.${Cs}`,Ns=".data-api",Es=`show${As}`,Os=`shown${As}`,$s=`hide${As}`,Rs=`hidden${As}`,Ds=`click${As}${Ns}`,Ms="show",Ps="collapse",Fs="collapsing",Ls="collapsed",zs=`:scope .${Ps} .${Ps}`,Bs="collapse-horizontal",qs="width",Vs="height",Ws=".collapse.show, .collapse.collapsing",js='[data-bs-toggle="collapse"]',Us={parent:null,toggle:!0},Gs={parent:"(null|element)",toggle:"boolean"};class Hs extends cn{constructor(t,e){super(t,e),this._isTransitioning=!1,this._triggerArray=[];const n=hn.find(js);for(const s of n){const t=hn.getSelectorFromElement(s),e=hn.find(t).filter((t=>t===this._element));null!==t&&e.length&&this._triggerArray.push(s)}this._initializeChildren(),this._config.parent||this._addAriaAndCollapsedClass(this._triggerArray,this._isShown()),this._config.toggle&&this.toggle()}static get Default(){return Us}static get DefaultType(){return Gs}static get NAME(){return Is}toggle(){this._isShown()?this.hide():this.show()}show(){if(this._isTransitioning||this._isShown())return;let t=[];if(this._config.parent&&(t=this._getFirstLevelChildren(Ws).filter((t=>t!==this._element)).map((t=>Hs.getOrCreateInstance(t,{toggle:!1})))),t.length&&t[0]._isTransitioning)return;const e=en.trigger(this._element,Es);if(e.defaultPrevented)return;for(const o of t)o.hide();const n=this._getDimension();this._element.classList.remove(Ps),this._element.classList.add(Fs),this._element.style[n]=0,this._addAriaAndCollapsedClass(this._triggerArray,!0),this._isTransitioning=!0;const s=()=>{this._isTransitioning=!1,this._element.classList.remove(Fs),this._element.classList.add(Ps,Ms),this._element.style[n]="",en.trigger(this._element,Os)},i=n[0].toUpperCase()+n.slice(1),r=`scroll${i}`;this._queueCallback(s,this._element,!0),this._element.style[n]=`${this._element[r]}px`}hide(){if(this._isTransitioning||!this._isShown())return;const t=en.trigger(this._element,$s);if(t.defaultPrevented)return;const e=this._getDimension();this._element.style[e]=`${this._element.getBoundingClientRect()[e]}px`,Ne(this._element),this._element.classList.add(Fs),this._element.classList.remove(Ps,Ms);for(const s of this._triggerArray){const t=hn.getElementFromSelector(s);t&&!this._isShown(t)&&this._addAriaAndCollapsedClass([s],!1)}this._isTransitioning=!0;const n=()=>{this._isTransitioning=!1,this._element.classList.remove(Fs),this._element.classList.add(Ps),en.trigger(this._element,Rs)};this._element.style[e]="",this._queueCallback(n,this._element,!0)}_isShown(t=this._element){return t.classList.contains(Ms)}_configAfterMerge(t){return t.toggle=Boolean(t.toggle),t.parent=Se(t.parent),t}_getDimension(){return this._element.classList.contains(Bs)?qs:Vs}_initializeChildren(){if(!this._config.parent)return;const t=this._getFirstLevelChildren(js);for(const e of t){const t=hn.getElementFromSelector(e);t&&this._addAriaAndCollapsedClass([e],this._isShown(t))}}_getFirstLevelChildren(t){const e=hn.find(zs,this._config.parent);return hn.find(t,this._config.parent).filter((t=>!e.includes(t)))}_addAriaAndCollapsedClass(t,e){if(t.length)for(const n of t)n.classList.toggle(Ls,!e),n.setAttribute("aria-expanded",e)}static jQueryInterface(t){const e={};return"string"===typeof t&&/show|hide/.test(t)&&(e.toggle=!1),this.each((function(){const n=Hs.getOrCreateInstance(this,e);if("string"===typeof t){if("undefined"===typeof n[t])throw new TypeError(`No method named "${t}"`);n[t]()}}))}}en.on(document,Ds,js,(function(t){("A"===t.target.tagName||t.delegateTarget&&"A"===t.delegateTarget.tagName)&&t.preventDefault();for(const e of hn.getMultipleElementsFromSelector(this))Hs.getOrCreateInstance(e,{toggle:!1}).toggle()})),De(Hs);const Ks="dropdown",Xs="bs.dropdown",Qs=`.${Xs}`,Ys=".data-api",Zs="Escape",Js="Tab",ti="ArrowUp",ei="ArrowDown",ni=2,si=`hide${Qs}`,ii=`hidden${Qs}`,ri=`show${Qs}`,oi=`shown${Qs}`,ai=`click${Qs}${Ys}`,ui=`keydown${Qs}${Ys}`,ci=`keyup${Qs}${Ys}`,li="show",hi="dropup",pi="dropend",di="dropstart",fi="dropup-center",mi="dropdown-center",gi='[data-bs-toggle="dropdown"]:not(.disabled):not(:disabled)',yi=`${gi}.${li}`,bi=".dropdown-menu",vi=".navbar",wi=".navbar-nav",xi=".dropdown-menu .dropdown-item:not(.disabled):not(:disabled)",_i=Re()?"top-end":"top-start",ki=Re()?"top-start":"top-end",Si=Re()?"bottom-end":"bottom-start",Ti=Re()?"bottom-start":"bottom-end",Ii=Re()?"left-start":"right-start",Ci=Re()?"right-start":"left-start",Ai="top",Ni="bottom",Ei={autoClose:!0,boundary:"clippingParents",display:"dynamic",offset:[0,2],popperConfig:null,reference:"toggle"},Oi={autoClose:"(boolean|string)",boundary:"(string|element)",display:"string",offset:"(array|string|function)",popperConfig:"(null|object|function)",reference:"(string|element|object)"};class $i extends cn{constructor(t,e){super(t,e),this._popper=null,this._parent=this._element.parentNode,this._menu=hn.next(this._element,bi)[0]||hn.prev(this._element,bi)[0]||hn.findOne(bi,this._parent),this._inNavbar=this._detectNavbar()}static get Default(){return Ei}static get DefaultType(){return Oi}static get NAME(){return Ks}toggle(){return this._isShown()?this.hide():this.show()}show(){if(Ie(this._element)||this._isShown())return;const t={relatedTarget:this._element},e=en.trigger(this._element,ri,t);if(!e.defaultPrevented){if(this._createPopper(),"ontouchstart"in document.documentElement&&!this._parent.closest(wi))for(const t of[].concat(...document.body.children))en.on(t,"mouseover",Ae);this._element.focus(),this._element.setAttribute("aria-expanded",!0),this._menu.classList.add(li),this._element.classList.add(li),en.trigger(this._element,oi,t)}}hide(){if(Ie(this._element)||!this._isShown())return;const t={relatedTarget:this._element};this._completeHide(t)}dispose(){this._popper&&this._popper.destroy(),super.dispose()}update(){this._inNavbar=this._detectNavbar(),this._popper&&this._popper.update()}_completeHide(t){const e=en.trigger(this._element,si,t);if(!e.defaultPrevented){if("ontouchstart"in document.documentElement)for(const t of[].concat(...document.body.children))en.off(t,"mouseover",Ae);this._popper&&this._popper.destroy(),this._menu.classList.remove(li),this._element.classList.remove(li),this._element.setAttribute("aria-expanded","false"),on.removeDataAttribute(this._menu,"popper"),en.trigger(this._element,ii,t)}}_getConfig(t){if(t=super._getConfig(t),"object"===typeof t.reference&&!ke(t.reference)&&"function"!==typeof t.reference.getBoundingClientRect)throw new TypeError(`${Ks.toUpperCase()}: Option "reference" provided type "object" without a required "getBoundingClientRect" method.`);return t}_createPopper(){if("undefined"===typeof s)throw new TypeError("Bootstrap's dropdowns require Popper (https://popper.js.org)");let t=this._element;"parent"===this._config.reference?t=this._parent:ke(this._config.reference)?t=Se(this._config.reference):"object"===typeof this._config.reference&&(t=this._config.reference);const e=this._getPopperConfig();this._popper=le(t,this._menu,e)}_isShown(){return this._menu.classList.contains(li)}_getPlacement(){const t=this._parent;if(t.classList.contains(pi))return Ii;if(t.classList.contains(di))return Ci;if(t.classList.contains(fi))return Ai;if(t.classList.contains(mi))return Ni;const e="end"===getComputedStyle(this._menu).getPropertyValue("--bs-position").trim();return t.classList.contains(hi)?e?ki:_i:e?Ti:Si}_detectNavbar(){return null!==this._element.closest(vi)}_getOffset(){const{offset:t}=this._config;return"string"===typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"===typeof t?e=>t(e,this._element):t}_getPopperConfig(){const t={placement:this._getPlacement(),modifiers:[{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"offset",options:{offset:this._getOffset()}}]};return(this._inNavbar||"static"===this._config.display)&&(on.setDataAttribute(this._menu,"popper","static"),t.modifiers=[{name:"applyStyles",enabled:!1}]),{...t,...Me(this._config.popperConfig,[t])}}_selectMenuItem({key:t,target:e}){const n=hn.find(xi,this._menu).filter((t=>Te(t)));n.length&&Fe(n,e,t===ei,!n.includes(e)).focus()}static jQueryInterface(t){return this.each((function(){const e=$i.getOrCreateInstance(this,t);if("string"===typeof t){if("undefined"===typeof e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}static clearMenus(t){if(t.button===ni||"keyup"===t.type&&t.key!==Js)return;const e=hn.find(yi);for(const n of e){const e=$i.getInstance(n);if(!e||!1===e._config.autoClose)continue;const s=t.composedPath(),i=s.includes(e._menu);if(s.includes(e._element)||"inside"===e._config.autoClose&&!i||"outside"===e._config.autoClose&&i)continue;if(e._menu.contains(t.target)&&("keyup"===t.type&&t.key===Js||/input|select|option|textarea|form/i.test(t.target.tagName)))continue;const r={relatedTarget:e._element};"click"===t.type&&(r.clickEvent=t),e._completeHide(r)}}static dataApiKeydownHandler(t){const e=/input|textarea/i.test(t.target.tagName),n=t.key===Zs,s=[ti,ei].includes(t.key);if(!s&&!n)return;if(e&&!n)return;t.preventDefault();const i=this.matches(gi)?this:hn.prev(this,gi)[0]||hn.next(this,gi)[0]||hn.findOne(gi,t.delegateTarget.parentNode),r=$i.getOrCreateInstance(i);if(s)return t.stopPropagation(),r.show(),void r._selectMenuItem(t);r._isShown()&&(t.stopPropagation(),r.hide(),i.focus())}}en.on(document,ui,gi,$i.dataApiKeydownHandler),en.on(document,ui,bi,$i.dataApiKeydownHandler),en.on(document,ai,$i.clearMenus),en.on(document,ci,$i.clearMenus),en.on(document,ai,gi,(function(t){t.preventDefault(),$i.getOrCreateInstance(this).toggle()})),De($i);const Ri="backdrop",Di="fade",Mi="show",Pi=`mousedown.bs.${Ri}`,Fi={className:"modal-backdrop",clickCallback:null,isAnimated:!1,isVisible:!0,rootElement:"body"},Li={className:"string",clickCallback:"(function|null)",isAnimated:"boolean",isVisible:"boolean",rootElement:"(element|string)"};class zi extends an{constructor(t){super(),this._config=this._getConfig(t),this._isAppended=!1,this._element=null}static get Default(){return Fi}static get DefaultType(){return Li}static get NAME(){return Ri}show(t){if(!this._config.isVisible)return void Me(t);this._append();const e=this._getElement();this._config.isAnimated&&Ne(e),e.classList.add(Mi),this._emulateAnimation((()=>{Me(t)}))}hide(t){this._config.isVisible?(this._getElement().classList.remove(Mi),this._emulateAnimation((()=>{this.dispose(),Me(t)}))):Me(t)}dispose(){this._isAppended&&(en.off(this._element,Pi),this._element.remove(),this._isAppended=!1)}_getElement(){if(!this._element){const t=document.createElement("div");t.className=this._config.className,this._config.isAnimated&&t.classList.add(Di),this._element=t}return this._element}_configAfterMerge(t){return t.rootElement=Se(t.rootElement),t}_append(){if(this._isAppended)return;const t=this._getElement();this._config.rootElement.append(t),en.on(t,Pi,(()=>{Me(this._config.clickCallback)})),this._isAppended=!0}_emulateAnimation(t){Pe(t,this._getElement(),this._config.isAnimated)}}const Bi="focustrap",qi="bs.focustrap",Vi=`.${qi}`,Wi=`focusin${Vi}`,ji=`keydown.tab${Vi}`,Ui="Tab",Gi="forward",Hi="backward",Ki={autofocus:!0,trapElement:null},Xi={autofocus:"boolean",trapElement:"element"};class Qi extends an{constructor(t){super(),this._config=this._getConfig(t),this._isActive=!1,this._lastTabNavDirection=null}static get Default(){return Ki}static get DefaultType(){return Xi}static get NAME(){return Bi}activate(){this._isActive||(this._config.autofocus&&this._config.trapElement.focus(),en.off(document,Vi),en.on(document,Wi,(t=>this._handleFocusin(t))),en.on(document,ji,(t=>this._handleKeydown(t))),this._isActive=!0)}deactivate(){this._isActive&&(this._isActive=!1,en.off(document,Vi))}_handleFocusin(t){const{trapElement:e}=this._config;if(t.target===document||t.target===e||e.contains(t.target))return;const n=hn.focusableChildren(e);0===n.length?e.focus():this._lastTabNavDirection===Hi?n[n.length-1].focus():n[0].focus()}_handleKeydown(t){t.key===Ui&&(this._lastTabNavDirection=t.shiftKey?Hi:Gi)}}const Yi=".fixed-top, .fixed-bottom, .is-fixed, .sticky-top",Zi=".sticky-top",Ji="padding-right",tr="margin-right";class er{constructor(){this._element=document.body}getWidth(){const t=document.documentElement.clientWidth;return Math.abs(window.innerWidth-t)}hide(){const t=this.getWidth();this._disableOverFlow(),this._setElementAttributes(this._element,Ji,(e=>e+t)),this._setElementAttributes(Yi,Ji,(e=>e+t)),this._setElementAttributes(Zi,tr,(e=>e-t))}reset(){this._resetElementAttributes(this._element,"overflow"),this._resetElementAttributes(this._element,Ji),this._resetElementAttributes(Yi,Ji),this._resetElementAttributes(Zi,tr)}isOverflowing(){return this.getWidth()>0}_disableOverFlow(){this._saveInitialAttribute(this._element,"overflow"),this._element.style.overflow="hidden"}_setElementAttributes(t,e,n){const s=this.getWidth(),i=t=>{if(t!==this._element&&window.innerWidth>t.clientWidth+s)return;this._saveInitialAttribute(t,e);const i=window.getComputedStyle(t).getPropertyValue(e);t.style.setProperty(e,`${n(Number.parseFloat(i))}px`)};this._applyManipulationCallback(t,i)}_saveInitialAttribute(t,e){const n=t.style.getPropertyValue(e);n&&on.setDataAttribute(t,e,n)}_resetElementAttributes(t,e){const n=t=>{const n=on.getDataAttribute(t,e);null!==n?(on.removeDataAttribute(t,e),t.style.setProperty(e,n)):t.style.removeProperty(e)};this._applyManipulationCallback(t,n)}_applyManipulationCallback(t,e){if(ke(t))e(t);else for(const n of hn.find(t,this._element))e(n)}}const nr="modal",sr="bs.modal",ir=`.${sr}`,rr=".data-api",or="Escape",ar=`hide${ir}`,ur=`hidePrevented${ir}`,cr=`hidden${ir}`,lr=`show${ir}`,hr=`shown${ir}`,pr=`resize${ir}`,dr=`click.dismiss${ir}`,fr=`mousedown.dismiss${ir}`,mr=`keydown.dismiss${ir}`,gr=`click${ir}${rr}`,yr="modal-open",br="fade",vr="show",wr="modal-static",xr=".modal.show",_r=".modal-dialog",kr=".modal-body",Sr='[data-bs-toggle="modal"]',Tr={backdrop:!0,focus:!0,keyboard:!0},Ir={backdrop:"(boolean|string)",focus:"boolean",keyboard:"boolean"};class Cr extends cn{constructor(t,e){super(t,e),this._dialog=hn.findOne(_r,this._element),this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._isShown=!1,this._isTransitioning=!1,this._scrollBar=new er,this._addEventListeners()}static get Default(){return Tr}static get DefaultType(){return Ir}static get NAME(){return nr}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown||this._isTransitioning)return;const e=en.trigger(this._element,lr,{relatedTarget:t});e.defaultPrevented||(this._isShown=!0,this._isTransitioning=!0,this._scrollBar.hide(),document.body.classList.add(yr),this._adjustDialog(),this._backdrop.show((()=>this._showElement(t))))}hide(){if(!this._isShown||this._isTransitioning)return;const t=en.trigger(this._element,ar);t.defaultPrevented||(this._isShown=!1,this._isTransitioning=!0,this._focustrap.deactivate(),this._element.classList.remove(vr),this._queueCallback((()=>this._hideModal()),this._element,this._isAnimated()))}dispose(){en.off(window,ir),en.off(this._dialog,ir),this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}handleUpdate(){this._adjustDialog()}_initializeBackDrop(){return new zi({isVisible:Boolean(this._config.backdrop),isAnimated:this._isAnimated()})}_initializeFocusTrap(){return new Qi({trapElement:this._element})}_showElement(t){document.body.contains(this._element)||document.body.append(this._element),this._element.style.display="block",this._element.removeAttribute("aria-hidden"),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.scrollTop=0;const e=hn.findOne(kr,this._dialog);e&&(e.scrollTop=0),Ne(this._element),this._element.classList.add(vr);const n=()=>{this._config.focus&&this._focustrap.activate(),this._isTransitioning=!1,en.trigger(this._element,hr,{relatedTarget:t})};this._queueCallback(n,this._dialog,this._isAnimated())}_addEventListeners(){en.on(this._element,mr,(t=>{t.key===or&&(this._config.keyboard?this.hide():this._triggerBackdropTransition())})),en.on(window,pr,(()=>{this._isShown&&!this._isTransitioning&&this._adjustDialog()})),en.on(this._element,fr,(t=>{en.one(this._element,dr,(e=>{this._element===t.target&&this._element===e.target&&("static"!==this._config.backdrop?this._config.backdrop&&this.hide():this._triggerBackdropTransition())}))}))}_hideModal(){this._element.style.display="none",this._element.setAttribute("aria-hidden",!0),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._isTransitioning=!1,this._backdrop.hide((()=>{document.body.classList.remove(yr),this._resetAdjustments(),this._scrollBar.reset(),en.trigger(this._element,cr)}))}_isAnimated(){return this._element.classList.contains(br)}_triggerBackdropTransition(){const t=en.trigger(this._element,ur);if(t.defaultPrevented)return;const e=this._element.scrollHeight>document.documentElement.clientHeight,n=this._element.style.overflowY;"hidden"===n||this._element.classList.contains(wr)||(e||(this._element.style.overflowY="hidden"),this._element.classList.add(wr),this._queueCallback((()=>{this._element.classList.remove(wr),this._queueCallback((()=>{this._element.style.overflowY=n}),this._dialog)}),this._dialog),this._element.focus())}_adjustDialog(){const t=this._element.scrollHeight>document.documentElement.clientHeight,e=this._scrollBar.getWidth(),n=e>0;if(n&&!t){const t=Re()?"paddingLeft":"paddingRight";this._element.style[t]=`${e}px`}if(!n&&t){const t=Re()?"paddingRight":"paddingLeft";this._element.style[t]=`${e}px`}}_resetAdjustments(){this._element.style.paddingLeft="",this._element.style.paddingRight=""}static jQueryInterface(t,e){return this.each((function(){const n=Cr.getOrCreateInstance(this,t);if("string"===typeof t){if("undefined"===typeof n[t])throw new TypeError(`No method named "${t}"`);n[t](e)}}))}}en.on(document,gr,Sr,(function(t){const e=hn.getElementFromSelector(this);["A","AREA"].includes(this.tagName)&&t.preventDefault(),en.one(e,lr,(t=>{t.defaultPrevented||en.one(e,cr,(()=>{Te(this)&&this.focus()}))}));const n=hn.findOne(xr);n&&Cr.getInstance(n).hide();const s=Cr.getOrCreateInstance(e);s.toggle(this)})),pn(Cr),De(Cr);const Ar="offcanvas",Nr="bs.offcanvas",Er=`.${Nr}`,Or=".data-api",$r=`load${Er}${Or}`,Rr="Escape",Dr="show",Mr="showing",Pr="hiding",Fr="offcanvas-backdrop",Lr=".offcanvas.show",zr=`show${Er}`,Br=`shown${Er}`,qr=`hide${Er}`,Vr=`hidePrevented${Er}`,Wr=`hidden${Er}`,jr=`resize${Er}`,Ur=`click${Er}${Or}`,Gr=`keydown.dismiss${Er}`,Hr='[data-bs-toggle="offcanvas"]',Kr={backdrop:!0,keyboard:!0,scroll:!1},Xr={backdrop:"(boolean|string)",keyboard:"boolean",scroll:"boolean"};class Qr extends cn{constructor(t,e){super(t,e),this._isShown=!1,this._backdrop=this._initializeBackDrop(),this._focustrap=this._initializeFocusTrap(),this._addEventListeners()}static get Default(){return Kr}static get DefaultType(){return Xr}static get NAME(){return Ar}toggle(t){return this._isShown?this.hide():this.show(t)}show(t){if(this._isShown)return;const e=en.trigger(this._element,zr,{relatedTarget:t});if(e.defaultPrevented)return;this._isShown=!0,this._backdrop.show(),this._config.scroll||(new er).hide(),this._element.setAttribute("aria-modal",!0),this._element.setAttribute("role","dialog"),this._element.classList.add(Mr);const n=()=>{this._config.scroll&&!this._config.backdrop||this._focustrap.activate(),this._element.classList.add(Dr),this._element.classList.remove(Mr),en.trigger(this._element,Br,{relatedTarget:t})};this._queueCallback(n,this._element,!0)}hide(){if(!this._isShown)return;const t=en.trigger(this._element,qr);if(t.defaultPrevented)return;this._focustrap.deactivate(),this._element.blur(),this._isShown=!1,this._element.classList.add(Pr),this._backdrop.hide();const e=()=>{this._element.classList.remove(Dr,Pr),this._element.removeAttribute("aria-modal"),this._element.removeAttribute("role"),this._config.scroll||(new er).reset(),en.trigger(this._element,Wr)};this._queueCallback(e,this._element,!0)}dispose(){this._backdrop.dispose(),this._focustrap.deactivate(),super.dispose()}_initializeBackDrop(){const t=()=>{"static"!==this._config.backdrop?this.hide():en.trigger(this._element,Vr)},e=Boolean(this._config.backdrop);return new zi({className:Fr,isVisible:e,isAnimated:!0,rootElement:this._element.parentNode,clickCallback:e?t:null})}_initializeFocusTrap(){return new Qi({trapElement:this._element})}_addEventListeners(){en.on(this._element,Gr,(t=>{t.key===Rr&&(this._config.keyboard?this.hide():en.trigger(this._element,Vr))}))}static jQueryInterface(t){return this.each((function(){const e=Qr.getOrCreateInstance(this,t);if("string"===typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}en.on(document,Ur,Hr,(function(t){const e=hn.getElementFromSelector(this);if(["A","AREA"].includes(this.tagName)&&t.preventDefault(),Ie(this))return;en.one(e,Wr,(()=>{Te(this)&&this.focus()}));const n=hn.findOne(Lr);n&&n!==e&&Qr.getInstance(n).hide();const s=Qr.getOrCreateInstance(e);s.toggle(this)})),en.on(window,$r,(()=>{for(const t of hn.find(Lr))Qr.getOrCreateInstance(t).show()})),en.on(window,jr,(()=>{for(const t of hn.find("[aria-modal][class*=show][class*=offcanvas-]"))"fixed"!==getComputedStyle(t).position&&Qr.getOrCreateInstance(t).hide()})),pn(Qr),De(Qr);const Yr=/^aria-[\w-]*$/i,Zr={"*":["class","dir","id","lang","role",Yr],a:["target","href","title","rel"],area:[],b:[],br:[],col:[],code:[],dd:[],div:[],dl:[],dt:[],em:[],hr:[],h1:[],h2:[],h3:[],h4:[],h5:[],h6:[],i:[],img:["src","srcset","alt","title","width","height"],li:[],ol:[],p:[],pre:[],s:[],small:[],span:[],sub:[],sup:[],strong:[],u:[],ul:[]},Jr=new Set(["background","cite","href","itemtype","longdesc","poster","src","xlink:href"]),to=/^(?!javascript:)(?:[a-z0-9+.-]+:|[^&:/?#]*(?:[/?#]|$))/i,eo=(t,e)=>{const n=t.nodeName.toLowerCase();return e.includes(n)?!Jr.has(n)||Boolean(to.test(t.nodeValue)):e.filter((t=>t instanceof RegExp)).some((t=>t.test(n)))};function no(t,e,n){if(!t.length)return t;if(n&&"function"===typeof n)return n(t);const s=new window.DOMParser,i=s.parseFromString(t,"text/html"),r=[].concat(...i.body.querySelectorAll("*"));for(const o of r){const t=o.nodeName.toLowerCase();if(!Object.keys(e).includes(t)){o.remove();continue}const n=[].concat(...o.attributes),s=[].concat(e["*"]||[],e[t]||[]);for(const e of n)eo(e,s)||o.removeAttribute(e.nodeName)}return i.body.innerHTML}const so="TemplateFactory",io={allowList:Zr,content:{},extraClass:"",html:!1,sanitize:!0,sanitizeFn:null,template:"<div></div>"},ro={allowList:"object",content:"object",extraClass:"(string|function)",html:"boolean",sanitize:"boolean",sanitizeFn:"(null|function)",template:"string"},oo={entry:"(string|element|function|null)",selector:"(string|element)"};class ao extends an{constructor(t){super(),this._config=this._getConfig(t)}static get Default(){return io}static get DefaultType(){return ro}static get NAME(){return so}getContent(){return Object.values(this._config.content).map((t=>this._resolvePossibleFunction(t))).filter(Boolean)}hasContent(){return this.getContent().length>0}changeContent(t){return this._checkContent(t),this._config.content={...this._config.content,...t},this}toHtml(){const t=document.createElement("div");t.innerHTML=this._maybeSanitize(this._config.template);for(const[s,i]of Object.entries(this._config.content))this._setContent(t,i,s);const e=t.children[0],n=this._resolvePossibleFunction(this._config.extraClass);return n&&e.classList.add(...n.split(" ")),e}_typeCheckConfig(t){super._typeCheckConfig(t),this._checkContent(t.content)}_checkContent(t){for(const[e,n]of Object.entries(t))super._typeCheckConfig({selector:e,entry:n},oo)}_setContent(t,e,n){const s=hn.findOne(n,t);s&&(e=this._resolvePossibleFunction(e),e?ke(e)?this._putElementInTemplate(Se(e),s):this._config.html?s.innerHTML=this._maybeSanitize(e):s.textContent=e:s.remove())}_maybeSanitize(t){return this._config.sanitize?no(t,this._config.allowList,this._config.sanitizeFn):t}_resolvePossibleFunction(t){return Me(t,[this])}_putElementInTemplate(t,e){if(this._config.html)return e.innerHTML="",void e.append(t);e.textContent=t.textContent}}const uo="tooltip",co=new Set(["sanitize","allowList","sanitizeFn"]),lo="fade",ho="modal",po="show",fo=".tooltip-inner",mo=`.${ho}`,go="hide.bs.modal",yo="hover",bo="focus",vo="click",wo="manual",xo="hide",_o="hidden",ko="show",So="shown",To="inserted",Io="click",Co="focusin",Ao="focusout",No="mouseenter",Eo="mouseleave",Oo={AUTO:"auto",TOP:"top",RIGHT:Re()?"left":"right",BOTTOM:"bottom",LEFT:Re()?"right":"left"},$o={allowList:Zr,animation:!0,boundary:"clippingParents",container:!1,customClass:"",delay:0,fallbackPlacements:["top","right","bottom","left"],html:!1,offset:[0,6],placement:"top",popperConfig:null,sanitize:!0,sanitizeFn:null,selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',title:"",trigger:"hover focus"},Ro={allowList:"object",animation:"boolean",boundary:"(string|element)",container:"(string|element|boolean)",customClass:"(string|function)",delay:"(number|object)",fallbackPlacements:"array",html:"boolean",offset:"(array|string|function)",placement:"(string|function)",popperConfig:"(null|object|function)",sanitize:"boolean",sanitizeFn:"(null|function)",selector:"(string|boolean)",template:"string",title:"(string|element|function)",trigger:"string"};class Do extends cn{constructor(t,e){if("undefined"===typeof s)throw new TypeError("Bootstrap's tooltips require Popper (https://popper.js.org)");super(t,e),this._isEnabled=!0,this._timeout=0,this._isHovered=null,this._activeTrigger={},this._popper=null,this._templateFactory=null,this._newContent=null,this.tip=null,this._setListeners(),this._config.selector||this._fixTitle()}static get Default(){return $o}static get DefaultType(){return Ro}static get NAME(){return uo}enable(){this._isEnabled=!0}disable(){this._isEnabled=!1}toggleEnabled(){this._isEnabled=!this._isEnabled}toggle(){this._isEnabled&&(this._activeTrigger.click=!this._activeTrigger.click,this._isShown()?this._leave():this._enter())}dispose(){clearTimeout(this._timeout),en.off(this._element.closest(mo),go,this._hideModalHandler),this._element.getAttribute("data-bs-original-title")&&this._element.setAttribute("title",this._element.getAttribute("data-bs-original-title")),this._disposePopper(),super.dispose()}show(){if("none"===this._element.style.display)throw new Error("Please use show on visible elements");if(!this._isWithContent()||!this._isEnabled)return;const t=en.trigger(this._element,this.constructor.eventName(ko)),e=Ce(this._element),n=(e||this._element.ownerDocument.documentElement).contains(this._element);if(t.defaultPrevented||!n)return;this._disposePopper();const s=this._getTipElement();this._element.setAttribute("aria-describedby",s.getAttribute("id"));const{container:i}=this._config;if(this._element.ownerDocument.documentElement.contains(this.tip)||(i.append(s),en.trigger(this._element,this.constructor.eventName(To))),this._popper=this._createPopper(s),s.classList.add(po),"ontouchstart"in document.documentElement)for(const o of[].concat(...document.body.children))en.on(o,"mouseover",Ae);const r=()=>{en.trigger(this._element,this.constructor.eventName(So)),!1===this._isHovered&&this._leave(),this._isHovered=!1};this._queueCallback(r,this.tip,this._isAnimated())}hide(){if(!this._isShown())return;const t=en.trigger(this._element,this.constructor.eventName(xo));if(t.defaultPrevented)return;const e=this._getTipElement();if(e.classList.remove(po),"ontouchstart"in document.documentElement)for(const s of[].concat(...document.body.children))en.off(s,"mouseover",Ae);this._activeTrigger[vo]=!1,this._activeTrigger[bo]=!1,this._activeTrigger[yo]=!1,this._isHovered=null;const n=()=>{this._isWithActiveTrigger()||(this._isHovered||this._disposePopper(),this._element.removeAttribute("aria-describedby"),en.trigger(this._element,this.constructor.eventName(_o)))};this._queueCallback(n,this.tip,this._isAnimated())}update(){this._popper&&this._popper.update()}_isWithContent(){return Boolean(this._getTitle())}_getTipElement(){return this.tip||(this.tip=this._createTipElement(this._newContent||this._getContentForTemplate())),this.tip}_createTipElement(t){const e=this._getTemplateFactory(t).toHtml();if(!e)return null;e.classList.remove(lo,po),e.classList.add(`bs-${this.constructor.NAME}-auto`);const n=we(this.constructor.NAME).toString();return e.setAttribute("id",n),this._isAnimated()&&e.classList.add(lo),e}setContent(t){this._newContent=t,this._isShown()&&(this._disposePopper(),this.show())}_getTemplateFactory(t){return this._templateFactory?this._templateFactory.changeContent(t):this._templateFactory=new ao({...this._config,content:t,extraClass:this._resolvePossibleFunction(this._config.customClass)}),this._templateFactory}_getContentForTemplate(){return{[fo]:this._getTitle()}}_getTitle(){return this._resolvePossibleFunction(this._config.title)||this._element.getAttribute("data-bs-original-title")}_initializeOnDelegatedTarget(t){return this.constructor.getOrCreateInstance(t.delegateTarget,this._getDelegateConfig())}_isAnimated(){return this._config.animation||this.tip&&this.tip.classList.contains(lo)}_isShown(){return this.tip&&this.tip.classList.contains(po)}_createPopper(t){const e=Me(this._config.placement,[this,t,this._element]),n=Oo[e.toUpperCase()];return le(this._element,t,this._getPopperConfig(n))}_getOffset(){const{offset:t}=this._config;return"string"===typeof t?t.split(",").map((t=>Number.parseInt(t,10))):"function"===typeof t?e=>t(e,this._element):t}_resolvePossibleFunction(t){return Me(t,[this._element])}_getPopperConfig(t){const e={placement:t,modifiers:[{name:"flip",options:{fallbackPlacements:this._config.fallbackPlacements}},{name:"offset",options:{offset:this._getOffset()}},{name:"preventOverflow",options:{boundary:this._config.boundary}},{name:"arrow",options:{element:`.${this.constructor.NAME}-arrow`}},{name:"preSetPlacement",enabled:!0,phase:"beforeMain",fn:t=>{this._getTipElement().setAttribute("data-popper-placement",t.state.placement)}}]};return{...e,...Me(this._config.popperConfig,[e])}}_setListeners(){const t=this._config.trigger.split(" ");for(const e of t)if("click"===e)en.on(this._element,this.constructor.eventName(Io),this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e.toggle()}));else if(e!==wo){const t=e===yo?this.constructor.eventName(No):this.constructor.eventName(Co),n=e===yo?this.constructor.eventName(Eo):this.constructor.eventName(Ao);en.on(this._element,t,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusin"===t.type?bo:yo]=!0,e._enter()})),en.on(this._element,n,this._config.selector,(t=>{const e=this._initializeOnDelegatedTarget(t);e._activeTrigger["focusout"===t.type?bo:yo]=e._element.contains(t.relatedTarget),e._leave()}))}this._hideModalHandler=()=>{this._element&&this.hide()},en.on(this._element.closest(mo),go,this._hideModalHandler)}_fixTitle(){const t=this._element.getAttribute("title");t&&(this._element.getAttribute("aria-label")||this._element.textContent.trim()||this._element.setAttribute("aria-label",t),this._element.setAttribute("data-bs-original-title",t),this._element.removeAttribute("title"))}_enter(){this._isShown()||this._isHovered?this._isHovered=!0:(this._isHovered=!0,this._setTimeout((()=>{this._isHovered&&this.show()}),this._config.delay.show))}_leave(){this._isWithActiveTrigger()||(this._isHovered=!1,this._setTimeout((()=>{this._isHovered||this.hide()}),this._config.delay.hide))}_setTimeout(t,e){clearTimeout(this._timeout),this._timeout=setTimeout(t,e)}_isWithActiveTrigger(){return Object.values(this._activeTrigger).includes(!0)}_getConfig(t){const e=on.getDataAttributes(this._element);for(const n of Object.keys(e))co.has(n)&&delete e[n];return t={...e,..."object"===typeof t&&t?t:{}},t=this._mergeConfigObj(t),t=this._configAfterMerge(t),this._typeCheckConfig(t),t}_configAfterMerge(t){return t.container=!1===t.container?document.body:Se(t.container),"number"===typeof t.delay&&(t.delay={show:t.delay,hide:t.delay}),"number"===typeof t.title&&(t.title=t.title.toString()),"number"===typeof t.content&&(t.content=t.content.toString()),t}_getDelegateConfig(){const t={};for(const[e,n]of Object.entries(this._config))this.constructor.Default[e]!==n&&(t[e]=n);return t.selector=!1,t.trigger="manual",t}_disposePopper(){this._popper&&(this._popper.destroy(),this._popper=null),this.tip&&(this.tip.remove(),this.tip=null)}static jQueryInterface(t){return this.each((function(){const e=Do.getOrCreateInstance(this,t);if("string"===typeof t){if("undefined"===typeof e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}De(Do);const Mo="popover",Po=".popover-header",Fo=".popover-body",Lo={...Do.Default,content:"",offset:[0,8],placement:"right",template:'<div class="popover" role="tooltip"><div class="popover-arrow"></div><h3 class="popover-header"></h3><div class="popover-body"></div></div>',trigger:"click"},zo={...Do.DefaultType,content:"(null|string|element|function)"};class Bo extends Do{static get Default(){return Lo}static get DefaultType(){return zo}static get NAME(){return Mo}_isWithContent(){return this._getTitle()||this._getContent()}_getContentForTemplate(){return{[Po]:this._getTitle(),[Fo]:this._getContent()}}_getContent(){return this._resolvePossibleFunction(this._config.content)}static jQueryInterface(t){return this.each((function(){const e=Bo.getOrCreateInstance(this,t);if("string"===typeof t){if("undefined"===typeof e[t])throw new TypeError(`No method named "${t}"`);e[t]()}}))}}De(Bo);const qo="scrollspy",Vo="bs.scrollspy",Wo=`.${Vo}`,jo=".data-api",Uo=`activate${Wo}`,Go=`click${Wo}`,Ho=`load${Wo}${jo}`,Ko="dropdown-item",Xo="active",Qo='[data-bs-spy="scroll"]',Yo="[href]",Zo=".nav, .list-group",Jo=".nav-link",ta=".nav-item",ea=".list-group-item",na=`${Jo}, ${ta} > ${Jo}, ${ea}`,sa=".dropdown",ia=".dropdown-toggle",ra={offset:null,rootMargin:"0px 0px -25%",smoothScroll:!1,target:null,threshold:[.1,.5,1]},oa={offset:"(number|null)",rootMargin:"string",smoothScroll:"boolean",target:"element",threshold:"array"};class aa extends cn{constructor(t,e){super(t,e),this._targetLinks=new Map,this._observableSections=new Map,this._rootElement="visible"===getComputedStyle(this._element).overflowY?null:this._element,this._activeTarget=null,this._observer=null,this._previousScrollData={visibleEntryTop:0,parentScrollTop:0},this.refresh()}static get Default(){return ra}static get DefaultType(){return oa}static get NAME(){return qo}refresh(){this._initializeTargetsAndObservables(),this._maybeEnableSmoothScroll(),this._observer?this._observer.disconnect():this._observer=this._getNewObserver();for(const t of this._observableSections.values())this._observer.observe(t)}dispose(){this._observer.disconnect(),super.dispose()}_configAfterMerge(t){return t.target=Se(t.target)||document.body,t.rootMargin=t.offset?`${t.offset}px 0px -30%`:t.rootMargin,"string"===typeof t.threshold&&(t.threshold=t.threshold.split(",").map((t=>Number.parseFloat(t)))),t}_maybeEnableSmoothScroll(){this._config.smoothScroll&&(en.off(this._config.target,Go),en.on(this._config.target,Go,Yo,(t=>{const e=this._observableSections.get(t.target.hash);if(e){t.preventDefault();const n=this._rootElement||window,s=e.offsetTop-this._element.offsetTop;if(n.scrollTo)return void n.scrollTo({top:s,behavior:"smooth"});n.scrollTop=s}})))}_getNewObserver(){const t={root:this._rootElement,threshold:this._config.threshold,rootMargin:this._config.rootMargin};return new IntersectionObserver((t=>this._observerCallback(t)),t)}_observerCallback(t){const e=t=>this._targetLinks.get(`#${t.target.id}`),n=t=>{this._previousScrollData.visibleEntryTop=t.target.offsetTop,this._process(e(t))},s=(this._rootElement||document.documentElement).scrollTop,i=s>=this._previousScrollData.parentScrollTop;this._previousScrollData.parentScrollTop=s;for(const r of t){if(!r.isIntersecting){this._activeTarget=null,this._clearActiveClass(e(r));continue}const t=r.target.offsetTop>=this._previousScrollData.visibleEntryTop;if(i&&t){if(n(r),!s)return}else i||t||n(r)}}_initializeTargetsAndObservables(){this._targetLinks=new Map,this._observableSections=new Map;const t=hn.find(Yo,this._config.target);for(const e of t){if(!e.hash||Ie(e))continue;const t=hn.findOne(decodeURI(e.hash),this._element);Te(t)&&(this._targetLinks.set(decodeURI(e.hash),e),this._observableSections.set(e.hash,t))}}_process(t){this._activeTarget!==t&&(this._clearActiveClass(this._config.target),this._activeTarget=t,t.classList.add(Xo),this._activateParents(t),en.trigger(this._element,Uo,{relatedTarget:t}))}_activateParents(t){if(t.classList.contains(Ko))hn.findOne(ia,t.closest(sa)).classList.add(Xo);else for(const e of hn.parents(t,Zo))for(const t of hn.prev(e,na))t.classList.add(Xo)}_clearActiveClass(t){t.classList.remove(Xo);const e=hn.find(`${Yo}.${Xo}`,t);for(const n of e)n.classList.remove(Xo)}static jQueryInterface(t){return this.each((function(){const e=aa.getOrCreateInstance(this,t);if("string"===typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}en.on(window,Ho,(()=>{for(const t of hn.find(Qo))aa.getOrCreateInstance(t)})),De(aa);const ua="tab",ca="bs.tab",la=`.${ca}`,ha=`hide${la}`,pa=`hidden${la}`,da=`show${la}`,fa=`shown${la}`,ma=`click${la}`,ga=`keydown${la}`,ya=`load${la}`,ba="ArrowLeft",va="ArrowRight",wa="ArrowUp",xa="ArrowDown",_a="Home",ka="End",Sa="active",Ta="fade",Ia="show",Ca="dropdown",Aa=".dropdown-toggle",Na=".dropdown-menu",Ea=`:not(${Aa})`,Oa='.list-group, .nav, [role="tablist"]',$a=".nav-item, .list-group-item",Ra=`.nav-link${Ea}, .list-group-item${Ea}, [role="tab"]${Ea}`,Da='[data-bs-toggle="tab"], [data-bs-toggle="pill"], [data-bs-toggle="list"]',Ma=`${Ra}, ${Da}`,Pa=`.${Sa}[data-bs-toggle="tab"], .${Sa}[data-bs-toggle="pill"], .${Sa}[data-bs-toggle="list"]`;class Fa extends cn{constructor(t){super(t),this._parent=this._element.closest(Oa),this._parent&&(this._setInitialAttributes(this._parent,this._getChildren()),en.on(this._element,ga,(t=>this._keydown(t))))}static get NAME(){return ua}show(){const t=this._element;if(this._elemIsActive(t))return;const e=this._getActiveElem(),n=e?en.trigger(e,ha,{relatedTarget:t}):null,s=en.trigger(t,da,{relatedTarget:e});s.defaultPrevented||n&&n.defaultPrevented||(this._deactivate(e,t),this._activate(t,e))}_activate(t,e){if(!t)return;t.classList.add(Sa),this._activate(hn.getElementFromSelector(t));const n=()=>{"tab"===t.getAttribute("role")?(t.removeAttribute("tabindex"),t.setAttribute("aria-selected",!0),this._toggleDropDown(t,!0),en.trigger(t,fa,{relatedTarget:e})):t.classList.add(Ia)};this._queueCallback(n,t,t.classList.contains(Ta))}_deactivate(t,e){if(!t)return;t.classList.remove(Sa),t.blur(),this._deactivate(hn.getElementFromSelector(t));const n=()=>{"tab"===t.getAttribute("role")?(t.setAttribute("aria-selected",!1),t.setAttribute("tabindex","-1"),this._toggleDropDown(t,!1),en.trigger(t,pa,{relatedTarget:e})):t.classList.remove(Ia)};this._queueCallback(n,t,t.classList.contains(Ta))}_keydown(t){if(![ba,va,wa,xa,_a,ka].includes(t.key))return;t.stopPropagation(),t.preventDefault();const e=this._getChildren().filter((t=>!Ie(t)));let n;if([_a,ka].includes(t.key))n=e[t.key===_a?0:e.length-1];else{const s=[va,xa].includes(t.key);n=Fe(e,t.target,s,!0)}n&&(n.focus({preventScroll:!0}),Fa.getOrCreateInstance(n).show())}_getChildren(){return hn.find(Ma,this._parent)}_getActiveElem(){return this._getChildren().find((t=>this._elemIsActive(t)))||null}_setInitialAttributes(t,e){this._setAttributeIfNotExists(t,"role","tablist");for(const n of e)this._setInitialAttributesOnChild(n)}_setInitialAttributesOnChild(t){t=this._getInnerElement(t);const e=this._elemIsActive(t),n=this._getOuterElement(t);t.setAttribute("aria-selected",e),n!==t&&this._setAttributeIfNotExists(n,"role","presentation"),e||t.setAttribute("tabindex","-1"),this._setAttributeIfNotExists(t,"role","tab"),this._setInitialAttributesOnTargetPanel(t)}_setInitialAttributesOnTargetPanel(t){const e=hn.getElementFromSelector(t);e&&(this._setAttributeIfNotExists(e,"role","tabpanel"),t.id&&this._setAttributeIfNotExists(e,"aria-labelledby",`${t.id}`))}_toggleDropDown(t,e){const n=this._getOuterElement(t);if(!n.classList.contains(Ca))return;const s=(t,s)=>{const i=hn.findOne(t,n);i&&i.classList.toggle(s,e)};s(Aa,Sa),s(Na,Ia),n.setAttribute("aria-expanded",e)}_setAttributeIfNotExists(t,e,n){t.hasAttribute(e)||t.setAttribute(e,n)}_elemIsActive(t){return t.classList.contains(Sa)}_getInnerElement(t){return t.matches(Ma)?t:hn.findOne(Ma,t)}_getOuterElement(t){return t.closest($a)||t}static jQueryInterface(t){return this.each((function(){const e=Fa.getOrCreateInstance(this);if("string"===typeof t){if(void 0===e[t]||t.startsWith("_")||"constructor"===t)throw new TypeError(`No method named "${t}"`);e[t]()}}))}}en.on(document,ma,Da,(function(t){["A","AREA"].includes(this.tagName)&&t.preventDefault(),Ie(this)||Fa.getOrCreateInstance(this).show()})),en.on(window,ya,(()=>{for(const t of hn.find(Pa))Fa.getOrCreateInstance(t)})),De(Fa);const La="toast",za="bs.toast",Ba=`.${za}`,qa=`mouseover${Ba}`,Va=`mouseout${Ba}`,Wa=`focusin${Ba}`,ja=`focusout${Ba}`,Ua=`hide${Ba}`,Ga=`hidden${Ba}`,Ha=`show${Ba}`,Ka=`shown${Ba}`,Xa="fade",Qa="hide",Ya="show",Za="showing",Ja={animation:"boolean",autohide:"boolean",delay:"number"},tu={animation:!0,autohide:!0,delay:5e3};class eu extends cn{constructor(t,e){super(t,e),this._timeout=null,this._hasMouseInteraction=!1,this._hasKeyboardInteraction=!1,this._setListeners()}static get Default(){return tu}static get DefaultType(){return Ja}static get NAME(){return La}show(){const t=en.trigger(this._element,Ha);if(t.defaultPrevented)return;this._clearTimeout(),this._config.animation&&this._element.classList.add(Xa);const e=()=>{this._element.classList.remove(Za),en.trigger(this._element,Ka),this._maybeScheduleHide()};this._element.classList.remove(Qa),Ne(this._element),this._element.classList.add(Ya,Za),this._queueCallback(e,this._element,this._config.animation)}hide(){if(!this.isShown())return;const t=en.trigger(this._element,Ua);if(t.defaultPrevented)return;const e=()=>{this._element.classList.add(Qa),this._element.classList.remove(Za,Ya),en.trigger(this._element,Ga)};this._element.classList.add(Za),this._queueCallback(e,this._element,this._config.animation)}dispose(){this._clearTimeout(),this.isShown()&&this._element.classList.remove(Ya),super.dispose()}isShown(){return this._element.classList.contains(Ya)}_maybeScheduleHide(){this._config.autohide&&(this._hasMouseInteraction||this._hasKeyboardInteraction||(this._timeout=setTimeout((()=>{this.hide()}),this._config.delay)))}_onInteraction(t,e){switch(t.type){case"mouseover":case"mouseout":this._hasMouseInteraction=e;break;case"focusin":case"focusout":this._hasKeyboardInteraction=e;break}if(e)return void this._clearTimeout();const n=t.relatedTarget;this._element===n||this._element.contains(n)||this._maybeScheduleHide()}_setListeners(){en.on(this._element,qa,(t=>this._onInteraction(t,!0))),en.on(this._element,Va,(t=>this._onInteraction(t,!1))),en.on(this._element,Wa,(t=>this._onInteraction(t,!0))),en.on(this._element,ja,(t=>this._onInteraction(t,!1)))}_clearTimeout(){clearTimeout(this._timeout),this._timeout=null}static jQueryInterface(t){return this.each((function(){const e=eu.getOrCreateInstance(this,t);if("string"===typeof t){if("undefined"===typeof e[t])throw new TypeError(`No method named "${t}"`);e[t](this)}}))}}pn(eu),De(eu)},8664:function(t,e,n){e.parseMidi=n(5215),e.writeMidi=n(7855)},5215:function(t,e,n){function s(t){var e=new o(t),n=e.readChunk();if("MThd"!=n.id)throw"Bad MIDI file.  Expected 'MHdr', got: '"+n.id+"'";for(var s=i(n.data),a=[],u=0;!e.eof()&&u<s.numTracks;u++){var c=e.readChunk();if("MTrk"!=c.id)throw"Bad MIDI file.  Expected 'MTrk', got: '"+c.id+"'";var l=r(c.data);a.push(l)}return{header:s,tracks:a}}function i(t){var e=new o(t),n=e.readUInt16(),s=e.readUInt16(),i={format:n,numTracks:s},r=e.readUInt16();return 32768&r?(i.framesPerSecond=256-(r>>8),i.ticksPerFrame=255&r):i.ticksPerBeat=r,i}function r(t){var e,n=new o(t),s=[];while(!n.eof()){var i=r();s.push(i)}return s;function r(){var t={};t.deltaTime=n.readVarInt();var s=n.readUInt8();if(240===(240&s)){if(255!==s){if(240==s){t.type="sysEx";r=n.readVarInt();return t.data=n.readBytes(r),t}if(247==s){t.type="endSysEx";r=n.readVarInt();return t.data=n.readBytes(r),t}throw"Unrecognised MIDI event type byte: "+s}t.meta=!0;var i=n.readUInt8(),r=n.readVarInt();switch(i){case 0:if(t.type="sequenceNumber",2!==r)throw"Expected length for sequenceNumber event is 2, got "+r;return t.number=n.readUInt16(),t;case 1:return t.type="text",t.text=n.readString(r),t;case 2:return t.type="copyrightNotice",t.text=n.readString(r),t;case 3:return t.type="trackName",t.text=n.readString(r),t;case 4:return t.type="instrumentName",t.text=n.readString(r),t;case 5:return t.type="lyrics",t.text=n.readString(r),t;case 6:return t.type="marker",t.text=n.readString(r),t;case 7:return t.type="cuePoint",t.text=n.readString(r),t;case 32:if(t.type="channelPrefix",1!=r)throw"Expected length for channelPrefix event is 1, got "+r;return t.channel=n.readUInt8(),t;case 33:if(t.type="portPrefix",1!=r)throw"Expected length for portPrefix event is 1, got "+r;return t.port=n.readUInt8(),t;case 47:if(t.type="endOfTrack",0!=r)throw"Expected length for endOfTrack event is 0, got "+r;return t;case 81:if(t.type="setTempo",3!=r)throw"Expected length for setTempo event is 3, got "+r;return t.microsecondsPerBeat=n.readUInt24(),t;case 84:if(t.type="smpteOffset",5!=r)throw"Expected length for smpteOffset event is 5, got "+r;var o=n.readUInt8(),a={0:24,32:25,64:29,96:30};return t.frameRate=a[96&o],t.hour=31&o,t.min=n.readUInt8(),t.sec=n.readUInt8(),t.frame=n.readUInt8(),t.subFrame=n.readUInt8(),t;case 88:if(t.type="timeSignature",2!=r&&4!=r)throw"Expected length for timeSignature event is 4 or 2, got "+r;return t.numerator=n.readUInt8(),t.denominator=1<<n.readUInt8(),4===r?(t.metronome=n.readUInt8(),t.thirtyseconds=n.readUInt8()):(t.metronome=36,t.thirtyseconds=8),t;case 89:if(t.type="keySignature",2!=r)throw"Expected length for keySignature event is 2, got "+r;return t.key=n.readInt8(),t.scale=n.readUInt8(),t;case 127:return t.type="sequencerSpecific",t.data=n.readBytes(r),t;default:return t.type="unknownMeta",t.data=n.readBytes(r),t.metatypeByte=i,t}}else{var u;if(0===(128&s)){if(null===e)throw"Running status byte encountered before status byte";u=s,s=e,t.running=!0}else u=n.readUInt8(),e=s;var c=s>>4;switch(t.channel=15&s,c){case 8:return t.type="noteOff",t.noteNumber=u,t.velocity=n.readUInt8(),t;case 9:var l=n.readUInt8();return t.type=0===l?"noteOff":"noteOn",t.noteNumber=u,t.velocity=l,0===l&&(t.byte9=!0),t;case 10:return t.type="noteAftertouch",t.noteNumber=u,t.amount=n.readUInt8(),t;case 11:return t.type="controller",t.controllerType=u,t.value=n.readUInt8(),t;case 12:return t.type="programChange",t.programNumber=u,t;case 13:return t.type="channelAftertouch",t.amount=u,t;case 14:return t.type="pitchBend",t.value=u+(n.readUInt8()<<7)-8192,t;default:throw"Unrecognised MIDI event type: "+c}}}}function o(t){this.buffer=t,this.bufferLen=this.buffer.length,this.pos=0}n(4114),o.prototype.eof=function(){return this.pos>=this.bufferLen},o.prototype.readUInt8=function(){var t=this.buffer[this.pos];return this.pos+=1,t},o.prototype.readInt8=function(){var t=this.readUInt8();return 128&t?t-256:t},o.prototype.readUInt16=function(){var t=this.readUInt8(),e=this.readUInt8();return(t<<8)+e},o.prototype.readInt16=function(){var t=this.readUInt16();return 32768&t?t-65536:t},o.prototype.readUInt24=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8();return(t<<16)+(e<<8)+n},o.prototype.readInt24=function(){var t=this.readUInt24();return 8388608&t?t-16777216:t},o.prototype.readUInt32=function(){var t=this.readUInt8(),e=this.readUInt8(),n=this.readUInt8(),s=this.readUInt8();return(t<<24)+(e<<16)+(n<<8)+s},o.prototype.readBytes=function(t){var e=this.buffer.slice(this.pos,this.pos+t);return this.pos+=t,e},o.prototype.readString=function(t){var e=this.readBytes(t);return String.fromCharCode.apply(null,e)},o.prototype.readVarInt=function(){var t=0;while(!this.eof()){var e=this.readUInt8();if(!(128&e))return t+e;t+=127&e,t<<=7}return t},o.prototype.readChunk=function(){var t=this.readString(4),e=this.readUInt32(),n=this.readBytes(e);return{id:t,length:e,data:n}},t.exports=s},7855:function(t,e,n){function s(t,e){if("object"!==typeof t)throw"Invalid MIDI data";e=e||{};var n,s=t.header||{},o=t.tracks||[],u=o.length,c=new a;for(i(c,s,u),n=0;n<u;n++)r(c,o[n],e);return c.buffer}function i(t,e,n){var s=null==e.format?1:e.format,i=128;e.timeDivision?i=e.timeDivision:e.ticksPerFrame&&e.framesPerSecond?i=-(255&e.framesPerSecond)<<8|255&e.ticksPerFrame:e.ticksPerBeat&&(i=32767&e.ticksPerBeat);var r=new a;r.writeUInt16(s),r.writeUInt16(n),r.writeUInt16(i),t.writeChunk("MThd",r.buffer)}function r(t,e,n){var s,i=new a,r=e.length,u=null;for(s=0;s<r;s++)!1!==n.running&&(n.running||e[s].running)||(u=null),u=o(i,e[s],u,n.useByte9ForNoteOff);t.writeChunk("MTrk",i.buffer)}function o(t,e,n,s){var i=e.type,r=e.deltaTime,o=e.text||"",a=e.data||[],u=null;switch(t.writeVarInt(r),i){case"sequenceNumber":t.writeUInt8(255),t.writeUInt8(0),t.writeVarInt(2),t.writeUInt16(e.number);break;case"text":t.writeUInt8(255),t.writeUInt8(1),t.writeVarInt(o.length),t.writeString(o);break;case"copyrightNotice":t.writeUInt8(255),t.writeUInt8(2),t.writeVarInt(o.length),t.writeString(o);break;case"trackName":t.writeUInt8(255),t.writeUInt8(3),t.writeVarInt(o.length),t.writeString(o);break;case"instrumentName":t.writeUInt8(255),t.writeUInt8(4),t.writeVarInt(o.length),t.writeString(o);break;case"lyrics":t.writeUInt8(255),t.writeUInt8(5),t.writeVarInt(o.length),t.writeString(o);break;case"marker":t.writeUInt8(255),t.writeUInt8(6),t.writeVarInt(o.length),t.writeString(o);break;case"cuePoint":t.writeUInt8(255),t.writeUInt8(7),t.writeVarInt(o.length),t.writeString(o);break;case"channelPrefix":t.writeUInt8(255),t.writeUInt8(32),t.writeVarInt(1),t.writeUInt8(e.channel);break;case"portPrefix":t.writeUInt8(255),t.writeUInt8(33),t.writeVarInt(1),t.writeUInt8(e.port);break;case"endOfTrack":t.writeUInt8(255),t.writeUInt8(47),t.writeVarInt(0);break;case"setTempo":t.writeUInt8(255),t.writeUInt8(81),t.writeVarInt(3),t.writeUInt24(e.microsecondsPerBeat);break;case"smpteOffset":t.writeUInt8(255),t.writeUInt8(84),t.writeVarInt(5);var c={24:0,25:32,29:64,30:96},l=31&e.hour|c[e.frameRate];t.writeUInt8(l),t.writeUInt8(e.min),t.writeUInt8(e.sec),t.writeUInt8(e.frame),t.writeUInt8(e.subFrame);break;case"timeSignature":t.writeUInt8(255),t.writeUInt8(88),t.writeVarInt(4),t.writeUInt8(e.numerator);var h=255&Math.floor(Math.log(e.denominator)/Math.LN2);t.writeUInt8(h),t.writeUInt8(e.metronome),t.writeUInt8(e.thirtyseconds||8);break;case"keySignature":t.writeUInt8(255),t.writeUInt8(89),t.writeVarInt(2),t.writeInt8(e.key),t.writeUInt8(e.scale);break;case"sequencerSpecific":t.writeUInt8(255),t.writeUInt8(127),t.writeVarInt(a.length),t.writeBytes(a);break;case"unknownMeta":null!=e.metatypeByte&&(t.writeUInt8(255),t.writeUInt8(e.metatypeByte),t.writeVarInt(a.length),t.writeBytes(a));break;case"sysEx":t.writeUInt8(240),t.writeVarInt(a.length),t.writeBytes(a);break;case"endSysEx":t.writeUInt8(247),t.writeVarInt(a.length),t.writeBytes(a);break;case"noteOff":var p=!1!==s&&e.byte9||s&&0==e.velocity?144:128;u=p|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteOn":u=144|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.velocity);break;case"noteAftertouch":u=160|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.noteNumber),t.writeUInt8(e.amount);break;case"controller":u=176|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.controllerType),t.writeUInt8(e.value);break;case"programChange":u=192|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.programNumber);break;case"channelAftertouch":u=208|e.channel,u!==n&&t.writeUInt8(u),t.writeUInt8(e.amount);break;case"pitchBend":u=224|e.channel,u!==n&&t.writeUInt8(u);var d=8192+e.value,f=127&d,m=d>>7&127;t.writeUInt8(f),t.writeUInt8(m);break;default:throw"Unrecognized event type: "+i}return u}function a(){this.buffer=[]}n(4114),a.prototype.writeUInt8=function(t){this.buffer.push(255&t)},a.prototype.writeInt8=a.prototype.writeUInt8,a.prototype.writeUInt16=function(t){var e=t>>8&255,n=255&t;this.writeUInt8(e),this.writeUInt8(n)},a.prototype.writeInt16=a.prototype.writeUInt16,a.prototype.writeUInt24=function(t){var e=t>>16&255,n=t>>8&255,s=255&t;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(s)},a.prototype.writeInt24=a.prototype.writeUInt24,a.prototype.writeUInt32=function(t){var e=t>>24&255,n=t>>16&255,s=t>>8&255,i=255&t;this.writeUInt8(e),this.writeUInt8(n),this.writeUInt8(s),this.writeUInt8(i)},a.prototype.writeInt32=a.prototype.writeUInt32,a.prototype.writeBytes=function(t){this.buffer=this.buffer.concat(Array.prototype.slice.call(t,0))},a.prototype.writeString=function(t){var e,n=t.length,s=[];for(e=0;e<n;e++)s.push(t.codePointAt(e));this.writeBytes(s)},a.prototype.writeVarInt=function(t){if(t<0)throw"Cannot write negative variable-length integer";if(t<=127)this.writeUInt8(t);else{var e=t,n=[];n.push(127&e),e>>=7;while(e){var s=127&e|128;n.push(s),e>>=7}this.writeBytes(n.reverse())}},a.prototype.writeChunk=function(t,e){this.writeString(t),this.writeUInt32(e.length),this.writeBytes(e)},t.exports=s},139:function(t,e,n){"use strict";var s=function(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("unable to locate global object")},i=s();t.exports=e=i.fetch,i.fetch&&(e["default"]=i.fetch.bind(i)),e.Headers=i.Headers,e.Request=i.Request,e.Response=i.Response},3081:function(t,e,n){"use strict";t.exports=n(3409)},3409:function(t,e,n){"use strict";var s=e;function i(){s.util._configure(),s.Writer._configure(s.BufferWriter),s.Reader._configure(s.BufferReader)}s.build="minimal",s.Writer=n(5988),s.BufferWriter=n(9989),s.Reader=n(2872),s.BufferReader=n(6585),s.util=n(7483),s.rpc=n(9016),s.roots=n(4709),s.configure=i,i()},2872:function(t,e,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),t.exports=u;var s,i=n(7483),r=i.LongBits,o=i.utf8;function a(t,e){return RangeError("index out of range: "+t.pos+" + "+(e||1)+" > "+t.len)}function u(t){this.buf=t,this.pos=0,this.len=t.length}var c="undefined"!==typeof Uint8Array?function(t){if(t instanceof Uint8Array||Array.isArray(t))return new u(t);throw Error("illegal buffer")}:function(t){if(Array.isArray(t))return new u(t);throw Error("illegal buffer")},l=function(){return i.Buffer?function(t){return(u.create=function(t){return i.Buffer.isBuffer(t)?new s(t):c(t)})(t)}:c};function h(){var t=new r(0,0),e=0;if(!(this.len-this.pos>4)){for(;e<3;++e){if(this.pos>=this.len)throw a(this);if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t}return t.lo=(t.lo|(127&this.buf[this.pos++])<<7*e)>>>0,t}for(;e<4;++e)if(t.lo=(t.lo|(127&this.buf[this.pos])<<7*e)>>>0,this.buf[this.pos++]<128)return t;if(t.lo=(t.lo|(127&this.buf[this.pos])<<28)>>>0,t.hi=(t.hi|(127&this.buf[this.pos])>>4)>>>0,this.buf[this.pos++]<128)return t;if(e=0,this.len-this.pos>4){for(;e<5;++e)if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}else for(;e<5;++e){if(this.pos>=this.len)throw a(this);if(t.hi=(t.hi|(127&this.buf[this.pos])<<7*e+3)>>>0,this.buf[this.pos++]<128)return t}throw Error("invalid varint encoding")}function p(t,e){return(t[e-4]|t[e-3]<<8|t[e-2]<<16|t[e-1]<<24)>>>0}function d(){if(this.pos+8>this.len)throw a(this,8);return new r(p(this.buf,this.pos+=4),p(this.buf,this.pos+=4))}u.create=l(),u.prototype._slice=i.Array.prototype.subarray||i.Array.prototype.slice,u.prototype.uint32=function(){var t=4294967295;return function(){if(t=(127&this.buf[this.pos])>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<7)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<14)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(127&this.buf[this.pos])<<21)>>>0,this.buf[this.pos++]<128)return t;if(t=(t|(15&this.buf[this.pos])<<28)>>>0,this.buf[this.pos++]<128)return t;if((this.pos+=5)>this.len)throw this.pos=this.len,a(this,10);return t}}(),u.prototype.int32=function(){return 0|this.uint32()},u.prototype.sint32=function(){var t=this.uint32();return t>>>1^-(1&t)},u.prototype.bool=function(){return 0!==this.uint32()},u.prototype.fixed32=function(){if(this.pos+4>this.len)throw a(this,4);return p(this.buf,this.pos+=4)},u.prototype.sfixed32=function(){if(this.pos+4>this.len)throw a(this,4);return 0|p(this.buf,this.pos+=4)},u.prototype.float=function(){if(this.pos+4>this.len)throw a(this,4);var t=i.float.readFloatLE(this.buf,this.pos);return this.pos+=4,t},u.prototype.double=function(){if(this.pos+8>this.len)throw a(this,4);var t=i.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,t},u.prototype.bytes=function(){var t=this.uint32(),e=this.pos,n=this.pos+t;if(n>this.len)throw a(this,t);return this.pos+=t,Array.isArray(this.buf)?this.buf.slice(e,n):e===n?new this.buf.constructor(0):this._slice.call(this.buf,e,n)},u.prototype.string=function(){var t=this.bytes();return o.read(t,0,t.length)},u.prototype.skip=function(t){if("number"===typeof t){if(this.pos+t>this.len)throw a(this,t);this.pos+=t}else do{if(this.pos>=this.len)throw a(this)}while(128&this.buf[this.pos++]);return this},u.prototype.skipType=function(t){switch(t){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while(4!==(t=7&this.uint32()))this.skipType(t);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+t+" at offset "+this.pos)}return this},u._configure=function(t){s=t,u.create=l(),s._configure();var e=i.Long?"toLong":"toNumber";i.merge(u.prototype,{int64:function(){return h.call(this)[e](!1)},uint64:function(){return h.call(this)[e](!0)},sint64:function(){return h.call(this).zzDecode()[e](!1)},fixed64:function(){return d.call(this)[e](!0)},sfixed64:function(){return d.call(this)[e](!1)}})}},6585:function(t,e,n){"use strict";t.exports=r;var s=n(2872);(r.prototype=Object.create(s.prototype)).constructor=r;var i=n(7483);function r(t){s.call(this,t)}r._configure=function(){i.Buffer&&(r.prototype._slice=i.Buffer.prototype.slice)},r.prototype.string=function(){var t=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+t,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+t,this.len))},r._configure()},4709:function(t){"use strict";t.exports={}},9016:function(t,e,n){"use strict";var s=e;s.Service=n(2340)},2340:function(t,e,n){"use strict";t.exports=i;var s=n(7483);function i(t,e,n){if("function"!==typeof t)throw TypeError("rpcImpl must be a function");s.EventEmitter.call(this),this.rpcImpl=t,this.requestDelimited=Boolean(e),this.responseDelimited=Boolean(n)}(i.prototype=Object.create(s.EventEmitter.prototype)).constructor=i,i.prototype.rpcCall=function t(e,n,i,r,o){if(!r)throw TypeError("request must be specified");var a=this;if(!o)return s.asPromise(t,a,e,n,i,r);if(a.rpcImpl)try{return a.rpcImpl(e,n[a.requestDelimited?"encodeDelimited":"encode"](r).finish(),(function(t,n){if(t)return a.emit("error",t,e),o(t);if(null!==n){if(!(n instanceof i))try{n=i[a.responseDelimited?"decodeDelimited":"decode"](n)}catch(t){return a.emit("error",t,e),o(t)}return a.emit("data",n,e),o(null,n)}a.end(!0)}))}catch(u){return a.emit("error",u,e),void setTimeout((function(){o(u)}),0)}else setTimeout((function(){o(Error("already ended"))}),0)},i.prototype.end=function(t){return this.rpcImpl&&(t||this.rpcImpl(null,null,null),this.rpcImpl=null,this.emit("end").off()),this}},9712:function(t,e,n){"use strict";t.exports=i;var s=n(7483);function i(t,e){this.lo=t>>>0,this.hi=e>>>0}var r=i.zero=new i(0,0);r.toNumber=function(){return 0},r.zzEncode=r.zzDecode=function(){return this},r.length=function(){return 1};var o=i.zeroHash="\0\0\0\0\0\0\0\0";i.fromNumber=function(t){if(0===t)return r;var e=t<0;e&&(t=-t);var n=t>>>0,s=(t-n)/4294967296>>>0;return e&&(s=~s>>>0,n=~n>>>0,++n>4294967295&&(n=0,++s>4294967295&&(s=0))),new i(n,s)},i.from=function(t){if("number"===typeof t)return i.fromNumber(t);if(s.isString(t)){if(!s.Long)return i.fromNumber(parseInt(t,10));t=s.Long.fromString(t)}return t.low||t.high?new i(t.low>>>0,t.high>>>0):r},i.prototype.toNumber=function(t){if(!t&&this.hi>>>31){var e=1+~this.lo>>>0,n=~this.hi>>>0;return e||(n=n+1>>>0),-(e+4294967296*n)}return this.lo+4294967296*this.hi},i.prototype.toLong=function(t){return s.Long?new s.Long(0|this.lo,0|this.hi,Boolean(t)):{low:0|this.lo,high:0|this.hi,unsigned:Boolean(t)}};var a=String.prototype.charCodeAt;i.fromHash=function(t){return t===o?r:new i((a.call(t,0)|a.call(t,1)<<8|a.call(t,2)<<16|a.call(t,3)<<24)>>>0,(a.call(t,4)|a.call(t,5)<<8|a.call(t,6)<<16|a.call(t,7)<<24)>>>0)},i.prototype.toHash=function(){return String.fromCharCode(255&this.lo,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,255&this.hi,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)},i.prototype.zzEncode=function(){var t=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^t)>>>0,this.lo=(this.lo<<1^t)>>>0,this},i.prototype.zzDecode=function(){var t=-(1&this.lo);return this.lo=((this.lo>>>1|this.hi<<31)^t)>>>0,this.hi=(this.hi>>>1^t)>>>0,this},i.prototype.length=function(){var t=this.lo,e=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return 0===n?0===e?t<16384?t<128?1:2:t<2097152?3:4:e<16384?e<128?5:6:e<2097152?7:8:n<128?9:10}},7483:function(t,e,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);var s=e;function i(t,e,n){for(var s=Object.keys(e),i=0;i<s.length;++i)void 0!==t[s[i]]&&n||(t[s[i]]=e[s[i]]);return t}function r(t){function e(t,n){if(!(this instanceof e))return new e(t,n);Object.defineProperty(this,"message",{get:function(){return t}}),Error.captureStackTrace?Error.captureStackTrace(this,e):Object.defineProperty(this,"stack",{value:(new Error).stack||""}),n&&i(this,n)}return(e.prototype=Object.create(Error.prototype)).constructor=e,Object.defineProperty(e.prototype,"name",{get:function(){return t}}),e.prototype.toString=function(){return this.name+": "+this.message},e}s.asPromise=n(2544),s.base64=n(3304),s.EventEmitter=n(277),s.float=n(4543),s.inquire=n(6120),s.utf8=n(1856),s.pool=n(9133),s.LongBits=n(9712),s.isNode=Boolean("undefined"!==typeof n.g&&n.g&&n.g.process&&n.g.process.versions&&n.g.process.versions.node),s.global=s.isNode&&n.g||"undefined"!==typeof window&&window||"undefined"!==typeof self&&self||this,s.emptyArray=Object.freeze?Object.freeze([]):[],s.emptyObject=Object.freeze?Object.freeze({}):{},s.isInteger=Number.isInteger||function(t){return"number"===typeof t&&isFinite(t)&&Math.floor(t)===t},s.isString=function(t){return"string"===typeof t||t instanceof String},s.isObject=function(t){return t&&"object"===typeof t},s.isset=s.isSet=function(t,e){var n=t[e];return!(null==n||!t.hasOwnProperty(e))&&("object"!==typeof n||(Array.isArray(n)?n.length:Object.keys(n).length)>0)},s.Buffer=function(){try{var t=s.inquire("buffer").Buffer;return t.prototype.utf8Write?t:null}catch(e){return null}}(),s._Buffer_from=null,s._Buffer_allocUnsafe=null,s.newBuffer=function(t){return"number"===typeof t?s.Buffer?s._Buffer_allocUnsafe(t):new s.Array(t):s.Buffer?s._Buffer_from(t):"undefined"===typeof Uint8Array?t:new Uint8Array(t)},s.Array="undefined"!==typeof Uint8Array?Uint8Array:Array,s.Long=s.global.dcodeIO&&s.global.dcodeIO.Long||s.global.Long||s.inquire("long"),s.key2Re=/^true|false|0|1$/,s.key32Re=/^-?(?:0|[1-9][0-9]*)$/,s.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/,s.longToHash=function(t){return t?s.LongBits.from(t).toHash():s.LongBits.zeroHash},s.longFromHash=function(t,e){var n=s.LongBits.fromHash(t);return s.Long?s.Long.fromBits(n.lo,n.hi,e):n.toNumber(Boolean(e))},s.merge=i,s.lcFirst=function(t){return t.charAt(0).toLowerCase()+t.substring(1)},s.newError=r,s.ProtocolError=r("ProtocolError"),s.oneOfGetter=function(t){for(var e={},n=0;n<t.length;++n)e[t[n]]=1;return function(){for(var t=Object.keys(this),n=t.length-1;n>-1;--n)if(1===e[t[n]]&&void 0!==this[t[n]]&&null!==this[t[n]])return t[n]}},s.oneOfSetter=function(t){return function(e){for(var n=0;n<t.length;++n)t[n]!==e&&delete this[t[n]]}},s.toJSONOptions={longs:String,enums:String,bytes:String,json:!0},s._configure=function(){var t=s.Buffer;t?(s._Buffer_from=t.from!==Uint8Array.from&&t.from||function(e,n){return new t(e,n)},s._Buffer_allocUnsafe=t.allocUnsafe||function(e){return new t(e)}):s._Buffer_from=s._Buffer_allocUnsafe=null}},5988:function(t,e,n){"use strict";t.exports=h;var s,i=n(7483),r=i.LongBits,o=i.base64,a=i.utf8;function u(t,e,n){this.fn=t,this.len=e,this.next=void 0,this.val=n}function c(){}function l(t){this.head=t.head,this.tail=t.tail,this.len=t.len,this.next=t.states}function h(){this.len=0,this.head=new u(c,0,0),this.tail=this.head,this.states=null}var p=function(){return i.Buffer?function(){return(h.create=function(){return new s})()}:function(){return new h}};function d(t,e,n){e[n]=255&t}function f(t,e,n){while(t>127)e[n++]=127&t|128,t>>>=7;e[n]=t}function m(t,e){this.len=t,this.next=void 0,this.val=e}function g(t,e,n){while(t.hi)e[n++]=127&t.lo|128,t.lo=(t.lo>>>7|t.hi<<25)>>>0,t.hi>>>=7;while(t.lo>127)e[n++]=127&t.lo|128,t.lo=t.lo>>>7;e[n++]=t.lo}function y(t,e,n){e[n]=255&t,e[n+1]=t>>>8&255,e[n+2]=t>>>16&255,e[n+3]=t>>>24}h.create=p(),h.alloc=function(t){return new i.Array(t)},i.Array!==Array&&(h.alloc=i.pool(h.alloc,i.Array.prototype.subarray)),h.prototype._push=function(t,e,n){return this.tail=this.tail.next=new u(t,e,n),this.len+=e,this},m.prototype=Object.create(u.prototype),m.prototype.fn=f,h.prototype.uint32=function(t){return this.len+=(this.tail=this.tail.next=new m((t>>>=0)<128?1:t<16384?2:t<2097152?3:t<268435456?4:5,t)).len,this},h.prototype.int32=function(t){return t<0?this._push(g,10,r.fromNumber(t)):this.uint32(t)},h.prototype.sint32=function(t){return this.uint32((t<<1^t>>31)>>>0)},h.prototype.uint64=function(t){var e=r.from(t);return this._push(g,e.length(),e)},h.prototype.int64=h.prototype.uint64,h.prototype.sint64=function(t){var e=r.from(t).zzEncode();return this._push(g,e.length(),e)},h.prototype.bool=function(t){return this._push(d,1,t?1:0)},h.prototype.fixed32=function(t){return this._push(y,4,t>>>0)},h.prototype.sfixed32=h.prototype.fixed32,h.prototype.fixed64=function(t){var e=r.from(t);return this._push(y,4,e.lo)._push(y,4,e.hi)},h.prototype.sfixed64=h.prototype.fixed64,h.prototype.float=function(t){return this._push(i.float.writeFloatLE,4,t)},h.prototype.double=function(t){return this._push(i.float.writeDoubleLE,8,t)};var b=i.Array.prototype.set?function(t,e,n){e.set(t,n)}:function(t,e,n){for(var s=0;s<t.length;++s)e[n+s]=t[s]};h.prototype.bytes=function(t){var e=t.length>>>0;if(!e)return this._push(d,1,0);if(i.isString(t)){var n=h.alloc(e=o.length(t));o.decode(t,n,0),t=n}return this.uint32(e)._push(b,e,t)},h.prototype.string=function(t){var e=a.length(t);return e?this.uint32(e)._push(a.write,e,t):this._push(d,1,0)},h.prototype.fork=function(){return this.states=new l(this),this.head=this.tail=new u(c,0,0),this.len=0,this},h.prototype.reset=function(){return this.states?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new u(c,0,0),this.len=0),this},h.prototype.ldelim=function(){var t=this.head,e=this.tail,n=this.len;return this.reset().uint32(n),n&&(this.tail.next=t.next,this.tail=e,this.len+=n),this},h.prototype.finish=function(){var t=this.head.next,e=this.constructor.alloc(this.len),n=0;while(t)t.fn(t.val,e,n),n+=t.len,t=t.next;return e},h._configure=function(t){s=t,h.create=p(),s._configure()}},9989:function(t,e,n){"use strict";n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),t.exports=r;var s=n(5988);(r.prototype=Object.create(s.prototype)).constructor=r;var i=n(7483);function r(){s.call(this)}function o(t,e,n){t.length<40?i.utf8.write(t,e,n):e.utf8Write?e.utf8Write(t,n):e.write(t,n)}r._configure=function(){r.alloc=i._Buffer_allocUnsafe,r.writeBytesBuffer=i.Buffer&&i.Buffer.prototype instanceof Uint8Array&&"set"===i.Buffer.prototype.set.name?function(t,e,n){e.set(t,n)}:function(t,e,n){if(t.copy)t.copy(e,n,0,t.length);else for(var s=0;s<t.length;)e[n++]=t[s++]}},r.prototype.bytes=function(t){i.isString(t)&&(t=i._Buffer_from(t,"base64"));var e=t.length>>>0;return this.uint32(e),e&&this._push(r.writeBytesBuffer,e,t),this},r.prototype.string=function(t){var e=i.Buffer.byteLength(t);return this.uint32(e),e&&this._push(o,e,t),this},r._configure()},928:function(t,e,n){var s=n(3785),i=n(4008),r=n(1030),o=n(3404),a=n(9018),u=n(5396),c=n(336);c.alea=s,c.xor128=i,c.xorwow=r,c.xorshift7=o,c.xor4096=a,c.tychei=u,t.exports=c},3785:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n=c();e.next=function(){var t=2091639*e.s0+2.3283064365386963e-10*e.c;return e.s0=e.s1,e.s1=e.s2,e.s2=t-(e.c=0|t)},e.c=1,e.s0=n(" "),e.s1=n(" "),e.s2=n(" "),e.s0-=n(t),e.s0<0&&(e.s0+=1),e.s1-=n(t),e.s1<0&&(e.s1+=1),e.s2-=n(t),e.s2<0&&(e.s2+=1),n=null}function a(t,e){return e.c=t.c,e.s0=t.s0,e.s1=t.s1,e.s2=t.s2,e}function u(t,e){var n=new o(t),s=e&&e.state,i=n.next;return i.int32=function(){return 4294967296*n.next()|0},i.double=function(){return i()+11102230246251565e-32*(2097152*i()|0)},i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}function c(){var t=4022871197,e=function(e){e=e.toString();for(var n=0;n<e.length;n++){t+=e.charCodeAt(n);var s=.02519603282416938*t;t=s>>>0,s-=t,s*=t,t=s>>>0,s-=t,t+=4294967296*s}return 2.3283064365386963e-10*(t>>>0)};return e}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.alea=u}(0,t,n.amdD)},5396:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.next=function(){var t=e.b,n=e.c,s=e.d,i=e.a;return t=t<<25^t>>>7^n,n=n-s|0,s=s<<24^s>>>8^i,i=i-t|0,e.b=t=t<<20^t>>>12^n,e.c=n=n-s|0,e.d=s<<16^n>>>16^i,e.a=i-t|0},e.a=0,e.b=0,e.c=-1640531527,e.d=1367130551,t===Math.floor(t)?(e.a=t/4294967296|0,e.b=0|t):n+=t;for(var s=0;s<n.length+20;s++)e.b^=0|n.charCodeAt(s),e.next()}function a(t,e){return e.a=t.a,e.b=t.b,e.c=t.c,e.d=t.d,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.tychei=u}(0,t,n.amdD)},4008:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.x=0,e.y=0,e.z=0,e.w=0,e.next=function(){var t=e.x^e.x<<11;return e.x=e.y,e.y=e.z,e.z=e.w,e.w^=e.w>>>19^t^t>>>8},t===(0|t)?e.x=t:n+=t;for(var s=0;s<n.length+64;s++)e.x^=0|n.charCodeAt(s),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xor128=u}(0,t,n.amdD)},9018:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this;function n(t,e){var n,s,i,r,o,a=[],u=128;for(e===(0|e)?(s=e,e=null):(e+="\0",s=0,u=Math.max(u,e.length)),i=0,r=-32;r<u;++r)e&&(s^=e.charCodeAt((r+32)%e.length)),0===r&&(o=s),s^=s<<10,s^=s>>>15,s^=s<<4,s^=s>>>13,r>=0&&(o=o+1640531527|0,n=a[127&r]^=s+o,i=0==n?i+1:0);for(i>=128&&(a[127&(e&&e.length||0)]=-1),i=127,r=512;r>0;--r)s=a[i+34&127],n=a[i=i+1&127],s^=s<<13,n^=n<<17,s^=s>>>15,n^=n>>>12,a[i]=s^n;t.w=o,t.X=a,t.i=i}e.next=function(){var t,n,s=e.w,i=e.X,r=e.i;return e.w=s=s+1640531527|0,n=i[r+34&127],t=i[r=r+1&127],n^=n<<13,t^=t<<17,n^=n>>>15,t^=t>>>12,n=i[r]=n^t,e.i=r,n+(s^s>>>16)|0},n(e,t)}function a(t,e){return e.i=t.i,e.w=t.w,e.X=t.X.slice(),e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&(s.X&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xor4096=u}(0,t,n.amdD)},3404:function(t,e,n){var s;t=n.nmd(t),n(4114),function(t,i,r){function o(t){var e=this;function n(t,e){var n,s=[];if(e===(0|e))s[0]=e;else for(e=""+e,n=0;n<e.length;++n)s[7&n]=s[7&n]<<15^e.charCodeAt(n)+s[n+1&7]<<13;while(s.length<8)s.push(0);for(n=0;n<8&&0===s[n];++n);for(8==n?s[7]=-1:s[n],t.x=s,t.i=0,n=256;n>0;--n)t.next()}e.next=function(){var t,n,s=e.x,i=e.i;return t=s[i],t^=t>>>7,n=t^t<<24,t=s[i+1&7],n^=t^t>>>10,t=s[i+3&7],n^=t^t>>>3,t=s[i+4&7],n^=t^t<<7,t=s[i+7&7],t^=t<<13,n^=t^t<<9,s[i]=n,e.i=i+1&7,n},n(e,t)}function a(t,e){return e.x=t.x.slice(),e.i=t.i,e}function u(t,e){null==t&&(t=+new Date);var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&(s.x&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xorshift7=u}(0,t,n.amdD)},1030:function(t,e,n){var s;t=n.nmd(t),function(t,i,r){function o(t){var e=this,n="";e.next=function(){var t=e.x^e.x>>>2;return e.x=e.y,e.y=e.z,e.z=e.w,e.w=e.v,(e.d=e.d+362437|0)+(e.v=e.v^e.v<<4^t^t<<1)|0},e.x=0,e.y=0,e.z=0,e.w=0,e.v=0,t===(0|t)?e.x=t:n+=t;for(var s=0;s<n.length+64;s++)e.x^=0|n.charCodeAt(s),s==n.length&&(e.d=e.x<<10^e.x>>>4),e.next()}function a(t,e){return e.x=t.x,e.y=t.y,e.z=t.z,e.w=t.w,e.v=t.v,e.d=t.d,e}function u(t,e){var n=new o(t),s=e&&e.state,i=function(){return(n.next()>>>0)/4294967296};return i.double=function(){do{var t=n.next()>>>11,e=(n.next()>>>0)/4294967296,s=(t+e)/(1<<21)}while(0===s);return s},i.int32=n.next,i.quick=i,s&&("object"==typeof s&&a(s,n),i.state=function(){return a(n,{})}),i}i&&i.exports?i.exports=u:n.amdD&&n.amdO?(s=function(){return u}.call(e,n,e,i),void 0===s||(i.exports=s)):this.xorwow=u}(0,t,n.amdD)},336:function(t,e,n){var s;n(4114),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577),function(i,r){var o,a=(0,eval)("this"),u=256,c=6,l=52,h="random",p=r.pow(u,c),d=r.pow(2,l),f=2*d,m=u-1;function g(t,e,n){var s=[];e=1==e?{entropy:!0}:e||{};var o=w(v(e.entropy?[t,_(i)]:null==t?x():t,3),s),a=new y(s),l=function(){var t=a.g(c),e=p,n=0;while(t<d)t=(t+n)*u,e*=u,n=a.g(1);while(t>=f)t/=2,e/=2,n>>>=1;return(t+n)/e};return l.int32=function(){return 0|a.g(4)},l.quick=function(){return a.g(4)/4294967296},l.double=l,w(_(a.S),i),(e.pass||n||function(t,e,n,s){return s&&(s.S&&b(s,a),t.state=function(){return b(a,{})}),n?(r[h]=t,e):t})(l,o,"global"in e?e.global:this==r,e.state)}function y(t){var e,n=t.length,s=this,i=0,r=s.i=s.j=0,o=s.S=[];n||(t=[n++]);while(i<u)o[i]=i++;for(i=0;i<u;i++)o[i]=o[r=m&r+t[i%n]+(e=o[i])],o[r]=e;(s.g=function(t){var e,n=0,i=s.i,r=s.j,o=s.S;while(t--)e=o[i=m&i+1],n=n*u+o[m&(o[i]=o[r=m&r+e])+(o[r]=e)];return s.i=i,s.j=r,n})(u)}function b(t,e){return e.i=t.i,e.j=t.j,e.S=t.S.slice(),e}function v(t,e){var n,s=[],i=typeof t;if(e&&"object"==i)for(n in t)try{s.push(v(t[n],e-1))}catch(r){}return s.length?s:"string"==i?t:t+"\0"}function w(t,e){var n,s=t+"",i=0;while(i<s.length)e[m&i]=m&(n^=19*e[m&i])+s.charCodeAt(i++);return _(e)}function x(){try{var t;return o&&(t=o.randomBytes)?t=t(u):(t=new Uint8Array(u),(a.crypto||a.msCrypto).getRandomValues(t)),_(t)}catch(s){var e=a.navigator,n=e&&e.plugins;return[+new Date,a,n,a.screen,_(i)]}}function _(t){return String.fromCharCode.apply(0,t)}if(r["seed"+h]=g,w(r.random(),i),t.exports){t.exports=g;try{o=n(1234)}catch(k){}}else s=function(){return g}.call(e,n,e,t),void 0===s||(t.exports=s)}([],Math)},3721:function(t,e,n){n(4114),n(9479),function(e,n){t.exports=n()}(self,(function(){return function(t){var e={};function n(s){if(e[s])return e[s].exports;var i=e[s]={i:s,l:!1,exports:{}};return t[s].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,s){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(n.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(s,i,function(e){return t[e]}.bind(null,i));return s},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){"use strict";n.r(e),n.d(e,"SVGNS",(function(){return s})),n.d(e,"drawSVGPath",(function(){return i})),n.d(e,"drawSVGText",(function(){return r})),n.d(e,"createSVGGroupChild",(function(){return o})),n.d(e,"setFade",(function(){return a}));const s="http://www.w3.org/2000/svg";function i(t,e,n,i,r,o,a=1){const u=document.createElementNS(s,"path");return u.setAttributeNS(null,"d",e),u.setAttributeNS(null,"transform",`translate(${n}, ${i}) scale(${r}, ${o})`),u.setAttributeNS(null,"opacity",`${a}`),t.appendChild(u),u}function r(t,e,n,i,r,o=!1,a=1,u=1){const c=document.createElementNS(s,"text");c.setAttributeNS(null,"font-family","Times"),c.setAttributeNS(null,"font-size",r),o&&c.setAttributeNS(null,"font-weight","bold"),c.setAttributeNS(null,"transform",`translate(${n}, ${i}) scale(${a}, ${u})`);const l=document.createTextNode(e);return c.appendChild(l),t.appendChild(c),c}function o(t,e){const n=document.createElementNS(s,"g");return n.setAttribute("data-id",e),t.appendChild(n),n}function a(t,e=!1,n=1,i=0){let r=t.querySelector("animate");if(!r){(r=document.createElementNS(s,"animate")).setAttributeNS(null,"attributeName","opacity"),r.setAttributeNS(null,"dur","4s"),r.setAttributeNS(null,"fill","freeze"),r.setAttributeNS(null,"keyTimes","0; 0.25; 0.5; 0.75; 1");const t=(n+3*i)/4;r.setAttributeNS(null,"values",`${n}; ${t}; ${i}; ${t}; ${n}`)}return e?r.setAttributeNS(null,"repeatCount","indefinite"):r.setAttributeNS(null,"repeatCount","1"),t.appendChild(r),t}},function(t,e,n){"use strict";n.r(e),n.d(e,"PATH_SCALE",(function(){return s})),n.d(e,"staffLinePath",(function(){return r})),n.d(e,"extraLinePath",(function(){return o})),n.d(e,"barPath",(function(){return a})),n.d(e,"stemPath",(function(){return u})),n.d(e,"singleFlagPath",(function(){return c})),n.d(e,"multiFlagPath",(function(){return l})),n.d(e,"tiePath",(function(){return h})),n.d(e,"dotPath",(function(){return p})),n.d(e,"NOTE_PATHS",(function(){return d})),n.d(e,"REST_PATHS",(function(){return f})),n.d(e,"CLEF_PATHS",(function(){return m})),n.d(e,"ACCIDENTAL_PATHS",(function(){return g}));const s=100,i="M 0,10 C 0,-15 35,-50 80,-50 110,-50 125,-35 125,-10 \n125,15 90,50 45,50 15,50 0,35 0,10 Z",r="m 0,0 h 100",o="m -25,0 h 175",a="m 0,-200 v 400",u="m 0,0 v 100 h 15 v -100 z",c="M0,0 h 12 c 7,100 175,156 62,314 79,-177 -49,\n-193 -61,-200 l -13,-5 z",l="m 0,0 h 10 c 6,72 173,64 84,227 44,-120 -44,\n-123 -94,-167 z",h="M 0,25 C 10,46 30,67 50,67 69,67 90,47 100,25 94,\n65 73,89 50,89 26,89 5,63 0,25 Z",p="M 5 -20 a 20 20 0 1 0 0.00001 0 z",d={4:{path:"m 0,0 c 0,-37 49,-51 79,-51 31,0 83,13 83,51 0,39 \n-55,51 -84,51 C 49,51 0,37 0,0 Z m 111,31 c 13,-19 0,-58 -22,-68 -33,-15 \n-53,10 -39,49 9,27 48,39 61,19 z",width:150,stemVSteps:0,stemAnchor:0,flags:0},2:{path:"m 0,10 c 0,-25 35,-60 80,-60 15,0 45,4 45,40 C 125,16 \n89,50 45,50 17,50 0,36 0,10 Z m 71,7 c 17,-11 45,-34 38,-45 -7,-10 -39,1 \n-57,12 -19,11 -42,31 -36,42 6,10 37,2 55,-9 z",width:125,stemVSteps:7,stemAnchor:-10,flags:0},1:{path:i,width:125,stemVSteps:7,stemAnchor:-10,flags:0},.5:{path:i,width:125,stemVSteps:7,stemAnchor:-10,flags:1},.25:{path:i,width:125,stemVSteps:9,stemAnchor:-10,flags:2},.125:{path:i,width:125,stemVSteps:11,stemAnchor:-10,flags:3},.0625:{path:i,width:125,stemVSteps:13,stemAnchor:-10,flags:4}},f={4:"m 0,-50 h 125 v -50 H 0 Z",2:"M 0,0 H 125 V -50 H 0 Z",1:"m 0,-25 c 39,-39 37,-75 8,-120 l 6,-5 61,103 C \n40,-13 31,4 73,71 l -5,5 C 14,52 16,125 67,144 l -4,6 C -37,102 -1,22 59,60 Z",.5:"m 52,-47 c 26,-2 42,-21 48,-42 l 12,4 L 64,83 52,79 \n88,-49 c 0,0 -17,22 -57,22 -16,0 -31,-13 -31,-27 0,-18 10,-31 27,-31 17,0 \n33,15 25,38 z",.25:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 l -36,128 12,4 77,-270 z",.125:"m 129,-191 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -20,69 \nc -7,18 -22,33 -45,35 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 15,27 \n31,27 40,0 57,-22 57,-22 L 68,20 C 61,37 46,51 24,52 32,29 16,14 -1,14 c \n-17,0 -27,13 -27,31 0,14 15,27 31,27 38,0 55,-20 57,-22 l -36,128 12,4 \n105,-369 z",.0625:"m 158,-292 c -6,21 -22,40 -48,42 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 l -17,61 \nv 0 c -6,21 -22,40 -48,42 8,-23 -8,-38 -25,-38 -17,0 -27,13 -27,31 0,14 \n15,27 31,27 40,0 57,-22 57,-22 l -20,69 c -7,18 -22,33 -45,35 8,-23 -8,-38 \n-25,-38 -17,0 -27,13 -27,31 0,14 15,27 31,27 40,0 57,-22 57,-22 L 68,20 C \n61,37 46,51 24,52 32,29 16,14 -1,14 c -17,0 -27,13 -27,31 0,14 15,27 31,27 \n38,0 55,-20 57,-22 l -36,128 12,4 134,-469 z"},m={50:{path:"m 101,-199 c -49,0 -100,28 -100,83 0,39 58,57 82,26 15,-20 \n-4,-47 -32,-47 -23,1 -25,0 -25,-8 0,-22 40,-46 71,-41 91,16 67,208 -105,302 \n75,-27 198,-94 211,-201 6,-66 -42,-114 -102,-114 z m 143,33 c -13,0 -23,11 \n-23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 z m 2,83 c \n-13,0 -23,11 -23,24 0,14 10,24 23,24 13,0 23,-11 23,-24 0,-13 -10,-24 -23,-24 \nz",upper:-4,lower:3},71:{path:"M 139,48 C 102,57 76,120 131,151 41,128 64,24 129,2 L \n117,-57 C -32,47 26,217 166,182 Z m 12,-1 27,131 C 242,153 216,46 151,47 \nZ m -35,-177 c 34,-23 82,-117 50,-140 -23,-17 -71,33 -50,140 z m -10,10 c \n-23,-77 -20,-200 48,-213 19,-4 89,171 -26,266 l 13,66 c 120,-6 137,155 \n39,191 l 12,58 c 30,131 -137,145 -138,47 0,-29 37,-59 63,-37 21,18 25,71 \n-25,70 32,42 103,0 91,-65 L 167,193 C 56,232 -112,63 106,-120 Z",upper:-7,lower:8}},g=[null,"m -49,-121 v 52 l -29,9 v -48 h -8 v 51 l -20,6 v 29 l \n20,-6 v 70 l -20,6 v 30 l 20,-6 v 51 h 8 V 69 l 30,-8 v 50 h 8 V 58 l 20,-6 \nV 23 l -20,6 v -71 l 20,-6 v -29 l -20,6 v -50 z m 1,82 v 71 l -29,9 v -71 z","M -106,-166 V 67 c 52,-42 85,-56 85,-94 0,-47 -46,-51 \n-73,-22 v -117 z m 31,120 c 20,0 42,46 -20,91 V -7 c 0,-28 10,-39 20,-39 z","m -81,-58 v -48 H -92 V 73 l 60,-13 v 50 h 11 V -72 Z m \n50,24 v 58 l -50,11 v -58 z"]},function(t,e,n){"use strict";n.r(e),n.d(e,"MIN_RESOLUTION",(function(){return s})),n.d(e,"STEM_WIDTH",(function(){return i})),n.d(e,"LINE_STROKE",(function(){return r})),n.d(e,"COMPACT_SPACING",(function(){return o}));const s=.0625,i=15,r=1,o=150},function(t,e,n){"use strict";n.r(e),n.d(e,"MAX_QUARTER_DIVISION",(function(){return u})),n.d(e,"ScrollType",(function(){return c})),n.d(e,"StaffSVGRender",(function(){return l}));var s=n(2),i=n(0),r=n(1);const o=[{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,0,1,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,0,3,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,2,0,0,2,0,2,0,0,3]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-7],accidental:[3,0,3,0,3,0,0,3,0,3,0,0]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[0,1,0,1,0,3,0,0,1,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,0,3,0,3,0,2,0,0,3,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,0,1,0,3,0,3,0,0,1,0]},{steps:[0,-1,-1,-2,-2,-3,-4,-4,-5,-5,-6,-6],accidental:[0,2,0,0,3,0,2,0,2,0,0,3]},{steps:[0,0,-1,-1,-2,-3,-3,-4,-4,-5,-5,-6],accidental:[3,0,3,0,0,3,0,3,0,3,0,0]}],a=[{accidental:1,pitches:[]},{accidental:2,pitches:[70,75,68,73,66]},{accidental:1,pitches:[78,73]},{accidental:2,pitches:[70,75,68]},{accidental:1,pitches:[78,73,80,75]},{accidental:2,pitches:[70]},{accidental:2,pitches:[70,75,68,73,66,71]},{accidental:1,pitches:[78]},{accidental:2,pitches:[70,75,68,73]},{accidental:1,pitches:[78,73,80]},{accidental:2,pitches:[70,75]},{accidental:1,pitches:[78,73,80,75,70]}],u=16;var c;!function(t){t[t.PAGE=0]="PAGE",t[t.NOTE=1]="NOTE",t[t.BAR=2]="BAR"}(c||(c={}));class l{constructor(t,e,n){this.handleScrollEvent=t=>{this.lastKnownScrollLeft=this.parentElement.scrollLeft,this.ticking||window.requestAnimationFrame((()=>{this.changeAndDrawSignaturesIfNeeded(this.lastKnownScrollLeft),this.ticking=!1})),this.ticking=!0},this.scoreInfo=t,this.config={noteHeight:e.noteHeight||6,noteSpacing:e.noteSpacing||1,pixelsPerTimeStep:e.pixelsPerTimeStep||30,noteRGB:e.noteRGB||"8, 41, 64",activeNoteRGB:e.activeNoteRGB||"240, 84, 119"},this.div=n,this.timeSignatureNumerator=4,this.timeSignatureDenominator=4,this.key=e.defaultKey||0,this.scrollType=e.scrollType||c.PAGE,this.scale=this.config.noteHeight/r.PATH_SCALE,(void 0===e.pixelsPerTimeStep||e.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0,this.config.noteSpacing=s.COMPACT_SPACING*this.scale),this.clear(),this.redraw()}clear(){for(;this.div.lastChild;)this.div.removeChild(this.div.lastChild);this.div.style.overflow="visible",this.div.style.position="relative",this.overlaySVG=document.createElementNS(i.SVGNS,"svg"),this.overlaySVG.style.position="absolute",this.div.appendChild(this.overlaySVG),this.overlayG=Object(i.createSVGGroupChild)(this.overlaySVG,"overlay"),this.signaturesBlinking=!1,this.signaturesQuarters=0,this.parentElement=document.createElement("div"),this.parentElement.style.overflow="auto",this.div.appendChild(this.parentElement),this.ticking=!1,this.lastKnownScrollLeft=0,this.parentElement.addEventListener("scroll",this.handleScrollEvent),this.staffSVG=document.createElementNS(i.SVGNS,"svg"),this.parentElement.appendChild(this.staffSVG),this.staffG=Object(i.createSVGGroupChild)(this.staffSVG,"staff"),this.linesG=Object(i.createSVGGroupChild)(this.staffSVG,"lines"),this.setStroke(this.linesG),this.staffG.appendChild(this.linesG),this.musicG=Object(i.createSVGGroupChild)(this.staffSVG,"music"),this.setFill(this.musicG),this.setStroke(this.musicG,0),this.staffG.appendChild(this.musicG),this.signaturesG=Object(i.createSVGGroupChild)(this.staffSVG,"signatures"),this.staffG.appendChild(this.signaturesG);let t=0,e=0;this.scoreInfo.notes.forEach((n=>{t+=n.pitch,++e}));const n=t/e;this.clef=n<60?50:71,this.signaturesList=[{x:0,q:0}],this.signatureCurrent=0,this.signatureNext=0,this.changeKeySignatureIfNeeded(0),this.changeTimeSignatureIfNeeded(0),this.vStepSize=this.config.noteHeight/2,this.hStepSize=this.config.pixelsPerTimeStep,this.staffOffset=0,this.height=0,this.width=0,this.musicBlockMap=new Map,this.playingNotes=[],this.lastBar=0,this.barAccidentals={},this.lastQ=-1}isPaintingActiveNote(t,e){const n=t.start===e.start,s=t.start<=e.start&&t.start+t.length>=e.start+e.length;return n||s}redraw(t,e){let n=-1;const s=0===this.config.pixelsPerTimeStep;if(t){const r=[];this.playingNotes.forEach((e=>{this.isPaintingActiveNote(e,t)?r.push(e):this.highlightElement(this.getGroup(e),!1)})),this.playingNotes=r;const o=this.getGroup(t);if(o){this.playingNotes.push(t),this.highlightElement(o,!0),n=o.getBoundingClientRect().left-this.staffSVG.getBoundingClientRect().left;const r=t.start,a=o.getAttribute("data-is-bar-beginning");(this.scrollType!==c.BAR||a)&&this.scrollIntoViewIfNeeded(e,n),!s&&this.signaturesBlinking&&r>=this.signaturesQuarters&&(this.signaturesBlinking=!1,Object(i.setFade)(this.overlayG,this.signaturesBlinking))}}else{this.setDetails();const t=-1===this.lastQ;let e=0,n=0;t?(n=this.drawSignatures(this.overlayG,e,!0,!0,!0),s&&(this.width=0,n+=this.config.noteSpacing),n+=this.drawRests(this.initialRest,e+n)):e=this.width,this.musicBlockMap.forEach(((t,i)=>{s||(e=this.quartersToTime(i)*this.hStepSize),i>this.lastQ?(n+=this.drawMusicBlock(t,e+n),this.lastQ=i):i===this.lastQ&&(n+=this.drawRests(t,e+n))}));const i=this.staffSVG.getBoundingClientRect(),r=this.musicG.getBoundingClientRect();if(this.updateVerticalBoundaries(r.top-i.top,r.bottom-i.top),s)this.width+=n;else{const t=this.musicBlockMap.get(this.lastQ),e=this.quartersToTime(this.lastQ+t.notes[0].length);this.width=e*this.config.pixelsPerTimeStep}this.staffSVG.setAttributeNS(null,"width",`${this.width}`),this.redrawStaff(this.linesG,0,this.width)}return n}drawMusicBlock(t,e){const n=t.notes[0].start;let o=this.drawBarIfNeeded(n,e);o+=this.drawSignaturesIfNeeded(n,e+o);let a=0;for(let i=4;i>=s.MIN_RESOLUTION&&!a;i/=2)i<=t.notes[0].length&&(a=i);if(0===a){const e=0===t.notes[0].length?"[infinite]":""+4/t.notes[0].length;console.warn(" StaffRender ","background:orange; color:white",`StaffRender does not handle notes shorther than 1/${4/s.MIN_RESOLUTION}th, and this score tries to draw a 1/${e}th. Shortest possible note will be drawn instead.`),a=s.MIN_RESOLUTION}const u=r.NOTE_PATHS[a];let c;if(u.stemAnchor&&(c=Object(i.createSVGGroupChild)(this.musicG,"stem")),t.notes.forEach((n=>{const s=n.vSteps*this.vStepSize,c=2*(n.vSteps>0?Math.floor(n.vSteps/2):Math.ceil(n.vSteps/2)),l=n.vSteps>0?-2:2;for(let t=c;Math.abs(t)>4;t+=l)Object(i.drawSVGPath)(this.linesG,r.extraLinePath,e+o,t*this.vStepSize,this.scale,1);if(n.g=n.tiedFrom?n.tiedFrom.g:Object(i.createSVGGroupChild)(this.musicG,`${n.start}-${n.pitch}`),t.isBarBeginning&&n.g.setAttribute("data-is-bar-beginning","true"),n.tiedFrom){const t=e+o-n.tiedFrom.xHeadRight;Object(i.drawSVGPath)(n.g,r.tiePath,n.tiedFrom.xHeadRight,s,t/r.PATH_SCALE,this.scale*(n.vSteps<0?-1:1),n.opacity)}Object(i.drawSVGPath)(n.g,u.path,e+o,s,this.scale,this.scale,n.opacity),n.xHeadRight=e+o+u.width*this.scale,1.5*a<=n.length&&Object(i.drawSVGPath)(n.g,r.dotPath,e+o+u.width*this.scale+this.vStepSize/2,s-this.vStepSize/2,this.scale,this.scale,n.opacity),0!==n.accidental&&Object(i.drawSVGPath)(n.g,r.ACCIDENTAL_PATHS[n.accidental],e+o,s,this.scale,this.scale,n.opacity)})),u.stemAnchor){let n,a,l=e+o;const h=u.stemAnchor*this.scale,p=t.minVStep+t.maxVStep<0,d=u.flags>2?2*(u.flags-2):0;if(p?(n=t.maxVStep*this.vStepSize-h,a=(t.minVStep+7+d)*this.vStepSize):(l+=(u.width-s.STEM_WIDTH)*this.scale,n=t.minVStep*this.vStepSize+h,a=(t.maxVStep-7-d)*this.vStepSize),Object(i.drawSVGPath)(c,r.stemPath,l,n,this.scale,(a-n)/r.PATH_SCALE),1===u.flags)Object(i.drawSVGPath)(c,r.singleFlagPath,l,a,this.scale,this.scale*(p?-1:1),1);else if(u.flags>1)for(let t=0;t<u.flags;++t)Object(i.drawSVGPath)(c,r.multiFlagPath,l,a,this.scale,this.scale*(p?-1:1),1),a+=(p?-2:2)*this.vStepSize}return 0===this.config.pixelsPerTimeStep&&(o+=u.width*this.scale,c&&(o+=c.getBoundingClientRect().width),o+=this.config.noteSpacing),o+=this.drawRests(t,e+o)}drawBarIfNeeded(t,e){let n=0;const s=this.lastBar+this.getBarLength();return 0!==t&&t>=s&&(this.config.pixelsPerTimeStep>0?e-=this.config.noteSpacing:n=this.config.noteSpacing,Object(i.drawSVGPath)(this.linesG,r.barPath,e,0,1,this.scale),this.lastBar=s),n}drawRests(t,e){let n=0,o=t.restToNextLength;if(o){this.config.pixelsPerTimeStep>0&&(e+=this.quartersToTime(t.notes[0].length)*this.hStepSize);let a=t.notes[0].start+t.notes[0].length,u=0;const c=this.lastBar+this.getBarLength()-a;let l;for(o>c&&(u=o-c,o=c),l=4;l>this.getBarLength()&&l>=s.MIN_RESOLUTION;l/=2);let h=l;for(;(o||u)&&h>=s.MIN_RESOLUTION;){if(h<=o){n+=this.drawBarIfNeeded(a,e+n),n+=this.drawSignaturesIfNeeded(a,e+n);const t=Object(i.drawSVGPath)(this.musicG,r.REST_PATHS[h],e+n,0,this.scale,this.scale);this.config.pixelsPerTimeStep>0?e+=this.quartersToTime(h)*this.hStepSize:(n+=t.getBoundingClientRect().width,n+=this.config.noteSpacing),a+=h,o-=h}if(u&&o<=0){const t=this.getBarLength();for(u>t?(o=t,u-=t):(o=u,u=0),l=4;l>this.getBarLength()&&l>=s.MIN_RESOLUTION;l/=2);h=l}o<h&&(h/=2)}}return n}redrawStaff(t,e,n){let s=t.querySelector('g[data-id="staff-five-lines"]');if(s)s.setAttributeNS(null,"transform",`scale(${n/r.PATH_SCALE}, 1)`);else{s=Object(i.createSVGGroupChild)(t,"staff-five-lines");const o=0;for(let t=-4;t<=4;t+=2)Object(i.drawSVGPath)(s,r.staffLinePath,e,o+t*this.vStepSize,n/r.PATH_SCALE,1)}return s}clearSignatureOverlay(){for(;this.overlayG.lastChild;)this.overlayG.removeChild(this.overlayG.lastChild)}drawSignaturesIfNeeded(t,e){let n=0;const r=this.changeKeySignatureIfNeeded(t),o=this.changeTimeSignatureIfNeeded(t);if(r||o){const a=s.COMPACT_SPACING*this.scale*(this.config.pixelsPerTimeStep>0?3:2);this.signaturesList.push({x:e-a,q:t}),null===this.signatureNext&&(this.signatureNext=e);const u=t>0?Object(i.createSVGGroupChild)(this.signaturesG,"signatures"):this.overlayG;n+=this.drawSignatures(u,e+n,!1,r,o)}return 0===this.config.pixelsPerTimeStep?n:0}drawSignatures(t,e,n,o,u){const c=s.COMPACT_SPACING*this.scale;let l,h=c;const p=t===this.overlayG||this.config.pixelsPerTimeStep>0;if(p){(l=document.createElementNS(i.SVGNS,"rect")).setAttributeNS(null,"x",`${e}`),l.setAttributeNS(null,"y","0"),l.setAttributeNS(null,"width","1"),l.setAttributeNS(null,"height","1"),l.setAttribute("data-id","background"),t.appendChild(l);const n=document.defaultView.getComputedStyle(this.div.parentElement);l.setAttributeNS(null,"fill",n.getPropertyValue("background-color"))}if(n){const n=Object(i.drawSVGPath)(t,r.CLEF_PATHS[this.clef].path,e+h,0,this.scale,this.scale);this.setFill(n),h+=3*c}if(o){const n=a[this.key].accidental,s=71===this.clef?0:14;a[this.key].pitches.forEach((o=>{const a=this.getPitchDetails(o).vSteps,u=Object(i.drawSVGPath)(t,r.ACCIDENTAL_PATHS[n],e+h,(s+a)*this.vStepSize,this.scale,this.scale);this.setFill(u),h+=u.getBoundingClientRect().width}))}if(u){const n=Object(i.createSVGGroupChild)(t,"time-key"),s=2.85*this.config.noteHeight+"px";Object(i.drawSVGText)(n,`${this.timeSignatureNumerator}`,e+h,-.5,s,!0),Object(i.drawSVGText)(n,`${this.timeSignatureDenominator}`,e+h,4*this.vStepSize-.5,s,!0),this.setFill(n),h+=n.getBoundingClientRect().width+c}const d=this.redrawStaff(t,e,h);this.setStroke(d);const f=this.div.getBoundingClientRect(),m=t.getBoundingClientRect();if(this.updateVerticalBoundaries(m.top-f.top,m.bottom-f.top),p&&(l.setAttributeNS(null,"y",""+-this.staffOffset),l.setAttributeNS(null,"height",`${this.height}`),l.setAttributeNS(null,"width",`${h}`)),t===this.overlayG){this.overlaySVG.setAttributeNS(null,"width",`${h+5}`);for(let e=0;e<5;++e){const n=Object(i.drawSVGPath)(t,r.stemPath,h+e,e*e-this.staffOffset,1/s.STEM_WIDTH,(this.height-2*e*e)/r.PATH_SCALE,(e-5)*(e-5)*2/r.PATH_SCALE);this.setFill(n)}}if(this.config.pixelsPerTimeStep>0){const n=0===this.signaturesQuarters;return n&&(this.signaturesQuarters=this.timeToQuarters(h/this.hStepSize)),(n||e>0)&&(this.signaturesBlinking=!0,Object(i.setFade)(t,this.signaturesBlinking)),0}return h}changeKeySignatureIfNeeded(t){if(this.scoreInfo.keySignatures){let e=this.key;for(let n=0;n<this.scoreInfo.keySignatures.length&&this.scoreInfo.keySignatures[n].start<=t;++n)e=this.scoreInfo.keySignatures[n].key;if(e!==this.key)return this.key=e,!0}return!1}changeTimeSignatureIfNeeded(t){if(this.scoreInfo.timeSignatures){let e=this.timeSignatureNumerator,n=this.timeSignatureDenominator;for(let s=0;s<this.scoreInfo.timeSignatures.length&&this.scoreInfo.timeSignatures[s].start<=t;++s)e=this.scoreInfo.timeSignatures[s].numerator,n=this.scoreInfo.timeSignatures[s].denominator;if(e!==this.timeSignatureNumerator||n!==this.timeSignatureDenominator)return this.timeSignatureNumerator=e,this.timeSignatureDenominator=n,!0}return!1}changeAndDrawSignaturesIfNeeded(t){let e;if(t<this.signatureCurrent||null!==this.signatureNext&&this.signatureNext<=t){e=this.signaturesList[0].q,this.signatureNext=null;for(let n=0;n<this.signaturesList.length;++n){if(t<this.signaturesList[n].x){this.signatureNext=this.signaturesList[n].x;break}this.signatureCurrent=this.signaturesList[n].x,e=this.signaturesList[n].q}}if(void 0!==e){const t=this.key,n=this.timeSignatureNumerator,s=this.timeSignatureDenominator;this.changeKeySignatureIfNeeded(e),this.changeTimeSignatureIfNeeded(e),this.clearSignatureOverlay(),this.drawSignatures(this.overlayG,0,!0,!0,!0),this.key=t,this.timeSignatureNumerator=n,this.timeSignatureDenominator=s}this.config.pixelsPerTimeStep>0&&0===t&&(this.signatureNext=0,this.signaturesBlinking=!0,Object(i.setFade)(this.overlayG,this.signaturesBlinking))}getBarLength(){return 4*this.timeSignatureNumerator/this.timeSignatureDenominator}scrollIntoViewIfNeeded(t,e){if(t)if(this.scrollType===c.PAGE){const t=this.parentElement.getBoundingClientRect().width;e>this.parentElement.scrollLeft+t&&(this.parentElement.scrollLeft=e-20)}else{const t=this.parentElement.getBoundingClientRect().width;this.parentElement.scrollLeft=e-.5*t}}updateVerticalBoundaries(t,e){let n=0;if(t<0){this.staffOffset-=t;const e=`translate(0, ${this.staffOffset})`;this.overlayG.setAttributeNS(null,"transform",e),this.staffG.setAttributeNS(null,"transform",e),n=this.height-t}if((n=Math.max(n,e-t))>this.height){this.height=n,this.overlaySVG.setAttributeNS(null,"height",`${this.height}`),this.staffSVG.setAttributeNS(null,"height",`${this.height}`);const t=this.div.querySelectorAll('rect[data-id="background"]');for(let e=0;e<t.length;++e){const n=t[e];n.setAttributeNS(null,"y",""+-this.staffOffset),n.setAttributeNS(null,"height",`${this.height}`)}}}setFill(t,e=!1){t.setAttributeNS(null,"fill",this.getColor(e))}setStroke(t,e=s.LINE_STROKE,n=!1){t.setAttributeNS(null,"stroke",this.getColor(n)),t.setAttributeNS(null,"stroke-width",`${e}`)}getColor(t){return`rgb(${t?this.config.activeNoteRGB:this.config.noteRGB})`}getOpacity(t){return t?t/127*.8+.2:1}getGroup(t){const e=t.start,n=t.pitch;return this.staffSVG.querySelector(`g[data-id="${e}-${n}"]`)}highlightElement(t,e){t.setAttribute("fill",this.getColor(e)),t.setAttribute("stroke",this.getColor(e))}getBarBeginnings(){const t=new Set;let e=0;this.scoreInfo.notes.forEach((t=>{t.start+t.length>e&&(e=t.start+t.length)}));const n=this.scoreInfo.timeSignatures?this.scoreInfo.timeSignatures.slice(0):[{start:0,numerator:4,denominator:4}];n.sort(((t,e)=>t.start-e.start));let s=0;for(let i=0;i<n.length;++i){const r=i===n.length-1?e:n[i].start,o=4*n[i].numerator/n[i].denominator;for(;s<r;s+=o)t.add(s)}return t}quartersToTime(t){return t/this.scoreInfo.tempos[0].qpm*60}timeToQuarters(t){return t*this.scoreInfo.tempos[0].qpm/60}setDetails(){let t=new Map;const e=this.getBarBeginnings(),n=new Set(e);this.scoreInfo.notes.slice().sort(((t,e)=>t.start-e.start)).forEach((e=>{const s=this.getQNote(e);n.add(s.start),n.add(s.start+s.length),t.has(s.start)?t.get(s.start).push(s):t.set(s.start,[s])})),Array.from(n).sort(((t,e)=>t-e)).forEach((e=>{const n=[];t.forEach((t=>{t.forEach((t=>{const s=this.splitQNote(t,e);s&&n.push(s)}))})),n.forEach((e=>{t.has(e.start)?t.get(e.start).push(e):t.set(e.start,[e])}))})),t=new Map(Array.from(t).sort(((t,e)=>t[0]-e[0])));const s=this.key;let i=null,r=0;const o=e[Symbol.iterator]();let a=o.next();t.forEach(((t,e)=>{const n={maxVStep:Number.MAX_SAFE_INTEGER,minVStep:Number.MIN_SAFE_INTEGER,restToNextLength:0,isBarBeginning:!1,notes:[]};this.changeKeySignatureIfNeeded(e);const s=a.value+this.getBarLength();!a.done&&e>=s&&(a=o.next(),this.barAccidentals={},n.isBarBeginning=!0),t.forEach((t=>{this.analyzePitch(t,e),n.minVStep=Math.max(t.vSteps,n.minVStep),n.maxVStep=Math.min(t.vSteps,n.maxVStep),n.notes.push(t)})),i&&(i.restToNextLength=e-r),this.musicBlockMap.set(e,n),i=n,r=e+n.notes[0].length})),this.initialRest={maxVStep:0,minVStep:0,restToNextLength:this.musicBlockMap.values().next().value.notes[0].start,isBarBeginning:!0,notes:[{start:0,length:0,vSteps:0,accidental:0,opacity:0,pitch:0,xHeadRight:0}]},this.key=s}getQNote(t){return{start:t.start,length:t.length,vSteps:0,accidental:0,opacity:this.getOpacity(t.intensity),pitch:t.pitch,xHeadRight:0}}splitQNote(t,e){const n=t.start+t.length-e;return e>t.start&&n>0?(t.length-=n,{start:e,length:n,vSteps:t.vSteps,accidental:t.accidental,opacity:t.opacity,pitch:t.pitch,xHeadRight:0,tiedFrom:t}):null}analyzePitch(t,e){const n=this.getPitchDetails(t.pitch);n.vSteps in this.barAccidentals?n.accidental===this.barAccidentals[n.vSteps]?n.accidental=0:(3===this.barAccidentals[n.vSteps]?n.accidental=n.keyAccidental:0===n.accidental&&(n.accidental=3),this.barAccidentals[n.vSteps]=n.accidental):(t.tiedFrom&&(n.accidental=0),this.barAccidentals[n.vSteps]=n.accidental),t.vSteps=n.vSteps,t.accidental=n.accidental}getPitchDetails(t){const e=t-60,n=Math.floor(e/12),s=e-12*n,i=o[this.key].steps[s],r=71===this.clef?6:-6,u=1===a[this.key].accidental?69+(s+3)%12:64+(s+8)%12;return{vSteps:r-7*n+i,accidental:o[this.key].accidental[s],keyAccidental:a[this.key].pitches.indexOf(u)>-1?a[this.key].accidental:0}}}},function(t,e,n){"use strict";n.r(e);var s=n(3);n.d(e,"MAX_QUARTER_DIVISION",(function(){return s.MAX_QUARTER_DIVISION})),n.d(e,"ScrollType",(function(){return s.ScrollType})),n.d(e,"StaffSVGRender",(function(){return s.StaffSVGRender}))}])}))},1241:function(t,e){"use strict";e.A=(t,e)=>{const n=t.__vccOpts||t;for(const[s,i]of e)n[s]=i;return n}},9306:function(t,e,n){"use strict";var s=n(4901),i=n(6823),r=TypeError;t.exports=function(t){if(s(t))return t;throw new r(i(t)+" is not a function")}},3506:function(t,e,n){"use strict";var s=n(3925),i=String,r=TypeError;t.exports=function(t){if(s(t))return t;throw new r("Can't set "+i(t)+" as a prototype")}},679:function(t,e,n){"use strict";var s=n(1625),i=TypeError;t.exports=function(t,e){if(s(e,t))return t;throw new i("Incorrect invocation")}},8551:function(t,e,n){"use strict";var s=n(34),i=String,r=TypeError;t.exports=function(t){if(s(t))return t;throw new r(i(t)+" is not an object")}},7811:function(t){"use strict";t.exports="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView},7394:function(t,e,n){"use strict";var s=n(6706),i=n(4576),r=TypeError;t.exports=s(ArrayBuffer.prototype,"byteLength","get")||function(t){if("ArrayBuffer"!==i(t))throw new r("ArrayBuffer expected");return t.byteLength}},3238:function(t,e,n){"use strict";var s=n(9504),i=n(7394),r=s(ArrayBuffer.prototype.slice);t.exports=function(t){if(0!==i(t))return!1;try{return r(t,0,0),!1}catch(e){return!0}}},5636:function(t,e,n){"use strict";var s=n(4475),i=n(9504),r=n(6706),o=n(7696),a=n(3238),u=n(7394),c=n(4483),l=n(1548),h=s.structuredClone,p=s.ArrayBuffer,d=s.DataView,f=s.TypeError,m=Math.min,g=p.prototype,y=d.prototype,b=i(g.slice),v=r(g,"resizable","get"),w=r(g,"maxByteLength","get"),x=i(y.getInt8),_=i(y.setInt8);t.exports=(l||c)&&function(t,e,n){var s,i=u(t),r=void 0===e?i:o(e),g=!v||!v(t);if(a(t))throw new f("ArrayBuffer is detached");if(l&&(t=h(t,{transfer:[t]}),i===r&&(n||g)))return t;if(i>=r&&(!n||g))s=b(t,0,r);else{var y=n&&!g&&w?{maxByteLength:w(t)}:void 0;s=new p(r,y);for(var k=new d(t),S=new d(s),T=m(r,i),I=0;I<T;I++)_(S,I,x(k,I))}return l||c(t),s}},4644:function(t,e,n){"use strict";var s,i,r,o=n(7811),a=n(3724),u=n(4475),c=n(4901),l=n(34),h=n(9297),p=n(6955),d=n(6823),f=n(6699),m=n(6840),g=n(2106),y=n(1625),b=n(2787),v=n(2967),w=n(8227),x=n(3392),_=n(1181),k=_.enforce,S=_.get,T=u.Int8Array,I=T&&T.prototype,C=u.Uint8ClampedArray,A=C&&C.prototype,N=T&&b(T),E=I&&b(I),O=Object.prototype,$=u.TypeError,R=w("toStringTag"),D=x("TYPED_ARRAY_TAG"),M="TypedArrayConstructor",P=o&&!!v&&"Opera"!==p(u.opera),F=!1,L={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},z={BigInt64Array:8,BigUint64Array:8},B=function(t){if(!l(t))return!1;var e=p(t);return"DataView"===e||h(L,e)||h(z,e)},q=function(t){var e=b(t);if(l(e)){var n=S(e);return n&&h(n,M)?n[M]:q(e)}},V=function(t){if(!l(t))return!1;var e=p(t);return h(L,e)||h(z,e)},W=function(t){if(V(t))return t;throw new $("Target is not a typed array")},j=function(t){if(c(t)&&(!v||y(N,t)))return t;throw new $(d(t)+" is not a typed array constructor")},U=function(t,e,n,s){if(a){if(n)for(var i in L){var r=u[i];if(r&&h(r.prototype,t))try{delete r.prototype[t]}catch(o){try{r.prototype[t]=e}catch(c){}}}E[t]&&!n||m(E,t,n?e:P&&I[t]||e,s)}},G=function(t,e,n){var s,i;if(a){if(v){if(n)for(s in L)if(i=u[s],i&&h(i,t))try{delete i[t]}catch(r){}if(N[t]&&!n)return;try{return m(N,t,n?e:P&&N[t]||e)}catch(r){}}for(s in L)i=u[s],!i||i[t]&&!n||m(i,t,e)}};for(s in L)i=u[s],r=i&&i.prototype,r?k(r)[M]=i:P=!1;for(s in z)i=u[s],r=i&&i.prototype,r&&(k(r)[M]=i);if((!P||!c(N)||N===Function.prototype)&&(N=function(){throw new $("Incorrect invocation")},P))for(s in L)u[s]&&v(u[s],N);if((!P||!E||E===O)&&(E=N.prototype,P))for(s in L)u[s]&&v(u[s].prototype,E);if(P&&b(A)!==E&&v(A,E),a&&!h(E,R))for(s in F=!0,g(E,R,{configurable:!0,get:function(){return l(this)?this[D]:void 0}}),L)u[s]&&f(u[s],D,s);t.exports={NATIVE_ARRAY_BUFFER_VIEWS:P,TYPED_ARRAY_TAG:F&&D,aTypedArray:W,aTypedArrayConstructor:j,exportTypedArrayMethod:U,exportTypedArrayStaticMethod:G,getTypedArrayConstructor:q,isView:B,isTypedArray:V,TypedArray:N,TypedArrayPrototype:E}},5370:function(t,e,n){"use strict";var s=n(6198);t.exports=function(t,e,n){var i=0,r=arguments.length>2?n:s(e),o=new t(r);while(r>i)o[i]=e[i++];return o}},9617:function(t,e,n){"use strict";var s=n(5397),i=n(5610),r=n(6198),o=function(t){return function(e,n,o){var a=s(e),u=r(a);if(0===u)return!t&&-1;var c,l=i(o,u);if(t&&n!==n){while(u>l)if(c=a[l++],c!==c)return!0}else for(;u>l;l++)if((t||l in a)&&a[l]===n)return t||l||0;return!t&&-1}};t.exports={includes:o(!0),indexOf:o(!1)}},4527:function(t,e,n){"use strict";var s=n(3724),i=n(4376),r=TypeError,o=Object.getOwnPropertyDescriptor,a=s&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}();t.exports=a?function(t,e){if(i(t)&&!o(t,"length").writable)throw new r("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e}},7680:function(t,e,n){"use strict";var s=n(9504);t.exports=s([].slice)},7628:function(t,e,n){"use strict";var s=n(6198);t.exports=function(t,e){for(var n=s(t),i=new e(n),r=0;r<n;r++)i[r]=t[n-r-1];return i}},9928:function(t,e,n){"use strict";var s=n(6198),i=n(1291),r=RangeError;t.exports=function(t,e,n,o){var a=s(t),u=i(n),c=u<0?a+u:u;if(c>=a||c<0)throw new r("Incorrect index");for(var l=new e(a),h=0;h<a;h++)l[h]=h===c?o:t[h];return l}},4576:function(t,e,n){"use strict";var s=n(9504),i=s({}.toString),r=s("".slice);t.exports=function(t){return r(i(t),8,-1)}},6955:function(t,e,n){"use strict";var s=n(2140),i=n(4901),r=n(4576),o=n(8227),a=o("toStringTag"),u=Object,c="Arguments"===r(function(){return arguments}()),l=function(t,e){try{return t[e]}catch(n){}};t.exports=s?r:function(t){var e,n,s;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=l(e=u(t),a))?n:c?r(e):"Object"===(s=r(e))&&i(e.callee)?"Arguments":s}},7740:function(t,e,n){"use strict";var s=n(9297),i=n(5031),r=n(7347),o=n(4913);t.exports=function(t,e,n){for(var a=i(e),u=o.f,c=r.f,l=0;l<a.length;l++){var h=a[l];s(t,h)||n&&s(n,h)||u(t,h,c(e,h))}}},2211:function(t,e,n){"use strict";var s=n(9039);t.exports=!s((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype}))},6699:function(t,e,n){"use strict";var s=n(3724),i=n(4913),r=n(6980);t.exports=s?function(t,e,n){return i.f(t,e,r(1,n))}:function(t,e,n){return t[e]=n,t}},6980:function(t){"use strict";t.exports=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}}},2106:function(t,e,n){"use strict";var s=n(283),i=n(4913);t.exports=function(t,e,n){return n.get&&s(n.get,e,{getter:!0}),n.set&&s(n.set,e,{setter:!0}),i.f(t,e,n)}},6840:function(t,e,n){"use strict";var s=n(4901),i=n(4913),r=n(283),o=n(9433);t.exports=function(t,e,n,a){a||(a={});var u=a.enumerable,c=void 0!==a.name?a.name:e;if(s(n)&&r(n,c,a),a.global)u?t[e]=n:o(e,n);else{try{a.unsafe?t[e]&&(u=!0):delete t[e]}catch(l){}u?t[e]=n:i.f(t,e,{value:n,enumerable:!1,configurable:!a.nonConfigurable,writable:!a.nonWritable})}return t}},9433:function(t,e,n){"use strict";var s=n(4475),i=Object.defineProperty;t.exports=function(t,e){try{i(s,t,{value:e,configurable:!0,writable:!0})}catch(n){s[t]=e}return e}},3724:function(t,e,n){"use strict";var s=n(9039);t.exports=!s((function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]}))},4483:function(t,e,n){"use strict";var s,i,r,o,a=n(4475),u=n(9714),c=n(1548),l=a.structuredClone,h=a.ArrayBuffer,p=a.MessageChannel,d=!1;if(c)d=function(t){l(t,{transfer:[t]})};else if(h)try{p||(s=u("worker_threads"),s&&(p=s.MessageChannel)),p&&(i=new p,r=new h(2),o=function(t){i.port1.postMessage(null,[t])},2===r.byteLength&&(o(r),0===r.byteLength&&(d=o)))}catch(f){}t.exports=d},4055:function(t,e,n){"use strict";var s=n(4475),i=n(34),r=s.document,o=i(r)&&i(r.createElement);t.exports=function(t){return o?r.createElement(t):{}}},6837:function(t){"use strict";var e=TypeError,n=9007199254740991;t.exports=function(t){if(t>n)throw e("Maximum allowed index exceeded");return t}},5002:function(t){"use strict";t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},7290:function(t,e,n){"use strict";var s=n(516),i=n(9088);t.exports=!s&&!i&&"object"==typeof window&&"object"==typeof document},6763:function(t){"use strict";t.exports="function"==typeof Bun&&Bun&&"string"==typeof Bun.version},516:function(t){"use strict";t.exports="object"==typeof Deno&&Deno&&"object"==typeof Deno.version},8119:function(t,e,n){"use strict";var s=n(9392);t.exports=/(?:ipad|iphone|ipod).*applewebkit/i.test(s)},9088:function(t,e,n){"use strict";var s=n(4475),i=n(4576);t.exports="process"===i(s.process)},9392:function(t){"use strict";t.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},7388:function(t,e,n){"use strict";var s,i,r=n(4475),o=n(9392),a=r.process,u=r.Deno,c=a&&a.versions||u&&u.version,l=c&&c.v8;l&&(s=l.split("."),i=s[0]>0&&s[0]<4?1:+(s[0]+s[1])),!i&&o&&(s=o.match(/Edge\/(\d+)/),(!s||s[1]>=74)&&(s=o.match(/Chrome\/(\d+)/),s&&(i=+s[1]))),t.exports=i},8727:function(t){"use strict";t.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},6193:function(t,e,n){"use strict";var s=n(9504),i=Error,r=s("".replace),o=function(t){return String(new i(t).stack)}("zxcasd"),a=/\n\s*at [^:]*:[^\n]*/,u=a.test(o);t.exports=function(t,e){if(u&&"string"==typeof t&&!i.prepareStackTrace)while(e--)t=r(t,a,"");return t}},6518:function(t,e,n){"use strict";var s=n(4475),i=n(7347).f,r=n(6699),o=n(6840),a=n(9433),u=n(7740),c=n(2796);t.exports=function(t,e){var n,l,h,p,d,f,m=t.target,g=t.global,y=t.stat;if(l=g?s:y?s[m]||a(m,{}):s[m]&&s[m].prototype,l)for(h in e){if(d=e[h],t.dontCallGetSet?(f=i(l,h),p=f&&f.value):p=l[h],n=c(g?h:m+(y?".":"#")+h,t.forced),!n&&void 0!==p){if(typeof d==typeof p)continue;u(d,p)}(t.sham||p&&p.sham)&&r(d,"sham",!0),o(l,h,d,t)}}},9039:function(t){"use strict";t.exports=function(t){try{return!!t()}catch(e){return!0}}},8745:function(t,e,n){"use strict";var s=n(616),i=Function.prototype,r=i.apply,o=i.call;t.exports="object"==typeof Reflect&&Reflect.apply||(s?o.bind(r):function(){return o.apply(r,arguments)})},6080:function(t,e,n){"use strict";var s=n(7476),i=n(9306),r=n(616),o=s(s.bind);t.exports=function(t,e){return i(t),void 0===e?t:r?o(t,e):function(){return t.apply(e,arguments)}}},616:function(t,e,n){"use strict";var s=n(9039);t.exports=!s((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")}))},9565:function(t,e,n){"use strict";var s=n(616),i=Function.prototype.call;t.exports=s?i.bind(i):function(){return i.apply(i,arguments)}},350:function(t,e,n){"use strict";var s=n(3724),i=n(9297),r=Function.prototype,o=s&&Object.getOwnPropertyDescriptor,a=i(r,"name"),u=a&&"something"===function(){}.name,c=a&&(!s||s&&o(r,"name").configurable);t.exports={EXISTS:a,PROPER:u,CONFIGURABLE:c}},6706:function(t,e,n){"use strict";var s=n(9504),i=n(9306);t.exports=function(t,e,n){try{return s(i(Object.getOwnPropertyDescriptor(t,e)[n]))}catch(r){}}},7476:function(t,e,n){"use strict";var s=n(4576),i=n(9504);t.exports=function(t){if("Function"===s(t))return i(t)}},9504:function(t,e,n){"use strict";var s=n(616),i=Function.prototype,r=i.call,o=s&&i.bind.bind(r,r);t.exports=s?o:function(t){return function(){return r.apply(t,arguments)}}},7751:function(t,e,n){"use strict";var s=n(4475),i=n(4901),r=function(t){return i(t)?t:void 0};t.exports=function(t,e){return arguments.length<2?r(s[t]):s[t]&&s[t][e]}},5966:function(t,e,n){"use strict";var s=n(9306),i=n(4117);t.exports=function(t,e){var n=t[e];return i(n)?void 0:s(n)}},4475:function(t,e,n){"use strict";var s=function(t){return t&&t.Math===Math&&t};t.exports=s("object"==typeof globalThis&&globalThis)||s("object"==typeof window&&window)||s("object"==typeof self&&self)||s("object"==typeof n.g&&n.g)||s("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9297:function(t,e,n){"use strict";var s=n(9504),i=n(8981),r=s({}.hasOwnProperty);t.exports=Object.hasOwn||function(t,e){return r(i(t),e)}},421:function(t){"use strict";t.exports={}},397:function(t,e,n){"use strict";var s=n(7751);t.exports=s("document","documentElement")},5917:function(t,e,n){"use strict";var s=n(3724),i=n(9039),r=n(4055);t.exports=!s&&!i((function(){return 7!==Object.defineProperty(r("div"),"a",{get:function(){return 7}}).a}))},7055:function(t,e,n){"use strict";var s=n(9504),i=n(9039),r=n(4576),o=Object,a=s("".split);t.exports=i((function(){return!o("z").propertyIsEnumerable(0)}))?function(t){return"String"===r(t)?a(t,""):o(t)}:o},3167:function(t,e,n){"use strict";var s=n(4901),i=n(34),r=n(2967);t.exports=function(t,e,n){var o,a;return r&&s(o=e.constructor)&&o!==n&&i(a=o.prototype)&&a!==n.prototype&&r(t,a),t}},3706:function(t,e,n){"use strict";var s=n(9504),i=n(4901),r=n(7629),o=s(Function.toString);i(r.inspectSource)||(r.inspectSource=function(t){return o(t)}),t.exports=r.inspectSource},1181:function(t,e,n){"use strict";var s,i,r,o=n(8622),a=n(4475),u=n(34),c=n(6699),l=n(9297),h=n(7629),p=n(6119),d=n(421),f="Object already initialized",m=a.TypeError,g=a.WeakMap,y=function(t){return r(t)?i(t):s(t,{})},b=function(t){return function(e){var n;if(!u(e)||(n=i(e)).type!==t)throw new m("Incompatible receiver, "+t+" required");return n}};if(o||h.state){var v=h.state||(h.state=new g);v.get=v.get,v.has=v.has,v.set=v.set,s=function(t,e){if(v.has(t))throw new m(f);return e.facade=t,v.set(t,e),e},i=function(t){return v.get(t)||{}},r=function(t){return v.has(t)}}else{var w=p("state");d[w]=!0,s=function(t,e){if(l(t,w))throw new m(f);return e.facade=t,c(t,w,e),e},i=function(t){return l(t,w)?t[w]:{}},r=function(t){return l(t,w)}}t.exports={set:s,get:i,has:r,enforce:y,getterFor:b}},4376:function(t,e,n){"use strict";var s=n(4576);t.exports=Array.isArray||function(t){return"Array"===s(t)}},1108:function(t,e,n){"use strict";var s=n(6955);t.exports=function(t){var e=s(t);return"BigInt64Array"===e||"BigUint64Array"===e}},4901:function(t){"use strict";var e="object"==typeof document&&document.all;t.exports="undefined"==typeof e&&void 0!==e?function(t){return"function"==typeof t||t===e}:function(t){return"function"==typeof t}},2796:function(t,e,n){"use strict";var s=n(9039),i=n(4901),r=/#|\.prototype\./,o=function(t,e){var n=u[a(t)];return n===l||n!==c&&(i(e)?s(e):!!e)},a=o.normalize=function(t){return String(t).replace(r,".").toLowerCase()},u=o.data={},c=o.NATIVE="N",l=o.POLYFILL="P";t.exports=o},4117:function(t){"use strict";t.exports=function(t){return null===t||void 0===t}},34:function(t,e,n){"use strict";var s=n(4901);t.exports=function(t){return"object"==typeof t?null!==t:s(t)}},3925:function(t,e,n){"use strict";var s=n(34);t.exports=function(t){return s(t)||null===t}},6395:function(t){"use strict";t.exports=!1},757:function(t,e,n){"use strict";var s=n(7751),i=n(4901),r=n(1625),o=n(7040),a=Object;t.exports=o?function(t){return"symbol"==typeof t}:function(t){var e=s("Symbol");return i(e)&&r(e.prototype,a(t))}},6198:function(t,e,n){"use strict";var s=n(8014);t.exports=function(t){return s(t.length)}},283:function(t,e,n){"use strict";var s=n(9504),i=n(9039),r=n(4901),o=n(9297),a=n(3724),u=n(350).CONFIGURABLE,c=n(3706),l=n(1181),h=l.enforce,p=l.get,d=String,f=Object.defineProperty,m=s("".slice),g=s("".replace),y=s([].join),b=a&&!i((function(){return 8!==f((function(){}),"length",{value:8}).length})),v=String(String).split("String"),w=t.exports=function(t,e,n){"Symbol("===m(d(e),0,7)&&(e="["+g(d(e),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(e="get "+e),n&&n.setter&&(e="set "+e),(!o(t,"name")||u&&t.name!==e)&&(a?f(t,"name",{value:e,configurable:!0}):t.name=e),b&&n&&o(n,"arity")&&t.length!==n.arity&&f(t,"length",{value:n.arity});try{n&&o(n,"constructor")&&n.constructor?a&&f(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(i){}var s=h(t);return o(s,"source")||(s.source=y(v,"string"==typeof e?e:"")),t};Function.prototype.toString=w((function(){return r(this)&&p(this).source||c(this)}),"toString")},741:function(t){"use strict";var e=Math.ceil,n=Math.floor;t.exports=Math.trunc||function(t){var s=+t;return(s>0?n:e)(s)}},2603:function(t,e,n){"use strict";var s=n(655);t.exports=function(t,e){return void 0===t?arguments.length<2?"":e:s(t)}},4913:function(t,e,n){"use strict";var s=n(3724),i=n(5917),r=n(8686),o=n(8551),a=n(6969),u=TypeError,c=Object.defineProperty,l=Object.getOwnPropertyDescriptor,h="enumerable",p="configurable",d="writable";e.f=s?r?function(t,e,n){if(o(t),e=a(e),o(n),"function"===typeof t&&"prototype"===e&&"value"in n&&d in n&&!n[d]){var s=l(t,e);s&&s[d]&&(t[e]=n.value,n={configurable:p in n?n[p]:s[p],enumerable:h in n?n[h]:s[h],writable:!1})}return c(t,e,n)}:c:function(t,e,n){if(o(t),e=a(e),o(n),i)try{return c(t,e,n)}catch(s){}if("get"in n||"set"in n)throw new u("Accessors not supported");return"value"in n&&(t[e]=n.value),t}},7347:function(t,e,n){"use strict";var s=n(3724),i=n(9565),r=n(8773),o=n(6980),a=n(5397),u=n(6969),c=n(9297),l=n(5917),h=Object.getOwnPropertyDescriptor;e.f=s?h:function(t,e){if(t=a(t),e=u(e),l)try{return h(t,e)}catch(n){}if(c(t,e))return o(!i(r.f,t,e),t[e])}},8480:function(t,e,n){"use strict";var s=n(1828),i=n(8727),r=i.concat("length","prototype");e.f=Object.getOwnPropertyNames||function(t){return s(t,r)}},3717:function(t,e){"use strict";e.f=Object.getOwnPropertySymbols},2787:function(t,e,n){"use strict";var s=n(9297),i=n(4901),r=n(8981),o=n(6119),a=n(2211),u=o("IE_PROTO"),c=Object,l=c.prototype;t.exports=a?c.getPrototypeOf:function(t){var e=r(t);if(s(e,u))return e[u];var n=e.constructor;return i(n)&&e instanceof n?n.prototype:e instanceof c?l:null}},1625:function(t,e,n){"use strict";var s=n(9504);t.exports=s({}.isPrototypeOf)},1828:function(t,e,n){"use strict";var s=n(9504),i=n(9297),r=n(5397),o=n(9617).indexOf,a=n(421),u=s([].push);t.exports=function(t,e){var n,s=r(t),c=0,l=[];for(n in s)!i(a,n)&&i(s,n)&&u(l,n);while(e.length>c)i(s,n=e[c++])&&(~o(l,n)||u(l,n));return l}},8773:function(t,e){"use strict";var n={}.propertyIsEnumerable,s=Object.getOwnPropertyDescriptor,i=s&&!n.call({1:2},1);e.f=i?function(t){var e=s(this,t);return!!e&&e.enumerable}:n},2967:function(t,e,n){"use strict";var s=n(6706),i=n(34),r=n(7750),o=n(3506);t.exports=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{t=s(Object.prototype,"__proto__","set"),t(n,[]),e=n instanceof Array}catch(a){}return function(n,s){return r(n),o(s),i(n)?(e?t(n,s):n.__proto__=s,n):n}}():void 0)},4270:function(t,e,n){"use strict";var s=n(9565),i=n(4901),r=n(34),o=TypeError;t.exports=function(t,e){var n,a;if("string"===e&&i(n=t.toString)&&!r(a=s(n,t)))return a;if(i(n=t.valueOf)&&!r(a=s(n,t)))return a;if("string"!==e&&i(n=t.toString)&&!r(a=s(n,t)))return a;throw new o("Can't convert object to primitive value")}},5031:function(t,e,n){"use strict";var s=n(7751),i=n(9504),r=n(8480),o=n(3717),a=n(8551),u=i([].concat);t.exports=s("Reflect","ownKeys")||function(t){var e=r.f(a(t)),n=o.f;return n?u(e,n(t)):e}},7979:function(t,e,n){"use strict";var s=n(8551);t.exports=function(){var t=s(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e}},7750:function(t,e,n){"use strict";var s=n(4117),i=TypeError;t.exports=function(t){if(s(t))throw new i("Can't call method on "+t);return t}},9472:function(t,e,n){"use strict";var s=n(4475),i=n(8745),r=n(4901),o=n(6763),a=n(9392),u=n(7680),c=n(2812),l=s.Function,h=/MSIE .\./.test(a)||o&&function(){var t=s.Bun.version.split(".");return t.length<3||"0"===t[0]&&(t[1]<3||"3"===t[1]&&"0"===t[2])}();t.exports=function(t,e){var n=e?2:1;return h?function(s,o){var a=c(arguments.length,1)>n,h=r(s)?s:l(s),p=a?u(arguments,n):[],d=a?function(){i(h,this,p)}:h;return e?t(d,o):t(d)}:t}},6119:function(t,e,n){"use strict";var s=n(5745),i=n(3392),r=s("keys");t.exports=function(t){return r[t]||(r[t]=i(t))}},7629:function(t,e,n){"use strict";var s=n(6395),i=n(4475),r=n(9433),o="__core-js_shared__",a=t.exports=i[o]||r(o,{});(a.versions||(a.versions=[])).push({version:"3.36.1",mode:s?"pure":"global",copyright:" 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.36.1/LICENSE",source:"https://github.com/zloirock/core-js"})},5745:function(t,e,n){"use strict";var s=n(7629);t.exports=function(t,e){return s[t]||(s[t]=e||{})}},1548:function(t,e,n){"use strict";var s=n(4475),i=n(9039),r=n(7388),o=n(7290),a=n(516),u=n(9088),c=s.structuredClone;t.exports=!!c&&!i((function(){if(a&&r>92||u&&r>94||o&&r>97)return!1;var t=new ArrayBuffer(8),e=c(t,{transfer:[t]});return 0!==t.byteLength||8!==e.byteLength}))},4495:function(t,e,n){"use strict";var s=n(7388),i=n(9039),r=n(4475),o=r.String;t.exports=!!Object.getOwnPropertySymbols&&!i((function(){var t=Symbol("symbol detection");return!o(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&s&&s<41}))},9225:function(t,e,n){"use strict";var s,i,r,o,a=n(4475),u=n(8745),c=n(6080),l=n(4901),h=n(9297),p=n(9039),d=n(397),f=n(7680),m=n(4055),g=n(2812),y=n(8119),b=n(9088),v=a.setImmediate,w=a.clearImmediate,x=a.process,_=a.Dispatch,k=a.Function,S=a.MessageChannel,T=a.String,I=0,C={},A="onreadystatechange";p((function(){s=a.location}));var N=function(t){if(h(C,t)){var e=C[t];delete C[t],e()}},E=function(t){return function(){N(t)}},O=function(t){N(t.data)},$=function(t){a.postMessage(T(t),s.protocol+"//"+s.host)};v&&w||(v=function(t){g(arguments.length,1);var e=l(t)?t:k(t),n=f(arguments,1);return C[++I]=function(){u(e,void 0,n)},i(I),I},w=function(t){delete C[t]},b?i=function(t){x.nextTick(E(t))}:_&&_.now?i=function(t){_.now(E(t))}:S&&!y?(r=new S,o=r.port2,r.port1.onmessage=O,i=c(o.postMessage,o)):a.addEventListener&&l(a.postMessage)&&!a.importScripts&&s&&"file:"!==s.protocol&&!p($)?(i=$,a.addEventListener("message",O,!1)):i=A in m("script")?function(t){d.appendChild(m("script"))[A]=function(){d.removeChild(this),N(t)}}:function(t){setTimeout(E(t),0)}),t.exports={set:v,clear:w}},5610:function(t,e,n){"use strict";var s=n(1291),i=Math.max,r=Math.min;t.exports=function(t,e){var n=s(t);return n<0?i(n+e,0):r(n,e)}},5854:function(t,e,n){"use strict";var s=n(2777),i=TypeError;t.exports=function(t){var e=s(t,"number");if("number"==typeof e)throw new i("Can't convert number to bigint");return BigInt(e)}},7696:function(t,e,n){"use strict";var s=n(1291),i=n(8014),r=RangeError;t.exports=function(t){if(void 0===t)return 0;var e=s(t),n=i(e);if(e!==n)throw new r("Wrong length or index");return n}},5397:function(t,e,n){"use strict";var s=n(7055),i=n(7750);t.exports=function(t){return s(i(t))}},1291:function(t,e,n){"use strict";var s=n(741);t.exports=function(t){var e=+t;return e!==e||0===e?0:s(e)}},8014:function(t,e,n){"use strict";var s=n(1291),i=Math.min;t.exports=function(t){var e=s(t);return e>0?i(e,9007199254740991):0}},8981:function(t,e,n){"use strict";var s=n(7750),i=Object;t.exports=function(t){return i(s(t))}},2777:function(t,e,n){"use strict";var s=n(9565),i=n(34),r=n(757),o=n(5966),a=n(4270),u=n(8227),c=TypeError,l=u("toPrimitive");t.exports=function(t,e){if(!i(t)||r(t))return t;var n,u=o(t,l);if(u){if(void 0===e&&(e="default"),n=s(u,t,e),!i(n)||r(n))return n;throw new c("Can't convert object to primitive value")}return void 0===e&&(e="number"),a(t,e)}},6969:function(t,e,n){"use strict";var s=n(2777),i=n(757);t.exports=function(t){var e=s(t,"string");return i(e)?e:e+""}},2140:function(t,e,n){"use strict";var s=n(8227),i=s("toStringTag"),r={};r[i]="z",t.exports="[object z]"===String(r)},655:function(t,e,n){"use strict";var s=n(6955),i=String;t.exports=function(t){if("Symbol"===s(t))throw new TypeError("Cannot convert a Symbol value to a string");return i(t)}},9714:function(t,e,n){"use strict";var s=n(9088);t.exports=function(t){try{if(s)return Function('return require("'+t+'")')()}catch(e){}}},6823:function(t){"use strict";var e=String;t.exports=function(t){try{return e(t)}catch(n){return"Object"}}},3392:function(t,e,n){"use strict";var s=n(9504),i=0,r=Math.random(),o=s(1..toString);t.exports=function(t){return"Symbol("+(void 0===t?"":t)+")_"+o(++i+r,36)}},7040:function(t,e,n){"use strict";var s=n(4495);t.exports=s&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},8686:function(t,e,n){"use strict";var s=n(3724),i=n(9039);t.exports=s&&i((function(){return 42!==Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype}))},2812:function(t){"use strict";var e=TypeError;t.exports=function(t,n){if(t<n)throw new e("Not enough arguments");return t}},8622:function(t,e,n){"use strict";var s=n(4475),i=n(4901),r=s.WeakMap;t.exports=i(r)&&/native code/.test(String(r))},8227:function(t,e,n){"use strict";var s=n(4475),i=n(5745),r=n(9297),o=n(3392),a=n(4495),u=n(7040),c=s.Symbol,l=i("wks"),h=u?c["for"]||c:c&&c.withoutSetter||o;t.exports=function(t){return r(l,t)||(l[t]=a&&r(c,t)?c[t]:h("Symbol."+t)),l[t]}},6573:function(t,e,n){"use strict";var s=n(3724),i=n(2106),r=n(3238),o=ArrayBuffer.prototype;s&&!("detached"in o)&&i(o,"detached",{configurable:!0,get:function(){return r(this)}})},7936:function(t,e,n){"use strict";var s=n(6518),i=n(5636);i&&s({target:"ArrayBuffer",proto:!0},{transferToFixedLength:function(){return i(this,arguments.length?arguments[0]:void 0,!1)}})},8100:function(t,e,n){"use strict";var s=n(6518),i=n(5636);i&&s({target:"ArrayBuffer",proto:!0},{transfer:function(){return i(this,arguments.length?arguments[0]:void 0,!0)}})},4114:function(t,e,n){"use strict";var s=n(6518),i=n(8981),r=n(6198),o=n(4527),a=n(6837),u=n(9039),c=u((function(){return 4294967297!==[].push.call({length:4294967296},1)})),l=function(){try{Object.defineProperty([],"length",{writable:!1}).push()}catch(t){return t instanceof TypeError}},h=c||!l();s({target:"Array",proto:!0,arity:1,forced:h},{push:function(t){var e=i(this),n=r(e),s=arguments.length;a(n+s);for(var u=0;u<s;u++)e[n]=arguments[u],n++;return o(e,n),n}})},9479:function(t,e,n){"use strict";var s=n(4475),i=n(3724),r=n(2106),o=n(7979),a=n(9039),u=s.RegExp,c=u.prototype,l=i&&a((function(){var t=!0;try{u(".","d")}catch(l){t=!1}var e={},n="",s=t?"dgimsy":"gimsy",i=function(t,s){Object.defineProperty(e,t,{get:function(){return n+=s,!0}})},r={dotAll:"s",global:"g",ignoreCase:"i",multiline:"m",sticky:"y"};for(var o in t&&(r.hasIndices="d"),r)i(o,r[o]);var a=Object.getOwnPropertyDescriptor(c,"flags").get.call(e);return a!==s||n!==s}));l&&r(c,"flags",{configurable:!0,get:o})},7467:function(t,e,n){"use strict";var s=n(7628),i=n(4644),r=i.aTypedArray,o=i.exportTypedArrayMethod,a=i.getTypedArrayConstructor;o("toReversed",(function(){return s(r(this),a(this))}))},4732:function(t,e,n){"use strict";var s=n(4644),i=n(9504),r=n(9306),o=n(5370),a=s.aTypedArray,u=s.getTypedArrayConstructor,c=s.exportTypedArrayMethod,l=i(s.TypedArrayPrototype.sort);c("toSorted",(function(t){void 0!==t&&r(t);var e=a(this),n=o(u(e),e);return l(n,t)}))},9577:function(t,e,n){"use strict";var s=n(9928),i=n(4644),r=n(1108),o=n(1291),a=n(5854),u=i.aTypedArray,c=i.getTypedArrayConstructor,l=i.exportTypedArrayMethod,h=!!function(){try{new Int8Array(1)["with"](2,{valueOf:function(){throw 8}})}catch(t){return 8===t}}();l("with",{with:function(t,e){var n=u(this),i=o(t),l=r(n)?a(e):+e;return s(n,c(n),i,l)}}["with"],!h)},6368:function(t,e,n){"use strict";var s=n(6518),i=n(4475),r=n(9225).clear;s({global:!0,bind:!0,enumerable:!0,forced:i.clearImmediate!==r},{clearImmediate:r})},4979:function(t,e,n){"use strict";var s=n(6518),i=n(4475),r=n(7751),o=n(6980),a=n(4913).f,u=n(9297),c=n(679),l=n(3167),h=n(2603),p=n(5002),d=n(6193),f=n(3724),m=n(6395),g="DOMException",y=r("Error"),b=r(g),v=function(){c(this,w);var t=arguments.length,e=h(t<1?void 0:arguments[0]),n=h(t<2?void 0:arguments[1],"Error"),s=new b(e,n),i=new y(e);return i.name=g,a(s,"stack",o(1,d(i.stack,1))),l(s,this,v),s},w=v.prototype=b.prototype,x="stack"in new y(g),_="stack"in new b(1,2),k=b&&f&&Object.getOwnPropertyDescriptor(i,g),S=!!k&&!(k.writable&&k.configurable),T=x&&!S&&!_;s({global:!0,constructor:!0,forced:m||T},{DOMException:T?v:b});var I=r(g),C=I.prototype;if(C.constructor!==I)for(var A in m||a(C,"constructor",o(1,I)),p)if(u(p,A)){var N=p[A],E=N.s;u(I,E)||a(I,E,o(6,N.c))}},9848:function(t,e,n){"use strict";n(6368),n(9309)},9309:function(t,e,n){"use strict";var s=n(6518),i=n(4475),r=n(9225).set,o=n(9472),a=i.setImmediate?o(r,!1):r;s({global:!0,bind:!0,enumerable:!0,forced:i.setImmediate!==a},{setImmediate:a})},4603:function(t,e,n){"use strict";var s=n(6840),i=n(9504),r=n(655),o=n(2812),a=URLSearchParams,u=a.prototype,c=i(u.append),l=i(u["delete"]),h=i(u.forEach),p=i([].push),d=new a("a=1&a=2&b=3");d["delete"]("a",1),d["delete"]("b",void 0),d+""!=="a=2"&&s(u,"delete",(function(t){var e=arguments.length,n=e<2?void 0:arguments[1];if(e&&void 0===n)return l(this,t);var s=[];h(this,(function(t,e){p(s,{key:e,value:t})})),o(e,1);var i,a=r(t),u=r(n),d=0,f=0,m=!1,g=s.length;while(d<g)i=s[d++],m||i.key===a?(m=!0,l(this,i.key)):f++;while(f<g)i=s[f++],i.key===a&&i.value===u||c(this,i.key,i.value)}),{enumerable:!0,unsafe:!0})},7566:function(t,e,n){"use strict";var s=n(6840),i=n(9504),r=n(655),o=n(2812),a=URLSearchParams,u=a.prototype,c=i(u.getAll),l=i(u.has),h=new a("a=1");!h.has("a",2)&&h.has("a",void 0)||s(u,"has",(function(t){var e=arguments.length,n=e<2?void 0:arguments[1];if(e&&void 0===n)return l(this,t);var s=c(this,t);o(e,1);var i=r(n),a=0;while(a<s.length)if(s[a++]===i)return!0;return!1}),{enumerable:!0,unsafe:!0})},8721:function(t,e,n){"use strict";var s=n(3724),i=n(9504),r=n(2106),o=URLSearchParams.prototype,a=i(o.forEach);s&&!("size"in o)&&r(o,"size",{get:function(){var t=0;return a(this,(function(){t++})),t},configurable:!0,enumerable:!0})},4904:function(t){function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,s=new Array(e);n<e;n++)s[n]=t[n];return s}t.exports=e,t.exports.__esModule=!0,t.exports["default"]=t.exports},7196:function(t){function e(t){if(Array.isArray(t))return t}t.exports=e,t.exports.__esModule=!0,t.exports["default"]=t.exports},7724:function(t){function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}t.exports=e,t.exports.__esModule=!0,t.exports["default"]=t.exports},7362:function(t,e,n){var s=n(81);function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,s(i.key),i)}}function r(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}t.exports=r,t.exports.__esModule=!0,t.exports["default"]=t.exports},4311:function(t,e,n){function s(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var s,i,r,o,a=[],u=!0,c=!1;try{if(r=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(s=r.call(n)).done)&&(a.push(s.value),a.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n["return"]&&(o=n["return"](),Object(o)!==o))return}finally{if(c)throw i}}return a}}n(4114),t.exports=s,t.exports.__esModule=!0,t.exports["default"]=t.exports},2729:function(t){function e(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}t.exports=e,t.exports.__esModule=!0,t.exports["default"]=t.exports},3686:function(t,e,n){var s=n(7196),i=n(4311),r=n(2229),o=n(2729);function a(t,e){return s(t)||i(t,e)||r(t,e)||o()}t.exports=a,t.exports.__esModule=!0,t.exports["default"]=t.exports},4612:function(t,e,n){var s=n(7045)["default"];function i(t,e){if("object"!=s(t)||!t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!=s(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}t.exports=i,t.exports.__esModule=!0,t.exports["default"]=t.exports},81:function(t,e,n){var s=n(7045)["default"],i=n(4612);function r(t){var e=i(t,"string");return"symbol"==s(e)?e:e+""}t.exports=r,t.exports.__esModule=!0,t.exports["default"]=t.exports},7045:function(t){function e(n){return t.exports=e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t.exports.__esModule=!0,t.exports["default"]=t.exports,e(n)}t.exports=e,t.exports.__esModule=!0,t.exports["default"]=t.exports},2229:function(t,e,n){var s=n(4904);function i(t,e){if(t){if("string"===typeof t)return s(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(t,e):void 0}}t.exports=i,t.exports.__esModule=!0,t.exports["default"]=t.exports},3829:function(t,e,n){"use strict";var s={};n.r(s),n.d(s,{assertParamsValid:function(){return Br},computeFlatOffset:function(){return Jr},computeOutShape:function(){return Vr},getNormalizedAxes:function(){return Gr},isSliceContinous:function(){return Zr},maskToAxes:function(){return qr},parseSliceParams:function(){return to},sliceInfo:function(){return eo},startForAxis:function(){return Qr},startIndicesWithElidedDims:function(){return Hr},stopForAxis:function(){return Yr},stopIndicesWithElidedDims:function(){return Kr},stridesForAxis:function(){return Xr},stridesWithElidedDims:function(){return Wr}});var i={};n.r(i),n.d(i,{collectGatherOpShapeInfo:function(){return Up},computeOutShape:function(){return jp},segOpComputeOptimalWindowSize:function(){return Wp}});var r={};n.r(r),n.d(r,{ERF_A1:function(){return Cp},ERF_A2:function(){return Ap},ERF_A3:function(){return Np},ERF_A4:function(){return Ep},ERF_A5:function(){return Op},ERF_P:function(){return Ip},PARALLELIZE_THRESHOLD:function(){return pp},SELU_SCALE:function(){return Tp},SELU_SCALEALPHA:function(){return Sp},applyActivation:function(){return Nl},assertAndGetBroadcastShape:function(){return La},assertAxesAreInnerMostDims:function(){return Pu},assertParamsConsistent:function(){return lp},assignToTypedArray:function(){return zp},axesAreInnerMostDims:function(){return $u},calculateShapes:function(){return kp},castTensor:function(){return Gp},combineLocations:function(){return Ru},complexWithEvenIndex:function(){return Pp},complexWithOddIndex:function(){return Fp},computeConv2DInfo:function(){return Oo},computeConv3DInfo:function(){return $o},computeDefaultPad:function(){return Mo},computeDilation2DInfo:function(){return Ao},computeOptimalWindowSize:function(){return dp},computeOutAndReduceShapes:function(){return Du},computeOutShape:function(){return hp},computePool2DInfo:function(){return No},computePool3DInfo:function(){return Eo},convertConv2DDataFormat:function(){return jo},eitherStridesOrDilationsAreOne:function(){return Wo},expandShapeToKeepDim:function(){return Mu},exponent:function(){return qp},exponents:function(){return Bp},fromStringArrayToUint8:function(){return Xp},fromUint8ToStringArray:function(){return Kp},getAxesPermutation:function(){return Fu},getBroadcastDims:function(){return Pa},getComplexWithIndex:function(){return Lp},getFusedBiasGradient:function(){return Al},getFusedDyActivation:function(){return Cl},getImageCenter:function(){return fp},getInnerMostAxes:function(){return zu},getPermuted:function(){return gp},getReductionAxes:function(){return Fa},getReshaped:function(){return mp},getReshapedPermuted:function(){return yp},getSliceBeginCoords:function(){return bp},getSliceSize:function(){return vp},getUndoAxesPermutation:function(){return Lu},log:function(){return Rp},mergeRealAndImagArrays:function(){return Dp},prepareAndValidate:function(){return wp},prepareSplitSize:function(){return Vp},reshapeTensor:function(){return Hp},segment_util:function(){return i},shouldFuse:function(){return El},slice_util:function(){return s},splitRealAndImagArrays:function(){return Mp},tupleValuesAreOne:function(){return Vo},upcastType:function(){return Zs},validateInput:function(){return _p},validateUpdateShape:function(){return xp},warn:function(){return $p}});var o={};n.r(o),n.d(o,{addImpl:function(){return bT},bincountImpl:function(){return SI},bincountReduceImpl:function(){return TI},ceilImpl:function(){return NI},concatImpl:function(){return PI},expImpl:function(){return MC},expm1Impl:function(){return BC},floorImpl:function(){return hA},gatherV2Impl:function(){return kA},greaterImpl:function(){return IA},lessImpl:function(){return BA},linSpaceImpl:function(){return GA},logImpl:function(){return XA},maxImpl:function(){return pN},maximumImpl:function(){return mN},minimumImpl:function(){return DN},multiplyImpl:function(){return WC},negImpl:function(){return HN},prodImpl:function(){return xE},rangeImpl:function(){return SE},rsqrtImpl:function(){return VE},simpleAbsImpl:function(){return AT},sliceImpl:function(){return vI},stridedSliceImpl:function(){return IO},subImpl:function(){return QC},tileImpl:function(){return RO},topKImpl:function(){return PO},transposeImpl:function(){return FT},uniqueImpl:function(){return zO}});var a={};n.r(a),n.d(a,{assert:function(){return N0},assertContextRunning:function(){return O0},assertRange:function(){return E0},log:function(){return D0},setLogger:function(){return R0},warn:function(){return M0}});var u={};n.r(u);var c={};n.r(c),n.d(c,{AMOscillator:function(){return Q2},AMSynth:function(){return A3},Abs:function(){return p3},Add:function(){return s3},AmplitudeEnvelope:function(){return T3},Analyser:function(){return i5},AudioToGain:function(){return K2},AutoFilter:function(){return w4},AutoPanner:function(){return _4},AutoWah:function(){return S4},BaseContext:function(){return I1},BiquadFilter:function(){return N3},BitCrusher:function(){return C4},Buffer:function(){return L5},BufferSource:function(){return B5},Buffers:function(){return z5},Channel:function(){return p5},Chebyshev:function(){return N4},Chorus:function(){return D4},Clock:function(){return b2},Compressor:function(){return b5},Context:function(){return C1},Convolver:function(){return S5},CrossFade:function(){return y4},DCMeter:function(){return u5},Delay:function(){return v2},Destination:function(){return N5},Distortion:function(){return M4},Draw:function(){return D5},DuoSynth:function(){return R3},EQ3:function(){return k5},Emitter:function(){return T1},Envelope:function(){return x3},FFT:function(){return a5},FMOscillator:function(){return Y2},FMSynth:function(){return D3},FatOscillator:function(){return J2},FeedbackCombFilter:function(){return X3},FeedbackDelay:function(){return F4},Filter:function(){return E3},Follower:function(){return k4},Freeverb:function(){return V4},Frequency:function(){return t2},FrequencyClass:function(){return Y1},FrequencyEnvelope:function(){return O3},FrequencyShifter:function(){return z4},Gain:function(){return l2},GainToAudio:function(){return d3},Gate:function(){return v5},GrainPlayer:function(){return h3},GreaterThan:function(){return y3},GreaterThanZero:function(){return g3},IntervalTimeline:function(){return C2},JCReverb:function(){return G4},LFO:function(){return o3},Limiter:function(){return w5},Listener:function(){return $5},Loop:function(){return n4},LowpassCombFilter:function(){return Y3},Master:function(){return E5},MembraneSynth:function(){return F3},Merge:function(){return O4},MetalSynth:function(){return P3},Meter:function(){return o5},MidSideCompressor:function(){return x5},MidSideMerge:function(){return J4},MidSideSplit:function(){return Z4},Midi:function(){return k2},MidiClass:function(){return _2},Mono:function(){return d5},MonoSynth:function(){return $3},MultibandCompressor:function(){return _5},MultibandSplit:function(){return f5},Multiply:function(){return X2},Negate:function(){return f3},Noise:function(){return F2},NoiseSynth:function(){return L3},Offline:function(){return w2},OfflineContext:function(){return R1},OmniOscillator:function(){return n3},OnePoleFilter:function(){return Q3},Oscillator:function(){return U2},PWMOscillator:function(){return t3},PanVol:function(){return h5},Panner:function(){return x4},Panner3D:function(){return g5},Param:function(){return r2},Part:function(){return s4},Pattern:function(){return m4},Phaser:function(){return Q4},PingPongDelay:function(){return K4},PitchShift:function(){return X4},Player:function(){return c3},Players:function(){return l3},PluckSynth:function(){return Z3},PolySynth:function(){return J3},Pow:function(){return b3},PulseOscillator:function(){return Z2},Recorder:function(){return y5},Reverb:function(){return Y4},Sampler:function(){return t4},Scale:function(){return i3},ScaleExp:function(){return v3},Sequence:function(){return g4},Signal:function(){return d2},Solo:function(){return l5},Split:function(){return E4},StateTimeline:function(){return i2},StereoWidener:function(){return e5},Subtract:function(){return m3},SyncedSignal:function(){return w3},Synth:function(){return I3},Ticks:function(){return T2},TicksClass:function(){return S2},Time:function(){return Q1},TimeClass:function(){return X1},Timeline:function(){return b1},ToneAudioBuffer:function(){return $1},ToneAudioBuffers:function(){return x2},ToneAudioNode:function(){return o2},ToneBufferSource:function(){return P2},ToneEvent:function(){return e4},ToneOscillatorNode:function(){return j2},Transport:function(){return C5},TransportTime:function(){return n2},TransportTimeClass:function(){return e2},Tremolo:function(){return n5},Unit:function(){return u},UserMedia:function(){return V2},Vibrato:function(){return s5},Volume:function(){return N2},WaveShaper:function(){return H2},Waveform:function(){return c5},Zero:function(){return r3},connect:function(){return u2},connectSeries:function(){return a2},connectSignal:function(){return f2},context:function(){return P5},dbToGain:function(){return z1},debug:function(){return a},defaultArg:function(){return c1},disconnect:function(){return c2},ftom:function(){return U1},gainToDb:function(){return B1},getContext:function(){return P1},getDestination:function(){return O5},getDraw:function(){return M5},getListener:function(){return R5},getTransport:function(){return A5},immediate:function(){return I5},intervalToFrequencyRatio:function(){return q1},isArray:function(){return V0},isBoolean:function(){return q0},isDefined:function(){return F0},isFunction:function(){return L0},isNote:function(){return j0},isNumber:function(){return z0},isObject:function(){return B0},isString:function(){return W0},isUndef:function(){return P0},loaded:function(){return F5},mtof:function(){return H1},now:function(){return T5},optionsFromArguments:function(){return a1},setContext:function(){return F1},start:function(){return L1},supported:function(){return A0},version:function(){return $G}});n(4114);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const l=1e-7,h=1e-4;class p{constructor(t,e){this.backend=t,this.dataMover=e,this.data=new WeakMap,this.dataIdsCount=0}get(t){return this.data.has(t)||this.dataMover.moveData(this.backend,t),this.data.get(t)}set(t,e){this.dataIdsCount++,this.data.set(t,e)}has(t){return this.data.has(t)}delete(t){return this.dataIdsCount--,this.data.delete(t)}numDataIds(){return this.dataIdsCount}}class d{decComplexRef(t){}time(t){return f("time")}read(t){return f("read")}readSync(t){return f("readSync")}numDataIds(){return f("numDataIds")}disposeData(t){return f("disposeData")}write(t,e,n){return f("write")}move(t,e,n,s){return f("move")}memory(){return f("memory")}floatPrecision(){return f("floatPrecision")}epsilon(){return 32===this.floatPrecision()?l:h}batchMatMul(t,e,n,s){return f("batchMatMul")}fusedBatchMatMul({a:t,b:e,transposeA:n,transposeB:s,bias:i,activation:r,preluActivationWeights:o}){return f("fusedBatchMatMul")}slice(t,e,n){return f("slice")}stridedSlice(t,e,n,s){return f("stridedSlice")}unstack(t,e){return f("unstack")}reverse(t,e){return f("reverse")}concat(t,e){return f("concat")}neg(t){return f("neg")}add(t,e){return f("add")}addN(t){return f("addN")}subtract(t,e){return f("subtract")}multiply(t,e){return f("multiply")}realDivide(t,e){return f("realDivide")}floorDiv(t,e){return f("floorDiv")}sum(t,e){return f("sum")}prod(t,e){return f("prod")}unsortedSegmentSum(t,e,n){return f("unsortedSegmentSum")}argMin(t,e){return f("argMin")}argMax(t,e){return f("argMax")}equal(t,e){return f("equal")}notEqual(t,e){return f("notEqual")}less(t,e){return f("less")}lessEqual(t,e){return f("lessEqual")}greater(t,e){return f("greater")}greaterEqual(t,e){return f("greaterEqual")}logicalNot(t){return f("logicalNot")}logicalAnd(t,e){return f("logicalAnd")}logicalOr(t,e){return f("logicalOr")}where(t){return f("where")}select(t,e,n){return f("select")}topk(t,e,n){return f("topk")}min(t,e){return f("min")}minimum(t,e){return f("minimum")}mod(t,e){return f("mod")}max(t,e){return f("max")}maximum(t,e){return f("maximum")}all(t,e){return f("all")}any(t,e){return f("any")}squaredDifference(t,e){return f("squaredDifference")}ceil(t){return f("ceil")}floor(t){return f("floor")}round(t){return f("round")}sign(t){return f("sign")}isNaN(t){return f("isNaN")}isInf(t){return f("isInf")}isFinite(t){return f("isFinite")}pow(t,e){return f("pow")}exp(t){return f("exp")}expm1(t){return f("expm1")}softmax(t,e){return f("softmax")}log(t){return f("log")}log1p(t){return f("log1p")}sqrt(t){return f("sqrt")}rsqrt(t){return f("rsqrt")}square(t){return f("square")}reciprocal(t){return f("reciprocal")}relu(t){return f("relu")}relu6(t){return f("relu6")}prelu(t,e){return f("prelu")}elu(t){return f("elu")}eluDer(t,e){return f("eluDer")}selu(t){return f("selu")}int(t){return f("int")}clip(t,e,n){return f("clip")}abs(t){return f("abs")}complexAbs(t){return f("complexAbs")}sigmoid(t){return f("sigmoid")}softplus(t){return f("softplus")}sin(t){return f("sin")}cos(t){return f("cos")}tan(t){return f("tan")}asin(t){return f("asin")}acos(t){return f("acos")}atan(t){return f("atan")}atan2(t,e){return f("atan2")}sinh(t){return f("sinh")}cosh(t){return f("cosh")}tanh(t){return f("tanh")}asinh(t){return f("asinh")}acosh(t){return f("acosh")}atanh(t){return f("atanh")}erf(t){return f("erf")}step(t,e){return f("step")}fusedConv2d({input:t,filter:e,convInfo:n,bias:s,activation:i,preluActivationWeights:r}){return f("fusedConv2d")}conv2d(t,e,n){return f("conv2d")}conv2dDerInput(t,e,n){return f("conv2dDerInput")}conv2dDerFilter(t,e,n){return f("conv2dDerFilter")}fusedDepthwiseConv2D({input:t,filter:e,convInfo:n,bias:s,activation:i,preluActivationWeights:r}){return f("fusedDepthwiseConv2D")}depthwiseConv2D(t,e,n){return f("depthwiseConv2D")}depthwiseConv2DDerInput(t,e,n){return f("depthwiseConv2DDerInput")}depthwiseConv2DDerFilter(t,e,n){return f("depthwiseConv2DDerFilter")}conv3d(t,e,n){return f("conv3d")}conv3dDerInput(t,e,n){return f("conv3dDerInput")}conv3dDerFilter(t,e,n){return f("conv3dDerFilter")}maxPool(t,e){return f("maxPool")}maxPoolBackprop(t,e,n,s){return f("maxPoolBackprop")}avgPool(t,e){return f("avgPool")}avgPoolBackprop(t,e,n){return f("avgPoolBackprop")}avgPool3d(t,e){return f("avgPool3d")}avgPool3dBackprop(t,e,n){return f("avgPool3dBackprop")}maxPool3d(t,e){return f("maxPool3d")}maxPool3dBackprop(t,e,n,s){return f("maxPool3dBackprop")}reshape(t,e){return f("reshape")}cast(t,e){return f("cast")}tile(t,e){return f("tile")}pad(t,e,n){return f("pad")}transpose(t,e){return f("transpose")}gather(t,e,n,s=0){return f("gather")}gatherND(t,e){return f("gatherND")}scatterND(t,e,n){return f("scatterND")}batchToSpaceND(t,e,n){return f("batchToSpaceND")}spaceToBatchND(t,e,n){return f("spaceToBatchND")}resizeBilinear(t,e,n,s,i){return f("resizeBilinear")}resizeBilinearBackprop(t,e,n){return f("resizeBilinearBackprop")}resizeNearestNeighbor(t,e,n,s,i){return f("resizeNearestNeighbor")}resizeNearestNeighborBackprop(t,e,n){return f("resizeNearestNeighborBackprop")}batchNorm(t,e,n,s,i,r){return f("batchNorm")}localResponseNormalization4D(t,e,n,s,i){return f("localResponseNormalization4D")}LRNGrad(t,e,n,s,i,r,o){return f("LRNGrad")}multinomial(t,e,n,s){return f("multinomial")}oneHot(t,e,n,s){return f("oneHot")}cumsum(t,e,n,s){return f("cumsum")}nonMaxSuppression(t,e,n,s,i){return f("nonMaxSuppression")}fft(t){return f("fft")}ifft(t){return f("ifft")}complex(t,e){return f("complex")}real(t){return f("real")}imag(t){return f("imag")}cropAndResize(t,e,n,s,i,r){return f("cropAndResize")}depthToSpace(t,e,n){return f("depthToSpace")}split(t,e,n){return f("split")}sparseToDense(t,e,n,s){return f("sparseToDense")}diag(t){return f("diag")}fill(t,e,n){return f("fill")}onesLike(t){return f("onesLike")}zerosLike(t){return f("zerosLike")}linspace(t,e,n){return f("linspace")}dispose(){return f("dispose")}}function f(t){throw new Error(`'${t}' not yet implemented or not found in the registry. This kernel may not be supported by the tfjs backend you have chosen`)}n(9479),n(6573),n(8100),n(7936),n(7467),n(4732),n(9577);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function m(t){let e=t.length,n=0,s=0;while(e>0)s=Math.random()*e|0,e--,n=t[e],t[e]=t[s],t[s]=n}function g(t,e,n){return Math.max(t,Math.min(e,n))}function y(t){return t%2===0?t:t+1}function b(t){let e=0;for(let n=0;n<t.length;n++)e+=t[n];return e}function v(t,e){if(!t)throw new Error("string"===typeof e?e:e())}function w(t,e,n=""){v(S(t,e),(()=>n+` Shapes ${t} and ${e} must match`))}function x(t){v(null!=t,(()=>"The input to the tensor constructor must be a non-null value."))}function _(t,e=[],n=!1){if(null==e&&(e=[]),Array.isArray(t)||F(t)&&!n)for(let s=0;s<t.length;++s)_(t[s],e,n);else e.push(t);return e}function k(t){if(0===t.length)return 1;let e=t[0];for(let n=1;n<t.length;n++)e*=t[n];return e}function S(t,e){if(t===e)return!0;if(null==t||null==e)return!1;if(t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(t[n]!==e[n])return!1;return!0}function T(t){return t%1===0}function I(t){const e=Math.ceil(Math.sqrt(t));return[e,Math.ceil(t/e)]}function C(t,e){return e<=t.length?t:t+" ".repeat(e-t.length)}function A(t,e=(t=>0),n){return new Promise(((s,i)=>{let r=0;const o=()=>{if(t())return void s();r++;const a=e(r);null!=n&&r>=n?i():setTimeout(o,a)};o()}))}function N(t,e){let n=1,s=-1;for(let r=0;r<t.length;++r)if(t[r]>=0)n*=t[r];else if(-1===t[r]){if(-1!==s)throw Error(`Shapes can only have 1 implicit size. Found -1 at dim ${s} and dim ${r}`);s=r}else if(t[r]<0)throw Error(`Shapes can not be < 0. Found ${t[r]} at dim ${r}`);if(-1===s){if(e>0&&e!==n)throw Error(`Size(${e}) must match the product of shape ${t}`);return t}if(0===n)throw Error(`Cannot infer the missing size in [${t}] when there are 0 elements`);if(e%n!==0)throw Error(`The implicit shape can't be a fractional number. Got ${e} / ${n}`);const i=t.slice();return i[s]=e/n,i}function E(t,e){const n=e.length;return t=null==t?e.map(((t,e)=>e)):[].concat(t),v(t.every((t=>t>=-n&&t<n)),(()=>`All values in axis param must be in range [-${n}, ${n}) but got axis ${t}`)),v(t.every((t=>T(t))),(()=>`All values in axis param must be integers but got axis ${t}`)),t.map((t=>t<0?n+t:t))}function O(t,e){const n=[],s=[],i=null!=e&&Array.isArray(e)&&0===e.length,r=null==e||i?null:E(e,t).sort();let o=0;for(let a=0;a<t.length;++a){if(null!=r){if(r[o]===a&&1!==t[a])throw new Error(`Can't squeeze axis ${a} since its dim '${t[a]}' is not 1`);(null==r[o]||r[o]>a)&&1===t[a]&&(n.push(t[a]),s.push(a)),r[o]<=a&&o++}1!==t[a]&&(n.push(t[a]),s.push(a))}return{newShape:n,keptDims:s}}function $(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else{if("bool"!==t)throw new Error(`Unknown data type ${t}`);n=new Uint8Array(e)}return n}function R(t,e){let n=null;if(null==t||"float32"===t)n=new Float32Array(e);else if("int32"===t)n=new Int32Array(e);else if("bool"===t)n=new Uint8Array(e);else{if("string"!==t)throw new Error(`Unknown data type ${t}`);n=new Array(e)}return n}function D(t,e){for(let n=0;n<t.length;n++){const s=t[n];if(isNaN(s)||!isFinite(s))throw Error(`A tensor of type ${e} being uploaded contains ${s}.`)}}function M(t){return"bool"===t||"complex64"===t||"float32"===t||"int32"===t||"string"===t}function P(t,e){return"complex64"!==e&&(("float32"!==e||"complex64"===t)&&(("int32"!==e||"float32"===t||"complex64"===t)&&("bool"!==e||"bool"!==t)))}function F(t){return t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array}function L(t){if("float32"===t||"int32"===t)return 4;if("complex64"===t)return 8;if("bool"===t)return 1;throw new Error(`Unknown dtype ${t}`)}function z(t){if(null==t)return 0;let e=0;return t.forEach((t=>e+=t.length)),e}function B(t){return"string"===typeof t||t instanceof String}function q(t){return"boolean"===typeof t}function V(t){return"number"===typeof t}function W(t){return Array.isArray(t)?W(t[0]):t instanceof Float32Array?"float32":t instanceof Int32Array||t instanceof Uint8Array?"int32":V(t)?"float32":B(t)?"string":q(t)?"bool":"float32"}function j(t){return!!(t&&t.constructor&&t.call&&t.apply)}function U(t,e){for(let n=e;n<t;++n)if(t%n===0)return n;return t}function G(t){const e=t.length;if(e<2)return[];const n=new Array(e-1);n[e-2]=t[e-1];for(let s=e-3;s>=0;--s)n[s]=n[s+1]*t[s+1];return n}function H(t,e,n){const s=new Array;if(1===e.length){const i=e[0];for(let e=0;e<i;e++)s[e]=n[t+e]}else{const i=e[0],r=e.slice(1),o=r.reduce(((t,e)=>t*e));for(let e=0;e<i;e++)s[e]=H(t+e*o,r,n)}return s}function K(t,e){if(0===t.length)return e[0];const n=t.reduce(((t,e)=>t*e));if(0===n)return[];if(n!==e.length)throw new Error(`[${t}] does not match the input size ${e.length}.`);return H(0,t,e)}function X(t,e){const n=Q(t,e);for(let s=0;s<n.length;s++)n[s]=1;return n}function Q(t,e){if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e)return new Uint8Array(t);throw new Error(`Unknown data type ${e}`)}function Y(t,e){const n=t.reduce(((t,e)=>t*e),1);if(null==e||"float32"===e)return K(t,new Float32Array(n));if("int32"===e)return K(t,new Int32Array(n));if("bool"===e)return K(t,new Uint8Array(n));throw new Error(`Unknown data type ${e}`)}function Z(t){t.forEach((e=>{v(Number.isInteger(e)&&e>=0,(()=>`Tensor must have a shape comprised of positive integers but got shape [${t}].`))}))}function J(t,e,n){if(0===e)return 0;if(1===e)return t[0];let s=t[t.length-1];for(let i=0;i<t.length-1;++i)s+=n[i]*t[i];return s}function tt(t,e,n){if(0===e)return[];if(1===e)return[t];const s=new Array(e);for(let i=0;i<s.length-1;++i)s[i]=Math.floor(t/n[i]),t-=s[i]*n[i];return s[s.length-1]=t,s}function et(t){return t&&t.then&&"function"===typeof t.then}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const nt="tfjsflags";class st{constructor(t){this.global=t,this.flags={},this.flagRegistry={},this.urlFlags={},this.populateURLFlags()}setPlatform(t,e){null!=this.platform&&console.warn(`Platform ${this.platformName} has already been set. Overwriting the platform with ${e}.`),this.platformName=t,this.platform=e}registerFlag(t,e,n){if(this.flagRegistry[t]={evaluationFn:e,setHook:n},null!=this.urlFlags[t]){const e=this.urlFlags[t];console.warn(`Setting feature override from URL ${t}: ${e}.`),this.set(t,e)}}async getAsync(t){return t in this.flags||(this.flags[t]=await this.evaluateFlag(t)),this.flags[t]}get(t){if(t in this.flags)return this.flags[t];const e=this.evaluateFlag(t);if(et(e))throw new Error(`Flag ${t} cannot be synchronously evaluated. Please use getAsync() instead.`);return this.flags[t]=e,this.flags[t]}getNumber(t){return this.get(t)}getBool(t){return this.get(t)}getFlags(){return this.flags}get features(){return this.flags}set(t,e){if(null==this.flagRegistry[t])throw new Error(`Cannot set flag ${t} as it has not been registered.`);this.flags[t]=e,null!=this.flagRegistry[t].setHook&&this.flagRegistry[t].setHook(e)}evaluateFlag(t){if(null==this.flagRegistry[t])throw new Error(`Cannot evaluate flag '${t}': no evaluation function found.`);return this.flagRegistry[t].evaluationFn()}setFlags(t){this.flags=Object.assign({},t)}reset(){this.flags={},this.urlFlags={},this.populateURLFlags()}populateURLFlags(){if("undefined"===typeof this.global||"undefined"===typeof this.global.location||"undefined"===typeof this.global.location.search)return;const t=it(this.global.location.search);if(nt in t){const e=t[nt].split(",");e.forEach((t=>{const[e,n]=t.split(":");this.urlFlags[e]=ot(e,n)}))}}}function it(t){const e={};return t.replace(/[?&]([^=?&]+)(?:=([^&]*))?/g,((t,...n)=>(rt(e,n[0],n[1]),n.join("=")))),e}function rt(t,e,n){t[decodeURIComponent(e)]=decodeURIComponent(n||"")}function ot(t,e){if(e=e.toLowerCase(),"true"===e||"false"===e)return"true"===e;if(""+ +e===e)return+e;throw new Error(`Could not parse value flag value ${e} for flag ${t}.`)}function at(){return ct}let ut,ct=null;function lt(t){ct=t}function ht(){if(null==ut){let t;if("undefined"!==typeof window)t=window;else if("undefined"!==typeof n.g)t=n.g;else if("undefined"!==typeof process)t=process;else{if("undefined"===typeof self)throw new Error("Could not find a global object");t=self}ut=t}return ut}function pt(){const t=ht();return null==t._tfGlobals&&(t._tfGlobals=new Map),t._tfGlobals}function dt(t,e){const n=pt();if(n.has(t))return n.get(t);{const s=e();return n.set(t,s),n.get(t)}}const ft="Abs",mt="Acos",gt="Acosh",yt="Add",bt="AddN",vt="All",wt="Any",xt="ArgMax",_t="ArgMin",kt="Asin",St="Asinh",Tt="Atan",It="Atanh",Ct="Atan2",At="AvgPool",Nt="AvgPoolGrad",Et="AvgPool3D",Ot="AvgPool3DGrad",$t="BatchMatMul",Rt="BatchToSpaceND",Dt="Bincount",Mt="BroadcastTo",Pt="Cast",Ft="Ceil",Lt="ClipByValue",zt="Complex",Bt="ComplexAbs",qt="Concat",Vt="Conv2D",Wt="Conv2DBackpropFilter",jt="Conv2DBackpropInput",Ut="Conv3D",Gt="Conv3DBackpropFilterV2",Ht="Conv3DBackpropInputV2",Kt="Cos",Xt="Cosh",Qt="Cumsum",Yt="CropAndResize",Zt="DenseBincount",Jt="DepthToSpace",te="DepthwiseConv2dNative",ee="DepthwiseConv2dNativeBackpropFilter",ne="DepthwiseConv2dNativeBackpropInput",se="Diag",ie="Dilation2D",re="Dilation2DBackpropInput",oe="Dilation2DBackpropFilter",ae="RealDiv",ue="Elu",ce="EluGrad",le="Erf",he="Equal",pe="Exp",de="ExpandDims",fe="Expm1",me="FFT",ge="Fill",ye="FlipLeftRight",be="Floor",ve="FloorDiv",we="FusedBatchNorm",xe="GatherV2",_e="GatherNd",ke="Greater",Se="GreaterEqual",Te="Identity",Ie="IFFT",Ce="Imag",Ae="IsFinite",Ne="IsInf",Ee="IsNan",Oe="LeakyRelu",$e="Less",Re="LessEqual",De="LinSpace",Me="Log",Pe="Log1p",Fe="LogicalAnd",Le="LogicalNot",ze="LogicalOr",Be="LogSoftmax",qe="LRN",Ve="LRNGrad",We="Max",je="Maximum",Ue="MaxPool",Ge="MaxPoolGrad",He="MaxPool3D",Ke="MaxPool3DGrad",Xe="MaxPoolWithArgmax",Qe="Mean",Ye="Min",Ze="Minimum",Je="MirrorPad",tn="Mod",en="Multinomial",nn="Multiply",sn="Neg",rn="NotEqual",on="NonMaxSuppressionV3",an="NonMaxSuppressionV4",un="NonMaxSuppressionV5",cn="OnesLike",ln="OneHot",hn="Pack",pn="PadV2",dn="Pow",fn="Prelu",mn="Prod",gn="Range",yn="Real",bn="Reciprocal",vn="Relu",wn="Reshape",xn="ResizeNearestNeighbor",_n="ResizeNearestNeighborGrad",kn="ResizeBilinear",Sn="ResizeBilinearGrad",Tn="Relu6",In="Reverse",Cn="Round",An="Rsqrt",Nn="ScatterNd",En="Select",On="Selu",$n="Slice",Rn="Sin",Dn="Sinh",Mn="Sign",Pn="Sigmoid",Fn="Softplus",Ln="Sqrt",zn="Sum",Bn="SpaceToBatchND",qn="SplitV",Vn="Softmax",Wn="SquaredDifference",jn="Square",Un="Sub",Gn="SparseToDense",Hn="StridedSlice",Kn="Tan",Xn="Tanh",Qn="Tile",Yn="TopK",Zn="Transpose",Jn="Unique",ts="Unpack",es="UnsortedSegmentSum",ns="ZerosLike",ss="Step",is="FromPixels",rs="RotateWithOffset",os="_FusedMatMul",as="FusedConv2D",us="FusedDepthwiseConv2D",cs=dt("kernelRegistry",(()=>new Map)),ls=dt("gradRegistry",(()=>new Map));function hs(t,e){const n=gs(t,e);return cs.get(n)}function ps(t){return ls.get(t)}function ds(t){const e=cs.entries(),n=[];while(1){const{done:s,value:i}=e.next();if(s)break;const[r,o]=i,[a]=r.split("_");a===t&&n.push(o)}return n}function fs(t){const{kernelName:e,backendName:n}=t,s=gs(e,n);cs.has(s)&&console.warn(`The kernel '${e}' for backend '${n}' is already registered`),cs.set(s,t)}function ms(t){const{kernelName:e}=t;ls.has(e)&&at().getBool("DEBUG")&&console.warn(`Overriding the gradient for '${e}'`),ls.set(e,t)}function gs(t,e){return`${e}_${t}`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ys{constructor(t,e){this.backendTimer=t,this.logger=e,null==e&&(this.logger=new vs)}profileKernel(t,e,n){let s;const i=()=>{s=n()},r=this.backendTimer.time(i);if(at().getBool("CHECK_COMPUTATION_FOR_ERRORS"))for(let a=0;a<s.length;a++){const e=s[a];e.data().then((n=>{bs(n,e.dtype,t)}))}const o={kernelName:t,outputs:s,inputs:e,timeMs:r.then((t=>t.kernelMs)),extraInfo:r.then((t=>null!=t.getExtraProfileInfo?t.getExtraProfileInfo():""))};return o}logKernelProfile(t){const{kernelName:e,outputs:n,timeMs:s,inputs:i,extraInfo:r}=t;n.forEach((t=>{Promise.all([t.data(),s,r]).then((n=>{this.logger.logKernelProfile(e,t,n[0],n[1],i,n[2])}))}))}}function bs(t,e,n){if("float32"!==e)return!1;for(let s=0;s<t.length;s++){const e=t[s];if(isNaN(e)||!isFinite(e))return console.warn(`Found ${e} in the result of '${n}'`),!0}return!1}class vs{logKernelProfile(t,e,n,s,i,r){const o="number"===typeof s?C(`${s}ms`,9):s["error"],a=C(t,25),u=e.rank,c=e.size,l=C(e.shape.toString(),14);let h="";for(const p in i){const t=i[p];if(null!=t){const n=t.shape||e.shape,s=n.length;h+=`${p}: ${s}D ${s>0?n:""} `}}console.log(`%c${a}\t%c${o}\t%c${u}D ${l}\t%c${c}\t%c${h}\t%c${r}`,"font-weight:bold","color:red","color:blue","color: orange","color: green","color: steelblue")}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ws(t,e,n){const s={},i={};for(let u=0;u<e.length;u++)s[e[u].id]=!0;for(let u=0;u<t.length;u++){const n=t[u],r=n.inputs;for(const t in r){const o=r[t];let a=!1;for(let t=0;t<e.length;t++)if(s[o.id]){n.outputs.forEach((t=>s[t.id]=!0)),a=!0,i[n.id]=!0;break}if(a)break}}const r={};r[n.id]=!0;const o={};for(let u=t.length-1;u>=0;u--){const e=t[u],n=e.inputs;for(let t=0;t<e.outputs.length;t++)if(r[e.outputs[t].id]){for(const t in n)r[n[t].id]=!0,o[e.id]=!0;break}}const a=[];for(let u=0;u<t.length;u++){const e=t[u];if(i[e.id]&&o[e.id]){const t={};for(const i in e.inputs){const n=e.inputs[i];s[n.id]&&(t[i]=n)}const n=Object.assign({},e);n.inputs=t,n.outputs=e.outputs,a.push(n)}}return a}function xs(t,e,n,s){for(let i=e.length-1;i>=0;i--){const r=e[i],o=[];if(r.outputs.forEach((e=>{const n=t[e.id];null!=n?o.push(n):o.push(null)})),null==r.gradient)throw new Error(`Cannot compute gradient: gradient function not found for ${r.kernelName}.`);const a=r.gradient(o);for(const e in r.inputs){if(!(e in a))throw new Error(`Cannot backprop through input ${e}. Available gradients found: ${Object.keys(a)}.`);const i=n((()=>a[e]()));if("float32"!==i.dtype)throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input ${e} must have 'float32' dtype, but has '${i.dtype}'`);const o=r.inputs[e];if(!S(i.shape,o.shape))throw new Error(`Error in gradient for op ${r.kernelName}. The gradient of input '${e}' has shape '${i.shape}', which does not match the shape of the input '${o.shape}'`);if(null==t[o.id])t[o.id]=i;else{const e=t[o.id];t[o.id]=s(e,i),e.dispose()}}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const _s=20,ks=3,Ss=7;function Ts(t,e,n,s){const i=G(e),r=Is(t,e,n,i),o=e.length,a=Ns(t,e,n,i,r),u=["Tensor"];return s&&(u.push(`  dtype: ${n}`),u.push(`  rank: ${o}`),u.push(`  shape: [${e}]`),u.push("  values:")),u.push(a.map((t=>"    "+t)).join("\n")),u.join("\n")}function Is(t,e,n,s){const i=k(e),r=s[s.length-1],o=new Array(r).fill(0),a=e.length,u="complex64"===n?Es(t):t;if(a>1)for(let c=0;c<i/r;c++){const t=c*r;for(let e=0;e<r;e++)o[e]=Math.max(o[e],Cs(u[t+e],0,n).length)}return o}function Cs(t,e,n){let s;return s=Array.isArray(t)?`${parseFloat(t[0].toFixed(Ss))} + ${parseFloat(t[1].toFixed(Ss))}j`:B(t)?`'${t}'`:"bool"===n?As(t):parseFloat(t.toFixed(Ss)).toString(),C(s,e)}function As(t){return 0===t?"false":"true"}function Ns(t,e,n,s,i,r=!0){const o="complex64"===n?2:1,a=e[0],u=e.length;if(0===u){if("complex64"===n){const e=Es(t);return[Cs(e[0],0,n)]}return"bool"===n?[As(t[0])]:[t[0].toString()]}if(1===u){if(a>_s){const e=ks*o;let s=Array.from(t.slice(0,e)),r=Array.from(t.slice((a-ks)*o,a*o));return"complex64"===n&&(s=Es(s),r=Es(r)),["["+s.map(((t,e)=>Cs(t,i[e],n))).join(", ")+", ..., "+r.map(((t,e)=>Cs(t,i[a-ks+e],n))).join(", ")+"]"]}const e="complex64"===n?Es(t):Array.from(t);return["["+e.map(((t,e)=>Cs(t,i[e],n))).join(", ")+"]"]}const c=e.slice(1),l=s.slice(1),h=s[0]*o,p=[];if(a>_s){for(let e=0;e<ks;e++){const s=e*h,r=s+h;p.push(...Ns(t.slice(s,r),c,n,l,i,!1))}p.push("...");for(let e=a-ks;e<a;e++){const s=e*h,r=s+h;p.push(...Ns(t.slice(s,r),c,n,l,i,e===a-1))}}else for(let m=0;m<a;m++){const e=m*h,s=e+h;p.push(...Ns(t.slice(e,s),c,n,l,i,m===a-1))}const d=2===u?",":"";p[0]="["+p[0]+d;for(let m=1;m<p.length-1;m++)p[m]=" "+p[m]+d;let f=",\n";for(let m=2;m<u;m++)f+="\n";return p[p.length-1]=" "+p[p.length-1]+"]"+(r?"":f),p}function Es(t){const e=[];for(let n=0;n<t.length;n+=2)e.push([t[n],t[n+1]]);return e}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Os(t,e){return"string"===e?Ms(t):Rs([t],e)}function $s(t,e){return t instanceof Float32Array&&"float32"===e||t instanceof Int32Array&&"int32"===e||t instanceof Uint8Array&&"bool"===e}function Rs(t,e){if("string"===e)throw new Error("Cannot convert a string[] to a TypedArray");if(Array.isArray(t)&&(t=_(t)),at().getBool("DEBUG")&&D(t,e),$s(t,e))return t;if(null==e||"float32"===e||"complex64"===e)return new Float32Array(t);if("int32"===e)return new Int32Array(t);if("bool"===e){const e=new Uint8Array(t.length);for(let n=0;n<e.length;++n)0!==Math.round(t[n])&&(e[n]=1);return e}throw new Error(`Unknown data type ${e}`)}function Ds(){return at().platform.now()}function Ms(t,e="utf-8"){return e=e||"utf-8",at().platform.encode(t,e)}function Ps(t,e="utf-8"){return e=e||"utf-8",at().platform.decode(t,e)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Fs{constructor(t,e,n){if(this.dtype=e,this.shape=t.slice(),this.size=k(t),null!=n){const t=n.length;v(t===this.size,(()=>`Length of values '${t}' does not match the size inferred by the shape '${this.size}'.`))}if("complex64"===e)throw new Error("complex64 dtype TensorBuffers are not supported. Please create a TensorBuffer for the real and imaginary parts separately and call tf.complex(real, imag).");this.values=n||R(e,this.size),this.strides=G(t)}set(t,...e){0===e.length&&(e=[0]),v(e.length===this.rank,(()=>`The number of provided coordinates (${e.length}) must match the rank (${this.rank})`));const n=this.locToIndex(e);this.values[n]=t}get(...t){0===t.length&&(t=[0]);let e=0;for(const s of t){if(s<0||s>=this.shape[e]){const e=`Requested out of range element at ${t}.   Buffer shape=${this.shape}`;throw new Error(e)}e++}let n=t[t.length-1];for(let s=0;s<t.length-1;++s)n+=this.strides[s]*t[s];return this.values[n]}locToIndex(t){if(0===this.rank)return 0;if(1===this.rank)return t[0];let e=t[t.length-1];for(let n=0;n<t.length-1;++n)e+=this.strides[n]*t[n];return e}indexToLoc(t){if(0===this.rank)return[];if(1===this.rank)return[t];const e=new Array(this.shape.length);for(let n=0;n<e.length-1;++n)e[n]=Math.floor(t/this.strides[n]),t-=e[n]*this.strides[n];return e[e.length-1]=t,e}get rank(){return this.shape.length}toTensor(){return Ls().makeTensor(this.values,this.shape,this.dtype)}}let Ls=null,zs=null,Bs=null;function qs(t){Ls=t}function Vs(t){zs=t}function Ws(t){Bs=t}class js{constructor(t,e,n,s){this.kept=!1,this.isDisposedInternal=!1,this.shape=t.slice(),this.dtype=e||"float32",this.size=k(t),this.strides=G(t),this.dataId=n,this.id=s,this.rankType=this.rank<5?this.rank.toString():"higher"}get rank(){return this.shape.length}async buffer(){const t=await this.data();return zs.buffer(this.shape,this.dtype,t)}bufferSync(){return zs.buffer(this.shape,this.dtype,this.dataSync())}async array(){const t=await this.data();return K(this.shape,t)}arraySync(){return K(this.shape,this.dataSync())}async data(){this.throwIfDisposed();const t=Ls().read(this.dataId);if("string"===this.dtype){const n=await t;try{return n.map((t=>Ps(t)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}}return t}dataSync(){this.throwIfDisposed();const t=Ls().readSync(this.dataId);if("string"===this.dtype)try{return t.map((t=>Ps(t)))}catch(e){throw new Error("Failed to decode the string bytes into utf-8. To get the original bytes, call tensor.bytes().")}return t}async bytes(){this.throwIfDisposed();const t=await Ls().read(this.dataId);return"string"===this.dtype?t:new Uint8Array(t.buffer)}dispose(){this.isDisposed||(Ls().disposeTensor(this),this.isDisposedInternal=!0)}get isDisposed(){return this.isDisposedInternal}throwIfDisposed(){if(this.isDisposed)throw new Error("Tensor is disposed.")}print(t=!1){return zs.print(this,t)}clone(){return this.throwIfDisposed(),zs.clone(this)}toString(t=!1){const e=this.dataSync();return Ts(e,this.shape,this.dtype,t)}cast(t){return this.throwIfDisposed(),zs.cast(this,t)}variable(t=!0,e,n){return this.throwIfDisposed(),Ls().makeVariable(this,t,e,n)}}Object.defineProperty(js,Symbol.hasInstance,{value:t=>!!t&&null!=t.data&&null!=t.dataSync&&null!=t.throwIfDisposed});class Us extends js{constructor(t,e,n,s){super(t.shape,t.dtype,t.dataId,s),this.trainable=e,this.name=n}assign(t){if(t.dtype!==this.dtype)throw new Error(`dtype of the new value (${t.dtype}) and previous value (${this.dtype}) must match`);if(!S(t.shape,this.shape))throw new Error(`shape of the new value (${t.shape}) and previous value (${this.shape}) must match`);Ls().disposeTensor(this),this.dataId=t.dataId,Ls().incRef(this,null)}dispose(){Ls().disposeVariable(this),this.isDisposedInternal=!0}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Gs,Hs,Ks,Xs,Qs;Object.defineProperty(Us,Symbol.hasInstance,{value:t=>t instanceof js&&null!=t.assign&&t.assign instanceof Function}),function(t){t["R0"]="R0",t["R1"]="R1",t["R2"]="R2",t["R3"]="R3",t["R4"]="R4",t["R5"]="R5",t["R6"]="R6"}(Gs||(Gs={})),function(t){t["float32"]="float32",t["int32"]="int32",t["bool"]="int32",t["complex64"]="complex64"}(Hs||(Hs={})),function(t){t["float32"]="float32",t["int32"]="int32",t["bool"]="bool",t["complex64"]="complex64"}(Ks||(Ks={})),function(t){t["float32"]="float32",t["int32"]="float32",t["bool"]="float32",t["complex64"]="complex64"}(Xs||(Xs={})),function(t){t["float32"]="complex64",t["int32"]="complex64",t["bool"]="complex64",t["complex64"]="complex64"}(Qs||(Qs={}));const Ys={float32:Xs,int32:Hs,bool:Ks,complex64:Qs};function Zs(t,e){if("string"===t||"string"===e){if("string"===t&&"string"===e)return"string";throw new Error(`Can not upcast ${t} with ${e}`)}return Ys[t][e]}function Js(t){return Zs(t,"int32")}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ti(t,e){if(t.dtype===e.dtype)return[t,e];const n=Zs(t.dtype,e.dtype);return[t.cast(n),e.cast(n)]}function ei(t,e){return e.some((e=>e.id===t.id))}function ni(t){const e=[],n=new Set;return si(t,e,n),e}function si(t,e,n){if(null==t)return;if(t instanceof js)return void e.push(t);if(!ii(t))return;const s=t;for(const i in s){const t=s[i];n.has(t)||(n.add(t),si(t,e,n))}}function ii(t){return Array.isArray(t)||"object"===typeof t}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ri{constructor(){this.registeredVariables={},this.nextTapeNodeId=0,this.numBytes=0,this.numTensors=0,this.numStringTensors=0,this.numDataBuffers=0,this.gradientDepth=0,this.kernelDepth=0,this.scopeStack=[],this.numDataMovesStack=[],this.nextScopeId=0,this.tensorInfo=new WeakMap,this.profiling=!1,this.activeProfile={newBytes:0,newTensors:0,peakBytes:0,kernels:[],result:null,get kernelNames(){return Array.from(new Set(this.kernels.map((t=>t.name))))}}}dispose(){for(const t in this.registeredVariables)this.registeredVariables[t].dispose()}}class oi{constructor(t){this.ENV=t,this.registry={},this.registryFactory={},this.pendingBackendInitId=0,this.state=new ri}async ready(){if(null!=this.pendingBackendInit)return this.pendingBackendInit.then((()=>{}));if(null!=this.backendInstance)return;const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],s=await this.initializeBackend(n).success;if(s)return void await this.setBackend(n)}throw new Error("Could not initialize any backends, all backend initializations failed.")}get backend(){if(null!=this.pendingBackendInit)throw new Error(`Backend '${this.backendName}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);if(null==this.backendInstance){const{name:t,asyncInit:e}=this.initializeBackendsAndReturnBest();if(e)throw new Error(`The highest priority backend '${t}' has not yet been initialized. Make sure to await tf.ready() or await tf.setBackend() before calling other methods`);this.setBackend(t)}return this.backendInstance}backendNames(){return Object.keys(this.registryFactory)}findBackend(t){if(!(t in this.registry)){if(!(t in this.registryFactory))return null;{const{asyncInit:e}=this.initializeBackend(t);if(e)return null}}return this.registry[t]}findBackendFactory(t){return t in this.registryFactory?this.registryFactory[t].factory:null}registerBackend(t,e,n=1){return t in this.registryFactory?(console.warn(`${t} backend was already registered. Reusing existing backend factory.`),!1):(this.registryFactory[t]={factory:e,priority:n},!0)}async setBackend(t){if(null==this.registryFactory[t])throw new Error(`Backend name '${t}' not found in registry`);if(this.backendName=t,null==this.registry[t]){this.backendInstance=null;const{success:e,asyncInit:n}=this.initializeBackend(t),s=n?await e:e;if(!s)return!1}return this.backendInstance=this.registry[t],this.setupRegisteredKernels(),this.profiler=new ys(this.backendInstance),!0}setupRegisteredKernels(){const t=ds(this.backendName);t.forEach((t=>{null!=t.setupFunc&&t.setupFunc(this.backendInstance)}))}disposeRegisteredKernels(t){const e=ds(t);e.forEach((e=>{null!=e.disposeFunc&&e.disposeFunc(this.registry[t])}))}initializeBackend(t){const e=this.registryFactory[t];if(null==e)throw new Error(`Cannot initialize backend ${t}, no registration found.`);try{const n=e.factory();if(!n||n instanceof d||"function"!==typeof n.then)return this.registry[t]=n,{success:!0,asyncInit:!1};{const e=++this.pendingBackendInitId,s=n.then((n=>!(e<this.pendingBackendInitId)&&(this.registry[t]=n,this.pendingBackendInit=null,!0))).catch((n=>(e<this.pendingBackendInitId||(this.pendingBackendInit=null,console.warn(`Initialization of backend ${t} failed`),console.warn(n.stack||n.message)),!1)));return this.pendingBackendInit=s,{success:s,asyncInit:!0}}}catch(n){return console.warn(`Initialization of backend ${t} failed`),console.warn(n.stack||n.message),{success:!1,asyncInit:!1}}}removeBackend(t){if(!(t in this.registryFactory))throw new Error(`${t} backend not found in registry`);this.backendName===t&&null!=this.pendingBackendInit&&this.pendingBackendInitId++,t in this.registry&&(this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t]),delete this.registryFactory[t],this.backendName===t&&(this.pendingBackendInit=null,this.backendName=null,this.backendInstance=null)}getSortedBackends(){if(0===Object.keys(this.registryFactory).length)throw new Error("No backend found in registry.");return Object.keys(this.registryFactory).sort(((t,e)=>this.registryFactory[e].priority-this.registryFactory[t].priority))}initializeBackendsAndReturnBest(){const t=this.getSortedBackends();for(let e=0;e<t.length;e++){const n=t[e],{success:s,asyncInit:i}=this.initializeBackend(n);if(i||s)return{name:n,asyncInit:i}}throw new Error("Could not initialize any backends, all backend initializations failed.")}moveData(t,e){const n=this.state.tensorInfo.get(e),s=n.backend,i=this.readSync(e);s.disposeData(e),n.backend=t,t.move(e,i,n.shape,n.dtype),this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack[this.state.numDataMovesStack.length-1]++}tidy(t,e){let n,s=null;if(null==e){if("function"!==typeof t)throw new Error("Please provide a function to tidy()");e=t}else{if("string"!==typeof t&&!(t instanceof String))throw new Error("When calling with two arguments, the first argument to tidy() must be a string");if("function"!==typeof e)throw new Error("When calling with two arguments, the 2nd argument to tidy() must be a function");s=t}return this.scopedRun((()=>this.startScope(s)),(()=>this.endScope(n)),(()=>(n=e(),n instanceof Promise&&console.error("Cannot return a Promise inside of tidy."),n)))}scopedRun(t,e,n){t();try{const t=n();return e(),t}catch(s){throw e(),s}}nextTensorId(){return oi.nextTensorId++}nextVariableId(){return oi.nextVariableId++}clone(t){const e=this.makeTensorFromDataId(t.dataId,t.shape,t.dtype),n={x:t},s=t=>({x:()=>{const e="float32",n={x:t},s={dtype:e};return ci.runKernelFunc((n=>n.cast(t,e)),n,null,Pt,s)}}),i=[];return this.addTapeNode(this.state.activeScope.name,n,[e],s,i,{}),e}runKernel(t,e,n,s,i){const r=null,o=null;return this.runKernelFunc(r,e,o,t,n,s,i)}shouldCheckForMemLeaks(){return this.ENV.getBool("IS_TEST")}checkKernelForMemLeak(t,e,n){const s=this.backend.numDataIds();let i=0;n.forEach((t=>{i+="complex64"===t.dtype?3:1}));const r=this.state.numDataMovesStack[this.state.numDataMovesStack.length-1],o=s-e-i-r;if(o>0)throw new Error(`Backend '${this.backendName}' has an internal memory leak (${o} data ids) after running '${t}'`)}runKernelFunc(t,e,n,s,i,r,o){let a,u=[];const c=this.isTapeOn();null==s&&(s=null!=this.state.activeScope?this.state.activeScope.name:"");const l=this.state.numBytes,h=this.state.numTensors;let p;this.shouldCheckForMemLeaks()&&this.state.numDataMovesStack.push(0),null==this.backendName&&this.backend;const d=hs(s,this.backendName);let f,m;if(null!=d)p=()=>{const t=this.backend.numDataIds();f=d.kernelFunc({inputs:e,attrs:i,backend:this.backend});const n=Array.isArray(f)?f:[f];this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(s,t,n);const a=n.map((t=>{if(null!=t.rank)return t;const{dataId:e,shape:n,dtype:s}=t;return this.makeTensorFromDataId(e,n,s)}));if(c){let t=this.getTensorsForGradient(s,e,a);if(null==t){null==o&&(o=[]);const e=a.filter(((t,e)=>o[e]));t=(r||[]).slice().concat(e)}u=this.saveTensorsForBackwardMode(t)}return a};else{if(null==t)throw new Error(`Error running ${s}: Neither modular kernel nor forward func passed`);const e=t=>{c&&(u=t.map((t=>this.keep(this.clone(t)))))};p=()=>{const n=this.backend.numDataIds();f=this.tidy((()=>t(this.backend,e)));const i=Array.isArray(f)?f:[f];return this.shouldCheckForMemLeaks()&&this.checkKernelForMemLeak(s,n,i),i}}return this.scopedRun((()=>this.state.kernelDepth++),(()=>this.state.kernelDepth--),(()=>{this.ENV.getBool("DEBUG")||this.state.profiling?(m=this.profiler.profileKernel(s,e,(()=>p())),this.ENV.getBool("DEBUG")&&this.profiler.logKernelProfile(m),a=m.outputs):a=p()})),c&&this.addTapeNode(s,e,a,n,u,i),this.state.profiling&&this.state.activeProfile.kernels.push({name:s,bytesAdded:this.state.numBytes-l,totalBytesSnapshot:this.state.numBytes,tensorsAdded:this.state.numTensors-h,totalTensorsSnapshot:this.state.numTensors,inputShapes:Object.keys(e).map((t=>null!=e[t]?e[t].shape:null)),outputShapes:a.map((t=>t.shape)),kernelTimeMs:m.timeMs,extraInfo:m.extraInfo}),Array.isArray(f)?a:a[0]}saveTensorsForBackwardMode(t){const e=t.map((t=>this.keep(this.clone(t))));return e}getTensorsForGradient(t,e,n){const s=ps(t);if(null!=s){const t=s.inputsToSave||[],i=s.outputsToSave||[];let r;s.saveAllInputs?(v(Array.isArray(e),(()=>"saveAllInputs is true, expected inputs to be an array.")),r=Object.keys(e).map((t=>e[t]))):r=t.map((t=>e[t]));const o=n.filter(((t,e)=>i[e]));return r.concat(o)}return null}makeTensor(t,e,n,s){if(null==t)throw new Error("Values passed to engine.makeTensor() are null");n=n||"float32",s=s||this.backend;let i=t;"string"===n&&B(t[0])&&(i=t.map((t=>Ms(t))));const r=s.write(i,e,n),o=new js(e,n,r,this.nextTensorId());if(this.incRef(o,s),"string"===n){const t=this.state.tensorInfo.get(r),e=z(i);this.state.numBytes+=e-t.bytes,t.bytes=e}return o}makeTensorFromDataId(t,e,n,s){n=n||"float32";const i=new js(e,n,t,this.nextTensorId());return this.incRef(i,s),i}makeVariable(t,e=!0,n,s){n=n||this.nextVariableId().toString(),null!=s&&s!==t.dtype&&(t=t.cast(s));const i=new Us(t,e,n,this.nextTensorId());if(null!=this.state.registeredVariables[i.name])throw new Error(`Variable with name ${i.name} was already registered`);return this.state.registeredVariables[i.name]=i,this.incRef(i,this.backend),i}incRef(t,e){const n=this.state.tensorInfo.has(t.dataId)?this.state.tensorInfo.get(t.dataId).refCount:0;if(this.state.numTensors++,"string"===t.dtype&&this.state.numStringTensors++,0===n){this.state.numDataBuffers++;let n=0;"complex64"!==t.dtype&&"string"!==t.dtype&&(n=t.size*L(t.dtype)),this.state.tensorInfo.set(t.dataId,{backend:e||this.backend,dtype:t.dtype,shape:t.shape,bytes:n,refCount:0}),this.state.numBytes+=n}this.state.tensorInfo.get(t.dataId).refCount++,t instanceof Us||this.track(t)}disposeTensor(t){if(!this.state.tensorInfo.has(t.dataId))return;this.state.numTensors--,"string"===t.dtype&&this.state.numStringTensors--;const e=this.state.tensorInfo.get(t.dataId),n=e.refCount;n<=1?("complex64"!==t.dtype&&(this.state.numBytes-=e.bytes),this.state.numDataBuffers--,e.backend.disposeData(t.dataId),this.state.tensorInfo.delete(t.dataId)):(e.backend.decComplexRef(t.dataId),this.state.tensorInfo.get(t.dataId).refCount--)}disposeVariables(){for(const t in this.state.registeredVariables){const e=this.state.registeredVariables[t];this.disposeVariable(e)}}disposeVariable(t){this.disposeTensor(t),null!=this.state.registeredVariables[t.name]&&delete this.state.registeredVariables[t.name]}memory(){const t=this.backend.memory();return t.numTensors=this.state.numTensors,t.numDataBuffers=this.state.numDataBuffers,t.numBytes=this.state.numBytes,this.state.numStringTensors>0&&(t.unreliable=!0,null==t.reasons&&(t.reasons=[]),t.reasons.push("Memory usage by string tensors is approximate (2 bytes per character)")),t}async profile(t){this.state.profiling=!0;const e=this.state.numBytes,n=this.state.numTensors;this.state.activeProfile.kernels=[],this.state.activeProfile.result=await t(),this.state.profiling=!1,this.state.activeProfile.peakBytes=Math.max(...this.state.activeProfile.kernels.map((t=>t.totalBytesSnapshot))),this.state.activeProfile.newBytes=this.state.numBytes-e,this.state.activeProfile.newTensors=this.state.numTensors-n;for(const s of this.state.activeProfile.kernels)s.kernelTimeMs=await s.kernelTimeMs,s.extraInfo=await s.extraInfo;return this.state.activeProfile}isTapeOn(){return this.state.gradientDepth>0&&0===this.state.kernelDepth}addTapeNode(t,e,n,s,i,r){const o={id:this.state.nextTapeNodeId++,kernelName:t,inputs:e,outputs:n,saved:i},a=ps(t);null!=a&&(s=a.gradFunc),null!=s&&(o.gradient=t=>(t=t.map(((t,e)=>{if(null==t){const t=n[e],s=Q(t.size,t.dtype);return this.makeTensor(s,t.shape,t.dtype)}return t})),s(t.length>1?t:t[0],i,r))),this.state.activeTape.push(o)}keep(t){return t.kept=!0,t}startTape(){0===this.state.gradientDepth&&(this.state.activeTape=[]),this.state.gradientDepth++}endTape(){this.state.gradientDepth--}startScope(t){const e={track:[],name:"unnamed scope",id:this.state.nextScopeId++};t&&(e.name=t),this.state.scopeStack.push(e),this.state.activeScope=e}endScope(t){const e=ni(t),n=new Set(e.map((t=>t.id)));for(let i=0;i<this.state.activeScope.track.length;i++){const t=this.state.activeScope.track[i];t.kept||n.has(t.id)||t.dispose()}const s=this.state.scopeStack.pop();this.state.activeScope=0===this.state.scopeStack.length?null:this.state.scopeStack[this.state.scopeStack.length-1],e.forEach((t=>{t.kept||t.scopeId!==s.id||this.track(t)}))}gradients(t,e,n,s=!1){if(v(e.length>0,(()=>"gradients() received an empty list of xs.")),null!=n&&"float32"!==n.dtype)throw new Error(`dy must have 'float32' dtype, but has '${n.dtype}'`);const i=this.scopedRun((()=>this.startTape()),(()=>this.endTape()),(()=>this.tidy("forward",t)));v(i instanceof js,(()=>"The result y returned by f() must be a tensor."));const r=ws(this.state.activeTape,e,i);if(!s&&0===r.length&&e.length>0)throw new Error("Cannot compute gradient of y=f(x) with respect to x. Make sure that the f you passed encloses all operations that lead from x to y.");return this.tidy("backward",(()=>{const t={};t[i.id]=null==n?ai(i.shape):n,xs(t,r,(t=>this.tidy(t)),li);const s=e.map((e=>t[e.id]));return 0===this.state.gradientDepth&&(this.state.activeTape.forEach((t=>{for(const e of t.saved)e.dispose()})),this.state.activeTape=null),{value:i,grads:s}}))}customGrad(t){return v(j(t),(()=>"The f passed in customGrad(f) must be a function.")),(...e)=>{let n;v(e.every((t=>t instanceof js)),(()=>"The args passed in customGrad(f)(x1, x2,...) must all be tensors"));const s={};return e.forEach(((t,e)=>{s[e]=t})),this.runKernelFunc(((s,i)=>(n=t(...e,i),v(n.value instanceof js,(()=>"The function f passed in customGrad(f) must return an object where `obj.value` is a tensor")),v(j(n.gradFunc),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function.")),n.value)),s,((t,s)=>{const i=n.gradFunc(t,s),r=Array.isArray(i)?i:[i];v(r.length===e.length,(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns the same number of tensors as inputs passed to f(...).")),v(r.every((t=>t instanceof js)),(()=>"The function f passed in customGrad(f) must return an object where `obj.gradFunc` is a function that returns a list of only tensors."));const o={};return r.forEach(((t,e)=>{o[e]=()=>t})),o}))}}readSync(t){const e=this.state.tensorInfo.get(t);return e.backend.readSync(t)}read(t){const e=this.state.tensorInfo.get(t);return e.backend.read(t)}async time(t){const e=Ds(),n=await this.backend.time(t);return n.wallMs=Ds()-e,n}track(t){return null!=this.state.activeScope&&(t.scopeId=this.state.activeScope.id,this.state.activeScope.track.push(t)),t}get registeredVariables(){return this.state.registeredVariables}reset(){this.pendingBackendInitId++,this.state.dispose(),this.ENV.reset(),this.state=new ri;for(const t in this.registry)this.disposeRegisteredKernels(t),this.registry[t].dispose(),delete this.registry[t];this.backendName=null,this.backendInstance=null,this.pendingBackendInit=null}}function ai(t){const e=X(k(t),"float32");return ci.makeTensor(e,t,"float32")}function ui(){const t=ht();if(null==t._tfengine){const e=new st(t);t._tfengine=new oi(e)}return lt(t._tfengine.ENV),qs((()=>t._tfengine)),t._tfengine}oi.nextTensorId=0,oi.nextVariableId=0;const ci=ui();function li(t,e){const n={a:t,b:e};return ci.runKernel(yt,n)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hi(){return"undefined"!==typeof navigator&&null!=navigator}function pi(){if(hi()){const t=navigator.userAgent||navigator.vendor||window.opera;return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(t)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(t.substr(0,4))}return!1}function di(){return"undefined"!==typeof window&&null!=window.document||"undefined"!==typeof WorkerGlobalScope}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const fi=at();fi.registerFlag("DEBUG",(()=>!1),(t=>{t&&console.warn("Debugging mode is ON. The output of every math call will be downloaded to CPU and checked for NaNs. This significantly impacts performance.")})),fi.registerFlag("IS_BROWSER",(()=>di())),fi.registerFlag("IS_NODE",(()=>"undefined"!==typeof process&&"undefined"!==typeof process.versions&&"undefined"!==typeof process.versions.node)),fi.registerFlag("IS_CHROME",(()=>"undefined"!==typeof navigator&&null!=navigator&&null!=navigator.userAgent&&/Chrome/.test(navigator.userAgent)&&/Google Inc/.test(navigator.vendor))),fi.registerFlag("PROD",(()=>!1)),fi.registerFlag("TENSORLIKE_CHECK_SHAPE_CONSISTENCY",(()=>fi.getBool("DEBUG"))),fi.registerFlag("DEPRECATION_WARNINGS_ENABLED",(()=>!0)),fi.registerFlag("IS_TEST",(()=>!1)),fi.registerFlag("CHECK_COMPUTATION_FOR_ERRORS",(()=>!0));n(4979);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mi(t,e){let n=t;if(F(t))return"string"===e?[]:[t.length];if(!Array.isArray(t))return[];const s=[];while(Array.isArray(n)||F(n)&&"string"!==e)s.push(n.length),n=n[0];return Array.isArray(t)&&at().getBool("TENSORLIKE_CHECK_SHAPE_CONSISTENCY")&&gi(t,s,[]),s}function gi(t,e,n){if(n=n||[],!Array.isArray(t)&&!F(t))return void v(0===e.length,(()=>`Element arr[${n.join("][")}] is a primitive, but should be an array/TypedArray of ${e[0]} elements`));v(e.length>0,(()=>`Element arr[${n.join("][")}] should be a primitive, but is an array of ${t.length} elements`)),v(t.length===e[0],(()=>`Element arr[${n.join("][")}] should have ${e[0]} elements, but has ${t.length} elements`));const s=e.slice(1);for(let i=0;i<t.length;++i)gi(t[i],s,n.concat(i))}function yi(t,e,n,s){if("string_or_numeric"!==t){if(null==t)throw new Error("Expected dtype cannot be null.");if("numeric"!==t&&t!==e||"numeric"===t&&"string"===e)throw new Error(`Argument '${n}' passed to '${s}' must be ${t} tensor, but got ${e} tensor`)}}function bi(t,e,n,s="numeric"){if(t instanceof js)return yi(s,t.dtype,e,n),t;let i=W(t);if("string"!==i&&["bool","int32","float32"].indexOf(s)>=0&&(i=s),yi(s,i,e,n),null==t||!F(t)&&!Array.isArray(t)&&"number"!==typeof t&&"boolean"!==typeof t&&"string"!==typeof t){const s=null==t?"null":t.constructor.name;throw new Error(`Argument '${e}' passed to '${n}' must be a Tensor or TensorLike, but got '${s}'`)}const r=mi(t,i);F(t)||Array.isArray(t)||(t=[t]);const o=!0,a="string"!==i?Rs(t,i):_(t,[],o);return ci.makeTensor(a,r,i)}function vi(t,e,n,s="numeric"){if(!Array.isArray(t))throw new Error(`Argument ${e} passed to ${n} must be a \`Tensor[]\` or \`TensorLike[]\``);const i=t;return i.map(((t,i)=>bi(t,`${e}[${i}]`,n,s)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const wi="__op";function xi(t){const e=Object.keys(t);if(1!==e.length)throw new Error(`Please provide an object with a single key (operation name) mapping to a function. Got an object with ${e.length} keys.`);let n=e[0];const s=t[n];n.endsWith("_")&&(n=n.substring(0,n.length-1)),n+=wi;const i=(...t)=>{ci.startScope(n);try{const e=s(...t);return et(e)&&console.error("Cannot return a Promise inside of tidy."),ci.endScope(e),e}catch(e){throw ci.endScope(null),e}};return Object.defineProperty(i,"name",{value:n,configurable:!0}),i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _i(t,e){const n=bi(t,"real","complex"),s=bi(e,"imag","complex");w(n.shape,s.shape,`real and imag shapes, ${n.shape} and ${s.shape}, must match in call to tf.complex().`);const i={real:n,imag:s};return ci.runKernel(zt,i)}const ki=xi({complex_:_i});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Si(t,e,n,s){if(null==s&&(s=W(t)),"complex64"===s)throw new Error("Cannot construct a complex64 tensor directly. Please use tf.complex(real, imag).");if(!F(t)&&!Array.isArray(t)&&"number"!==typeof t&&"boolean"!==typeof t&&"string"!==typeof t)throw new Error("values passed to tensor(values) must be a number/boolean/string or an array of numbers/booleans/strings, or a TypedArray");if(null!=e){Z(e);const t=k(e),s=k(n);v(t===s,(()=>`Based on the provided shape, [${e}], the tensor should have ${t} values but has ${s}`));for(let i=0;i<n.length;++i){const t=n[i],s=i!==n.length-1||t!==k(e.slice(i));v(n[i]===e[i]||!s,(()=>`Error creating a new Tensor. Inferred shape (${n}) does not match the provided shape (${e}). `))}}return F(t)||Array.isArray(t)||(t=[t]),e=e||n,t="string"!==s?Rs(t,s):_(t,[],!0),ci.makeTensor(t,e,s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ti(t,e,n){const s=mi(t,n);return Si(t,e,s,n)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Ii=4;async function Ci(t,e){const n=[],s=[],i=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);for(let o=0;o<i.length;++o){const r=i[o],a=Array.isArray(t)?t[o].tensor:t[r];if("float32"!==a.dtype&&"int32"!==a.dtype&&"bool"!==a.dtype&&"string"!==a.dtype&&"complex64"!==a.dtype)throw new Error(`Unsupported dtype in weight '${r}': ${a.dtype}`);const u={name:r,shape:a.shape,dtype:a.dtype};if("string"===a.dtype){const t=new Promise((async t=>{const e=await a.bytes(),n=e.reduce(((t,e)=>t+e.length),0)+Ii*e.length,s=new Uint8Array(n);let i=0;for(let r=0;r<e.length;r++){const t=e[r],n=new Uint8Array(new Uint32Array([t.length]).buffer);s.set(n,i),i+=Ii,s.set(t,i),i+=t.length}t(s)}));s.push(t)}else s.push(a.data());null!=e&&(u.group=e),n.push(u)}const r=await Promise.all(s);return{data:Ai(r),specs:n}}function Ai(t){if(null===t)throw new Error(`Invalid input value: ${JSON.stringify(t)}`);let e=0;const n=[];t.forEach((t=>{if(e+=t.byteLength,n.push(t.byteLength===t.buffer.byteLength?t:new t.constructor(t)),!(t instanceof Float32Array||t instanceof Int32Array||t instanceof Uint8Array))throw new Error(`Unsupported TypedArray subtype: ${t.constructor.name}`)}));const s=new Uint8Array(e);let i=0;return n.forEach((t=>{s.set(new Uint8Array(t.buffer),i),i+=t.byteLength})),s.buffer}const Ni="undefined"!==typeof Buffer&&("undefined"===typeof Blob||"undefined"===typeof atob||"undefined"===typeof btoa);function Ei(t){return Ni?Buffer.byteLength(t):new Blob([t]).size}function Oi(t){if(Ni)return Buffer.from(t).toString("base64");const e=new Uint8Array(t);let n="";for(let s=0,i=e.length;s<i;s++)n+=String.fromCharCode(e[s]);return btoa(n)}function $i(t){if(Ni){const e=Buffer.from(t,"base64");return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}const e=atob(t),n=new Uint8Array(e.length);for(let s=0;s<e.length;++s)n.set([e.charCodeAt(s)],s);return n.buffer}function Ri(t){if(1===t.length)return t[0];let e=0;t.forEach((t=>{e+=t.byteLength}));const n=new Uint8Array(e);let s=0;return t.forEach((t=>{n.set(new Uint8Array(t),s),s+=t.byteLength})),n.buffer}function Di(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("Expected JSON model topology, received ArrayBuffer.");return{dateSaved:new Date,modelTopologyType:"JSON",modelTopologyBytes:null==t.modelTopology?0:Ei(JSON.stringify(t.modelTopology)),weightSpecsBytes:null==t.weightSpecs?0:Ei(JSON.stringify(t.weightSpecs)),weightDataBytes:null==t.weightData?0:t.weightData.byteLength}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Mi{constructor(){this.saveRouters=[],this.loadRouters=[]}static getInstance(){return null==Mi.instance&&(Mi.instance=new Mi),Mi.instance}static registerSaveRouter(t){Mi.getInstance().saveRouters.push(t)}static registerLoadRouter(t){Mi.getInstance().loadRouters.push(t)}static getSaveHandlers(t){return Mi.getHandlers(t,"save")}static getLoadHandlers(t,e){return Mi.getHandlers(t,"load",e)}static getHandlers(t,e,n){const s=[],i="load"===e?Mi.getInstance().loadRouters:Mi.getInstance().saveRouters;return i.forEach((e=>{const i=e(t,n);null!==i&&s.push(i)})),s}}const Pi=t=>Mi.getSaveHandlers(t),Fi="tensorflowjs",Li=1,zi="models_store",Bi="model_info_store";function qi(){if(!at().getBool("IS_BROWSER"))throw new Error("Failed to obtain IndexedDB factory because the current environmentis not a web browser.");const t="undefined"===typeof window?self:window,e=t.indexedDB||t.mozIndexedDB||t.webkitIndexedDB||t.msIndexedDB||t.shimIndexedDB;if(null==e)throw new Error("The current browser does not appear to support IndexedDB.");return e}function Vi(t){const e=t.result;e.createObjectStore(zi,{keyPath:"modelPath"}),e.createObjectStore(Bi,{keyPath:"modelPath"})}class Wi{constructor(t){if(this.indexedDB=qi(),null==t||!t)throw new Error("For IndexedDB, modelPath must not be null, undefined or empty.");this.modelPath=t}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");return this.databaseAction(this.modelPath,t)}async load(){return this.databaseAction(this.modelPath)}databaseAction(t,e){return new Promise(((t,n)=>{const s=this.indexedDB.open(Fi,Li);s.onupgradeneeded=()=>Vi(s),s.onsuccess=()=>{const i=s.result;if(null==e){const e=i.transaction(zi,"readonly"),s=e.objectStore(zi),r=s.get(this.modelPath);r.onsuccess=()=>{if(null==r.result)return i.close(),n(new Error(`Cannot find model with path '${this.modelPath}' in IndexedDB.`));t(r.result.modelArtifacts)},r.onerror=t=>(i.close(),n(r.error)),e.oncomplete=()=>i.close()}else{const s=Di(e),r=i.transaction(Bi,"readwrite");let o=r.objectStore(Bi);const a=o.put({modelPath:this.modelPath,modelArtifactsInfo:s});let u;a.onsuccess=()=>{u=i.transaction(zi,"readwrite");const a=u.objectStore(zi),c=a.put({modelPath:this.modelPath,modelArtifacts:e,modelArtifactsInfo:s});c.onsuccess=()=>t({modelArtifactsInfo:s}),c.onerror=t=>{o=r.objectStore(Bi);const e=o.delete(this.modelPath);e.onsuccess=()=>(i.close(),n(c.error)),e.onerror=t=>(i.close(),n(c.error))}},a.onerror=t=>(i.close(),n(a.error)),r.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}}},s.onerror=t=>n(s.error)}))}}Wi.URL_SCHEME="indexeddb://";const ji=t=>at().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Wi.URL_SCHEME)?Ui(t.slice(Wi.URL_SCHEME.length)):null;function Ui(t){return new Wi(t)}function Gi(t){return t.startsWith(Wi.URL_SCHEME)?t.slice(Wi.URL_SCHEME.length):t}Mi.registerSaveRouter(ji),Mi.registerLoadRouter(ji);class Hi{constructor(){this.indexedDB=qi()}async listModels(){return new Promise(((t,e)=>{const n=this.indexedDB.open(Fi,Li);n.onupgradeneeded=()=>Vi(n),n.onsuccess=()=>{const s=n.result,i=s.transaction(Bi,"readonly"),r=i.objectStore(Bi),o=r.getAll();o.onsuccess=()=>{const e={};for(const t of o.result)e[t.modelPath]=t.modelArtifactsInfo;t(e)},o.onerror=t=>(s.close(),e(o.error)),i.oncomplete=()=>s.close()},n.onerror=t=>e(n.error)}))}async removeModel(t){return t=Gi(t),new Promise(((e,n)=>{const s=this.indexedDB.open(Fi,Li);s.onupgradeneeded=()=>Vi(s),s.onsuccess=()=>{const i=s.result,r=i.transaction(Bi,"readwrite"),o=r.objectStore(Bi),a=o.get(t);let u;a.onsuccess=()=>{if(null==a.result)return i.close(),n(new Error(`Cannot find model with path '${t}' in IndexedDB.`));{const s=o.delete(t),r=()=>{u=i.transaction(zi,"readwrite");const s=u.objectStore(zi),r=s.delete(t);r.onsuccess=()=>e(a.result.modelArtifactsInfo),r.onerror=t=>n(a.error)};s.onsuccess=r,s.onerror=t=>(r(),i.close(),n(a.error))}},a.onerror=t=>(i.close(),n(a.error)),r.oncomplete=()=>{null==u?i.close():u.oncomplete=()=>i.close()}},s.onerror=t=>n(s.error)}))}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Ki="/",Xi="tensorflowjs_models",Qi="info",Yi="model_topology",Zi="weight_specs",Ji="weight_data",tr="model_metadata";function er(t){return{info:[Xi,t,Qi].join(Ki),topology:[Xi,t,Yi].join(Ki),weightSpecs:[Xi,t,Zi].join(Ki),weightData:[Xi,t,Ji].join(Ki),modelMetadata:[Xi,t,tr].join(Ki)}}function nr(t){const e=t.split(Ki);if(e.length<3)throw new Error(`Invalid key format: ${t}`);return e.slice(1,e.length-1).join(Ki)}function sr(t){return t.startsWith(ir.URL_SCHEME)?t.slice(ir.URL_SCHEME.length):t}class ir{constructor(t){if(!at().getBool("IS_BROWSER")||"undefined"===typeof window||"undefined"===typeof window.localStorage)throw new Error("The current environment does not support local storage.");if(this.LS=window.localStorage,null==t||!t)throw new Error("For local storage, modelPath must not be null, undefined or empty.");this.modelPath=t,this.keys=er(this.modelPath)}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserLocalStorage.save() does not support saving model topology in binary formats yet.");{const n=JSON.stringify(t.modelTopology),s=JSON.stringify(t.weightSpecs),i=Di(t);try{this.LS.setItem(this.keys.info,JSON.stringify(i)),this.LS.setItem(this.keys.topology,n),this.LS.setItem(this.keys.weightSpecs,s),this.LS.setItem(this.keys.weightData,Oi(t.weightData));const e={format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy};return null!=t.signature&&(e.signature=t.signature),null!=t.userDefinedMetadata&&(e.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(e.modelInitializer=t.modelInitializer),this.LS.setItem(this.keys.modelMetadata,JSON.stringify(e)),{modelArtifactsInfo:i}}catch(e){throw this.LS.removeItem(this.keys.info),this.LS.removeItem(this.keys.topology),this.LS.removeItem(this.keys.weightSpecs),this.LS.removeItem(this.keys.weightData),this.LS.removeItem(this.keys.modelMetadata),new Error(`Failed to save model '${this.modelPath}' to local storage: size quota being exceeded is a possible cause of this failure: modelTopologyBytes=${i.modelTopologyBytes}, weightSpecsBytes=${i.weightSpecsBytes}, weightDataBytes=${i.weightDataBytes}.`)}}}async load(){const t=JSON.parse(this.LS.getItem(this.keys.info));if(null==t)throw new Error(`In local storage, there is no model with name '${this.modelPath}'`);if("JSON"!==t.modelTopologyType)throw new Error("BrowserLocalStorage does not support loading non-JSON model topology yet.");const e={},n=JSON.parse(this.LS.getItem(this.keys.topology));if(null==n)throw new Error(`In local storage, the topology of model '${this.modelPath}' is missing.`);e.modelTopology=n;const s=JSON.parse(this.LS.getItem(this.keys.weightSpecs));if(null==s)throw new Error(`In local storage, the weight specs of model '${this.modelPath}' are missing.`);e.weightSpecs=s;const i=this.LS.getItem(this.keys.modelMetadata);if(null!=i){const t=JSON.parse(i);e.format=t["format"],e.generatedBy=t["generatedBy"],e.convertedBy=t["convertedBy"],null!=t["signature"]&&(e.signature=t["signature"]),null!=t["userDefinedMetadata"]&&(e.userDefinedMetadata=t["userDefinedMetadata"]),null!=t["modelInitializer"]&&(e.modelInitializer=t["modelInitializer"])}const r=this.LS.getItem(this.keys.weightData);if(null==r)throw new Error(`In local storage, the binary weight values of model '${this.modelPath}' are missing.`);return e.weightData=$i(r),e}}ir.URL_SCHEME="localstorage://";const rr=t=>at().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(ir.URL_SCHEME)?or(t.slice(ir.URL_SCHEME.length)):null;function or(t){return new ir(t)}Mi.registerSaveRouter(rr),Mi.registerLoadRouter(rr);class ar{constructor(){v(at().getBool("IS_BROWSER"),(()=>"Current environment is not a web browser")),v("undefined"===typeof window||"undefined"!==typeof window.localStorage,(()=>"Current browser does not appear to support localStorage")),this.LS=window.localStorage}async listModels(){const t={},e=Xi+Ki,n=Ki+Qi;for(let s=0;s<this.LS.length;++s){const i=this.LS.key(s);if(i.startsWith(e)&&i.endsWith(n)){const e=nr(i);t[e]=JSON.parse(this.LS.getItem(i))}}return t}async removeModel(t){t=sr(t);const e=er(t);if(null==this.LS.getItem(e.info))throw new Error(`Cannot find model at path '${t}'`);const n=JSON.parse(this.LS.getItem(e.info));return this.LS.removeItem(e.info),this.LS.removeItem(e.topology),this.LS.removeItem(e.weightSpecs),this.LS.removeItem(e.weightData),n}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const ur="://";class cr{constructor(){this.managers={}}static getInstance(){return null==cr.instance&&(cr.instance=new cr),cr.instance}static registerManager(t,e){v(null!=t,(()=>"scheme must not be undefined or null.")),t.endsWith(ur)&&(t=t.slice(0,t.indexOf(ur))),v(t.length>0,(()=>"scheme must not be an empty string."));const n=cr.getInstance();v(null==n.managers[t],(()=>`A model store manager is already registered for scheme '${t}'.`)),n.managers[t]=e}static getManager(t){const e=this.getInstance().managers[t];if(null==e)throw new Error(`Cannot find model manager for scheme '${t}'`);return e}static getSchemes(){return Object.keys(this.getInstance().managers)}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class lr{fetch(t,e){return fetch(t,e)}now(){return performance.now()}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Browser's encoder only supports utf-8, but got ${e}`);return null==this.textEncoder&&(this.textEncoder=new TextEncoder),this.textEncoder.encode(t)}decode(t,e){return new TextDecoder(e).decode(t)}}if(at().get("IS_BROWSER")){at().setPlatform("browser",new lr);try{cr.registerManager(ir.URL_SCHEME,new ar)}catch(x6){}try{cr.registerManager(Wi.URL_SCHEME,new Hi)}catch(x6){}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const hr={importFetch:()=>n(5817)};let pr;class dr{constructor(){this.util=n(8590),this.textEncoder=new this.util.TextEncoder}fetch(t,e){return null!=at().global.fetch?at().global.fetch(t,e):(null==pr&&(pr=hr.importFetch()),pr(t,e))}now(){const t=process.hrtime();return 1e3*t[0]+t[1]/1e6}encode(t,e){if("utf-8"!==e&&"utf8"!==e)throw new Error(`Node built-in encoder only supports utf-8, but got ${e}`);return this.textEncoder.encode(t)}decode(t,e){return 0===t.length?"":new this.util.TextDecoder(e).decode(t)}}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fr(t,e="float32",n){return e=e||"float32",Z(t),new Fs(t,e,n)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mr(t,e){const n=bi(t,"x","cast");if(!M(e))throw new Error(`Failed to cast to unknown dtype ${e}`);if("string"===e&&"string"!==n.dtype||"string"!==e&&"string"===n.dtype)throw new Error("Only strings can be casted to strings");const s={x:n},i={dtype:e};return ci.runKernel(Pt,s,i)}at().get("IS_NODE")&&at().setPlatform("node",new dr);const gr=xi({cast_:mr});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yr(t){const e=bi(t,"x","clone","string_or_numeric"),n={x:e};return ci.runKernel(Te,n)}const br=xi({clone_:yr});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vr(t,e=!1){console.log(t.toString(e))}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ui();const wr={buffer:fr,cast:gr,clone:br,print:vr};Vs(wr);n(4603),n(7566),n(8721);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const xr="model",_r=".json",kr=".weights.bin";function Sr(t){return new Promise((t=>setTimeout(t))).then(t)}class Tr{constructor(t){if(!at().getBool("IS_BROWSER"))throw new Error("browserDownloads() cannot proceed because the current environment is not a browser.");t.startsWith(Tr.URL_SCHEME)&&(t=t.slice(Tr.URL_SCHEME.length)),null!=t&&0!==t.length||(t=xr),this.modelTopologyFileName=t+_r,this.weightDataFileName=t+kr}async save(t){if("undefined"===typeof document)throw new Error("Browser downloads are not supported in this environment since `document` is not present");const e=window.URL.createObjectURL(new Blob([t.weightData],{type:"application/octet-stream"}));if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserDownloads.save() does not support saving model topology in binary formats yet.");{const n=[{paths:["./"+this.weightDataFileName],weights:t.weightSpecs}],s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n};null!=t.signature&&(s.signature=t.signature),null!=t.userDefinedMetadata&&(s.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(s.modelInitializer=t.modelInitializer);const i=window.URL.createObjectURL(new Blob([JSON.stringify(s)],{type:"application/json"})),r=null==this.jsonAnchor?document.createElement("a"):this.jsonAnchor;if(r.download=this.modelTopologyFileName,r.href=i,await Sr((()=>r.dispatchEvent(new MouseEvent("click")))),null!=t.weightData){const t=null==this.weightDataAnchor?document.createElement("a"):this.weightDataAnchor;t.download=this.weightDataFileName,t.href=e,await Sr((()=>t.dispatchEvent(new MouseEvent("click"))))}return{modelArtifactsInfo:Di(t)}}}}Tr.URL_SCHEME="downloads://";const Ir=t=>at().getBool("IS_BROWSER")&&!Array.isArray(t)&&t.startsWith(Tr.URL_SCHEME)?Cr(t.slice(Tr.URL_SCHEME.length)):null;function Cr(t="model"){return new Tr(t)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ar(t,e,n,s){o(t),n=null==n?0:n,s=null==s?1:s,a(n,s);let i=0;const r=r=>(r.then((r=>{const o=n+ ++i/t.length*(s-n);return e(o),r})),r);function o(t){v(null!=t&&Array.isArray(t)&&t.length>0,(()=>"promises must be a none empty array"))}function a(t,e){v(t>=0&&t<=1,(()=>`Progress fraction must be in range [0, 1], but got startFraction ${t}`)),v(e>=0&&e<=1,(()=>`Progress fraction must be in range [0, 1], but got endFraction ${e}`)),v(e>=t,(()=>`startFraction must be no more than endFraction, but got startFraction ${t} and endFraction ${e}`))}return Promise.all(t.map(r))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
async function Nr(t,e){null==e&&(e={});const n=null==e.fetchFunc?at().platform.fetch:e.fetchFunc,s=t.map((t=>n(t,e.requestInit,{isBinary:!0}))),i=0,r=.5,o=null==e.onProgress?await Promise.all(s):await Ar(s,e.onProgress,i,r),a=o.map((t=>t.arrayBuffer())),u=.5,c=1,l=null==e.onProgress?await Promise.all(a):await Ar(a,e.onProgress,u,c);return l}Mi.registerSaveRouter(Ir);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Er="application/octet-stream",Or="application/json";class $r{constructor(t,e){if(this.DEFAULT_METHOD="POST",null==e&&(e={}),this.weightPathPrefix=e.weightPathPrefix,this.onProgress=e.onProgress,this.weightUrlConverter=e.weightUrlConverter,null!=e.fetchFunc?(v("function"===typeof e.fetchFunc,(()=>"Must pass a function that matches the signature of `fetch` (see https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API)")),this.fetch=e.fetchFunc):this.fetch=at().platform.fetch,v(null!=t&&t.length>0,(()=>"URL path for http must not be null, undefined or empty.")),Array.isArray(t)&&v(2===t.length,(()=>`URL paths for http must have a length of 2, (actual length is ${t.length}).`)),this.path=t,null!=e.requestInit&&null!=e.requestInit.body)throw new Error("requestInit is expected to have no pre-existing body, but has one.");this.requestInit=e.requestInit||{}}async save(t){if(t.modelTopology instanceof ArrayBuffer)throw new Error("BrowserHTTPRequest.save() does not support saving model topology in binary formats yet.");const e=Object.assign({method:this.DEFAULT_METHOD},this.requestInit);e.body=new FormData;const n=[{paths:["./model.weights.bin"],weights:t.weightSpecs}],s={modelTopology:t.modelTopology,format:t.format,generatedBy:t.generatedBy,convertedBy:t.convertedBy,weightsManifest:n};null!=t.signature&&(s.signature=t.signature),null!=t.userDefinedMetadata&&(s.userDefinedMetadata=t.userDefinedMetadata),null!=t.modelInitializer&&(s.modelInitializer=t.modelInitializer),e.body.append("model.json",new Blob([JSON.stringify(s)],{type:Or}),"model.json"),null!=t.weightData&&e.body.append("model.weights.bin",new Blob([t.weightData],{type:Er}),"model.weights.bin");const i=await this.fetch(this.path,e);if(i.ok)return{modelArtifactsInfo:Di(t),responses:[i]};throw new Error(`BrowserHTTPRequest.save() failed due to HTTP response status ${i.status}.`)}async load(){const t=await this.fetch(this.path,this.requestInit);if(!t.ok)throw new Error(`Request to ${this.path} failed with status code ${t.status}. Please verify this URL points to the model JSON of the model to load.`);let e;try{e=await t.json()}catch(d){let t=`Failed to parse model JSON of response from ${this.path}.`;throw this.path.endsWith(".pb")?t+=" Your path contains a .pb file extension. Support for .pb models have been removed in TensorFlow.js 1.0 in favor of .json models. You can re-convert your Python TensorFlow model using the TensorFlow.js 1.0 conversion scripts or you can convert your.pb models with the 'pb2json'NPM script in the tensorflow/tfjs-converter repository.":t+=" Please make sure the server is serving valid JSON for this request.",new Error(t)}const n=e.modelTopology,s=e.weightsManifest,i=e.generatedBy,r=e.convertedBy,o=e.format,a=e.signature,u=e.userDefinedMetadata;if(null==n&&null==s)throw new Error(`The JSON from HTTP path ${this.path} contains neither model topology or manifest for weights.`);let c,l;if(null!=s){const t=await this.loadWeights(s);[c,l]=t}const h={modelTopology:n,weightSpecs:c,weightData:l,generatedBy:i,convertedBy:r,format:o};null!=a&&(h.signature=a),null!=u&&(h.userDefinedMetadata=u);const p=e.modelInitializer;return p&&(h.modelInitializer=p),h}async loadWeights(t){const e=Array.isArray(this.path)?this.path[1]:this.path,[n,s]=Rr(e),i=this.weightPathPrefix||n,r=[];for(const c of t)r.push(...c.weights);const o=[],a=[];for(const c of t)for(const t of c.paths)null!=this.weightUrlConverter?a.push(this.weightUrlConverter(t)):o.push(i+t+s);this.weightUrlConverter&&o.push(...await Promise.all(a));const u=await Nr(o,{requestInit:this.requestInit,fetchFunc:this.fetch,onProgress:this.onProgress});return[r,Ri(u)]}}function Rr(t){const e=t.lastIndexOf("/"),n=t.lastIndexOf("?"),s=t.substring(0,e),i=n>e?t.substring(n):"";return[s+"/",i]}function Dr(t){return null!=t.match($r.URL_SCHEME_REGEX)}$r.URL_SCHEME_REGEX=/^https?:\/\//;const Mr=(t,e)=>{if("undefined"===typeof fetch&&(null==e||null==e.fetchFunc))return null;{let n=!0;if(n=Array.isArray(t)?t.every((t=>Dr(t))):Dr(t),n)return Pr(t,e)}return null};function Pr(t,e){return new $r(t,e)}Mi.registerSaveRouter(Mr),Mi.registerLoadRouter(Mr);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fr(t,e,n){if(x(t),null!=e&&3!==e.length)throw new Error("tensor3d() requires shape to have three numbers");const s=mi(t,n);if(3!==s.length&&1!==s.length)throw new Error("tensor3d() requires values to be number[][][] or flat/TypedArray");if(1===s.length&&null==e)throw new Error("tensor3d() requires shape to be provided when `values` are a flat array");return Si(t,e,s,n)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
let Lr;function zr(t,e=3){if(e>4)throw new Error("Cannot construct Tensor with more than 4 channels from pixels.");if(null==t)throw new Error("pixels passed to tf.browser.fromPixels() can not be null");let n=!1,s=!1,i=!1,r=!1,o=!1,a=!1;if(t.data instanceof Uint8Array)n=!0;else if("undefined"!==typeof ImageData&&t instanceof ImageData)s=!0;else if("undefined"!==typeof HTMLVideoElement&&t instanceof HTMLVideoElement)i=!0;else if("undefined"!==typeof HTMLImageElement&&t instanceof HTMLImageElement)r=!0;else if(null!=t.getContext)o=!0;else{if(!("undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap))throw new Error(`pixels passed to tf.browser.fromPixels() must be either an HTMLVideoElement, HTMLImageElement, HTMLCanvasElement, ImageData in browser, or OffscreenCanvas, ImageData in webworker or {data: Uint32Array, width: number, height: number}, but was ${t.constructor.name}`);a=!0}if(i){const e=2;if(i&&t.readyState<e)throw new Error("The video element has not loaded data yet. Please wait for `loadeddata` event on the <video> element.")}const u=hs(is,ci.backendName);if(null!=u){const n={pixels:t},s={numChannels:e};return ci.runKernel(is,n,s)}const[c,l]=i?[t.videoWidth,t.videoHeight]:[t.width,t.height];let h,p;if(o?h=t.getContext("2d").getImageData(0,0,c,l).data:s||n?h=t.data:(r||i||a)&&(null==Lr&&(Lr=document.createElement("canvas").getContext("2d")),Lr.canvas.width=c,Lr.canvas.height=l,Lr.drawImage(t,0,0,c,l),h=Lr.getImageData(0,0,c,l).data),4===e)p=new Int32Array(h);else{const t=c*l;p=new Int32Array(t*e);for(let n=0;n<t;n++)for(let t=0;t<e;++t)p[n*e+t]=h[4*n+t]}const d=[l,c,e];return Fr(p,d,"int32")}xi({fromPixels_:zr});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Br(t,e,n){const s=t.shape.length;v(s===e.length,(()=>`Error in slice${s}D: Length of begin ${e} must match the rank of the array (${s}).`)),v(s===n.length,(()=>`Error in slice${s}D: Length of size ${n} must match the rank of the array (${s}).`));for(let i=0;i<s;++i)v(e[i]+n[i]<=t.shape[i],(()=>`Error in slice${s}D: begin[${i}] + size[${i}] (${e[i]+n[i]}) would overflow input.shape[${i}] (${t.shape[i]})`))}function qr(t){const e=[];let n=0;while(t>0)1&t&&e.push(n),t/=2,n++;return e}function Vr(t,e,n){const s=[];for(let i=0;i<t.length;i++)s[i]=Math.ceil((e[i]-t[i])/n[i]);return s}function Wr(t,e,n,s){const i=[...t];for(let r=i.length;r<s.length;r++)i.push(1);for(let r=0;r<n;r++)0===r?i[e]=1:(i.splice(e,0,1),i.pop());return i}function jr(t,e,n){return n<=t?n:n-(e-1)}function Ur(t,e){const n=[];for(let s=0;s<t;s++)n.push(e+s);return n}function Gr(t,e,n,s,i,r,o,a,u){const c=t.length;let l=new Array(c),h=new Array(c),p=new Array(c);if(e.length&&n>0){const u=e[0],c=n+1;l=Hr(o,u,c,s,t),h=Kr(a,u,c,i,t),p=Wr(r,u,c,t)}else for(let d=0;d<c;d++)l[d]=Qr(o,s,r,t,d,u),h[d]=Yr(a,i,r,t,d,u),p[d]=Xr(r,d,u);return{begin:l,end:h,strides:p}}function Hr(t,e,n,s,i){const r=[...i],o=Ur(n,e);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=0;else{const i=jr(e,n,a);let o=s[i];t&1<<i&&(o=0),r[a]=o}return r}function Kr(t,e,n,s,i){const r=[...i],o=Ur(n,e);for(let a=0;a<r.length;a++)if(o.indexOf(a)>-1)r[a]=Number.MAX_SAFE_INTEGER;else{const i=jr(e,n,a);let o=s[i];t&1<<i&&(o=Number.MAX_SAFE_INTEGER),r[a]=o}for(let a=0;a<r.length;a++){const t=i[a];r[a]<0&&(r[a]+=t),r[a]=g(0,r[a],i[a])}return r}function Xr(t,e,n){let s=t[e];return(n&1<<e||null==s)&&(s=1),s}function Qr(t,e,n,s,i,r){let o=e[i];const a=n[i]||1;(t&1<<i||r&1<<i||null==o)&&(o=a>0?Number.MIN_SAFE_INTEGER:Number.MAX_SAFE_INTEGER);const u=s[i];return o<0&&(o+=u),o=g(0,o,u-1),o}function Yr(t,e,n,s,i,r){let o=e[i];const a=n[i]||1;(t&1<<i||r&1<<i||null==o)&&(o=a>0?Number.MAX_SAFE_INTEGER:Number.MIN_SAFE_INTEGER);const u=s[i];return o<0&&(o+=u),o=a>0?g(0,o,u):g(-1,o,u-1),o}function Zr(t,e,n){let s=n.length;for(let i=0;i<n.length;i++)if(n[i]>1){s=i;break}for(let i=s+1;i<n.length;i++)if(e[i]>0||n[i]!==t[i])return!1;return!0}function Jr(t,e){let n=t.length>0?t[t.length-1]:1;for(let s=0;s<t.length-1;s++)n+=t[s]*e[s];return n}function to(t,e,n){let s;const i=t.shape.length;let r;return s="number"===typeof e?[e,...new Array(i-1).fill(0)]:e.length<i?e.concat(new Array(i-e.length).fill(0)):e.slice(),s.forEach((t=>{v(-1!==t,(()=>"slice() does not support negative begin indexing."))})),r=null==n?new Array(i).fill(-1):"number"===typeof n?[n,...new Array(i-1).fill(-1)]:n.length<i?n.concat(new Array(i-n.length).fill(-1)):n,r=r.map(((e,n)=>e>=0?e:(v(-1===e,(()=>`Negative size values should be exactly -1 but got ${e} for the slice() size at index ${n}.`)),t.shape[n]-s[n]))),[s,r]}function eo(t,e,n,s,i,r,o,a,u){let c=e.slice(),l=n.slice(),h=s;null==s&&(h=new Array(c.length));const p=qr(o);if(p.length>1)throw new Error("Multiple ellipses in slice is not allowed.");if(0!==o&&0!==a)throw new Error("Using both ellipsisMask and newAxisMask is not yet supported.");if(0!==o&&0!==u)throw new Error("Using both ellipsisMask and shrinkAxisMask is not yet supported.");const d=t.length-c.length,f=qr(a),m=t.slice();f.forEach((t=>{c[t]=0,l[t]=1,m.splice(t,0,1)}));const{begin:g,end:y,strides:b}=Gr(m,p,d,c,l,h,i,r,o);c=g,l=y,h=b;const v=qr(u);v.forEach((t=>{l[t]=c[t]+1,h[t]=1}));const w=Vr(c,l,h),x=w.filter(((t,e)=>-1===v.indexOf(e))),_=h.every((t=>1===t));return{nonStrided:_,$begin:c,$end:l,$strides:h,size:w,newShape:m,outShape:x}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class no{getClassName(){return this.constructor.className}static fromConfig(t,e){return new t(e)}}class so{constructor(){this.classNameMap={}}static getMap(){return null==so.instance&&(so.instance=new so),so.instance}static register(t){so.getMap().classNameMap[t.className]=[t,t.fromConfig]}}function io(t){v(null!=t.className,(()=>"Class being registered does not have the static className property defined.")),v("string"===typeof t.className,(()=>"className is required to be a string, but got type "+typeof t.className)),v(t.className.length>0,(()=>"Class being registered has an empty-string as its className, which is disallowed.")),so.register(t)}function ro(t){at().getBool("DEPRECATION_WARNINGS_ENABLED")&&console.warn(t+" You can disable deprecation warnings with tf.disableDeprecationWarnings().")}function oo(){return ci}function ao(){return ci.memory()}function uo(t,e){return ci.tidy(t,e)}function co(t){const e=ni(t);e.forEach((t=>t.dispose()))}function lo(t){return ci.keep(t)}function ho(t,e,n=1){return ci.registerBackend(t,e,n)}function po(){return ci.backend}function fo(t,e){v(j(t),(()=>"The f passed in variableGrads(f) must be a function")),v(null==e||Array.isArray(e)&&e.every((t=>t instanceof Us)),(()=>"The varList passed in variableGrads(f, varList) must be an array of variables"));const n=null!=e;if(!n){e=[];for(const t in ci.registeredVariables)e.push(ci.registeredVariables[t])}const s=n?e.filter((t=>!t.trainable)):null,i=e.length;e=e.filter((t=>t.trainable)),v(e.length>0,(()=>`variableGrads() expects at least one of the input variables to be trainable, but none of the ${i} variables is trainable.`));const r=!0,{value:o,grads:a}=ci.gradients(t,e,null,r);v(a.some((t=>null!=t)),(()=>"Cannot find a connection between any variable and the result of the loss function y=f(x). Please make sure the operations that use variables are inside the function f passed to minimize().")),v(0===o.rank,(()=>`The f passed in variableGrads(f) must return a scalar, but it returned a rank-${o.rank} tensor`));const u={};return e.forEach(((t,e)=>{null!=a[e]&&(u[t.name]=a[e])})),null!=s&&s.forEach((t=>u[t.name]=null)),{value:o,grads:u}}function mo(t){return ci.customGrad(t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function go(t,e){if((F(t)&&"string"!==e||Array.isArray(t))&&"complex64"!==e)throw new Error("Error creating a new Scalar: value must be a primitive (number|boolean|string)");if("string"===e&&F(t)&&!(t instanceof Uint8Array))throw new Error("When making a scalar from encoded string, the value must be `Uint8Array`.");const n=[],s=[];return Si(t,n,s,e)}Ws(ro);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yo extends no{minimize(t,e=!1,n){const{value:s,grads:i}=this.computeGradients(t,n);if(null!=n){const t=n.map((t=>({name:t.name,tensor:i[t.name]})));this.applyGradients(t)}else this.applyGradients(i);return co(i),e?s:(s.dispose(),null)}get iterations(){return null==this.iterations_&&(this.iterations_=0),this.iterations_}incrementIterations(){this.iterations_=this.iterations+1}computeGradients(t,e){return fo(t,e)}dispose(){null!=this.iterations_&&co(this.iterations_)}async saveIterations(){return null==this.iterations_&&(this.iterations_=0),{name:"iter",tensor:go(this.iterations_,"int32")}}async getWeights(){throw new Error("getWeights() is not implemented for this optimizer yet.")}async setWeights(t){throw new Error(`setWeights() is not implemented for this optimizer class ${this.getClassName()}`)}async extractIterations(t){return this.iterations_=(await t[0].tensor.data())[0],t.slice(1)}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function bo(t){const e=bi(t,"x","abs");if("complex64"===e.dtype){const t={x:e};return ci.runKernel(Bt,t)}{const t={x:e};return ci.runKernel(ft,t)}}Object.defineProperty(yo,Symbol.hasInstance,{value:t=>null!=t.minimize&&null!=t.computeGradients&&null!=t.applyGradients});const vo=xi({abs_:bo});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wo(t,e){let n=bi(t,"a","add"),s=bi(e,"b","add");[n,s]=ti(n,s);const i={a:n,b:s};return ci.runKernel(yt,i)}const xo=xi({add_:wo});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _o(t,e=null,n=!1){const s=bi(t,"x","all","bool"),i={x:s},r={axis:e,keepDims:n};return ci.runKernel(vt,i,r)}const ko=xi({all_:_o});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function So(t,e=null,n=!1){const s=bi(t,"x","any","bool"),i={x:s},r={axis:e,keepDims:n};return ci.runKernel(wt,i,r)}const To=xi({any_:So});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Io(t,e=0){const n=bi(t,"x","argMax"),s={x:n},i={axis:e};return ci.runKernel(xt,s,i)}const Co=xi({argMax_:Io});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ao(t,e,n,s,i="NHWC",r){const o=t[3],a=[...e,o],u=jo(i);return Oo(t,a,n,r,s,null,null,u)}function No(t,e,n,s,i,r,o="channelsLast"){const[a,u]=Po(e);let c;if("channelsLast"===o)c=[a,u,t[3],t[3]];else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);c=[a,u,t[1],t[1]]}return Oo(t,c,n,s,i,r,!1,o)}function Eo(t,e,n,s,i,r,o="NDHWC"){const[a,u,c]=Fo(e);let l,h;if("NDHWC"===o)h="channelsLast",l=[a,u,c,t[4],t[4]];else{if("NCDHW"!==o)throw new Error(`Unknown dataFormat ${o}`);h="channelsFirst",l=[a,u,c,t[1],t[1]]}return $o(t,l,n,s,i,!1,h,r)}function Oo(t,e,n,s,i,r,o=!1,a="channelsLast"){let[u,c,l,h]=[-1,-1,-1,-1];if("channelsLast"===a)[u,c,l,h]=t;else{if("channelsFirst"!==a)throw new Error(`Unknown dataFormat ${a}`);[u,h,c,l]=t}const[p,d,,f]=e,[m,g]=Po(n),[y,b]=Po(s),v=Lo(p,y),w=Lo(d,b),{padInfo:x,outHeight:_,outWidth:k}=zo(i,c,l,m,g,v,w,r,a),S=o?f*h:f;let T;return"channelsFirst"===a?T=[u,S,_,k]:"channelsLast"===a&&(T=[u,_,k,S]),{batchSize:u,dataFormat:a,inHeight:c,inWidth:l,inChannels:h,outHeight:_,outWidth:k,outChannels:S,padInfo:x,strideHeight:m,strideWidth:g,filterHeight:p,filterWidth:d,effectiveFilterHeight:v,effectiveFilterWidth:w,dilationHeight:y,dilationWidth:b,inShape:t,outShape:T,filterShape:e}}function $o(t,e,n,s,i,r=!1,o="channelsLast",a){let[u,c,l,h,p]=[-1,-1,-1,-1,-1];if("channelsLast"===o)[u,c,l,h,p]=t;else{if("channelsFirst"!==o)throw new Error(`Unknown dataFormat ${o}`);[u,p,c,l,h]=t}const[d,f,m,,g]=e,[y,b,v]=Fo(n),[w,x,_]=Fo(s),k=Lo(d,w),S=Lo(f,x),T=Lo(m,_),{padInfo:I,outDepth:C,outHeight:A,outWidth:N}=Bo(i,c,l,h,y,b,v,k,S,T,a),E=r?g*p:g;let O;return"channelsFirst"===o?O=[u,E,C,A,N]:"channelsLast"===o&&(O=[u,C,A,N,E]),{batchSize:u,dataFormat:o,inDepth:c,inHeight:l,inWidth:h,inChannels:p,outDepth:C,outHeight:A,outWidth:N,outChannels:E,padInfo:I,strideDepth:y,strideHeight:b,strideWidth:v,filterDepth:d,filterHeight:f,filterWidth:m,effectiveFilterDepth:k,effectiveFilterHeight:S,effectiveFilterWidth:T,dilationDepth:w,dilationHeight:x,dilationWidth:_,inShape:t,outShape:O,filterShape:e}}function Ro(t,e,n,s,i){null==s&&(s=Mo(t,e,n));const r=t[0],o=t[1],a=qo((r-e+2*s)/n+1,i),u=qo((o-e+2*s)/n+1,i);return[a,u]}function Do(t,e,n,s,i,r){null==i&&(i=Mo(t,e,s));const o=t[0],a=t[1],u=t[2],c=qo((o-e+2*i)/s+1,r),l=qo((a-e+2*i)/s+1,r),h=qo((u-e+2*i)/s+1,r);return[c,l,h,n]}function Mo(t,e,n,s=1){const i=Lo(e,s);return Math.floor((t[0]*(n-1)-n+i)/2)}function Po(t){return"number"===typeof t?[t,t,t]:2===t.length?[t[0],t[1],1]:t}function Fo(t){return"number"===typeof t?[t,t,t]:t}function Lo(t,e){return e<=1?t:t+(t-1)*(e-1)}function zo(t,e,n,s,i,r,o,a,u){let c,l,h;if("number"===typeof t){const i=0===t?"VALID":"NUMBER";c={top:t,bottom:t,left:t,right:t,type:i};const o=Ro([e,n],r,s,t,a);l=o[0],h=o[1]}else if("same"===t){l=Math.ceil(e/s),h=Math.ceil(n/i);const t=Math.max(0,(l-1)*s+r-e),a=Math.max(0,(h-1)*i+o-n),u=Math.floor(t/2),p=t-u,d=Math.floor(a/2),f=a-d;c={top:u,bottom:p,left:d,right:f,type:"SAME"}}else if("valid"===t)c={top:0,bottom:0,left:0,right:0,type:"VALID"},l=Math.ceil((e-r+1)/s),h=Math.ceil((n-o+1)/i);else{if("object"!==typeof t)throw Error(`Unknown padding parameter: ${t}`);{const p="channelsLast"===u?t[1][0]:t[2][0],d="channelsLast"===u?t[1][1]:t[2][1],f="channelsLast"===u?t[2][0]:t[3][0],m="channelsLast"===u?t[2][1]:t[3][1],g=0===p&&0===d&&0===f&&0===m?"VALID":"EXPLICIT";c={top:p,bottom:d,left:f,right:m,type:g},l=qo((e-r+p+d)/s+1,a),h=qo((n-o+f+m)/i+1,a)}}return{padInfo:c,outHeight:l,outWidth:h}}function Bo(t,e,n,s,i,r,o,a,u,c,l){let h,p,d,f;if("number"===typeof t){const r=0===t?"VALID":"NUMBER";h={top:t,bottom:t,left:t,right:t,front:t,back:t,type:r};const o=Do([e,n,s,1],a,1,i,t,l);p=o[0],d=o[1],f=o[2]}else if("same"===t){p=Math.ceil(e/i),d=Math.ceil(n/r),f=Math.ceil(s/o);const t=(p-1)*i+a-e,l=(d-1)*r+u-n,m=(f-1)*o+c-s,g=Math.floor(t/2),y=t-g,b=Math.floor(l/2),v=l-b,w=Math.floor(m/2),x=m-w;h={top:b,bottom:v,left:w,right:x,front:g,back:y,type:"SAME"}}else{if("valid"!==t)throw Error(`Unknown padding parameter: ${t}`);h={top:0,bottom:0,left:0,right:0,front:0,back:0,type:"VALID"},p=Math.ceil((e-a+1)/i),d=Math.ceil((n-u+1)/r),f=Math.ceil((s-c+1)/o)}return{padInfo:h,outDepth:p,outHeight:d,outWidth:f}}function qo(t,e){if(!e)return Math.trunc(t);switch(e){case"round":return Math.round(t);case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);default:throw new Error(`Unknown roundingMode ${e}`)}}function Vo(t){const[e,n,s]=Po(t);return 1===e&&1===n&&1===s}function Wo(t,e){return Vo(t)||Vo(e)}function jo(t){if("NHWC"===t)return"channelsLast";if("NCHW"===t)return"channelsFirst";throw new Error(`Unknown dataFormat ${t}`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Uo(t,e){const n=bi(t,"x","reshape","string_or_numeric"),s={x:n},i={shape:e};return ci.runKernel(wn,s,i)}const Go=xi({reshape_:Uo});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ho(t,e,n,s,i){const r=bi(t,"x","avgPool","float32"),o=1;v(Wo(n,o),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`));let a=r,u=!1;3===r.rank&&(u=!0,a=Go(r,[1,r.shape[0],r.shape[1],r.shape[2]])),v(4===a.rank,(()=>`Error in avgPool: x must be rank 4 but got rank ${a.rank}.`)),null!=i&&v(T(s),(()=>`Error in avgPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${s}.`));const c={x:a},l={filterSize:e,strides:n,pad:s,dimRoundingMode:i};let h=ci.runKernel(At,c,l);return h=gr(h,r.dtype),u?Go(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Ko=xi({avgPool_:Ho});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xo(t,e,n,s,i,r="NDHWC",o){null==o?o=[1,1,1]:ro("dilations is deprecated, this field will be gone in v3.0.0.");const a=bi(t,"x","avgPool3d","float32");let u=a,c=!1;4===a.rank&&(c=!0,u=Go(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),v(5===u.rank,(()=>`Error in avgPool3d: x must be rank 5 but got rank ${u.rank}.`)),v("NDHWC"===r,(()=>`Error in avgPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`)),v(Wo(n,o),(()=>`Error in avgPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),null!=i&&v(T(s),(()=>`Error in avgPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${s}.`));const l={x:u},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:r,dilations:o};let p=ci.runKernel(Et,l,h);return p=gr(p,u.dtype),c?Go(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Qo=xi({avgPool3d_:Xo});function Yo(t){let e;return e=0===t.rank||1===t.rank?Go(t,[1,1,1,t.size]):2===t.rank?Go(t,[1,1,t.shape[0],t.shape[1]]):3===t.rank?Go(t,[1,t.shape[0],t.shape[1],t.shape[2]]):t,e}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zo(t,e,n,s,i,r){null==r&&(r=.001);const o=bi(t,"x","batchNorm"),a=bi(e,"mean","batchNorm"),u=bi(n,"variance","batchNorm");let c,l;null!=i&&(c=bi(i,"scale","batchNorm")),null!=s&&(l=bi(s,"offset","batchNorm")),v(a.rank===u.rank,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),v(null==l||a.rank===l.rank,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),v(null==c||a.rank===c.rank,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));const h=Yo(o),p={x:h,scale:c,offset:l,mean:a,variance:u},d={varianceEpsilon:r},f=ci.runKernel(we,p,d);return Go(f,o.shape)}const Jo=xi({batchNorm_:Zo});function ta(t,e,n,s,i,r){const o=bi(t,"x","batchNorm"),a=bi(e,"mean","batchNorm"),u=bi(n,"variance","batchNorm");let c,l;return null!=i&&(c=bi(i,"scale","batchNorm")),null!=s&&(l=bi(s,"offset","batchNorm")),v(2===o.rank,(()=>`Error in batchNorm2D: x must be rank 2 but got rank ${o.rank}.`)),v(2===a.rank||1===a.rank,(()=>`Error in batchNorm2D: mean must be rank 2 or rank 1 but got rank ${a.rank}.`)),v(2===u.rank||1===u.rank,(()=>`Error in batchNorm2D: variance must be rank 2 or rank 1 but got rank ${u.rank}.`)),null!=c&&v(2===c.rank||1===c.rank,(()=>`Error in batchNorm2D: scale must be rank 2 or rank 1 but got rank ${c.rank}.`)),null!=l&&v(2===l.rank||1===l.rank,(()=>`Error in batchNorm2D: offset must be rank 2 or rank 1 but got rank ${l.rank}.`)),Jo(o,a,u,l,c,r)}const ea=xi({batchNorm2d_:ta});function na(t,e,n,s,i,r){const o=bi(t,"x","batchNorm"),a=bi(e,"mean","batchNorm"),u=bi(n,"variance","batchNorm");let c,l;return null!=i&&(c=bi(i,"scale","batchNorm")),null!=s&&(l=bi(s,"offset","batchNorm")),v(3===o.rank,(()=>`Error in batchNorm3D: x must be rank 3 but got rank ${o.rank}.`)),v(3===a.rank||1===a.rank,(()=>`Error in batchNorm3D: mean must be rank 3 or rank 1 but got rank ${a.rank}.`)),v(3===u.rank||1===u.rank,(()=>`Error in batchNorm3D: variance must be rank 3 or rank 1 but got rank ${u.rank}.`)),null!=c&&v(3===c.rank||1===c.rank,(()=>`Error in batchNorm3D: scale must be rank 3 or rank 1 but got rank ${c.rank}.`)),null!=l&&v(3===l.rank||1===l.rank,(()=>`Error in batchNorm3D: offset must be rank 3 or rank 1 but got rank ${l.rank}.`)),Jo(o,a,u,l,c,r)}const sa=xi({batchNorm3d_:na});function ia(t,e,n,s,i,r){const o=bi(t,"x","batchNorm"),a=bi(e,"mean","batchNorm"),u=bi(n,"variance","batchNorm");let c,l;return null!=i&&(c=bi(i,"scale","batchNorm")),null!=s&&(l=bi(s,"offset","batchNorm")),v(4===o.rank,(()=>`Error in batchNorm4D: x must be rank 4 but got rank ${o.rank}.`)),v(4===a.rank||1===a.rank,(()=>`Error in batchNorm4D: mean must be rank 4 or rank 1 but got rank ${a.rank}.`)),v(4===u.rank||1===u.rank,(()=>`Error in batchNorm4D: variance must be rank 4 or rank 1 but got rank ${u.rank}.`)),null!=c&&v(4===c.rank||1===c.rank,(()=>`Error in batchNorm4D: scale must be rank 4 or rank 1 but got rank ${c.rank}.`)),null!=l&&v(4===l.rank||1===l.rank,(()=>`Error in batchNorm4D: offset must be rank 4 or rank 1 but got rank ${l.rank}.`)),Jo(o,a,u,l,c,r)}const ra=xi({batchNorm4d_:ia});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function oa(t,e,n){const s=bi(t,"x","clipByValue");v(e<=n,(()=>`Error in clip: min (${e}) must be less than or equal to max (${n}).`));const i={x:s},r={clipValueMin:e,clipValueMax:n};return ci.runKernel(Lt,i,r)}const aa=xi({clipByValue_:oa});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ua(t,e=0){v(t.length>=1,(()=>"Pass at least one tensor to concat"));const n=vi(t,"tensors","concat","string_or_numeric");if("complex64"===n[0].dtype&&n.forEach((t=>{if("complex64"!==t.dtype)throw new Error(`Cannot concatenate complex64 tensors with a tensor\n          with dtype ${t.dtype}. `)})),1===n.length)return br(n[0]);const s=n,i={axis:e};return ci.runKernel(qt,s,i)}const ca=xi({concat_:ua});function la(t){return ca(t,0)}const ha=xi({concat1d_:la});function pa(t,e){return ca(t,e)}const da=xi({concat2d_:pa});function fa(t,e){return ca(t,e)}const ma=xi({concat3d_:fa});function ga(t,e){return ca(t,e)}const ya=xi({concat4d_:ga});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ba(t,e,n,s,i="NHWC",r=[1,1],o){const a=bi(t,"x","conv2d"),u=bi(e,"filter","conv2d");let c=a,l=!1;3===a.rank&&(l=!0,c=Go(a,[1,a.shape[0],a.shape[1],a.shape[2]])),v(4===c.rank,(()=>`Error in conv2d: input must be rank 4, but got rank ${c.rank}.`)),v(4===u.rank,(()=>`Error in conv2d: filter must be rank 4, but got rank ${u.rank}.`)),null!=o&&v(T(s),(()=>`Error in conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${s}.`));const h="NHWC"===i?c.shape[3]:c.shape[1];v(h===u.shape[2],(()=>`Error in conv2d: depth of input (${h}) must match input depth for filter ${u.shape[2]}.`)),v(Wo(n,r),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`));const p={x:c,filter:u},d={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},f=ci.runKernel(Vt,p,d);return l?Go(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const va=xi({conv2d_:ba});function wa(t,e,n,s,i="NWC",r=1,o){const a=bi(t,"x","conv1d"),u=bi(e,"filter","conv1d");let c=a,l=!1;2===a.rank&&(l=!0,c=Go(a,[1,a.shape[0],a.shape[1]])),v(3===c.rank,(()=>`Error in conv1d: input must be rank 3, but got rank ${c.rank}.`)),v(3===u.rank,(()=>`Error in conv1d: filter must be rank 3, but got rank ${u.rank}.`)),null!=o&&v(T(s),(()=>`Error in conv1d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${s}.`)),v(c.shape[2]===u.shape[1],(()=>`Error in conv1d: depth of input (${c.shape[2]}) must match input depth for filter ${u.shape[1]}.`)),v(Wo(n,r),(()=>`Error in conv1D: Either stride or dilation must be 1. Got stride ${n} and dilation '${r}'`)),v("NWC"===i,(()=>`Error in conv1d: got dataFormat of ${i} but only NWC is currently supported.`));const h=Go(u,[1,u.shape[0],u.shape[1],u.shape[2]]),p=Go(c,[c.shape[0],1,c.shape[1],c.shape[2]]),d=[1,n],f=[1,r],m="NHWC",g=va(p,h,d,s,m,f,o);return Go(g,l?[g.shape[2],g.shape[3]]:[g.shape[0],g.shape[2],g.shape[3]])}const xa=xi({conv1d_:wa});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _a(t,e,n,s,i,r="NHWC",o){v(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let a=t,u=e,c=!1;3===e.rank&&(c=!0,u=Go(e,[1,e.shape[0],e.shape[1],e.shape[2]]),a=[1,t[0],t[1],t[2]]),v(4===a.length,(()=>`Error in conv2dDerInput: inShape must be length 4, but got length ${a.length}.`)),v(4===u.rank,(()=>`Error in conv2dDerInput: dy must be rank 4, but got rank ${u.rank}`)),v(4===n.rank,(()=>`Error in conv2dDerInput: filter must be rank 4, but got rank ${n.rank}`));const l="NHWC"===r?a[3]:a[1],h="NHWC"===r?u.shape[3]:u.shape[1];v(l===n.shape[2],(()=>`Error in conv2dDerInput: depth of input (${l}) must match input depth for filter ${n.shape[2]}.`)),v(h===n.shape[3],(()=>`Error in conv2dDerInput: depth of output (${h}) must match output depth for filter ${n.shape[3]}.`)),null!=o&&v(T(i),(()=>`Error in conv2dDerInput: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`));const p={dy:u,filter:n},d={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,inputShape:a},f=ci.runKernel(jt,p,d);return c?Go(f,[f.shape[1],f.shape[2],f.shape[3]]):f}const ka=xi({conv2DBackpropInput_:_a});function Sa(t,e,n,s,i,r){const o=bi(t,"x","conv2dTranspose"),a=bi(e,"filter","conv2dTranspose");return ka(n,o,a,s,i,"NHWC",r)}const Ta=xi({conv2dTranspose_:Sa});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ia(t,e,n,s,i="NDHWC",r=[1,1,1]){const o=bi(t,"x","conv3d"),a=bi(e,"filter","conv3d");let u=o,c=!1;4===o.rank&&(c=!0,u=Go(o,[1,o.shape[0],o.shape[1],o.shape[2],o.shape[3]])),v(5===u.rank,(()=>`Error in conv3d: input must be rank 5, but got rank ${u.rank}.`)),v(5===a.rank,(()=>`Error in conv3d: filter must be rank 5, but got rank ${a.rank}.`)),v(u.shape[4]===a.shape[3],(()=>`Error in conv3d: depth of input (${u.shape[4]}) must match input depth for filter ${a.shape[3]}.`)),v(Wo(n,r),(()=>`Error in conv3D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`)),v("NDHWC"===i,(()=>`Error in conv3d: got dataFormat of ${i} but only NDHWC is currently supported.`));const l={x:u,filter:a},h={strides:n,pad:s,dataFormat:i,dilations:r},p=ci.runKernel(Ut,l,h);return c?Go(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Ca=xi({conv3d_:Ia});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Aa(t,e,n,s,i="NHWC",r=[1,1],o){const a=bi(t,"x","depthwiseConv2d"),u=bi(e,"filter","depthwiseConv2d");let c=a,l=!1;3===a.rank&&(l=!0,c=Go(a,[1,a.shape[0],a.shape[1],a.shape[2]])),v(4===c.rank,(()=>`Error in depthwiseConv2d: input must be rank 4, but got rank ${c.rank}.`)),v(4===u.rank,(()=>`Error in depthwiseConv2d: filter must be rank 4, but got rank ${u.rank}.`)),v(c.shape[3]===u.shape[2],(()=>`Error in depthwiseConv2d: number of input channels (${c.shape[3]}) must match the inChannels dimension in filter ${u.shape[2]}.`)),null!=o&&v(T(s),(()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${s}.`));const h={x:c,filter:u},p={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o},d=ci.runKernel(te,h,p);return l?Go(d,[d.shape[1],d.shape[2],d.shape[3]]):d}const Na=xi({depthwiseConv2d_:Aa});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ea(t,e){let n=bi(t,"a","floorDiv"),s=bi(e,"b","floorDiv");[n,s]=ti(n,s);const i={a:n,b:s};return ci.runKernel(ve,i)}const Oa=xi({floorDiv_:Ea});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $a(t,e){let n=bi(t,"a","div"),s=bi(e,"b","div");if([n,s]=ti(n,s),"int32"===n.dtype&&"int32"===s.dtype)return Oa(n,s);const i={a:n,b:s},r={};return ci.runKernel(ae,i,r)}const Ra=xi({div_:$a});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Da(t){const e=bi(t,"x","elu"),n={x:e};return ci.runKernel(ue,n)}const Ma=xi({elu_:Da});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Pa(t,e){const n=t.length,s=[];for(let i=0;i<n;i++){const r=n-1-i,o=t[r]||1,a=e[e.length-1-i]||1;a>1&&1===o&&s.unshift(r)}return s}function Fa(t,e){const n=[];for(let s=0;s<e.length;s++){const i=t[t.length-s-1],r=e.length-s-1,o=e[r];(null==i||1===i&&o>1)&&n.unshift(r)}return n}function La(t,e){const n=[],s=Math.max(t.length,e.length);for(let i=0;i<s;i++){let s=t[t.length-i-1];null==s&&(s=1);let r=e[e.length-i-1];if(null==r&&(r=1),1===s)n.unshift(r);else if(1===r)n.unshift(s);else{if(s!==r){const n=`Operands could not be broadcast together with shapes ${t} and ${e}.`;throw Error(n)}n.unshift(s)}}return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function za(t,e){let n=bi(t,"a","equal"),s=bi(e,"b","equal");[n,s]=ti(n,s),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(he,i)}const Ba=xi({equal_:za});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qa(t,e=0){const n=bi(t,"x","expandDims","string_or_numeric");v(e<=n.rank,(()=>"Axis must be <= rank of the tensor"));const s={input:n},i={dim:e};return ci.runKernel(de,s,i)}const Va=xi({expandDims_:qa});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wa(t,e){const n=bi(t,"x","tile","string_or_numeric");v(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of reps ${e}.`));const s={x:n},i={reps:e};return ci.runKernel(Qn,s,i)}const ja=xi({tile_:Wa});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ua(t,e,n,s="float32"){null==e&&(e=t);const i=fr([t,e],s),r=t<=e?t:e;for(let a=0;a<r;++a)i.set(1,a,a);const o=Go(i.toTensor(),[t,e]);if(null==n)return o;if(1===n.length)return ja(Va(o,0),[n[0],1,1]);if(2===n.length)return ja(Va(Va(o,0),0),[n[0],n[1],1,1]);if(3===n.length)return ja(Va(Va(Va(o,0),0),0),[n[0],n[1],n[2],1,1]);throw new Error(`eye() currently supports only 1D and 2D batchShapes, but received ${n.length}D.`)}const Ga=xi({eye_:Ua});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ha(t,e,n){const s={shape:t,value:e,dtype:n};return ci.runKernel(ge,{},s)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ka(t){const e=bi(t,"x","floor"),n={x:e};return ci.runKernel(be,n)}const Xa=xi({floor_:Ka});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Qa(t,e,n=0,s=0){const i=bi(t,"x","gather"),r=bi(e,"indices","gather","int32"),o={x:i,indices:r},a={axis:n,batchDims:s};return ci.runKernel(xe,o,a)}const Ya=xi({gather_:Qa});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Za(t,e){let n=bi(t,"a","greater"),s=bi(e,"b","greater");[n,s]=ti(n,s),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(ke,i)}const Ja=xi({greater_:Za});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tu(t,e){let n=bi(t,"a","greaterEqual"),s=bi(e,"b","greaterEqual");[n,s]=ti(n,s),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(Se,i)}const eu=xi({greaterEqual_:tu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nu(t,e=.2){const n=bi(t,"x","leakyRelu"),s={x:n},i={alpha:e};return ci.runKernel(Oe,s,i)}const su=xi({leakyRelu_:nu});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iu(t){const e=bi(t,"x","log"),n={x:e};return ci.runKernel(Me,n)}const ru=xi({log_:iu});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ou(t){const e=bi(t,"x","exp"),n={x:e};return ci.runKernel(pe,n)}const au=xi({exp_:ou});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uu(t,e=null,n=!1){const s=bi(t,"x","max"),i={x:s},r={reductionIndices:e,keepDims:n};return ci.runKernel(We,i,r)}const cu=xi({max_:uu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lu(t,e){let n=bi(t,"a","mul"),s=bi(e,"b","mul");[n,s]=ti(n,s);const i={a:n,b:s};return ci.runKernel(nn,i)}const hu=xi({mul_:lu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pu(t,e){let n=bi(t,"a","sub"),s=bi(e,"b","sub");[n,s]=ti(n,s);const i={a:n,b:s};return ci.runKernel(Un,i)}const du=xi({sub_:pu});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fu(t,e=null,n=!1){let s=bi(t,"x","sum");"bool"===s.dtype&&(s=gr(s,"int32"));const i={x:s},r={axis:e,keepDims:n};return ci.runKernel(zn,i,r)}const mu=xi({sum_:fu});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gu(t,e=-1){const n=bi(t,"logits","logSoftmax");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Log Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and axis was ${e}`);const s=mo(((t,n)=>{const s=!0,i=cu(t,e,!0),r=du(t,i),o=du(gr(r,"float32"),ru(mu(au(r),e,s)));n([o]);const a=(t,n)=>{const[s]=n,i=!0,r=au(s);return du(t,hu(mu(t,e,i),r))};return{value:o,gradFunc:a}}));return s(n)}const yu=xi({logSoftmax_:gu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function bu(t,e){const n=bi(t,"a","logicalAnd","bool"),s=bi(e,"b","logicalAnd","bool");La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(Fe,i)}const vu=xi({logicalAnd_:bu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wu(t,e,n,s,i){const r=bi(t,"x","maxPool"),o=1;let a=r,u=!1;3===r.rank&&(u=!0,a=Go(r,[1,r.shape[0],r.shape[1],r.shape[2]])),v(4===a.rank,(()=>`Error in maxPool: input must be rank 4 but got rank ${a.rank}.`)),v(Wo(n,o),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),null!=i&&v(T(s),(()=>`Error in maxPool: pad must be an integer when using, dimRoundingMode ${i} but got pad ${s}.`));const c={x:a},l={filterSize:e,strides:n,pad:s,dimRoundingMode:i},h=ci.runKernel(Ue,c,l);return u?Go(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const xu=xi({maxPool_:wu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _u(t,e=[1,1,1],n,s,i,r="NDHWC",o){null==o?o=[1,1,1]:ro("dilations is deprecated, this field will be gone in v3.0.0.");const a=bi(t,"x","maxPool3d");let u=a,c=!1;4===a.rank&&(c=!0,u=Go(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]])),v(5===u.rank,(()=>`Error in maxPool3d: x must be rank 5 but got rank ${u.rank}.`)),v("NDHWC"===r,(()=>`Error in maxPool3d: Only NDHWC is currently supported, but got dataFormat of ${r}`)),v(Wo(n,o),(()=>`Error in maxPool3d: Either strides or dilations must be 1. Got strides ${n} and dilations '${o}'`)),null!=i&&v(T(s),(()=>`Error in maxPool3d: pad must be an integer when using, dimRoundingMode ${i} but got pad ${s}.`));const l={x:u},h={filterSize:e,strides:n,pad:s,dimRoundingMode:i,dataFormat:r,dilations:o},p=ci.runKernel(He,l,h);return c?Go(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const ku=xi({maxPool3d_:_u});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Su(t,e){let n=bi(t,"a","maximum"),s=bi(e,"b","maximum");[n,s]=ti(n,s),"bool"===n.dtype&&(n=gr(n,"int32"),s=gr(s,"int32")),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(je,i)}const Tu=xi({maximum_:Su});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Iu(t,e=null,n=!1){const s=bi(t,"x","mean"),i={x:s},r={axis:e,keepDims:n};return ci.runKernel(Qe,i,r)}const Cu=xi({mean_:Iu});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Au(t,e=null,n=!1){const s=bi(t,"x","min"),i={x:s},r={axis:e,keepDims:n};return ci.runKernel(Ye,i,r)}const Nu=xi({min_:Au});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Eu(t,e){let n=bi(t,"a","minimum"),s=bi(e,"b","minimum");[n,s]=ti(n,s),"bool"===n.dtype&&(n=gr(n,"int32"),s=gr(s,"int32")),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(Ze,i)}const Ou=xi({minimum_:Eu});
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $u(t,e){for(let n=0;n<t.length;++n)if(t[t.length-n-1]!==e-1-n)return!1;return!0}function Ru(t,e,n){const s=t.length+e.length,i=[];let r=0,o=0;for(let a=0;a<s;a++)-1===n.indexOf(a)?i.push(t[r++]):i.push(e[o++]);return i}function Du(t,e){const n=[],s=t.length;for(let r=0;r<s;r++)-1===e.indexOf(r)&&n.push(t[r]);const i=e.map((e=>t[e]));return[n,i]}function Mu(t,e){const n=e.map((t=>1));return Ru(t,n,e)}function Pu(t,e,n){v($u(e,n),(()=>`${t} supports only inner-most axes for now. Got axes ${e} and rank-${n} input.`))}function Fu(t,e){if($u(t,e))return null;const n=[];for(let s=0;s<e;++s)-1===t.indexOf(s)&&n.push(s);return t.forEach((t=>n.push(t))),n}function Lu(t){return t.map(((t,e)=>[e,t])).sort(((t,e)=>t[1]-e[1])).map((t=>t[0]))}function zu(t,e){const n=[];for(let s=e-t;s<e;++s)n.push(s);return n}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Bu(t){const e=bi(t,"x","square"),n={};return ci.runKernel("Square",{x:e},n)}const qu=xi({square_:Bu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Vu(t,e=null,n=!1){t=bi(t,"x","moments");const s=E(e,t.shape),i=Cu(t,s,n);let r=i.shape;n||(r=Mu(i.shape,s));const o=qu(du(gr(t,"float32"),Go(i,r))),a=Cu(o,s,n);return{mean:i,variance:a}}const Wu=xi({moments_:Vu});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ju(t){const e=bi(t,"x","neg"),n={x:e};return ci.runKernel(sn,n)}const Uu=xi({neg_:ju});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Gu(t,e){let n=bi(t,"a","notEqual"),s=bi(e,"b","notEqual");[n,s]=ti(n,s),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(rn,i)}const Hu=xi({notEqual_:Gu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ku(t,e,n=1,s=0){if(e<2)throw new Error(`Error in oneHot: depth must be >=2, but it is ${e}`);const i=bi(t,"indices","oneHot","int32"),r={indices:i},o={depth:e,onValue:n,offValue:s};return ci.runKernel(ln,r,o)}const Xu=xi({oneHot_:Ku});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Qu(t,e="float32"){if("complex64"===e){const e=Qu(t,"float32"),n=Qu(t,"float32");return ki(e,n)}const n=Q(k(t),e);return ci.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yu(t,e="float32"){if("complex64"===e){const e=Yu(t,"float32"),n=Qu(t,"float32");return ki(e,n)}const n=X(k(t),e);return ci.makeTensor(n,t,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zu(t){const e=bi(t,"x","onesLike"),n={x:e};return ci.runKernel(cn,n)}const Ju=xi({onesLike_:Zu});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tc(t,e,n=0){const s=bi(t,"x","pad");if(0===s.rank)throw new Error("pad(scalar) is not defined. Pass non-scalar to pad");const i={paddings:e,constantValue:n},r={x:s};return ci.runKernel(pn,r,i)}const ec=xi({pad_:tc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nc(t,e){const n=bi(t,"x","prelu"),s=bi(e,"alpha","prelu"),i={x:n,alpha:s};return ci.runKernel(fn,i)}const sc=xi({prelu_:nc});var ic=n(7577);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class rc{constructor(t,e,n,s,i){this.mean=t,this.stdDev=e,this.dtype=n,this.nextVal=NaN,this.truncated=s,this.truncated&&(this.upper=this.mean+2*this.stdDev,this.lower=this.mean-2*this.stdDev);const r=i||Math.random();this.random=ic.alea(r.toString())}nextValue(){if(!isNaN(this.nextVal)){const t=this.nextVal;return this.nextVal=NaN,t}let t,e,n=!1;while(!n){let s,i,r;do{s=2*this.random()-1,i=2*this.random()-1,r=s*s+i*i}while(r>=1||0===r);const o=Math.sqrt(-2*Math.log(r)/r);t=this.mean+this.stdDev*s*o,e=this.mean+this.stdDev*i*o,this.truncated&&!this.isValidTruncated(t)||(n=!0)}return this.truncated&&!this.isValidTruncated(e)||(this.nextVal=this.convertValue(e)),this.convertValue(t)}convertValue(t){return null==this.dtype||"float32"===this.dtype?t:Math.round(t)}isValidTruncated(t){return t<=this.upper&&t>=this.lower}}class oc{constructor(t=0,e=1,n,s){if(this.canReturnFloat=()=>null==this.dtype||"float32"===this.dtype,this.min=t,this.range=e-t,this.dtype=n,null==s&&(s=Math.random()),"number"===typeof s&&(s=s.toString()),!this.canReturnFloat()&&this.range<=1)throw new Error(`The difference between ${t} - ${e} <= 1 and dtype is not float`);this.random=ic.alea(s)}convertValue(t){return this.canReturnFloat()?t:Math.round(t)}nextValue(){return this.convertValue(this.min+this.range*this.random())}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ac(t,e=0,n=1,s,i){if(null!=s&&"bool"===s)throw new Error(`Unsupported data type ${s}`);const r=new rc(e,n,s,!1,i),o=fr(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const uc=xi({randomNormal_:ac});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cc(t,e=0,n=1,s="float32",i){const r=fr(t,s),o=new oc(e,n,null,i);for(let a=0;a<r.values.length;a++)r.values[a]=o.nextValue();return r.toTensor()}const lc=xi({randomUniform_:cc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hc(t){const e=bi(t,"x","relu"),n={x:e};return ci.runKernel(vn,n)}const pc=xi({relu_:hc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dc(t,e){const n=bi(t,"x","reverse"),s={x:n},i={dims:e};return ci.runKernel(In,s,i)}const fc=xi({reverse_:dc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mc(t){const e=bi(t,"x","selu"),n={x:e};return ci.runKernel(On,n)}const gc=xi({selu_:mc});function yc(t,e,n,s,i,r=[1,1],o="NHWC"){const a=bi(t,"x","separableConv2d"),u=bi(e,"depthwiseFilter","separableConv2d"),c=bi(n,"pointwiseFilter","separableConv2d");let l=a,h=!1;if(3===a.rank&&(h=!0,l=Go(a,[1,a.shape[0],a.shape[1],a.shape[2]])),"NCHW"===o)throw new Error("separableConv2d currently does not support dataFormat NCHW; only NHWC is supported");v(4===l.rank,(()=>`Error in separableConv2d: input must be rank 4, but got rank ${l.rank}.`)),v(4===u.rank,(()=>`Error in separableConv2d: depthwise filter must be rank 4, but got rank ${u.rank}.`)),v(4===c.rank,(()=>`Error in separableConv2d: pointwise filter must be rank 4, but got rank ${u.rank}.`)),v(1===c.shape[0],(()=>`Error in separableConv2d: the first dimension of pointwise filter  must be 1, but got ${c.shape[0]}.`)),v(1===c.shape[1],(()=>`Error in separableConv2d: the second dimension of pointwise filter must be 1, but got ${c.shape[1]}.`));const p=u.shape[2],d=u.shape[3];v(c.shape[2]===p*d,(()=>`Error in separableConv2d: the third dimension of pointwise filter must be ${p*d}, but got ${c.shape[2]}.`));const f=Na(l,u,s,i,o,r),m=1,g=va(f,c,m,"valid",o);return h?Go(g,[g.shape[1],g.shape[2],g.shape[3]]):g}const bc=xi({separableConv2d_:yc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vc(t){const e=bi(t,"x","sigmoid"),n={x:e};return ci.runKernel(Pn,n)}const wc=xi({sigmoid_:vc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xc(t,e,n){const s=bi(t,"x","slice","string_or_numeric");if(0===s.rank)throw new Error("Slicing scalar is not possible");const i={x:s},r={begin:e,size:n};return ci.runKernel($n,i,r)}const _c=xi({slice_:xc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kc(t,e,n){const s=bi(t,"x","slice1d");return v(1===s.rank,(()=>`slice1d expects a rank-1 tensor, but got a rank-${s.rank} tensor`)),_c(s,[e],[n])}const Sc=xi({slice1d_:kc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Tc(t,e,n){const s=bi(t,"x","slice2d");return v(2===s.rank,(()=>`slice2d expects a rank-2 tensor, but got a rank-${s.rank} tensor`)),_c(s,e,n)}const Ic=xi({slice2d_:Tc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Cc(t,e,n){const s=bi(t,"x","slice3d");return v(3===s.rank,(()=>`slice3d expects a rank-3 tensor, but got a rank-${s.rank} tensor`)),_c(s,e,n)}const Ac=xi({slice3d_:Cc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Nc(t,e,n){const s=bi(t,"x","slice4d");return v(4===s.rank,(()=>`slice4d expects a rank-4 tensor, but got a rank-${s.rank} tensor`)),_c(s,e,n)}const Ec=xi({slice4d_:Nc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Oc(t,e=-1){const n=bi(t,"logits","softmax","float32");if(-1===e&&(e=n.rank-1),e!==n.rank-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${n.rank} and dim was ${e}`);const s={logits:n},i={dim:e};return ci.runKernel(Vn,s,i)}const $c=xi({softmax_:Oc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Rc(t){const e=bi(t,"x","softplus"),n={x:e};return ci.runKernel(Fn,n)}const Dc=xi({softplus_:Rc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Mc(t,e,n=0){const s=bi(t,"x","split"),i={x:s},r={numOrSizeSplits:e,axis:n};return ci.runKernel(qn,i,r)}const Pc=xi({split_:Mc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fc(t){const e=bi(t,"x","sqrt"),n={x:e};return ci.runKernel(Ln,n)}const Lc=xi({sqrt_:Fc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zc(t,e){const n=bi(t,"x","squeeze");return Go(n,O(n.shape,e).newShape)}const Bc=xi({squeeze_:zc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qc(t,e=0){const n=vi(t,"tensors","stack","string_or_numeric");v(n.length>=1,(()=>"Pass at least one tensor to tf.stack")),n.length>0&&v(e<=n[0].rank,(()=>"Axis must be <= rank of the tensor"));const s=n,i={axis:e};return ci.runKernel(hn,s,i)}const Vc=xi({stack_:qc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wc(t){const e=bi(t,"x","tanh"),n={x:e};return ci.runKernel(Xn,n)}const jc=xi({tanh_:Wc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Uc(t,e){x(t);const n=mi(t,e);if(1!==n.length)throw new Error("tensor1d() requires values to be a flat/TypedArray");const s=null;return Si(t,s,n,e)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Gc(t,e,n){if(x(t),null!=e&&2!==e.length)throw new Error("tensor2d() requires shape to have two numbers");const s=mi(t,n);if(2!==s.length&&1!==s.length)throw new Error("tensor2d() requires values to be number[][] or flat/TypedArray");if(1===s.length&&null==e)throw new Error("tensor2d() requires shape to be provided when `values` are a flat/TypedArray");return Si(t,e,s,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hc(t,e=0,n=1,s,i){if(null!=s&&"bool"===s)throw new Error("Unsupported data type $ { dtype }");const r=new rc(e,n,s,!0,i),o=fr(t,s);for(let a=0;a<o.values.length;a++)o.values[a]=r.nextValue();return o.toTensor()}const Kc=xi({truncatedNormal_:Hc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xc(t,e=0){const n=bi(t,"x","unstack","string_or_numeric");v(e>=-n.shape.length&&e<n.shape.length,(()=>`Axis = ${e} is not in [-${n.shape.length}, ${n.shape.length})`));const s={value:n},i={axis:e};return ci.runKernel(ts,s,i)}const Qc=xi({unstack_:Xc});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yc(t,e=!0,n,s){return ci.makeVariable(t,e,n,s)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zc(t,e){let n=bi(t,"broadcastTo","x");const s=n.shape;if(e.some((t=>!(t>0)||t%1!==0)))throw new Error(`broadcastTo(): Invalid broadcast shape [${e}].`);if(e.length<n.rank)throw new Error(`broadcastTo(): shape.length=${e.length} < input.rank=${n.rank}.`);if(e.length>n.rank){const t=n.shape.slice();while(t.length<e.length)t.unshift(1);n=Go(n,t)}const i=n.shape,r=Array.from(e);for(let c=e.length-1;c>=0;c--)if(i[c]===e[c])r[c]=1;else if(1!==n.shape[c])throw new Error(`broadcastTo(): [${s}] cannot be broadcast to [${e}].`);const o=r.map(((t,e)=>t>1?e:-1)).filter((t=>t>=0));if(0===o.length)return br(n);const a={x:n},u={reps:r};return ci.runKernel(Qn,a,u)}const Jc=xi({broadcastTo_:Zc});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tl(t,e,n){const s=bi(e,"a","where"),i=bi(n,"b","where"),r=bi(t,"condition","where","bool"),o=La(s.shape,i.shape),a=Jc(s,o),u=Jc(i,o);1===r.rank&&v(r.shape[0]===s.shape[0],(()=>"The first dimension of `a` must match the size of `condition`.")),1!==r.rank&&w(r.shape,u.shape,"Error in where: ");const c={condition:r,t:a,e:u};return ci.runKernel(En,c)}const el=xi({where_:tl});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nl(t){const e=bi(t,"x","zerosLike"),n={x:e};return ci.runKernel(ns,n)}const sl=xi({zerosLike_:nl});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function il(t,e){const n=bi(t,"x","transpose");if(null==e&&(e=n.shape.map(((t,e)=>e)).reverse()),v(n.rank===e.length,(()=>`Error in transpose: rank of input ${n.rank} must match length of perm ${e}.`)),e.forEach((t=>{v(t>=0&&t<n.rank,(()=>"All entries in 'perm' must be between 0 and "+(n.rank-1)+` but got ${e}`))})),n.rank<=1)return n.clone();const s={x:n},i={perm:e};return ci.runKernel(Zn,s,i)}const rl=xi({transpose_:il});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ol(t,e){if(null==e)return t.shape.slice();if(S(t.shape,e))return e;if(t.shape.length===e.length){const n=[];for(let s=0;s<t.shape.length;s++)null==e[s]&&null!=t.shape[s]?n.push(t.shape[s]):n.push(e[s]);return n}return e}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function al(t,e,n,s){const i=bi(t,"x","dropout");if(v("float32"===i.dtype,(()=>`x has to be a floating point tensor since it's going to be scaled, but got a ${i.dtype} tensor instead.`)),v(e>=0&&e<1,(()=>`rate must be a float in the range [0, 1), but got ${e}.`)),0===e)return t instanceof js?i.clone():i;const r=ol(i,n),o=1-e,a=Ra(Xa(xo(lc(r,0,1,"float32",s),o)),o);return hu(i,a)}const ul=xi({dropout_:al});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cl(t){const e=bi(t,"input","imag"),n={input:e};return ci.runKernel(Ce,n)}const ll=xi({imag_:cl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hl(t){const e=bi(t,"input","real"),n={input:e};return ci.runKernel(yn,n)}const pl=xi({real_:hl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dl(t){v("complex64"===t.dtype,(()=>`The dtype for tf.spectral.fft() must be complex64 but got ${t.dtype}.`));const e={input:t};return ci.runKernel(me,e)}const fl=xi({fft_:dl});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ml(t,e){v("float32"===t.dtype,(()=>`The dtype for rfft() must be real value but got ${t.dtype}`));let n=t.shape[t.shape.length-1];const s=t.size/n;let i;if(null!=e&&e<n){const s=t.shape.map((t=>0)),r=t.shape.map((t=>t));r[t.shape.length-1]=e,i=_c(t,s,r),n=e}else if(null!=e&&e>n){const s=t.shape.map((t=>t));s[t.shape.length-1]=e-n,i=ca([t,Qu(s)],t.shape.length-1),n=e}else i=t;const r=sl(i),o=Go(ki(i,r),[s,n]),a=fl(o),u=Math.floor(n/2)+1,c=pl(a),l=ll(a),h=Pc(c,[u,n-u],c.shape.length-1),p=Pc(l,[u,n-u],l.shape.length-1),d=i.shape.slice();return d[i.shape.length-1]=u,Go(ki(h[0],p[0]),d)}const gl=xi({rfft_:ml});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yl(t){v("complex64"===t.dtype,(()=>`The dtype for tf.spectral.ifft() must be complex64 but got ${t.dtype}.`));const e={input:t};return ci.runKernel(Ie,e)}const bl=xi({ifft_:yl});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vl(t){const e=t.shape[t.shape.length-1],n=t.size/e;let s;if(e<=2){const i=Go(t,[n,e]);s=bl(i)}else{const i=[n,2*(e-1)],r=Go(pl(t),[n,e]),o=Go(ll(t),[n,e]),a=fc(_c(r,[0,1],[n,e-2]),1),u=hu(fc(_c(o,[0,1],[n,e-2]),1),go(-1)),c=ca([r,a],1),l=ca([o,u],1),h=Go(ki(c,l),[i[0],i[1]]);s=bl(h)}if(s=pl(s),3===t.rank&&0!==t.shape[0]){const e=s,n=t.shape[0];s=Go(s,[n,s.shape[0]/n,s.shape[1]]),e.dispose()}return s}const wl=xi({irfft_:vl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xl(t,e,n,s,i,r="NHWC",o){let a=t;3===t.rank&&(a=Go(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=Go(e,[1,e.shape[0],e.shape[1],e.shape[2]])),v(4===a.rank,(()=>`Error in conv2dDerFilter: input must be rank 4, but got shape ${a.shape}.`)),v(4===u.rank,(()=>`Error in conv2dDerFilter: dy must be rank 4, but got shape ${u.shape}.`)),v(4===n.length,(()=>`Error in conv2dDerFilter: filterShape must be length 4, but got ${n}.`));const c="NHWC"===r?a.shape[3]:a.shape[1],l="NHWC"===r?u.shape[3]:u.shape[1];v(c===n[2],(()=>`Error in conv2dDerFilter: depth of input ${c}) must match input depth in filter (${n[2]}.`)),v(l===n[3],(()=>`Error in conv2dDerFilter: depth of dy (${l}) must match output depth for filter (${n[3]}).`)),null!=o&&v(T(i),(()=>`Error in conv2dDerFilter: pad must be an integer when using, dimRoundingMode ${o} but got pad ${i}.`));const h={x:a,dy:u},p={strides:s,pad:i,dataFormat:r,dimRoundingMode:o,filterShape:n};return ci.runKernel(Wt,h,p)}const _l=xi({conv2DBackpropFilter_:xl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kl(t){const e=bi(t,"x","relu6"),n={x:e};return ci.runKernel(Tn,n)}const Sl=xi({relu6_:kl});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Tl(t,e=0){const n=bi(t,"x","step"),s={x:n},i={alpha:e};return ci.runKernel(ss,s,i)}const Il=xi({step_:Tl});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Cl(t,e,n){if(null==n||"linear"===n)return t;if("relu"===n)return hu(t,Il(e));throw new Error(`Cannot compute gradient for fused activation ${n}.`)}function Al(t,e){let n=e;const s=Fa(t.shape,e.shape);return s.length>0&&(n=mu(n,s)),Go(n,t.shape)}function Nl(t,e,n,s){if("linear"===e)return t;if("relu"===e)return pc(t);if("elu"===e)return Ma(t);if("relu6"===e)return Sl(t);if("prelu"===e)return sc(t,n);if("leakyrelu"===e)return su(t,s);throw new Error(`Unknown fused activation ${e}.`)}const El=(t,e)=>{const n=t>0;return!n||"linear"===e};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ol({x:t,filter:e,strides:n,pad:s,dataFormat:i="NHWC",dilations:r=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(u=u||"linear",!1===El(ci.state.gradientDepth,u)){let h=va(t,e,n,s,i,r,o);return null!=a&&(h=xo(h,a)),Nl(h,u,c,l)}const h=bi(t,"x","conv2d"),p=bi(e,"filter","conv2d");let d=h,f=!1;3===h.rank&&(f=!0,d=Go(h,[1,h.shape[0],h.shape[1],h.shape[2]])),v(4===d.rank,(()=>`Error in fused conv2d: input must be rank 4, but got rank ${d.rank}.`)),v(4===p.rank,(()=>`Error in fused conv2d: filter must be rank 4, but got rank ${p.rank}.`)),null!=o&&v(T(s),(()=>`Error in fused conv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${s}.`)),v(d.shape[3]===p.shape[2],(()=>`Error in conv2d: depth of input (${d.shape[3]}) must match input depth for filter ${p.shape[2]}.`)),v(Wo(n,r),(()=>`Error in conv2D: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`)),v("NHWC"===i,(()=>`Error in conv2d: got dataFormat of ${i} but only NHWC is currently supported.`));const m=Oo(d.shape,p.shape,n,r,s,o);let g,y;null!=a&&(g=bi(a,"bias","fused conv2d"),[g]=ti(g,h),La(m.outShape,g.shape)),null!=c&&(y=bi(c,"prelu weights","fused conv2d"));const b=(t,e)=>{const[i,o,a,c]=e,l=Cl(t,a,u);v(Vo(r),(()=>`Error in gradient of fused conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`));const h=ka(o.shape,l,i,n,s),p=_l(o,l,i.shape,n,s),d=[h,p];if(null!=c){const t=Al(c,l);d.push(t)}return d},w={x:d,filter:p,bias:g,preluActivationWeights:y},x={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o,activation:u,leakyreluAlpha:l};if(null==a){const t=mo(((t,e,n)=>{let s=ci.runKernel(as,w,x);return n([e,t,s]),f&&(s=Go(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(d,p)}{const t=mo(((t,e,n,s)=>{let i=ci.runKernel(as,w,x);return s([e,t,i,n]),f&&(i=Go(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}));return t(d,p,g)}}const $l=xi({fusedConv2d_:Ol});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Rl(t,e,n,s,i,r=[1,1],o){let a=t;3===t.rank&&(a=Go(t,[1,t.shape[0],t.shape[1],t.shape[2]]));let u=e;3===u.rank&&(u=Go(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={x:a,dy:u},l={strides:s,pad:i,dimRoundingMode:o,dilations:r,filterShape:n};return ci.runKernel(ee,c,l)}const Dl=xi({depthwiseConv2dNativeBackpropFilter_:Rl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ml(t,e,n,s,i,r=[1,1],o){let a=e,u=!1;3===e.rank&&(u=!0,a=Go(e,[1,e.shape[0],e.shape[1],e.shape[2]]));const c={dy:a,filter:n},l={strides:s,pad:i,dimRoundingMode:o,dilations:r,inputShape:t},h=ci.runKernel(ne,c,l);return u?Go(h,[h.shape[1],h.shape[2],h.shape[3]]):h}const Pl=xi({depthwiseConv2dNativeBackpropInput_:Ml});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fl({x:t,filter:e,strides:n,pad:s,dataFormat:i="NHWC",dilations:r=[1,1],dimRoundingMode:o,bias:a,activation:u="linear",preluActivationWeights:c,leakyreluAlpha:l}){if(!1===El(ci.state.gradientDepth,u)){let h=Na(t,e,n,s,i,r,o);return null!=a&&(h=xo(h,a)),Nl(h,u,c,l)}const h=bi(t,"x","depthwiseConv2d"),p=bi(e,"filter","depthwiseConv2d");let d=h,f=!1;3===h.rank&&(f=!0,d=Go(h,[1,h.shape[0],h.shape[1],h.shape[2]])),v(4===d.rank,(()=>`Error in fused depthwiseConv2d: input must be rank 4, but got rank ${d.rank}.`)),v(4===p.rank,(()=>`Error in fused depthwiseConv2d: filter must be rank 4, but got rank ${p.rank}.`)),v(d.shape[3]===p.shape[2],(()=>`Error in fused depthwiseConv2d: number of input channels (${d.shape[3]}) must match the inChannels dimension in filter ${p.shape[2]}.`)),null==r&&(r=[1,1]),v(Wo(n,r),(()=>`Error in fused depthwiseConv2d: Either strides or dilations must be 1. Got strides ${n} and dilations '${r}'`)),null!=o&&v(T(s),(()=>`Error in fused depthwiseConv2d: pad must be an integer when using dimRoundingMode ${o} but got pad ${s}.`));const m=Oo(d.shape,p.shape,n,r,s,o,!0);let g,y;null!=a&&(g=bi(a,"bias","fused conv2d"),[g]=ti(g,h),La(m.outShape,g.shape)),null!=c&&(y=bi(c,"prelu weights","fused depthwiseConv2d"));const b=(t,e)=>{v(Vo(r),(()=>`Error in gradient of fused depthwiseConv2d: dilation rates greater than 1 are not yet supported. Got dilations '${r}'`));const[i,a,c,l]=e,h=Cl(t,c,u),p=Pl(a.shape,h,i,n,s,r,o),d=Dl(a,h,i.shape,n,s,r,o);if(null!=l){const t=Al(g,h);return[p,d,t]}return[p,d]},w={x:d,filter:p,bias:g,preluActivationWeights:y},x={strides:n,pad:s,dataFormat:i,dilations:r,dimRoundingMode:o,activation:u,leakyreluAlpha:l};if(null==a){const t=mo(((t,e,n)=>{let s=ci.runKernel(us,w,x);return n([e,t,s]),f&&(s=Go(s,[s.shape[1],s.shape[2],s.shape[3]])),{value:s,gradFunc:b}}));return t(d,p)}{const t=mo(((t,e,n,s)=>{let i=ci.runKernel(us,w,x);return s([e,t,i,n]),f&&(i=Go(i,[i.shape[1],i.shape[2],i.shape[3]])),{value:i,gradFunc:b}}));return t(d,p,g)}}xi({fusedDepthwiseConv2d_:Fl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ll(t,e,n=!1,s=!1){let i=bi(t,"a","matMul"),r=bi(e,"b","matMul");[i,r]=ti(i,r);const o={a:i,b:r},a={transposeA:n,transposeB:s};return ci.runKernel($t,o,a)}const zl=xi({matMul_:Ll});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Bl({a:t,b:e,transposeA:n=!1,transposeB:s=!1,bias:i,activation:r="linear",preluActivationWeights:o,leakyreluAlpha:a}){if(!1===El(ci.state.gradientDepth,r)){let u=zl(t,e,n,s);return null!=i&&(u=xo(u,i)),Nl(u,r,o,a)}let u=bi(t,"a","fused matMul"),c=bi(e,"b","fused matMul");[u,c]=ti(u,c);const l=n?u.shape[u.rank-2]:u.shape[u.rank-1],h=s?c.shape[c.rank-1]:c.shape[c.rank-2],p=n?u.shape[u.rank-1]:u.shape[u.rank-2],d=s?c.shape[c.rank-2]:c.shape[c.rank-1],f=u.shape.slice(0,-2),m=c.shape.slice(0,-2),g=k(f),y=k(m);v(u.rank>=2&&c.rank>=2&&u.rank===c.rank,(()=>`Error in fused matMul: inputs must have the same rank of at least 2, got ranks ${u.rank} and ${c.rank}.`)),v(S(f,m),(()=>`Error in fused matMul: outer dimensions (${f}) and (${m}) of Tensors with shapes ${u.shape} and ${c.shape} must match.`)),v(l===h,(()=>`Error in fused matMul: inner shapes (${l}) and (${h}) of Tensors with shapes ${u.shape} and ${c.shape} and transposeA=${n} and transposeB=${s} must match.`));const b=u.shape.slice(0,-2).concat([p,d]),w=Go(u,n?[g,l,p]:[g,p,l]),x=Go(c,s?[y,d,h]:[y,h,d]);let _,T;null!=i&&(_=bi(i,"bias","fused matMul"),[_]=ti(_,u),La(b,_.shape)),null!=o&&(T=bi(o,"prelu weights","fused matMul"));const I=(t,e)=>{const[o,a,u,c]=e,l=Cl(Go(t,u.shape),u,r);let h,p;if(n||s?!n&&s?(h=zl(l,a,!1,!1),p=zl(l,o,!0,!1)):n&&!s?(h=zl(a,l,!1,!0),p=zl(o,l,!1,!1)):(h=zl(a,l,!0,!0),p=zl(l,o,!0,!0)):(h=zl(l,a,!1,!0),p=zl(o,l,!0,!1)),null!=i){const t=Al(c,l);return[h,p,t]}return[h,p]},C={a:w,b:x,bias:_,preluActivationWeights:T},A={transposeA:n,transposeB:s,activation:r,leakyreluAlpha:a};if(null==i){const t=mo(((t,e,n)=>{const s=ci.runKernel(os,C,A);return n([t,e,s]),{value:Go(s,b),gradFunc:I}}));return t(w,x)}{const t=mo(((t,e,n,s)=>{const i=ci.runKernel(os,C,A);return s([t,e,i,n]),{value:Go(i,b),gradFunc:I}}));return t(w,x,_)}}const ql=xi({fusedMatMul_:Bl});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Vl(t){return Math.floor(Math.pow(2,Math.ceil(Math.log(t)/Math.log(2))))}function Wl(t,e,n){const s=1-t%2,i=new Float32Array(t);for(let r=0;r<t;++r){const o=2*Math.PI*r/(t+s-1);i[r]=e-n*Math.cos(o)}return Uc(i,"float32")}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jl(t){return Wl(t,.54,.46)}xi({hammingWindow_:jl});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ul(t){return Wl(t,.5,.5)}const Gl=xi({hannWindow_:Ul});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hl(t,e,n,s=!1,i=0){let r=0;const o=[];while(r+e<=t.size)o.push(_c(t,r,e)),r+=n;if(s)while(r<t.size){const s=r+e-t.size,a=ca([_c(t,r,e-s),Ha([s],i)]);o.push(a),r+=n}return 0===o.length?Gc([],[0,e]):Go(ca(o),[o.length,e])}const Kl=xi({frame_:Hl});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xl(t,e,n,s,i=Gl){null==s&&(s=Vl(e));const r=Kl(t,e,n),o=hu(r,i(e)),a=[];for(let u=0;u<r.shape[0];u++)a.push(gl(_c(o,[u,0],[1,e]),s));return ca(a)}xi({stft_:Xl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ql(t,e,n,s,i="bilinear",r=0){const o=bi(t,"image","cropAndResize"),a=bi(e,"boxes","cropAndResize","float32"),u=bi(n,"boxInd","cropAndResize","int32"),c=a.shape[0];v(4===o.rank,(()=>`Error in cropAndResize: image must be rank 4,but got rank ${o.rank}.`)),v(2===a.rank&&4===a.shape[1],(()=>`Error in cropAndResize: boxes must be have size [${c},4] but had shape ${a.shape}.`)),v(1===u.rank&&u.shape[0]===c,(()=>`Error in cropAndResize: boxInd must be have size [${c}] but had shape ${a.shape}.`)),v(2===s.length,(()=>`Error in cropAndResize: cropSize must be of length 2, but got length ${s.length}.`)),v(s[0]>=1&&s[1]>=1,(()=>`cropSize must be atleast [1,1], but was ${s}`)),v("bilinear"===i||"nearest"===i,(()=>`method must be bilinear or nearest, but was ${i}`));const l={image:o,boxes:a,boxInd:u},h={method:i,extrapolationValue:r,cropSize:s},p=ci.runKernel(Yt,l,h);return p}xi({cropAndResize_:Ql});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yl(t){const e=bi(t,"image","flipLeftRight","float32");v(4===e.rank,(()=>`Error in flipLeftRight: image must be rank 4,but got rank ${e.rank}.`));const n={image:e},s=ci.runKernel(ye,n,{});return s}xi({flipLeftRight_:Yl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Zl(t,e,n=0,s=.5){const i=bi(t,"image","rotateWithOffset","float32");v(4===i.rank,(()=>`Error in rotateWithOffset: image must be rank 4,but got rank ${i.rank}.`));const r={image:i},o={radians:e,fillValue:n,center:s},a=ci.runKernel(rs,r,o);return a}xi({rotateWithOffset_:Zl});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Jl(t,e,n,s,i,r){null==s&&(s=.5),null==i&&(i=Number.NEGATIVE_INFINITY),null==r&&(r=0);const o=t.shape[0];return n=Math.min(n,o),v(0<=s&&s<=1,(()=>`iouThreshold must be in [0, 1], but was '${s}'`)),v(2===t.rank,(()=>`boxes must be a 2D tensor, but was of rank '${t.rank}'`)),v(4===t.shape[1],(()=>`boxes must have 4 columns, but 2nd dimension was ${t.shape[1]}`)),v(1===e.rank,(()=>"scores must be a 1D tensor")),v(e.shape[0]===o,(()=>`scores has incompatible shape with boxes. Expected ${o}, but was ${e.shape[0]}`)),v(0<=r&&r<=1,(()=>`softNmsSigma must be in [0, 1], but was '${r}'`)),{maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:r}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function th(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY){const r=bi(t,"boxes","nonMaxSuppression"),o=bi(e,"scores","nonMaxSuppression"),a=Jl(r,o,n,s,i);n=a.maxOutputSize,s=a.iouThreshold,i=a.scoreThreshold;const u={maxOutputSize:n,iouThreshold:s,scoreThreshold:i};return ci.runKernel(on,{boxes:r,scores:o},u)}xi({nonMaxSuppression_:th});
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function eh(t,e,n){const s=nh(t,e,n),i=s<0?-(s+1):s;t.splice(i,0,e)}function nh(t,e,n){return ih(t,e,n||sh)}function sh(t,e){return t>e?1:t<e?-1:0}function ih(t,e,n){let s=0,i=t.length,r=0,o=!1;while(s<i){r=s+(i-s>>>1);const a=n(e,t[r]);a>0?s=r+1:(i=r,o=!a)}return o?s:-s-1}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rh(t,e,n,s,i){return uh(t,e,n,s,i,0)}function oh(t,e,n,s,i,r){return uh(t,e,n,s,i,0,!1,r,!0)}function ah(t,e,n,s,i,r){return uh(t,e,n,s,i,r,!0)}function uh(t,e,n,s,i,r,o=!1,a=!1,u=!1){const c=[];for(let g=0;g<e.length;g++)e[g]>i&&c.push({score:e[g],boxIndex:g,suppressBeginIndex:0});c.sort(hh);const l=r>0?-.5/r:0,h=[],p=[];while(h.length<n&&c.length>0){const e=c.pop(),{score:n,boxIndex:r,suppressBeginIndex:o}=e;if(n<i)break;let a=!1;for(let u=h.length-1;u>=o;--u){const n=ch(t,r,h[u]);if(n>=s){a=!0;break}if(e.score=e.score*lh(s,l,n),e.score<=i)break}e.suppressBeginIndex=h.length,a||(e.score===n?(h.push(r),p.push(e.score)):e.score>i&&eh(c,e,hh))}const d=h.length,f=n-d;a&&f>0&&(h.push(...new Array(f).fill(0)),p.push(...new Array(f).fill(0)));const m={selectedIndices:h};return o&&(m["selectedScores"]=p),u&&(m["validOutputs"]=d),m}function ch(t,e,n){const s=t.subarray(4*e,4*e+4),i=t.subarray(4*n,4*n+4),r=Math.min(s[0],s[2]),o=Math.min(s[1],s[3]),a=Math.max(s[0],s[2]),u=Math.max(s[1],s[3]),c=Math.min(i[0],i[2]),l=Math.min(i[1],i[3]),h=Math.max(i[0],i[2]),p=Math.max(i[1],i[3]),d=(a-r)*(u-o),f=(h-c)*(p-l);if(d<=0||f<=0)return 0;const m=Math.max(r,c),g=Math.max(o,l),y=Math.min(a,h),b=Math.min(u,p),v=Math.max(y-m,0)*Math.max(b-g,0);return v/(d+f-v)}function lh(t,e,n){const s=Math.exp(e*n*n);return n<=t?s:0}function hh(t,e){return t.score-e.score||t.score===e.score&&e.boxIndex-t.boxIndex}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ph(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=0){const o=bi(t,"boxes","nonMaxSuppression"),a=bi(e,"scores","nonMaxSuppression"),u=Jl(o,a,n,s,i,r);n=u.maxOutputSize,s=u.iouThreshold,i=u.scoreThreshold,r=u.softNmsSigma;const c={boxes:o,scores:a},l={maxOutputSize:n,iouThreshold:s,scoreThreshold:i,softNmsSigma:r},h=ci.runKernel(un,c,l);return{selectedIndices:h[0],selectedScores:h[1]}}xi({nonMaxSuppressionWithScore_:ph});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dh(t,e,n,s=.5,i=Number.NEGATIVE_INFINITY,r=!1){const o=bi(t,"boxes","nonMaxSuppression"),a=bi(e,"scores","nonMaxSuppression"),u=Jl(o,a,n,s,i,null),c=u.maxOutputSize,l=u.iouThreshold,h=u.scoreThreshold,p={boxes:o,scores:a},d={maxOutputSize:c,iouThreshold:l,scoreThreshold:h,padToMaxOutputSize:r},f=ci.runKernel(an,p,d);return{selectedIndices:f[0],validOutputs:f[1]}}xi({nonMaxSuppressionPadded_:dh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fh(t,e,n=!1,s=!1){const i=bi(t,"images","resizeBilinear");v(3===i.rank||4===i.rank,(()=>`Error in resizeBilinear: x must be rank 3 or 4, but got rank ${i.rank}.`)),v(2===e.length,(()=>`Error in resizeBilinear: new shape must 2D, but got shape ${e}.`)),v(!1===s||!1===n,(()=>"Error in resizeBilinear: If halfPixelCenters is true, alignCorners must be false."));let r=i,o=!1;3===i.rank&&(o=!0,r=Go(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=e,a={images:r},u={alignCorners:n,halfPixelCenters:s,size:e},c=ci.runKernel(kn,a,u);return o?Go(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const mh=xi({resizeBilinear_:fh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gh(t,e,n=!1,s=!1){const i=bi(t,"images","resizeNearestNeighbor");v(3===i.rank||4===i.rank,(()=>`Error in resizeNearestNeighbor: x must be rank 3 or 4, but got rank ${i.rank}.`)),v(2===e.length,(()=>`Error in resizeNearestNeighbor: new shape must 2D, but got shape ${e}.`)),v("float32"===i.dtype||"int32"===i.dtype,(()=>"`images` must have `int32` or `float32` as dtype")),v(!1===s||!1===n,(()=>"Error in resizeNearestNeighbor: If halfPixelCenters is true, alignCorners must be false."));let r=i,o=!1;3===i.rank&&(o=!0,r=Go(i,[1,i.shape[0],i.shape[1],i.shape[2]]));const[]=e,a={images:r},u={alignCorners:n,halfPixelCenters:s,size:e},c=ci.runKernel(xn,a,u);return o?Go(c,[c.shape[1],c.shape[2],c.shape[3]]):c}const yh=xi({resizeNearestNeighbor_:gh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function bh(t,e){let n=bi(t,"a","lessEqual"),s=bi(e,"b","lessEqual");[n,s]=ti(n,s),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(Re,i)}const vh=xi({lessEqual_:bh});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wh(t,e,n=1,s="float32"){if(0===n)throw new Error("Cannot have a step of zero");const i={start:t,stop:e,step:n,dtype:s};return ci.runKernel(gn,{},i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xh(t,e,n){v(e%1===0,(()=>`bandPart(): numLower must be an integer, got ${e}.`)),v(n%1===0,(()=>`bandPart(): numUpper must be an integer, got ${n}.`));const s=bi(t,"a","bandPart");v(s.rank>=2,(()=>`bandPart(): Rank must be at least 2, got ${s.rank}.`));const i=s.shape,[r,o]=s.shape.slice(-2);if(!(e<=r))throw new Error(`bandPart(): numLower (${e}) must not be greater than the number of rows (${r}).`);if(!(n<=o))throw new Error(`bandPart(): numUpper (${n}) must not be greater than the number of columns (${o}).`);e<0&&(e=r),n<0&&(n=o);const a=Go(wh(0,r,1,"int32"),[-1,1]),u=wh(0,o,1,"int32"),c=du(a,u),l=vu(vh(c,go(+e,"int32")),eu(c,go(-n,"int32"))),h=Qu([r,o],s.dtype);return Go(Vc(Qc(Go(s,[-1,r,o])).map((t=>el(l,t,h)))),i)}const _h=xi({bandPart_:xh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kh(t,e){let n=bi(t,"base","pow"),s=bi(e,"exp","pow");[n,s]=ti(n,s);const i={a:n,b:s};return ci.runKernel(dn,i)}const Sh=xi({pow_:kh});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Th(t,e="euclidean",n=null,s=!1){t=bi(t,"x","norm");const i=Ih(t,e,n);let r=i.shape;if(s){const e=E(n,t.shape);r=Mu(i.shape,e)}return Go(i,r)}function Ih(t,e,n=null){if(0===t.rank)return vo(t);if(1!==t.rank&&null===n)return Ih(Go(t,[-1]),e,n);if(1===t.rank||"number"===typeof n||Array.isArray(n)&&1===n.length){if(1===e)return mu(vo(t),n);if(e===1/0)return cu(vo(t),n);if(e===-1/0)return Nu(vo(t),n);if("euclidean"===e||2===e)return Lc(mu(Sh(vo(t),go(2,"int32")),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}if(Array.isArray(n)&&2===n.length){if(1===e)return cu(mu(vo(t),n[0]),n[1]-1);if(e===1/0)return cu(mu(vo(t),n[1]),n[0]);if(e===-1/0)return Nu(mu(vo(t),n[1]),n[0]);if("fro"===e||"euclidean"===e)return Lc(mu(qu(t),n));throw new Error(`Error in norm: invalid ord value: ${e}`)}throw new Error(`Error in norm: invalid axis: ${n}`)}const Ch=xi({norm_:Th});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ah(t){let e;if(Array.isArray(t)){e=!1,v(null!=t&&t.length>0,(()=>"Gram-Schmidt process: input must not be null, undefined, or empty"));const n=t[0].shape[0];for(let e=1;e<t.length;++e)v(t[e].shape[0]===n,(()=>`Gram-Schmidt: Non-unique lengths found in the input vectors: (${t[e].shape[0]} vs. ${n})`))}else e=!0,t=Pc(t,t.shape[0],0).map((t=>Bc(t,[0])));v(t.length<=t[0].shape[0],(()=>`Gram-Schmidt: Number of vectors (${t.length}) exceeds number of dimensions (${t[0].shape[0]}).`));const n=[],s=t;for(let i=0;i<t.length;++i)n.push(ci.tidy((()=>{let t=s[i];if(i>0)for(let e=0;e<i;++e){const s=hu(mu(hu(n[e],t)),n[e]);t=du(t,s)}return Ra(t,Ch(t,"euclidean"))})));return e?Vc(n,0):n}const Nh=xi({gramSchmidt_:Ah});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Eh(t,e=!1){if(v(t.rank>=2,(()=>`qr() requires input tensor to have a rank >= 2, but got rank ${t.rank}`)),2===t.rank)return Oh(t,e);{const n=t.shape.slice(0,t.shape.length-2).reduce(((t,e)=>t*e)),s=Qc(Go(t,[n,t.shape[t.shape.length-2],t.shape[t.shape.length-1]]),0),i=[],r=[];s.forEach((t=>{const[n,s]=Oh(t,e);i.push(n),r.push(s)}));const o=Go(Vc(i,0),t.shape),a=Go(Vc(r,0),t.shape);return[o,a]}}function Oh(t,e=!1){return ci.tidy((()=>{v(2===t.shape.length,(()=>`qr2d() requires a 2D Tensor, but got a ${t.shape.length}D Tensor.`));const n=t.shape[0],s=t.shape[1];let i=Ga(n),r=br(t);const o=Gc([[1]],[1,1]);let a=br(o);const u=n>=s?s:n;for(let t=0;t<u;++t){const e=r,u=a,c=i;[a,r,i]=ci.tidy((()=>{const e=_c(r,[t,t],[n-t,1]),u=Ch(e),c=_c(r,[t,t],[1,1]),l=el(Ja(c,0),Gc([[-1]]),Gc([[1]])),h=du(c,hu(l,u)),p=Ra(e,h);a=1===p.shape[0]?br(o):ca([o,_c(p,[1,0],[p.shape[0]-1,p.shape[1]])],0);const d=Uu(Ra(zl(l,h),u)),f=_c(r,[t,0],[n-t,s]),m=hu(d,a),g=rl(a);if(0===t)r=du(f,zl(m,zl(g,f)));else{const e=du(f,zl(m,zl(g,f)));r=ca([_c(r,[0,0],[t,s]),e],0)}const y=rl(m),b=_c(i,[0,t],[n,i.shape[1]-t]);if(0===t)i=du(b,zl(zl(b,a),y));else{const e=du(b,zl(zl(b,a),y));i=ca([_c(i,[0,0],[n,t]),e],1)}return[a,r,i]})),co([e,u,c])}return!e&&n>s&&(i=_c(i,[0,0],[n,s]),r=_c(r,[0,0],[s,s])),[i,r]}))}const $h=xi({qr_:Eh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var Rh;function Dh(t,e,n=Rh.SUM_BY_NONZERO_WEIGHTS){const s=bi(t,"losses","computeWeightedLoss");let i=null;null!=e&&(i=bi(e,"weights","computeWeightedLoss"));const r=null==i?s:hu(s,i);if(n===Rh.NONE)return r;if(n===Rh.SUM)return mu(r);if(n===Rh.MEAN){if(null==i)return Cu(r);{const t=s.size/i.size,e=Ra(mu(r),mu(i));return t>1?Ra(e,go(t)):e}}if(n===Rh.SUM_BY_NONZERO_WEIGHTS){if(null==i)return Ra(mu(r),go(s.size));{const t=hu(i,Yu(s.shape)),e=gr(mu(Hu(t,go(0))),"float32");return Ra(mu(r),e)}}throw Error(`Unknown reduction: ${n}`)}(function(t){t[t["NONE"]=0]="NONE",t[t["MEAN"]=1]="MEAN",t[t["SUM"]=2]="SUM",t[t["SUM_BY_NONZERO_WEIGHTS"]=3]="SUM_BY_NONZERO_WEIGHTS"})(Rh||(Rh={}));const Mh=xi({computeWeightedLoss_:Dh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ph(t,e,n,s=Rh.SUM_BY_NONZERO_WEIGHTS){const i=bi(t,"labels","absoluteDifference"),r=bi(e,"predictions","absoluteDifference");let o=null;null!=n&&(o=bi(n,"weights","absoluteDifference")),w(i.shape,r.shape,"Error in absoluteDifference: ");const a=vo(du(i,r));return Mh(a,o,s)}xi({absoluteDifference_:Ph});function Fh(t,e,n,s,i=Rh.SUM_BY_NONZERO_WEIGHTS){const r=bi(t,"labels","cosineDistance"),o=bi(e,"predictions","cosineDistance");let a=null;null!=s&&(a=bi(s,"weights","cosineDistance")),w(r.shape,o.shape,"Error in cosineDistance: ");const u=go(1),c=du(u,mu(hu(r,o),n,!0));return Mh(c,a,i)}xi({cosineDistance_:Fh});function Lh(t,e,n,s=Rh.SUM_BY_NONZERO_WEIGHTS){let i=bi(t,"labels","hingeLoss");const r=bi(e,"predictions","hingeLoss");let o=null;null!=n&&(o=bi(n,"weights","hingeLoss")),w(i.shape,r.shape,"Error in hingeLoss: ");const a=go(1);i=du(hu(go(2),i),a);const u=pc(du(a,hu(i,r)));return Mh(u,o,s)}xi({hingeLoss_:Lh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zh(t,e,n,s=1,i=Rh.SUM_BY_NONZERO_WEIGHTS){const r=bi(t,"labels","huberLoss"),o=bi(e,"predictions","huberLoss");let a=null;null!=n&&(a=bi(n,"weights","huberLoss")),w(r.shape,o.shape,"Error in huberLoss: ");const u=go(s),c=vo(du(o,r)),l=Ou(c,u),h=du(c,l),p=xo(hu(go(.5),qu(l)),hu(u,h));return Mh(p,a,i)}xi({huberLoss_:zh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Bh(t,e,n,s=1e-7,i=Rh.SUM_BY_NONZERO_WEIGHTS){const r=bi(t,"labels","logLoss"),o=bi(e,"predictions","logLoss");let a=null;null!=n&&(a=bi(n,"weights","logLoss")),w(r.shape,o.shape,"Error in logLoss: ");const u=go(1),c=go(s),l=Uu(hu(r,ru(xo(o,c)))),h=hu(du(u,r),ru(xo(du(u,o),c))),p=du(l,h);return Mh(p,a,i)}xi({logLoss_:Bh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qh(t,e){let n=bi(t,"a","squaredDifference"),s=bi(e,"b","squaredDifference");[n,s]=ti(n,s),La(n.shape,s.shape);const i={a:n,b:s},r={};return ci.runKernel(Wn,i,r)}const Vh=xi({squaredDifference_:qh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wh(t,e,n,s=Rh.SUM_BY_NONZERO_WEIGHTS){const i=bi(t,"labels","meanSquaredError"),r=bi(e,"predictions","meanSquaredError");let o=null;null!=n&&(o=bi(n,"weights","meanSquaredError")),w(i.shape,r.shape,"Error in meanSquaredError: ");const a=Vh(i,r);return Mh(a,o,s)}xi({meanSquaredError_:Wh});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jh(t){const e=bi(t,"x","log1p"),n={x:e};return ci.runKernel(Pe,n)}const Uh=xi({log1p_:jh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Gh(t,e){const n=bi(t,"labels","sigmoidCrossEntropyWithLogits"),s=bi(e,"logits","sigmoidCrossEntropyWithLogits");w(n.shape,s.shape,"Error in sigmoidCrossEntropyWithLogits: ");const i=pc(s),r=hu(s,n),o=Uh(au(Uu(vo(s))));return xo(du(i,r),o)}function Hh(t,e,n,s=0,i=Rh.SUM_BY_NONZERO_WEIGHTS){let r=bi(t,"multiClassLabels","sigmoidCrossEntropy");const o=bi(e,"logits","sigmoidCrossEntropy");let a=null;if(null!=n&&(a=bi(n,"weights","sigmoidCrossEntropy")),w(r.shape,o.shape,"Error in sigmoidCrossEntropy: "),s>0){const t=go(s),e=go(1),n=go(.5);r=xo(hu(r,du(e,t)),hu(n,t))}const u=Gh(r,o);return Mh(u,a,i)}xi({sigmoidCrossEntropy_:Hh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Kh(t,e=null,n=!1){const s=bi(t,"x","logSumExp"),i=E(e,s.shape),r=cu(s,i,!0),o=du(s,r),a=au(o),u=mu(a,i),c=ru(u),l=xo(Go(r,c.shape),c);if(n){const t=Mu(l.shape,i);return Go(l,t)}return l}const Xh=xi({logSumExp_:Kh});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Qh(t,e,n=-1){if(-1===n&&(n=e.rank-1),n!==e.rank-1)throw Error(`Softmax cross entropy along a non-last dimension is not yet supported. Labels / logits was rank ${e.rank} and dim was ${n}`);const s=mo(((t,e,s)=>{const i=!0,r=Xh(e,[n],i),o=du(gr(e,"float32"),r);s([t,o]);const a=Uu(hu(o,t)),u=mu(a,[n]),c=(t,e)=>{const[s,i]=e,r=Mu(t.shape,[n]);return[hu(Go(t,r),du(gr(s,"float32"),au(i))),hu(Go(t,r),du(au(i),gr(s,"float32")))]};return{value:u,gradFunc:c}}));return s(t,e)}function Yh(t,e,n,s=0,i=Rh.SUM_BY_NONZERO_WEIGHTS){let r=bi(t,"onehotLabels","softmaxCrossEntropy");const o=bi(e,"logits","softmaxCrossEntropy");let a=null;if(null!=n&&(a=bi(n,"weights","softmaxCrossEntropy")),w(r.shape,o.shape,"Error in softmaxCrossEntropy: "),s>0){const t=go(s),e=go(1),n=go(r.shape[1]);r=xo(hu(r,du(e,t)),Ra(t,n))}const u=Qh(r,o);return Mh(u,a,i)}xi({softmaxCrossEntropy_:Yh});const Zh={bandPart:_h,gramSchmidt:Nh,qr:$h};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Jh extends yo{constructor(t,e,n=null){super(),this.learningRate=t,this.rho=e,this.epsilon=n,this.accumulatedGrads=[],this.accumulatedUpdates=[],null==n&&(this.epsilon=ci.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const s=ci.registeredVariables[e],i=!1;null==this.accumulatedGrads[n]&&(this.accumulatedGrads[n]={originalName:`${e}/accum_grad`,variable:uo((()=>sl(s).variable(i)))}),null==this.accumulatedUpdates[n]&&(this.accumulatedUpdates[n]={originalName:`${e}/accum_var`,variable:uo((()=>sl(s).variable(i)))});const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const o=this.accumulatedGrads[n].variable,a=this.accumulatedUpdates[n].variable;uo((()=>{const t=xo(hu(o,this.rho),hu(qu(r),1-this.rho)),e=hu(Ra(Lc(xo(a,this.epsilon)),Lc(xo(o,this.epsilon))),r),n=xo(hu(a,this.rho),hu(qu(e),1-this.rho));o.assign(t),a.assign(n);const i=xo(hu(e,-this.learningRate),s);s.assign(i)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedUpdates&&(co(this.accumulatedGrads.map((t=>t.variable))),co(this.accumulatedUpdates.map((t=>t.variable))))}async getWeights(){const t=[...this.accumulatedGrads,...this.accumulatedUpdates];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=t.length/2,n=!1;this.accumulatedGrads=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedUpdates=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,rho:this.rho,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e["learningRate"],e["rho"],e["epsilon"])}}Jh.className="Adadelta",io(Jh);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class tp extends yo{constructor(t,e=.1){super(),this.learningRate=t,this.initialAccumulatorValue=e,this.accumulatedGrads=[]}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const s=ci.registeredVariables[e];if(null==this.accumulatedGrads[n]){const t=!1;this.accumulatedGrads[n]={originalName:`${e}/accumulator`,variable:uo((()=>Ha(s.shape,this.initialAccumulatorValue).variable(t)))}}const i=Array.isArray(t)?t[n].tensor:t[e];if(null==i)return;const r=this.accumulatedGrads[n].variable;uo((()=>{const t=xo(r,qu(i));r.assign(t);const e=xo(hu(Ra(i,Lc(xo(t,ci.backend.epsilon()))),-this.learningRate),s);s.assign(e)}))})),this.incrementIterations()}dispose(){null!=this.accumulatedGrads&&co(this.accumulatedGrads.map((t=>t.variable)))}async getWeights(){return[await this.saveIterations()].concat(this.accumulatedGrads.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulatedGrads=t.map((t=>({originalName:t.name,variable:t.tensor.variable(e)})))}getConfig(){return{learningRate:this.learningRate,initialAccumulatorValue:this.initialAccumulatorValue}}static fromConfig(t,e){return new t(e["learningRate"],e["initialAccumulatorValue"])}}tp.className="Adagrad",io(tp);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ep extends yo{constructor(t,e,n,s=null){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=s,this.accumulatedFirstMoment=[],this.accumulatedSecondMoment=[],uo((()=>{this.accBeta1=go(e).variable(),this.accBeta2=go(n).variable()})),null==s&&(this.epsilon=ci.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);uo((()=>{const n=du(1,this.accBeta1),s=du(1,this.accBeta2);e.forEach(((e,i)=>{const r=ci.registeredVariables[e],o=!1;null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:uo((()=>sl(r).variable(o)))}),null==this.accumulatedSecondMoment[i]&&(this.accumulatedSecondMoment[i]={originalName:`${e}/v`,variable:uo((()=>sl(r).variable(o)))});const a=Array.isArray(t)?t[i].tensor:t[e];if(null==a)return;const u=this.accumulatedFirstMoment[i].variable,c=this.accumulatedSecondMoment[i].variable,l=xo(hu(u,this.beta1),hu(a,1-this.beta1)),h=xo(hu(c,this.beta2),hu(qu(a),1-this.beta2)),p=Ra(l,n),d=Ra(h,s);u.assign(l),c.assign(h);const f=xo(hu(Ra(p,xo(Lc(d),this.epsilon)),-this.learningRate),r);r.assign(f)})),this.accBeta1.assign(hu(this.accBeta1,this.beta1)),this.accBeta2.assign(hu(this.accBeta2,this.beta2))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.accBeta2.dispose(),null!=this.accumulatedFirstMoment&&co(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedSecondMoment&&co(this.accumulatedSecondMoment.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedFirstMoment,...this.accumulatedSecondMoment];return[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t),uo((()=>{this.accBeta1.assign(Sh(this.beta1,this.iterations_+1)),this.accBeta2.assign(Sh(this.beta2,this.iterations_+1))}));const e=t.length/2,n=!1;this.accumulatedFirstMoment=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedSecondMoment=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)})))}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon}}static fromConfig(t,e){return new t(e["learningRate"],e["beta1"],e["beta2"],e["epsilon"])}}ep.className="Adam",io(ep);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class np extends yo{constructor(t,e,n,s=null,i=0){super(),this.learningRate=t,this.beta1=e,this.beta2=n,this.epsilon=s,this.decay=i,this.accumulatedFirstMoment=[],this.accumulatedWeightedInfNorm=[],uo((()=>{this.iteration=go(0).variable(),this.accBeta1=go(e).variable()})),null==s&&(this.epsilon=ci.backend.epsilon())}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);uo((()=>{const n=du(1,this.accBeta1),s=Ra(-this.learningRate,xo(hu(this.iteration,this.decay),1));e.forEach(((e,i)=>{const r=ci.registeredVariables[e],o=!1;null==this.accumulatedFirstMoment[i]&&(this.accumulatedFirstMoment[i]={originalName:`${e}/m`,variable:sl(r).variable(o)}),null==this.accumulatedWeightedInfNorm[i]&&(this.accumulatedWeightedInfNorm[i]={originalName:`${e}/v`,variable:sl(r).variable(o)});const a=Array.isArray(t)?t[i].tensor:t[e];if(null==a)return;const u=this.accumulatedFirstMoment[i].variable,c=this.accumulatedWeightedInfNorm[i].variable,l=xo(hu(u,this.beta1),hu(a,1-this.beta1)),h=hu(c,this.beta2),p=vo(a),d=Tu(h,p);u.assign(l),c.assign(d);const f=xo(hu(Ra(s,n),Ra(l,xo(d,this.epsilon))),r);r.assign(f)})),this.iteration.assign(xo(this.iteration,1)),this.accBeta1.assign(hu(this.accBeta1,this.beta1))})),this.incrementIterations()}dispose(){this.accBeta1.dispose(),this.iteration.dispose(),null!=this.accumulatedFirstMoment&&co(this.accumulatedFirstMoment.map((t=>t.variable))),null!=this.accumulatedWeightedInfNorm&&co(this.accumulatedWeightedInfNorm.map((t=>t.variable)))}async getWeights(){throw new Error("getWeights() is not implemented for Adamax yet.")}async setWeights(t){throw new Error("setWeights() is not implemented for Adamax yet.")}getConfig(){return{learningRate:this.learningRate,beta1:this.beta1,beta2:this.beta2,epsilon:this.epsilon,decay:this.decay}}static fromConfig(t,e){return new t(e["learningRate"],e["beta1"],e["beta2"],e["epsilon"],e["decay"])}}np.className="Adamax",io(np);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class sp extends yo{constructor(t){super(),this.learningRate=t,this.setLearningRate(t)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const s=Array.isArray(t)?t[n].tensor:t[e];if(null==s)return;const i=ci.registeredVariables[e];uo((()=>{const t=xo(hu(this.c,s),i);i.assign(t)}))})),this.incrementIterations()}setLearningRate(t){this.learningRate=t,null!=this.c&&this.c.dispose(),this.c=lo(go(-t))}dispose(){this.c.dispose()}async getWeights(){return[await this.saveIterations()]}async setWeights(t){if(t=await this.extractIterations(t),0!==t.length)throw new Error("SGD optimizer does not have settable weights.")}getConfig(){return{learningRate:this.learningRate}}static fromConfig(t,e){return new t(e["learningRate"])}}sp.className="SGD",io(sp);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ip extends sp{constructor(t,e,n=!1){super(t),this.learningRate=t,this.momentum=e,this.useNesterov=n,this.accumulations=[],this.m=go(this.momentum)}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const s=ci.registeredVariables[e];if(null==this.accumulations[n]){const t=!1;this.accumulations[n]={originalName:`${e}/momentum`,variable:uo((()=>sl(s).variable(t)))}}const i=this.accumulations[n].variable,r=Array.isArray(t)?t[n].tensor:t[e];null!=r&&uo((()=>{let t;const e=xo(hu(this.m,i),r);t=this.useNesterov?xo(hu(this.c,xo(r,hu(e,this.m))),s):xo(hu(this.c,e),s),i.assign(e),s.assign(t)}))})),this.incrementIterations()}dispose(){this.m.dispose(),null!=this.accumulations&&co(this.accumulations.map((t=>t.variable)))}setMomentum(t){this.momentum=t}async getWeights(){return[await this.saveIterations()].concat(this.accumulations.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=!1;this.accumulations=t.map((t=>({originalName:t.name,variable:t.tensor.variable(e)})))}getConfig(){return{learningRate:this.learningRate,momentum:this.momentum,useNesterov:this.useNesterov}}static fromConfig(t,e){return new t(e["learningRate"],e["momentum"],e["useNesterov"])}}ip.className="Momentum",io(ip);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class rp extends yo{constructor(t,e=.9,n=0,s=null,i=!1){if(super(),this.learningRate=t,this.decay=e,this.momentum=n,this.epsilon=s,this.accumulatedMeanSquares=[],this.accumulatedMoments=[],this.accumulatedMeanGrads=[],this.centered=i,null==s&&(this.epsilon=ci.backend.epsilon()),null==t)throw new Error("learningRate for RMSPropOptimizer must be defined.")}applyGradients(t){const e=Array.isArray(t)?t.map((t=>t.name)):Object.keys(t);e.forEach(((e,n)=>{const s=ci.registeredVariables[e],i=!1;null==this.accumulatedMeanSquares[n]&&(this.accumulatedMeanSquares[n]={originalName:`${e}/rms`,variable:uo((()=>sl(s).variable(i)))}),null==this.accumulatedMoments[n]&&(this.accumulatedMoments[n]={originalName:`${e}/momentum`,variable:uo((()=>sl(s).variable(i)))}),null==this.accumulatedMeanGrads[n]&&this.centered&&(this.accumulatedMeanGrads[n]={originalName:`${e}/mg`,variable:uo((()=>sl(s).variable(i)))});const r=Array.isArray(t)?t[n].tensor:t[e];if(null==r)return;const o=this.accumulatedMeanSquares[n].variable,a=this.accumulatedMoments[n].variable;uo((()=>{const t=xo(hu(o,this.decay),hu(qu(r),1-this.decay));if(this.centered){const e=this.accumulatedMeanGrads[n].variable,i=xo(hu(e,this.decay),hu(r,1-this.decay)),u=Ra(hu(r,this.learningRate),Lc(du(t,xo(qu(i),this.epsilon)))),c=xo(hu(a,this.momentum),u);o.assign(t),e.assign(i),a.assign(c);const l=du(s,c);s.assign(l)}else{const t=xo(hu(o,this.decay),hu(qu(r),1-this.decay)),e=xo(hu(a,this.momentum),Ra(hu(r,this.learningRate),Lc(xo(t,this.epsilon))));o.assign(t),a.assign(e);const n=du(s,e);s.assign(n)}}))})),this.incrementIterations()}dispose(){null!=this.accumulatedMeanSquares&&co(this.accumulatedMeanSquares.map((t=>t.variable))),null!=this.accumulatedMeanGrads&&this.centered&&co(this.accumulatedMeanGrads.map((t=>t.variable))),null!=this.accumulatedMoments&&co(this.accumulatedMoments.map((t=>t.variable)))}async getWeights(){const t=[...this.accumulatedMeanSquares,...this.accumulatedMoments];return this.centered&&t.push(...this.accumulatedMeanGrads),[await this.saveIterations()].concat(t.map((t=>({name:t.originalName,tensor:t.variable}))))}async setWeights(t){t=await this.extractIterations(t);const e=this.centered?t.length/3:t.length/2,n=!1;this.accumulatedMeanSquares=t.slice(0,e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.accumulatedMoments=t.slice(e,2*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))),this.centered&&(this.accumulatedMeanGrads=t.slice(2*e,3*e).map((t=>({originalName:t.name,variable:t.tensor.variable(n)}))))}getConfig(){return{learningRate:this.learningRate,decay:this.decay,momentum:this.momentum,epsilon:this.epsilon,centered:this.centered}}static fromConfig(t,e){return new t(e["learningRate"],e["decay"],e["momentum"],e["epsilon"],e["centered"])}}rp.className="RMSProp",io(rp);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class op{static sgd(t){return new sp(t)}static momentum(t,e,n=!1){return new ip(t,e,n)}static rmsprop(t,e=.9,n=0,s=null,i=!1){return new rp(t,e,n,s,i)}static adam(t=.001,e=.9,n=.999,s=null){return new ep(t,e,n,s)}static adadelta(t=.001,e=.95,n=null){return new Jh(t,e,n)}static adamax(t=.002,e=.9,n=.999,s=null,i=0){return new np(t,e,n,s,i)}static adagrad(t,e=.1){return new tp(t,e)}}const ap={sgd:op.sgd,momentum:op.momentum,adadelta:op.adadelta,adagrad:op.adagrad,rmsprop:op.rmsprop,adamax:op.adamax,adam:op.adam};n(9848);
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const up=(()=>"undefined"!==typeof requestAnimationFrame?requestAnimationFrame:"undefined"!==typeof setImmediate?setImmediate:t=>t())();function cp(){return new Promise((t=>up((()=>t()))))}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lp(t,e){const n=t[0].length;t.forEach(((t,e)=>{v(t.length===n,(()=>`Error in concat${n}D: rank of tensors[${e}] must be the same as the rank of the rest (${n})`))})),v(e>=0&&e<n,(()=>`Error in concat${n}D: axis must be between 0 and ${n-1}.`));const s=t[0];t.forEach(((t,i)=>{for(let r=0;r<n;r++)v(r===e||t[r]===s[r],(()=>`Error in concat${n}D: Shape of tensors[${i}] (${t}) does not match the shape of the rest (${s}) along the non-concatenated axis ${i}.`))}))}function hp(t,e){const n=t[0].slice();for(let s=1;s<t.length;s++)n[e]+=t[s][e];return n}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const pp=30;function dp(t){return t<=pp?t:U(t,Math.floor(Math.sqrt(t)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fp(t,e,n){const s=n*("number"===typeof t?t:t[0]),i=e*("number"===typeof t?t:t[1]);return[s,i]}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mp(t,e,n,s=!0){let i=[];if(s)i=i.concat(e.slice(0)),i.push(t[0]/n),i=i.concat(t.slice(1));else{i=i.concat(t[0]);const n=e.length;for(let s=0;s<n;++s)i=i.concat([t[s+1]/e[s],e[s]]);i=i.concat(t.slice(n+1))}return i}function gp(t,e,n=!0){const s=[];if(n){s.push(e);for(let n=e+1;n<t;++n)n<=2*e?(s.push(n),s.push(n-(e+1))):s.push(n)}else{const n=[],i=[];for(let s=1;s<t;++s)s>=2*e+1||s%2===1?i.push(s):n.push(s);s.push(...n),s.push(0),s.push(...i)}return s}function yp(t,e,n,s=!0){const i=[];s?i.push(t[0]/n):i.push(t[0]*n);for(let r=1;r<t.length;++r)r<=e.length?s?i.push(e[r-1]*t[r]):i.push(t[r]/e[r-1]):i.push(t[r]);return i}function bp(t,e){const n=[0];for(let s=0;s<e;++s)n.push(t[s][0]);return n}function vp(t,e,n){const s=t.slice(0,1);for(let i=0;i<n;++i)s.push(t[i+1]-e[i][0]-e[i][1]);return s}function wp(t,e){const n=t.shape.length,s=e.shape.length;if(n<1)throw new Error(`tf.gatherND() expects the input to be rank 1 or higher, but the rank was ${n}.`);if(s<1)throw new Error(`tf.gatherND() expects the indices to be rank 1 or higher, but the rank was ${s}.`);if("int32"!==e.dtype)throw new Error(`tf.gatherND() expects the indices to be int32 type, but the dtype was ${e.dtype}.`);if(e.shape[s-1]>n)throw new Error(`index innermost dimension length must be <= tensor rank; saw: ${e.shape[s-1]} vs. ${n}`);if(0===k(t.shape))throw new Error(`Requested more than 0 entries, but input is empty. Input shape: ${t.shape}.`);const i=e.shape,r=i[i.length-1];let o=1;for(let h=0;h<i.length-1;++h)o*=i[h];const a=t.shape,u=i.slice();u.pop();let c=1;for(let h=r;h<n;++h)c*=a[h],u.push(a[h]);const l=[...G(t.shape).map((t=>t/c)),1].slice(0,r);return[u,o,c,l]}function xp(t,e,n){const s=e.rank>1?e.shape[e.rank-1]:1,i=e.rank>1?e.rank-1:1,r=`Must have updates.shape = indices.shape[:batchDim] + shape[sliceDim:], got updates.shape: ${n.shape}, indices.shape: ${e.shape}, shape: ${t}, sliceDim: ${s}, and batchDim: ${i}.`;if(n.rank<i)throw new Error(r+` update.rank < ${i}. `);if(t.length<s+(n.rank-i))throw new Error(r+` Output shape length < ${s+(n.rank-i)}`);if(n.rank!==i+t.length-s)throw new Error(r+" update.rank != "+(i+t.length-s));for(let o=0;o<i;++o)if(n.shape[o]!==e.shape[o])throw new Error(r+` updates.shape[${o}] (${n.shape[o]}) != indices.shape[${o}] (${e.shape[o]}).`);for(let o=0;o<n.rank-i;++o)if(n.shape[o+i]!==t[o+s])throw new Error(r+` updates.shape[${o+i}] (${n.shape[o+i]}) != shape[${o+i}] (${t[o+i]})`)}function _p(t,e,n){if(e.rank<1)throw new Error(`tf.scatterND() expects the indices to be rank 1 or higher, but the rank was ${e.rank}.`);if(t.rank<1)throw new Error(`tf.scatterND() expects the updates to be rank 1 or higher, but the rank was ${t.rank}.`);if("int32"!==e.dtype)throw new Error(`The dtype of 'indices' should be int32, but got dtype: ${e.dtype}`);if(n.length<1)throw new Error(`Output rank must be greater or equal to 1, but got shape: ${n}`);if(0===n.length){if(0===e.size)throw new Error(`Indices specified for empty output. indices shape: ${e.shape}`);if(0===t.size)throw new Error(`Updates specified for empty output. updates shape: ${t.shape}`)}xp(n,e,t)}function kp(t,e,n){const s=e.shape.length,i=s>1?e.shape[s-1]:1,r=n.length;let o=1;for(let h=i;h<r;++h)o*=n[h];const a=i<1?1:i,u=k(e.shape)/a,c=[...G(n.slice(0,i)),1],l=k(n);return{sliceRank:i,numUpdates:u,sliceSize:o,strides:c,outputSize:l}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Sp=1.7580993408473768,Tp=1.0507009873554805,Ip=.3275911,Cp=.254829592,Ap=-.284496736,Np=1.421413741,Ep=-1.453152027,Op=1.061405429;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $p(...t){at().getBool("IS_TEST")||console.warn(...t)}function Rp(...t){at().getBool("IS_TEST")||console.log(...t)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Dp(t,e){if(t.length!==e.length)throw new Error(`Cannot merge real and imag arrays of different lengths. real:${t.length}, imag: ${e.length}.`);const n=new Float32Array(2*t.length);for(let s=0;s<n.length;s+=2)n[s]=t[s/2],n[s+1]=e[s/2];return n}function Mp(t){const e=new Float32Array(t.length/2),n=new Float32Array(t.length/2);for(let s=0;s<t.length;s+=2)e[s/2]=t[s],n[s/2]=t[s+1];return{real:e,imag:n}}function Pp(t){const e=Math.ceil(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=0;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function Fp(t){const e=Math.floor(t.length/4),n=new Float32Array(e),s=new Float32Array(e);for(let i=2;i<t.length;i+=4)n[Math.floor(i/4)]=t[i],s[Math.floor(i/4)]=t[i+1];return{real:n,imag:s}}function Lp(t,e){const n=t[2*e],s=t[2*e+1];return{real:n,imag:s}}function zp(t,e,n,s){t[2*s]=e,t[2*s+1]=n}function Bp(t,e){const n=new Float32Array(t/2),s=new Float32Array(t/2);for(let i=0;i<Math.ceil(t/2);i++){const r=(e?2:-2)*Math.PI*(i/t);n[i]=Math.cos(r),s[i]=Math.sin(r)}return{real:n,imag:s}}function qp(t,e,n){const s=(n?2:-2)*Math.PI*(t/e),i=Math.cos(s),r=Math.sin(s);return{real:i,imag:r}}function Vp(t,e,n=0){let s=[];if("number"===typeof e)v(t.shape[n]%e===0,(()=>"Number of splits must evenly divide the axis.")),s=new Array(e).fill(t.shape[n]/e);else{const i=e.reduce(((t,e)=>(-1===e&&(t+=1),t)),0);v(i<=1,(()=>"There should be only one negative value in split array."));const r=e.indexOf(-1);if(-1!==r){const s=e.reduce(((t,e)=>e>0?t+e:t));e[r]=t.shape[n]-s}v(t.shape[n]===e.reduce(((t,e)=>t+e)),(()=>"The sum of sizes must match the size of the axis dimension.")),s=e}return s}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wp(t,e){let n,s=!1;t<=pp?(n=t,s=!0):n=U(t,Math.floor(Math.sqrt(t)));while(!s)n>e||n===t?s=!0:n=U(t,n+1);return n}function jp(t,e,n){const s=[],i=t.length;for(let r=0;r<i;r++)r!==e?s.push(t[r]):s.push(n);return s}function Up(t,e,n,s){const i=e.shape.length,r=t.shape.length;if(0!==s&&(s<-i||s>i))throw new Error(`Expect batchDims in the range of [-${i}, ${i}], but got ${s}`);if(s<0&&(s+=i),s>r)throw new Error(`batchDims (${s}) must be less than rank(x) (\n    ${r}).`);if(n<s)throw new Error(`batchDims (${s}) must be less than or equal to axis (${n}).`);for(let h=0;h<s;++h)if(t.shape[h]!==e.shape[h])throw new Error(`x.shape[${h}]: ${t.shape[h]} should be equal to indices.shape[${h}]: ${e.shape[h]}.`);const o=t.shape[n],a=[];let u=1,c=1,l=1;for(let h=0;h<s;++h)a.push(t.shape[h]),u*=t.shape[h];for(let h=s;h<n;h++)a.push(t.shape[h]),c*=t.shape[h];for(let h=s;h<i;h++)a.push(e.shape[h]);for(let h=n+1;h<r;h++)a.push(t.shape[h]),l*=t.shape[h];return{batchSize:u,sliceSize:l,outerSize:c,dimSize:o,outputShape:a}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Gp(t,e,n){if("complex64"===e){if("complex64"===t.dtype)return t.clone();const e=Qu(t.shape),s=gr(t,"float32"),i=n.complex(s,e);return e.dispose(),s.dispose(),i}if(!P(t.dtype,e))return ci.makeTensorFromDataId(t.dataId,t.shape,e);if("complex64"===t.dtype){const s=n.real(t),i=gr(s,e);return s.dispose(),i}if("int32"===e)return n.int(t);if("bool"===e){const e=go(0,t.dtype),s=n.notEqual(t,e);return e.dispose(),s}throw new Error(`Error in Cast: failed to cast ${t.dtype} to ${e}`)}function Hp(t,e){return ci.makeTensorFromDataId(t.dataId,e,t.dtype)}function Kp(t){try{return t.map((t=>Ps(t)))}catch(x6){throw new Error(`Failed to decode encoded string bytes into utf-8, error: ${x6}`)}}function Xp(t){return t.map((t=>Ms(t)))}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Qp(t,e){const n=[];for(let r=0;r<e.length;r++)e[r]&&n.push(r);const s=fr(t,"int32"),i=fr([n.length,t.length],"int32");for(let r=0;r<n.length;r++){const e=s.indexToLoc(n[r]),o=r*t.length;i.values.set(e,o)}return i.toTensor()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Yp={kernelName:ft,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(t,Il(gr(n,"float32"),-1))}}},Zp={kernelName:mt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=qu(gr(n,"float32")),s=Lc(du(go(1),e));return Uu(Ra(t,s))}}}},Jp={kernelName:gt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=Lc(du(qu(gr(n,"float32")),1));return Ra(t,e)}}}},td={kernelName:yt,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=La(n.shape,s.shape),r=()=>{let e=t;const s=Fa(n.shape,i);return s.length>0&&(e=mu(e,s)),Go(e,n.shape)},o=()=>{let e=t;const n=Fa(s.shape,i);return n.length>0&&(e=mu(e,n)),Go(e,s.shape)};return{a:r,b:o}}},ed={kernelName:bt,saveAllInputs:!0,gradFunc:(t,e)=>{const n={};return e.forEach(((e,s)=>{n[s]=()=>t.clone()})),n}},nd={kernelName:xt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>sl(n)}}},sd={kernelName:_t,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>sl(n)}}},id={kernelName:kt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,Lc(du(go(1),qu(gr(n,"float32")))))}}},rd={kernelName:St,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=Lc(xo(go(1),qu(gr(n,"float32"))));return Ra(t,e)}}}},od={kernelName:Ct,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=La(n.shape,s.shape),r=()=>{const e=xo(qu(n),qu(s));let r=hu(t,Ra(s,e));const o=Fa(n.shape,i);return o.length>0&&(r=mu(r,o)),Go(r,n.shape)},o=()=>{const e=xo(qu(n),qu(s));let r=Uu(hu(t,Ra(n,e)));const o=Fa(s.shape,i);return o.length>0&&(r=mu(r,o)),Go(r,s.shape)};return{a:r,b:o}}},ad={kernelName:Tt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,xo(qu(gr(n,"float32")),1))}}},ud={kernelName:It,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,du(go(1),qu(gr(n,"float32"))))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cd(t,e,n,s,i=[1,1,1],r,o){const a=bi(t,"dy","avgPool3dGrad"),u=bi(e,"input","avgPool3dGrad");let c=a,l=u,h=!1;4===u.rank&&(h=!0,c=Go(a,[1,a.shape[0],a.shape[1],a.shape[2],a.shape[3]]),l=Go(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]])),v(5===c.rank,(()=>`Error in avgPool3dGrad: dy must be rank 5 but got rank ${c.rank}.`)),v(5===l.rank,(()=>`Error in avgPool3dGrad: input must be rank 5 but got rank ${l.rank}.`)),v(Wo(s,i),(()=>`Error in avgPool3dGrad: Either strides or dilations must be 1. Got strides ${s} and dilations '${i}'`)),null!=o&&v(T(r),(()=>`Error in avgPool3dGrad: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`));const p={dy:c,input:l},d={filterSize:n,strides:s,dilations:i,pad:r,dimRoundingMode:o},f=ci.runKernel(Ot,p,d);return h?Go(f,[f.shape[1],f.shape[2],f.shape[3],f.shape[4]]):f}const ld=xi({avgPool3dGrad_:cd}),hd={kernelName:Et,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:i,strides:r,dilations:o,pad:a,dimRoundingMode:u}=n,c=null==o?[1,1,1]:o;return{x:()=>ld(t,s,i,r,c,a,u)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pd(t,e,n,s,i){const r=bi(t,"dy","avgPoolGrad"),o=bi(e,"input","avgPoolGrad");v(o.rank===r.rank,(()=>`Rank of input (${o.rank}) does not match rank of dy (${r.rank})`));let a=o,u=r,c=!1;3===o.rank&&(c=!0,a=Go(o,[1,o.shape[0],o.shape[1],o.shape[2]]),u=Go(r,[1,r.shape[0],r.shape[1],r.shape[2]])),v(4===u.rank,(()=>`Error in avgPoolGrad: dy must be rank 4 but got rank ${u.rank}.`)),v(4===a.rank,(()=>`Error in avgPoolGrad: input must be rank 4 but got rank ${a.rank}.`));const l={dy:u,input:a},h={filterSize:n,strides:s,pad:i},p=ci.runKernel(Nt,l,h);return c?Go(p,[p.shape[1],p.shape[2],p.shape[3]]):p}const dd=xi({avgPoolGrad_:pd}),fd={kernelName:At,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{filterSize:i,strides:r,pad:o}=n;return{x:()=>dd(t,s,i,r,o)}}},md={kernelName:$t,inputsToSave:["a","b"],gradFunc:(t,e,n)=>{const[s,i]=e,{transposeA:r,transposeB:o}=n;return r||o?!r&&o?{a:()=>zl(t,i,!1,!1),b:()=>zl(t,s,!0,!1)}:r&&!o?{a:()=>zl(i,t,!1,!0),b:()=>zl(s,t,!1,!1)}:{a:()=>zl(i,t,!0,!0),b:()=>zl(t,s,!0,!0)}:{a:()=>zl(t,i,!1,!0),b:()=>zl(s,t,!0,!1)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gd(t,e,n){const s=bi(t,"x","spaceToBatchND");v(s.rank>=1+e.length,(()=>`input rank ${s.rank} should be > than [blockShape] ${e.length}`)),v(n.length===e.length,(()=>`paddings.shape[0] ${n.length} must be equal to [blockShape] ${e.length}`)),v(s.shape.reduce(((t,s,i)=>i>0&&i<=e.length?t&&(s+n[i-1][0]+n[i-1][1])%e[i-1]===0:t),!0),(()=>`input spatial dimensions ${s.shape.slice(1)} with paddings ${n.toString()} must be divisible by blockShapes ${e.toString()}`));const i={x:s},r={blockShape:e,paddings:n};return ci.runKernel(Bn,i,r)}const yd=xi({spaceToBatchND_:gd}),bd={kernelName:Rt,gradFunc:(t,e,n)=>{const{blockShape:s,crops:i}=n;return{x:()=>yd(t,s,i)}}},vd={kernelName:Mt,gradFunc:(t,e,n)=>{const s=n,i=s.inputShape,r=s.shape,o=Array.from(r);for(let u=i.length-1;u>=0;u--)if(i[u]===r[u])o[u]=1;else if(1!==i[u])throw new Error(`broadcastTo(): [${i}] cannot be broadcast to [${r}].`);const a=[];for(let u=0;u<o.length;u++)o[u]>1&&a.push(u);return{x:()=>mu(t,a,!0)}}},wd={kernelName:Pt,gradFunc:t=>({x:()=>t.clone()})},xd={kernelName:Ft,gradFunc:t=>({x:()=>sl(t)})},_d={kernelName:Lt,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{clipValueMin:i,clipValueMax:r}=n;return{x:()=>el(vu(eu(s,i),vh(s,r)),t,sl(t))}}},kd={kernelName:Bt,inputsToSave:["x"],gradFunc:Yp.gradFunc},Sd={kernelName:qt,saveAllInputs:!0,gradFunc:(t,e,n)=>{const s=e.map((t=>t.shape)),{axis:i}=n,r=E(i,e[0].shape)[0],o=s.map((t=>t[r])),a=Pc(t,o,r);return a.map((t=>()=>t))}},Td={kernelName:Vt,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,{dilations:r,strides:o,pad:a,dataFormat:u}=n;return v(Vo(r),(()=>`Error in gradient of conv2D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${r}'`)),{x:()=>ka(s.shape,t,i,o,a,u),filter:()=>_l(s,t,i.shape,o,a,u)}}},Id={kernelName:jt,inputsToSave:["dy","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,{strides:r,pad:o,dataFormat:a,dimRoundingMode:u}=n;return{dy:()=>va(t,i,r,o,a,1,u),filter:()=>_l(t,s,i.shape,r,o,a,u)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Cd(t,e,n,s,i){let r=t;4===t.rank&&(r=Go(t,[1,t.shape[0],t.shape[1],t.shape[2],t.shape[3]]));let o=e;4===o.rank&&(o=Go(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]])),v(5===r.rank,(()=>`Error in conv3dDerFilter: input must be rank 5, but got shape ${r.shape}.`)),v(5===o.rank,(()=>`Error in conv3dDerFilter: dy must be rank 5, but got shape ${o.shape}.`)),v(5===n.length,(()=>`Error in conv3dDerFilter: filterShape must be length 5, but got ${n}.`)),v(r.shape[4]===n[3],(()=>`Error in conv3dDerFilter: depth of input ${r.shape[4]}) must match input depth in filter (${n[3]}.`)),v(o.shape[4]===n[4],(()=>`Error in conv3dDerFilter: depth of dy (${o.shape[4]}) must match output depth for filter (${n[4]}).`));const a={x:r,dy:o},u={strides:s,pad:i,filterShape:n};return ci.runKernel(Gt,a,u)}const Ad=xi({conv3DBackpropFilter_:Cd});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Nd(t,e,n,s,i){v(t.length===e.rank,(()=>`Length of inShape (${t.length}) and rank of dy (${e.rank}) must match`));let r=t,o=e,a=!1;4===e.rank&&(a=!0,o=Go(e,[1,e.shape[0],e.shape[1],e.shape[2],e.shape[3]]),r=[1,t[0],t[1],t[2],t[3]]);const u=r[4],c=o.shape[4];v(5===r.length,(()=>`Error in conv3dDerInput: inShape must be length 5, but got length ${r.length}.`)),v(5===o.rank,(()=>`Error in conv3dDerInput: dy must be rank 5, but got rank ${o.rank}`)),v(5===n.rank,(()=>`Error in conv3dDerInput: filter must be rank 5, but got rank ${n.rank}`)),v(u===n.shape[3],(()=>`Error in conv3dDerInput: depth of input (${u}) must match input depth for filter ${n.shape[3]}.`)),v(c===n.shape[4],(()=>`Error in conv3dDerInput: depth of output (${c}) must match output depth for filter ${n.shape[4]}.`));const l={dy:o,filter:n},h={pad:i,strides:s,inputShape:r},p=ci.runKernel(Ht,l,h);return a?Go(p,[p.shape[1],p.shape[2],p.shape[3],p.shape[4]]):p}const Ed=xi({conv3DBackpropInput_:Nd}),Od={kernelName:Ut,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:i,pad:r}=n;v(Vo(s),(()=>`Error in gradient of conv3D: dilation rates greater than 1 are not yet supported in gradients. Got dilations '${s}'`));const[o,a]=e;return{x:()=>Ed(o.shape,t,a,i,r),filter:()=>Ad(o,t,a.shape,i,r)}}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $d(t){const e=bi(t,"x","sin"),n={x:e};return ci.runKernel(Rn,n)}const Rd=xi({sin_:$d}),Dd={kernelName:Kt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(Uu(Rd(gr(n,"float32"))),t)}}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Md(t){const e=bi(t,"x","sinh"),n={x:e};return ci.runKernel(Dn,n)}const Pd=xi({sinh_:Md}),Fd={kernelName:Xt,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(Pd(gr(n,"float32")),t)}}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ld(t,e=0,n=!1,s=!1){const i=bi(t,"x","cumsum"),r={x:i},o={axis:e,exclusive:n,reverse:s};return ci.runKernel(Qt,r,o)}const zd=xi({cumsum_:Ld}),Bd={kernelName:Qt,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i,exclusive:r,reverse:o}=n;return{x:()=>{const e=Fu([i],s.rank);let n=zd(t,i,r,!o);return null!=e&&(n=rl(n,e)),n}}}},qd={kernelName:te,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const{dilations:s,strides:i,pad:r,dimRoundingMode:o}=n,a=null==s?[1,1]:s;v(Vo(a),(()=>`Error in gradient of depthwiseConv2dNative: dilation rates greater than 1 are not yet supported. Got dilations '${a}'`));const[u,c]=e;return v(4===u.rank,(()=>`Error in gradient of depthwiseConv2dNative: input must be rank 4, but got rank ${u.rank}.`)),v(4===c.rank,(()=>`Error in gradient of depthwiseConv2dNative: filter must be rank 4, but got rank ${c.rank}.`)),v(u.shape[3]===c.shape[2],(()=>`Error in gradient of depthwiseConv2d: number of input channels (${u.shape[3]}) must match the inChannels dimension in filter ${c.shape[2]}.`)),v(Wo(i,a),(()=>`Error in gradient of depthwiseConv2d: Either strides or dilations must be  1. Got strides ${i} and dilations '${a}'.`)),null!=o&&v(T(r),(()=>`Error in depthwiseConv2d: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`)),{x:()=>Pl(u.shape,t,c,i,r,s,o),filter:()=>Dl(u,t,c.shape,i,r,s,o)}}},Vd={kernelName:ie,inputsToSave:["x","filter"],gradFunc:(t,e,n)=>{const[s,i]=e,r={x:s,filter:i,dy:t},o={x:s,filter:i,dy:t};return{x:()=>ci.runKernel(re,r,n),filter:()=>ci.runKernel(oe,o,n)}}},Wd={kernelName:ue,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e,s={dy:t,y:n};return{x:()=>ci.runKernel(ce,s)}}},jd={kernelName:le,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=hu(au(Uu(qu(n))),2/Math.sqrt(Math.PI));return{x:()=>hu(t,s)}}},Ud={kernelName:pe,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(t,n)}}},Gd={kernelName:de,inputsToSave:["input"],gradFunc:(t,e)=>{const[n]=e;return{input:()=>Go(t,n.shape)}}},Hd={kernelName:fe,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(t,au(n))}}},Kd={kernelName:be,gradFunc:t=>({x:()=>sl(t)})},Xd={kernelName:ve,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=La(n.shape,s.shape),r=()=>{const e=Ra(t,gr(s,"float32")),r=Fa(n.shape,i);return r.length>0?Go(mu(e,r),n.shape):e},o=()=>{let e=hu(t,gr(n,"float32"));const r=Fa(s.shape,i);r.length>0&&(e=Go(mu(e,r),s.shape));const o=qu(s);return Uu(Ra(e,gr(o,"float32")))};return{a:r,b:o}}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Qd(t){const e=bi(t,"x","rsqrt"),n={x:e};return ci.runKernel(An,n)}const Yd=xi({rsqrt_:Qd}),Zd={kernelName:we,inputsToSave:["x","mean","variance","scale"],gradFunc:(t,e,n)=>{const{varianceEpsilon:s}=n,[i,r,o,a]=e,u=null==a?go(1):a,c=Fa(r.shape,i.shape),l=[];if(1===r.rank){for(let t=0;t<i.shape.length-1;++t)l.push(i.shape[t]);l.push(1)}const h=du(i,r),p=hu(t,u),d=Yd(xo(o,go(s))),f=hu(hu(hu(d,d),d),go(-.5)),m=()=>1===r.rank?Go(hu(hu(t,ja(Go(d,[1,1,1,r.shape[0]]),l)),u),i.shape):Go(hu(hu(t,d),u),i.shape),g=()=>{let t=hu(hu(d,go(-1)),p);return 1===r.rank&&(t=mu(t,c)),Go(t,r.shape)},y=()=>{let t=hu(hu(f,h),p);return 1===r.rank&&(t=mu(t,c)),Go(t,r.shape)},b=()=>{const e=hu(h,d);let n=hu(t,e);return 1===r.rank&&(n=mu(n,c)),Go(n,r.shape)},v=()=>{let e=t;return 1===r.rank&&(e=mu(e,c)),Go(e,r.shape)};return{x:m,mean:g,variance:y,scale:b,offset:v}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Jd(t,e,n){const s=bi(t,"x","unsortedSegmentSum"),i=bi(e,"segmentIds","unsortedSegmentSum","int32");v(T(n),(()=>"numSegments must be of dtype int"));const r={x:s,segmentIds:i},o={numSegments:n};return ci.runKernel(es,r,o)}const tf=xi({unsortedSegmentSum_:Jd}),ef={kernelName:xe,inputsToSave:["x","indices"],gradFunc:(t,e,n)=>{const[s,i]=e,{axis:r}=n,o=E(r,s.shape)[0],a=()=>{const e=s.shape,n=i.size,a=e.slice(0,o),u=a.length,c=e.slice(r,e.length).slice(1),l=c.length,h=nf(0,u),p=nf(u+1,u+1+l),d=sf([a,[n],c]),f=Go(t,d),m=Go(i,[n]),g=sf([[u],h,p]),y=rl(f,g);let b=tf(y,m,s.shape[o]);const v=Lu(g);return b=rl(b,v),b};return{x:a,indices:()=>i}}};function nf(t,e){const n=[];for(let s=t;s<e;++s)n.push(s);return n}function sf(t){const e=[];for(let n=0;n<t.length;++n)for(let s=0;s<t[n].length;++s)e.push(t[n][s]);return e}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const rf={kernelName:Se,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e;return{a:()=>sl(n),b:()=>sl(s)}}},of={kernelName:Te,gradFunc:t=>({x:()=>gr(t,"float32")})},af={kernelName:Ae,gradFunc:t=>({x:()=>sl(t)})},uf={kernelName:Ne,gradFunc:t=>({x:()=>sl(t)})},cf={kernelName:Ee,gradFunc:t=>({x:()=>sl(t)})},lf={kernelName:Oe,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{alpha:i}=n,r=Ja(s,0);return{x:()=>el(r,t,hu(t,i))}}},hf={kernelName:Pe,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,xo(n,1))}}},pf={kernelName:Me,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,gr(n,"float32"))}}},df={kernelName:Be,inputsToSave:[],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n;return{logits:()=>{const e=!0,n=au(s);return du(t,hu(mu(t,i,e),n))}}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ff(t,e,n,s=5,i=1,r=1,o=.5){const a={x:t,y:e,dy:n},u={depthRadius:s,bias:i,alpha:r,beta:o};return ci.runKernel(Ve,a,u)}const mf=xi({localResponseNormalizationBackprop_:ff}),gf={kernelName:qe,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{depthRadius:r,bias:o,alpha:a,beta:u}=n;return{x:()=>mf(s,i,t,r,o,a,u)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yf(t,e,n,s){return e.rank<n.rank&&(e=Go(e,Mu(e.shape,s))),t.rank<n.rank&&(t=Go(t,Mu(t.shape,s))),{x:()=>{const s=hu(t,gr(Ba(n,e),t.dtype));return s}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const bf={kernelName:We,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{reductionIndices:i}=s,r=e[0],o=e[1],a=E(i,r.shape),u=yf(t,o,r,a);return{x:()=>u["x"]()}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vf(t,e){let n=bi(t,"a","less"),s=bi(e,"b","less");[n,s]=ti(n,s),La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel($e,i)}const wf=xi({less_:vf}),xf={kernelName:je,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=()=>hu(t,gr(eu(n,s),"float32")),r=()=>hu(t,gr(wf(n,s),"float32"));return{a:i,b:r}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _f(t,e,n,s,i,r=[1,1,1],o,a){const u=bi(t,"dy","maxPool3dGrad"),c=bi(e,"input","maxPool3dGrad"),l=bi(n,"output","maxPool3dGrad");let h=u,p=c,d=l,f=!1;4===c.rank&&(f=!0,h=Go(u,[1,u.shape[0],u.shape[1],u.shape[2],u.shape[3]]),p=Go(c,[1,c.shape[0],c.shape[1],c.shape[2],c.shape[3]]),d=Go(l,[1,l.shape[0],l.shape[1],l.shape[2],l.shape[3]])),v(5===h.rank,(()=>`Error in maxPool3dGrad: dy must be rank 5 but got rank ${h.rank}.`)),v(5===p.rank,(()=>`Error in maxPool3dGrad: input must be rank 5 but got rank ${p.rank}.`)),v(5===d.rank,(()=>`Error in maxPool3dGrad: output must be rank 5 but got rank ${d.rank}.`)),v(Wo(i,r),(()=>`Error in maxPool3dGrad: Either strides or dilations must be 1. Got strides ${i} and dilations '${r}'`)),null!=a&&v(T(o),(()=>`Error in maxPool3dGrad: pad must be an integer when using, dimRoundingMode ${a} but got pad ${o}.`));const m={dy:h,input:p,output:d},g={filterSize:s,strides:i,dilations:r,pad:o,dimRoundingMode:a},y=ci.runKernel(Ke,m,g);return f?Go(y,[y.shape[1],y.shape[2],y.shape[3],y.shape[4]]):y}const kf=xi({maxPool3dGrad_:_f}),Sf={kernelName:He,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{filterSize:r,strides:o,dilations:a,pad:u,dimRoundingMode:c}=n,l=null==a?[1,1,1]:a;return{x:()=>kf(t,s,i,r,o,l,u,c)}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Tf(t,e,n,s,i,r,o){const a=bi(t,"dy","maxPoolGrad"),u=bi(e,"input","maxPoolGrad"),c=bi(n,"output","maxPoolGrad");v(u.rank===a.rank,(()=>`Rank of input (${u.rank}) does not match rank of dy (${a.rank})`)),v(4===a.rank,(()=>`Error in maxPoolGrad: dy must be rank 4 but got rank ${a.rank}.`)),v(4===u.rank,(()=>`Error in maxPoolGrad: input must be rank 4 but got rank ${u.rank}.`)),null!=o&&v(T(r),(()=>`Error in maxPoolGrad: pad must be an integer when using, dimRoundingMode ${o} but got pad ${r}.`));const l={dy:a,input:u,output:c},h={filterSize:s,strides:i,pad:r,dimRoundingMode:o};return ci.runKernel(Ge,l,h)}const If=xi({maxPoolGrad_:Tf}),Cf={kernelName:Ue,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s,i]=e,{filterSize:r,strides:o,pad:a}=n;return{x:()=>If(t,s,i,r,o,a)}}},Af={kernelName:Qe,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{axis:i}=n,r=E(i,s.shape),o=Du(s.shape,r),a=o[1],u=k(a),c=()=>{const e=s.shape.slice();r.forEach((t=>{e[t]=1}));const n=Go(t,e),i=Ra(hu(n,Yu(s.shape,"float32")),u);return i};return{x:c}}},Nf={kernelName:Ye,inputsToSave:["x"],outputsToSave:[!0],gradFunc:(t,e,n)=>{const s=n,{axis:i}=s,[r,o]=e,a=E(i,r.shape),u=yf(t,o,r,a);return{x:()=>u["x"]()}}},Ef={kernelName:Ze,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=()=>hu(t,gr(vh(n,s),"float32")),r=()=>hu(t,gr(Ja(n,s),"float32"));return{a:i,b:r}}},Of={kernelName:Je,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:i}=n,r=i.map((t=>t[0]));return{x:()=>_c(t,r,s.shape)}}},$f={kernelName:tn,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=La(n.shape,s.shape),r=()=>{const e=Fa(n.shape,i);return e.length>0?Go(mu(t,e),n.shape):t},o=()=>{const e=hu(t,Uu(Xa(Ra(n,s)))),r=Fa(s.shape,i);return r.length>0?Go(mu(e,r),s.shape):e};return{a:r,b:o}}},Rf={kernelName:nn,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=La(n.shape,s.shape),r=()=>{const e=hu(t,gr(s,"float32")),r=Fa(n.shape,i);return r.length>0?Go(mu(e,r),n.shape):e},o=()=>{const e=hu(t,gr(n,"float32")),r=Fa(s.shape,i);return r.length>0?Go(mu(e,r),s.shape):e};return{a:r,b:o}}},Df={kernelName:sn,gradFunc:t=>({x:()=>Uu(t)})},Mf={kernelName:ln,inputsToSave:["indices"],gradFunc:(t,e)=>{const n=e[0];return{indices:()=>Qu(n.shape,"float32")}}},Pf={kernelName:cn,gradFunc:t=>({x:()=>sl(t)})},Ff={kernelName:hn,saveAllInputs:!0,gradFunc:(t,e,n)=>{const{axis:s}=n,i=Qc(t,s);return i.map((t=>()=>t))}},Lf={kernelName:pn,inputsToSave:["x"],gradFunc:(t,e,n)=>{const s=e[0],{paddings:i}=n,r=i.map((t=>t[0]));return{x:()=>_c(t,r,s.shape)}}},zf={kernelName:dn,inputsToSave:["a","b"],outputsToSave:[!0],gradFunc:(t,e)=>{const[n,s,i]=e,r=n,o=s,a=La(r.shape,o.shape),u=()=>{const e=gr(o,"float32");let n=hu(t,hu(e,Sh(r,du(e,go(1)))));const s=Fa(r.shape,a);return s.length>0&&(n=mu(n,s)),Go(n,r.shape)},c=()=>{const e=Ja(r,0),n=el(e,ru(r),sl(r));let s=hu(t,hu(i,n));const u=Fa(o.shape,a);return u.length>0&&(s=mu(s,u)),Go(s,o.shape)};return{a:u,b:c}}},Bf={kernelName:fn,inputsToSave:["x","alpha"],gradFunc:(t,e)=>{const[n,s]=e,i=Ja(n,0);return{x:()=>el(i,t,hu(t,s)),alpha:()=>{let e=el(i,sl(t),hu(t,n));const r=Fa(s.shape,t.shape);return r.length>0&&(e=mu(e,r)),Go(e,s.shape)}}}},qf={kernelName:ae,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=La(n.shape,s.shape),r=()=>{const e=Ra(t,gr(s,"float32")),r=Fa(n.shape,i);return r.length>0?Go(mu(e,r),n.shape):e},o=()=>{let e=hu(t,gr(n,"float32"));const r=Fa(s.shape,i);r.length>0&&(e=Go(mu(e,r),s.shape));const o=qu(s);return Uu(Ra(e,gr(o,"float32")))};return{a:r,b:o}}},Vf={kernelName:bn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,Uu(qu(n)))}}},Wf={kernelName:Tn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e,s=hu(vh(n,6),Il(n));return{x:()=>hu(t,gr(s,"float32"))}}},jf={kernelName:vn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(t,gr(Il(n),"float32"))}}},Uf={kernelName:wn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Go(t,n.shape)}}},Gf={kernelName:kn,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,i={dy:t,images:s},r=()=>ci.runKernel(Sn,i,n);return{images:r}}},Hf={kernelName:xn,inputsToSave:["images"],gradFunc:(t,e,n)=>{const[s]=e,i={dy:t,images:s},r=()=>ci.runKernel(_n,i,n);return{images:r}}},Kf={kernelName:In,gradFunc:(t,e,n)=>{const{dims:s}=n,i=E(s,t.shape);return{x:()=>fc(t,i)}}},Xf={kernelName:Cn,gradFunc:t=>({x:()=>sl(t)})},Qf={kernelName:An,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Uu(Ra(t,hu(Sh(n,1.5),2)))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yf(t){const e=bi(t,"x","logicalNot","bool"),n={x:e};return ci.runKernel(Le,n)}const Zf=xi({logicalNot_:Yf}),Jf={kernelName:En,inputsToSave:["condition"],gradFunc:(t,e)=>{const[n]=e;return{condition:()=>gr(sl(n),"float32"),t:()=>hu(t,gr(n,t.dtype)),e:()=>hu(t,gr(Zf(n),t.dtype))}}},tm={kernelName:On,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>{const e=Ja(n,go(0)),s=go(Sp),i=go(Tp),r=hu(t,i),o=hu(hu(t,s),au(gr(n,"float32")));return el(e,r,o)}}}},em={kernelName:Pn,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(t,hu(n,du(go(1),n)))}}},nm={kernelName:Mn,gradFunc:t=>({x:()=>sl(t)})};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function sm(t){const e=bi(t,"x","cos"),n={x:e};return ci.runKernel(Kt,n)}const im=xi({cos_:sm}),rm={kernelName:Rn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(im(gr(n,"float32")),t)}}};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function om(t){const e=bi(t,"x","cosh"),n={x:e};return ci.runKernel(Xt,n)}const am=xi({cosh_:om}),um={kernelName:Dn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(am(gr(n,"float32")),t)}}},cm={kernelName:$n,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{begin:i,size:r}=n,o=s.shape,[a,u]=to(s,i,r),c=[];for(let l=0;l<t.rank;l++)c.push([a[l],o[l]-a[l]-u[l]]);return{x:()=>ec(t,c)}}},lm={kernelName:Vn,outputsToSave:[!0],gradFunc:(t,e,n)=>{const[s]=e,{dim:i}=n,r=!0,o=hu(t,s);return{logits:()=>du(o,hu(mu(o,[i],r),s))}}},hm={kernelName:Fn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(t,wc(n))}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pm(t,e,n){const s=bi(t,"x","batchToSpaceND"),i=e.reduce(((t,e)=>t*e));v(s.rank>=1+e.length,(()=>`input rank is ${s.rank} but should be > than blockShape.length ${e.length}`)),v(n.length===e.length,(()=>`crops.length is ${n.length} but should be equal to blockShape.length  ${e.length}`)),v(s.shape[0]%i===0,(()=>`input tensor batch is ${s.shape[0]} but is not divisible by the product of the elements of blockShape ${e.join(" * ")} === ${i}`));const r={x:s},o={blockShape:e,crops:n};return ci.runKernel(Rt,r,o)}const dm=xi({batchToSpaceND_:pm}),fm={kernelName:Bn,gradFunc:(t,e,n)=>{const{blockShape:s,paddings:i}=n;return{x:()=>dm(t,s,i)}}},mm={kernelName:qn,gradFunc:(t,e,n)=>{const{axis:s}=n;return{x:()=>ca(t,s)}}},gm={kernelName:Ln,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,hu(Lc(gr(n,"float32")),2))}}},ym={kernelName:jn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(t,hu(gr(n,"float32"),2))}}},bm={kernelName:Wn,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=go(2),r=()=>hu(t,hu(i,du(n,s))),o=()=>hu(t,hu(i,du(s,n)));return{a:r,b:o}}},vm={kernelName:ss,gradFunc:t=>({x:()=>sl(t)})},wm={kernelName:Un,inputsToSave:["a","b"],gradFunc:(t,e)=>{const[n,s]=e,i=La(n.shape,s.shape),r=()=>{let e=t;const s=Fa(n.shape,i);return s.length>0&&(e=mu(e,s)),Go(e,n.shape)},o=()=>{let e=t;const n=Fa(s.shape,i);return n.length>0&&(e=mu(e,n)),Go(Uu(e),s.shape)};return{a:r,b:o}}},xm={kernelName:zn,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,i=s.shape.slice(),{axis:r}=n,o=E(r,s.shape);o.forEach((t=>{i[t]=1}));const a=Go(t,i),u=hu(a,Yu(s.shape,"float32"));return{x:()=>u}}},_m={kernelName:Kn,inputsToSave:["x"],gradFunc:(t,e)=>{const[n]=e;return{x:()=>Ra(t,qu(im(n)))}}},km={kernelName:Xn,outputsToSave:[!0],gradFunc:(t,e)=>{const[n]=e;return{x:()=>hu(du(go(1),qu(n)),t)}}},Sm={kernelName:Qn,inputsToSave:["x"],gradFunc:(t,e,n)=>{const[s]=e,{reps:i}=n,r=()=>{let e=sl(s);if(1===s.rank)for(let n=0;n<i[0];++n)e=xo(e,_c(t,[n*s.shape[0]],[s.shape[0]]));else if(2===s.rank)for(let n=0;n<i[0];++n)for(let r=0;r<i[1];++r)e=xo(e,_c(t,[n*s.shape[0],r*s.shape[1]],[s.shape[0],s.shape[1]]));else if(3===s.rank)for(let n=0;n<i[0];++n)for(let r=0;r<i[1];++r)for(let o=0;o<i[2];++o)e=xo(e,_c(t,[n*s.shape[0],r*s.shape[1],o*s.shape[2]],[s.shape[0],s.shape[1],s.shape[2]]));else{if(4!==s.rank)throw new Error(`Gradient for tile operation is not implemented for rank-${s.rank} tensors yet.`);for(let n=0;n<i[0];++n)for(let r=0;r<i[1];++r)for(let o=0;o<i[2];++o)for(let a=0;a<i[3];++a)e=xo(e,_c(t,[n*s.shape[0],r*s.shape[1],o*s.shape[2],a*s.shape[3]],[s.shape[0],s.shape[1],s.shape[2],s.shape[3]]))}return e};return{x:r}}},Tm={kernelName:Zn,gradFunc:(t,e,n)=>{const s=n,{perm:i}=s,r=Lu(i);return{x:()=>rl(t,r)}}},Im={kernelName:ts,gradFunc:(t,e,n)=>{const s=n,{axis:i}=s;return{value:()=>Vc(t,i)}}},Cm={kernelName:es,inputsToSave:["segmentIds"],gradFunc:(t,e)=>{const[n]=e,s=()=>Am(t,n);return{x:s}}};function Am(t,e){const n=Tu(e,sl(e)),s=Ya(t,n);let i=eu(e,go(0,"int32"));const r=s.rank-i.rank;for(let a=0;a<r;++a)i=Va(i,a+1);i=vu(i,Yu(s.shape,"bool"));const o=sl(s);return el(i,s,o)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Nm={kernelName:ns,gradFunc:t=>({x:()=>sl(t)})},Em=[Yp,Zp,Jp,td,ed,nd,sd,id,rd,od,ad,ud,hd,fd,md,bd,vd,wd,xd,_d,kd,Sd,Id,Td,Od,Dd,Fd,Bd,qd,Vd,qf,Wd,jd,Ud,Gd,Hd,Xd,Kd,Zd,ef,rf,of,af,uf,cf,lf,hf,pf,df,gf,bf,bf,xf,Sf,Cf,Af,Nf,Ef,Of,$f,Rf,Df,Mf,Pf,Ff,Lf,Lf,zf,Bf,Vf,Wf,jf,Uf,Gf,Hf,Kf,Xf,Qf,Jf,tm,em,nm,rm,um,cm,lm,hm,fm,fm,mm,mm,gm,bm,ym,vm,wm,xm,_m,km,Sm,Tm,Im,Cm,Nm];for(const _6 of Em)ms(_6);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Om(t){const e=bi(t,"x","acos"),n={x:e};return ci.runKernel(mt,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.abs=function(){return this.throwIfDisposed(),vo(this)};const $m=xi({acos_:Om});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Rm(t){const e=bi(t,"x","acosh"),n={x:e};return ci.runKernel(gt,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.acos=function(){return this.throwIfDisposed(),$m(this)};const Dm=xi({acosh_:Rm});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Mm(t,e){let n=bi(t,"a","mod"),s=bi(e,"b","mod");[n,s]=ti(n,s);const i={a:n,b:s};return ci.runKernel(tn,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.acosh=function(){return this.throwIfDisposed(),Dm(this)};const Pm=xi({mod_:Mm});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fm(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","addStrict"),s=bi(e,"b","addStrict");return w(n.shape,s.shape,"Error in addStrict: "),xo(n,s)}function Lm(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","subStrict"),s=bi(e,"b","subStrict");return w(n.shape,s.shape,"Error in subStrict: "),du(n,s)}function zm(t,e){return ro("strict variants of ops have been deprecated and will be removed in future"),w(t.shape,e.shape,"Error in powStrict: "),Sh(t,e)}function Bm(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","mul"),s=bi(e,"b","mul");return w(n.shape,s.shape,"Error in multiplyStrict: "),hu(n,s)}function qm(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","div"),s=bi(e,"b","div");return w(n.shape,s.shape,"Error in divideStrict: "),Ra(n,s)}function Vm(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","modStrict"),s=bi(e,"b","modStrict");return w(n.shape,s.shape,"Error in modStrict: "),Pm(n,s)}function Wm(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","minimumStrict"),s=bi(e,"b","minimumStrict");return w(n.shape,s.shape,"Error in minimumStrict: "),Ou(n,s)}function jm(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","maximumStrict"),s=bi(e,"b","maximumStrict");return w(n.shape,s.shape,"Error in maximumStrict: "),Tu(n,s)}function Um(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","squaredDifferenceStrict"),s=bi(e,"b","squaredDifferenceStrict");return w(n.shape,s.shape,"Error in squaredDifferenceStrict: "),Vh(n,s)}const Gm=xi({addStrict_:Fm}),Hm=xi({divStrict_:qm}),Km=xi({maximumStrict_:jm}),Xm=xi({minimumStrict_:Wm}),Qm=xi({modStrict_:Vm}),Ym=xi({mulStrict_:Bm}),Zm=xi({powStrict_:zm}),Jm=xi({squaredDifferenceStrict_:Um}),tg=xi({subStrict_:Lm});
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function eg(t,e=0){const n=bi(t,"x","argMin"),s={x:n},i={axis:e};return ci.runKernel(_t,s,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.addStrict=function(t){return this.throwIfDisposed(),Gm(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.add=function(t){return this.throwIfDisposed(),xo(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.all=function(t,e){return this.throwIfDisposed(),ko(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.any=function(t,e){return this.throwIfDisposed(),To(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.argMax=function(t){return this.throwIfDisposed(),Co(this,t)};const ng=xi({argMin_:eg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function sg(t){const e=bi(t,"x","asin"),n={x:e};return ci.runKernel(kt,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.argMin=function(t){return this.throwIfDisposed(),ng(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.asScalar=function(){return this.throwIfDisposed(),v(1===this.size,(()=>"The array must have only 1 element.")),Go(this,[])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.asType=function(t){return this.throwIfDisposed(),gr(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.as1D=function(){return this.throwIfDisposed(),Go(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.as2D=function(t,e){return this.throwIfDisposed(),Go(this,[t,e])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.as3D=function(t,e,n){return this.throwIfDisposed(),Go(this,[t,e,n])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.as4D=function(t,e,n,s){return this.throwIfDisposed(),Go(this,[t,e,n,s])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.as5D=function(t,e,n,s,i){return this.throwIfDisposed(),Go(this,[t,e,n,s,i])};const ig=xi({asin_:sg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rg(t){const e=bi(t,"x","asinh"),n={x:e};return ci.runKernel(St,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.asin=function(){return this.throwIfDisposed(),ig(this)};const og=xi({asinh_:rg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ag(t){const e=bi(t,"x","atan"),n={x:e};return ci.runKernel(Tt,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.asinh=function(){return this.throwIfDisposed(),og(this)};const ug=xi({atan_:ag});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cg(t,e){let n=bi(t,"a","atan2"),s=bi(e,"b","atan2");[n,s]=ti(n,s);const i={a:n,b:s};return ci.runKernel(Ct,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.atan=function(){return this.throwIfDisposed(),ug(this)};const lg=xi({atan2_:cg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hg(t){const e=bi(t,"x","atanh"),n={x:e};return ci.runKernel(It,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.atan2=function(t){return this.throwIfDisposed(),lg(this,t)};const pg=xi({atanh_:hg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dg(t){const e=bi(t,"x","ceil"),n={x:e};return ci.runKernel(Ft,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.atanh=function(){return this.throwIfDisposed(),pg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.avgPool=function(t,e,n,s){return this.throwIfDisposed(),Ko(this,t,e,n,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.batchToSpaceND=function(t,e){return this.throwIfDisposed(),dm(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.batchNorm=function(t,e,n,s,i){return this.throwIfDisposed(),Jo(this,t,e,n,s,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.broadcastTo=function(t){return this.throwIfDisposed(),Jc(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.cast=function(t){return this.throwIfDisposed(),gr(this,t)};const fg=xi({ceil_:dg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mg(t,e,n="NHWC"){const s=bi(t,"x","depthToSpace"),i="NHWC"===n?s.shape[1]:s.shape[2],r="NHWC"===n?s.shape[2]:s.shape[3],o="NHWC"===n?s.shape[3]:s.shape[1];v(i*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${i} and ${e}  for depthToSpace with input shape\n    ${s.shape}`)),v(r*e>=0,(()=>`Negative dimension size caused by overflow when multiplying\n    ${r} and ${e} for depthToSpace with input shape\n        ${s.shape}`)),v(o%(e*e)===0,(()=>`Dimension size must be evenly divisible by ${e*e} but is ${o} for depthToSpace with input shape ${s.shape}`));const a={x:s},u={blockSize:e,dataFormat:n};return ci.runKernel(Jt,a,u)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.ceil=function(){return this.throwIfDisposed(),fg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.clipByValue=function(t,e){return this.throwIfDisposed(),aa(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.concat=function(t,e){return this.throwIfDisposed(),t instanceof js&&(t=[t]),ca([this,...t],e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.conv1d=function(t,e,n,s,i,r){return this.throwIfDisposed(),xa(this,t,e,n,s,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.conv2dTranspose=function(t,e,n,s,i){return this.throwIfDisposed(),Ta(this,t,e,n,s,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.conv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),va(this,t,e,n,s,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.cos=function(){return this.throwIfDisposed(),im(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.cosh=function(){return this.throwIfDisposed(),am(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.cumsum=function(t,e,n){return this.throwIfDisposed(),zd(this,t,e,n)};const gg=xi({depthToSpace_:mg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yg(t,e,n,s,i=[1,1],r="NHWC"){const o=bi(t,"x","dilation2d"),a=bi(e,"filter","dilation2d");v(3===o.rank||4===o.rank,(()=>`Error in dilation2d: input must be rank 3 or 4, but got rank ${o.rank}.`)),v(3===a.rank,(()=>`Error in dilation2d: filter must be rank 3, but got rank ${a.rank}.`)),v("NHWC"===r,(()=>`Error in dilation2d: Only NHWC is currently supported, but got dataFormat of ${r}`));let u=o,c=!1;3===o.rank&&(u=Go(o,[1,o.shape[0],o.shape[1],o.shape[2]]),c=!0);const l={x:u,filter:a},h={strides:n,pad:s,dilations:i},p=ci.runKernel(ie,l,h);return c?Go(p,[p.shape[1],p.shape[2],p.shape[3]]):p}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.depthToSpace=function(t,e){return this.throwIfDisposed(),gg(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.depthwiseConv2D=function(t,e,n,s,i,r){return ro("depthwiseConv2D is deprecated, use depthwiseConv2d instead"),this.throwIfDisposed(),Na(this,t,e,n,s,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.depthwiseConv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),Na(this,t,e,n,s,i,r)};const bg=xi({dilation2d_:yg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vg(t,e){let n=bi(t,"a","div"),s=bi(e,"b","div");[n,s]=ti(n,s);const i=Ra(n,s),r=sl(i),o=Ba(s,r);return el(o,r,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.dilation2d=function(t,e,n,s,i){return this.throwIfDisposed(),bg(this,t,e,n,s,i)};const wg=xi({divNoNan_:vg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xg(t,e){const n=bi(t,"t1","dot"),s=bi(e,"t2","dot");v((1===n.rank||2===n.rank)&&(1===s.rank||2===s.rank),(()=>`Error in dot: inputs must all be rank 1 or 2, but got ranks ${n.rank} and ${s.rank}.`));const i=1===n.rank?n.size:n.shape[1],r=1===s.rank?s.size:s.shape[0];if(v(i===r,(()=>`Error in dot: inner dimensions of inputs must match, but got ${i} and ${r}.`)),1===n.rank&&1===s.rank){const t=Go(n,[1,-1]),e=Go(s,[-1,1]),i=zl(t,e);return Go(i,[])}if(1===n.rank&&2===s.rank){const t=Go(n,[1,-1]),e=Go(s,[s.shape[0],s.shape[1]]),i=zl(t,e);return Go(i,[i.size])}if(2===n.rank&&1===s.rank){const t=Go(s,[-1,1]),e=zl(n,t);return Go(e,[e.size])}{const t=Go(s,[s.shape[0],s.shape[1]]),e=zl(n,t);return e}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.divNoNan=function(t){return this.throwIfDisposed(),wg(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.divStrict=function(t){return this.throwIfDisposed(),Hm(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.div=function(t){return this.throwIfDisposed(),Ra(this,t)};const _g=xi({dot_:xg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kg(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","notEqualStrict"),s=bi(e,"b","notEqualStrict");return w(n.shape,s.shape,"Error in notEqualStrict: "),Hu(n,s)}function Sg(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","lessStrict"),s=bi(e,"b","lessStrict");return w(n.shape,s.shape,"Error in lessStrict: "),wf(n,s)}function Tg(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","equalStrict"),s=bi(e,"b","equalStrict");return w(n.shape,s.shape,"Error in equalStrict: "),Ba(n,s)}function Ig(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","lessEqualStrict"),s=bi(e,"b","lessEqualStrict");return w(n.shape,s.shape,"Error in lessEqualStrict: "),vh(n,s)}function Cg(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","greaterStrict"),s=bi(e,"b","greaterStrict");return w(n.shape,s.shape,"Error in greaterStrict: "),Ja(n,s)}function Ag(t,e){ro("strict variants of ops have been deprecated and will be removed in future");const n=bi(t,"a","greaterEqualStrict"),s=bi(e,"b","greaterEqualStrict");return w(n.shape,s.shape,"Error in greaterEqualStrict: "),eu(n,s)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.dot=function(t){return this.throwIfDisposed(),_g(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.elu=function(){return this.throwIfDisposed(),Ma(this)};const Ng=xi({equalStrict_:Tg}),Eg=xi({greaterEqualStrict_:Ag}),Og=xi({greaterStrict_:Cg}),$g=xi({lessEqualStrict_:Ig}),Rg=xi({lessStrict_:Sg}),Dg=xi({notEqualStrict_:kg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Mg(t){let e=bi(t,"x","erf");v("int32"===e.dtype||"float32"===e.dtype,(()=>"Input dtype must be `int32` or `float32`.")),"int32"===e.dtype&&(e=gr(e,"float32"));const n={x:e};return ci.runKernel(le,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.equalStrict=function(t){return this.throwIfDisposed(),Ng(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.equal=function(t){return this.throwIfDisposed(),Ba(this,t)};const Pg=xi({erf_:Mg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fg(t){const e=bi(t,"x","expm1"),n={x:e};return ci.runKernel(fe,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.erf=function(){return this.throwIfDisposed(),Pg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.exp=function(){return this.throwIfDisposed(),au(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.expandDims=function(t){return this.throwIfDisposed(),Va(this,t)};const Lg=xi({expm1_:Fg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zg(t){const e=bi(t,"x","isFinite"),n={x:e};return ci.runKernel(Ae,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.expm1=function(){return this.throwIfDisposed(),Lg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.fft=function(){return this.throwIfDisposed(),fl(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.flatten=function(){return this.throwIfDisposed(),Go(this,[this.size])},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.floor=function(){return this.throwIfDisposed(),Xa(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.floorDiv=function(t){return this.throwIfDisposed(),Oa(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.gather=function(t,e){return this.throwIfDisposed(),Ya(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.greaterEqualStrict=function(t){return this.throwIfDisposed(),Eg(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.greaterEqual=function(t){return this.throwIfDisposed(),eu(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.greaterStrict=function(t){return this.throwIfDisposed(),Og(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.greater=function(t){return this.throwIfDisposed(),Ja(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.ifft=function(){return this.throwIfDisposed(),bl(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.irfft=function(){return this.throwIfDisposed(),wl(this)};const Bg=xi({isFinite_:zg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qg(t){const e=bi(t,"x","isInf"),n={x:e};return ci.runKernel(Ne,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.isFinite=function(){return this.throwIfDisposed(),Bg(this)};const Vg=xi({isInf_:qg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Wg(t){const e=bi(t,"x","isNaN"),n={x:e};return ci.runKernel(Ee,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.isInf=function(){return this.throwIfDisposed(),Vg(this)};const jg=xi({isNaN_:Wg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ug(t,e=5,n=1,s=1,i=.5){const r=bi(t,"x","localResponseNormalization");v(4===r.rank||3===r.rank,(()=>`Error in localResponseNormalization: x must be rank 3 or 4 but got\n               rank ${r.rank}.`)),v(T(e),(()=>`Error in localResponseNormalization: depthRadius must be an integer but got depthRadius ${e}.`));let o=r,a=!1;3===r.rank&&(a=!0,o=Go(r,[1,r.shape[0],r.shape[1],r.shape[2]]));const u={x:o},c={depthRadius:e,bias:n,alpha:s,beta:i},l=ci.runKernel(qe,u,c);return a?Go(l,[l.shape[1],l.shape[2],l.shape[3]]):l}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.isNaN=function(){return this.throwIfDisposed(),jg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.leakyRelu=function(t){return this.throwIfDisposed(),su(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.lessEqualStrict=function(t){return this.throwIfDisposed(),$g(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.lessEqual=function(t){return this.throwIfDisposed(),vh(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.lessStrict=function(t){return this.throwIfDisposed(),Rg(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.less=function(t){return this.throwIfDisposed(),wf(this,t)};const Gg=xi({localResponseNormalization_:Ug});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hg(t){const e=bi(t,"x","logSigmoid"),n=mo((t=>{const e=Uu(Dc(Uu(t))),n=e=>{const n=hu(e,wc(Uu(t)));return n};return{value:e,gradFunc:n}}));return n(e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.localResponseNormalization=function(t,e,n,s){return this.throwIfDisposed(),Gg(this,t,e,n,s)};const Kg=xi({logSigmoid_:Hg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xg(t,e){const n=bi(t,"a","logicalOr","bool"),s=bi(e,"b","logicalOr","bool");La(n.shape,s.shape);const i={a:n,b:s};return ci.runKernel(ze,i)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.logSigmoid=function(){return this.throwIfDisposed(),Kg(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.logSoftmax=function(t){return this.throwIfDisposed(),yu(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.logSumExp=function(t,e){return this.throwIfDisposed(),Xh(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.log=function(){return this.throwIfDisposed(),ru(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.log1p=function(){return this.throwIfDisposed(),Uh(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.logicalAnd=function(t){return this.throwIfDisposed(),vu(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.logicalNot=function(){return this.throwIfDisposed(),Zf(this)};const Qg=xi({logicalOr_:Xg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yg(t,e){const n=bi(t,"a","logicalXor","bool"),s=bi(e,"b","logicalXor","bool");return La(n.shape,s.shape),vu(Qg(t,e),Zf(vu(t,e)))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.logicalOr=function(t){return this.throwIfDisposed(),Qg(this,t)};const Zg=xi({logicalXor_:Yg});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Jg(t,e,n){v("reflect"===n||"symmetric"===n,(()=>`Invalid mode. Mode must be either reflect or symmetric. Got ${n}.`));const s=bi(t,"x","mirrorPad");if(0===s.rank)throw new Error("mirrorPad(scalar) is not defined. Pass non-scalar to mirrorPad");v(e.length===s.rank,(()=>`Padding doesn't match input. Must be ${s.rank}. Got ${e.length}.`));const i="reflect"===n?1:0;for(let a=0;a<s.rank;a++)v(2===e[a].length,(()=>"Invalid number of paddings. Must be length of 2 each.")),v(e[a][0]>=0&&e[a][0]<=s.shape[a]-i&&e[a][1]>=0&&e[a][1]<=s.shape[a]-i,(()=>`Padding in dimension ${a} cannot be greater than or equal to ${s.shape[a]-i} or less than 0 for input of shape ${s.shape}`));const r={paddings:e,mode:n},o={x:s};return ci.runKernel(Je,o,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.logicalXor=function(t){return this.throwIfDisposed(),Zg(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.matMul=function(t,e,n){return this.throwIfDisposed(),zl(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.maxPool=function(t,e,n,s){return this.throwIfDisposed(),xu(this,t,e,n,s)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.max=function(t,e){return this.throwIfDisposed(),cu(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.maximumStrict=function(t){return this.throwIfDisposed(),Km(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.maximum=function(t){return this.throwIfDisposed(),Tu(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.mean=function(t,e){return this.throwIfDisposed(),Cu(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.min=function(t,e){return this.throwIfDisposed(),Nu(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.minimumStrict=function(t){return this.throwIfDisposed(),Xm(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.minimum=function(t){return this.throwIfDisposed(),Ou(this,t)};const ty=xi({mirrorPad_:Jg});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ey(t,e,n,s,i,r){null==i&&(i=[1,1]),null==r&&(r=1),0===s&&(s="valid");const o=bi(t,"x","maxPool");let a=o,u=!1;3===o.rank&&(u=!0,a=Go(o,[1,o.shape[0],o.shape[1],o.shape[2]])),v(Wo(r,i),(()=>`Error in pool: Either strides or dilations must be 1. Got strides ${r} and dilations '${i}'`));const c=No(a.shape,e,r,i,s),l=[c.dilationHeight,c.dilationWidth];let h;h="same"===s?sy([c.filterHeight,c.filterWidth],l):[[0,0],[0,0]];const p=1===l[0]&&1===l[1],[d,f]=ny([c.inHeight,c.inWidth],l,h),m=p?s:"valid",g=p?a:yd(a,l,d),y="avg"===n?()=>Ko(g,e,r,m):()=>xu(g,e,r,m),b=y(),w=p?b:dm(b,l,f);return u?Go(w,[w.shape[1],w.shape[2],w.shape[3]]):w}function ny(t,e,n){const s=n.map((t=>t[0])),i=n.map((t=>t[1])),r=t.concat(s,i),o=e.map(((t,e)=>(t-r[e]%t)%t)),a=i.map(((t,e)=>t+o[e])),u=e.map(((t,e)=>[s[e],a[e]])),c=e.map(((t,e)=>[0,o[e]]));return[u,c]}function sy(t,e){const n=t.map(((t,n)=>t+(t-1)*(e[n]-1))),s=n.map((t=>t-1)),i=s.map((t=>Math.floor(t/2))),r=s.map(((t,e)=>t-i[e]));return s.map(((t,e)=>[i[e],r[e]]))}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.mirrorPad=function(t,e){return this.throwIfDisposed(),ty(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.modStrict=function(t){return this.throwIfDisposed(),Qm(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.mod=function(t){return this.throwIfDisposed(),Pm(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.mulStrict=function(t){return this.throwIfDisposed(),Ym(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.mul=function(t){return this.throwIfDisposed(),hu(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.neg=function(){return this.throwIfDisposed(),Uu(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.norm=function(t,e,n){return this.throwIfDisposed(),Ch(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.notEqualStrict=function(t){return this.throwIfDisposed(),Dg(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.notEqual=function(t){return this.throwIfDisposed(),Hu(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.oneHot=function(t,e=1,n=0){return this.throwIfDisposed(),Xu(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.onesLike=function(){return this.throwIfDisposed(),Ju(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.pad=function(t,e){return this.throwIfDisposed(),ec(this,t,e)};const iy=xi({pool_:ey});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ry(t,e=null,n=!1){let s=bi(t,"x","prod");"bool"===s.dtype&&(s=gr(s,"int32"));const i={x:s},r={axis:e,keepDims:n};return ci.runKernel(mn,i,r)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.pool=function(t,e,n,s,i){return this.throwIfDisposed(),iy(this,t,e,n,s,i)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.powStrict=function(t){return this.throwIfDisposed(),Zm(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.pow=function(t){return this.throwIfDisposed(),Sh(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.prelu=function(t){return this.throwIfDisposed(),sc(this,t)};const oy=xi({prod_:ry});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ay(t){const e=bi(t,"x","reciprocal"),n={x:e};return ci.runKernel(bn,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.prod=function(t,e){return this.throwIfDisposed(),oy(this,t,e)};const uy=xi({reciprocal_:ay});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cy(t){const e=bi(t,"x","round"),n={x:e};return ci.runKernel(Cn,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.reciprocal=function(){return this.throwIfDisposed(),uy(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.relu=function(){return this.throwIfDisposed(),pc(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.relu6=function(){return this.throwIfDisposed(),Sl(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.reshapeAs=function(t){return this.throwIfDisposed(),Go(this,t.shape)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.reshape=function(t){return this.throwIfDisposed(),Go(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.resizeBilinear=function(t,e,n){return this.throwIfDisposed(),mh(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.resizeNearestNeighbor=function(t,e,n){return this.throwIfDisposed(),yh(this,t,e,n)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.reverse=function(t){return this.throwIfDisposed(),fc(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.rfft=function(){return this.throwIfDisposed(),gl(this)};const ly=xi({round_:cy});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hy(t){const e=bi(t,"x","sign"),n={x:e};return ci.runKernel(Mn,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.round=function(){return this.throwIfDisposed(),ly(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.rsqrt=function(){return this.throwIfDisposed(),Yd(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.selu=function(){return this.throwIfDisposed(),gc(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.separableConv2d=function(t,e,n,s,i,r){return this.throwIfDisposed(),bc(this,t,e,n,s,i,r)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.sigmoid=function(){return this.throwIfDisposed(),wc(this)};const py=xi({sign_:hy});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dy(t,e,n,s,i=0,r=0,o=0,a=0,u=0){const c=bi(t,"x","stridedSlice"),l={x:c},h={begin:e,end:n,strides:s,beginMask:i,endMask:r,ellipsisMask:o,newAxisMask:a,shrinkAxisMask:u};return ci.runKernel(Hn,l,h)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.sign=function(){return this.throwIfDisposed(),py(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.sin=function(){return this.throwIfDisposed(),Rd(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.sinh=function(){return this.throwIfDisposed(),Pd(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.slice=function(t,e){return this.throwIfDisposed(),_c(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.softmax=function(t){return this.throwIfDisposed(),$c(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.softplus=function(){return this.throwIfDisposed(),Dc(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.spaceToBatchND=function(t,e){return this.throwIfDisposed(),yd(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.split=function(t,e){return this.throwIfDisposed(),Pc(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.sqrt=function(){return this.throwIfDisposed(),Lc(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.square=function(){return this.throwIfDisposed(),qu(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.squaredDifference=function(t){return this.throwIfDisposed(),Vh(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.squaredDifferenceStrict=function(t){return this.throwIfDisposed(),Jm(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.squeeze=function(t){return this.throwIfDisposed(),Bc(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.stack=function(t,e){this.throwIfDisposed();const n=t instanceof js?[this,t]:[this,...t];return Vc(n,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.step=function(t){return this.throwIfDisposed(),Il(this,t)};const fy=xi({stridedSlice_:dy});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function my(t){const e=bi(t,"x","tan"),n={x:e};return ci.runKernel(Kn,n)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.stridedSlice=function(t,e,n,s,i,r,o,a){return this.throwIfDisposed(),fy(this,t,e,n,s,i,r,o,a)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.subStrict=function(t){return this.throwIfDisposed(),tg(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.sub=function(t){return this.throwIfDisposed(),du(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.sum=function(t,e){return this.throwIfDisposed(),mu(this,t,e)};const gy=xi({tan_:my});
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yy(t,e=1,n=!0){const s=bi(t,"x","topk");if(0===s.rank)throw new Error("topk() expects the input to be of rank 1 or higher");const i=s.shape[s.shape.length-1];if(e>i)throw new Error(`'k' passed to topk() must be <= the last dimension (${i}) but got ${e}`);const r={x:s},o={k:e,sorted:n},[a,u]=ci.runKernel(Yn,r,o);return{values:a,indices:u}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.tan=function(){return this.throwIfDisposed(),gy(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.tanh=function(){return this.throwIfDisposed(),jc(this)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.tile=function(t){return this.throwIfDisposed(),ja(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.toBool=function(){return this.throwIfDisposed(),gr(this,"bool")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.toFloat=function(){return this.throwIfDisposed(),gr(this,"float32")},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.toInt=function(){return this.throwIfDisposed(),gr(this,"int32")};const by=xi({topk_:yy});
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vy(t,e=0){const n=bi(t,"x","unique","string_or_numeric");v(n.rank>0,(()=>"The input tensor must be at least 1D"));const s={x:n},i={axis:e},[r,o]=ci.runKernel(Jn,s,i);return{values:r,indices:o}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.topk=function(t,e){return this.throwIfDisposed(),by(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.transpose=function(t){return this.throwIfDisposed(),rl(this,t)};const wy=xi({unique_:vy});
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
let xy;function _y(){return null==xy&&(xy=po().epsilon()),xy}function ky(){return"channelsLast"}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.unique=function(t){return this.throwIfDisposed(),wy(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.unsortedSegmentSum=function(t,e){return this.throwIfDisposed(),tf(this,t,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.unstack=function(t){return this.throwIfDisposed(),Qc(this,t)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.where=function(t,e){return this.throwIfDisposed(),el(t,this,e)},
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
js.prototype.zerosLike=function(){return this.throwIfDisposed(),sl(this)};
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Sy extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Sy.prototype)}}class Ty extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ty.prototype)}}class Iy extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Iy.prototype)}}class Cy extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Cy.prototype)}}class Ay extends Error{constructor(t){super(t),Object.setPrototypeOf(this,Ay.prototype)}}Error;
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Ny(t,e){if(Array.isArray(t)){let n=[];for(let s=0;s<e;s++)n=n.concat(t);return n}{const n=new Array(e);return n.fill(t),n}}function Ey(t,e){if(!t)throw new Ay(e)}function Oy(t,e){let n=0;for(const s of t)s===e&&n++;return n}function $y(t){return 1===t.length?t[0]:t}function Ry(t){return Array.isArray(t)?t:[t]}function Dy(t){const e=t.replace(/(.)([A-Z][a-z0-9]+)/g,"$1_$2"),n=e.replace(/([a-z])([A-Z])/g,"$1_$2").toLowerCase();return"_"!==n[0]?n:"private"+n}function My(t){return t.length<=1||-1===t.indexOf("_")?t:t.replace(/[_]+(\w|$)/g,((t,e)=>e.toUpperCase()))}let Py={};function Fy(t){if(null===t||void 0===t)return null;const e={};return e["className"]=t.getClassName(),e["config"]=t.getConfig(),e}function Ly(t){if(null!=t&&"object"===typeof t)if(Array.isArray(t))t.forEach((t=>Ly(t)));else{const e=Object.keys(t);for(const n of e){const e=t[n];null!=e&&"object"===typeof e&&(Array.isArray(e)||"ndarray"!==e["type"]||"number"!==typeof e["value"]?Ly(e):t[n]=e["value"])}}}function zy(t,e={},n={},s="object",i=!1){if("string"===typeof t){const i=t;let r;if(i in n)r=n[i];else if(i in Py)r=Py[i];else if(r=e[i],null==r)throw new Iy(`Unknown ${s}: ${t}. This may be due to one of the following reasons:\n1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);return r}{const r=t;if(null==r["className"]||null==r["config"])throw new Iy(`${s}: Improper config format: ${JSON.stringify(r)}.\n'className' and 'config' must set.`);const o=r["className"];let a,u;if(o in n?[a,u]=n[o]:o in Py?[a,u]=Py["className"]:o in e&&([a,u]=e[o]),null==a)throw new Iy(`Unknown ${s}: ${o}. This may be due to one of the following reasons:\n1. The ${s} is defined in Python, in which case it needs to be ported to TensorFlow.js or your JavaScript code.\n2. The custom ${s} is defined in JavaScript, but is not registered properly with tf.serialization.registerClass().`);if(null!=u){const t={};for(const n of Object.keys(Py))t[n]=Py[n];for(const i of Object.keys(n))t[i]=n[i];const e=r["config"];e["customObjects"]=t;const s=Object.assign({},Py);for(const i of Object.keys(n))Py[i]=n[i];Ly(r["config"]);const o=u(a,r["config"],n,i);return Py=Object.assign({},s),o}{const t=Object.assign({},Py);for(const s of Object.keys(n))Py[s]=n[s];const e=new a(r["config"]);return Py=Object.assign({},t),e}}}function By(t,e){return t<e?-1:t>e?1:0}function qy(t,e){return-1*By(t,e)}function Vy(t){if(null==t)return t;const e=[];for(const n of t)-1===e.indexOf(n)&&e.push(n);return e}function Wy(t){if(null==t)throw new Iy(`Invalid value in obj: ${JSON.stringify(t)}`);for(const e in t)if(t.hasOwnProperty(e))return!1;return!0}function jy(t,e,n){if(null!=n&&t.indexOf(n)<0)throw new Iy(`${n} is not a valid ${e}.  Valid values are ${t} or null/undefined.`)}function Uy(t,e,n=0,s=1/0){return Ey(n>=0),Ey(s>=n),Array.isArray(t)&&t.length>=n&&t.length<=s&&t.every((t=>typeof t===e))}function Gy(t,e){Array.isArray(t)?(v(t.length>0,(()=>`${e} is unexpectedly an empty array.`)),t.forEach(((t,n)=>Gy(t,`element ${n+1} of ${e}`)))):v(Number.isInteger(t)&&t>0,(()=>`Expected ${e} to be a positive integer, but got ${Hy(t)}.`))}function Hy(t){return null===t?"null":Array.isArray(t)?"["+t.map((t=>Hy(t))).join(",")+"]":"string"===typeof t?`"${t}"`:`${t}`}function Ky(t,e){let n,s=Ds();const i=(...i)=>{const r=Ds();return r-s<e||(s=r,n=t(...i)),n};return i}function Xy(t){return"relu"===t?"relu":"linear"===t?"linear":"elu"===t?"elu":null}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Qy(t,e){return uo((()=>Lc(mu(hu(t,t),e,!0))))}class Yy extends no{getConfig(){return{}}}class Zy extends Yy{constructor(t){super(),this.defaultMaxValue=2,this.defaultAxis=0,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return uo((()=>{const e=Qy(t,this.axis),n=aa(e,0,this.maxValue);return hu(t,Ra(n,xo(_y(),e)))}))}getConfig(){return{maxValue:this.maxValue,axis:this.axis}}}Zy.className="MaxNorm",io(Zy);class Jy extends Yy{constructor(t){super(),this.defaultAxis=0,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return uo((()=>Ra(t,xo(_y(),Qy(t,this.axis)))))}getConfig(){return{axis:this.axis}}}Jy.className="UnitNorm",io(Jy);class tb extends Yy{apply(t){return pc(t)}}tb.className="NonNeg",io(tb);class eb extends Yy{constructor(t){super(),this.defaultMinValue=0,this.defaultMaxValue=1,this.defaultRate=1,this.defaultAxis=0,this.minValue=null!=t.minValue?t.minValue:this.defaultMinValue,this.maxValue=null!=t.maxValue?t.maxValue:this.defaultMaxValue,this.rate=null!=t.rate?t.rate:this.defaultRate,this.axis=null!=t.axis?t.axis:this.defaultAxis}apply(t){return uo((()=>{const e=Qy(t,this.axis),n=xo(hu(this.rate,aa(e,this.minValue,this.maxValue)),hu(1-this.rate,e));return hu(t,Ra(n,xo(_y(),e)))}))}getConfig(){return{minValue:this.minValue,maxValue:this.maxValue,rate:this.rate,axis:this.axis}}}eb.className="MinMaxNorm",io(eb);const nb={maxNorm:"MaxNorm",minMaxNorm:"MinMaxNorm",nonNeg:"NonNeg",unitNorm:"UnitNorm"};function sb(t){return Fy(t)}function ib(t,e={}){return zy(t,so.getMap().classNameMap,e,"constraint")}function rb(t){if(null==t)return null;if("string"===typeof t){const e=t in nb?nb[t]:t,n={className:e,config:{}};return ib(n)}return t instanceof Yy?t:ib(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const ob=["channelsFirst","channelsLast"],ab=["nearest","bilinear"],ub=["valid","same","causal"],cb=["max","avg"],lb=["sum","mul","concat","ave"],hb=new Map;function pb(t){jy(ob,"DataFormat",t)}function db(t){jy(ab,"InterpolationFormat",t)}function fb(t){jy(ub,"PaddingMode",t)}function mb(t){jy(cb,"PoolMode",t)}const gb=[],yb="/";function bb(t,e){gb.push(t);try{const t=e();return gb.pop(),t}catch(n){throw gb.pop(),n}}function vb(){return 0===gb.length?"":gb.join(yb)+yb}function wb(t){if(!kb(t))throw new Error("Not a valid tensor name: '"+t+"'");return vb()+t}function xb(t){if(!kb(t))throw new Error("Not a valid tensor name: '"+t+"'");hb.has(t)||hb.set(t,0);const e=hb.get(t);if(hb.set(t,hb.get(t)+1),e>0){const n=`${t}_${e}`;return hb.set(n,1),n}return t}const _b=new RegExp(/^[A-Za-z0-9][-A-Za-z0-9\._\/]*$/);function kb(t){return!!t.match(_b)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Sb(t){return t===parseInt(t.toString(),10)}function Tb(t,e,n){null==e&&(e=0),null==n&&(n=t.length);let s=1;for(let i=e;i<n;++i)s*=t[i];return s}function Ib(t){return t=Array.isArray(t)?new Float32Array(t):t,Uc(t)}function Cb(t){return Nu(Ib(t)).dataSync()[0]}function Ab(t){return cu(Ib(t)).dataSync()[0]}function Nb(t,e){if(e<t)throw new Iy(`end (${e}) < begin (${t}) is forbidden.`);const n=[];for(let s=t;s<e;++s)n.push(s);return n}function Eb(t,e){return t.asType(e)}function Ob(t,e=-1){const n=t.shape.slice();return e<0&&(e=n.length+e+1),n.splice(e,0,1),t.reshape(n)}function $b(t,e){return uo((()=>{if(2!==t.shape.length)throw new Iy(`repeat() expects a rank-2 tensor, but received a rank-${t.shape.length} tensor.`);const n=Ob(t,1);return Bb(n,[1,e,1])}))}function Rb(t){const e=[Tb(t.shape)];return t.reshape(e)}function Db(t){if(t.rank<=1)throw new Iy(`batchFlatten requires a minimum rank of 2. Got rank: ${t.rank}.`);const e=[t.shape[0],Tb(t.shape,1)];return t.reshape(e)}function Mb(t,e,n){return uo((()=>{switch(t.rank){case 1:return Sc(t,e,n);case 2:return Ic(t,[e,0],[n,t.shape[1]]);case 3:return Ac(t,[e,0,0],[n,t.shape[1],t.shape[2]]);case 4:return Ec(t,[e,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3]]);case 5:return _c(t,[e,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4]]);case 6:return _c(t,[e,0,0,0,0,0],[n,t.shape[1],t.shape[2],t.shape[3],t.shape[4],t.shape[5]]);default:throw new Iy(`sliceAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Pb(t,e,n){return uo((()=>{switch(t.rank){case 1:return Sc(t,e,n);case 2:return Ic(t,[0,e],[t.shape[0],n]);case 3:return Ac(t,[0,0,e],[t.shape[0],t.shape[1],n]);case 4:return Ec(t,[0,0,0,e],[t.shape[0],t.shape[1],t.shape[2],n]);default:throw new Iy(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Fb(t,e,n,s){return uo((()=>{switch(t.rank){case 1:return Sc(t,e,n);case 2:switch(s){case 1:return Mb(t,e,n);case 2:return Pb(t,e,n);default:throw new Iy(`The axis is not within the rank of the tensor ${s}`)}case 3:switch(s){case 1:return Mb(t,e,n);case 2:return Ac(t,[0,e,0],[t.shape[0],n,t.shape[2]]);case 3:return Pb(t,e,n);default:throw new Iy(`The axis is not within the rank of the tensor ${s}`)}case 4:switch(s){case 1:return Mb(t,e,n);case 2:return Ec(t,[0,e,0,0],[t.shape[0],n,t.shape[2],t.shape[3]]);case 3:return Ec(t,[0,0,e,0],[t.shape[0],t.shape[1],n,t.shape[3]]);case 4:return Pb(t,e,n);default:throw new Iy(`The axis is not within the rank of the tensor ${s}`)}default:throw new Iy(`sliceAlongLastAxis() received an unsupported tensor rank: ${t.rank}`)}}))}function Lb(t,e=-1){let n;return e<0&&(n=t[0].rank,e=0!==n?n:0),e===t[0].rank&&(e=-1),ca(t,e)}function zb(t,e){switch(t.rank){case 1:return ha([t,e]);case 2:return da([t,e],0);case 3:return ma([t,e],0);case 4:return ya([t,e],0);default:throw new Iy(`concatAlongFirstAxis() received an unsupported tensor rank: ${t.rank}`)}}function Bb(t,e){if(Array.isArray(e)||(e=[e]),t.rank!==e.length)throw new Iy(`The length of input n (${e.length}) does not match the number of dimensions in input x (${t.rank})`);return ja(t,e)}function qb(t,e=0,n=1,s,i){return uc(t,e,n,s,i)}function Vb(t,e,n,s){if(t.rank<2||e.rank<2)throw new Cy(`dot requires both inputs to be rank >= 2 but got x shape = ${t.shape} and y shape = ${e.shape}`);if(e.rank>=3){const n=t.shape.slice(-1)[0],s=e.shape.slice(-2)[0];if(n!==s)throw new Cy(`If rank y >= 3, then the second last dim of y must equal the last dim of x but got x shape = ${t.shape} and  y shape = ${e.shape}`)}if(2===t.rank&&2===e.rank){const i=!1,r=!1;return ql({a:t,b:e,transposeA:i,transposeB:r,bias:s?Ub(t.rank,s,ky()):null,activation:n})}{const i=t.shape.slice(),r=i.pop();t=t.reshape([-1,r]);const o=e.shape.slice(),a=o.pop(),u=o.pop(),c=[...o,a],l=Array.from({length:e.rank},((t,n)=>0===n?e.rank-2:n<=e.rank-2?n-1:n));e=e.transpose(l).reshape([u,-1]);const h=[...i,...c],p=!1,d=!1;return ql({a:t,b:e,transposeA:p,transposeB:d,bias:s?Ub(t.rank,s,ky()):null,activation:n}).reshape(h)}}function Wb(t,e,n){return uo((()=>(e=Array.isArray(e)?Uc(e,"int32"):e.toInt(),Ya(t,e,n))))}function jb(t){return hu(t,t)}function Ub(t,e,n){const s=e.shape;if(1!==e.rank&&e.rank!==t)throw new Iy(`Unexpected bias dimensions: ${e.rank}; expected it to be 1 or ${t}`);if(5===t){if("channelsFirst"===n)return 1===s.length?e.reshape([1,s[0],1,1,1]):e.reshape([1,s[3],s[0],s[1],s[2]]);if("channelsLast"===n)return 1===s.length?e.reshape([1,1,1,1,s[0]]):e.reshape([1].concat(s))}else if(4===t){if("channelsFirst"===n)return 1===s.length?e.reshape([1,s[0],1,1]):e.reshape([1,s[2],s[0],s[1]]);if("channelsLast"===n)return 1===s.length?e.reshape([1,1,1,s[0]]):e.reshape([1].concat(s))}else if(3===t){if("channelsFirst"===n)return 1===s.length?e.reshape([1,s[0],1]):e.reshape([1,s[1],s[0]]);if("channelsLast"===n)return 1===s.length?e.reshape([1,1,s[0]]):e.reshape([1].concat(s))}else if(t<3)return e;throw new Iy(`Unsupported input rank by biasAdd: ${e.rank}`)}function Gb(t,e,n){return uo((()=>(null==n&&(n=ky()),pb(n),t.add(Ub(t.rank,e,n)))))}function Hb(t,e=1){if(1!==e)throw new Cy(`Support for alpha values other than 1 (${e}) is not implemented yet.`);return Ma(t)}function Kb(t){return uo((()=>Ra(t,vo(t).add(1))))}function Xb(t,e,n,s){return uo((()=>ul(t,e,n,s)))}function Qb(t){return uo((()=>{const e=xo(.5,hu(.2,t));return aa(e,0,1)}))}function Yb(t,e,n=!1){return n?t():e()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const Zb=["fanIn","fanOut","fanAvg"],Jb=["normal","uniform","truncatedNormal"];
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function tv(t){jy(Zb,"FanMode",t)}function ev(t){jy(Jb,"Distribution",t)}class nv extends no{fromConfigUsesCustomObjects(){return!1}getConfig(){return{}}}class sv extends nv{apply(t,e){return Qu(t,e)}}sv.className="Zeros",io(sv);class iv extends nv{apply(t,e){return Yu(t,e)}}iv.className="Ones",io(iv);class rv extends nv{constructor(t){if(super(),"object"!==typeof t)throw new Iy(`Expected argument of type ConstantConfig but got ${t}`);if(void 0===t.value)throw new Iy(`config must have value set but got ${t}`);this.value=t.value}apply(t,e){return uo((()=>hu(go(this.value),Yu(t,e))))}getConfig(){return{value:this.value}}}rv.className="Constant",io(rv);class ov extends nv{constructor(t){super(),this.DEFAULT_MINVAL=-.05,this.DEFAULT_MAXVAL=.05,this.minval=t.minval||this.DEFAULT_MINVAL,this.maxval=t.maxval||this.DEFAULT_MAXVAL,this.seed=t.seed}apply(t,e){return lc(t,this.minval,this.maxval,e)}getConfig(){return{minval:this.minval,maxval:this.maxval,seed:this.seed}}}ov.className="RandomUniform",io(ov);class av extends nv{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32","float32"!==e&&"int32"!==e)throw new Cy(`randomNormal does not support dType ${e}.`);return qb(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}av.className="RandomNormal",io(av);class uv extends nv{constructor(t){super(),this.DEFAULT_MEAN=0,this.DEFAULT_STDDEV=.05,this.mean=t.mean||this.DEFAULT_MEAN,this.stddev=t.stddev||this.DEFAULT_STDDEV,this.seed=t.seed}apply(t,e){if(e=e||"float32","float32"!==e&&"int32"!==e)throw new Cy(`truncatedNormal does not support dType ${e}.`);return Kc(t,this.mean,this.stddev,e,this.seed)}getConfig(){return{mean:this.mean,stddev:this.stddev,seed:this.seed}}}uv.className="TruncatedNormal",io(uv);class cv extends nv{constructor(t){super(),this.gain=null!=t.gain?t.gain:1}apply(t,e){return uo((()=>{if(2!==t.length||t[0]!==t[1])throw new Iy("Identity matrix initializer can only be used for 2D square matrices.");return hu(this.gain,Ga(t[0]))}))}getConfig(){return{gain:this.gain}}}function lv(t,e="channelsLast"){let n,s;if(pb(e),2===t.length)n=t[0],s=t[1];else if(-1!==[3,4,5].indexOf(t.length)){if("channelsFirst"===e){const e=Tb(t,2);n=t[1]*e,s=t[0]*e}else if("channelsLast"===e){const e=Tb(t,0,t.length-2);n=t[t.length-2]*e,s=t[t.length-1]*e}}else{const e=Tb(t);n=Math.sqrt(e),s=Math.sqrt(e)}return[n,s]}cv.className="Identity",io(cv);class hv extends nv{constructor(t){if(super(),t.scale<0)throw new Iy(`scale must be a positive float. Got: ${t.scale}`);this.scale=null==t.scale?1:t.scale,this.mode=null==t.mode?"fanIn":t.mode,tv(this.mode),this.distribution=null==t.distribution?"normal":t.distribution,ev(this.distribution),this.seed=t.seed}apply(t,e){const n=lv(t),s=n[0],i=n[1];let r=this.scale;if("fanIn"===this.mode?r/=Math.max(1,s):"fanOut"===this.mode?r/=Math.max(1,i):r/=Math.max(1,(s+i)/2),"normal"===this.distribution){const n=Math.sqrt(r);if(e=e||"float32","float32"!==e&&"int32"!==e)throw new Cy(`${this.getClassName()} does not support dType ${e}.`);return Kc(t,0,n,e,this.seed)}{const n=Math.sqrt(3*r);return lc(t,-n,n,e)}}getConfig(){return{scale:this.scale,mode:this.mode,distribution:this.distribution,seed:this.seed}}}hv.className="VarianceScaling",io(hv);class pv extends hv{constructor(t){super({scale:1,mode:"fanAvg",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return hv.className}}pv.className="GlorotUniform",io(pv);class dv extends hv{constructor(t){super({scale:1,mode:"fanAvg",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return hv.className}}dv.className="GlorotNormal",io(dv);class fv extends hv{constructor(t){super({scale:2,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return hv.className}}fv.className="HeNormal",io(fv);class mv extends hv{constructor(t){super({scale:2,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return hv.className}}mv.className="HeUniform",io(mv);class gv extends hv{constructor(t){super({scale:1,mode:"fanIn",distribution:"normal",seed:null==t?null:t.seed})}getClassName(){return hv.className}}gv.className="LeCunNormal",io(gv);class yv extends hv{constructor(t){super({scale:1,mode:"fanIn",distribution:"uniform",seed:null==t?null:t.seed})}getClassName(){return hv.className}}yv.className="LeCunNormal",io(yv);class bv extends nv{constructor(t){if(super(),this.DEFAULT_GAIN=1,this.gain=null==t.gain?this.DEFAULT_GAIN:t.gain,this.seed=t.seed,null!=this.seed)throw new Cy("Random seed is not implemented for Orthogonal Initializer yet.")}apply(t,e){return uo((()=>{if(t.length<2)throw new Cy("Shape must be at least 2D.");t[0]*t[1]>2e3&&console.warn(`Orthogonal initializer is being called on a matrix with more than 2000 (${t[0]*t[1]}) elements: Slowness may result.`);const e=t[0]>t[1]?[t[1],t[0]]:t,n=qb(e,0,1,"float32");let s=Zh.gramSchmidt(n);return t[0]>t[1]&&(s=s.transpose()),hu(this.gain,s)}))}getConfig(){return{gain:this.gain,seed:this.seed}}}bv.className="Orthogonal",io(bv);const vv={constant:"Constant",glorotNormal:"GlorotNormal",glorotUniform:"GlorotUniform",heNormal:"HeNormal",heUniform:"HeUniform",identity:"Identity",leCunNormal:"LeCunNormal",leCunUniform:"LeCunUniform",ones:"Ones",orthogonal:"Orthogonal",randomNormal:"RandomNormal",randomUniform:"RandomUniform",truncatedNormal:"TruncatedNormal",varianceScaling:"VarianceScaling",zeros:"Zeros"};function wv(t,e={}){return zy(t,so.getMap().classNameMap,e,"initializer")}function xv(t){return Fy(t)}function _v(t){if("string"===typeof t){const e=t in vv?vv[t]:t;if("GlorotNormal"===e)return new dv;if("GlorotUniform"===e)return new pv;if("HeNormal"===e)return new fv;if("HeUniform"===e)return new mv;if("LeCunNormal"===e)return new gv;if("LeCunUniform"===e)return new yv;{const t={};return t["className"]=e,t["config"]={},wv(t)}}return t instanceof nv?t:wv(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
let kv=0;function Sv(){return kv++}const Tv={};function Iv(t=""){return t in Tv||(Tv[t]=0),Tv[t]+=1,t+Tv[t].toString()}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Cv(t){return Array.isArray(t)&&Array.isArray(t[0])}function Av(t){return 0===t.length?[]:Array.isArray(t[0])?t:[t]}function Nv(t){let e;if(Array.isArray(t)){if(1!==t.length)throw new Iy(`Expected Tensor length to be 1; got ${t.length}`);e=t[0]}else e=t;return e}function Ev(t){if(Array.isArray(t)&&Array.isArray(t[0])){if(1===t.length)return t[0];throw new Iy(`Expected exactly 1 Shape; got ${t.length}`)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Ov(t){let e=0;for(const n of t)0===n.shape.length?e+=1:e+=n.shape.reduce(((t,e)=>t*e));return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const $v="Variable";class Rv{constructor(t,e="float32",n=$v,s=!0,i=null){this.dtype=null==e?"float32":e,this.shape=t.shape,this.id=Sv(),n=null==n?$v:n,this.originalName=wb(n),this.name=xb(this.originalName),this.trainable_=s,this.constraint=i,this.val=Yc(t,this.trainable_,this.name,this.dtype)}read(){return this.assertNotDisposed(),this.val}write(t){return this.assertNotDisposed(),Dv(this.val,t),this.val.id!==t.id&&(this.val.assign(t),null!=this.constraint&&this.val.assign(this.constraint.apply(this.val))),this}dispose(){this.assertNotDisposed(),this.val.dispose()}assertNotDisposed(){if(this.val.isDisposed)throw new Error(`LayersVariable ${this.name} is already disposed.`)}get trainable(){return this.trainable_}set trainable(t){this.trainable_=t,this.val.trainable=t}}function Dv(t,e){if(t.shape.toString()!==e.shape.toString())throw new Error("Shape mismatch: "+JSON.stringify(t.shape)+" vs. "+JSON.stringify(e.shape))}function Mv(t){return t.map((t=>t.read()))}function Pv(t){t.forEach((t=>{const e=t[0];e.write(t[1])}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Fv{constructor(t){this.dtype=t.dtype,this.shape=t.shape,null!=t.shape?this.ndim=t.shape.length:this.ndim=t.ndim,this.maxNDim=t.maxNDim,this.minNDim=t.minNDim,this.axes=t.axes||{}}}class Lv{constructor(t,e,n,s,i,r,o){this.dtype=t,this.shape=e,this.sourceLayer=n,this.inputs=s,this.callArgs=i,this.outputTensorIndex=o,this.id=Sv(),null!=r&&(this.originalName=wb(r),this.name=xb(this.originalName)),this.rank=e.length}}let zv=0;class Bv{constructor(t,e){this.callArgs=e,this.id=zv++,this.outboundLayer=t.outboundLayer,this.inboundLayers=t.inboundLayers,this.nodeIndices=t.nodeIndices,this.tensorIndices=t.tensorIndices,this.inputTensors=t.inputTensors,this.outputTensors=t.outputTensors,this.inputMasks=t.inputMasks,this.outputMasks=t.outputMasks,this.inputShapes=t.inputShapes,this.outputShapes=t.outputShapes;for(const n of t.inboundLayers)null!=n&&n.outboundNodes.push(this);t.outboundLayer.inboundNodes.push(this)}getConfig(){const t=[];for(const e of this.inboundLayers)null!=e?t.push(e.name):t.push(null);return{outboundLayer:this.outboundLayer?this.outboundLayer.name:null,inboundLayers:t,nodeIndices:this.nodeIndices,tensorIndices:this.tensorIndices}}}let qv=0;class Vv extends no{constructor(t={}){super(),this._callHook=null,this._addedWeightNames=[],this._stateful=!1,this.id=qv++,this.activityRegularizer=null,this.inputSpec=null,this.supportsMasking=!1,this._trainableWeights=[],this._nonTrainableWeights=[],this._losses=[],this._updates=[],this._built=!1,this.inboundNodes=[],this.outboundNodes=[];let e=t.name;if(!e){const t=this.getClassName();e=Dy(t)+"_"+Iv(t)}if(this.name=e,this.trainable_=null==t.trainable||t.trainable,null!=t.inputShape||null!=t.batchInputShape){let e;if(null!=t.batchInputShape)e=t.batchInputShape;else if(null!=t.inputShape){let n=null;null!=t.batchSize&&(n=t.batchSize),e=[n].concat(t.inputShape)}this.batchInputShape=e;let n=t.dtype;null==n&&(n=t.inputDType),null==n&&(n="float32"),this.dtype=n}null!=t.weights?this.initialWeights=t.weights:this.initialWeights=null,this._refCount=null,this.fastWeightInitDuringBuild=!1}static nodeKey(t,e){return t.name+"_ib-"+e.toString()}getNodeAtIndex(t,e){if(0===this.inboundNodes.length)throw new Ty(`The layer has never been called and thus has no defined ${e}.`);if(this.inboundNodes.length<=t)throw new Iy(`Asked to get ${e} at node ${t}, but the layer has only ${this.inboundNodes.length} inbound nodes.`);return this.inboundNodes[t]}getInputAt(t){return $y(this.getNodeAtIndex(t,"input").inputTensors)}getOutputAt(t){return $y(this.getNodeAtIndex(t,"output").outputTensors)}get input(){if(this.inboundNodes.length>1)throw new Sy(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer input" is ill-defined. Use \`getInputAt(nodeIndex)\` instead.`);if(0===this.inboundNodes.length)throw new Sy(`Layer ${this.name} is not connected, no input to return.`);return $y(this.getNodeAtIndex(0,"input").inputTensors)}get output(){if(0===this.inboundNodes.length)throw new Sy(`Layer ${this.name} has no inbound nodes.`);if(this.inboundNodes.length>1)throw new Sy(`Layer ${this.name} has multiple inbound nodes, hence the notion of "layer output" is ill-defined. Use \`getOutputAt(nodeIndex)\` instead.`);return $y(this.getNodeAtIndex(0,"output").outputTensors)}get losses(){return this._losses}calculateLosses(){return this.losses.map((t=>t()))}get updates(){return this._updates}get built(){return this._built}set built(t){this._built=t}get trainable(){return this.trainable_}set trainable(t){this._trainableWeights.forEach((e=>e.trainable=t)),this.trainable_=t}get trainableWeights(){return this.trainable_?this._trainableWeights.filter((t=>t.trainable)):[]}set trainableWeights(t){this._trainableWeights=t}get nonTrainableWeights(){return this.trainable?this._trainableWeights.filter((t=>!t.trainable)).concat(this._nonTrainableWeights):this._trainableWeights.concat(this._nonTrainableWeights)}set nonTrainableWeights(t){this._nonTrainableWeights=t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}get stateful(){return this._stateful}resetStates(){if(!this.stateful)throw new Error("Cannot call the resetStates() method of a non-stateful Layer object.")}assertInputCompatibility(t){if(t=Ry(t),null==this.inputSpec||0===this.inputSpec.length)return;const e=Ry(this.inputSpec);if(t.length!==e.length)throw new Iy(`Layer ${this.name} expects ${e.length} inputs, but it received ${t.length} input tensors. Input received: ${t}`);for(let n=0;n<t.length;n++){const s=t[n],i=e[n];if(null==i)continue;const r=s.rank;if(null!=i.ndim&&r!==i.ndim)throw new Iy(`Input ${n} is incompatible with layer ${this.name}: expected ndim=${i.ndim}, found ndim=${r}`);if(null!=i.maxNDim&&r>i.maxNDim)throw new Iy(`Input ${n} is incompatible with layer ${this.name}: expected max_ndim=${i.maxNDim}, found ndim=${r}`);if(null!=i.minNDim&&r<i.minNDim)throw new Iy(`Input ${n} is incompatible with layer ${this.name}: expected min_ndim=${i.minNDim}, found ndim=${r}.`);if(null!=i.dtype&&s.dtype!==i.dtype)throw new Iy(`Input ${n} is incompatible with layer ${this.name} : expected dtype=${i.dtype}, found dtype=${s.dtype}.`);if(i.axes){const t=s.shape;for(const e in i.axes){const s=Number(e),r=i.axes[e],o=s>=0?t[s]:t[t.length+s];if(null!=r&&-1===[r,null].indexOf(o))throw new Iy(`Input ${n} is incompatible with layer ${this.name}: expected axis ${s} of input shape to have value ${r} but got shape ${t}.`)}}if(null!=i.shape)for(let t=0;t<i.shape.length;++t){const e=i.shape[t],r=s.shape[t];if(null!=e&&null!=r&&e!==r)throw new Iy(`Input ${n} is incompatible with layer ${this.name}: expected shape=${i.shape}, found shape=${s.shape}.`)}}}call(t,e){return t}invokeCallHook(t,e){null!=this._callHook&&this._callHook(t,e)}setCallHook(t){this._callHook=t}clearCallHook(){this._callHook=null}apply(t,e){e=e||{},this.assertNotDisposed();const n=Ry(t);let s=!0;for(const r of n)if(!(r instanceof Lv)){s=!1;break}let i=!0;for(const r of n)if(r instanceof Lv){i=!1;break}if(s===i)throw new Iy("Arguments to apply() must be all SymbolicTensors or all Tensors");return bb(this.name,(()=>{if(!this.built){this.assertInputCompatibility(t);const e=[];for(const n of Ry(t))e.push(n.shape);this.build($y(e)),this.built=!0,this.initialWeights&&this.setWeights(this.initialWeights),null===this._refCount&&i&&(this._refCount=1)}if(this.assertInputCompatibility(t),i){let s=this.call(t,e);const i=Ry(s),r=[];for(let t of i)-1!==n.indexOf(t)&&(t=t.clone()),r.push(t);if(s=$y(r),null!=this.activityRegularizer)throw new Cy("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return s}{const n=Wv(t),s=this.computeOutputShape(n);let i;const r=jv(t);if(this.warnOnIncompatibleInputShape(Array.isArray(t)?n[0]:n),i=null!=s&&s.length>0&&Array.isArray(s[0])?s.map(((n,s)=>new Lv(r,n,this,Ry(t),e,this.name,s))):new Lv(r,s,this,Ry(t),e,this.name),this.addInboundNode(t,i,null,null,n,s,e),this._refCount++,null!=this.activityRegularizer)throw new Cy("Layer invocation in the presence of activity regularizer(s) is not supported yet.");return i}}))}warnOnIncompatibleInputShape(t){if(null!=this.batchInputShape)if(t.length!==this.batchInputShape.length)console.warn(`The rank of the input tensor provided (shape: ${JSON.stringify(t)}) does not match that of the batchInputShape (${JSON.stringify(this.batchInputShape)}) of the layer ${this.name}`);else{let e=!1;this.batchInputShape.forEach(((n,s)=>{null!=n&&null!=t[s]&&t[s]!==n&&(e=!0)})),e&&console.warn(`The shape of the input tensor (${JSON.stringify(t)}) does not match the expectation of layer ${this.name}: ${JSON.stringify(this.batchInputShape)}`)}}get outputShape(){if(null==this.inboundNodes||0===this.inboundNodes.length)throw new Sy(`The layer ${this.name} has never been called and thus has no defined output shape.`);const t=[];for(const e of this.inboundNodes){const n=JSON.stringify(e.outputShapes);-1===t.indexOf(n)&&t.push(n)}if(1===t.length){const t=this.inboundNodes[0].outputShapes;return Array.isArray(t)&&Array.isArray(t[0])&&1===t.length?t[0]:t}throw new Sy(`The layer ${this.name} has multiple inbound nodes with different output shapes. Hence the notion of "output shape" is ill-defined for the layer.`)}countParams(){if(!this.built)throw new Ty(`You tried to call countParams() on ${this.name}, but the layer is not built yet. Build it first by calling build(batchInputShape).`);return Ov(this.weights)}build(t){this.built=!0}getWeights(t=!1){return Mv(t?this.trainableWeights:this.weights)}setWeights(t){uo((()=>{const e=this.weights;if(e.length!==t.length)throw new Iy(`You called setWeights(weights) on layer "${this.name}" with a weight list of length ${t.length}, but the layer was expecting ${e.length} weights. Provided weights: ${t}...`);if(0===e.length)return;const n=[],s=Mv(e);for(let i=0;i<s.length;++i){const r=s[i],o=e[i],a=t[i];if(!S(r.shape,a.shape))throw new Iy(`Layer weight shape ${r.shape} not compatible with provided weight shape ${a.shape}`);n.push([o,a])}Pv(n)}))}addWeight(t,e,n,s,i,r,o){if(-1!==this._addedWeightNames.indexOf(t))throw new Iy(`Duplicate weight name ${t} for layer ${this.name}`);this._addedWeightNames.push(t),null==n&&(n="float32"),this.fastWeightInitDuringBuild&&(s=_v("zeros"));const a=s.apply(e,n),u=new Rv(a,n,t,r,o);return a.dispose(),null!=i&&this.addLoss((()=>i.apply(u.read()))),null==r&&(r=!0),r?this._trainableWeights.push(u):this._nonTrainableWeights.push(u),u}setFastWeightInitDuringBuild(t){this.fastWeightInitDuringBuild=t}addLoss(t){null==t||Array.isArray(t)&&0===t.length||(t=Ry(t),void 0!==this._losses&&null!==this._losses&&this.losses.push(...t))}computeOutputShape(t){return t}computeMask(t,e){if(!this.supportsMasking){if(null!=e){if(!Array.isArray(e))throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`);e.forEach((t=>{if(null!=t)throw new TypeError(`Layer ${this.name} does not support masking, but was passed an inputMask.`)}))}return null}return e}addInboundNode(t,e,n,s,i,r,o=null){const a=Ry(t);e=Ry(e),n=Ry(n),s=Ry(s),i=Av(i),r=Av(r);const u=[],c=[],l=[];for(const h of a)u.push(h.sourceLayer),c.push(h.nodeIndex),l.push(h.tensorIndex);new Bv({outboundLayer:this,inboundLayers:u,nodeIndices:c,tensorIndices:l,inputTensors:a,outputTensors:e,inputMasks:n,outputMasks:s,inputShapes:i,outputShapes:r},o);for(let h=0;h<e.length;h++)e[h].sourceLayer=this,e[h].nodeIndex=this.inboundNodes.length-1,e[h].tensorIndex=h}getConfig(){const t={name:this.name,trainable:this.trainable};return null!=this.batchInputShape&&(t["batchInputShape"]=this.batchInputShape),null!=this.dtype&&(t["dtype"]=this.dtype),t}disposeWeights(){return this.weights.forEach((t=>t.dispose())),this.weights.length}assertNotDisposed(){if(0===this._refCount)throw new Error(`Layer '${this.name}' is already disposed.`)}dispose(){if(!this.built)throw new Error(`Cannot dispose Layer ${this.name} because it has not been built yet.`);if(null===this._refCount)throw new Error(`Cannot dispose Layer ${this.name} because it has not been used yet.`);this.assertNotDisposed();let t=0;return 0===--this._refCount&&(t=this.disposeWeights()),{refCountAfterDispose:this._refCount,numDisposedVariables:t}}}function Wv(t){t=Ry(t);const e=[];for(const n of t)e.push(n.shape);return $y(e)}function jv(t){return"float32"}function Uv(t,e,n){if((null==e||null!=n&&n>0)&&(e=t.sourceLayer,n=t.nodeIndex),0===e.inboundNodes.length)return[t];{const t=e.inboundNodes[n];if(0===t.inboundLayers.length)return t.inputTensors;{const e=[];for(let n=0;n<t.inboundLayers.length;n++){const s=t.inputTensors[n],i=t.inboundLayers[n],r=t.nodeIndices[n],o=Uv(s,i,r);for(const t of o)-1===e.indexOf(t)&&e.push(t)}return e}}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Gv extends Vv{constructor(t){if(super({dtype:t.dtype,name:null!=t.name?t.name:Iv("input").toString()}),null==t.batchSize&&(t.batchSize=null),null==t.sparse&&(t.sparse=!1),this.trainable=!1,this.built=!0,this.sparse=t.sparse,null!=t.inputShape&&null!=t.batchInputShape)throw new Iy("Only provide the inputShape OR batchInputShape argument to inputLayer, not both at the same time.");let e=t.batchInputShape;if(null==e){if(null==t.inputShape)throw new Iy("An InputLayer should be passed either a `batchInputShape` or an `inputShape`.");e=[t.batchSize].concat(t.inputShape)}else if(null!=t.batchSize)throw new Iy("Cannot specify batchSize if batchInputShape is specified when creating an InputLayer.");const n=t.dtype||"float32";this.batchInputShape=e,this.dtype=n,this.inputSpec=[{shape:e}];const s=new Lv(this.dtype,this.batchInputShape,this,[],{},this.name);s.nodeIndex=0,s.tensorIndex=0,new Bv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:[s],outputTensors:[s],inputMasks:[null],outputMasks:[null],inputShapes:[e],outputShapes:[e]})}apply(t,e){throw new Iy(`Cannot pass any input to an InputLayer's apply() method. InputLayer name: ${this.name}`)}dispose(){return{refCountAfterDispose:this._refCount,numDisposedVariables:0}}getConfig(){return{batchInputShape:this.batchInputShape,dtype:this.dtype,sparse:this.sparse,name:this.name}}}function Hv(t){if(null==t.batchShape&&null==t.shape)throw new Error("Please provide to Input either a `shape` or a `batchShape` argument. Note that `shape` does not include the batch dimension.");if(null!=t.batchShape&&null!=t.shape)throw new Iy("Please provide either a `shape` or `batchShape` argument to Input, but not both.");let e=t.batchShape;null!=t.shape&&null==e&&(e=[null].concat(t.shape));let n=t.dtype;null==n&&(n="float32");const s=new Gv({batchInputShape:e,name:t.name,dtype:n,sparse:t.sparse}),i=s.inboundNodes[0].outputTensors;return i[0]}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
async function Kv(t){if(null==t)return;const e=[],n=[],s=[];for(const i in t){const r=t[i];if("number"!==typeof r){const t=r;e.push(t.data()),n.push(i),s.push(t)}}if(e.length>0){const i=await Promise.all(e);for(let e=0;e<i.length;++e)t[n[e]]=i[e][0];co(s)}}function Xv(t){if(null!=t)for(const e in t){const n=t[e];"number"!==typeof n&&n.dispose()}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var Qv;Gv.className="InputLayer",io(Gv),function(t){t[t["SILENT"]=0]="SILENT",t[t["VERBOSE"]=1]="VERBOSE"}(Qv||(Qv={}));const Yv=125;class Zv{constructor(){this.validationData=null}setParams(t){this.params=t}async onEpochBegin(t,e){}async onEpochEnd(t,e){}async onBatchBegin(t,e){}async onBatchEnd(t,e){}async onTrainBegin(t){}async onTrainEnd(t){}setModel(t){}}class Jv{constructor(t,e=10){null==t&&(t=[]),this.callbacks=t,this.queueLength=e}append(t){this.callbacks.push(t)}setParams(t){for(const e of this.callbacks)e.setParams(t)}setModel(t){for(const e of this.callbacks)e.setModel(t)}async onEpochBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochBegin(t,e)}async onEpochEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onEpochEnd(t,e)}async onBatchBegin(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchBegin(t,e)}async onBatchEnd(t,e){null==e&&(e={});for(const n of this.callbacks)await n.onBatchEnd(t,e)}async onTrainBegin(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainBegin(t)}async onTrainEnd(t){null==t&&(t={});for(const e of this.callbacks)await e.onTrainEnd(t)}}class tw extends Zv{constructor(){super()}async onEpochBegin(t){this.seen=0,this.totals={}}async onBatchEnd(t,e){null==e&&(e={});const n=null==e["size"]?0:e["size"];this.seen+=n;for(const s in e){const t=e[s];if("number"===typeof t)this.totals.hasOwnProperty(s)||(this.totals[s]=0),this.totals[s]=this.totals[s]+t*n;else{let e;s in this.totals?e=this.totals[s]:this.totals[s]=0;const i=uo((()=>xo(this.totals[s],hu(t,n))));this.totals[s]=i,null!=e&&e.dispose()}}}async onEpochEnd(t,e){if(null!=e)for(const n of this.params["metrics"])null!=this.totals[n]&&("number"===typeof this.totals[n]?e[n]=this.totals[n]/this.seen:uo((()=>{const t=hu(Ra(1,this.seen),this.totals[n]);e[n]=t,this.totals[n].dispose(),lo(e[n])})))}}class ew extends Zv{async onTrainBegin(t){this.epoch=[],this.history={}}async onEpochEnd(t,e){null==e&&(e={}),this.epoch.push(t);for(const n in e)null==this.history[n]&&(this.history[n]=[]),this.history[n].push(e[n])}async syncData(){const t=[],e=[],n=[];for(const i in this.history){const s=this.history[i];for(let r=0;r<s.length;++r)if("number"!==typeof s[r]){const o=s[r];t.push(o.data()),e.push(i),n.push(r)}}const s=await Promise.all(t);for(let i=0;i<s.length;++i){const t=this.history[e[i]][n[i]];t.dispose(),this.history[e[i]][n[i]]=s[i][0]}}}class nw extends Zv{constructor(t,e){if(super(),this.currentEpoch=0,this.yieldEvery=e||"auto","auto"===this.yieldEvery&&(this.yieldEvery=Yv),"never"===this.yieldEvery&&null!=t.onYield)throw new Error("yieldEvery is `never` but you provided an `onYield` callback. Either change `yieldEvery` or remove the callback");V(this.yieldEvery)&&(this.maybeWait=Ky(this.maybeWait.bind(this),this.yieldEvery)),this.trainBegin=t.onTrainBegin,this.trainEnd=t.onTrainEnd,this.epochBegin=t.onEpochBegin,this.epochEnd=t.onEpochEnd,this.batchBegin=t.onBatchBegin,this.batchEnd=t.onBatchEnd,this.yield=t.onYield}async maybeWait(t,e,n){const s=[];null!=this.yield&&(await Kv(n),s.push(this.yield(t,e,n))),s.push(cp()),await Promise.all(s)}async onEpochBegin(t,e){this.currentEpoch=t,null!=this.epochBegin&&(await Kv(e),await this.epochBegin(t,e))}async onEpochEnd(t,e){const n=[];null!=this.epochEnd&&(await Kv(e),n.push(this.epochEnd(t,e))),"epoch"===this.yieldEvery&&n.push(cp()),await Promise.all(n)}async onBatchBegin(t,e){null!=this.batchBegin&&(await Kv(e),await this.batchBegin(t,e))}async onBatchEnd(t,e){const n=[];null!=this.batchEnd&&(await Kv(e),n.push(this.batchEnd(t,e))),"batch"===this.yieldEvery?n.push(cp()):V(this.yieldEvery)&&n.push(this.maybeWait(this.currentEpoch,t,e)),await Promise.all(n)}async onTrainBegin(t){null!=this.trainBegin&&(await Kv(t),await this.trainBegin(t))}async onTrainEnd(t){null!=this.trainEnd&&(await Kv(t),await this.trainEnd(t))}}function sw(t,e){if(null==t&&(t={}),t instanceof Zv)return[t];if(Array.isArray(t)&&t[0]instanceof Zv)return t;const n=Ry(t);return n.map((t=>new nw(t,e)))}class iw{constructor(){}static registerCallbackConstructor(t,e){v(t>=0&&Number.isInteger(t),(()=>`Verbosity level is expected to be an integer >= 0, but got ${t}`)),iw.checkForDuplicate(e),null==iw.constructors[t]&&(iw.constructors[t]=[]),iw.constructors[t].push(e)}static checkForDuplicate(t){for(const e in iw.constructors){const n=iw.constructors[+e];n.forEach((e=>{if(e===t)throw new Iy("Duplicate callback constructor.")}))}}static clear(){iw.constructors={}}static createCallbacks(t){const e=[];for(const n in iw.constructors){const s=+n;t>=s&&e.push(...iw.constructors[s])}return e.map((t=>new t))}}function rw(t,e,n,s,i,r,o,a,u){const c=new ew,l=[new tw,...iw.createCallbacks(e)];null!=t&&l.push(...t),l.push(c);const h=new Jv(l);return h.setParams({epochs:n,initialEpoch:s,samples:i,steps:r,batchSize:o,verbose:e,doValidation:a,metrics:u}),{callbackList:h,history:c}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function ow(t,e={},n=!1){return zy(t,so.getMap().classNameMap,e,"layer",n)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function aw(t,e){return uo((()=>{"float32"!==t.dtype&&(t=t.asType("float32"));const n=mu(jb(t),e,!0),s=Ha(n.shape,_y()),i=Lc(Tu(n,s));return Ra(t,i)}))}function uw(t,e){return uo((()=>Cu(jb(du(e,t)),-1)))}function cw(t,e){return uo((()=>Cu(vo(du(e,t)),-1)))}function lw(t,e){return uo((()=>{const n=du(t,e),s=aa(vo(t),_y(),Number.MAX_VALUE),i=vo(Ra(n,s));return hu(100,Cu(i,-1))}))}function hw(t,e){return uo((()=>{const n=aa(e,_y(),Number.MAX_VALUE),s=ru(xo(1,n)),i=aa(t,_y(),Number.MAX_VALUE),r=ru(xo(1,i));return Cu(jb(du(s,r)),-1)}))}function pw(t,e){return uo((()=>{const n=Tu(0,du(1,hu(t,e)));return Cu(jb(n),-1)}))}function dw(t,e){return uo((()=>{const n=Tu(0,du(1,hu(t,e)));return Cu(n,-1)}))}function fw(t,e){return uo((()=>{const n=mu(hu(t,e),-1),s=cu(hu(du(1,t),e),-1);return Tu(0,xo(1,du(s,n)))}))}function mw(t,e){return uo((()=>{const n=Math.log(2),s=du(e,t),i=du(xo(s,Dc(hu(-2,s))),n);return Cu(i,-1)}))}function gw(t,e,n=!1){return uo((()=>{if(n)e=$c(e);else{const t=mu(e,e.shape.length-1,!0);e=Ra(e,t)}return e=aa(e,_y(),1-_y()),Uu(mu(hu(t.toFloat(),ru(e)),e.shape.length-1))}))}function yw(t,e,n=!1){return uo((()=>{const s=Xa(Rb(t)).toInt();e=aa(e,_y(),1-_y());const i=e.shape,r=Xu(s,i[i.length-1]).reshape(i);return gw(r,e,n)}))}function bw(t,e){if(!S(t.shape,e.shape))throw new Iy(`logits and labels must have the same shape, but got shapes ${JSON.stringify(t.shape)} and ${JSON.stringify(e.shape)}`);return uo((()=>{const n=e.relu(),s=e.abs().neg();return n.sub(e.mul(t)).add(s.exp().log1p())}))}function vw(t,e){return uo((()=>{let n;return n=aa(e,_y(),1-_y()),n=ru(Ra(n,du(1,n))),Cu(bw(t,n),-1)}))}function ww(t,e){return uo((()=>{const n=aa(t,_y(),1),s=aa(e,_y(),1);return mu(hu(t,ru(Ra(n,s))),-1)}))}function xw(t,e){return uo((()=>{const n=ru(xo(_y(),e));return Cu(du(e,hu(t,n)),-1)}))}function _w(t,e){return uo((()=>{const n=aw(t,-1),s=aw(e,-1),i=hu(n,s);return Uu(mu(i,-1))}))}iw.constructors={};const kw={meanSquaredError:uw,meanAbsoluteError:cw,meanAbsolutePercentageError:lw,meanSquaredLogarithmicError:hw,squaredHinge:pw,hinge:dw,categoricalHinge:fw,logcosh:mw,categoricalCrossentropy:gw,sparseCategoricalCrossentropy:yw,binaryCrossentropy:vw,kullbackLeiblerDivergence:ww,poisson:xw,cosineProximity:_w};function Sw(t){if("string"===typeof t){if(t in kw)return kw[t];let e=`Unknown loss ${t}`;throw t.toLowerCase().includes("softmaxcrossentropy")&&(e=`Unknown loss ${t}. Use "categoricalCrossentropy" as the string name for tf.losses.softmaxCrossEntropy`),new Iy(e)}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Tw(t,e){return uo((()=>{const n=hu(.5,Ju(e)),s=Eb(Ja(e,n),t.dtype);return Cu(Ba(t,s),-1)}))}function Iw(t,e){return uo((()=>Eb(Ba(Co(t,-1),Co(e,-1)),"float32")))}function Cw(t,e){return uo((()=>vu(t.equal(1),e.equal(1)).sum().cast("float32")))}function Aw(t,e){return uo((()=>vu(t.equal(0),e.equal(1)).sum().cast("float32")))}function Nw(t,e){return uo((()=>{const n=Cw(t,e),s=Aw(t,e),i=n.add(s);return el(Ja(i,0),n.div(i),0).cast("float32")}))}function Ew(t,e){return vw(t,e)}function Ow(t,e){return t.rank===e.rank&&(t=t.squeeze([t.rank-1])),e=e.argMax(-1),e.dtype!==t.dtype&&(e=e.asType(t.dtype)),Ba(t,e).asType("float32")}const $w=uw,Rw=uw,Dw=cw,Mw=cw,Pw=lw,Fw=lw,Lw=gw,zw=_w,Bw=yw,qw={binaryAccuracy:Tw,categoricalAccuracy:Iw,precision:Nw,categoricalCrossentropy:Lw,sparseCategoricalCrossentropy:Bw,mse:$w,MSE:Rw,mae:Dw,MAE:Mw,mape:Pw,MAPE:Fw,cosine:zw};function Vw(t){if("string"===typeof t&&t in qw)return qw[t];if("string"!==typeof t&&null!=t)return t;throw new Iy(`Unknown metric ${t}`)}function Ww(t){if(Ey(null!==t,`Unknown LossOrMetricFn ${t}`),"string"===typeof t)return t;{let e;for(const n of Object.keys(kw))if(kw[n]===t){e=n;break}if(void 0!==e)return e;for(const n of Object.keys(qw))if(qw[n]===t){e=n;break}return void 0!==e?e:t.name}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function jw(t){const e={Adagrad:()=>ap.adagrad(.01),Adadelta:()=>ap.adadelta(1,.95,_y()),Adam:()=>ap.adam(.001,.9,.999,_y()),Adamax:()=>ap.adamax(.002,.9,.999,_y(),0),RMSProp:()=>ap.rmsprop(.001,.9,0,_y()),SGD:()=>ap.sgd(.01)};if(e["adagrad"]=e["Adagrad"],e["adadelta"]=e["Adadelta"],e["adam"]=e["Adam"],e["adamax"]=e["Adamax"],e["rmsprop"]=e["RMSProp"],e["sgd"]=e["SGD"],t in e)return e[t]();throw new Iy(`Unknown Optimizer ${t}`)}
/**
 * @license
 * Copyright 2019 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const Uw=1048576;function Gw(t,e,n=!1){if(null==t||"object"!==typeof t||Object.getPrototypeOf(t)!==Object.prototype||!Hw(t))throw new Error("User-defined metadata is expected to be a JSON object, but is not.");if(n){const n=JSON.stringify(t);n.length>Uw&&console.warn(`User-defined metadata of model "${e}" is too large in size (length=${n.length} when serialized). It is not recommended to store such large objects in user-defined metadata. Please make sure its serialized length is <= ${Uw}.`)}}function Hw(t){if(null===t)return!0;if("object"===typeof t){if(Object.getPrototypeOf(t)===Object.prototype){const e=Object.keys(t);for(const n of e){if("string"!==typeof n)return!1;if(!Hw(t[n]))return!1}return!0}if(Array.isArray(t)){for(const e of t)if(!Hw(e))return!1;return!0}return!1}{const e=typeof t;return"string"===e||"number"===e||"boolean"===e}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Kw(t,e,n,s=console.log){const i=Qw(t),r=["Layer (type)","Output shape","Param #"];let o;if(i?(e=e||65,n=n||[.45,.85,1]):(e=e||98,n=n||[.33,.55,.67,1]),n[n.length-1]<=1&&(n=n.map((t=>Math.floor(e*t)))),!i){r.push("Receives inputs"),o=[];for(const e in t.nodesByDepth)o.push(...t.nodesByDepth[e])}s("_".repeat(e)),Yw(r,n,s),s("=".repeat(e));const a=t.layers;for(let l=0;l<a.length;++l)i?Zw(a[l],n,s):Jw(a[l],n,o,s),s((l===a.length-1?"=":"_").repeat(e));t.checkTrainableWeightsConsistency();const u=Xw(t),c=Ov(t.nonTrainableWeights);s(`Total params: ${u+c}`),s(`Trainable params: ${u}`),s(`Non-trainable params: ${c}`),s("_".repeat(e))}function Xw(t){let e;return e=null!=t.collectedTrainableWeights?Ov(t.collectedTrainableWeights):Ov(t.trainableWeights),e}function Qw(t){let e=!0;const n=[],s=[];for(const i in t.nodesByDepth)n.push(t.nodesByDepth[i]);for(const i of n){if(i.length>1||1===i.length&&i[0].inboundLayers.length>1){e=!1;break}s.push(...i)}if(e)for(const i of t.layers){let t=!1;for(const n of i.inboundNodes)if(-1!==s.indexOf(n)){if(t){e=!1;break}t=!0}if(!e)break}return e}function Yw(t,e,n=console.log){let s="";for(let i=0;i<t.length;++i)i>0&&(s=s.slice(0,s.length-1)+" "),s+=t[i],s=s.slice(0,e[i]),s+=" ".repeat(e[i]-s.length);n(s)}function Zw(t,e,n){let s;try{s=JSON.stringify(t.outputShape)}catch(x6){s="multiple"}const i=t.name,r=t.getClassName(),o=[`${i} (${r})`,s,t.countParams().toString()];Yw(o,e,n)}function Jw(t,e,n,s){let i;try{i=JSON.stringify(t.outputShape)}catch(x6){i="multiple"}const r=[];for(const l of t.inboundNodes)if(!(null!=n&&n.length>0&&-1===n.indexOf(l)))for(let t=0;t<l.inboundLayers.length;++t){const e=l.inboundLayers[t].name,n=l.nodeIndices[t],s=l.tensorIndices[t];r.push(`${e}[${n}][${s}]`)}const o=t.name,a=t.getClassName(),u=0===r.length?"":r[0],c=[`${o} (${a})`,i,t.countParams().toString(),u];Yw(c,e,s);for(let l=1;l<r.length;++l)Yw(["","","",r[l]],e,s)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function tx(t,e,n){return("inboundNodes"===t||"outputLayers"===t||"inputLayers"===t)&&0===e&&"string"===typeof n}function ex(t,e){if(null===t)return null;if("string"===typeof t)return My(t);if("number"===typeof t||"boolean"===typeof t)return t;if(t instanceof Array){const n=[],s=t.length;for(let i=0;i<s;++i){const s=t[i];tx(e,i,s)?n.push(s):n.push(ex(s,e))}return n}{const e={};for(const n of Object.keys(t)){const s=t[n];if("name"===n&&"string"===typeof s)e[n]=s;else{const t=My(n);e[t]=ex(s,t)}}return e}}function nx(t,e){if(null===t||void 0===t)return null;if("string"===typeof t)return Dy(t);if("number"===typeof t||"boolean"===typeof t)return t;if(t instanceof Array){const n=[],s=t.length;for(let i=0;i<s;++i){const s=t[i];tx(e,i,s)?n.push(s):n.push(nx(s,e))}return n}{const e={};for(const n of Object.keys(t)){const s=t[n],i=Dy(n);e[i]="name"!==n&&"className"!==n||"string"!==typeof s?nx(s,n):s}return e}}
/** @license See the LICENSE file. */
const sx="2.8.6";
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function ix(t,e){if(null==t.dtype||t.dtype===e.dtype)return e;try{return gr(e,t.dtype)}catch(x6){throw new Iy(`The dtype of the feed (${e.dtype}) can not be cast to the dtype of the key '${t.name}' (${t.dtype}).`)}}class rx{constructor(t){if(this.id2Value={},this.id2Mask={},this.name2Id={},t instanceof rx)for(const e in t.id2Value)this.id2Value[e]=t.id2Value[e],e in t.id2Mask&&(this.id2Mask[e]=t.id2Mask[e]);else{if(null==t)return;for(const e of t)this.add(e.key,e.value)}}add(t,e,n){if(null!=this.id2Value[t.id])throw new Iy(`Duplicate key: name=${t.name}, id=${t.id}`);return this.id2Value[t.id]=ix(t,e),this.name2Id[t.name]=t.id,null!=n&&(this.id2Mask[t.id]=n),this}addFeed(t){this.add(t.key,t.value)}hasKey(t){return null!=this.id2Value[t.id]}names(){return Object.keys(this.name2Id)}getValue(t){if(t instanceof Lv){if(null==this.id2Value[t.id])throw new Iy(`Nonexistent key: ${t.name}`);return this.id2Value[t.id]}{const e=this.name2Id[t];if(null==e)throw new Iy(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Value[e]}}getMask(t){if(t instanceof Lv){if(null==this.id2Value[t.id])throw new Iy(`Nonexistent key: ${t.name}`);return this.id2Mask[t.id]}{const e=this.name2Id[t];if(null==e)throw new Iy(`Feed dict has no SymbolicTensor name: ${t}`);return this.id2Mask[e]}}disposeMasks(){null!=this.id2Mask&&co(this.id2Mask)}}const ox={},ax={};function ux(t,e,n,s){const i=null!=n&&n["training"],r=Array.isArray(t),o=r?t:[t],a=o.map((t=>t.name)),u=[],c=e.names();for(const f of a)-1!==c.indexOf(f)?u.push(e.getValue(f)):u.push(null);null!=s&&(s.maxNumTensors=-1/0,s.minNumTensors=1/0);const l=a.join(",")+"|"+e.names().join(",");let h,p;if(null==ox[l]){const t=cx(o,e);h=t.sorted,p=t.recipientCounts,ox[l]=h,ax[l]=p}h=ox[l],p={},i||Object.assign(p,ax[l]);const d=new rx(e);for(let f=0;f<h.length;++f){if(null!=s){const t=ao().numTensors;t>s.maxNumTensors&&(s.maxNumTensors=t),t<s.minNumTensors&&(s.minNumTensors=t)}const t=h[f],r=t.sourceLayer;if(r instanceof Gv)continue;const o=[],c=[],l=[];let m=!1;for(const n of t.inputs){const t=d.getValue(n),s=d.getMask(n);o.push(t),c.push(s),null!=s&&(m=!0),i||(p[n.name]--,0!==p[n.name]||e.hasKey(n)||-1!==a.indexOf(n.name)||t.isDisposed||!0===n.sourceLayer.stateful||l.push(t))}m&&(n=n||{},n["mask"]=c[0]);const g=Ry(r.apply(o,n));let y=null;r.supportsMasking&&(y=r.computeMask(o,c));const b=px(t),v=Array.isArray(b)?b:[b];for(let e=0;e<v.length;++e){d.hasKey(v[e])||d.add(v[e],g[e],Array.isArray(y)?y[0]:y);const t=a.indexOf(v[e].name);-1!==t&&(u[t]=g[e])}i||co(l)}return d.disposeMasks(),r?u:u[0]}function cx(t,e){v(null!=t&&t.length>0,(()=>"Expected at least one fetch, got none"));let n=[],s={};if(1===t.length){const i=hx(t[0],e);n=i.sorted,s=i.recipientMap}else{const i=new Set;for(const r of t){const{sorted:t,recipientMap:o}=hx(r,e);for(const e of t)i.has(e.name)||(n.push(e),i.add(e.name));for(const e in o)null==s[e]&&(s[e]=new Set),o[e].forEach((t=>s[e].add(t)))}}return{sorted:n,recipientCounts:lx(s)}}function lx(t){const e={};for(const n in t)e[n]=t[n].size;return e}function hx(t,e){const n=new Set,s=[],i={};for(const a of e.names())n.add(a);const r=[],o=[];r.push(t);while(r.length>0){const t=r[r.length-1];if(n.has(t.name)){r.pop();continue}const e=o[o.length-1]===r.length-1;if(0===t.inputs.length||e)r.pop(),s.push(t),n.add(t.name),e&&o.pop();else{o.push(r.length-1);for(const e of t.inputs)null==i[e.name]&&(i[e.name]=new Set),i[e.name].add(t.name),n.has(e.name)||r.push(e)}}return{sorted:s,recipientMap:i}}function px(t){let e;if(1===t.sourceLayer.inboundNodes.length)e=t.sourceLayer.output;else{let n=null;for(let e=0;e<t.sourceLayer.inboundNodes.length;++e)for(const s of t.sourceLayer.inboundNodes[e].outputTensors)if(s.id===t.id){n=e;break}e=t.sourceLayer.getOutputAt(n)}return e}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class dx extends Vv{constructor(t){if(super({}),this.containerNodes=new Set,this.name=t.name,null==this.name){const t=this.getClassName().toLowerCase();this.name=Iv(t)}if(this.supportsMasking=!1,this.trainable_=!0,Array.isArray(t.inputs)?this.inputs=t.inputs.slice():this.inputs=[t.inputs],Array.isArray(t.outputs)?this.outputs=t.outputs.slice():this.outputs=[t.outputs],Vy(this.inputs).length!==this.inputs.length)throw new Iy(`The list of inputs passed to the model is redundant. All inputs should only appear once. Found: ${this.inputs.map((t=>t.name))}`);Vy(this.outputs).length!==this.outputs.length&&console.warn(`The list of outputs passed to the model is redundant. All outputs should only appear once. Found: ${this.outputs.map((t=>t.name))}`),this.inputLayers=[],this.inputLayersNodeIndices=[],this.inputLayersTensorIndices=[],this.outputLayers=[],this.outputLayersNodeIndices=[],this.outputLayersTensorIndices=[],this.layers=[],this.internalContainerRefs=[];for(const y of this.outputs){const t=y.sourceLayer,e=y.nodeIndex,n=y.tensorIndex;this.outputLayers.push(t),this.outputLayersNodeIndices.push(e),this.outputLayersTensorIndices.push(n)}for(const y of this.inputs){const t=y.sourceLayer,e=y.nodeIndex,n=y.tensorIndex;Ey(0===e,"input layer has >1 nodes"),Ey(0===n,"input layer has >1 tensors"),this.inputLayers.push(t),this.inputLayersNodeIndices.push(e),this.inputLayersTensorIndices.push(n)}this.inputNames=[],this.outputNames=[],this.feedInputShapes=[],this.feedInputNames=[],this.feedOutputNames=[];for(let y=0;y<this.inputLayers.length;y++){const e=this.inputLayers[y];if(!(e instanceof Gv))throw new TypeError(`Input layers to a LayersModel must be InputLayer objects. Received inputs: ${t.inputs}. Input ${y} (0-based) originates from layer type ${e.getClassName()}.`);this.inputNames.push(e.name),this.feedInputShapes.push(e.batchInputShape),this.feedInputNames.push(e.name)}for(const y of this.outputLayers)this.outputNames.push(y.name);this.internalInputShapes=this.inputs.map((t=>t.shape)),this.internalOutputShapes=this.outputs.map((t=>t.shape));const e={},n={},s={},i={},r={},o=[],a=(t,e,n,s,i,u)=>{null!=s&&null!=i&&null!=u||(s=t.sourceLayer,i=t.nodeIndex,u=t.tensorIndex);const c=s.inboundNodes[i];if(-1!==n.indexOf(c))throw new Ty(`The tensor ${t.name} at layer "${s.name}" is part of a cycle.`);if(-1!==e.indexOf(c))return;this.containerNodes.add(dx.nodeKey(s,i)),s.id in r||(r[s.id]=Object.keys(r).length),-1===n.indexOf(c)&&n.push(c);const l=c.inboundLayers.length;for(let r=0;r<l;r++){const t=c.inputTensors[r],s=c.inboundLayers[r],i=c.nodeIndices[r],o=c.tensorIndices[r];a(t,e,n,s,i,o)}e.push(c);while(n.indexOf(c)>=0)n.splice(n.indexOf(c),1);o.push(c)},u=[],c=[];for(const y of this.outputs)a(y,u,c);const l=o.slice().reverse();for(const y of l){n[y.id]=y,y.id in e||(e[y.id]=0);let t=e[y.id];const r=null==s[y.outboundLayer.id]?0:s[y.outboundLayer.id];t=Math.max(t,r),s[y.outboundLayer.id]=t,i[y.outboundLayer.id]=y.outboundLayer,e[y.id]=t;for(let s=0;s<y.inboundLayers.length;s++){const i=y.inboundLayers[s],r=y.nodeIndices[s],o=i.inboundNodes[r],a=null==e[o.id]?0:e[o.id];e[o.id]=Math.max(t+1,a),n[o.id]=o}}const h={};for(const y in e){const t=e[y];t in h||(h[t]=[]),h[t].push(n[y])}const p={};for(const y in s){const t=s[y];t in p||(p[t]=[]),p[t].push(i[y])}let d=Object.keys(p).map((t=>parseInt(t,10))).sort(qy);this.layers=[];for(const y of d){const t=p[y];t.sort(((t,e)=>{const n=r[t.id],s=r[e.id];return n<s?-1:n>s?1:0}));for(const e of t)e instanceof dx&&this.internalContainerRefs.push(e),this.layers.push(e)}this.layersByDepth=p,d=Object.keys(h).map((t=>parseInt(t,10))).sort(qy);const f=this.inputs.slice(),m=[];for(const y of d)for(const t of h[y]){const e=t.outboundLayer;if(null!=e){for(const n of t.inputTensors)if(-1===f.indexOf(n))throw new Ty(`Graph disconnected: cannot obtain value for tensor ${n} at layer "${e.name}". The following previous layers were accessed without issue: ${m}`);for(const e of t.outputTensors)f.push(e);m.push(e.name)}}this.nodesByDepth=h;const g=this.layers.map((t=>t.name));for(const y of g){const t=g.filter((t=>t===y)).length;if(1!==t)throw new Ty(`The name "${y}" is used ${t} times in the model. All layer names should be unique. Layer names: `+JSON.stringify(g))}this.outboundNodes=[],this.inboundNodes=[],new Bv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:this.inputs.map((t=>null)),outputMasks:this.outputs.map((t=>null)),inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs.map((t=>t.shape))}),this.built=!0,this._refCount=1}assertNotDisposed(){if(0===this._refCount)throw new Error(`Container '${this.name}' is already disposed.`)}dispose(){this.assertNotDisposed();const t={refCountAfterDispose:null,numDisposedVariables:0};if(0===--this._refCount){for(const e of this.layers)t.numDisposedVariables+=e.dispose().numDisposedVariables;for(const e of this.internalContainerRefs)t.numDisposedVariables+=e.dispose().numDisposedVariables}return t.refCountAfterDispose=this._refCount,t}get trainable(){return this.trainable_}set trainable(t){this.layers.forEach((e=>{e._trainableWeights.forEach((e=>e.trainable=t))})),this.trainable_=t}get trainableWeights(){if(this._trainableWeights.length>0)throw new Iy("Container instance unexpectedly contains _trainableWeights.The trainable weights of a Container are a union of the trainable weights of its consituent Layers. Its own _trainableWeights must remain an empty Array.");if(!this.trainable)return[];let t=[];for(const e of this.layers)t=t.concat(e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.layers)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.layers)e.push(...t.trainableWeights);return e.concat(t)}return t}get weights(){return this.trainableWeights.concat(this.nonTrainableWeights)}loadWeights(t,e=!0){const n={};let s=0;for(const r of this.layers)for(const t of r.weights){if(null!=n[t.originalName])throw new Iy(`Duplicate weight name: ${t.originalName}`);n[t.originalName]=t,s++}const i=[];for(const r in t){let s=r;if(null==n[r]){const t=r.split("/"),e=t.slice(0,-2).concat([t[t.length-1]]);s=e.join("/")}if(null!=n[s])i.push([n[s],t[r]]);else if(e)throw new Iy(`Provided weight data has no target variable: ${r}`);delete n[s]}if(e){const t=[];for(const e in n)t.push(e);if(t.length>0)throw new Iy(`${t.length} of ${s} weights are not set: ${t}`)}Pv(i)}updatedConfig(){const t=this.getConfig(),e={};return e["className"]=this.getClassName(),e["config"]=t,e["kerasVersion"]=`tfjs-layers ${sx}`,e["backend"]="TensorFlow.js",e}toJSON(t,e=!0){const n=nx(this.updatedConfig());return e?JSON.stringify(n):n}call(t,e){return uo((()=>{t=Ry(t);const n=new rx;for(let e=0;e<this.inputs.length;++e)n.add(this.inputs[e],t[e]);return ux(this.outputs,n,e)}))}computeMask(t,e){return uo((()=>{let n;return t=Ry(t),n=null==e?Ny(null,t.length):Ry(e),this.runInternalGraph(t,n)[1]}))}computeOutputShape(t){const e=Av(t);if(e.length!==this.inputLayers.length)throw new Iy(`Invalid inputShape argument ${t}: model has ${this.inputLayers.length} tensor inputs.`);const n={};for(let o=0;o<e.length;o++){const t=this.inputLayers[o],s=e[o],i=t.name+"_0_0";n[i]=s}const s=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(qy);if(s.length>1)for(const o of s){const t=this.nodesByDepth[o];for(const e of t){const t=e.outboundLayer;if(-1!==this.inputLayers.map((t=>t.id)).indexOf(t.id))continue;const s=[];for(let a=0;a<e.inboundLayers.length;a++){const t=e.inboundLayers[a],i=e.nodeIndices[a],r=e.tensorIndices[a],o=`${t.name}_${i}_${r}`,u=n[o];s.push(u)}const i=t.computeOutputShape($y(s)),r=Av(i),o=t.inboundNodes.indexOf(e);for(let e=0;e<r.length;e++){const s=`${t.name}_${o}_${e}`;n[s]=r[e]}}}const i=[],r=[];for(let o=0;o<this.outputLayers.length;o++){const t=this.outputLayers[o],e=this.outputLayersNodeIndices[o],n=this.outputLayersTensorIndices[o],s=`${t.name}_${e}_${n}`;r.push(s)}for(let o=0;o<r.length;o++){const t=r[o];Ey(t in n),i.push(n[t])}return $y(i)}runInternalGraph(t,e){null==e&&(e=Ny(null,t.length));const n={};for(let a=0;a<this.inputs.length;++a){const s=this.inputs[a],i=t[a],r=e[a];n[s.id]=[i,r]}const s=Object.keys(this.nodesByDepth).map((t=>parseInt(t,10))).sort(qy);for(const a of s){const t=this.nodesByDepth[a];for(const e of t){const t=e.outboundLayer,s=e.inputTensors,i=e.outputTensors,r=new Array;for(const e of s)e.id in n&&r.push(n[e.id]);if(r.length===s.length){let s,o,a,u,c={};if(null!=e.callArgs&&(c=e.callArgs),1===r.length){const[e,n]=r[0];null==c["mask"]&&(c["mask"]=n),a=Ry(t.call(e,c)),u=Ry(t.computeMask(e,n)),s=[e],o=[n]}else s=r.map((t=>t[0])),o=r.map((t=>t[1])),null==c["mask"]&&(c["mask"]=o),a=Ry(t.call(s,c)),u=Ry(t.computeMask(s,o));if(t.activityRegularizer)throw new Cy("LayersModel invocation with concrete Tensor value(s) in the presence of activity regularizer(s) is not supported yet.");for(let t=0;t<i.length;++t){const e=i[t],s=a[t],r=u[t];n[e.id]=[s,r]}}}}const i=[],r=[],o=[];for(const a of this.outputs){Ey(a.id in n,`Could not compute output ${a.name} : ${a.id}`);const[t,e]=n[a.id];o.push(t.shape),i.push(t),r.push(e)}return[i,r,o]}buildNodeConversionMap(t){const e={};let n;for(const s of this.layers){n=s instanceof dx?1:0;for(let t=0;t<s.inboundNodes.length;t++){const i=dx.nodeKey(s,t);this.containerNodes.has(i)&&(e[i]=n,n+=1)}}return e}getLayer(t,e){if(null!=e){if(this.layers.length<=e)throw new Iy(`Was asked to retrieve layer at index ${e}, but model only has ${this.layers.length} layer(s).`);return this.layers[e]}if(null==t)throw new Iy("Provide either a layer name or layer index");for(const n of this.layers)if(n.name===t)return n;throw new Iy(`No such layer: ${t}`)}calculateLosses(){return uo((()=>{const t=[];for(const e of this.layers)for(let n=0;n<e.inboundNodes.length;++n){const s=dx.nodeKey(e,n);this.containerNodes.has(s)&&t.push(...e.calculateLosses())}return t}))}getConfig(){const t={name:this.name},e=this.buildNodeConversionMap(this.layers),n=[];for(const r of this.layers){const t=r.getClassName(),s=r.getConfig(),i=[];for(let n=0;n<r.inboundNodes.length;n++){const t=r.inboundNodes[n],s=dx.nodeKey(r,n);let o={};if(this.containerNodes.has(s)){if(t.callArgs)try{JSON.stringify(t.callArgs),o=t.callArgs}catch(x6){console.warn(`Layer ${r.name} was passed non-serializable keyword arguments: ${t.callArgs}. They will not be included in the serialized model (and thus will be missing at deserialization time).`),o={}}if(t.inboundLayers.length>0){const n=[];for(let s=0;s<t.inboundLayers.length;s++){const i=t.inboundLayers[s],r=t.nodeIndices[s],a=t.tensorIndices[s],u=dx.nodeKey(i,r);let c=e[u];null==c&&(c=0),n.push([i.name,c,a,o])}i.push(n)}}}const o={};o["name"]=r.name,o["className"]=t,o["config"]=s,o["inboundNodes"]=i,n.push(o)}t["layers"]=n;const s=[];for(let r=0;r<this.inputLayers.length;r++){const t=this.inputLayers[r],n=this.inputLayersNodeIndices[r],i=dx.nodeKey(t,n);if(!this.containerNodes.has(i))continue;let o=e[i];null!==o&&void 0!==o||(o=0);const a=this.inputLayersTensorIndices[r];s.push([t.name,o,a])}t["inputLayers"]=s;const i=[];for(let r=0;r<this.outputLayers.length;r++){const t=this.outputLayers[r],n=this.outputLayersNodeIndices[r],s=dx.nodeKey(t,n);if(!this.containerNodes.has(s))continue;let o=e[s];null!==o&&void 0!==o||(o=0);const a=this.outputLayersTensorIndices[r];i.push([t.name,o,a])}return t["outputLayers"]=i,t}static fromConfig(t,e,n={},s=!1){const i={},r={};function o(t,e){t.name in r?r[t.name].push(e):r[t.name]=[e]}function a(t,e){const n=[];let s;for(const r of e){const a=r[0],u=r[1],c=r[2];if(s=null==r[3]?{}:r[3],!(a in i))return void o(t,e);const l=i[a];if(l.inboundNodes.length<=u)return void o(t,e);const h=l.inboundNodes[u];n.push(h.outputTensors[c])}n.length>0&&t.apply($y(n),s)}function u(t){const n=t["name"],r=ow(t,null!=e["customObjects"]?e["customObjects"]:{});r.setFastWeightInitDuringBuild(s),i[n]=r;const a=t["inboundNodes"];a.forEach((t=>{if(!(t instanceof Array))throw new Iy(`Corrupted configuration, expected array for nodeData: ${t}`);o(r,t)}))}const c=e["name"],l=e["layers"];for(const m of l)u(m);while(!Wy(r))for(const t of l){const e=i[t["name"]];if(e.name in r){const t=r[e.name];delete r[e.name];for(const n of t)a(e,n)}}const h=[],p=[],d=e["inputLayers"];for(const m of d){const t=m[0],e=m[1],n=m[2];Ey(t in i);const s=i[t],r=s.inboundNodes[e].outputTensors;h.push(r[n])}const f=e["outputLayers"];for(const m of f){const t=m[0],e=m[1],n=m[2];Ey(t in i);const s=i[t],r=s.inboundNodes[e].outputTensors;p.push(r[n])}return new t({inputs:h,outputs:p,name:c})}get stateful(){if(this._stateful)throw new Iy("Container instance unexpectedly has _stateful = true. The statefulness of a Container is determined by the Layers it contains. Its _stateful property must remain the default false.");for(const t of this.layers)if(t.stateful)return!0;return!1}resetStates(){uo((()=>{this.layers.forEach((t=>{t.stateful&&t.resetStates()}))}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function fx(t,e,n){const s=e.length;if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>null));if(1===s)return Array.isArray(t)&&1===t.length?t:"object"===typeof t&&e[0]in t?[t[e[0]]]:[t];if(Array.isArray(t)){if(t.length!==s)throw new Error(`Provided ${n} is an array of ${t.length} element(s), but the model has ${s} outputs. Make sure a set of weights is provided for each model output.`);return t}if("object"===typeof t&&Object.keys(t).length>0&&"object"===typeof t[Object.keys(t)[0]]){const n=[];return e.forEach((e=>{e in t?n.push(t[e]):n.push(null)})),n}throw new Error(`The model has multiple (${s}) outputs, so ${n} must be either an array with ${s} elements or an object with ${e} keys. Provided ${n} not understood: ${JSON.stringify(t)}`)}function mx(t,e){return fx(t,e,"classWeight")}async function gx(t,e,n,s){if(null!=e||null!=s)throw new Error("Support sampleWeight is not implemented yet");if(null!=n){const e=uo((()=>{if(1===t.shape.length)return t.clone();if(2===t.shape.length){if(t.shape[1]>1){const e=1;return t.argMax(e)}if(1===t.shape[1])return t.reshape([t.shape[0]]);throw new Error(`Encountered unexpected last-dimension size (${t.shape[1]}) during handling of class weights. The size is expected to be >= 1.`)}throw new Error(`Unexpected rank of target (y) tensor (${t.rank}) during handling of class weights. The rank is expected to be 1 or 2.`)})),s=Array.from(await e.data());co(e);const i=[];return s.forEach((t=>{if(null==n[t])throw new Error(`classWeight must contain all classes in the training data. The class ${t} exists in the data but not in classWeight`);i.push(n[t])})),Uc(i,"float32")}return null}function yx(t,e){return hu(t,e)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
const bx=32;function vx(t,e){let n,s;const i=e;n=i["xs"],s=i["ys"],v(null!=n&&null!=s,(()=>`A Dataset iterator for fitDataset() is expected to generate objects of the form \`{xs: xVal, ys: yVal}\`, where the two values may be \`tf.Tensor\`, an array of Tensors, or a map of string to Tensor.  The provided Dataset instead generates ${e}`));const r=wx("input",t.inputNames,n),o=wx("output",t.outputNames,s),a=r[0].shape[0];v(r.length===t.inputs.length,(()=>`LayersModel has ${t.inputs.length} inputs, but the dataset provides ${r.length} inputs.  (Expected input keys: ${JSON.stringify(t.inputNames)})`)),v(o.length===t.outputs.length,(()=>`LayersModel has ${t.outputs.length} outputs, but the dataset provides ${o.length} outputs.  (Expected output keys: ${JSON.stringify(t.outputNames)})`));for(let u=0;u<r.length;u++)v(r[u].shape[0]===a,(()=>`Batch size mismatch: input ${t.inputNames[u]} has ${r[u].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));for(let u=0;u<o.length;u++)v(o[u].shape[0]===a,(()=>`Batch size mismatch: output ${t.outputNames[u]} has ${o[u].shape[0]}; expected  ${a} based on input ${t.inputNames[0]}.`));return{xs:r,ys:o}}function wx(t,e,n){if(n instanceof js)return[n];if(Array.isArray(n))return v(n.length===e.length,(()=>`Received an array of ${n.length} Tensors, but expected ${e.length} to match the ${t} keys ${e}.`)),n;{const s=[];for(const i of e){if(null==n[i])throw new Iy(`The feature data generated by the dataset lacks the required ${t} key '${i}'.`);s.push(n[i])}return s}}function xx(t){if(3===t.length)throw new Cy("Validation with sample weights is not implemented yet.");return{xs:t[0],ys:t[1]}}async function _x(t,e,n){const s=null!=n.batchesPerEpoch;if(v(null!=t.optimizer,(()=>"You must compile a model before training/testing. Use LayersModel.compile(modelCompileConfig).")),v(null!=n,(()=>"For fitDataset(), the 2nd argument (config) is required, but it is not provided in this call.")),v(null!=n.epochs&&n.epochs>0&&Number.isInteger(n.epochs),(()=>`For fitDataset(), config.epochs is expected to be a positive integer, but got ${n.epochs}`)),v(!s||n.batchesPerEpoch>0&&Number.isInteger(n.batchesPerEpoch),(()=>`For fitDataset(), config.batchesPerEpoch is expected to be a positive integer if specified, but got ${n.batchesPerEpoch}`)),v(null==n["validationSplit"],(()=>"`validationSplit` is not supported by `fitDataset()`. Use validationData instead.")),t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");t.isTraining=!0;try{const i=null!=n.validationData;let r,o;if(i)if(Sx(n.validationData))v(null==n.validationBatches||n.validationBatches>0&&Number.isInteger(n.validationBatches),(()=>`For fitDataset() with dataset-based validation, config.validationBatches is expected not to be provided, or to be a positive integer, but got ${n.validationBatches}`));else{const t=xx(n.validationData);r=t.xs,o=t.ys}const a=t.makeTrainFunction(),u=t.getDedupedMetricsNames();let c;c=i?u.slice().concat(u.map((t=>"val_"+t))):u.slice();const l=sw(n.callbacks,n.yieldEvery),h=null==n.verbose?1:n.verbose,{callbackList:p,history:d}=rw(l,h,n.epochs,null,null,kx(e,n),null,i,c);p.setModel(t),t.history=d,await p.onTrainBegin(),t.stopTraining_=!1;let f=null==n.initialEpoch?0:n.initialEpoch,m=await e.iterator();while(f<n.epochs){const c={};await p.onEpochBegin(f);let l=0,h=0;s||(m=await e.iterator());while(!s||l<n.batchesPerEpoch){const e=await m.next();if(s&&e.done){console.warn(`You provided \`batchesPerEpoch\` as ${n.batchesPerEpoch}, but your dataset iterator ran out of data after ${l} batches; interrupting training. Make sure that your dataset can generate at least \`batchesPerEpoch * epochs\` batches (in this case, `+n.batchesPerEpoch*n.epochs+" batches). You may need to use the repeat() function when building your dataset.");break}if(null!=e.value){const{xs:s,ys:i}=vx(t,e.value),r={};r["batch"]=h,r["size"]=s[0].shape[0],await p.onBatchBegin(h,r);const o=[];if(null!=n.classWeight){const e=mx(n.classWeight,t.outputNames);for(let t=0;t<e.length;++t)o.push(await gx(i[t],null,e[t]))}const c=s.concat(i).concat(o),d=a(c);co(c);for(let t=0;t<u.length;++t){const e=u[t],n=d[t];r[e]=n,lo(n)}await p.onBatchEnd(h,r),Xv(r),h++,l++}if(s?l>=n.batchesPerEpoch:e.done){if(i){let e;e=Sx(n.validationData)?Ry(await t.evaluateDataset(n.validationData,{batches:n.validationBatches})):Ry(t.evaluate(r,o,{batchSize:null==n.validationBatchSize?bx:n.validationBatchSize,verbose:0}));for(let n=0;n<t.metricsNames.length;++n)c[`val_${t.metricsNames[n]}`]=e[n]}break}if(t.stopTraining_)break}if(await p.onEpochEnd(f,c),f++,t.stopTraining_)break}return await p.onTrainEnd(),await t.history.syncData(),t.history}finally{t.isTraining=!1}}function kx(t,e){let n=null;return null!=e.batchesPerEpoch?n=e.batchesPerEpoch:Number.isFinite(t.size)&&(n=t.size),n}function Sx(t){return"function"===typeof t.iterator}function Tx(t){return"function"===typeof t.next}async function Ix(t,e,n){n=n||{};const s=null!=n.batches,i=t.testFunction;let r=[];if(n.verbose>0)throw new Cy("Verbose mode is not implemented yet.");v(!s||n.batches>0&&Number.isInteger(n.batches),(()=>`Test loop expects \`batches\` to be a positive integer, but received ${JSON.stringify(n.batches)}`));const o=Tx(e)?e:await e.iterator();let a=0,u=0;while(!s||u<n.batches){const e=await o.next();if(r=uo((()=>{if(e.value){const{xs:n,ys:s}=vx(t,e.value),o=n.concat(s),c=uo((()=>i(o)));if(co(o),0===u)for(let t=0;t<c.length;++t)r.push(go(0));const l=o[0].shape[0];for(let t=0;t<c.length;++t){const e=c[t],n=r[t];r[t]=uo((()=>xo(r[t],hu(l,e)))),u>0&&co(n)}co(c),a+=l,++u}return r})),e.done){s&&console.warn(`Your dataset iterator ran out of data during evaluateDataset(). Interrupting evalution. Make sure that your dataset can generate at least \`batches\` batches (in this case, ${n.batches} batches). You may need to use the repeat() function when building your dataset.`);break}}for(let c=0;c<r.length;++c){const t=r[c];r[c]=Ra(r[c],a),co(t)}return $y(r)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Cx(t){v(t>0&&Number.isInteger(t),(()=>`batchSize is required to be a positive integer, but got ${t}`))}function Ax(t,e,n){return null==t?[null]:Array.isArray(t)?t.map((t=>Mb(t,e,n-e))):Mb(t,e,n-e)}function Nx(t,e){return uo((()=>null==t?null:Array.isArray(t)?t.map((t=>Nx(t,e))):Wb(t,"int32"===e.dtype?e:e.toInt())))}function Ex(t,e){const n=[];let s=0,i=null;while(s<t)i=s+e,i>=t&&(i=t),n.push([s,i]),s=i;return n}async function Ox(t,e,n,s,i,r,o,a,u,c,l,h,p,d,f){null==i&&(i=32),null==r&&(r=1),null==l&&(l=!0),null==p&&(p=0);let g=!1;if(null!=u&&null!=c&&(g=!0),null!=f&&(g=!0,null==d))throw new Iy("Can only use `validationSteps` when doing step-wise training, i.e., `stepsPerEpoch` must be set.");const y=t.checkNumSamples(n,i,d,"steps_per_epoch");let b;null!=y&&(b=Nb(0,y)),null==o&&(o=1);const{callbackList:v,history:w}=rw(a,o,r,p,y,d,i,g,h);v.setModel(t),t.history=w,await v.onTrainBegin(),t.stopTraining_=!1;for(let x=p;x<r;++x){await v.onEpochBegin(x);const r={};if(null!=d)throw new Cy("stepsPerEpoch mode is not implemented yet.");{if("batch"===l)throw new Cy("batch shuffling is not implemneted yet");l&&m(b);const o=Uc(b),a=Ex(y,i);for(let l=0;l<a.length;++l){const h={};if(await v.onBatchBegin(l,h),uo((()=>{const p=a[l][0],d=a[l][1],f=Mb(o,p,d-p);h["batch"]=l,h["size"]=d-p;const m=Nx(n,f),y=e(m);for(let t=0;t<s.length;++t){const e=s[t],n=y[t];h[e]=n,lo(n)}if(l===a.length-1&&g){const e=t.testLoop(u,c,i);for(let t=0;t<s.length;++t){const n=s[t],i=e[t];lo(i),r["val_"+n]=i}}})),await v.onBatchEnd(l,h),Xv(h),t.stopTraining_)break}o.dispose()}if(await v.onEpochEnd(x,r),t.stopTraining_)break}return await v.onTrainEnd(),await t.history.syncData(),t.history}async function $x(t,e,n,s={}){if(t.isTraining)throw new Error("Cannot start training because another fit() call is ongoing.");let i,r,o,a,u,c,l;t.isTraining=!0;try{const h=null==s.batchSize?32:s.batchSize;Cx(h);const p=!1,d=await t.standardizeUserData(e,n,s.sampleWeight,s.classWeight,p,h);i=d[0],r=d[1],l=d[2];let f,m=!1;if(null!=s.validationData&&s.validationData.length>0){if(m=!0,2!==s.validationData.length)throw 3===s.validationData.length?new Cy("validationData including sample weights is not supported yet."):new Iy(`When passing validation data, it must contain 2 (valX, valY) or 3 (valX, valY, valSampleWeight) items; ${s.validationData} is invalid.`);o=s.validationData[0],a=s.validationData[1];const e=!0,n=await t.standardizeUserData(o,a,null,null,e,h);u=n[0],c=n[1],f=u.concat(c)}else if(null!=s.validationSplit&&s.validationSplit>0&&s.validationSplit<1){m=!0;const t=Math.floor(i[0].shape[0]*(1-s.validationSplit)),e=i[0].shape[0];u=Ax(i,t,e),i=Ax(i,0,t),c=Ax(r,t,e),r=Ax(r,0,t),f=u.concat(c)}else null!=s.validationSteps&&(m=!0);const g=i.concat(r).concat(l);t.checkTrainableWeightsConsistency();const y=t.makeTrainFunction(),b=t.getDedupedMetricsNames();let v,w;m?(t.makeTestFunction(),v=t.testFunction,w=b.slice().concat(b.map((t=>"val_"+t)))):(v=null,f=[],w=b.slice());const x=sw(s.callbacks,s.yieldEvery),_=await Ox(t,y,g,b,h,s.epochs,s.verbose,x,v,f,s.shuffle,w,s.initialEpoch,null,null);return _}finally{t.isTraining=!1,Dx(i,e),Dx(r,n),Dx(u,o),Dx(c,a),null!=l&&co(l)}}function Rx(t){const e=[];t instanceof js&&(t=[t]);for(let n=0;n<t.length;++n){const s=t[n];if(1===s.rank)e.push(Ob(s,1));else{if(0===s.rank)throw new Error("Expected tensor to be at least 1D, but received a 0D tensor (scalar).");e.push(s)}}return e}function Dx(t,e){if(null==t)return;const n=[];if(e instanceof js)n.push(e.id);else if(Array.isArray(e))e.forEach((t=>n.push(t.id)));else if(null!=e)for(const i in e){const t=e[i];n.push(t.id)}const s=[];if(t instanceof js)-1===n.indexOf(t.id)&&s.push(t);else if(Array.isArray(t))t.forEach((t=>{-1===n.indexOf(t.id)&&s.push(t)}));else if(null!=t)for(const i in t){const e=t[i];-1===n.indexOf(e.id)&&s.push(e)}s.forEach((t=>{t.isDisposed||t.dispose()}))}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Mx(t){return t instanceof js}function Px(t){return Array.isArray(t)}function Fx(t){return!Mx(t)&&!Px(t)}function Lx(t,e,n,s=!0,i=""){if(null==e||0===e.length){if(null!=t){let e=!1;if(Px(t)&&t.length>0)e=!0;else if(Fx(t)){for(const n in t)if(t.hasOwnProperty(n)){e=!0;break}}else e=!0;if(e)throw new Iy(`Error when checking model ${i} expected no data, but got ${t}`)}return[]}if(null==t)return e.map((t=>null));let r;if(Fx(t)){r=[];for(const n of e){if(null==t[n])throw new Iy(`No data provided for "${n}". Need data for each key in: ${e}`);r.push(t[n])}}else if(Px(t)){if(t.length!==e.length)throw new Iy(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the model expected. Expected to see ${e.length} Tensor(s), but instead got the following list of Tensor(s): ${t}`);r=t}else{if(e.length>1)throw new Iy(`The model ${i} expects ${e.length} Tensor(s), but only received one Tensor. Found: Tensor with shape ${t.shape}`);r=[t]}if(r=Rx(r),null!=n)for(let o=0;o<e.length;++o){if(null==n[o])continue;const t=r[o];if(t.shape.length!==n[o].length)throw new Iy(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s). but got array with shape ${t.shape}`);for(let r=0;r<n[o].length;++r){if(0===r&&!s)continue;const a=t.shape[r],u=n[o][r];if(null!=u&&u>=0&&a!==u)throw new Iy(`Error when checking ${i}: expected ${e[o]} to have shape [${n[o]}], but got array with shape [${t.shape}].`)}}return r}function zx(t,e,n){const s=Vy(t.map((t=>t.shape[0])));s.sort();const i=Vy(e.map((t=>t.shape[0])));if(i.sort(),s.length>1)throw new Iy(`All input Tensors (x) should have the same number of samples. Got array shapes: ${JSON.stringify(t.map((t=>t.shape)))}`);if(i.length>1)throw new Iy(`All target Tensors (y) should have the same number of samples. Got array shapes: ${JSON.stringify(e.map((t=>t.shape)))}`);if(s.length>0&&i.length>0&&!S(s,i))throw new Iy(`Input Tensors should have the same number of samples as target Tensors. Found ${s[0]} input sample(s) and ${i[0]} target sample(s).`)}function Bx(t,e,n){const s=[uw,vw,gw];for(let i=0;i<t.length;++i){const r=t[i],o=e[i],a=n[i];if(null!=o){if(o===gw&&1===r.shape[r.shape.length-1])throw new Iy(`You are passing a target array of shape ${r.shape} while using a loss 'categorical_crossentropy'. 'categorical_crossentropy'expects targets to be binary matrices (1s and 0s) of shape [samples, classes].`);if(-1!==s.indexOf(o)){const t=r.shape.slice(1),e=a.slice(1);for(let n=0;n<t.length;++n){const s=t[n],i=e[n];if(null!=i&&s!==i)throw new Iy(`A target Tensor with shape ${r.shape} was passed for an output of shape ${a}, while using a loss function that expects targets to have the same shape as the output.`)}}}}}function qx(t,e,n,s=!0,i=""){let r;if(Array.isArray(t)){if(t.length!==e.length)throw new Iy(`Error when checking model ${i}: the Array of Tensors that you are passing to your model is not the size the the model expected. Expected to see ${e.length} Tensor(s), but instead got ${t.length} Tensors(s).`);r=t}else{if(e.length>1)throw new Iy(`The model expects ${e.length} ${i} Tensors, but only received one Tensor. Found: array with shape ${JSON.stringify(t.shape)}.`);r=[t]}if(null!=n)for(let o=0;o<e.length;++o){if(null==n[o])continue;const t=r[o];if(t.shape.length!==n[o].length)throw new Iy(`Error when checking ${i}: expected ${e[o]} to have ${n[o].length} dimension(s), but got array with shape ${JSON.stringify(t.shape)}`);for(let r=0;r<n[o].length;++r){if(0===r&&!s)continue;const a=t.shape[r],u=n[o][r];if(null!=u&&u!==a)throw new Iy(`Error when checking ${i}: expected ${e[o]} to have shape ${JSON.stringify(n[o])} but got array with shape ${JSON.stringify(t.shape)}.`)}}}function Vx(t,e){if(null==t||Array.isArray(t)&&0===t.length)return e.map((t=>[]));let n;if("string"===typeof t||"function"===typeof t)n=[t];else{if(!Array.isArray(t)&&"object"!==typeof t)throw new TypeError(`Type of metrics argument not understood. Expected an string,function, Array, or Object, found: ${t}`);n=t}if(Array.isArray(n))return e.map((t=>n));{const t=[];for(const s of e){let e=n.hasOwnProperty(s)?n[s]:[];Array.isArray(e)||(e=[e]),t.push(e)}return t}}const Wx="layers-model";class jx extends dx{constructor(t){super(t),this.isTraining=!1}summary(t,e,n=console.log){if(!this.built)throw new Iy("This model has never been called, thus its weights have not been created yet. So no summary can be displayed. Build the model first (e.g., by calling it on some test data).");Kw(this,t,e,n)}compile(t){if(null==t.loss&&(t.loss=[]),this.loss=t.loss,"string"===typeof t.optimizer)this.optimizer_=jw(t.optimizer),this.isOptimizerOwned=!0;else{if(!(t.optimizer instanceof yo))throw new Iy("User-defined optimizer must be an instance of tf.Optimizer.");this.optimizer_=t.optimizer,this.isOptimizerOwned=!1}let e=[];if(Array.isArray(t.loss)||"string"===typeof t.loss||"function"===typeof t.loss)if(Array.isArray(t.loss)){if(t.loss.length!==this.outputs.length)throw new Iy(`When passing an Array as loss, it should have one entry per model output. The model has ${this.outputs.length} output(s), but you passed loss=${t.loss}.`);const n=t.loss;e=n.map((t=>Sw(t)))}else{const n=Sw(t.loss);this.outputs.forEach((t=>{e.push(n)}))}else{t.loss=t.loss;for(const e in t.loss)if(-1===this.outputNames.indexOf(e))throw new Iy(`Unknown entry in loss dictionary: "${e}". Only expected the following keys: ${this.outputNames}`);for(const n of this.outputNames)null==t.loss[n]&&console.warn(`Output "${n}" is missing from loss dictionary. We assume this was done on purpose, and we will not be expecting data to be passed to ${n} during training`),e.push(Sw(t.loss[n]))}this.lossFunctions=e,this.feedOutputNames=[],this.feedOutputShapes=[],this.feedLossFns=[];for(let r=0;r<this.outputs.length;++r){const t=this.internalOutputShapes[r],e=this.outputNames[r];this.feedOutputNames.push(e),this.feedOutputShapes.push(t),this.feedLossFns.push(this.lossFunctions[r])}const n=[];this.metrics=t.metrics,this.metricsNames=["loss"],this.metricsTensors=[],bb("loss",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=this.lossFunctions[t];this.outputs.length>1&&(this.metricsTensors.push([e,t]),this.metricsNames.push(this.outputNames[t]+"_loss"))}}));const s=Vx(t.metrics,this.outputNames),i=(t,e,n)=>{this.outputNames.length>1&&(e=this.outputNames[t]+"_"+e),this.metricsNames.push(e),this.metricsTensors.push([n,t])};bb("metric",(()=>{for(let t=0;t<this.outputs.length;++t){if(-1!==n.indexOf(t))continue;const e=s[t],r=e=>{const n="";let s,r,o;for(const a of e){if("string"===typeof a&&-1!==["accuracy","acc","crossentropy","ce"].indexOf(a)){const e=this.internalOutputShapes[t];let i;1===e[e.length-1]||this.lossFunctions[t]===vw?-1!==["accuracy","acc"].indexOf(a)?r=Tw:-1!==["crossentropy","ce"].indexOf(a)&&(r=Ew):this.lossFunctions[t]===yw?-1!==["accuracy","acc"].indexOf(a)?r=Ow:-1!==["crossentropy","ce"].indexOf(a)&&(r=Bw):-1!==["accuracy","acc"].indexOf(a)?r=Iw:-1!==["crossentropy","ce"].indexOf(a)&&(r=Lw),-1!==["accuracy","acc"].indexOf(a)?i="acc":-1!==["crossentropy","ce"].indexOf(a)&&(i="ce"),o=r,s=n+i}else{const t=Vw(a);o=t,s=n+Ww(a)}let e;bb(s,(()=>{e=o})),i(t,s,e)}};r(e)}})),this.collectedTrainableWeights=this.trainableWeights}checkTrainableWeightsConsistency(){null!=this.collectedTrainableWeights&&this.trainableWeights.length!==this.collectedTrainableWeights.length&&console.warn("Discrepancy between trainableweights and collected trainable weights. Did you set `model.trainable` without calling `model.compile()` afterwards?")}evaluate(t,e,n={}){const s=null==n.batchSize?32:n.batchSize;Cx(s);const i=!0,r=this.standardizeUserDataXY(t,e,i,s);try{const t=r[0].concat(r[1]);this.makeTestFunction();const e=this.testFunction,i=this.testLoop(e,t,s,n.verbose,n.steps);return $y(i)}finally{Dx(r[0],t),Dx(r[1],e)}}async evaluateDataset(t,e){return this.makeTestFunction(),Ix(this,t,e)}checkNumSamples(t,e,n,s="steps"){let i;if(null!=n){if(i=null,null!=e)throw new Iy(`If ${s} is set, batchSize must be null or undefined.Got batchSize = ${e}`)}else{if(null==t)throw new Iy(`Either the input data should have a defined shape, or ${s} shoud be specified.`);i=Array.isArray(t)?t[0].shape[0]:t.shape[0]}return i}execute(t,e){if(Array.isArray(e)&&0===e.length)throw new Iy("`outputs` is an empty Array, which is not allowed.");const n=Array.isArray(e),s=n?e:[e],i=this.retrieveSymbolicTensors(s),r=new rx;if(t instanceof js&&(t=[t]),Array.isArray(t)){if(t.length!==this.inputs.length)throw new Iy(`The number of inputs provided (${t.length}) does not match the number of inputs of this model (${this.inputs.length}).`);for(let e=0;e<this.inputs.length;++e)r.add(this.inputs[e],t[e])}else for(const a of this.inputs){const e=t[a.name];if(null==e)throw new Iy(`No value is provided for the model's input ${a.name}`);r.add(a,e)}const o=ux(i,r);return n?o:o[0]}retrieveSymbolicTensors(t){const e=Ny(null,t.length);let n=t.length;for(const s of this.layers){const i=Array.isArray(s.output)?s.output:[s.output],r=i.map((t=>t.name));for(let s=0;s<t.length;++s){const o=r.indexOf(t[s]);if(-1!==o&&(e[s]=i[o],n--),0===n)break}if(0===n)break}if(n>0){const n=[];throw e.forEach(((e,s)=>{null==e&&n.push(t[s])})),new Iy(`Cannot find SymbolicTensors for output name(s): ${JSON.stringify(n)}`)}return e}predictLoop(t,e=32,n=!1){return uo((()=>{const s=this.checkNumSamples(t);if(n)throw new Cy("Verbose predictLoop() is not implemented yet.");const i=Ex(s,e),r=this.outputs.map((t=>[]));for(let e=0;e<i.length;++e){const n=uo((()=>{const n=i[e][0],s=i[e][1],r=Ax(t,n,s),o=[];if(Array.isArray(r))for(let t=0;t<r.length;++t)o.push({key:this.inputs[t],value:r[t]});else o.push({key:this.inputs[0],value:r});const a=new rx(o);return ux(this.outputs,a)}));n.forEach(((t,e)=>r[e].push(t)))}return $y(r.map((t=>ca(t,0))))}))}predict(t,e={}){const n=Rx(t);qx(n,this.inputNames,this.feedInputShapes,!1);try{const t=null==e.batchSize?32:e.batchSize;return Cx(t),this.predictLoop(n,t)}finally{Dx(n,t)}}predictOnBatch(t){qx(t,this.inputNames,this.feedInputShapes,!0);const e=(Array.isArray(t)?t[0]:t).shape[0];return this.predictLoop(t,e)}standardizeUserDataXY(t,e,n=!0,s){if(null==this.optimizer_)throw new Ty("You must compile a model before training/testing. Use LayersModel.compile(modelCompileArgs).");const i=[];for(let r=0;r<this.feedOutputShapes.length;++r){const t=this.feedOutputShapes[r],e=this.feedLossFns[r];e===yw?i.push(t.slice(0,t.length-1).concat([1])):i.push(t)}if(t=Lx(t,this.feedInputNames,this.feedInputShapes,!1,"input"),e=Lx(e,this.feedOutputNames,i,!1,"target"),zx(t,e,null),Bx(e,this.feedLossFns,this.feedOutputShapes),this.stateful&&null!=s&&s>0&&t[0].shape[0]%s!==0)throw new Iy(`In a stateful network, you should only pass inputs with a number of samples that is divisible by the batch size ${s}. Found: ${t[0].shape[0]} sample(s).`);return[t,e]}async standardizeUserData(t,e,n,s,i=!0,r){const[o,a]=this.standardizeUserDataXY(t,e,i,r);if(null!=n)throw new Error("sample weight is not supported yet.");let u=null;if(null!=s){const t=mx(s,this.outputNames);u=[];for(let e=0;e<t.length;++e)u.push(await gx(a[e],null,t[e]))}return[o,a,u]}testLoop(t,e,n,s=0,i){return uo((()=>{const r=this.checkNumSamples(e,n,i,"steps"),o=[];if(s>0)throw new Cy("Verbose mode is not implemented yet.");if(null!=i)throw new Cy("steps mode in testLoop() is not implemented yet");{const s=Ex(r,n),i=Uc(Nb(0,r));for(let n=0;n<s.length;++n){const r=s[n][0],a=s[n][1],u=Mb(i,r,a-r),c=Nx(e,u),l=t(c);if(0===n)for(let t=0;t<l.length;++t)o.push(go(0));for(let t=0;t<l.length;++t){const e=l[t];o[t]=xo(o[t],hu(a-r,e))}}for(let t=0;t<o.length;++t)o[t]=Ra(o[t],r)}return o}))}getDedupedMetricsNames(){const t=this.metricsNames,e=[];for(let n=0;n<t.length;++n){const s=t[n];let i=s;if(Oy(t,s)>1){const e=Oy(t.slice(0,n),s);i+=`_${e}`}e.push(i)}return e}makeTrainFunction(){return t=>{const e=[],n=t.slice(0,this.inputs.length),s=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),i=t.slice(this.inputs.length+this.outputs.length,this.inputs.length+2*this.outputs.length),r=[],o=()=>{const t=[];for(let e=0;e<this.inputs.length;++e)t.push({key:this.inputs[e],value:n[e]});const o=new rx(t),a=ux(this.outputs,o,{training:!0});let u;for(let n=0;n<this.lossFunctions.length;++n){const t=this.lossFunctions[n];let r=t(s[n],a[n]);null!=i[n]&&(r=yx(r,i[n]));const o=Cu(r);e.push(o),u=0===n?r:xo(u,r)}for(let n=0;n<this.metricsTensors.length;++n){let t;if(this.outputs.length>1&&n<this.outputs.length)t=e[n];else{const e=this.metricsTensors[n][0],i=this.metricsTensors[n][1];t=Cu(e(s[i],a[i]))}lo(t),r.push(t)}return u=Cu(u),this.calculateLosses().forEach((t=>{u=xo(u,t)})),u},a=this.collectedTrainableWeights.map((t=>t.read())),u=!0,c=this.optimizer_.minimize(o,u,a);return[c].concat(r)}}makeTestFunction(){this.testFunction=t=>uo((()=>{const e=[];let n;const s=t.slice(0,this.inputs.length),i=t.slice(this.inputs.length,this.inputs.length+this.outputs.length),r=[];for(let t=0;t<this.inputs.length;++t)r.push({key:this.inputs[t],value:s[t]});const o=new rx(r),a=ux(this.outputs,o);for(let t=0;t<this.lossFunctions.length;++t){const s=this.lossFunctions[t],r=Cu(s(i[t],a[t]));n=0===t?r:xo(n,r),e.push(n)}for(let t=0;t<this.metricsTensors.length;++t){const n=this.metricsTensors[t][0],s=this.metricsTensors[t][1],r=Cu(n(i[s],a[s]));e.push(r)}return e}))}async fit(t,e,n={}){return $x(this,t,e,n)}async fitDataset(t,e){return _x(this,t,e)}async trainOnBatch(t,e){const n=await this.standardizeUserData(t,e),s=n[0],i=n[1],r=this.makeTrainFunction(),o=r(s.concat(i)),a=[];for(const u of o){const t=await u.data();a.push(t[0])}return co(o),$y(a)}getNamedWeights(t){const e=[],n=null!=t&&t.trainableOnly,s=n?this.trainableWeights:this.weights,i=this.getWeights(n);for(let r=0;r<s.length;++r)n&&!s[r].trainable||e.push({name:s[r].originalName,tensor:i[r]});return e}set stopTraining(t){this.stopTraining_=t}get stopTraining(){return this.stopTraining_}get optimizer(){return this.optimizer_}set optimizer(t){this.optimizer_!==t&&(this.optimizer_=t,this.isOptimizerOwned=!1)}dispose(){const t=super.dispose();if(0===t.refCountAfterDispose&&null!=this.optimizer&&this.isOptimizerOwned){const e=ao().numTensors;this.optimizer_.dispose(),t.numDisposedVariables+=e-ao().numTensors}return t}getLossIdentifiers(){let t;if("string"===typeof this.loss)t=Dy(this.loss);else if(Array.isArray(this.loss)){for(const t of this.loss)if("string"!==typeof t)throw new Error("Serialization of non-string loss is not supported.");t=this.loss.map((t=>Dy(t)))}else{const e=Object.keys(this.loss);t={};const n=this.loss;for(const s of e){if("string"!==typeof n[s])throw new Error("Serialization of non-string loss is not supported.");t[s]=Dy(n[s])}}return t}getMetricIdentifiers(){if("string"===typeof this.metrics||"function"===typeof this.metrics)return[Dy(Ww(this.metrics))];if(Array.isArray(this.metrics))return this.metrics.map((t=>Dy(Ww(t))));{const t={};for(const e in this.metrics)t[e]=Dy(Ww(this.metrics[e]));return t}}getTrainingConfig(){return{loss:this.getLossIdentifiers(),metrics:this.getMetricIdentifiers(),optimizer_config:{class_name:this.optimizer.getClassName(),config:this.optimizer.getConfig()}}}loadTrainingConfig(t){if(null!=t.weighted_metrics)throw new Error("Loading weight_metrics is not supported yet.");if(null!=t.loss_weights)throw new Error("Loading loss_weights is not supported yet.");if(null!=t.sample_weight_mode)throw new Error("Loading sample_weight_mode is not supported yet.");const e=ex(t.optimizer_config),n=ow(e);let s,i;if("string"===typeof t.loss)s=My(t.loss);else if(Array.isArray(t.loss))s=t.loss.map((t=>My(t)));else if(null!=t.loss){s={};for(const e in t.loss)s[e]=My(t.loss[e])}if(Array.isArray(t.metrics))i=t.metrics.map((t=>My(t)));else if(null!=t.metrics){i={};for(const e in t.metrics)i[e]=My(t.metrics[e])}this.compile({loss:s,metrics:i,optimizer:n})}async save(t,e){if("string"===typeof t){const e=Pi(t);if(0===e.length)throw new Iy(`Cannot find any save handlers for URL '${t}'`);if(e.length>1)throw new Iy(`Found more than one (${e.length}) save handlers for URL '${t}'`);t=e[0]}if(null==t.save)throw new Iy("LayersModel.save() cannot proceed because the IOHandler provided does not have the `save` attribute defined.");const n=await Ci(this.getNamedWeights(e)),s=!1,i=null,r=this.toJSON(i,s),o={modelTopology:r,format:Wx,generatedBy:`TensorFlow.js tfjs-layers v${sx}`,convertedBy:null},a=null!=e&&e.includeOptimizer;if(a&&null!=this.optimizer){o.trainingConfig=this.getTrainingConfig();const t="optimizer",{data:e,specs:s}=await Ci(await this.optimizer.getWeights(),t);n.specs.push(...s),n.data=Ri([n.data,e])}if(null!=this.userDefinedMetadata){const t=!0;Gw(this.userDefinedMetadata,this.name,t),o.userDefinedMetadata=this.userDefinedMetadata}return o.weightData=n.data,o.weightSpecs=n.specs,t.save(o)}setUserDefinedMetadata(t){Gw(t,this.name),this.userDefinedMetadata=t}getUserDefinedMetadata(){return this.userDefinedMetadata}}jx.className="Model",io(jx);class Ux extends jx{}Ux.className="Functional",io(Ux);class Gx extends jx{constructor(t){if(super({inputs:[],outputs:[]}),t=t||{},this.trainable=!0,this.built=!1,this.name=null!=t.name?t.name:Iv("sequential_"),null!=t.layers)for(const e of t.layers)this.add(e)}checkShape(t){const e=t.inboundNodes[0].outputTensors[0].shape;if(e.some((t=>t<0)))throw new Iy(`Negative dimension size caused by adding layer ${t.name} with input shape [${t.inboundNodes[0].inputTensors[0].shape}]`)}add(t){const e=t instanceof Gx||t instanceof jx;let n;if(e){if(n=t,1!==n.outputs.length)throw new Iy("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");if(1!==n.inputs.length)throw new Iy("All layers in a Sequential model should have a single input tensor. For multi-input layers, use the functional API.")}if(0===this.outputs.length){if(0===t.inboundNodes.length){if(null==t.batchInputShape)throw new Iy("The first layer in a Sequential model must get an `inputShape` or `batchInputShape` argument.");const e=Hv({batchShape:t.batchInputShape,dtype:t.dtype,name:t.name+"_input"});t.apply(e)}if(e)this.outputs=n.outputs,this.inputs=n.inputs;else{if(1!==t.inboundNodes.length)throw new Iy(`A layer added to a Sequential model must not already be connected somewhere else. LayersModel received layer ${t.name} which has ${t.inboundNodes.length} pre-existing inbound connections.`);if(1!==t.inboundNodes[0].outputTensors.length)throw new Iy("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[t.inboundNodes[0].outputTensors[0]],this.inputs=Uv(this.outputs[0])}this.inboundNodes=[],new Bv({outboundLayer:this,inboundLayers:[],nodeIndices:[],tensorIndices:[],inputTensors:this.inputs,outputTensors:this.outputs,inputMasks:Ny(null,this.inputs.length),outputMasks:[null],inputShapes:this.inputs.map((t=>t.shape)),outputShapes:this.outputs[0].shape})}else{const e=t.apply(this.outputs[0]);if(Array.isArray(e))throw new TypeError("All layers in a Sequential model should have a single output tensor. For multi-output layers, use the functional API.");this.checkShape(t),this.outputs=[e],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}this.layers.push(t),this.built=!1}pop(){if(0===this.layers.length)throw new TypeError("There are no layers in the model.");if(this.layers.pop(),0===this.layers.length)this.outputs=[],this.inboundNodes=[],this.outboundNodes=[];else{const t=this.layers.length-1;this.layers[t].outboundNodes=[],this.outputs=[this.layers[t].output],this.inboundNodes[0].outputTensors=this.outputs,this.inboundNodes[0].outputShapes=[this.outputs[0].shape]}}call(t,e){return null==this.model&&this.build(),this.model.call(t,e)}build(t){if(Ev(t),0===this.inputs.length||0===this.outputs.length)throw new TypeError("Sequential model cannot be built: model is empty. Add some layers first.");this.model=new jx({inputs:this.inputs,outputs:this.outputs[0],name:this.name+"_model"}),this.model.trainable=this.trainable,this.supportsMasking=this.model.supportsMasking,this.inputLayers=this.model.inputLayers,this.inputLayersNodeIndices=this.model.inputLayersNodeIndices,this.inputLayersTensorIndices=this.model.inputLayersTensorIndices,this.outputLayers=this.model.outputLayers,this.outputLayersNodeIndices=this.model.outputLayersNodeIndices,this.outputLayersTensorIndices=this.model.outputLayersTensorIndices,this.nodesByDepth=this.model.nodesByDepth,this.containerNodes=this.model.containerNodes,this.outputNames=this.model.outputNames,this.inputNames=this.model.inputNames,this.built=!0}countParams(){return this.built||this.build(),super.countParams()}summary(t,e,n=console.log){this.built||this.build(),super.summary(t,e,n)}setWeights(t){null==this.model&&this.build(),this.model.setWeights(t)}evaluate(t,e,n={}){if(!this.built)throw new Ty("The model needs to be compiled before being used.");return this.model.evaluate(t,e,n)}async evaluateDataset(t,e){if(!this.built)throw new Ty("The model needs to be compiled before being used.");return this.model.evaluateDataset(t,e)}predict(t,e={}){return null==this.model&&this.build(),this.model.predict(t,e)}predictOnBatch(t){return null==this.model&&this.build(),this.model.predictOnBatch(t)}compile(t){this.build(),this.model.compile(t),this.optimizer_=this.model.optimizer,this.isOptimizerOwned=this.model.isOptimizerOwned,this.loss=this.model.loss,this.metrics=this.model.metrics,this.metricsTensors=this.model.metricsTensors,this.metricsNames=this.model.metricsNames}get optimizer(){return null==this.model?void 0:this.model.optimizer}set optimizer(t){this.model.optimizer=t}async fit(t,e,n={}){if(!this.built)throw new Ty("The model needs to be compiled before being used.");return this.model.fit(t,e,n)}async fitDataset(t,e){if(!this.built)throw new Ty("The model needs to be compiled before being used.");return this.model.fitDataset(t,e)}async trainOnBatch(t,e){return this.model.trainOnBatch(t,e)}static fromConfig(t,e,n={},s=!1){let i,r={};if(e instanceof Array){if(null==e[0].className||"Merge"===e[0]["className"])throw new Iy("Legacy serialization format not supported yet.");i=e}else v(null!=e["layers"],(()=>"When the config data for a Sequential model is not an Array, it must be an Object that contains the 'layers' field.")),i=e["layers"],delete e["layers"],r=e;const o=new t(r);if(!(o instanceof Gx))throw new Cy(`Sequential.fromConfig called on non-Sequential input: ${o}`);for(const a of i){const t=void 0,e=ow(a,t,s);s&&e.setFastWeightInitDuringBuild(!0),o.add(e)}return o}set stopTraining(t){if(null==this.model)throw new Iy("Cannot set the stopTraining property of a sequential model before it is compiled.");this.model.stopTraining=t}get stopTraining(){if(null==this.model)throw new Iy("Cannot get the stopTraining property of a sequential model before it is compiled.");return this.model.stopTraining}getConfig(){const t=[];for(const e of this.layers){const n={};n["className"]=e.getClassName(),n["config"]=e.getConfig(),t.push(n)}return{name:this.name,layers:t}}}Gx.className="Sequential",io(Gx);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Hx extends no{getConfig(){return{}}}class Kx extends Hx{apply(t,e=1){return Hb(t,e)}}Kx.className="elu",io(Kx);class Xx extends Hx{apply(t){return gc(t)}}Xx.className="selu",io(Xx);class Qx extends Hx{apply(t){return pc(t)}}Qx.className="relu",io(Qx);class Yx extends Hx{apply(t){return uo((()=>Ou(6,pc(t))))}}Yx.className="relu6",io(Yx);class Zx extends Hx{apply(t){return t}}Zx.className="linear",io(Zx);class Jx extends Hx{apply(t){return wc(t)}}Jx.className="sigmoid",io(Jx);class t_ extends Hx{apply(t){return Qb(t)}}t_.className="hardSigmoid",io(t_);class e_ extends Hx{apply(t){return Dc(t)}}e_.className="softplus",io(e_);class n_ extends Hx{apply(t){return Kb(t)}}n_.className="softsign",io(n_);class s_ extends Hx{apply(t){return jc(t)}}s_.className="tanh",io(s_);class i_ extends Hx{apply(t,e=-1){return $c(t,e)}}i_.className="softmax",io(i_);class r_ extends Hx{apply(t,e=-1){return yu(t,e)}}r_.className="logSoftmax",io(r_);class o_ extends Hx{apply(t,e=1){return uo((()=>wc(t.mul(e)).mul(t)))}}function a_(t){return t.getClassName()}function u_(t,e={}){return zy(t,so.getMap().classNameMap,e,"activation")}function c_(t){if(null==t){const t={className:"linear",config:{}};return u_(t)}if("string"===typeof t){const e={};return e["className"]=t,e["config"]={},u_(e)}return t instanceof Hx?t:u_(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function l_(t){if(null!=t&&"object"!==typeof t)throw new Error(`Argument to L1L2 regularizer's constructor is expected to be an object, but received: ${t}`)}o_.className="swish",io(o_);class h_ extends no{}class p_ extends h_{constructor(t){super(),l_(t),this.l1=null==t||null==t.l1?.01:t.l1,this.l2=null==t||null==t.l2?.01:t.l2,this.hasL1=0!==this.l1,this.hasL2=0!==this.l2}apply(t){return uo((()=>{let e=Qu([1]);return this.hasL1&&(e=xo(e,mu(hu(this.l1,vo(t))))),this.hasL2&&(e=xo(e,mu(hu(this.l2,jb(t))))),e.asScalar()}))}getConfig(){return{l1:this.l1,l2:this.l2}}static fromConfig(t,e){return new t({l1:e["l1"],l2:e["l2"]})}}p_.className="L1L2",io(p_);const d_={l1l2:"L1L2"};function f_(t){return Fy(t)}function m_(t,e={}){return zy(t,so.getMap().classNameMap,e,"regularizer")}function g_(t){if(null==t)return null;if("string"===typeof t){const e=t in d_?d_[t]:t,n={className:e,config:{}};return m_(n)}return t instanceof h_?t:m_(t)}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class y_ extends Vv{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,null!=t&&(this.maxValue=t.maxValue)}call(t,e){t=Nv(t);let n=pc(t);return null!=this.maxValue&&(n=aa(n,0,this.maxValue)),n}computeOutputShape(t){return t}getConfig(){const t={maxValue:this.maxValue},e=super.getConfig();return Object.assign(t,e),t}}y_.className="ReLU",io(y_);class b_ extends Vv{constructor(t){super(null==t?{}:t),this.DEFAULT_ALPHA=.3,null==t&&(t={}),this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=Nv(t);return su(n,this.alpha)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}b_.className="LeakyReLU",io(b_);class v_ extends Vv{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA_INITIALIZER="zeros",null==t&&(t={}),this.supportsMasking=!0,this.alphaInitializer=_v(t.alphaInitializer||this.DEFAULT_ALPHA_INITIALIZER),this.alphaRegularizer=g_(t.alphaRegularizer),this.alphaConstraint=rb(t.alphaConstraint),null==t.sharedAxes)this.sharedAxes=null;else if(Array.isArray(t.sharedAxes))this.sharedAxes=t.sharedAxes;else{if("number"!==typeof t.sharedAxes)throw new Iy(`Expected sharedAxes to be a number or an array of numbers, but got ${t.sharedAxes}`);this.sharedAxes=[t.sharedAxes]}}build(t){t=Ev(t);const e=t.slice(1);if(null!=this.sharedAxes)for(const s of this.sharedAxes)e[s-1]=1;this.alpha=this.addWeight("alpha",e,"float32",this.alphaInitializer,this.alphaRegularizer,!0,this.alphaConstraint);const n={};if(null!=this.sharedAxes)for(let s=1;s<t.length;++s)n[s]=t[s];this.inputSpec=[new Fv({ndim:t.length,axes:n})],this.built=!0}call(t,e){return t=Nv(t),sc(t,this.alpha.read())}getConfig(){const t={alphaInitializer:xv(this.alphaInitializer),alphaRegularizer:f_(this.alphaRegularizer),alphaConstraint:sb(this.alphaConstraint),sharedAxes:this.sharedAxes},e=super.getConfig();return Object.assign(t,e),t}}v_.className="PReLU",io(v_);class w_ extends Vv{constructor(t){if(super(null==t?{}:t),this.DEFAULT_ALPHA=1,null==t&&(t={}),null!=t.alpha&&t.alpha!==this.DEFAULT_ALPHA)throw new Cy(`Non-default alpha value (${t.alpha}) is not supported by the ELU layer yet.`);this.alpha=null==t.alpha?this.DEFAULT_ALPHA:t.alpha}call(t,e){const n=Nv(t);return Ma(n)}computeOutputShape(t){return t}getConfig(){const t={alpha:this.alpha},e=super.getConfig();return Object.assign(t,e),t}}w_.className="ELU",io(w_);class x_ extends Vv{constructor(t){super(null==t?{}:t),this.DEFAULT_THETA=1,null==t&&(t={}),this.theta=null==t.theta?this.DEFAULT_THETA:t.theta}call(t,e){const n=Nv(t);return n.mul(Eb(n.greater(this.theta),"float32"))}computeOutputShape(t){return t}getConfig(){const t={theta:this.theta},e=super.getConfig();return Object.assign(t,e),t}}x_.className="ThresholdedReLU",io(x_);class __ extends Vv{constructor(t){super(null==t?{}:t),this.DEFAULT_AXIS=1,null==t&&(t={}),this.softmax=(new i_).apply,this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis}call(t,e){const n=Nv(t);return this.softmax(n,this.axis)}computeOutputShape(t){return t}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function k_(t,e,n){if("number"===typeof t)return Ny(t,e);if(t.length!==e)throw new Iy(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${t.length} elements.`);for(let s=0;s<e;++s){const i=t[s];if(!Sb(i))throw new Iy(`The ${n} argument must be an integer or tuple of ${e} integers. Received: ${JSON.stringify(t)} including a non-integer number ${i}`)}return t}function S_(t,e,n,s,i=1){if(null==t)return t;const r=e+(e-1)*(i-1);let o;return o="same"===n?t:t-r+1,Math.floor((o+s-1)/s)}function T_(t,e,n,s){if(null==t)return null;if("valid"===s)t=t*e+Ab([n-e,0]);else{if("same"!==s)throw new Iy(`Unsupport padding mode: ${s}.`);t*=e}return t}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function I_(t,e){return uo((()=>(pb(e),"channelsFirst"===e?rl(t,[0,2,3,1]):t)))}function C_(t,e){return uo((()=>(pb(e),"channelsFirst"===e?rl(t,[0,2,3,4,1]):t)))}function A_(t,e,n,s=1,i="valid",r,o=1){return uo((()=>{if(null==r&&(r=ky()),pb(r),3!==t.shape.length)throw new Iy(`The input of a conv1dWithBias operation should be 3, but is ${t.shape.length} instead.`);if(3!==e.shape.length)throw new Iy(`The kernel for a conv1dWithBias operation should be 3, but is ${e.shape.length} instead`);if(null!=n&&1!==n.shape.length)throw new Iy(`The bias for a conv1dWithBias operation should be 1, but is ${e.shape.length} instead`);if("channelsFirst"===r&&(t=rl(t,[0,2,1])),"causal"===i)throw new Cy("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");let a=xa(t,e,s,"same"===i?"same":"valid","NWC",o);return null!=n&&(a=Gb(a,n)),a}))}function N_(t,e,n,s=[1,1],i="valid",r,o,a=null){return uo((()=>{if(null==r&&(r=ky()),pb(r),3!==t.rank&&4!==t.rank)throw new Iy(`conv2dWithBiasActivation expects input to be of rank 3 or 4, but received ${t.rank}.`);if(3!==e.rank&&4!==e.rank)throw new Iy(`conv2dWithBiasActivation expects kernel to be of rank 3 or 4, but received ${t.rank}.`);let u=I_(t,r);if("causal"===i)throw new Cy("The support for CAUSAL padding mode in conv1dWithBias is not implemented yet.");return u=$l({x:u,filter:e,strides:s,pad:"same"===i?"same":"valid",dilations:o,dataFormat:"NHWC",bias:n,activation:a}),"channelsFirst"===r&&(u=rl(u,[0,3,1,2])),u}))}function E_(t,e,n,s=[1,1,1],i="valid",r,o){return uo((()=>{if(null==r&&(r=ky()),pb(r),4!==t.rank&&5!==t.rank)throw new Iy(`conv3dWithBias expects input to be of rank 4 or 5, but received ${t.rank}.`);if(4!==e.rank&&5!==e.rank)throw new Iy(`conv3dWithBias expects kernel to be of rank 4 or 5, but received ${t.rank}.`);let a=C_(t,r);if("causal"===i)throw new Cy("The support for CAUSAL padding mode in conv3dWithBias is not implemented yet.");return a=Ca(a,e,s,"same"===i?"same":"valid","NDHWC",o),null!=n&&(a=Gb(a,n)),"channelsFirst"===r&&(a=rl(a,[0,4,1,2,3])),a}))}__.className="Softmax",io(__);class O_ extends Vv{constructor(t,e){if(super(e),this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",O_.verifyArgs(e),this.rank=t,Gy(this.rank,"rank"),1!==this.rank&&2!==this.rank&&3!==this.rank)throw new Cy(`Convolution layer for rank other than 1, 2, or 3 (${this.rank}) is not implemented yet.`);if(this.kernelSize=k_(e.kernelSize,t,"kernelSize"),this.strides=k_(null==e.strides?1:e.strides,t,"strides"),this.padding=null==e.padding?"valid":e.padding,fb(this.padding),this.dataFormat=null==e.dataFormat?"channelsLast":e.dataFormat,pb(this.dataFormat),this.activation=c_(e.activation),this.useBias=null==e.useBias||e.useBias,this.biasInitializer=_v(e.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.biasConstraint=rb(e.biasConstraint),this.biasRegularizer=g_(e.biasRegularizer),this.activityRegularizer=g_(e.activityRegularizer),this.dilationRate=k_(null==e.dilationRate?1:e.dilationRate,t,"dilationRate"),1===this.rank&&Array.isArray(this.dilationRate)&&1!==this.dilationRate.length)throw new Iy(`dilationRate must be a number or an array of a single number for 1D convolution, but received ${JSON.stringify(this.dilationRate)}`);if(2===this.rank){if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate];else if(2!==this.dilationRate.length)throw new Iy(`dilationRate must be a number or array of two numbers for 2D convolution, but received ${JSON.stringify(this.dilationRate)}`)}else if(3===this.rank)if("number"===typeof this.dilationRate)this.dilationRate=[this.dilationRate,this.dilationRate,this.dilationRate];else if(3!==this.dilationRate.length)throw new Iy(`dilationRate must be a number or array of three numbers for 3D convolution, but received ${JSON.stringify(this.dilationRate)}`)}static verifyArgs(t){if(Ey("kernelSize"in t,"required key 'kernelSize' not in config"),"number"!==typeof t.kernelSize&&!Uy(t.kernelSize,"number",1,3))throw new Iy(`BaseConv expects config.kernelSize to be number or number[] with length 1, 2, or 3, but received ${JSON.stringify(t.kernelSize)}.`)}getConfig(){const t={kernelSize:this.kernelSize,strides:this.strides,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,activation:a_(this.activation),useBias:this.useBias,biasInitializer:xv(this.biasInitializer),biasRegularizer:f_(this.biasRegularizer),activityRegularizer:f_(this.activityRegularizer),biasConstraint:sb(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}class $_ extends O_{constructor(t,e){super(t,e),this.kernel=null,$_.verifyArgs(e),this.filters=e.filters,Gy(this.filters,"filters"),this.kernelInitializer=_v(e.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.kernelConstraint=rb(e.kernelConstraint),this.kernelRegularizer=g_(e.kernelRegularizer)}build(t){t=Ev(t);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new Iy(`The channel dimension of the input should be defined. Found ${t[e]}`);const n=t[e],s=this.kernelSize.concat([n,this.filters]);this.kernel=this.addWeight("kernel",s,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[{ndim:this.rank+2,axes:{[e]:n}}],this.built=!0}call(t,e){return uo((()=>{let e;t=Nv(t);const n=null==this.bias?null:this.bias.read(),s=Xy(this.activation.getClassName());if(null!=s&&2===this.rank)e=N_(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate,s);else{if(1===this.rank)e=A_(t,this.kernel.read(),n,this.strides[0],this.padding,this.dataFormat,this.dilationRate[0]);else if(2===this.rank)e=N_(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate);else{if(3!==this.rank)throw new Cy("convolutions greater than 3D are not implemented yet.");e=E_(t,this.kernel.read(),n,this.strides,this.padding,this.dataFormat,this.dilationRate)}null!=this.activation&&(e=this.activation.apply(e))}return e}))}computeOutputShape(t){t=Ev(t);const e=[],n="channelsLast"===this.dataFormat?t.slice(1,t.length-1):t.slice(2);for(let i=0;i<n.length;++i){const t=S_(n[i],this.kernelSize[i],this.padding,this.strides[i],"number"===typeof this.dilationRate?this.dilationRate:this.dilationRate[i]);e.push(t)}let s=[t[0]];return"channelsLast"===this.dataFormat?(s=s.concat(e),s.push(this.filters)):(s.push(this.filters),s=s.concat(e)),s}getConfig(){const t={filters:this.filters,kernelInitializer:xv(this.kernelInitializer),kernelRegularizer:f_(this.kernelRegularizer),kernelConstraint:sb(this.kernelConstraint)},e=super.getConfig();return Object.assign(t,e),t}static verifyArgs(t){if(!("filters"in t)||"number"!==typeof t.filters||t.filters<1)throw new Iy(`Convolution layer expected config.filters to be a 'number' > 0 but got ${JSON.stringify(t.filters)}`)}}class R_ extends $_{constructor(t){super(2,t),R_.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t["rank"],t}static verifyArgs(t){if("number"!==typeof t.kernelSize&&!Uy(t.kernelSize,"number",1,2))throw new Iy(`Conv2D expects config.kernelSize to be number or number[] with length 1 or 2, but received ${JSON.stringify(t.kernelSize)}.`)}}R_.className="Conv2D",io(R_);class D_ extends $_{constructor(t){super(3,t),D_.verifyArgs(t)}getConfig(){const t=super.getConfig();return delete t["rank"],t}static verifyArgs(t){if("number"!==typeof t.kernelSize&&(!Array.isArray(t.kernelSize)||1!==t.kernelSize.length&&3!==t.kernelSize.length))throw new Iy(`Conv3D expects config.kernelSize to be number or [number, number, number], but received ${JSON.stringify(t.kernelSize)}.`)}}D_.className="Conv3D",io(D_);class M_ extends R_{constructor(t){if(super(t),this.inputSpec=[new Fv({ndim:4})],"same"!==this.padding&&"valid"!==this.padding)throw new Iy(`Conv2DTranspose currently supports only padding modes 'same' and 'valid', but received padding mode ${this.padding}`)}build(t){if(t=Ev(t),4!==t.length)throw new Iy("Input should have rank 4; Received input shape: "+JSON.stringify(t));const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e])throw new Iy("The channel dimension of the inputs should be defined. Found `None`.");const n=t[e],s=this.kernelSize.concat([this.filters,n]);this.kernel=this.addWeight("kernel",s,"float32",this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint)),this.inputSpec=[new Fv({ndim:4,axes:{[e]:n}})],this.built=!0}call(t,e){return uo((()=>{let e=Nv(t);if(4!==e.shape.length)throw new Iy(`Conv2DTranspose.call() expects input tensor to be rank-4, but received a tensor of rank-${e.shape.length}`);const n=e.shape,s=n[0];let i,r;"channelsFirst"===this.dataFormat?(i=2,r=3):(i=1,r=2);const o=n[i],a=n[r],u=this.kernelSize[0],c=this.kernelSize[1],l=this.strides[0],h=this.strides[1],p=T_(o,l,u,this.padding),d=T_(a,h,c,this.padding),f=[s,p,d,this.filters];"channelsLast"!==this.dataFormat&&(e=rl(e,[0,2,3,1]));let m=Ta(e,this.kernel.read(),f,this.strides,this.padding);return"channelsLast"!==this.dataFormat&&(m=rl(m,[0,3,1,2])),null!=this.bias&&(m=Gb(m,this.bias.read(),this.dataFormat)),null!=this.activation&&(m=this.activation.apply(m)),m}))}computeOutputShape(t){t=Ev(t);const e=t.slice();let n,s,i;"channelsFirst"===this.dataFormat?(n=1,s=2,i=3):(n=3,s=1,i=2);const r=this.kernelSize[0],o=this.kernelSize[1],a=this.strides[0],u=this.strides[1];return e[n]=this.filters,e[s]=T_(e[s],a,r,this.padding),e[i]=T_(e[i],u,o,this.padding),e}getConfig(){const t=super.getConfig();return delete t["dilationRate"],t}}M_.className="Conv2DTranspose",io(M_);class P_ extends $_{constructor(t,e){if(super(t,e),this.DEFAULT_DEPTHWISE_INITIALIZER="glorotUniform",this.DEFAULT_POINTWISE_INITIALIZER="glorotUniform",this.depthwiseKernel=null,this.pointwiseKernel=null,null==e.filters)throw new Iy("The `filters` configuration field is required by SeparableConv, but is unspecified.");if(null!=e.kernelInitializer||null!=e.kernelRegularizer||null!=e.kernelConstraint)throw new Iy("Fields kernelInitializer, kernelRegularizer and kernelConstraint are invalid for SeparableConv2D. Use depthwiseInitializer, depthwiseRegularizer, depthwiseConstraint, pointwiseInitializer, pointwiseRegularizer and pointwiseConstraint instead.");if(null!=e.padding&&"same"!==e.padding&&"valid"!==e.padding)throw new Iy(`SeparableConv${this.rank}D supports only padding modes: 'same' and 'valid', but received ${JSON.stringify(e.padding)}`);this.depthMultiplier=null==e.depthMultiplier?1:e.depthMultiplier,this.depthwiseInitializer=_v(e.depthwiseInitializer||this.DEFAULT_DEPTHWISE_INITIALIZER),this.depthwiseRegularizer=g_(e.depthwiseRegularizer),this.depthwiseConstraint=rb(e.depthwiseConstraint),this.pointwiseInitializer=_v(e.depthwiseInitializer||this.DEFAULT_POINTWISE_INITIALIZER),this.pointwiseRegularizer=g_(e.pointwiseRegularizer),this.pointwiseConstraint=rb(e.pointwiseConstraint)}build(t){if(t=Ev(t),t.length<this.rank+2)throw new Iy(`Inputs to SeparableConv${this.rank}D should have rank ${this.rank+2}, but received input shape: ${JSON.stringify(t)}`);const e="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[e]||t[e]<0)throw new Iy(`The channel dimension of the inputs should be defined, but found ${JSON.stringify(t[e])}`);const n=t[e],s=this.kernelSize.concat([n,this.depthMultiplier]),i=[];for(let o=0;o<this.rank;++o)i.push(1);i.push(n*this.depthMultiplier,this.filters);const r=!0;this.depthwiseKernel=this.addWeight("depthwise_kernel",s,"float32",this.depthwiseInitializer,this.depthwiseRegularizer,r,this.depthwiseConstraint),this.pointwiseKernel=this.addWeight("pointwise_kernel",i,"float32",this.pointwiseInitializer,this.pointwiseRegularizer,r,this.pointwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[this.filters],"float32",this.biasInitializer,this.biasRegularizer,r,this.biasConstraint):this.bias=null,this.inputSpec=[new Fv({ndim:this.rank+2,axes:{[e]:n}})],this.built=!0}call(t,e){return uo((()=>{let e;if(t=Nv(t),1===this.rank)throw new Cy("1D separable convolution is not implemented yet.");return 2===this.rank&&("channelsFirst"===this.dataFormat&&(t=rl(t,[0,2,3,1])),e=bc(t,this.depthwiseKernel.read(),this.pointwiseKernel.read(),this.strides,this.padding,this.dilationRate,"NHWC")),this.useBias&&(e=Gb(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),"channelsFirst"===this.dataFormat&&(e=rl(e,[0,3,1,2])),e}))}getConfig(){const t=super.getConfig();return delete t["rank"],delete t["kernelInitializer"],delete t["kernelRegularizer"],delete t["kernelConstraint"],t["depthwiseInitializer"]=xv(this.depthwiseInitializer),t["pointwiseInitializer"]=xv(this.pointwiseInitializer),t["depthwiseRegularizer"]=f_(this.depthwiseRegularizer),t["pointwiseRegularizer"]=f_(this.pointwiseRegularizer),t["depthwiseConstraint"]=sb(this.depthwiseConstraint),t["pointwiseConstraint"]=sb(this.pointwiseConstraint),t}}P_.className="SeparableConv";class F_ extends P_{constructor(t){super(2,t)}}F_.className="SeparableConv2D",io(F_);class L_ extends $_{constructor(t){super(1,t),L_.verifyArgs(t),this.inputSpec=[{ndim:3}]}getConfig(){const t=super.getConfig();return delete t["rank"],delete t["dataFormat"],t}static verifyArgs(t){if("number"!==typeof t.kernelSize&&!Uy(t.kernelSize,"number",1,1))throw new Iy(`Conv1D expects config.kernelSize to be number or number[] with length 1, but received ${JSON.stringify(t.kernelSize)}.`)}}L_.className="Conv1D",io(L_);class z_ extends Vv{constructor(t){super(t),"number"===typeof t.cropping?this.cropping=[[t.cropping,t.cropping],[t.cropping,t.cropping]]:"number"===typeof t.cropping[0]?this.cropping=[[t.cropping[0],t.cropping[0]],[t.cropping[1],t.cropping[1]]]:this.cropping=t.cropping,this.dataFormat=void 0===t.dataFormat?"channelsLast":t.dataFormat,this.inputSpec=[{ndim:4}]}computeOutputShape(t){return"channelsFirst"===this.dataFormat?[t[0],t[1],t[2]-this.cropping[0][0]-this.cropping[0][1],t[3]-this.cropping[1][0]-this.cropping[1][1]]:[t[0],t[1]-this.cropping[0][0]-this.cropping[0][1],t[2]-this.cropping[1][0]-this.cropping[1][1],t[3]]}call(t,e){return uo((()=>{if(t=Nv(t),"channelsLast"===this.dataFormat){const e=Fb(t,this.cropping[0][0],t.shape[1]-this.cropping[0][0]-this.cropping[0][1],2);return Fb(e,this.cropping[1][0],t.shape[2]-this.cropping[1][1]-this.cropping[1][0],3)}{const e=Fb(t,this.cropping[0][0],t.shape[2]-this.cropping[0][0]-this.cropping[0][1],3);return Fb(e,this.cropping[1][0],t.shape[3]-this.cropping[1][1]-this.cropping[1][0],4)}}))}getConfig(){const t={cropping:this.cropping,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}z_.className="Cropping2D",io(z_);class B_ extends Vv{constructor(t){super(t),this.DEFAULT_SIZE=[2,2],this.inputSpec=[{ndim:4}],this.size=null==t.size?this.DEFAULT_SIZE:t.size,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,pb(this.dataFormat),this.interpolation=null==t.interpolation?"nearest":t.interpolation,db(this.interpolation)}computeOutputShape(t){if("channelsFirst"===this.dataFormat){const e=null==t[2]?null:this.size[0]*t[2],n=null==t[3]?null:this.size[1]*t[3];return[t[0],t[1],e,n]}{const e=null==t[1]?null:this.size[0]*t[1],n=null==t[2]?null:this.size[1]*t[2];return[t[0],e,n,t[3]]}}call(t,e){return uo((()=>{let e=Nv(t);const n=e.shape;if("channelsFirst"===this.dataFormat){e=rl(e,[0,2,3,1]);const t=this.size[0]*n[2],s=this.size[1]*n[3],i="nearest"===this.interpolation?e.resizeNearestNeighbor([t,s]):e.resizeBilinear([t,s]);return rl(i,[0,3,1,2])}{const t=this.size[0]*n[1],s=this.size[1]*n[2];return"nearest"===this.interpolation?e.resizeNearestNeighbor([t,s]):e.resizeBilinear([t,s])}}))}getConfig(){const t={size:this.size,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function q_(t,e,n=[1,1],s="valid",i,r){return uo((()=>{null==i&&(i=ky()),pb(i);let o=I_(t,i);if(4!==t.rank)throw new Iy(`Input for depthwiseConv2d is required to be 4-D, but is instead ${t.rank}-D`);if(4!==e.rank)throw new Iy(`depthwiseKernel is required to be 4-D, but is instead ${e.rank}-D`);return o=Na(o,e,n,"same"===s?"same":"valid","NHWC",r),"channelsFirst"===i&&(o=rl(o,[0,3,1,2])),o}))}B_.className="UpSampling2D",io(B_);class V_ extends O_{constructor(t){super(2,t),this.depthwiseKernel=null,this.depthMultiplier=null==t.depthMultiplier?1:t.depthMultiplier,this.depthwiseInitializer=_v(t.depthwiseInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.depthwiseConstraint=rb(t.depthwiseConstraint),this.depthwiseRegularizer=g_(t.depthwiseRegularizer)}build(t){if(t=Ev(t),t.length<4)throw new Iy(`Inputs to DepthwiseConv2D should have rank 4. Received input shape: ${JSON.stringify(t)}.`);const e="channelsFirst"===this.dataFormat?1:3;if(null==t[e]||t[e]<0)throw new Iy(`The channel dimension of the inputs to DepthwiseConv2D should be defined, but is not (${t[e]}).`);const n=t[e],s=[this.kernelSize[0],this.kernelSize[1],n,this.depthMultiplier];this.depthwiseKernel=this.addWeight("depthwise_kernel",s,null,this.depthwiseInitializer,this.depthwiseRegularizer,!0,this.depthwiseConstraint),this.useBias?this.bias=this.addWeight("bias",[n*this.depthMultiplier],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return uo((()=>{t=Nv(t);let e=q_(t,this.depthwiseKernel.read(),this.strides,this.padding,this.dataFormat,null);return this.useBias&&(e=Gb(e,this.bias.read(),this.dataFormat)),null!=this.activation&&(e=this.activation.apply(e)),e}))}computeOutputShape(t){t=Ev(t);const e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],s="channelsFirst"===this.dataFormat?t[1]*this.depthMultiplier:t[3]*this.depthMultiplier,i=S_(e,this.kernelSize[0],this.padding,this.strides[0]),r=S_(n,this.kernelSize[1],this.padding,this.strides[1]);return"channelsFirst"===this.dataFormat?[t[0],s,i,r]:[t[0],i,r,s]}getConfig(){const t=super.getConfig();return t["depthMultiplier"]=this.depthMultiplier,t["depthwiseInitializer"]=xv(this.depthwiseInitializer),t["depthwiseRegularizer"]=f_(this.depthwiseRegularizer),t["depthwiseConstraint"]=sb(this.depthwiseRegularizer),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function W_(t,e,n,s){if(Array.isArray(t)){if(null!=e||null!=n)throw new Iy("When inputs is an array, neither initialState or constants should be provided");null!=s&&(n=t.slice(t.length-s,t.length),t=t.slice(0,t.length-s)),t.length>1&&(e=t.slice(1,t.length)),t=t[0]}function i(t){return null==t||Array.isArray(t)?t:[t]}return e=i(e),n=i(n),{inputs:t,initialState:e,constants:n}}function j_(t,e,n,s=!1,i,r,o=!1,a=!1){return uo((()=>{const u=e.shape.length;if(u<3)throw new Iy(`Input should be at least 3D, but is ${u}D.`);const c=[1,0].concat(Nb(2,u));if(e=rl(e,c),null!=r)throw new Cy("The rnn() functoin of the deeplearn.js backend does not support constants yet.");o&&console.warn("Backend rnn(): the unroll = true option is not applicable to the imperative deeplearn.js backend."),null!=i&&(i=i.asType("bool").asType("float32"),i.rank===u-1&&(i=Va(i,-1)),i=rl(i,c)),s&&(e=fc(e,0),null!=i&&(i=fc(i,0)));const l=[];let h,p=n;const d=e.shape[0],f=Qc(e);let m,g;null!=i&&(m=Qc(i));for(let e=0;e<d;++e){const n=f[e],s=uo((()=>t(n,p)));if(null==i)h=s[0],p=s[1];else{const t=uo((()=>{const t=m[e],n=Ju(t).sub(t),i=s[0].mul(t).add(p[0].mul(n)),r=p.map(((e,i)=>s[1][i].mul(t).add(e.mul(n))));return{output:i,newStates:r}}));h=t.output,p=t.newStates}a&&l.push(h)}if(a){const t=1;g=Vc(l,t)}return[h,g,p]}))}V_.className="DepthwiseConv2D",io(V_);class U_ extends Vv{constructor(t){let e;if(super(t),null==t.cell)throw new Iy("cell property is missing for the constructor of RNN.");if(e=Array.isArray(t.cell)?new J_({cells:t.cell}):t.cell,null==e.stateSize)throw new Iy("The RNN cell should have an attribute `stateSize` (tuple of integers, one integer per RNN state).");this.cell=e,this.returnSequences=null!=t.returnSequences&&t.returnSequences,this.returnState=null!=t.returnState&&t.returnState,this.goBackwards=null!=t.goBackwards&&t.goBackwards,this._stateful=null!=t.stateful&&t.stateful,this.unroll=null!=t.unroll&&t.unroll,this.supportsMasking=!0,this.inputSpec=[new Fv({ndim:3})],this.stateSpec=null,this.states_=null,this.numConstants=null,this.keptStates=[]}getStates(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;return Nb(0,t).map((t=>null))}return this.states_}setStates(t){this.states_=t}computeOutputShape(t){Cv(t)&&(t=t[0]);let e=this.cell.stateSize;Array.isArray(e)||(e=[e]);const n=e[0];let s;if(s=this.returnSequences?[t[0],t[1],n]:[t[0],n],this.returnState){const n=[];for(const s of e)n.push([t[0],s]);return[s].concat(n)}return s}computeMask(t,e){return uo((()=>{Array.isArray(e)&&(e=e[0]);const t=this.returnSequences?e:null;if(this.returnState){const e=this.states.map((t=>null));return[t].concat(e)}return t}))}get states(){if(null==this.states_){const t=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1,e=[];for(let n=0;n<t;++n)e.push(null);return e}return this.states_}set states(t){this.states_=t}build(t){const e=null;if(null!=this.numConstants)throw new Cy("Constants support is not implemented in RNN yet.");Cv(t)&&(t=t[0]);const n=this.stateful?t[0]:null,s=t.slice(2);this.inputSpec[0]=new Fv({shape:[n,null,...s]});const i=[t[0]].concat(t.slice(2));if(null!=e)throw new Cy("Constants support is not implemented in RNN yet.");let r;if(this.cell.build(i),r=Array.isArray(this.cell.stateSize)?this.cell.stateSize:[this.cell.stateSize],null!=this.stateSpec){if(!S(this.stateSpec.map((t=>t.shape[t.shape.length-1])),r))throw new Iy(`An initialState was passed that is not compatible with cell.stateSize. Received stateSpec=${this.stateSpec}; However cell.stateSize is ${this.cell.stateSize}`)}else this.stateSpec=r.map((t=>new Fv({shape:[null,t]})));this.stateful&&this.resetStates()}resetStates(t,e=!1){uo((()=>{if(!this.stateful)throw new Sy("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape[0];if(null==n)throw new Iy("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.states_)Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>Qu([n,t]))):this.states_=[Qu([n,this.cell.stateSize])];else if(null==t)co(this.states_),null!=this.keptStates&&(co(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((t=>Qu([n,t]))):this.states_[0]=Qu([n,this.cell.stateSize]);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new Iy(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);!0===e?this.keptStates.push(this.states_.slice()):co(this.states_);for(let e=0;e<this.states_.length;++e){const s=t[e],i=Array.isArray(this.cell.stateSize)?this.cell.stateSize[e]:this.cell.stateSize,r=[n,i];if(!S(s.shape,r))throw new Iy(`State ${e} is incompatible with layer ${this.name}: expected shape=${r}, received shape=${s.shape}`);this.states_[e]=s}}this.states_=this.states_.map((t=>lo(t.clone())))}))}apply(t,e){let n=null==e?null:e["initialState"],s=null==e?null:e["constants"];null==e&&(e={});const i=W_(t,n,s,this.numConstants);t=i.inputs,n=i.initialState,s=i.constants;let r=[],o=[];if(null!=n){e["initialState"]=n,r=r.concat(n),this.stateSpec=[];for(const t of n)this.stateSpec.push(new Fv({shape:t.shape}));o=o.concat(this.stateSpec)}null!=s&&(e["constants"]=s,r=r.concat(s),this.numConstants=s.length);const a=r[0]instanceof Lv;if(a){const n=[t].concat(r),s=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=s;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return uo((()=>{const n=null==e?null:e["mask"],s=null==e?null:e["training"];let i=null==e?null:e["initialState"];t=Nv(t),null==i&&(i=this.stateful?this.states_:this.getInitialState(t));const r=Array.isArray(this.cell.stateSize)?this.cell.stateSize.length:1;if(i.length!==r)throw new Iy(`RNN Layer has ${r} state(s) but was passed ${i.length} initial state(s).`);this.unroll&&console.warn("Ignoring unroll = true for RNN layer, due to imperative backend.");const o={training:s},a=(t,e)=>{const n=this.cell.call([t].concat(e),o);return[n[0],n.slice(1)]},u=j_(a,t,i,this.goBackwards,n,null,this.unroll,this.returnSequences),c=u[0],l=u[1],h=u[2];this.stateful&&this.resetStates(h,s);const p=this.returnSequences?l:c;return this.returnState?[p].concat(h):p}))}getInitialState(t){return uo((()=>{let e=Qu(t.shape);return e=mu(e,[1,2]),e=Ob(e),Array.isArray(this.cell.stateSize)?this.cell.stateSize.map((t=>t>1?Bb(e,[1,t]):e)):this.cell.stateSize>1?[Bb(e,[1,this.cell.stateSize])]:[e]}))}get trainableWeights(){return this.trainable?this.cell.trainableWeights:[]}get nonTrainableWeights(){return this.trainable?this.cell.nonTrainableWeights:this.cell.weights}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.cell&&this.cell.setFastWeightInitDuringBuild(t)}getConfig(){const t=super.getConfig(),e={returnSequences:this.returnSequences,returnState:this.returnState,goBackwards:this.goBackwards,stateful:this.stateful,unroll:this.unroll};null!=this.numConstants&&(e["numConstants"]=this.numConstants);const n=this.cell.getConfig();return this.getClassName()===U_.className&&(e["cell"]={className:this.cell.getClassName(),config:n}),Object.assign({},n,t,e)}static fromConfig(t,e,n={}){const s=e["cell"],i=ow(s,n);return new t(Object.assign(e,{cell:i}))}}U_.className="RNN",io(U_);class G_ extends Vv{}class H_ extends G_{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Gy(this.units,"units"),this.activation=c_(null==t.activation?this.DEFAULT_ACTIVATION:t.activation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=_v(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_v(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_v(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=g_(t.kernelRegularizer),this.recurrentRegularizer=g_(t.recurrentRegularizer),this.biasRegularizer=g_(t.biasRegularizer),this.kernelConstraint=rb(t.kernelConstraint),this.recurrentConstraint=rb(t.recurrentConstraint),this.biasConstraint=rb(t.biasConstraint),this.dropout=Cb([1,Ab([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=Cb([1,Ab([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Ev(t),this.kernel=this.addWeight("kernel",[t[t.length-1],this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return uo((()=>{if(2!==t.length)throw new Iy(`SimpleRNNCell expects 2 input Tensors, got ${t.length}.`);let n=t[1];t=t[0];const s=null!=e["training"]&&e["training"];let i;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tk({ones:()=>Ju(t),rate:this.dropout,training:s})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tk({ones:()=>Ju(n),rate:this.recurrentDropout,training:s}));const r=this.dropoutMask,o=this.recurrentDropoutMask;i=Vb(null!=r?hu(t,r):t,this.kernel.read()),null!=this.bias&&(i=Gb(i,this.bias.read())),null!=o&&(n=hu(n,o));let a=xo(i,Vb(n,this.recurrentKernel.read()));return null!=this.activation&&(a=this.activation.apply(a)),[a,a]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:a_(this.activation),useBias:this.useBias,kernelInitializer:xv(this.kernelInitializer),recurrentInitializer:xv(this.recurrentInitializer),biasInitializer:xv(this.biasInitializer),kernelRegularizer:f_(this.kernelRegularizer),recurrentRegularizer:f_(this.recurrentRegularizer),biasRegularizer:f_(this.biasRegularizer),activityRegularizer:f_(this.activityRegularizer),kernelConstraint:sb(this.kernelConstraint),recurrentConstraint:sb(this.recurrentConstraint),biasConstraint:sb(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout};return Object.assign({},t,e)}}H_.className="SimpleRNNCell",io(H_);class K_ extends U_{constructor(t){t.cell=new H_(t),super(t)}call(t,e){return uo((()=>{null!=this.cell.dropoutMask&&(co(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(co(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e["mask"],s=null==e?null:e["training"],i=null==e?null:e["initialState"];return super.call(t,{mask:n,training:s,initialState:i})}))}static fromConfig(t,e){return new t(e)}}K_.className="SimpleRNN",io(K_);class X_ extends G_{constructor(t){if(super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",t.resetAfter)throw new Iy("GRUCell does not support reset_after parameter set to true.");this.units=t.units,Gy(this.units,"units"),this.activation=c_(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=c_(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=_v(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_v(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_v(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelRegularizer=g_(t.kernelRegularizer),this.recurrentRegularizer=g_(t.recurrentRegularizer),this.biasRegularizer=g_(t.biasRegularizer),this.kernelConstraint=rb(t.kernelConstraint),this.recurrentConstraint=rb(t.recurrentConstraint),this.biasConstraint=rb(t.biasConstraint),this.dropout=Cb([1,Ab([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=Cb([1,Ab([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.implementation=t.implementation,this.stateSize=this.units,this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){t=Ev(t);const e=t[t.length-1];this.kernel=this.addWeight("kernel",[e,3*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,3*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias?this.bias=this.addWeight("bias",[3*this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint):this.bias=null,this.built=!0}call(t,e){return uo((()=>{if(2!==t.length)throw new Iy(`GRUCell expects 2 input Tensors (inputs, h, c), got ${t.length}.`);const n=null!=e["training"]&&e["training"];let s=t[1];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tk({ones:()=>Ju(t),rate:this.dropout,training:n,count:3})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tk({ones:()=>Ju(s),rate:this.recurrentDropout,training:n,count:3}));const i=this.dropoutMask,r=this.recurrentDropoutMask;let o,a,u;0<this.dropout&&this.dropout<1&&(t=hu(t,i[0]));let c=Vb(t,this.kernel.read());this.useBias&&(c=Gb(c,this.bias.read())),0<this.recurrentDropout&&this.recurrentDropout<1&&(s=hu(s,r[0]));const l=this.recurrentKernel.read(),[h,p]=Pc(l,[2*this.units,this.units],l.rank-1),d=Vb(s,h),[f,m,g]=Pc(c,3,c.rank-1),[y,b]=Pc(d,2,d.rank-1);o=this.recurrentActivation.apply(xo(f,y)),a=this.recurrentActivation.apply(xo(m,b));const v=Vb(hu(a,s),p);u=this.activation.apply(xo(g,v));const w=xo(hu(o,s),hu(xo(1,Uu(o)),u));return[w,w]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:a_(this.activation),recurrentActivation:a_(this.recurrentActivation),useBias:this.useBias,kernelInitializer:xv(this.kernelInitializer),recurrentInitializer:xv(this.recurrentInitializer),biasInitializer:xv(this.biasInitializer),kernelRegularizer:f_(this.kernelRegularizer),recurrentRegularizer:f_(this.recurrentRegularizer),biasRegularizer:f_(this.biasRegularizer),activityRegularizer:f_(this.activityRegularizer),kernelConstraint:sb(this.kernelConstraint),recurrentConstraint:sb(this.recurrentConstraint),biasConstraint:sb(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation,resetAfter:!1};return Object.assign({},t,e)}}X_.className="GRUCell",io(X_);class Q_ extends U_{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new X_(t),super(t)}call(t,e){return uo((()=>{null!=this.cell.dropoutMask&&(co(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(co(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e["mask"],s=null==e?null:e["training"],i=null==e?null:e["initialState"];return super.call(t,{mask:n,training:s,initialState:i})}))}static fromConfig(t,e){return 0===e["implmentation"]&&(e["implementation"]=1),new t(e)}}Q_.className="GRU",io(Q_);class Y_ extends G_{constructor(t){super(t),this.DEFAULT_ACTIVATION="tanh",this.DEFAULT_RECURRENT_ACTIVATION="hardSigmoid",this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_RECURRENT_INITIALIZER="orthogonal",this.DEFAULT_BIAS_INITIALIZER="zeros",this.units=t.units,Gy(this.units,"units"),this.activation=c_(void 0===t.activation?this.DEFAULT_ACTIVATION:t.activation),this.recurrentActivation=c_(void 0===t.recurrentActivation?this.DEFAULT_RECURRENT_ACTIVATION:t.recurrentActivation),this.useBias=null==t.useBias||t.useBias,this.kernelInitializer=_v(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.recurrentInitializer=_v(t.recurrentInitializer||this.DEFAULT_RECURRENT_INITIALIZER),this.biasInitializer=_v(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.unitForgetBias=t.unitForgetBias,this.kernelRegularizer=g_(t.kernelRegularizer),this.recurrentRegularizer=g_(t.recurrentRegularizer),this.biasRegularizer=g_(t.biasRegularizer),this.kernelConstraint=rb(t.kernelConstraint),this.recurrentConstraint=rb(t.recurrentConstraint),this.biasConstraint=rb(t.biasConstraint),this.dropout=Cb([1,Ab([0,null==t.dropout?0:t.dropout])]),this.recurrentDropout=Cb([1,Ab([0,null==t.recurrentDropout?0:t.recurrentDropout])]),this.implementation=t.implementation,this.stateSize=[this.units,this.units],this.dropoutMask=null,this.recurrentDropoutMask=null}build(t){var e;t=Ev(t);const n=t[t.length-1];let s;if(this.kernel=this.addWeight("kernel",[n,4*this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.recurrentKernel=this.addWeight("recurrent_kernel",[this.units,4*this.units],null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){if(this.unitForgetBias){const t=this.biasInitializer,n=this.units;s=new(e=class extends nv{apply(e,s){const i=t.apply([n]),r=(new iv).apply([n]),o=t.apply([2*n]);return zb(zb(i,r),o)}},e.className="CustomInit",e)}else s=this.biasInitializer;this.bias=this.addWeight("bias",[4*this.units],null,s,this.biasRegularizer,!0,this.biasConstraint)}else this.bias=null;this.built=!0}call(t,e){return uo((()=>{const n=null!=e["training"]&&e["training"];if(3!==t.length)throw new Iy(`LSTMCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);let s=t[1];const i=t[2];t=t[0],0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tk({ones:()=>Ju(t),rate:this.dropout,training:n,count:4})),0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tk({ones:()=>Ju(s),rate:this.recurrentDropout,training:n,count:4}));const r=this.dropoutMask,o=this.recurrentDropoutMask;let a,u,c,l;0<this.dropout&&this.dropout<1&&(t=hu(t,r[0]));let h=Vb(t,this.kernel.read());0<this.recurrentDropout&&this.recurrentDropout<1&&(s=hu(s,o[0])),h=xo(h,Vb(s,this.recurrentKernel.read())),this.useBias&&(h=Gb(h,this.bias.read()));const[p,d,f,m]=Pc(h,4,h.rank-1);a=this.recurrentActivation.apply(p),u=this.recurrentActivation.apply(d),c=xo(hu(u,i),hu(a,this.activation.apply(f))),l=this.recurrentActivation.apply(m);const g=hu(l,this.activation.apply(c));return[g,g,c]}))}getConfig(){const t=super.getConfig(),e={units:this.units,activation:a_(this.activation),recurrentActivation:a_(this.recurrentActivation),useBias:this.useBias,kernelInitializer:xv(this.kernelInitializer),recurrentInitializer:xv(this.recurrentInitializer),biasInitializer:xv(this.biasInitializer),unitForgetBias:this.unitForgetBias,kernelRegularizer:f_(this.kernelRegularizer),recurrentRegularizer:f_(this.recurrentRegularizer),biasRegularizer:f_(this.biasRegularizer),activityRegularizer:f_(this.activityRegularizer),kernelConstraint:sb(this.kernelConstraint),recurrentConstraint:sb(this.recurrentConstraint),biasConstraint:sb(this.biasConstraint),dropout:this.dropout,recurrentDropout:this.recurrentDropout,implementation:this.implementation};return Object.assign({},t,e)}}Y_.className="LSTMCell",io(Y_);class Z_ extends U_{constructor(t){0===t.implementation&&console.warn("`implementation=0` has been deprecated, and now defaults to `implementation=1`. Please update your layer call."),t.cell=new Y_(t),super(t)}call(t,e){return uo((()=>{null!=this.cell.dropoutMask&&(co(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(co(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null);const n=null==e?null:e["mask"],s=null==e?null:e["training"],i=null==e?null:e["initialState"];return super.call(t,{mask:n,training:s,initialState:i})}))}static fromConfig(t,e){return 0===e["implmentation"]&&(e["implementation"]=1),new t(e)}}Z_.className="LSTM",io(Z_);class J_ extends G_{constructor(t){super(t),this.cells=t.cells}get stateSize(){const t=[];for(const e of this.cells.slice().reverse())Array.isArray(e.stateSize)?t.push(...e.stateSize):t.push(e.stateSize);return t}call(t,e){return uo((()=>{let n=t.slice(1);const s=[];for(const t of this.cells.slice().reverse())Array.isArray(t.stateSize)?s.push(n.splice(0,t.stateSize.length)):s.push(n.splice(0,1));s.reverse();const i=[];let r;for(let o=0;o<this.cells.length;++o){const a=this.cells[o];n=s[o],r=0===o?[t[0]].concat(n):[r[0]].concat(n),r=a.call(r,e),i.push(r.slice(1))}n=[];for(const t of i.slice().reverse())n.push(...t);return[r[0]].concat(n)}))}build(t){let e;Cv(t)&&(t=t[0]),this.cells.forEach(((n,s)=>{bb(`RNNCell_${s}`,(()=>{n.build(t),e=Array.isArray(n.stateSize)?n.stateSize[0]:n.stateSize,t=[t[0],e]}))})),this.built=!0}getConfig(){const t=super.getConfig(),e=t=>({className:t.getClassName(),config:t.getConfig()}),n=this.cells.map(e),s={cells:n};return Object.assign({},t,s)}static fromConfig(t,e,n={}){const s=[];for(const i of e["cells"])s.push(ow(i,n));return new t({cells:s})}get trainableWeights(){if(!this.trainable)return[];const t=[];for(const e of this.cells)t.push(...e.trainableWeights);return t}get nonTrainableWeights(){const t=[];for(const e of this.cells)t.push(...e.nonTrainableWeights);if(!this.trainable){const e=[];for(const t of this.cells)e.push(...t.trainableWeights);return e.concat(t)}return t}getWeights(){const t=[];for(const e of this.cells)t.push(...e.weights);return Mv(t)}setWeights(t){const e=[];for(const n of this.cells){const s=n.weights.length,i=t.splice(s);for(let t=0;t<n.weights.length;++t)e.push([n.weights[t],i[t]])}Pv(e)}}function tk(t){const{ones:e,rate:n,training:s=!1,count:i=1}=t,r=()=>Xb(e(),n),o=()=>Yb(r,e,s);if(!i||i<=1)return lo(o().clone());const a=Array(i).fill(void 0).map(o);return a.map((t=>lo(t.clone())))}J_.className="StackedRNNCells",io(J_);
/**
 * @license
 * Copyright 2020 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
var ek=function(t,e){var n={};for(var s in t)Object.prototype.hasOwnProperty.call(t,s)&&e.indexOf(s)<0&&(n[s]=t[s]);if(null!=t&&"function"===typeof Object.getOwnPropertySymbols){var i=0;for(s=Object.getOwnPropertySymbols(t);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(t,s[i])&&(n[s[i]]=t[s[i]])}return n};class nk extends U_{constructor(t){if(t.unroll)throw new Cy("Unrolling is not possible with convolutional RNNs.");if(Array.isArray(t.cell))throw new Cy("It is not possible at the moment to stack convolutional cells.");super(t),this.inputSpec=[new Fv({ndim:5})]}call(t,e){return uo((()=>{if(null!=this.cell.dropoutMask&&(co(this.cell.dropoutMask),this.cell.dropoutMask=null),null!=this.cell.recurrentDropoutMask&&(co(this.cell.recurrentDropoutMask),this.cell.recurrentDropoutMask=null),e&&e["constants"])throw new Iy("ConvRNN2D cell does not support constants");const n=null==e?null:e["mask"],s=null==e?null:e["training"],i=null==e?null:e["initialState"];return super.call(t,{mask:n,training:s,initialState:i})}))}computeOutputShape(t){let e=this.computeSingleOutputShape(t);return this.returnSequences||(e=[e[0],...e.slice(2)]),this.returnState&&(e=[e,...Array(2).fill([t[0],...e.slice(-3)])]),e}getInitialState(t){return uo((()=>{const{stateSize:e}=this.cell,n=t.shape,s=this.computeSingleOutputShape(n),i=[s[0],...s.slice(2)],r=Qu(i);return Array.isArray(e)?Array(e.length).fill(r):[r]}))}resetStates(t,e=!1){uo((()=>{if(!this.stateful)throw new Sy("Cannot call resetStates() on an RNN Layer that is not stateful.");const n=this.inputSpec[0].shape,s=this.computeSingleOutputShape(n),i=[s[0],...s.slice(2)],r=n[0];if(null==r)throw new Iy("If an RNN is stateful, it needs to know its batch size. Specify the batch size of your input tensors: \n- If using a Sequential model, specify the batch size by passing a `batchInputShape` option to your first layer.\n- If using the functional API, specify the batch size by passing a `batchShape` option to your Input layer.");if(null==this.getStates())Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Qu(i))):this.states_=[Qu(i)];else if(null==t)co(this.states_),null!=this.keptStates&&(co(this.keptStates),this.keptStates=[]),Array.isArray(this.cell.stateSize)?this.states_=this.cell.stateSize.map((()=>Qu(i))):this.states_[0]=Qu(i);else{if(Array.isArray(t)||(t=[t]),t.length!==this.states_.length)throw new Iy(`Layer ${this.name} expects ${this.states_.length} state(s), but it received ${t.length} state value(s). Input received: ${t}`);e?this.keptStates.push(this.states_.slice()):co(this.states_);for(let e=0;e<this.states_.length;++e){const n=t[e],s=i;if(!S(n.shape,s))throw new Iy(`State ${e} is incompatible with layer ${this.name}: expected shape=${s}, received shape=${n.shape}`);this.states_[e]=n}}this.states_=this.states_.map((t=>lo(t.clone())))}))}computeSingleOutputShape(t){const{dataFormat:e,filters:n,kernelSize:s,padding:i,strides:r,dilationRate:o}=this.cell,a="channelsFirst"===e,u=t[a?3:2],c=t[a?4:3],l=S_(u,s[0],i,r[0],o[0]),h=S_(c,s[1],i,r[1],o[1]),p=[...t.slice(0,2),...a?[n,l,h]:[l,h,n]];return p}}nk.className="ConvRNN2D";class sk extends Y_{constructor(t){const{filters:e,kernelSize:n,strides:s,padding:i,dataFormat:r,dilationRate:o}=t;super(Object.assign({},t,{units:e})),this.filters=e,Gy(this.filters,"filters"),this.kernelSize=k_(n,2,"kernelSize"),this.kernelSize.forEach((t=>Gy(t,"kernelSize"))),this.strides=k_(s||1,2,"strides"),this.strides.forEach((t=>Gy(t,"strides"))),this.padding=i||"valid",fb(this.padding),this.dataFormat=r||"channelsLast",pb(this.dataFormat),this.dilationRate=k_(o||1,2,"dilationRate"),this.dilationRate.forEach((t=>Gy(t,"dilationRate")))}build(t){var e;t=Ev(t);const n="channelsFirst"===this.dataFormat?1:t.length-1;if(null==t[n])throw new Iy(`The channel dimension of the input should be defined. Found ${t[n]}`);const s=t[n],i=4,r=this.kernelSize.concat([s,this.filters*i]);this.kernel=this.addWeight("kernel",r,null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint);const o=this.kernelSize.concat([this.filters,this.filters*i]);if(this.recurrentKernel=this.addWeight("recurrent_kernel",o,null,this.recurrentInitializer,this.recurrentRegularizer,!0,this.recurrentConstraint),this.useBias){let t;if(this.unitForgetBias){const n=this.biasInitializer,s=this.filters;t=new(e=class extends nv{apply(t,e){const i=n.apply([s]),r=Yu([s]),o=n.apply([2*s]);return Lb([i,r,o])}},e.className="CustomInit",e)}else t=this.biasInitializer;this.bias=this.addWeight("bias",[this.filters*i],null,t,this.biasRegularizer,!0,this.biasConstraint)}this.built=!0}call(t,e){return uo((()=>{if(3!==t.length)throw new Iy(`ConvLSTM2DCell expects 3 input Tensors (inputs, h, c), got ${t.length}.`);const n=e["training"]||!1,s=t[0],i=t[1],r=t[2],o=4;0<this.dropout&&this.dropout<1&&null==this.dropoutMask&&(this.dropoutMask=tk({ones:()=>Ju(s),rate:this.dropout,training:n,count:o}));const a=this.dropoutMask,u=(t,e,n)=>e&&e[n]?hu(e[n],t):t;let c=u(s,a,0),l=u(s,a,1),h=u(s,a,2),p=u(s,a,3);0<this.recurrentDropout&&this.recurrentDropout<1&&null==this.recurrentDropoutMask&&(this.recurrentDropoutMask=tk({ones:()=>Ju(i),rate:this.recurrentDropout,training:n,count:o}));const d=this.recurrentDropoutMask;let f=u(i,d,0),m=u(i,d,1),g=u(i,d,2),y=u(i,d,3);const b=3,[v,w,x,_]=Pc(this.kernel.read(),o,b),[k,S,T,I]=this.useBias?Pc(this.bias.read(),o):[null,null,null,null];c=this.inputConv(c,v,k,this.padding),l=this.inputConv(l,w,S,this.padding),h=this.inputConv(h,x,T,this.padding),p=this.inputConv(p,_,I,this.padding);const[C,A,N,E]=Pc(this.recurrentKernel.read(),o,b);f=this.recurrentConv(f,C),m=this.recurrentConv(m,A),g=this.recurrentConv(g,N),y=this.recurrentConv(y,E);const O=this.recurrentActivation.apply(xo(c,f)),$=this.recurrentActivation.apply(xo(l,m)),R=xo(hu($,r),hu(O,this.activation.apply(xo(h,g)))),D=hu(this.recurrentActivation.apply(xo(p,y)),this.activation.apply(R));return[D,D,R]}))}getConfig(){const t=super.getConfig(),{units:e}=t,n=ek(t,["units"]),s={filters:this.filters,kernelSize:this.kernelSize,padding:this.padding,dataFormat:this.dataFormat,dilationRate:this.dilationRate,strides:this.strides};return Object.assign({},n,s)}inputConv(t,e,n,s){const i=va(t,e,this.strides,s||"valid","channelsFirst"===this.dataFormat?"NCHW":"NHWC",this.dilationRate);return n?Gb(i,n,this.dataFormat):i}recurrentConv(t,e){const n=1;return va(t,e,n,"same","channelsFirst"===this.dataFormat?"NCHW":"NHWC")}}sk.className="ConvLSTM2DCell",io(sk);class ik extends nk{constructor(t){const e=new sk(t);super(Object.assign({},t,{cell:e}))}static fromConfig(t,e){return new t(e)}}ik.className="ConvLSTM2D",io(ik);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class rk extends Vv{constructor(t){super(t),this.rate=Math.max(Math.min(t.rate,1),0),this.noiseShape=t.noiseShape,this.seed=t.seed,this.supportsMasking=!0}getNoiseShape(t){if(null==this.noiseShape)return this.noiseShape;const e=t.shape,n=[];for(let s=0;s<this.noiseShape.length;++s)n.push(null==this.noiseShape[s]?e[s]:this.noiseShape[s]);return n}call(t,e){return uo((()=>{this.invokeCallHook(t,e);const n=Nv(t);if(0<this.rate&&this.rate<1){const t=null!=e["training"]&&e["training"],s=this.getNoiseShape(n),i=Yb((()=>Xb(n,this.rate,s,this.seed)),(()=>n),t);return i}return t}))}getConfig(){const t={rate:this.rate,noiseShape:this.noiseShape,seed:this.seed},e=super.getConfig();return Object.assign(t,e),t}dispose(){return super.dispose()}}rk.className="Dropout",io(rk);class ok extends rk{constructor(t){super(t),this.inputSpec=[{ndim:3}]}getNoiseShape(t){const e=t.shape;return[e[0],1,e[2]]}}ok.className="SpatialDropout1D",io(ok);class ak extends Vv{constructor(t){if(super(t),this.activation=null,this.useBias=!0,this.kernel=null,this.bias=null,this.DEFAULT_KERNEL_INITIALIZER="glorotNormal",this.DEFAULT_BIAS_INITIALIZER="zeros",null==t.batchInputShape&&null==t.inputShape&&null!=t.inputDim){let e=null;null!=t.batchSize&&(e=t.batchSize),this.batchInputShape=[e,t.inputDim]}this.units=t.units,Gy(this.units,"units"),this.activation=c_(t.activation),null!=t.useBias&&(this.useBias=t.useBias),this.kernelInitializer=_v(t.kernelInitializer||this.DEFAULT_KERNEL_INITIALIZER),this.biasInitializer=_v(t.biasInitializer||this.DEFAULT_BIAS_INITIALIZER),this.kernelConstraint=rb(t.kernelConstraint),this.biasConstraint=rb(t.biasConstraint),this.kernelRegularizer=g_(t.kernelRegularizer),this.biasRegularizer=g_(t.biasRegularizer),this.activityRegularizer=g_(t.activityRegularizer),this.supportsMasking=!0,this.inputSpec=[{minNDim:2}]}build(t){t=Ev(t);const e=t[t.length-1];null==this.kernel&&(this.kernel=this.addWeight("kernel",[e,this.units],null,this.kernelInitializer,this.kernelRegularizer,!0,this.kernelConstraint),this.useBias&&(this.bias=this.addWeight("bias",[this.units],null,this.biasInitializer,this.biasRegularizer,!0,this.biasConstraint))),this.inputSpec=[{minNDim:2,axes:{[-1]:e}}],this.built=!0}computeOutputShape(t){t=Ev(t);const e=t.slice();return e[e.length-1]=this.units,e}call(t,e){return uo((()=>{this.invokeCallHook(t,e);const n=Nv(t),s=Xy(this.activation.getClassName());let i;return null!=s?i=Vb(n,this.kernel.read(),s,this.bias?this.bias.read():null):(i=Vb(n,this.kernel.read()),null!=this.bias&&(i=Gb(i,this.bias.read())),null!=this.activation&&(i=this.activation.apply(i))),i}))}getConfig(){const t={units:this.units,activation:a_(this.activation),useBias:this.useBias,kernelInitializer:xv(this.kernelInitializer),biasInitializer:xv(this.biasInitializer),kernelRegularizer:f_(this.kernelRegularizer),biasRegularizer:f_(this.biasRegularizer),activityRegularizer:f_(this.activityRegularizer),kernelConstraint:sb(this.kernelConstraint),biasConstraint:sb(this.biasConstraint)},e=super.getConfig();return Object.assign(t,e),t}}ak.className="Dense",io(ak);class uk extends Vv{constructor(t){t=t||{},super(t),this.inputSpec=[{minNDim:3}],this.dataFormat=t.dataFormat}computeOutputShape(t){t=Ev(t);for(const e of t.slice(1))if(null==e)throw new Iy(`The shape of the input to "Flatten" is not fully defined (got ${t.slice(1)}). Make sure to pass a complete "input_shape" or "batch_input_shape" argument to the first layer in your model.`);return[t[0],Tb(t,1)]}call(t,e){return uo((()=>{this.invokeCallHook(t,e);let n=Nv(t);if("channelsFirst"===this.dataFormat&&n.rank>1){const t=[0];for(let e=2;e<n.rank;++e)t.push(e);t.push(1),n=n.transpose(t)}return Db(n)}))}getConfig(){const t={};null!=this.dataFormat&&(t["dataFormat"]=this.dataFormat);const e=super.getConfig();return Object.assign(t,e),t}}uk.className="Flatten",io(uk);class ck extends Vv{constructor(t){super(t),this.supportsMasking=!0,this.activation=c_(t.activation)}call(t,e){return uo((()=>{this.invokeCallHook(t,e);const n=Nv(t);return this.activation.apply(n)}))}getConfig(){const t={activation:a_(this.activation)},e=super.getConfig();return Object.assign(t,e),t}}ck.className="Activation",io(ck);class lk extends Vv{constructor(t){super(t),this.n=t.n,this.inputSpec=[{ndim:2}]}computeOutputShape(t){return[t[0],this.n,t[1]]}call(t,e){return uo((()=>(t=Nv(t),$b(t,this.n))))}getConfig(){const t={n:this.n},e=super.getConfig();return Object.assign(t,e),t}}lk.className="RepeatVector",io(lk);class hk extends Vv{constructor(t){super(t),this.targetShape=t.targetShape;for(let e=0;e<this.targetShape.length;++e)this.isUnknown(this.targetShape[e])&&(this.targetShape[e]=null)}isUnknown(t){return t<0||null==t}fixUnknownDimension(t,e){const n="Total size of new array must be unchanged.",s=e.slice();let i=1,r=null;for(let a=0;a<s.length;++a){const t=s[a];if(this.isUnknown(t)){if(null!==r)throw new Iy("Can only specifiy one unknown dimension.");r=a}else i*=t}const o=Tb(t);if(null!==r){if(0===i||o%i!==0)throw new Iy(n);s[r]=o/i}else if(o!==i)throw new Iy(n);return s}computeOutputShape(t){let e=!1;for(let n=0;n<t.length;++n)if(this.isUnknown(t[n])){e=!0;break}return e?t.slice(0,1).concat(this.targetShape):t.slice(0,1).concat(this.fixUnknownDimension(t.slice(1),this.targetShape))}call(t,e){return uo((()=>{this.invokeCallHook(t,e);const n=Nv(t),s=n.shape,i=s.slice(0,1).concat(this.fixUnknownDimension(s.slice(1),this.targetShape));return n.reshape(i)}))}getConfig(){const t={targetShape:this.targetShape},e=super.getConfig();return Object.assign(t,e),t}}hk.className="Reshape",io(hk);class pk extends Vv{constructor(t){if(super(t),null==t.dims)throw new Error("Required configuration field `dims` is missing during Permute constructor call.");if(!Array.isArray(t.dims))throw new Error(`Permute constructor requires \`dims\` to be an Array, but received ${t.dims} instead.`);const e=Nb(1,t.dims.length+1);if(!S(t.dims.slice().sort(),e))throw new Error("Invalid permutation `dims`: "+JSON.stringify(t.dims)+" `dims` must contain consecutive integers starting from 1.");this.dims=t.dims,this.dimsIncludingBatch=[0].concat(this.dims),this.inputSpec=[new Fv({ndim:this.dims.length+1})]}computeOutputShape(t){t=Ev(t);const e=t.slice();return this.dims.forEach(((n,s)=>{e[s+1]=t[n]})),e}call(t,e){return rl(Nv(t),this.dimsIncludingBatch)}getConfig(){const t={dims:this.dims},e=super.getConfig();return Object.assign(t,e),t}}pk.className="Permute",io(pk);class dk extends Vv{constructor(t){super(null==t?{}:t),this.supportsMasking=!0,this.maskValue=null!=t?null==t.maskValue?0:t.maskValue:0}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={maskValue:this.maskValue};return Object.assign(e,t),e}computeMask(t,e){const n=Nv(t),s=-1;return To(Hu(n,this.maskValue),s)}call(t,e){return uo((()=>{this.invokeCallHook(t,e);const n=Nv(t),s=-1,i=!0,r=To(Hu(n,this.maskValue),s,i),o=n.mul(r.asType(n.dtype));return o}))}}dk.className="Masking",io(dk);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class fk extends Vv{constructor(t){if(super(t),this.embeddings=null,this.DEFAULT_EMBEDDINGS_INITIALIZER="randomUniform",null==t.batchInputShape&&null==t.inputShape){let e=null;null!=t.batchSize&&(e=t.batchSize),null==t.inputLength?this.batchInputShape=[e,null]:this.batchInputShape=[e].concat(Ry(t.inputLength))}this.inputDim=t.inputDim,Gy(this.inputDim,"inputDim"),this.outputDim=t.outputDim,Gy(this.outputDim,"outputDim"),this.embeddingsInitializer=_v(t.embeddingsInitializer||this.DEFAULT_EMBEDDINGS_INITIALIZER),this.embeddingsRegularizer=g_(t.embeddingsRegularizer),this.activityRegularizer=g_(t.activityRegularizer),this.embeddingsConstraint=rb(t.embeddingsConstraint),this.maskZero=t.maskZero,this.supportsMasking=t.maskZero,this.inputLength=t.inputLength}build(t){this.embeddings=this.addWeight("embeddings",[this.inputDim,this.outputDim],this.dtype,this.embeddingsInitializer,this.embeddingsRegularizer,!0,this.embeddingsConstraint),this.built=!0}warnOnIncompatibleInputShape(t){}computeMask(t,e){return uo((()=>this.maskZero?(t=Nv(t),Hu(t,sl(t))):null))}computeOutputShape(t){if(t=Ev(t),null==this.inputLength)return[...t,this.outputDim];const e=Ry(this.inputLength);if(e.length!==t.length-1)throw new Iy(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);{let n=0;for(let s=0;s<e.length;++s){const i=e[s],r=t[s+1];if(null!=i&&null!=r&&i!==r)throw new Iy(`"inputLength" is ${this.inputLength}, but received input shape has shape ${t}`);null==i&&(e[n]=r),n++}}return[t[0],...e,this.outputDim]}call(t,e){return uo((()=>{this.invokeCallHook(t,e);let n=Nv(t);"int32"!==n.dtype&&(n=Eb(n,"int32"));const s=Wb(this.embeddings.read(),n.as1D());return s.reshape(Ev(this.computeOutputShape(n.shape)))}))}getConfig(){const t={inputDim:this.inputDim,outputDim:this.outputDim,embeddingsInitializer:xv(this.embeddingsInitializer),embeddingsRegularizer:f_(this.embeddingsRegularizer),activityRegularizer:f_(this.activityRegularizer),embeddingsConstraint:sb(this.embeddingsConstraint),maskZero:this.maskZero,inputLength:this.inputLength},e=super.getConfig();return Object.assign(t,e),t}}fk.className="Embedding",io(fk);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class mk extends Vv{constructor(t){super(t||{}),this.supportsMasking=!0}mergeFunction(t){throw new Cy}computeElementwiseOpOutputShape(t,e){if(null==t||null==e)return null;if(t.length<e.length)return this.computeElementwiseOpOutputShape(e,t);if(0===e.length)return t;const n=t.slice(0,t.length-e.length);for(let s=0;s<e.length;++s){const i=t[t.length-e.length+s],r=e[s];if(null==i||null==r||i<0||r<0)n.push(null);else if(1===i)n.push(r);else if(1===r)n.push(i);else{if(i!==r)throw new Iy("Operands could not be broadcast together with shapes "+JSON.stringify(t)+" "+JSON.stringify(e));n.push(i)}}return n}build(t){if(Array.isArray(t)&&!Array.isArray(t[0])&&(t=[Ev(t)]),t.length<2)throw new Iy(`A merge layer should be called on an Array of at least 2 inputs. Got ${t.length} input(s).`);let e=[];for(const i of t)null!=i&&null!==i[0]&&e.push(i[0]);if(e=Vy(e),e.length>1)throw new Iy(`Can not merge tensors with different batch sizes. Got tensors with shapes: ${JSON.stringify(t)}.`);let n=null==t[0]?null:t[0].slice(1);for(let i=1;i<t.length;++i){const e=null==t[i]?null:t[i].slice(1);n=this.computeElementwiseOpOutputShape(n,e)}const s=t.map((t=>t.length));-1===t.indexOf(null)&&1===Vy(s).length?this.reshapeRequired=!1:this.reshapeRequired=!0}call(t,e){return uo((()=>{if(this.reshapeRequired){const e=[],n=t.map((t=>t.rank));if(-1===n.indexOf(null)){const s=Ab(n);for(let n of t){const t=n.rank;for(let e=0;e<s-t;++e)n=Ob(n,1);e.push(n)}return this.mergeFunction(e)}{let n=!1;for(const r of t){const t=r.rank;if(null==t){const t=r.shape,s=t[0],i=t.slice(1).concat([s]);let o=r.reshape([s].concat(Tb(t.slice(1))));o=rl(o,[1,0]),o=o.reshape(i),e.push(o),n=!0}else if(t>1){const s=Nb(1,t).concat([0]);e.push(rl(r,s)),n=!0}else e.push(r)}let s=this.mergeFunction(e);const i=s.rank;if(n)if(null==i){const t=s.shape,e=t.length,n=t[e-1],i=[n].concat(t.slice(0,t.length-1));s=rl(s.reshape([-1,n]),[1,0]).reshape(i)}else if(i>1){const t=[i-1].concat(Nb(0,i-1));s=rl(s,t)}return s}}return this.mergeFunction(t)}))}computeOutputShape(t){let e;e=null==t[0]?null:t[0].slice(1);for(let s=1;s<t.length;++s){const n=null==t[s]?null:t[s].slice(1);e=this.computeElementwiseOpOutputShape(e,n)}let n=[];for(const s of t)null!=s&&null!==s[0]&&n.push(s[0]);return n=Vy(n),e=1===n.length?n.concat(e):[null].concat(e),e}computeMask(t,e){return uo((()=>{if(null==e)return null;if(!Array.isArray(e))throw new Iy("`mask` should be an Array");if(!Array.isArray(t))throw new Iy("`inputs` should be an Array");if(e.length!==t.length)throw new Iy(`The Array 'inputs' and 'mask' are expected to have the same length, but have different lengths (${t.length} vs ${e.length})`);if(e.every((t=>null==t)))return null;e=e.map((t=>null==t?t:Va(t,0)));let n=e[0];for(let t=1;t<e.length-1;++t)n=vu(n,e[t]);return n}))}}class gk extends mk{constructor(t){super(t)}mergeFunction(t){return uo((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=xo(e,t[n]);return e}))}}gk.className="Add",io(gk);class yk extends mk{constructor(t){super(t)}mergeFunction(t){return uo((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=hu(e,t[n]);return e}))}}yk.className="Multiply",io(yk);class bk extends mk{constructor(t){super(t)}mergeFunction(t){return uo((()=>{let e=t[0].clone();for(let n=1;n<t.length;++n)e=xo(e,t[n]);return hu(1/t.length,e)}))}}bk.className="Average",io(bk);class vk extends mk{constructor(t){super(t)}mergeFunction(t){return uo((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=Tu(e,t[n]);return e}))}}vk.className="Maximum",io(vk);class wk extends mk{constructor(t){super(t)}mergeFunction(t){return uo((()=>{let e=t[0];for(let n=1;n<t.length;++n)e=Ou(e,t[n]);return e}))}}wk.className="Minimum",io(wk);class xk extends mk{constructor(t){super(t),this.DEFAULT_AXIS=-1,null==t&&(t={}),this.axis=null==t.axis?this.DEFAULT_AXIS:t.axis,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){if(!Array.isArray(t)||!Array.isArray(t[0])||1===t.length)throw new Iy("A `Concatenate` layer should be called on a list of at least 2 inputs");let e=!0;for(const s of t)if(null!=s){e=!1;break}if(e)return;const n=[];for(let s=0;s<t.length;++s){const e=t[s].slice();e.splice(this.axis,1);let i=!1;for(const t of n)if(S(t,e)){i=!0;break}i||n.push(e)}if(n.length>1)throw new Iy("A `Concatenate` layer requires inputs with matching shapes except for the concat axis. Got input shapes: "+JSON.stringify(t))}mergeFunction(t){return uo((()=>Lb(t,this.axis)))}computeOutputShape(t){if(!Array.isArray(t)||!Array.isArray(t[0]))throw new Iy("A `Concatenate` layer should be called on a list of inputs.");const e=t,n=e[0].slice(),s=this.axis<0?n.length+this.axis:this.axis;for(const i of e.slice(1)){if(null==n[s]||null==i[s]){n[s]=null;break}n[s]+=i[s]}return n}computeMask(t,e){if(null==e)return null;if(!Array.isArray(e))throw new Iy("`mask` should be an array for Concatenate");if(!Array.isArray(t))throw new Iy("`inputs` should be an array for Concatenate");if(e.length!==t.length)throw new Iy(`Mismatch in the length of mask (${e.length}) and the legnth of inputs (${t.length})`);return uo((()=>{let n=!0;if(e.forEach((t=>{null==t||(n=!1)})),n)return null;const s=[];for(let r=0;r<t.length;++r)null==e[r]?s.push(Ju(t[r]).asType("bool")):e[r].rank<t[r].rank?s.push(Va(e[r],-1)):s.push(e[r]);const i=ca(s,this.axis);return ko(i,-1,!1)}))}getConfig(){const t={axis:this.axis},e=super.getConfig();return Object.assign(t,e),t}}function _k(t,e){while(t<0)t+=e;return t}function kk(t,e,n){if(t.shape.length>3||e.shape.length>3)throw new Cy("batchDot is not implemented for tensors of 4D or higher rank yet");if(v(t.shape.length>=2,(()=>`batchDot requires the rank of x to be >= 2, but got ${t.shape.length}`)),v(t.shape.length>=2,(()=>`batchDot requires the rank of y to be >= 2, but got ${e.shape.length}`)),"number"===typeof n&&(n=[n,n]),"complex64"===t.dtype||"complex64"===e.dtype)throw new Cy("batchDot is not implemented for complex64-type Tensors yet.");const s=t.shape.length,i=e.shape.length;null==n&&(n=[s-1,i-2]);const r=n;return uo((()=>{let n,o;if(s>i){n=s-i;const t=[];for(let e=0;e<n;++e)t.push(1);e=e.reshape(e.shape.concat(t))}else if(i>s){n=i-s;const e=[];for(let t=0;t<n;++t)e.push(1);t=t.reshape(t.shape.concat(e))}else n=0;if(2===t.shape.length&&2===e.shape.length)o=r[0]===r[1]?t.mul(e).sum(r[0]):t.transpose([1,0]).mul(e).sum(r[1]);else{const n=r[0]!==t.shape.length-1,s=r[1]===e.shape.length-1;o=t.matMul(e,n,s)}if(n>0){let t;t=s>i?s+i-3:s-1;const e=[];for(let s=t;s<t+n;++s)e.push(s);o=o.squeeze(e)}return 1===o.shape.length&&(o=o.expandDims(1)),o}))}xk.className="Concatenate",io(xk);class Sk extends mk{constructor(t){super(t),this.axes=t.axes,this.normalize=null!=t.normalize&&t.normalize,this.supportsMasking=!0,this.reshapeRequired=!1}build(t){v(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0],n=t[1];if(e.length>3||n.length>3)throw new Cy("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(e,n);if(e[s[0]]!==n[s[1]])throw new Iy(`Dimension incompatibility: ${e[s[0]]} !== ${n[s[1]]}`)}mergeFunction(t){if(2!==t.length)throw new Iy(`A \`Dot\` layer must be called on exactly 2 inputs, but received ${t.length} input(s).`);let e,n=t[0],s=t[1];return e=Array.isArray(this.axes)?this.axes.map(((e,n)=>_k(e,t[n].shape.length))):[_k(this.axes,n.shape.length),_k(this.axes,s.shape.length)],this.normalize&&(n=aw(n,e[0]),s=aw(s,e[1])),kk(n,s,e)}interpretAxes(t,e){let n;return n=Array.isArray(this.axes)?this.axes:[_k(this.axes,t.length),_k(this.axes,e.length)],n}computeOutputShape(t){v(Array.isArray(t)&&2===t.length&&Array.isArray(t[0])&&Array.isArray(t[1]),(()=>"A `Dot` layer should be called on a list of exactly 2 inputs."));const e=t[0].slice(),n=t[1].slice();if(e.length>3||n.length>3)throw new Cy("Dot layer does not support tensors of 4D or higher rank yet.");const s=this.interpretAxes(e,n);e.splice(s[0],1),n.splice(s[1],1),n.splice(0,1);const i=e.concat(n);return 1===i.length&&i.push(1),i}computeMask(t,e){return null}getConfig(){const t={axes:this.axes,normalize:this.normalize},e=super.getConfig();return Object.assign(t,e),t}}Sk.className="Dot",io(Sk);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Tk extends Vv{constructor(t){super(t),this.supportsMasking=!0,this.stddev=t.stddev}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={stddev:this.stddev};return Object.assign(e,t),e}call(t,e){return uo((()=>{this.invokeCallHook(t,e);const n=Nv(t),s=()=>qb(n.shape,0,this.stddev).add(n),i=Yb(s,(()=>n),e["training"]||!1);return i}))}}Tk.className="GaussianNoise",io(Tk);class Ik extends Vv{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return uo((()=>{this.invokeCallHook(t,e);const n=Nv(t);if(this.rate>0&&this.rate<1){const t=()=>{const t=Math.sqrt(this.rate/(1-this.rate));return n.mul(qb(n.shape,1,t))};return Yb(t,(()=>n),e["training"]||!1)}return n}))}}Ik.className="GaussianDropout",io(Ik);class Ck extends Vv{constructor(t){super(t),this.supportsMasking=!0,this.rate=t.rate,this.noiseShape=t.noiseShape}_getNoiseShape(t){return this.noiseShape||Nv(t).shape}computeOutputShape(t){return t}getConfig(){const t=super.getConfig(),e={rate:this.rate};return Object.assign(e,t),e}call(t,e){return uo((()=>{if(this.rate<1&&this.rate>0){const n=this._getNoiseShape(t),s=()=>{const e=Nv(t),s=1.6732632423543772,i=1.0507009873554805,r=-s*i;let o=eu(lc(n),this.rate);o=Eb(o,"float32");const a=((1-this.rate)*(1+this.rate*r**2))**-.5,u=-a*r*this.rate,c=e.mul(o).add(o.add(-1).mul(r));return c.mul(a).add(u)};return Yb(s,(()=>Nv(t)),e["training"]||!1)}return t}))}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Ak(t,e,n,s,i,r=.001){let o;if(2===t.rank)o=ea(t,e,n,s,i,r);else if(3===t.rank)o=sa(t,e,n,s,i,r);else{if(4!==t.rank)throw new Cy(`batchNormalization is not implemented for array of rank ${t.rank} yet`);o=ra(t,e,n,s,i,r)}return o}function Nk(t,e,n,s,i=.001){return uo((()=>{const r=Wu(t,s),o=r.mean,a=r.variance,u=Ak(t,o,a,n,e,i);return[u,o,a]}))}function Ek(t,e,n,s,i=.001){return uo((()=>{const r=Wu(t,s),o=r.mean,a=r.variance,u=[];for(const e of Nb(0,t.rank))-1!==s.indexOf(e)?u.push(1):u.push(t.shape[e]);const c=o.reshape(u),l=a.reshape(u),h=null==e?null:e.reshape(u),p=null==n?null:n.reshape(u),d=Ak(t,c,l,p,h,i);return[d,o,a]}))}function Ok(t,e,n,s,i=.001){return S(s.slice().sort(),Nb(0,t.rank-1))?Nk(t,e,n,s,i):Ek(t,e,n,s,i)}Ck.className="AlphaDropout",io(Ck);class $k extends Vv{constructor(t){null==t&&(t={}),super(t),this.supportsMasking=!0,this.axis=null==t.axis?-1:t.axis,this.momentum=null==t.momentum?.99:t.momentum,this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=_v(t.betaInitializer||"zeros"),this.gammaInitializer=_v(t.gammaInitializer||"ones"),this.movingMeanInitializer=_v(t.movingMeanInitializer||"zeros"),this.movingVarianceInitializer=_v(t.movingVarianceInitializer||"ones"),this.betaConstraint=rb(t.betaConstraint),this.gammaConstraint=rb(t.gammaConstraint),this.betaRegularizer=g_(t.betaRegularizer),this.gammaRegularizer=g_(t.gammaRegularizer)}build(t){t=Ev(t);const e=this.axis>=0?this.axis:this.axis+t.length,n=t[e];if(null==n)throw new Iy(`Axis ${e} of input tensor should have a defined dimension but the layer received an input with shape ${JSON.stringify(t)}.`);this.inputSpec=[new Fv({ndim:t.length,axes:{[e]:n}})];const s=[n];this.scale&&(this.gamma=this.addWeight("gamma",s,null,this.gammaInitializer,this.gammaRegularizer,!0,this.gammaConstraint)),this.center&&(this.beta=this.addWeight("beta",s,null,this.betaInitializer,this.betaRegularizer,!0,this.betaConstraint)),this.movingMean=this.addWeight("moving_mean",s,null,this.movingMeanInitializer,null,!1),this.movingVariance=this.addWeight("moving_variance",s,null,this.movingVarianceInitializer,null,!1),this.built=!0}call(t,e){return uo((()=>{const n=null!=e["training"]&&e["training"],s=Nv(t),i=s.shape,r=i.length,o=Nb(0,r),a=this.axis>=0?this.axis:this.axis+r;o.splice(a,1);const u=Ny(1,r);u[a]=i[a];const c=o.slice();c.sort();const l=!S(c,Nb(0,r).slice(0,r-1)),h=()=>{if(l){const t=this.movingMean.read().reshape(u),e=this.movingVariance.read().reshape(u),n=this.center?this.beta.read().reshape(u):null,i=this.scale?this.gamma.read().reshape(u):null;return Ak(s,t,e,n,i,this.epsilon)}return Ak(s,this.movingMean.read(),this.movingVariance.read(),null==this.beta?null:this.beta.read(),null==this.gamma?null:this.gamma.read(),this.epsilon)};if(!n)return h();const[p,d,f]=Ok(s,this.gamma.read(),this.beta.read(),o,this.epsilon),m=(t,e,n)=>{uo((()=>{const s=1-n,i=t.read(),r=i.sub(e).mul(s);t.write(i.sub(r))}))},g=()=>{m(this.movingMean,d,this.momentum),m(this.movingVariance,f,this.momentum)};return g(),p}))}getConfig(){const t={axis:this.axis,momentum:this.momentum,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:xv(this.betaInitializer),gammaInitializer:xv(this.gammaInitializer),movingMeanInitializer:xv(this.movingMeanInitializer),movingVarianceInitializer:xv(this.movingVarianceInitializer),betaRegularizer:f_(this.betaRegularizer),gammaRegularizer:f_(this.gammaRegularizer),betaConstraint:sb(this.betaConstraint),gammaConstraint:sb(this.gammaConstraint)},e=super.getConfig();return Object.assign(t,e),t}}$k.className="BatchNormalization",io($k);class Rk extends Vv{constructor(t){if(null==t&&(t={}),super(t),this.axis=null==t.axis?-1:t.axis,"number"===typeof this.axis){if(!Number.isInteger(this.axis))throw new Error(`Expected axis to be an integer, but received ${this.axis}`)}else{if(!Array.isArray(this.axis))throw new Error(`Expected axis to be an integer or an array of integers, but received ${JSON.stringify(this.axis)}`);for(const t of this.axis)if(!Number.isInteger(t))throw new Error(`Expected axis to be an array of integers, but received ${JSON.stringify(this.axis)}`)}this.epsilon=null==t.epsilon?.001:t.epsilon,this.center=null==t.center||t.center,this.scale=null==t.scale||t.scale,this.betaInitializer=_v(t.betaInitializer||"zeros"),this.gammaInitializer=_v(t.gammaInitializer||"ones"),this.betaRegularizer=g_(t.betaRegularizer),this.gammaRegularizer=g_(t.gammaRegularizer),this.supportsMasking=!0}build(t){t=Ev(t);const e=t.length;"number"===typeof this.axis&&(this.axis=[this.axis]);for(let i=0;i<this.axis.length;++i)this.axis[i]<0&&(this.axis[i]+=e);for(const i of this.axis)if(i<0||i>=e)throw new Error(`Invalid axis: ${i}`);if(this.axis.length!==Vy(this.axis).length)throw new Error(`Found duplicate axes in: ${this.axis}`);const n=this.axis.map((e=>t[e])),s=!0;this.scale?this.gamma=this.addWeight("gamma",n,"float32",this.gammaInitializer,this.gammaRegularizer,s):this.gamma=null,this.center?this.beta=this.addWeight("beta",n,"float32",this.betaInitializer,this.betaRegularizer,s):this.beta=null,this.built=!0}call(t,e){const n=Nv(t),s=n.shape,i=s.length;return uo((()=>{const t=!0;let{mean:e,variance:r}=Wu(n,this.axis,t);const o=Ny(1,i);for(const n of this.axis)o[n]=s[n];const a=t=>null!=t&&t.shape.length!==i&&this.axis!==[i-1]?t.reshape(o):t;let u=a(this.gamma.read()),c=a(this.beta.read());const l=[],h=[];for(let n=0;n<i;++n)-1!==this.axis.indexOf(n)?(l.push(s[n]),h.push(1)):(l.push(1),h.push(s[n]));return e=e.tile(l),r=r.tile(l),u=u.tile(h),c=c.tile(h),Ak(n,e,r,c,u,this.epsilon)}))}getConfig(){const t={axis:this.axis,epsilon:this.epsilon,center:this.center,scale:this.scale,betaInitializer:xv(this.betaInitializer),gammaInitializer:xv(this.gammaInitializer),betaRegularizer:f_(this.betaRegularizer),gammaRegularizer:f_(this.gammaRegularizer)},e=super.getConfig();return Object.assign(t,e),t}}function Dk(t,e,n){return uo((()=>{if(4!==t.rank)throw new Iy(`temporalPadding expects input tensor to be 4-D, but received a ${t.rank}-D tensor.`);if(null==e&&(e=[[1,1],[1,1]]),2!==e.length||2!==e[0].length||2!==e[1].length)throw new Iy("spatial2dPadding expects `padding` to be an Array of two Arrays, each of which is an Array of two integers.");if(null==n&&(n=ky()),"channelsLast"!==n&&"channelsFirst"!==n)throw new Iy(`Unknown data format: ${n}. Supported data formats are 'channelsLast' and 'channelsFirst.`);let s;return s="channelsFirst"===n?[[0,0],[0,0],e[0],e[1]]:[[0,0],e[0],e[1],[0,0]],ec(t,s)}))}Rk.className="LayerNormalization",io(Rk);class Mk extends Vv{constructor(t){if(null==t&&(t={}),super(t),this.dataFormat=null==t.dataFormat?ky():t.dataFormat,null==t.padding)this.padding=[[1,1],[1,1]];else if("number"===typeof t.padding)this.padding=[[t.padding,t.padding],[t.padding,t.padding]];else{if(t.padding=t.padding,2!==t.padding.length)throw new Iy(`ZeroPadding2D expects padding to be a length-2 array, but received a length-${t.padding.length} array.`);let e,n;if("number"===typeof t.padding[0])e=[t.padding[0],t.padding[0]],n=[t.padding[1],t.padding[1]];else{if(t.padding=t.padding,2!==t.padding[0].length)throw new Iy(`ZeroPadding2D expects height padding to be a length-2 array, but received a length-${t.padding[0].length} array.`);if(e=t.padding[0],2!==t.padding[1].length)throw new Iy(`ZeroPadding2D expects width padding to be a length-2 array, but received a length-${t.padding[1].length} array.`);n=t.padding[1]}this.padding=[e,n]}this.inputSpec=[new Fv({ndim:4})]}computeOutputShape(t){let e,n;return t=Ev(t),"channelsFirst"===this.dataFormat?(e=null!=t[2]&&t[2]>=0?t[2]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[3]&&t[3]>=0?t[3]+this.padding[1][0]+this.padding[1][1]:null,[t[0],t[1],e,n]):(e=null!=t[1]&&t[1]>=0?t[1]+this.padding[0][0]+this.padding[0][1]:null,n=null!=t[2]&&t[2]>=0?t[2]+this.padding[1][0]+this.padding[1][1]:null,[t[0],e,n,t[3]])}call(t,e){return uo((()=>Dk(Nv(t),this.padding,this.dataFormat)))}getConfig(){const t={padding:this.padding,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
function Pk(t,e,n,s,i,r){return uo((()=>{let o;pb(i),mb(r),fb(s),null==n&&(n=[1,1]),null==s&&(s="valid"),null==i&&(i=ky()),null==r&&(r="max"),t=I_(t,i);const a="same"===s?"same":"valid";return o="max"===r?xu(t,e,n,a):Ko(t,e,n,a),"channelsFirst"===i&&(o=rl(o,[0,3,1,2])),o}))}function Fk(t,e,n,s,i,r){return uo((()=>{let o;pb(i),mb(r),fb(s),null==n&&(n=[1,1,1]),null==s&&(s="valid"),null==i&&(i=ky()),null==r&&(r="max"),t=C_(t,i);const a="same"===s?"same":"valid";return o="max"===r?ku(t,e,n,a):Qo(t,e,n,a),"channelsFirst"===i&&(o=rl(o,[0,4,1,2,3])),o}))}Mk.className="ZeroPadding2D",io(Mk);class Lk extends Vv{constructor(t){if(null==t.poolSize&&(t.poolSize=2),super(t),"number"===typeof t.poolSize)this.poolSize=[t.poolSize];else{if(!Array.isArray(t.poolSize)||1!==t.poolSize.length||"number"!==typeof t.poolSize[0])throw new Iy(`poolSize for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.poolSize)}`);this.poolSize=t.poolSize}if(Gy(this.poolSize,"poolSize"),null==t.strides)this.strides=this.poolSize;else if("number"===typeof t.strides)this.strides=[t.strides];else{if(!Array.isArray(t.strides)||1!==t.strides.length||"number"!==typeof t.strides[0])throw new Iy(`strides for 1D convolutional layer must be a number or an Array of a single number, but received ${JSON.stringify(t.strides)}`);this.strides=t.strides}Gy(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,fb(this.padding),this.inputSpec=[new Fv({ndim:3})]}computeOutputShape(t){t=Ev(t);const e=S_(t[1],this.poolSize[0],this.padding,this.strides[0]);return[t[0],e,t[2]]}call(t,e){return uo((()=>{this.invokeCallHook(t,e),t=Ob(Nv(t),2);const n=this.poolingFunction(Nv(t),[this.poolSize[0],1],[this.strides[0],1],this.padding,"channelsLast");return Bc(n,[2])}))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides},e=super.getConfig();return Object.assign(t,e),t}}class zk extends Lk{constructor(t){super(t)}poolingFunction(t,e,n,s,i){return pb(i),fb(s),Pk(t,e,n,s,i,"max")}}zk.className="MaxPooling1D",io(zk);class Bk extends Lk{constructor(t){super(t)}poolingFunction(t,e,n,s,i){return pb(i),fb(s),Pk(t,e,n,s,i,"avg")}}Bk.className="AveragePooling1D",io(Bk);class qk extends Vv{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(2!==t.strides.length)throw new Iy(`If the strides property of a 2D pooling layer is an Array, it is expected to have a length of 2, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides];Gy(this.poolSize,"poolSize"),Gy(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,pb(this.dataFormat),fb(this.padding),this.inputSpec=[new Fv({ndim:4})]}computeOutputShape(t){t=Ev(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2];return e=S_(e,this.poolSize[0],this.padding,this.strides[0]),n=S_(n,this.poolSize[1],this.padding,this.strides[1]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n]:[t[0],e,n,t[3]]}call(t,e){return uo((()=>(this.invokeCallHook(t,e),this.poolingFunction(Nv(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Vk extends qk{constructor(t){super(t)}poolingFunction(t,e,n,s,i){return pb(i),fb(s),Pk(t,e,n,s,i,"max")}}Vk.className="MaxPooling2D",io(Vk);class Wk extends qk{constructor(t){super(t)}poolingFunction(t,e,n,s,i){return pb(i),fb(s),Pk(t,e,n,s,i,"avg")}}Wk.className="AveragePooling2D",io(Wk);class jk extends Vv{constructor(t){if(null==t.poolSize&&(t.poolSize=[2,2,2]),super(t),this.poolSize=Array.isArray(t.poolSize)?t.poolSize:[t.poolSize,t.poolSize,t.poolSize],null==t.strides)this.strides=this.poolSize;else if(Array.isArray(t.strides)){if(3!==t.strides.length)throw new Iy(`If the strides property of a 3D pooling layer is an Array, it is expected to have a length of 3, but received length ${t.strides.length}.`);this.strides=t.strides}else this.strides=[t.strides,t.strides,t.strides];Gy(this.poolSize,"poolSize"),Gy(this.strides,"strides"),this.padding=null==t.padding?"valid":t.padding,this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,pb(this.dataFormat),fb(this.padding),this.inputSpec=[new Fv({ndim:5})]}computeOutputShape(t){t=Ev(t);let e="channelsFirst"===this.dataFormat?t[2]:t[1],n="channelsFirst"===this.dataFormat?t[3]:t[2],s="channelsFirst"===this.dataFormat?t[4]:t[3];return e=S_(e,this.poolSize[0],this.padding,this.strides[0]),n=S_(n,this.poolSize[1],this.padding,this.strides[1]),s=S_(s,this.poolSize[2],this.padding,this.strides[2]),"channelsFirst"===this.dataFormat?[t[0],t[1],e,n,s]:[t[0],e,n,s,t[4]]}call(t,e){return uo((()=>(this.invokeCallHook(t,e),this.poolingFunction(Nv(t),this.poolSize,this.strides,this.padding,this.dataFormat))))}getConfig(){const t={poolSize:this.poolSize,padding:this.padding,strides:this.strides,dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Uk extends jk{constructor(t){super(t)}poolingFunction(t,e,n,s,i){return pb(i),fb(s),Fk(t,e,n,s,i,"max")}}Uk.className="MaxPooling3D",io(Uk);class Gk extends jk{constructor(t){super(t)}poolingFunction(t,e,n,s,i){return pb(i),fb(s),Fk(t,e,n,s,i,"avg")}}Gk.className="AveragePooling3D",io(Gk);class Hk extends Vv{constructor(t){super(t),this.inputSpec=[new Fv({ndim:3})]}computeOutputShape(t){return[t[0],t[2]]}call(t,e){throw new Cy}}class Kk extends Hk{constructor(t){super(t||{})}call(t,e){return uo((()=>{const e=Nv(t);return Cu(e,1)}))}}Kk.className="GlobalAveragePooling1D",io(Kk);class Xk extends Hk{constructor(t){super(t||{})}call(t,e){return uo((()=>{const e=Nv(t);return cu(e,1)}))}}Xk.className="GlobalMaxPooling1D",io(Xk);class Qk extends Vv{constructor(t){super(t),this.dataFormat=null==t.dataFormat?"channelsLast":t.dataFormat,pb(this.dataFormat),this.inputSpec=[new Fv({ndim:4})]}computeOutputShape(t){return"channelsLast"===this.dataFormat?[t[0],t[3]]:[t[0],t[1]]}call(t,e){throw new Cy}getConfig(){const t={dataFormat:this.dataFormat},e=super.getConfig();return Object.assign(t,e),t}}class Yk extends Qk{call(t,e){return uo((()=>{const e=Nv(t);return"channelsLast"===this.dataFormat?Cu(e,[1,2]):Cu(e,[2,3])}))}}Yk.className="GlobalAveragePooling2D",io(Yk);class Zk extends Qk{call(t,e){return uo((()=>{const e=Nv(t);return"channelsLast"===this.dataFormat?cu(e,[1,2]):cu(e,[2,3])}))}}Zk.className="GlobalMaxPooling2D",io(Zk);
/**
 * @license
 * Copyright 2018 Google LLC
 *
 * Use of this source code is governed by an MIT-style
 * license that can be found in the LICENSE file or at
 * https://opensource.org/licenses/MIT.
 * =============================================================================
 */
class Jk extends Vv{constructor(t){super(t),this.layer=t.layer}build(t){this.built=!0}get trainable(){return null!=this.layer&&this.layer.trainable}set trainable(t){null!=this.layer&&(this.layer.trainable=t)}get trainableWeights(){return this.layer.trainableWeights}get nonTrainableWeights(){return this.layer.nonTrainableWeights}get updates(){return this.layer._updates}get losses(){return this.layer.losses}getWeights(){return this.layer.getWeights()}setWeights(t){this.layer.setWeights(t)}getConfig(){const t={layer:{className:this.layer.getClassName(),config:this.layer.getConfig()}},e=super.getConfig();return Object.assign(t,e),t}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.layer&&this.layer.setFastWeightInitDuringBuild(t)}static fromConfig(t,e,n={}){const s=e["layer"],i=ow(s,n);delete e["layer"];const r={layer:i};return Object.assign(r,e),new t(r)}}class tS extends Jk{constructor(t){super(t),this.supportsMasking=!0}build(t){if(t=Ev(t),t.length<3)throw new Iy(`TimeDistributed layer expects an input shape >= 3D, but received input shape ${JSON.stringify(t)}`);this.inputSpec=[{shape:t}];const e=[t[0]].concat(t.slice(2));this.layer.built||(this.layer.build(e),this.layer.built=!0),super.build(t)}computeOutputShape(t){t=Ev(t);const e=[t[0]].concat(t.slice(2)),n=this.layer.computeOutputShape(e),s=t[1];return[n[0],s].concat(n.slice(1))}call(t,e){return uo((()=>{t=Nv(t);const n=(t,n)=>{const s=Nv(this.layer.call(t,e));return[s,[]]},s=j_(n,t,[],!1,null,null,!1,!0),i=s[1];return i}))}}function eS(t){jy(lb,"BidirectionalMergeMode",t)}tS.className="TimeDistributed",io(tS);const nS="concat";class sS extends Jk{constructor(t){super(t);const e=t.layer.getConfig(),n={};n["className"]=t.layer.getClassName(),n["config"]=e,this.forwardLayer=ow(n),e["goBackwards"]=!0!==e["goBackwards"];const s={};if(s["className"]=t.layer.getClassName(),s["config"]=e,this.backwardLayer=ow(s),this.forwardLayer.name="forward_"+this.forwardLayer.name,this.backwardLayer.name="backward_"+this.backwardLayer.name,this.mergeMode=void 0===t.mergeMode?nS:t.mergeMode,eS(this.mergeMode),t.weights)throw new Cy("weights support is not implemented for Bidirectional layer yet.");this._stateful=t.layer.stateful,this.returnSequences=t.layer.returnSequences,this.returnState=t.layer.returnState,this.supportsMasking=!0,this._trainable=!0,this.inputSpec=t.layer.inputSpec,this.numConstants=null}get trainable(){return this._trainable}set trainable(t){this._trainable=t,null!=this.forwardLayer&&(this.forwardLayer.trainable=t),null!=this.backwardLayer&&(this.backwardLayer.trainable=t)}getWeights(){return this.forwardLayer.getWeights().concat(this.backwardLayer.getWeights())}setWeights(t){const e=t.length,n=Math.floor(e/2);this.forwardLayer.setWeights(t.slice(0,n)),this.backwardLayer.setWeights(t.slice(n))}computeOutputShape(t){let e,n,s,i=this.forwardLayer.computeOutputShape(t);return Array.isArray(i)&&Array.isArray(i[0])||(i=[i]),this.returnState?(s=i.slice(1),e=i[0]):e=i[0],"concat"===this.mergeMode?(e[e.length-1]*=2,n=[e]):n=null==this.mergeMode?[e,e.slice()]:[e],this.returnState?null==this.mergeMode?n.concat(s).concat(s.slice()):[e].concat(s).concat(s.slice()):$y(n)}apply(t,e){let n=null==e?null:e["initialState"],s=null==e?null:e["constants"];null==e&&(e={});const i=W_(t,n,s,this.numConstants);if(t=i.inputs,n=i.initialState,s=i.constants,Array.isArray(t)&&(n=t.slice(1),t=t[0]),(null==n||0===n.length)&&null==s)return super.apply(t,e);const r=[],o=[];if(null!=n){const t=n.length;if(t%2>0)throw new Iy("When passing `initialState` to a Bidrectional RNN, the state should be an Array containing the states of the underlying RNNs.");e["initialState"]=n,r.push(...n);const s=n.map((t=>new Fv({shape:t.shape})));this.forwardLayer.stateSpec=s.slice(0,t/2),this.backwardLayer.stateSpec=s.slice(t/2),o.push(...s)}if(null!=s)throw new Cy("Support for constants in Bidirectional layers is not implemented yet.");const a=r[0]instanceof Lv;for(const u of r)if(u instanceof Lv!==a)throw new Iy("The initial state of a Bidirectional layer cannot be specified as a mix of symbolic and non-symbolic tensors");if(a){const n=[t].concat(r),s=this.inputSpec.concat(o),i=this.inputSpec;this.inputSpec=s;const a=super.apply(n,e);return this.inputSpec=i,a}return super.apply(t,e)}call(t,e){return uo((()=>{const n=e["initialState"];let s,i,r,o;if(null==n)s=this.forwardLayer.call(t,e),i=this.backwardLayer.call(t,e);else{const r=n.slice(0,n.length/2),o=n.slice(n.length/2);s=this.forwardLayer.call(t,Object.assign(e,{initialState:r})),i=this.backwardLayer.call(t,Object.assign(e,{initialState:o}))}return this.returnState&&(Array.isArray(s)&&(r=s.slice(1).concat(i.slice(1))),s=s[0],i=i[0]),this.returnSequences&&(i=fc(i,1)),"concat"===this.mergeMode?o=Lb([s,i]):"sum"===this.mergeMode?o=xo(s,i):"ave"===this.mergeMode?o=hu(.5,xo(s,i)):"mul"===this.mergeMode?o=hu(s,i):null==this.mergeMode&&(o=[s,i]),this.returnState?null==this.mergeMode?o.concat(r):[o].concat(r):o}))}resetStates(t){this.forwardLayer.resetStates(),this.backwardLayer.resetStates()}build(t){bb(this.forwardLayer.name,(()=>{this.forwardLayer.build(t)})),bb(this.backwardLayer.name,(()=>{this.backwardLayer.build(t)})),this.built=!0}computeMask(t,e){let n;if(Array.isArray(e)&&(e=e[0]),n=this.returnSequences?null==this.mergeMode?[e,e]:e:null==this.mergeMode?[null,null]:null,this.returnState){const t=this.forwardLayer.states,e=t.map((t=>null));return Array.isArray(n)?n.concat(e).concat(e):[n].concat(e).concat(e)}return n}get trainableWeights(){return this.forwardLayer.trainableWeights.concat(this.backwardLayer.trainableWeights)}get nonTrainableWeights(){return this.forwardLayer.nonTrainableWeights.concat(this.backwardLayer.nonTrainableWeights)}setFastWeightInitDuringBuild(t){super.setFastWeightInitDuringBuild(t),null!=this.forwardLayer&&this.forwardLayer.setFastWeightInitDuringBuild(t),null!=this.backwardLayer&&this.backwardLayer.setFastWeightInitDuringBuild(t)}getConfig(){const t={mergeMode:this.mergeMode},e=super.getConfig();return Object.assign(t,e),t}static fromConfig(t,e){const n=ow(e["layer"]);if(delete e["layer"],null!=e["numConstants"])throw new Cy("Deserialization of a Bidirectional layer with numConstants present is not supported yet.");const s=e;return s["layer"]=n,new t(s)}}sS.className="Bidirectional",io(sS);
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
var iS,rS;(function(t){t[t["DT_INVALID"]=0]="DT_INVALID",t[t["DT_FLOAT"]=1]="DT_FLOAT",t[t["DT_DOUBLE"]=2]="DT_DOUBLE",t[t["DT_INT32"]=3]="DT_INT32",t[t["DT_UINT8"]=4]="DT_UINT8",t[t["DT_INT16"]=5]="DT_INT16",t[t["DT_INT8"]=6]="DT_INT8",t[t["DT_STRING"]=7]="DT_STRING",t[t["DT_COMPLEX64"]=8]="DT_COMPLEX64",t[t["DT_INT64"]=9]="DT_INT64",t[t["DT_BOOL"]=10]="DT_BOOL",t[t["DT_QINT8"]=11]="DT_QINT8",t[t["DT_QUINT8"]=12]="DT_QUINT8",t[t["DT_QINT32"]=13]="DT_QINT32",t[t["DT_BFLOAT16"]=14]="DT_BFLOAT16",t[t["DT_FLOAT_REF"]=101]="DT_FLOAT_REF",t[t["DT_DOUBLE_REF"]=102]="DT_DOUBLE_REF",t[t["DT_INT32_REF"]=103]="DT_INT32_REF",t[t["DT_UINT8_REF"]=104]="DT_UINT8_REF",t[t["DT_INT16_REF"]=105]="DT_INT16_REF",t[t["DT_INT8_REF"]=106]="DT_INT8_REF",t[t["DT_STRING_REF"]=107]="DT_STRING_REF",t[t["DT_COMPLEX64_REF"]=108]="DT_COMPLEX64_REF",t[t["DT_INT64_REF"]=109]="DT_INT64_REF",t[t["DT_BOOL_REF"]=110]="DT_BOOL_REF",t[t["DT_QINT8_REF"]=111]="DT_QINT8_REF",t[t["DT_QUINT8_REF"]=112]="DT_QUINT8_REF",t[t["DT_QINT32_REF"]=113]="DT_QINT32_REF",t[t["DT_BFLOAT16_REF"]=114]="DT_BFLOAT16_REF"})(iS||(iS={})),function(t){let e;(function(t){t[t["LEGACY"]=0]="LEGACY",t[t["V1"]=1]="V1",t[t["V2"]=2]="V2"})(e=t.CheckpointFormatVersion||(t.CheckpointFormatVersion={}))}(rS||(rS={}));
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var oS,aS=n(928);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
function uS(t,e){return cS(t,e)}function cS(t,e,n=new Map,s=new Set){if(null==t)return null;if(s.has(t))throw new Error("Circular references are not supported.");if(n.has(t))return n.get(t);const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep map function may not return both a value and recurse=true.");if(i.recurse){if(dS(t)){const i=Array.isArray(t)?[]:{};s.add(t);for(const r in t){const o=t[r],a=cS(o,e,n,s);i[r]=a}return s.delete(t),i}throw new Error(`Can't recurse into non-iterable type: ${t}`)}return n.set(t,i.value),i.value}function lS(t,e=pS){return hS(t,e)}function hS(t,e,n=new Set){const s=t[0];if(n.has(s))throw new Error("Circular references are not supported.");const i=e(t);if(i.recurse&&null!==i.value)throw new Error("A deep zip function may not return both a value and recurse=true.");if(i.recurse){if(dS(s)){const i=Array.isArray(s)?[]:{};n.add(s);for(const r in s){const s=t.map((t=>t[r])),o=hS(s,e,n);i[r]=o}return n.delete(s),i}throw new Error(`Can't recurse into non-iterable type: ${s}`)}return i.value}function pS(t){return null===t?null:dS(t[0])?{value:null,recurse:!0}:{value:t,recurse:!1}}function dS(t){return null!=t&&!ArrayBuffer.isView(t)&&(Array.isArray(t)||"object"===typeof t&&!(t instanceof js))}function fS(t){return null==t||mS(t)||Array.isArray(t)||"object"===typeof t&&t instanceof js||F(t)}function mS(t){return null===t||"object"!==typeof t&&"function"!==typeof t}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
function gS(t){return uS(t,yS)}function yS(t){return t instanceof js?{value:t.clone(),recurse:!1}:dS(t)?{value:null,recurse:!0}:{value:t,recurse:!1}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
class bS{constructor(t){if(this.capacity=t,this.begin=0,this.end=0,null==t)throw new RangeError("Can't create a ring buffer of unknown capacity.");if(t<1)throw new RangeError("Can't create ring buffer of capacity < 1.");this.data=new Array(t),this.doubledCapacity=2*t}wrap(t){while(t<0)t+=this.doubledCapacity;return t%this.doubledCapacity}get(t){if(t<0)throw new RangeError("Can't get item at a negative index.");return this.data[t%this.capacity]}set(t,e){if(t<0)throw new RangeError("Can't set item at a negative index.");this.data[t%this.capacity]=e}length(){let t=this.end-this.begin;return t<0&&(t=this.doubledCapacity+t),t}isFull(){return this.length()===this.capacity}isEmpty(){return 0===this.length()}push(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.set(this.end,t),this.end=this.wrap(this.end+1)}pushAll(t){for(const e of t)this.push(e)}pop(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");this.end=this.wrap(this.end-1);const t=this.get(this.end);return this.set(this.end,void 0),t}unshift(t){if(this.isFull())throw new RangeError("Ring buffer is full.");this.begin=this.wrap(this.begin-1),this.set(this.begin,t)}shift(){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const t=this.get(this.begin);return this.set(this.begin,void 0),this.begin=this.wrap(this.begin+1),t}shuffleExcise(t){if(this.isEmpty())throw new RangeError("Ring buffer is empty.");const e=this.wrap(this.begin+t),n=this.get(e);return this.set(e,this.pop()),n}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
class vS extends bS{constructor(){super(vS.INITIAL_CAPACITY)}isFull(){return!1}push(t){super.isFull()&&this.expand(),super.push(t)}unshift(t){super.isFull()&&this.expand(),super.unshift(t)}expand(){const t=2*this.capacity,e=new Array(t),n=this.length();for(let s=0;s<n;s++)e[s]=this.get(this.wrap(this.begin+s));this.data=e,this.capacity=t,this.doubledCapacity=2*this.capacity,this.begin=0,this.end=n}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
function wS(t){return new SS(t)}function xS(t){return new TS(t)}function _S(t,e){return new PS(t,e)}vS.INITIAL_CAPACITY=32;class kS{async toArray(){const t=[];let e=await this.next();while(!e.done)t.push(e.value),e=await this.next();return t}async toArrayForTest(){const t=this.prefetch(100),e=[];let n=await t.next();while(!n.done)e.push(n.value),n=await t.next();return e}async resolveFully(){let t=await this.next();while(!t.done)t=await this.next()}async resolveWhile(t){let e=await this.next(),n=t(e.value);while(!e.done&&n)e=await this.next(),n=t(e.value)}handleErrors(t){return new $S(this,t)}filter(t){return new ES(this,t)}map(t){return new OS(this,t)}mapAsync(t){return new RS(this,t)}serialMapAsync(t){return new RS(this,t).serial()}flatmap(t){return new MS(this,t)}async forEachAsync(t){return this.map(t).resolveFully()}async serialForEach(t){return this.serialMapAsync(t).resolveWhile((t=>!0===t))}rowMajorBatch(t,e=!0){return new NS(this,t,e)}columnMajorBatch(t,e=!0,n=pS){const s=this.rowMajorBatch(t,e);return s.map((t=>lS(t,n)))}concatenate(t,e){return new PS(wS([this,t]),e)}take(t){return t<0||null==t?this:new AS(this,t)}skip(t){return t<0||null==t?this:new CS(this,t)}prefetch(t){return new FS(this,t)}shuffle(t,e){return new LS(this,t,e)}serial(){return new IS(this)}}class SS extends kS{constructor(t){super(),this.items=t,this.trav=0}summary(){return`Array of ${this.items.length} items`}async next(){if(this.trav>=this.items.length)return{value:null,done:!0};const t=this.items[this.trav];return this.trav++,{value:gS(t),done:!1}}}class TS extends kS{constructor(t){super(),this.nextFn=t}summary(){return"Function call"}async next(){try{return this.nextFn()}catch(t){throw t.message=`Error thrown while iterating through a dataset: ${t.message}`,t}}}class IS extends kS{constructor(t){super(),this.upstream=t,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Serial`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){return this.upstream.next()}}class CS extends kS{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Skip`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){while(this.count++<this.maxCount){const t=await this.upstream.next();if(t.done)return t;co(t.value)}return this.upstream.next()}}class AS extends kS{constructor(t,e){super(),this.upstream=t,this.maxCount=e,this.count=0}summary(){return`${this.upstream.summary()} -> Take`}async next(){return this.count++>=this.maxCount?{value:null,done:!0}:this.upstream.next()}}class NS extends kS{constructor(t,e,n=!0){super(),this.upstream=t,this.batchSize=e,this.enableSmallLastBatch=n,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> RowMajorBatch`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){const t=[];while(t.length<this.batchSize){const e=await this.upstream.next();if(e.done)return this.enableSmallLastBatch&&t.length>0?{value:t,done:!1}:{value:null,done:!0};t.push(e.value)}return{value:t,done:!1}}}class ES extends kS{constructor(t,e){super(),this.upstream=t,this.predicate=e,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> Filter`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){while(1){const t=await this.upstream.next();if(t.done||this.predicate(t.value))return t;co(t.value)}}}class OS extends kS{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Map`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=ni(t.value),n=this.transform(t.value),s=ni(n);for(const i of e)ei(i,s)||i.dispose();return{value:n,done:!1}}}class $S extends kS{constructor(t,e){super(),this.upstream=t,this.handler=e,this.count=0,this.lastRead=Promise.resolve({value:null,done:!1})}summary(){return`${this.upstream.summary()} -> handleErrors`}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){while(1)try{return await this.upstream.next()}catch(t){if(!this.handler(t))return{value:null,done:!0}}}}class RS extends kS{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> AsyncMap`}async next(){const t=await this.upstream.next();if(t.done)return{value:null,done:!0};const e=ni(t.value),n=await this.transform(t.value),s=ni(n);for(const i of e)ei(i,s)||i.dispose();return{value:n,done:!1}}}class DS extends kS{constructor(){super(),this.outputQueue=new vS,this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}async serialNext(){while(0===this.outputQueue.length())if(!await this.pump())return{value:null,done:!0};return{value:this.outputQueue.shift(),done:!1}}}class MS extends DS{constructor(t,e){super(),this.upstream=t,this.transform=e}summary(){return`${this.upstream.summary()} -> Flatmap`}async pump(){const t=await this.upstream.next();if(t.done)return!1;const e=ni(t.value),n=this.transform(t.value),s=ni(n);this.outputQueue.pushAll(n);for(const i of e)ei(i,s)||i.dispose();return!0}}class PS extends kS{constructor(t,e){super(),this.baseErrorHandler=e,this.lastRead=null,this.iterator=null,this.moreIterators=t}summary(){const t="TODO: fill in upstream of chained summaries";return`${t} -> Chained`}async next(){return this.lastRead=this.readFromChain(this.lastRead),this.lastRead}async readFromChain(t){if(await t,null==this.iterator){const t=await this.moreIterators.next();if(t.done)return{value:null,done:!0};this.iterator=t.value,null!=this.baseErrorHandler&&(this.iterator=this.iterator.handleErrors(this.baseErrorHandler))}const e=await this.iterator.next();return e.done?(this.iterator=null,this.readFromChain(t)):e}}(function(t){t[t["FAIL"]=0]="FAIL",t[t["SHORTEST"]=1]="SHORTEST",t[t["LONGEST"]=2]="LONGEST"})(oS||(oS={}));class FS extends kS{constructor(t,e){super(),this.upstream=t,this.bufferSize=e,this.buffer=new bS(e)}summary(){return`${this.upstream.summary()} -> Prefetch`}refill(){while(!this.buffer.isFull()){const t=this.upstream.next();this.buffer.push(t)}}next(){return this.refill(),this.buffer.shift()}}class LS extends FS{constructor(t,e,n){super(t,e),this.upstream=t,this.windowSize=e,this.upstreamExhausted=!1,this.random=aS.alea(n||Ds().toString()),this.lastRead=Promise.resolve({value:null,done:!1})}async next(){return this.lastRead=this.lastRead.then((()=>this.serialNext())),this.lastRead}randomInt(t){return Math.floor(this.random()*t)}chooseIndex(){return this.randomInt(this.buffer.length())}async serialNext(){this.upstreamExhausted||this.refill();while(!this.buffer.isEmpty()){const t=this.chooseIndex(),e=await this.buffer.shuffleExcise(t);if(!e.done)return this.refill(),e;this.upstreamExhausted=!0}return{value:null,done:!0}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
class zS{constructor(){this.size=null}batch(t,e=!0){const n=this;let s;return v(t>0,(()=>`batchSize needs to be positive, but it is\n      ${t}`)),s=this.size===1/0||null==this.size?this.size:e?Math.ceil(this.size/t):Math.floor(this.size/t),BS((async()=>(await n.iterator()).columnMajorBatch(t,e,qS)),s)}concatenate(t){const e=this;let n;return n=this.size===1/0||t.size===1/0?1/0:null!=this.size&&null!=t.size?this.size+t.size:null,BS((async()=>(await e.iterator()).concatenate(await t.iterator())),n)}filter(t){const e=this;let n;return n=this.size===1/0?1/0:null,BS((async()=>(await e.iterator()).filter((e=>uo((()=>t(e)))))),n)}async forEachAsync(t){return(await this.iterator()).forEachAsync(t)}map(t){const e=this;return BS((async()=>(await e.iterator()).map((e=>uo((()=>t(e)))))),this.size)}mapAsync(t){const e=this;return BS((async()=>(await e.iterator()).mapAsync(t)),this.size)}prefetch(t){if(null==t)throw new RangeError("`Dataset.prefetch()` requires bufferSize to be specified.");const e=this;return BS((async()=>(await e.iterator()).prefetch(t)),this.size)}repeat(t){const e=this;let n;return n=null!=this.size&&t>0?this.size*t:0===t?0:null!=this.size&&(void 0===t||t<0)?1/0:null,BS((async()=>{const n=xS((async()=>({value:await e.iterator(),done:!1})));return _S(n.take(t))}),n)}skip(t){const e=this;let n;return n=null!=this.size&&t>=0&&this.size>=t?this.size-t:null!=this.size&&(this.size<t||void 0===t||t<0)?0:null,BS((async()=>(await e.iterator()).skip(t)),n)}shuffle(t,e,n=!0){if(null==t||t<0)throw null==this.size?new RangeError("`Dataset.shuffle()` requires bufferSize to be specified."):new RangeError(`\`Dataset.shuffle()\` requires bufferSize to be specified.  If your data fits in main memory (for regular JS objects), and/or GPU memory (for \`tf.Tensor\`s), consider setting bufferSize to the dataset size (${this.size} elements)`);const s=this,i=aS.alea(e||Ds().toString());return BS((async()=>{let e=i.int32();return n&&(e+=i.int32()),(await s.iterator()).shuffle(t,e.toString())}),this.size)}take(t){const e=this;let n;return n=null!=this.size&&this.size>t?t:null!=this.size&&this.size<=t?this.size:null,BS((async()=>(await e.iterator()).take(t)),n)}async toArray(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArray()}async toArrayForTest(){if(this.size===1/0)throw new Error("Can not convert infinite data stream to array.");return(await this.iterator()).toArrayForTest()}}function BS(t,e=null){return new class extends zS{constructor(){super(...arguments),this.size=e}async iterator(){return t()}}}function qS(t){if(null===t)return null;const e=t[0];if(fS(e)){const e=VS(t);return{value:e,recurse:!1}}return{value:null,recurse:!0}}function VS(t){if(0===t.length)throw new Error("Can't make a batch of zero elements.");return t[0]instanceof js?Vc(t):Ti(t)}zS.MAX_BUFFER_SIZE=1e4;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 *
 * =============================================================================
 */
Symbol("out"),Symbol("field"),Symbol("quote"),Symbol("quoteafterquote"),Symbol("quoteinquote");
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function WS(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&v("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the CPU backend.`))}))}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const jS=Qp;class US extends d{constructor(){super(),this.blockSize=48,this.firstUse=!0,this.data=new p(this,oo())}write(t,e,n){this.firstUse&&(this.firstUse=!1,at().get("IS_NODE")&&$p("\n============================\nHi there . Looks like you are running TensorFlow.js in Node.js. To speed things up dramatically, install our node backend, which binds to TensorFlow C++, by running npm i @tensorflow/tfjs-node, or npm i @tensorflow/tfjs-node-gpu if you have CUDA. Then call require('@tensorflow/tfjs-node'); (-gpu suffix for CUDA) at the start of your program. Visit https://github.com/tensorflow/tfjs-node for more details.\n============================"));const s={};return this.data.set(s,{values:t,dtype:n,refCount:1}),s}makeTensorInfo(t,e,n){let s;if("string"===e&&null!=n&&n.length>0&&B(n[0])){const i=n.map((t=>Ms(t)));s=this.write(i,t,e)}else s=this.write(n,t,e);return{dataId:s,shape:t,dtype:e}}incRef(t){const e=this.data.get(t);e.refCount++}decRef(t){if(this.data.has(t)){const e=this.data.get(t);e.refCount--}}move(t,e,n,s){this.data.set(t,{values:e,dtype:s,refCount:1})}numDataIds(){return this.data.numDataIds()}async read(t){return this.readSync(t)}readSync(t){const{dtype:e,complexTensorInfos:n}=this.data.get(t);if("complex64"===e){const t=this.readSync(n.real.dataId),e=this.readSync(n.imag.dataId);return Dp(t,e)}return this.data.get(t).values}bufferSync(t){const e=this.readSync(t.dataId);let n=e;if("string"===t.dtype)try{n=e.map((t=>Ps(t)))}catch(s){throw new Error("Failed to decode encoded string bytes into utf-8")}return fr(t.shape,t.dtype,n)}makeOutput(t,e,n){const s=this.write(t,e,n);return oo().makeTensorFromDataId(s,e,n,this)}disposeData(t){if(this.data.has(t)){const{complexTensorInfos:e}=this.data.get(t);null!=e&&(this.disposeData(e.real.dataId),this.disposeData(e.imag.dataId)),this.data.delete(t)}}disposeIntermediateTensorInfo(t){const e=t.dataId;if(this.data.has(e)){const t=this.data.get(e);t.refCount--,t.refCount<1&&this.disposeData(e)}}async time(t){const e=Ds();t();const n=Ds()-e;return{kernelMs:n}}memory(){return{unreliable:!0,reasons:["The reported memory is an upper bound. Due to automatic garbage collection, the true allocated memory may be less."]}}where(t){WS([t],"where");const e=this.readSync(t.dataId);return jS(t.shape,e)}dispose(){}floatPrecision(){return 32}epsilon(){return super.epsilon()}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GS(t,e,n){return({inputs:s,attrs:i,backend:r})=>{const{x:o}=s;if(WS(o,t),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const a=r,u=a.data.get(o.dataId).values,c=k(o.shape),l=n||o.dtype,h=R(l,c);for(let t=0;t<c;++t)h[t]=e(u[t],i);return a.makeTensorInfo(o.shape,l,h)}}function HS(t,e,n){return({inputs:s,attrs:i,backend:r})=>{const{x:o}=s;if(WS(o,t),"string"===o.dtype||"string"===n)throw new Error("unaryKernelFunc does not support string input/output");const a=r,u=a.data.get(o.dataId).values,c=n||o.dtype,l=e(u,c,i);return a.makeTensorInfo(o.shape,c,l)}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
ho("cpu",(()=>new US),1);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const KS=GS(ue,(t=>t>=0?t:Math.exp(t)-1)),XS={kernelName:ue,backendName:"cpu",kernelFunc:KS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function QS(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const YS={kernelName:Te,backendName:"cpu",kernelFunc:QS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ZS(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:r}=s;WS([i],"leakyRelu");const o=k(i.shape),a=n.data.get(i.dataId).values,u=$("float32",o);for(let c=0;c<a.length;c++)u[c]=a[c]<0?r*a[c]:a[c];return n.makeTensorInfo(i.shape,"float32",u)}const JS={kernelName:Oe,backendName:"cpu",kernelFunc:ZS};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tT(t){return(e,n,s,i,r)=>{const o=La(e,n),a=o.length,u=G(o),c=k(o),l=$(r,c),h=e.length,p=n.length,d=G(e),f=G(n),m=Pa(e,o),g=Pa(n,o);if(m.length+g.length===0)for(let y=0;y<l.length;++y)l[y]=t(s[y%s.length],i[y%i.length]);else for(let y=0;y<l.length;++y){const e=tt(y,a,u),n=e.slice(-h);m.forEach((t=>n[t]=0));const r=J(n,h,d),o=e.slice(-p);g.forEach((t=>o[t]=0));const c=J(o,p,f);l[y]=t(s[r],i[c])}return[l,o]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const eT=tT(((t,e)=>t<0?e*t:t));function nT(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e;WS([s,i],"prelu");const r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,[a,u]=eT(s.shape,i.shape,r,o,s.dtype);return n.makeTensorInfo(u,s.dtype,a)}const sT={kernelName:fn,backendName:"cpu",kernelFunc:nT},iT=GS(vn,(t=>Math.max(0,t))),rT={kernelName:vn,backendName:"cpu",kernelFunc:iT},oT=GS(Tn,(t=>Math.min(Math.max(0,t),6))),aT={kernelName:Tn,backendName:"cpu",kernelFunc:oT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uT(t,e,n,s,i){if("linear"===n)return QS({inputs:{x:e},backend:t});if("relu"===n)return iT({inputs:{x:e},backend:t});if("elu"===n)return KS({inputs:{x:e},backend:t});if("relu6"===n)return oT({inputs:{x:e},backend:t});if("prelu"===n)return nT({inputs:{x:e,alpha:s},backend:t});if("leakyrelu"===n)return ZS({inputs:{x:e},backend:t,attrs:{alpha:i}});throw new Error(`Activation ${n} has not been implemented for the CPU backend.`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cT(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,r=n.data.get(s.dataId).values,o=n.data.get(i.dataId).values,a=n.makeTensorInfo(s.shape,"complex64"),u=n.data.get(a.dataId);return u.complexTensorInfos={real:n.makeTensorInfo(s.shape,"float32",r),imag:n.makeTensorInfo(i.shape,"float32",o)},a}const lT={kernelName:zt,backendName:"cpu",kernelFunc:cT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hT(t,e,n="float32"){if("complex64"===n){const n=hT(t,e,"float32"),s=hT(t,e,"float32");return cT({inputs:{real:n,imag:s},backend:t})}const s=Q(k(e),n);return t.makeTensorInfo(e,n,s)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pT(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.real,r=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,r)}const dT={kernelName:yn,backendName:"cpu",kernelFunc:pT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fT(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:r}=s;if("complex64"===r){if("complex64"===i.dtype)return QS({inputs:{x:i},backend:n});const t=hT(n,i.shape,i.dtype),e=fT({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),s=cT({inputs:{real:e,imag:t},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),s}if("complex64"===i.dtype){const t=pT({inputs:{input:i},backend:n}),e=fT({inputs:{x:t},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(t),e}if(!P(i.dtype,r)){const t=QS({inputs:{x:i},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:r}}if("int32"===r){const t=n.data.get(i.dataId).values,e=Int32Array.from(t);return n.makeTensorInfo(i.shape,"int32",e)}if("bool"===r){const t=n.data.get(i.dataId).values,e=Rs([0],i.dtype),[s,r]=tT(((t,e)=>t!==e?1:0))(i.shape,[],t,e,"bool");return n.makeTensorInfo(r,"bool",s)}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${r}`)}const mT={kernelName:Pt,backendName:"cpu",kernelFunc:fT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gT(t,e,n,s){return null==n?({inputs:n,backend:i})=>{const{a:r,b:o}=n,a=i;WS([r,o],t);const u=a.data.get(r.dataId).values,c=a.data.get(o.dataId).values,l=s||r.dtype,[h,p]=e(r.shape,o.shape,u,c,l);return a.makeTensorInfo(p,l,h)}:({inputs:t,backend:i})=>{const{a:r,b:o}=t,a=i;if("complex64"===r.dtype||"complex64"===o.dtype){const t=fT({inputs:{x:r},backend:a,attrs:{dtype:"complex64"}}),e=a.data.get(t.dataId),s=e.complexTensorInfos.real,i=e.complexTensorInfos.imag,u=a.data.get(s.dataId).values,c=a.data.get(i.dataId).values,l=fT({inputs:{x:o},backend:a,attrs:{dtype:"complex64"}}),h=a.data.get(l.dataId),p=h.complexTensorInfos.real,d=h.complexTensorInfos.imag,f=a.data.get(p.dataId).values,m=a.data.get(d.dataId).values,[g,y,b]=n(r.shape,o.shape,u,c,f,m),v=a.makeTensorInfo(b,"float32",g),w=a.makeTensorInfo(b,"float32",y),x=cT({inputs:{real:v,imag:w},backend:a});return a.disposeIntermediateTensorInfo(t),a.disposeIntermediateTensorInfo(l),a.disposeIntermediateTensorInfo(v),a.disposeIntermediateTensorInfo(w),x}{const t=a.data.get(r.dataId).values,n=a.data.get(o.dataId).values,i=s||r.dtype,[u,c]=e(r.shape,o.shape,t,n,i);return a.makeTensorInfo(c,i,u)}}}function yT(t){return(e,n,s,i,r,o)=>{const a=La(e,n),u=k(a),c=a.length,l=G(a),h=$("float32",u),p=$("float32",u),d=Pa(e,a),f=Pa(n,a),m=Dp(s,i),g=Dp(r,o),y=e.length,b=G(e),v=n.length,w=G(n);if(d.length+f.length===0)for(let x=0;x<h.length;x++){const e=x%m.length,n=x%g.length,s=t(m[2*e],m[2*e+1],g[2*n],g[2*n+1]);h[x]=s.real,p[x]=s.imag}else for(let x=0;x<h.length;x++){const e=tt(x,c,l),n=e.slice(-y);d.forEach((t=>n[t]=0));const s=J(n,y,b),i=e.slice(-v);f.forEach((t=>i[t]=0));const r=J(i,v,w),o=t(m[2*s],m[2*s+1],g[2*r],g[2*r+1]);h[x]=o.real,p[x]=o.imag}return[h,p,a]}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const bT=tT(((t,e)=>t+e)),vT=yT(((t,e,n,s)=>({real:t+n,imag:e+s}))),wT=gT(yt,bT,vT),xT={kernelName:yt,backendName:"cpu",kernelFunc:wT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _T(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:r}=s,o=k(i.shape),a=N(r,o),u=k(a);v(o===u,(()=>`The new shape (${a}) has ${u} elements and the old shape (${i.shape}) has ${o} elements. The new shape and old shape must have the same number of elements.`)),n.incRef(i.dataId);const c=n.data.get(i.dataId);if(null!=c.complexTensorInfos){const t=c.complexTensorInfos.real,e=c.complexTensorInfos.imag;t.shape=a,e.shape=a}return{dataId:i.dataId,shape:a,dtype:i.dtype}}const kT={kernelName:wn,backendName:"cpu",kernelFunc:_T};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ST(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r}=e,{transposeA:o,transposeB:a}=s;WS([i,r],"matMul");const u=i.shape.length,c=r.shape.length,l=o?i.shape[u-2]:i.shape[u-1],h=a?r.shape[c-1]:r.shape[c-2],p=o?i.shape[u-1]:i.shape[u-2],d=a?r.shape[c-2]:r.shape[c-1],f=i.shape.slice(0,-2),m=r.shape.slice(0,-2),g=k(f),y=k(m),b=g===y||1===g||1===y;v(u>=2&&c>=2&&b,(()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${f}) and (${m}).`));const w=g>y?i.shape.slice(0,-2):r.shape.slice(0,-2),x=w.concat([p,d]);v(l===h,(()=>`Error in matMul: inner shapes (${l}) and (${h}) of Tensors with shapes ${i.shape} and ${r.shape} and transposeA=${o} and transposeB=${a} must match.`));const _=o?[g,l,p]:[g,p,l],S=a?[y,d,h]:[y,h,d],T=_T({inputs:{x:i},backend:n,attrs:{shape:_}}),I=_T({inputs:{x:r},backend:n,attrs:{shape:S}}),C=o?T.shape[1]:T.shape[2],A=o?T.shape[2]:T.shape[1],N=a?I.shape[1]:I.shape[2],E=Math.max(g,y),O=n.data.get(T.dataId).values,$=n.data.get(I.dataId).values,R=G(T.shape),D=G(I.shape),[M,P,F]=o?[R[0],1,R[1]]:[R[0],R[1],1],[L,z,B]=a?[1,D[1],D[0]]:[D[1],1,D[0]],q=A*N,V=fr([E,A,N],T.dtype),W=V.values,j=n.blockSize;for(let v=0;v<E;v++)for(let t=0;t<A;t+=j)for(let e=0;e<N;e+=j)for(let n=0;n<C;n+=j){const s=Math.min(t+j,A),i=Math.min(e+j,N),r=Math.min(n+j,C);for(let o=t;o<s;o++)for(let t=e;t<i;t++){let e=0;for(let s=n;s<r;s++){const n=Math.min(v,g-1)*M,i=Math.min(v,y-1)*B,r=O[n+o*P+s*F],a=$[s*L+t*z+i];e+=r*a}W[v*q+(o*N+t)]+=e}}return n.disposeIntermediateTensorInfo(T),n.disposeIntermediateTensorInfo(I),n.makeTensorInfo(x,V.dtype,V.values)}const TT={kernelName:$t,backendName:"cpu",kernelFunc:ST};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IT(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r,bias:o,preluActivationWeights:a}=e,{transposeA:u,transposeB:c,activation:l,leakyreluAlpha:h}=s;let p,d,f;const m=[],g=ST({inputs:{a:i,b:r},attrs:{transposeA:u,transposeB:c},backend:n});p=g,o&&(d=wT({inputs:{a:p,b:o},backend:n}),m.push(p),p=d),l&&(f=uT(n,p,l,a,h),m.push(p),p=f);for(const y of m)n.disposeIntermediateTensorInfo(y);return p}const CT={kernelName:os,backendName:"cpu",kernelFunc:IT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function AT(t){const e=new Float32Array(t.length);for(let n=0;n<t.length;++n)e[n]=Math.abs(t[n]);return e}const NT=t=>{const{x:e}=t.inputs,n=t.backend;WS(e,"abs");let s=new Float32Array(k(e.shape));const i=n.data.get(e.dataId).values;return s=AT(i),n.makeOutput(s,e.shape,"float32")},ET={kernelName:ft,backendName:"cpu",kernelFunc:NT},OT=GS(mt,(t=>Math.acos(t))),$T={kernelName:mt,backendName:"cpu",kernelFunc:OT},RT=GS(gt,(t=>Math.acosh(t))),DT={kernelName:gt,backendName:"cpu",kernelFunc:RT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MT(t){const{inputs:e,backend:n}=t,s=e;WS(e,"addN");const i=s.map((t=>n.data.get(t.dataId).values)),r=fr(s[0].shape,s[0].dtype),o=r.values;for(let a=0;a<s.length;a++){const t=i[a];for(let e=0;e<o.length;e++)o[e]+=t[e]}return n.makeTensorInfo(r.shape,r.dtype,r.values)}const PT={kernelName:bt,backendName:"cpu",kernelFunc:MT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FT(t,e,n,s,i){const r=e.length,o=k(e),a=G(e),u=G(i),c=$(n,k(i));for(let l=0;l<o;++l){const e=tt(l,r,a),n=new Array(e.length);for(let t=0;t<n.length;t++)n[t]=e[s[t]];const i=J(n,r,u);c[i]=t[l]}return c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function LT(t){const{inputs:e,attrs:n,backend:s}=t,{x:i}=e,{perm:r}=n;WS(i,"transpose");const o=i.shape.length,a=new Array(o);for(let h=0;h<a.length;h++)a[h]=i.shape[r[h]];const u=s.data.get(i.dataId).values,c=FT(u,i.shape,i.dtype,r,a),l=s.write(c,a,i.dtype);return{dataId:l,shape:a,dtype:i.dtype}}const zT={kernelName:Zn,backendName:"cpu",kernelFunc:LT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function BT(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;WS(i,"all");const a=E(r,i.shape);let u=a;const c=Fu(u,i.shape.length);let l=i;null!=c&&(l=LT({inputs:{x:i},backend:n,attrs:{perm:c}}),u=zu(u.length,i.shape.length)),Pu("all",u,l.shape.length);const[h,p]=Du(l.shape,u),d=k(p),f=Q(k(h),l.dtype),m=n.data.get(l.dataId).values;for(let y=0;y<f.length;++y){const t=y*d;let e=m[t];for(let n=0;n<d;++n){const s=m[t+n];e=e&&s}f[y]=e}null!=c&&n.disposeIntermediateTensorInfo(l);const g=n.makeTensorInfo(h,l.dtype,f);if(o){const t=Mu(h,a),e=_T({inputs:{x:g},backend:n,attrs:{shape:t}});return n.disposeIntermediateTensorInfo(g),e}return g}const qT={kernelName:vt,backendName:"cpu",kernelFunc:BT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function VT(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;WS(i,"any");const a=E(r,i.shape);let u=a;const c=Fu(u,i.shape.length);let l=i;null!=c&&(l=LT({inputs:{x:i},backend:n,attrs:{perm:c}}),u=zu(u.length,i.shape.length)),Pu("any",u,l.shape.length);const[h,p]=Du(l.shape,u),d=k(p),f=Q(k(h),l.dtype),m=n.data.get(l.dataId).values;for(let y=0;y<f.length;++y){const t=y*d;let e=m[t];for(let n=0;n<d;++n){const s=m[t+n];e=e||s}f[y]=e}null!=c&&n.disposeIntermediateTensorInfo(l);const g=n.makeTensorInfo(h,l.dtype,f);if(o){const t=Mu(h,a),e=_T({inputs:{x:g},backend:n,attrs:{shape:t}});return n.disposeIntermediateTensorInfo(g),e}return g}const WT={kernelName:wt,backendName:"cpu",kernelFunc:VT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jT(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;WS(i,"argMax");let o=E(r,i.shape);const a=Fu(o,i.shape.length);let u=i;const c=[];null!=a&&(u=LT({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(u),o=zu(o.length,u.shape.length)),o=[o[0]],Pu("argMax",o,u.shape.length);const[l,h]=Du(u.shape,o),p=k(l),d=Q(p,"int32"),f=k(h),m=n.data.get(u.dataId).values;for(let g=0;g<d.length;++g){const t=g*f;let e=m[t],n=0;for(let s=0;s<f;++s){const i=m[t+s];i>e&&(e=i,n=s)}d[g]=n}return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(l,"int32",d)}const UT={kernelName:xt,backendName:"cpu",kernelFunc:jT};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GT(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;WS(i,"argMin");let o=E(r,i.shape);const a=Fu(o,i.shape.length);let u=i;const c=[];null!=a&&(u=LT({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(u),o=zu(o.length,u.shape.length)),o=[o[0]],Pu("argMin",o,u.shape.length);const[l,h]=Du(u.shape,o),p=k(l),d=Q(p,"int32"),f=k(h),m=n.data.get(u.dataId).values;for(let g=0;g<d.length;++g){const t=g*f;let e=m[t],n=0;for(let s=0;s<f;++s){const i=m[t+s];i<e&&(e=i,n=s)}d[g]=n}return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(l,"int32",d)}const HT={kernelName:_t,backendName:"cpu",kernelFunc:GT},KT=GS(kt,(t=>Math.asin(t))),XT={kernelName:kt,backendName:"cpu",kernelFunc:KT},QT=GS(St,(t=>Math.asinh(t))),YT={kernelName:St,backendName:"cpu",kernelFunc:QT},ZT=GS(Tt,(t=>Math.atan(t))),JT={kernelName:Tt,backendName:"cpu",kernelFunc:ZT},tI=tT(((t,e)=>Math.atan2(t,e))),eI=gT(Ct,tI),nI={kernelName:Ct,backendName:"cpu",kernelFunc:eI},sI=GS(It,(t=>Math.atanh(t))),iI={kernelName:It,backendName:"cpu",kernelFunc:sI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rI(t,e,n,s,i,r){const o=i.strideHeight,a=i.strideWidth,u=i.dilationHeight,c=i.dilationWidth,l=i.effectiveFilterHeight,h=i.effectiveFilterWidth,p=i.padInfo.top,d=i.padInfo.left,f="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,m=fr(i.outShape,n),g=m.values,y=i.outShape[1]*i.outShape[2]*i.outShape[3],b=i.outShape[2]*i.outShape[3],v=i.outShape[3];for(let w=0;w<i.batchSize;++w){const e=w*y,n=w*s[0];for(let m=0;m<i.inChannels;++m)for(let y=0;y<i.outHeight;++y){const w=y*o-p,x=Math.max(0,w),_=Math.min(i.inHeight,l+w),k=e+y*b;for(let e=0;e<i.outWidth;++e){const o=e*a-d,l=Math.max(0,o),p=Math.min(i.inWidth,h+o);let y=f,b=0,w=0;for(let e=x;e<_;e+=u){const i=n+e*s[1];for(let e=l;e<p;e+=c){const n=i+e*s[2],o=t[n+m];"max"===r&&o>y?y=o:"avg"===r&&(b+=o,w++)}if(isNaN(y))break}const S=k+e*v+m;g[S]="avg"===r?b/w:y}}}return m}function oI(t,e,n,s,i=!1,r=!1){const o=fr(s.outShape,"int32"),a=s.strideHeight,u=s.strideWidth,c=s.dilationHeight,l=s.dilationWidth,h=s.effectiveFilterHeight,p=s.effectiveFilterWidth,d=s.padInfo.top,f=s.padInfo.left,m=fr(e,n,t);for(let g=0;g<s.batchSize;++g)for(let t=0;t<s.inChannels;++t)for(let e=0;e<s.outHeight;++e){const n=e*a-d;let y=n;while(y<0)y+=c;const b=Math.min(s.inHeight,h+n);for(let a=0;a<s.outWidth;++a){const h=a*u-f;let d=h;while(d<0)d+=l;const v=Math.min(s.inWidth,p+h);let w=Number.NEGATIVE_INFINITY,x=-1;for(let e=y;e<b;e+=c){const o=e-n;for(let n=d;n<v;n+=l){const a=n-h,u=m.get(g,e,n,t);u>w&&(w=u,x=i?r?((g*s.inHeight+e)*s.inWidth+n)*s.inChannels+t:(e*s.inWidth+n)*s.inChannels+t:o*p+a)}}o.set(x,g,e,a,t)}}return o}function aI(t,e,n,s,i,r){const o=i.strideDepth,a=i.strideHeight,u=i.strideWidth,c=i.dilationDepth,l=i.dilationHeight,h=i.dilationWidth,p=i.effectiveFilterDepth,d=i.effectiveFilterHeight,f=i.effectiveFilterWidth,m=i.padInfo.front,g=i.padInfo.top,y=i.padInfo.left,b="max"===r?Number.NEGATIVE_INFINITY:Number.POSITIVE_INFINITY,v=fr(i.outShape,n),w=v.values,x=i.outShape[1]*i.outShape[2]*i.outShape[3]*i.outShape[4],_=i.outShape[2]*i.outShape[3]*i.outShape[4],k=i.outShape[3]*i.outShape[4],S=i.outShape[4];for(let T=0;T<i.batchSize;++T){const e=T*x,n=T*s[0];for(let v=0;v<i.inChannels;++v)for(let x=0;x<i.outDepth;++x){const T=x*o-m;let I=T;while(I<0)I+=c;const C=Math.min(i.inDepth,p+T),A=e+x*_;for(let e=0;e<i.outHeight;++e){const o=e*a-g;let p=o;while(p<0)p+=l;const m=Math.min(i.inHeight,d+o),x=A+e*k;for(let e=0;e<i.outWidth;++e){const o=e*u-y;let a=o;while(a<0)a+=h;const d=Math.min(i.inWidth,f+o),g=x+e*S;let _=b,k=0,T=0;for(let e=I;e<C;e+=c){const i=n+e*s[1];for(let e=p;e<m;e+=l){const n=i+e*s[2];for(let e=a;e<d;e+=h){const i=n+e*s[3],o=t[i+v];if("max"===r&&o>_?_=o:"avg"===r&&(k+=o,T++),isNaN(_))break}if(isNaN(_))break}if(isNaN(_))break}const A=g+v;w[A]="avg"===r?k/T:_}}}}return v}function uI(t,e){const n=fr(e.outShape,"int32"),s=e.strideDepth,i=e.strideHeight,r=e.strideWidth,o=e.dilationDepth,a=e.dilationHeight,u=e.dilationWidth,c=e.effectiveFilterDepth,l=e.effectiveFilterHeight,h=e.effectiveFilterWidth,p=e.padInfo.front,d=e.padInfo.top,f=e.padInfo.left;for(let m=0;m<e.batchSize;++m)for(let g=0;g<e.inChannels;++g)for(let y=0;y<e.outDepth;++y){const b=y*s-p;let v=b;while(v<0)v+=o;const w=Math.min(e.inDepth,c+b);for(let s=0;s<e.outHeight;++s){const c=s*i-d;let p=c;while(p<0)p+=a;const x=Math.min(e.inHeight,l+c);for(let i=0;i<e.outWidth;++i){const d=i*r-f;let _=d;while(_<0)_+=u;const k=Math.min(e.inWidth,h+d);let S=Number.NEGATIVE_INFINITY,T=-1;for(let e=v;e<w;e+=o){const n=e-b;for(let s=p;s<x;s+=a){const i=s-c;for(let r=_;r<k;r+=u){const o=r-d,a=t.get(m,e,s,r,g);a>=S&&(S=a,T=n*l*h+i*l+o)}}}n.set(T,m,y,s,i,g)}}}return n}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;WS(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:u}=s,c=1;v(Wo(o,c),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const l=No(i.shape,r,o,c,a,u);let h;if(1===l.filterWidth&&1===l.filterHeight&&S(l.inShape,l.outShape))h=QS({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=G(i.shape),s=rI(t,i.shape,i.dtype,e,l,"avg");h=n.makeTensorInfo(l.outShape,i.dtype,s.values)}return h}const lI={kernelName:At,backendName:"cpu",kernelFunc:cI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:u,dataFormat:c,dilations:l}=s;WS(i,"avgPool3d");let h=l;null==h&&(h=[1,1,1]);const p=Eo(i.shape,r,o,h,a,u,c),d=n.data.get(i.dataId).values,f=aI(d,i.shape,i.dtype,G(i.shape),p,"avg");return n.makeTensorInfo(f.shape,"float32",f.values)}const pI={kernelName:Et,backendName:"cpu",kernelFunc:hI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dI(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,{filterSize:o,strides:a,pad:u,dilations:c,dimRoundingMode:l}=s;WS([i,r],"avgPool3DGrad");const h=Eo(r.shape,o,a,c,u,l),p=h.strideDepth,d=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=h.dilationDepth,v=h.dilationHeight,w=h.dilationWidth,x=h.effectiveFilterDepth,_=h.effectiveFilterHeight,k=h.effectiveFilterWidth,S=x-1-h.padInfo.front,T=k-1-h.padInfo.left,I=_-1-h.padInfo.top,C=fr(r.shape,"float32"),A=1/(m*g*y),N=n.bufferSync(i);for(let E=0;E<h.batchSize;++E)for(let t=0;t<h.inChannels;++t)for(let e=0;e<h.inDepth;++e)for(let n=0;n<h.inHeight;++n)for(let s=0;s<h.inWidth;++s){const i=e-S,r=n-I,o=s-T;let a=0;for(let e=0;e<x;e+=b){const n=(i+e)/p;if(!(n<0||n>=h.outDepth||Math.floor(n)!==n))for(let e=0;e<_;e+=v){const s=(r+e)/d;if(!(s<0||s>=h.outHeight||Math.floor(s)!==s))for(let e=0;e<k;e+=w){const i=(o+e)/f;if(i<0||i>=h.outWidth||Math.floor(i)!==i)continue;const r=N.get(E,n,s,i,t);a+=r}}}C.set(a*A,E,e,n,s,t)}return n.makeTensorInfo(C.shape,C.dtype,C.values)}const fI={kernelName:Ot,backendName:"cpu",kernelFunc:dI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mI(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r;WS([i,r],"avgPoolGrad");const{filterSize:a,strides:u,pad:c}=s,l=No(o.shape,a,u,1,c),h=l.strideHeight,p=l.strideWidth,d=l.filterHeight,f=l.filterWidth,m=l.dilationHeight,g=l.dilationWidth,y=l.effectiveFilterHeight,b=l.effectiveFilterWidth,v=b-1-l.padInfo.left,w=y-1-l.padInfo.top,x=fr(o.shape,"float32"),_=1/(d*f),k=n.data.get(i.dataId).values,S=fr(i.shape,"float32",k);for(let T=0;T<l.batchSize;++T)for(let t=0;t<l.inChannels;++t)for(let e=0;e<l.inHeight;++e)for(let n=0;n<l.inWidth;++n){const s=e-w,i=n-v;let r=0;for(let e=0;e<y;e+=m){const n=(s+e)/h;if(!(n<0||n>=l.outHeight||Math.floor(n)!==n))for(let e=0;e<b;e+=g){const s=(i+e)/p;if(s<0||s>=l.outWidth||Math.floor(s)!==s)continue;const o=S.get(T,n,s,t);r+=o}}x.set(r*_,T,e,n,t)}return n.makeTensorInfo(x.shape,x.dtype,x.values)}const gI={kernelName:Nt,backendName:"cpu",kernelFunc:mI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,scale:r,offset:o,mean:a,variance:u}=e;v(a.shape.length===u.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),v(null==o||a.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),v(null==r||a.shape.length===r.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks.")),WS([i,a,u,r,o],"batchNorm");let{varianceEpsilon:c}=s;null==c&&(c=.001);const l=n.data.get(i.dataId).values,h=n.data.get(a.dataId).values,p=n.data.get(u.dataId).values,d=r?n.data.get(r.dataId).values:new Float32Array([1]),f=o?n.data.get(o.dataId).values:new Float32Array([0]),m=new Float32Array(l.length),g=f.length,y=d.length,b=p.length,w=h.length;let x=0,_=0,k=0,S=0;for(let v=0;v<l.length;++v)m[v]=f[x++]+(l[v]-h[_++])*d[k++]/Math.sqrt(p[S++]+c),x>=g&&(x=0),_>=w&&(_=0),k>=y&&(k=0),S>=b&&(S=0);return n.makeTensorInfo(i.shape,i.dtype,m)}const bI={kernelName:we,backendName:"cpu",kernelFunc:yI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vI(t,e,n,s,i){const r=Zr(s,e,n),o=k(n),a=G(s);if(r){const n=Jr(e,a);return"string"===i?t.slice(n,n+o):t.subarray(n,n+o)}const u="string"===i?Kp(t):t,c=fr(s,i,u),l=fr(n,i);for(let h=0;h<l.size;++h){const t=l.indexToLoc(h),n=t.map(((t,n)=>t+e[n]));l.set(c.get(...n),...t)}return"string"===i?Xp(l.values):l.values}function wI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,size:o}=s;WS(i,"slice");const[a,u]=to(i,r,o);Br(i,a,u);const c=n.data.get(i.dataId).values,l=vI(c,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,l)}const xI={kernelName:$n,backendName:"cpu",kernelFunc:wI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _I(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,crops:o}=s;WS([i],"batchToSpaceND");const a=r.reduce(((t,e)=>t*e)),u=mp(i.shape,r,a),c=gp(u.length,r.length),l=yp(i.shape,r,a),h=bp(o,r.length),p=vp(l,o,r.length),d=_T({inputs:{x:i},backend:n,attrs:{shape:u}}),f=LT({inputs:{x:d},backend:n,attrs:{perm:c}}),m=_T({inputs:{x:f},backend:n,attrs:{shape:l}}),g=wI({inputs:{x:m},backend:n,attrs:{begin:h,size:p}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const kI={kernelName:Rt,backendName:"cpu",kernelFunc:_I};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SI(t,e,n,s,i){const r=k(s),o=Q(i,n);for(let a=0;a<t.length;a++){const n=t[a];if(n<0)throw new Error("Input x must be non-negative!");n>=i||(o[n]+=r>0?e[a]:1)}return o}function TI(t,e,n,s=!1){const i=t.shape[0],r=t.shape[1],o=fr([i,n],e.dtype);for(let a=0;a<i;a++)for(let i=0;i<r;i++){const r=t.get(a,i);if(r<0)throw new Error("Input x must be non-negative!");r>=n||(s?o.set(1,a,r):e.size>0?o.set(o.get(a,r)+e.get(a,i),a,r):o.set(o.get(a,r)+1,a,r))}return o}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function II(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o}=s,a=n.data.get(i.dataId).values,u=n.data.get(r.dataId).values,c=SI(a,u,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,c)}const CI={kernelName:Dt,backendName:"cpu",kernelFunc:II};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function AI(t){return(e,n,s)=>{const i=$(n,e.length);for(let r=0;r<e.length;++r)i[r]=t(e[r],s);return i}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const NI=AI((t=>Math.ceil(t))),EI=HS(Ft,NI),OI={kernelName:Ft,backendName:"cpu",kernelFunc:EI},$I=GS(Lt,((t,e)=>{const n=e;return t>n.clipValueMax?n.clipValueMax:t<n.clipValueMin?n.clipValueMin:t})),RI={kernelName:Lt,backendName:"cpu",kernelFunc:$I},DI=t=>{const{x:e}=t.inputs,n=t.backend,s=new Float32Array(k(e.shape)),i=n.data.get(e.dataId),r=i.complexTensorInfos.real,o=i.complexTensorInfos.imag,a=n.data.get(r.dataId).values,u=n.data.get(o.dataId).values;for(let c=0;c<a.length;c++){const t=a[c],e=u[c];s[c]=Math.hypot(t,e)}return n.makeOutput(s,e.shape,"float32")},MI={kernelName:Bt,backendName:"cpu",kernelFunc:DI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function PI(t,e,n,s){const i=R(n,k(e));if(s&&"string"!==n){let e=0;t.forEach((t=>{const n=k(t.shape);i.set(t.vals,e),e+=n}))}else{let s=0;t.forEach((t=>{const r="string"===n?Kp(t.vals):t.vals;let o=0;for(let n=0;n<t.shape[0];++n){const a=n*e[1]+s;for(let e=0;e<t.shape[1];++e)i[a+e]=r[o++]}s+=t.shape[1]}))}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FI(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.data.get(s.dataId).complexTensorInfos.imag,r=n.data.get(i.dataId).values;return n.makeTensorInfo(i.shape,i.dtype,r)}const LI={kernelName:Ce,backendName:"cpu",kernelFunc:FI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zI(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,r=E(i,e[0].shape)[0];let o=hp(e.map((t=>t.shape)),r);if(0===k(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>k(t.shape)>0));if(1===a.length)return QS({inputs:{x:a[0]},backend:n});const u=a.map((t=>t.shape));if(lp(u,r),"complex64"===a[0].dtype){const t=a.map((t=>pT({inputs:{input:t},backend:n}))),e=a.map((t=>FI({inputs:{input:t},backend:n}))),s=zI({inputs:t,backend:n,attrs:{axis:r}}),i=zI({inputs:e,backend:n,attrs:{axis:r}}),o=cT({inputs:{real:s,imag:i},backend:n});return t.forEach((t=>n.disposeIntermediateTensorInfo(t))),e.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i),o}const c=a.map((t=>{const e=k(t.shape.slice(r)),s=[-1,e];return _T({inputs:{x:t},backend:n,attrs:{shape:s}})})),l=c.map((t=>({vals:n.data.get(t.dataId).values,shape:t.shape})));o=hp(c.map((t=>t.shape)),1);const h=1===c[0].shape[0],p=PI(l,o,e[0].dtype,h),d=hp(a.map((t=>t.shape)),r),f=n.makeTensorInfo(d,e[0].dtype,p);return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}const BI={kernelName:qt,backendName:"cpu",kernelFunc:zI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dataFormat:u,dilations:c,dimRoundingMode:l}=s;WS([i,r],"conv2d");const h=jo(u),p=Oo(i.shape,r.shape,o,c,a,l,!1,h),d=p.filterHeight,f=p.filterWidth,m=p.dilationHeight,g=p.dilationWidth,y=p.padInfo.left,b=p.padInfo.top,v="channelsLast"===p.dataFormat,w=new Fs(p.outShape,i.dtype),x=G(i.shape),_=G(r.shape),k=x[0],S=v?x[1]:x[2],T=v?x[2]:1,I=v?1:x[1],C=w.strides[0],A=v?w.strides[1]:w.strides[2],N=v?w.strides[2]:1,E=v?1:w.strides[1],O=n.data.get(i.dataId).values,$=n.data.get(r.dataId).values,R=w.values;for(let D=0;D<p.batchSize;++D){const t=D*k,e=D*C;for(let n=0;n<p.outHeight;++n){const s=e+n*A,i=n*p.strideHeight-b;for(let e=0;e<d;++e){const n=i+e*m;if(n<0||n>=p.inHeight)continue;const r=e*_[0],o=t+n*S;for(let t=0;t<p.outWidth;++t){const e=s+t*N,n=t*p.strideWidth-y;for(let t=0;t<f;++t){const s=n+t*g;if(s<0||s>=p.inWidth)continue;const i=r+t*_[1],a=o+s*T;let u=i;for(let t=0;t<p.inChannels;++t){const n=O[a+t*I];for(let t=0;t<p.outChannels;++t)R[e+t*E]+=n*$[u+t];u+=p.outChannels}}}}}}return n.makeTensorInfo(w.shape,w.dtype,R)}const VI={kernelName:Vt,backendName:"cpu",kernelFunc:qI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function WI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:l}=s;WS([i,r],"conv2dBackpropFilter");const h=jo(u),p=Oo(i.shape,l,o,1,a,c,!1,h),{strideHeight:d,strideWidth:f,filterHeight:m,filterWidth:g}=p,y="channelsLast"===p.dataFormat,b=new Fs(p.filterShape,"float32"),v=p.padInfo.left,w=p.padInfo.top,x=n.data.get(i.dataId).values,_=n.data.get(r.dataId).values,k=new Fs(i.shape,i.dtype,x),S=new Fs(r.shape,r.dtype,_);for(let T=0;T<m;++T){const t=Math.max(0,Math.ceil((w-T)/d)),e=Math.min(p.outHeight,(p.inHeight+w-T)/d);for(let n=0;n<g;++n){const s=Math.max(0,Math.ceil((v-n)/f)),i=Math.min(p.outWidth,(p.inWidth+v-n)/f);for(let r=0;r<p.inChannels;++r)for(let o=0;o<p.outChannels;++o){let a=0;for(let u=0;u<p.batchSize;++u)for(let c=t;c<e;++c){const t=T+c*d-w;for(let e=s;e<i;++e){const s=n+e*f-v;a+=y?k.get(u,t,s,r)*S.get(u,c,e,o):k.get(u,r,t,s)*S.get(u,o,c,e)}}b.set(a,T,n,r,o)}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const jI={kernelName:Wt,backendName:"cpu",kernelFunc:WI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function UI(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{inputShape:o,strides:a,pad:u,dataFormat:c,dimRoundingMode:l}=s;WS([i,r],"conv2dBackpropInput");const h=G(r.shape),p=G(i.shape);let d=jo(c);const f=Oo(o,r.shape,a,1,u,l,!1,d),m=new Fs(f.inShape,"float32"),g=m.values,y=n.data.get(i.dataId).values,b=n.data.get(r.dataId).values,[v,w,x]=h,{batchSize:_,filterHeight:k,filterWidth:S,inChannels:T,inHeight:I,inWidth:C,outChannels:A,outHeight:N,outWidth:E,strideHeight:O,strideWidth:$}=f;d=f.dataFormat;const R=k-1-f.padInfo.top,D=S-1-f.padInfo.left,M="channelsLast"===d,P=m.strides[0],F=M?m.strides[1]:m.strides[2],L=M?m.strides[2]:1,z=M?1:m.strides[1],B=p[0],q=M?p[1]:p[2],V=M?p[2]:1,W=M?1:p[1];for(let j=0;j<_;++j)for(let t=0;t<T;++t)for(let e=0;e<I;++e){const n=e-R,s=Math.max(0,Math.ceil(n/O)),i=Math.min(N,(k+n)/O);for(let r=0;r<C;++r){const o=r-D,a=Math.max(0,Math.ceil(o/$)),u=Math.min(E,(S+o)/$);let c=0;for(let e=s;e<i;++e){const s=e*O-n;for(let n=a;n<u;++n){const i=n*$-o,r=B*j+q*e+V*n,a=v*(k-1-s)+w*(S-1-i)+x*t;for(let t=0;t<A;++t){const e=y[r+W*t],n=b[a+t];c+=e*n}}}const l=P*j+F*e+L*r+z*t;g[l]=c}}return n.makeTensorInfo(m.shape,m.dtype,m.values)}const GI={kernelName:jt,backendName:"cpu",kernelFunc:UI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function HI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:u}=s;WS([i,r],"conv3d");const c=$o(i.shape,r.shape,o,u,a),{filterDepth:l,filterHeight:h,filterWidth:p,dilationDepth:d,dilationHeight:f,dilationWidth:m,padInfo:g}=c,y=g.front,b=g.left,v=g.top,w=new Fs(c.outShape,i.dtype),x=n.data.get(i.dataId).values,_=n.data.get(r.dataId).values,k=w.values,S=G(i.shape),T=G(r.shape);for(let I=0;I<c.batchSize;++I){const t=I*S[0],e=I*w.strides[0];for(let n=0;n<c.outDepth;++n){const s=e+n*w.strides[1],i=n*c.strideDepth-y;for(let e=0;e<l;++e){const n=i+e*d;if(n<0||n>=c.inDepth)continue;const r=e*T[0],o=t+n*S[1];for(let t=0;t<c.outHeight;++t){const e=s+t*w.strides[2],n=t*c.strideHeight-v;for(let t=0;t<h;++t){const s=n+t*f;if(s<0||s>=c.inHeight)continue;const i=r+t*T[1],a=o+s*S[2];for(let t=0;t<c.outWidth;++t){const n=e+t*c.outChannels,s=t*c.strideWidth-b;for(let t=0;t<p;++t){const e=s+t*m;if(e<0||e>=c.inWidth)continue;const r=i+t*T[2],o=a+e*c.inChannels;let u=r;for(let t=0;t<c.inChannels;++t){const e=x[o+t];for(let t=0;t<c.outChannels;++t)k[n+t]+=e*_[u+t];u+=c.outChannels}}}}}}}}return n.makeTensorInfo(w.shape,w.dtype,w.values)}const KI={kernelName:Ut,backendName:"cpu",kernelFunc:HI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function XI(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,filterShape:u}=s;WS([i,r],"conv3dBackpropFilterV2");const c=G(i.shape),l=G(r.shape),h=$o(i.shape,u,o,1,a),p=h.strideDepth,d=h.strideHeight,f=h.strideWidth,m=h.filterDepth,g=h.filterHeight,y=h.filterWidth,b=new Fs(h.filterShape,"float32"),v=b.values,[w,x,_,k]=b.strides,S=n.data.get(r.dataId).values,[T,I,C,A]=l,N=n.data.get(i.dataId).values,[E,O,$,R]=c,D=h.padInfo.front,M=h.padInfo.left,P=h.padInfo.top;for(let F=0;F<m;++F){const t=Math.max(0,Math.ceil((D-F)/p)),e=Math.min(h.outDepth,(h.inDepth+D-F)/p),n=F*w;for(let s=0;s<g;++s){const i=Math.max(0,Math.ceil((P-s)/d)),r=Math.min(h.outHeight,(h.inHeight+P-s)/d),o=s*x+n;for(let n=0;n<y;++n){const a=Math.max(0,Math.ceil((M-n)/f)),u=Math.min(h.outWidth,(h.inWidth+M-n)/f),c=n*_+o;for(let o=0;o<h.inChannels;++o){const l=o*k+c;for(let c=0;c<h.outChannels;++c){let m=0;for(let l=0;l<h.batchSize;++l){const h=l*E,g=l*T;for(let l=t;l<e;++l){const t=F+l*p-D,e=t*O+h,y=l*I+g;for(let l=i;l<r;++l){const t=s+l*d-P,i=t*$+e,r=l*C+y;for(let e=a;e<u;++e){const t=n+e*f-M,s=t*R+i,a=e*A+r;m+=N[s+o]*S[a+c]}}}}v[l+c]=m}}}}}return n.makeTensorInfo(b.shape,b.dtype,b.values)}const QI={kernelName:Gt,backendName:"cpu",kernelFunc:XI};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function YI(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{pad:o,strides:a,inputShape:u}=s;WS([i],"conv3dBackpropInputV2");const c=G(i.shape),l=G(r.shape),h=$o(u,r.shape,a,1,o),p=new Fs(h.inShape,"float32"),d=p.values,[f,m,g,y]=p.strides,b=n.data.get(i.dataId).values,[v,w,x,_]=c,k=n.data.get(r.dataId).values,[S,T,I,C]=l,{batchSize:A,filterDepth:N,filterHeight:E,filterWidth:O,inChannels:$,inDepth:R,inHeight:D,inWidth:M,outChannels:P,outDepth:F,outHeight:L,outWidth:z,strideDepth:B,strideHeight:q,strideWidth:V}=h,W=N-1-h.padInfo.front,j=E-1-h.padInfo.top,U=O-1-h.padInfo.left;for(let G=0;G<A;++G)for(let t=0;t<$;++t)for(let e=0;e<R;++e){const n=e-W,s=Math.max(0,Math.ceil(n/B)),i=Math.min(F,(N+n)/B);for(let r=0;r<D;++r){const o=r-j,a=Math.max(0,Math.ceil(o/q)),u=Math.min(L,(E+o)/q);for(let c=0;c<M;++c){const l=c-U,h=Math.max(0,Math.ceil(l/V)),p=Math.min(z,(O+l)/V);let A=0;for(let e=s;e<i;++e){const s=e*B-n;for(let n=a;n<u;++n){const i=n*q-o;for(let r=h;r<p;++r){const o=r*V-l,a=v*G+w*e+x*n+_*r,u=S*(N-1-s)+T*(E-1-i)+I*(O-1-o)+C*t;for(let t=0;t<P;++t){const e=b[a+t],n=k[u+t];A+=e*n}}}}d[f*G+m*e+g*r+y*c+t]=A}}}return n.makeTensorInfo(p.shape,p.dtype,p.values)}const ZI={kernelName:Ht,backendName:"cpu",kernelFunc:YI},JI=GS(Kt,(t=>Math.cos(t))),tC={kernelName:Kt,backendName:"cpu",kernelFunc:JI},eC=GS(Xt,(t=>Math.cosh(t))),nC={kernelName:Xt,backendName:"cpu",kernelFunc:eC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function sC(t){const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:r,boxInd:o}=e,{cropSize:a,method:u,extrapolationValue:c}=s,[l,h,p,d]=i.shape,f=r.shape[0],[m,g]=a,y=fr([f,m,g,d],"float32"),b=n.data.get(r.dataId).values,v=n.data.get(o.dataId).values,w=n.data.get(i.dataId).values,x=G(i.shape),_=G(y.shape);for(let k=0;k<f;k++){const t=4*k,e=b[t],n=b[t+1],s=b[t+2],i=b[t+3],r=v[k];if(r>=l)continue;const o=m>1?(s-e)*(h-1)/(m-1):0,a=g>1?(i-n)*(p-1)/(g-1):0;for(let l=0;l<m;l++){const t=m>1?e*(h-1)+l*o:.5*(e+s)*(h-1);if(t<0||t>h-1)for(let e=0;e<g;e++)for(let t=0;t<d;t++){const n=t+e*_[2]+l*_[1]+k*_[0];y.values[n]=c}else if("bilinear"===u){const e=Math.floor(t),s=Math.ceil(t),o=t-e;for(let t=0;t<g;t++){const u=g>1?n*(p-1)+t*a:.5*(n+i)*(p-1);if(u<0||u>p-1){for(let e=0;e<d;e++){const n=e+t*_[2]+l*_[1]+k*_[0];y.values[n]=c}continue}const h=Math.floor(u),f=Math.ceil(u),m=u-h;for(let n=0;n<d;n++){let i=n+h*x[2]+e*x[1]+r*x[0];const a=w[i];i=n+f*x[2]+e*x[1]+r*x[0];const u=w[i];i=n+h*x[2]+s*x[1]+r*x[0];const c=w[i];i=n+f*x[2]+s*x[1]+r*x[0];const p=w[i],d=a+(u-a)*m,g=c+(p-c)*m;i=n+t*_[2]+l*_[1]+k*_[0],y.values[i]=d+(g-d)*o}}}else for(let e=0;e<g;++e){const s=g>1?n*(p-1)+e*a:.5*(n+i)*(p-1);if(s<0||s>p-1){for(let t=0;t<d;t++){const n=t+e*_[2]+l*_[1]+k*_[0];y.values[n]=c}continue}const o=Math.round(s),u=Math.round(t);for(let t=0;t<d;t++){const n=t+o*x[2]+u*x[1]+r*x[0],s=t+e*_[2]+l*_[1]+k*_[0];y.values[s]=w[n]}}}}return n.makeTensorInfo(y.shape,y.dtype,y.values)}const iC={kernelName:Yt,backendName:"cpu",kernelFunc:sC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rC(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s;WS(i,"cumsum");const u=Fu([r],i.shape.length);let c=i;null!=u&&(c=LT({inputs:{x:i},backend:n,attrs:{perm:u}}));const l=zu(1,i.shape.length)[0];if(l!==c.shape.length-1)throw new Error(`backend.cumsum in CPU expects an inner-most axis=${c.shape.length-1} but got axis=${l}`);const h=Zs(c.dtype,"int32"),p=Q(k(c.shape),h),d=n.data.get(c.dataId).values,f=c.shape[c.shape.length-1],m=a?(t,e)=>t+f-e-1:(t,e)=>t+e;for(let y=0;y<d.length;y+=f)for(let t=0;t<f;t++){const e=m(y,t);if(0===t)p[e]=o?0:d[e];else{const n=m(y,t-1);p[e]=o?d[n]+p[n]:d[e]+p[n]}}const g=n.makeTensorInfo(c.shape,h,p);if(null!=u){const t=Lu(u),e=LT({inputs:{x:g},backend:n,attrs:{perm:t}});return n.disposeIntermediateTensorInfo(g),n.disposeIntermediateTensorInfo(c),e}return g}const oC={kernelName:Qt,backendName:"cpu",kernelFunc:rC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function aC(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o,binaryOutput:a}=s;if(1===i.shape.length){const t=n.data.get(i.dataId).values,e=n.data.get(r.dataId).values,s=SI(t,e,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,s)}if(2===i.shape.length){const t=n.bufferSync(i),e=n.bufferSync(r),s=TI(t,e,o,a);return n.makeTensorInfo(s.shape,r.dtype,s.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const uC={kernelName:Zt,backendName:"cpu",kernelFunc:aC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cC(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:r,dataFormat:o}=s;v("NHWC"===o,(()=>`Only NHWC dataFormat supported on CPU for depthToSpace. Got ${o}`)),v(r>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${r}`));const a=i.shape[0],u=i.shape[1],c=i.shape[2],l=i.shape[3],h=u*r,p=c*r,d=l/(r*r),f=n.data.get(i.dataId).values,m=new Float32Array(a*h*p*d);let g=0;for(let y=0;y<a;++y)for(let t=0;t<h;++t){const e=Math.floor(t/r),n=t%r;for(let t=0;t<p;++t){const s=Math.floor(t/r),i=t%r,o=(n*r+i)*d;for(let t=0;t<d;++t){const n=t+o,i=n+l*(s+c*(e+u*y));m[g++]=f[i]}}}return n.makeTensorInfo([a,h,p,d],i.dtype,m)}const lC={kernelName:Jt,backendName:"cpu",kernelFunc:cC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hC(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:u,dimRoundingMode:c}=s;WS([i,r],"depthwiseConv2DNative");const l=G(i.shape),h=G(r.shape);let p=u;null==p&&(p=[1,1]),v(Wo(o,p),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${p}'`));const d=Oo(i.shape,r.shape,o,p,a,c,!0),{filterHeight:f,filterWidth:m,dilationHeight:g,dilationWidth:y,padInfo:b}=d,w=b.left,x=b.top,_=d.outChannels/d.inChannels,k=new Fs(d.outShape,i.dtype),S=n.data.get(i.dataId).values,T=n.data.get(r.dataId).values,I=k.values;for(let v=0;v<d.batchSize;++v){const t=v*l[0],e=v*k.strides[0];for(let n=0;n<d.outHeight;++n){const s=e+n*k.strides[1],i=n*d.strideHeight-w;for(let e=0;e<f;++e){const n=i+e*g;if(n<0||n>=d.inHeight)continue;const r=e*h[0],o=t+n*l[1];for(let t=0;t<d.outWidth;++t){const e=s+t*k.strides[2],n=t*d.strideWidth-x;for(let t=0;t<m;++t){const s=n+t*y;if(s<0||s>=d.inWidth)continue;const i=r+t*h[1],a=o+s*d.inChannels;let u=e,c=i;for(let t=0;t<d.inChannels;++t){const e=S[a+t];for(let t=0;t<_;++t)I[u+t]+=e*T[c+t];u+=_,c+=_}}}}}}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const pC={kernelName:te,backendName:"cpu",kernelFunc:hC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dC(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:c,filterShape:l}=s;WS([i,r],"depthwiseConv2dNativeBackpropFilter");const h=Oo(i.shape,l,o,a,u,c,!0),{strideHeight:p,strideWidth:d,filterHeight:f,filterWidth:m}=h,g=new Fs(h.filterShape,"float32"),y=h.padInfo.left,b=h.padInfo.top,v=h.outChannels/h.inChannels,w=n.data.get(i.dataId).values,x=new Fs(i.shape,i.dtype,w),_=n.data.get(r.dataId).values,k=new Fs(r.shape,r.dtype,_);for(let S=0;S<f;++S){const t=Math.max(0,Math.ceil((b-S)/p)),e=Math.min(h.outHeight,(h.inHeight+b-S)/p);for(let n=0;n<m;++n){const s=Math.max(0,Math.ceil((y-n)/d)),i=Math.min(h.outWidth,(h.inWidth+y-n)/d);for(let r=0;r<h.outChannels;++r){const o=Math.trunc(r/v),a=r%v;let u=0;for(let c=0;c<h.batchSize;++c)for(let a=t;a<e;++a){const t=S+a*p-b;for(let e=s;e<i;++e){const s=n+e*d-y;u+=x.get(c,t,s,o)*k.get(c,a,e,r)}}g.set(u,S,n,o,a)}}}return n.makeTensorInfo(g.shape,g.dtype,g.values)}const fC={kernelName:ee,backendName:"cpu",kernelFunc:dC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function mC(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:c,inputShape:l}=s;WS([i,r],"depthwiseConv2DNativeBackpropInput");const h=G(i.shape),p=G(r.shape),d=Oo(l,r.shape,o,a,u,c,!0),f=new Fs(d.inShape,"float32"),m=f.values,[g,y,b]=f.strides,v=n.data.get(i.dataId).values,[w,x,_]=h,k=n.data.get(r.dataId).values,[S,T,I]=p,{batchSize:C,filterHeight:A,filterWidth:N,inChannels:E,inHeight:O,inWidth:$,outChannels:R,outHeight:D,outWidth:M,strideHeight:P,strideWidth:F}=d,L=A-1-d.padInfo.top,z=N-1-d.padInfo.left,B=R/E;for(let q=0;q<C;++q)for(let t=0;t<E;++t)for(let e=0;e<O;++e){const n=e-L,s=Math.max(0,Math.ceil(n/P)),i=Math.min(D,(A+n)/P);for(let r=0;r<$;++r){const o=r-z,a=Math.max(0,Math.ceil(o/F)),u=Math.min(M,(N+o)/F);let c=0;for(let e=s;e<i;++e){const s=e*P-n;for(let n=a;n<u;++n){const i=n*F-o,r=w*q+x*e+_*n,a=S*(A-1-s)+T*(N-1-i)+I*t;for(let e=0;e<B;++e){const n=t*B+e,s=v[r+n],i=k[a+e];c+=s*i}}}m[g*q+y*e+b*r+t]=c}}return n.makeTensorInfo(f.shape,f.dtype,f.values)}const gC={kernelName:ne,backendName:"cpu",kernelFunc:mC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yC(t){const{inputs:e,backend:n}=t,{x:s}=e,i=k(s.shape),r=n.data.get(s.dataId).values,o=fr([i,i],s.dtype),a=o.values;for(let c=0;c<r.length;c++)a[c*i+c]=r[c];const u=[...s.shape,...s.shape];return n.makeTensorInfo(u,o.dtype,o.values)}const bC={kernelName:se,backendName:"cpu",kernelFunc:yC},vC={kernelName:ie,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i}=t,{strides:r,pad:o,dilations:a}=n,u=e,c=u.data.get(s.dataId).values,l=s.shape.length,h=u.data.get(i.dataId).values,p=i.shape.length,{batchSize:d,inHeight:f,inWidth:m,inChannels:g,outHeight:y,outWidth:b,padInfo:v,strideHeight:w,strideWidth:x,filterHeight:_,filterWidth:S,dilationHeight:T,dilationWidth:I,outShape:C}=Ao(s.shape,i.shape,r,o,"NHWC",a),A=k(C),N=C.length,E=R(s.dtype,A);for(let k=0;k<d;++k)for(let t=0;t<y;++t){const e=t*w-v.top;for(let n=0;n<b;++n){const r=n*x-v.left;for(let o=0;o<g;++o){let a=Number.MIN_SAFE_INTEGER;for(let t=0;t<_;++t){const n=e+t*T;if(n>=0&&n<f)for(let e=0;e<S;++e){const u=r+e*I;if(u>=0&&u<m){const r=J([k,n,u,o],l,G(s.shape)),d=J([t,e,o],p,G(i.shape)),f=c[r]+h[d];f>a&&(a=f)}}}const u=J([k,t,n,o],N,G(C));E[u]=a}}}const O=u.write(Rs(E,s.dtype),C,s.dtype);return{dataId:O,shape:C,dtype:s.dtype}}},wC={kernelName:oe,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:r}=t,{strides:o,pad:a,dilations:u}=n,c=e,l=K(s.shape,c.data.get(s.dataId).values),h=K(i.shape,c.data.get(i.dataId).values),{batchSize:p,inHeight:d,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:b,strideHeight:w,strideWidth:x,filterHeight:_,filterWidth:k,dilationHeight:S,dilationWidth:T,outShape:I}=Ao(s.shape,i.shape,o,a,"NHWC",u);v(r.rank===I.length,(()=>`Error in ${oe}, dy must have the same rank as output ${I.length}, but got ${r.rank}`));const C=K(I,c.data.get(r.dataId).values),A=Y(i.shape,i.dtype);for(let v=0;v<p;++v)for(let t=0;t<g;++t){const e=t*w-b.top;for(let n=0;n<y;++n){const s=n*x-b.left;for(let i=0;i<m;++i){let r=Number.MIN_SAFE_INTEGER,o=0,a=0;for(let t=0;t<_;++t){const n=e+t*S;if(n>=0&&n<d)for(let e=0;e<k;++e){const u=s+e*T;if(u>=0&&u<f){const s=l[v][n][u][i]+h[t][e][i];s>r&&(r=s,o=t,a=e)}}}A[o][a][i]+=C[v][t][n][i]}}}const N=c.write(Rs(A,s.dtype),i.shape,i.dtype);return{dataId:N,shape:i.shape,dtype:i.dtype}}},xC={kernelName:re,backendName:"cpu",kernelFunc:({inputs:t,backend:e,attrs:n})=>{const{x:s,filter:i,dy:r}=t,{strides:o,pad:a,dilations:u}=n,c=e,l=K(s.shape,c.data.get(s.dataId).values),h=K(i.shape,c.data.get(i.dataId).values),{batchSize:p,inHeight:d,inWidth:f,inChannels:m,outHeight:g,outWidth:y,padInfo:b,strideHeight:w,strideWidth:x,filterHeight:_,filterWidth:k,dilationHeight:S,dilationWidth:T,outShape:I}=Ao(s.shape,i.shape,o,a,"NHWC",u);v(r.rank===I.length,(()=>`Error in ${re}, dy must have the same rank as output ${I.length}, but got ${r.rank}`));const C=K(I,c.data.get(r.dataId).values),A=Y(s.shape,s.dtype);for(let v=0;v<p;++v)for(let t=0;t<g;++t){const e=t*w-b.top;for(let n=0;n<y;++n){const s=n*x-b.left;for(let i=0;i<m;++i){let r=Number.MIN_SAFE_INTEGER,o=e<0?0:e,a=s<0?0:s;for(let t=0;t<_;++t){const n=e+t*S;if(n>=0&&n<d)for(let e=0;e<k;++e){const u=s+e*T;if(u>=0&&u<f){const s=l[v][n][u][i]+h[t][e][i];s>r&&(r=s,o=n,a=u)}}}A[v][o][a][i]+=C[v][t][n][i]}}}const N=c.write(Rs(A,s.dtype),s.shape,s.dtype);return{dataId:N,shape:s.shape,dtype:s.dtype}}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _C(t){const{inputs:e,backend:n}=t,{dy:s,y:i}=e;WS([s,i],"eluGrad");const r=new Float32Array(k(i.shape)),o=n.data.get(i.dataId).values,a=n.data.get(s.dataId).values;for(let u=0;u<o.length;++u){const t=o[u];r[u]=t>=1?a[u]:a[u]*(t+1)}return n.makeTensorInfo(i.shape,"float32",r)}const kC={kernelName:ce,backendName:"cpu",kernelFunc:_C},SC=tT(((t,e)=>t===e?1:0)),TC=gT(he,SC,null,"bool"),IC={kernelName:he,backendName:"cpu",kernelFunc:TC},CC=Ip,AC=Cp,NC=Ap,EC=Np,OC=Ep,$C=Op,RC=GS(le,(t=>{const e=Math.sign(t),n=Math.abs(t),s=1/(1+CC*n);return e*(1-(((($C*s+OC)*s+EC)*s+NC)*s+AC)*s*Math.exp(-n*n))})),DC={kernelName:le,backendName:"cpu",kernelFunc:RC},MC=AI((t=>Math.exp(t))),PC=HS(pe,MC),FC={kernelName:pe,backendName:"cpu",kernelFunc:PC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function LC(t){const{inputs:e,backend:n,attrs:s}=t,{input:i}=e,{dim:r}=s,o=i.shape.length,a=i.shape.slice();let u=r;return r<0&&(v(-(o+1)<=r,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),u=o+r+1),a.splice(u,0,1),_T({inputs:{x:i},backend:n,attrs:{shape:a}})}const zC={kernelName:de,backendName:"cpu",kernelFunc:LC},BC=AI((t=>Math.expm1(t))),qC=HS(fe,BC),VC={kernelName:fe,backendName:"cpu",kernelFunc:qC},WC=tT(((t,e)=>t*e)),jC=yT(((t,e,n,s)=>({real:t*n-e*s,imag:t*s+e*n}))),UC=gT(nn,WC,jC),GC={kernelName:nn,backendName:"cpu",kernelFunc:UC},HC=tT(((t,e)=>t/e)),KC=gT(ae,HC),XC={kernelName:ae,backendName:"cpu",kernelFunc:KC},QC=tT(((t,e)=>t-e)),YC=yT(((t,e,n,s)=>({real:t-n,imag:e-s}))),ZC=gT(Un,QC,YC),JC={kernelName:Un,backendName:"cpu",kernelFunc:ZC};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tA(t,e,n){const s=t.shape,i=s[0],r=s[1],o=n.data.get(t.dataId),a=o.complexTensorInfos.real,u=o.complexTensorInfos.imag,c=[i,r],l=k(c),h=$("float32",l),p=$("float32",l);for(let g=0;g<i;g++){const t=wI({inputs:{x:a},backend:n,attrs:{begin:[g,0],size:[1,r]}}),s=wI({inputs:{x:u},backend:n,attrs:{begin:[g,0],size:[1,r]}}),i=cT({inputs:{real:t,imag:s},backend:n}),{real:o,imag:c}=eA(i,e,n),l=Dp(o,c);for(let e=0;e<r;e++){const t=Lp(l,e);h[g*r+e]=t.real,p[g*r+e]=t.imag}n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(s),n.disposeIntermediateTensorInfo(i)}const d=n.makeTensorInfo(c,"float32",h),f=n.makeTensorInfo(c,"float32",p),m=cT({inputs:{real:d,imag:f},backend:n});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),m}function eA(t,e,n){const s=k(t.shape),i=n.data.get(t.dataId),r=n.data.get(i.complexTensorInfos.real.dataId).values,o=n.data.get(i.complexTensorInfos.imag.dataId).values;if(nA(s)){const i=sA(r,o,s,e,n),a=[t.shape[0],t.shape[1]];if(e){const t=n.makeTensorInfo(a,"float32",i.real),e=n.makeTensorInfo(a,"float32",i.imag),r=n.makeTensorInfo([],"float32",Os(s,"float32")),o=QS({inputs:{x:r},backend:n}),u=XC.kernelFunc({inputs:{a:t,b:r},backend:n}),c=XC.kernelFunc({inputs:{a:e,b:o},backend:n}),l=n.data.get(u.dataId).values,h=n.data.get(c.dataId).values;return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),{real:l,imag:h}}return i}{const t=Dp(r,o),n=iA(t,s,e);return Mp(n)}}function nA(t){return 0===(t&t-1)}function sA(t,e,n,s,i){if(1===n)return{real:t,imag:e};const r=Dp(t,e),o=n/2,a=Pp(r),u=a.real,c=a.imag,l=[u.length],h=i.makeTensorInfo(l,"float32",u),p=i.makeTensorInfo(l,"float32",c),d=cT({inputs:{real:h,imag:p},backend:i}),f=Fp(r),m=f.real,g=f.imag,y=[m.length],b=i.makeTensorInfo(y,"float32",m),v=i.makeTensorInfo(y,"float32",g),w=cT({inputs:{real:b,imag:v},backend:i}),x=sA(u,c,o,s,i),_=x.real,k=x.imag,S=[_.length],T=i.makeTensorInfo(S,"float32",_),I=i.makeTensorInfo(S,"float32",k),C=cT({inputs:{real:T,imag:I},backend:i}),A=sA(m,g,o,s,i),N=A.real,E=A.imag,O=[N.length],$=i.makeTensorInfo(O,"float32",N),R=i.makeTensorInfo(O,"float32",E),D=cT({inputs:{real:$,imag:R},backend:i}),M=Bp(n,s),P=[M.real.length],F=i.makeTensorInfo(P,"float32",M.real),L=i.makeTensorInfo(P,"float32",M.imag),z=cT({inputs:{real:F,imag:L},backend:i}),B=UC({inputs:{a:z,b:D},backend:i}),q=wT({inputs:{a:C,b:B},backend:i}),V=ZC({inputs:{a:C,b:B},backend:i}),W=pT({inputs:{input:q},backend:i}),j=pT({inputs:{input:V},backend:i}),U=FI({inputs:{input:q},backend:i}),G=FI({inputs:{input:V},backend:i}),H=zI({inputs:[W,j],backend:i,attrs:{axis:0}}),K=zI({inputs:[U,G],backend:i,attrs:{axis:0}}),X=i.data.get(H.dataId).values,Q=i.data.get(K.dataId).values;return i.disposeIntermediateTensorInfo(h),i.disposeIntermediateTensorInfo(p),i.disposeIntermediateTensorInfo(d),i.disposeIntermediateTensorInfo(b),i.disposeIntermediateTensorInfo(v),i.disposeIntermediateTensorInfo(w),i.disposeIntermediateTensorInfo(T),i.disposeIntermediateTensorInfo(I),i.disposeIntermediateTensorInfo(C),i.disposeIntermediateTensorInfo($),i.disposeIntermediateTensorInfo(R),i.disposeIntermediateTensorInfo(D),i.disposeIntermediateTensorInfo(F),i.disposeIntermediateTensorInfo(L),i.disposeIntermediateTensorInfo(z),i.disposeIntermediateTensorInfo(B),i.disposeIntermediateTensorInfo(q),i.disposeIntermediateTensorInfo(V),i.disposeIntermediateTensorInfo(W),i.disposeIntermediateTensorInfo(U),i.disposeIntermediateTensorInfo(j),i.disposeIntermediateTensorInfo(G),i.disposeIntermediateTensorInfo(H),i.disposeIntermediateTensorInfo(K),{real:X,imag:Q}}function iA(t,e,n){const s=new Float32Array(2*e);for(let i=0;i<e;i++){let r=0,o=0;for(let s=0;s<e;s++){const a=qp(i*s,e,n),u=Lp(t,s);r+=u.real*a.real-u.imag*a.imag,o+=u.real*a.imag+u.imag*a.real}n&&(r/=e,o/=e),zp(s,r,o,i)}return s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rA(t){const{inputs:e,backend:n}=t,{input:s}=e,i=k(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=_T({inputs:{x:s},backend:n,attrs:{shape:[o,r]}}),u=tA(a,!1,n),c=_T({inputs:{x:u},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),c}const oA={kernelName:me,backendName:"cpu",kernelFunc:rA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function aA(t){const{backend:e,attrs:n}=t,{shape:s,value:i,dtype:r}=n,o=r||W(i),a=R(o,k(s));return cA(a,i,o),e.makeTensorInfo(s,o,a)}const uA={kernelName:ge,backendName:"cpu",kernelFunc:aA};function cA(t,e,n){t.fill(e)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const lA={kernelName:ye,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,i=n,r=$(s.dtype,k(s.shape)),[o,a,u,c]=s.shape,l=i.data.get(s.dataId).values;for(let p=0;p<o;p++){const t=p*u*a*c;for(let e=0;e<a;e++){const n=e*(u*c);for(let s=0;s<u;s++){const i=s*c;for(let a=0;a<c;a++){const h=[o,e,s,a],p=h[2],d=Math.round(u-p),f=t+n+i+a;let m=l[f];if(d>=0&&d<u){const e=d*c,s=t+n+e+a;m=l[s]}r[f]=m}}}}const h=i.write(r,s.shape,s.dtype);return{dataId:h,shape:s.shape,dtype:s.dtype}}},hA=AI((t=>Math.floor(t))),pA=HS(be,hA),dA={kernelName:be,backendName:"cpu",kernelFunc:pA},fA=tT(((t,e)=>Math.floor(t/e))),mA=gT(ve,fA,null,"int32"),gA={kernelName:ve,backendName:"cpu",kernelFunc:mA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yA(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p,activation:d,leakyreluAlpha:f}=s;let m=qI({inputs:{x:i,filter:r},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){const t=m;m=wT({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(t)}if(d){const t=m;m=uT(n,m,d,a,f),n.disposeIntermediateTensorInfo(t)}return m}const bA={kernelName:as,backendName:"cpu",kernelFunc:yA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vA(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p,activation:d,leakyreluAlpha:f}=s;let m=hC({inputs:{x:i,filter:r},backend:n,attrs:{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p}});if(o){const t=m;m=wT({inputs:{a:m,b:o},backend:n}),n.disposeIntermediateTensorInfo(t)}if(d){const t=m;m=uT(n,m,d,a,f),n.disposeIntermediateTensorInfo(t)}return m}const wA={kernelName:us,backendName:"cpu",kernelFunc:vA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xA(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,r=k(s.shape),o=i.shape,a=o[o.length-1],[u,c,l,h]=wp(s,i);if(0===c)return n.makeTensorInfo(u,s.dtype,[]);const p=fr([c,l],s.dtype),d=n.data.get(i.dataId).values,f=n.data.get(s.dataId).values;for(let m=0;m<c;m++){const t=[];let e=0;for(let n=0;n<a;n++){const s=d[m*a+n];e+=s*h[n],t.push(s)}if(e<0||e>=r/l)throw new Error(`Invalid indices: ${t} does not index into ${s.shape}`);for(let n=0;n<l;n++)p.values[m*l+n]=f[e*l+n]}return n.makeTensorInfo(u,p.dtype,p.values)}const _A={kernelName:_e,backendName:"cpu",kernelFunc:xA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kA(t,e,n){const s=fr(n,t.dtype);for(let i=0;i<s.size;++i){const n=s.indexToLoc(i),r=n.slice(),o=r[0],a=r[2],u=e.locToIndex([o,a]);r[2]=e.values[u];const c=t.locToIndex(r);s.values[i]=t.values[c]}return s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SA(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:r}=e,{axis:o,batchDims:a}=s;WS([i,r],"gatherV2");let u=a;null==a&&(u=0);const c=k(r.shape),l=E(o,i.shape)[0],h=Up(i,r,l,u),p=_T({inputs:{x:i},backend:n,attrs:{shape:[h.batchSize,h.outerSize,h.dimSize,h.sliceSize]}}),d=_T({inputs:{x:r},backend:n,attrs:{shape:[h.batchSize,c/h.batchSize]}}),f=[h.batchSize,h.outerSize,c/h.batchSize,h.sliceSize],m=n.bufferSync(d),g=n.bufferSync(p),y=kA(g,m,f);return n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.makeTensorInfo(h.outputShape,y.dtype,y.values)}const TA={kernelName:xe,backendName:"cpu",kernelFunc:SA},IA=tT(((t,e)=>t>e?1:0)),CA=gT(ke,IA,null,"bool"),AA={kernelName:ke,backendName:"cpu",kernelFunc:CA},NA=tT(((t,e)=>t>=e?1:0)),EA=gT(Se,NA,null,"bool"),OA={kernelName:Se,backendName:"cpu",kernelFunc:EA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $A(t){const{inputs:e,backend:n}=t,{input:s}=e,i=k(s.shape),r=s.shape[s.shape.length-1],o=i/r,a=_T({inputs:{x:s},backend:n,attrs:{shape:[o,r]}}),u=tA(a,!0,n),c=_T({inputs:{x:u},backend:n,attrs:{shape:s.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(u),c}const RA={kernelName:Ie,backendName:"cpu",kernelFunc:$A},DA=GS(Ae,(t=>Number.isFinite(t)?1:0),"bool"),MA={kernelName:Ae,backendName:"cpu",kernelFunc:DA},PA=GS(Ne,(t=>Math.abs(t)===1/0?1:0),"bool"),FA={kernelName:Ne,backendName:"cpu",kernelFunc:PA},LA=GS(Ee,(t=>Number.isNaN(t)?1:0),"bool"),zA={kernelName:Ee,backendName:"cpu",kernelFunc:LA},BA=tT(((t,e)=>t<e?1:0)),qA=gT($e,BA,null,"bool"),VA={kernelName:$e,backendName:"cpu",kernelFunc:qA},WA=tT(((t,e)=>t<=e?1:0)),jA=gT(Re,WA,null,"bool"),UA={kernelName:Re,backendName:"cpu",kernelFunc:jA};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GA(t,e,n){const s=(e-t)/(n-1),i=Q(n,"float32");i[0]=t;for(let r=1;r<i.length;r++)i[r]=i[r-1]+s;return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function HA(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:r}=n,o=GA(s,i,r);return e.makeTensorInfo([o.length],"float32",o)}const KA={kernelName:De,backendName:"cpu",kernelFunc:HA},XA=AI((t=>Math.log(t))),QA=HS(Me,XA),YA={kernelName:Me,backendName:"cpu",kernelFunc:QA},ZA=GS(Pe,(t=>Math.log1p(t))),JA={kernelName:Pe,backendName:"cpu",kernelFunc:ZA},tN=tT(((t,e)=>t&&e)),eN=gT(Fe,tN,null,"bool"),nN={kernelName:Fe,backendName:"cpu",kernelFunc:eN},sN=GS(Le,(t=>t?0:1),"bool"),iN={kernelName:Le,backendName:"cpu",kernelFunc:sN},rN=tT(((t,e)=>t||e)),oN=gT(ze,rN,null,"bool"),aN={kernelName:ze,backendName:"cpu",kernelFunc:oN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:r,bias:o,alpha:a,beta:u}=s;WS(i,"LRN");const c=i.shape[3],l=c-1,h=n.data.get(i.dataId).values,p=k(i.shape),d=new Float32Array(p);function f(t){const e=t%c;let n=t-e+Math.max(0,e-r);const s=t-e+Math.min(e+r,l);let i=0;for(;n<=s;n++){const t=h[n];i+=t*t}return i}for(let m=0;m<p;m++){const t=f(m),e=h[m]*Math.pow(o+a*t,-u);d[m]=e}return n.makeTensorInfo(i.shape,i.dtype,d)}const cN={kernelName:qe,backendName:"cpu",kernelFunc:uN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,y:r,dy:o}=e,{depthRadius:a,bias:u,alpha:c,beta:l}=s;WS(o,"LRNGrad");const h=k(o.shape),p=o.shape[3],d=n.data.get(o.dataId).values,f=n.data.get(i.dataId).values,m=n.data.get(r.dataId).values,g=new Float32Array(h),y=h;for(let b=0;b<y;b++){const t=b%p,e=b-t+Math.max(0,t-a),n=b-t+Math.min(p,t+a+1);let s=0;for(let i=e;i<n;i++)s+=Math.pow(f[i],2);s=c*s+u;for(let i=e;i<n;i++){let t=-2*c*l*f[i]*m[b]/s;b===i&&(t+=Math.pow(s,-l)),t*=d[b],g[i]+=t}}return n.makeTensorInfo(o.shape,i.dtype,g)}const hN={kernelName:Ve,backendName:"cpu",kernelFunc:lN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pN(t,e,n,s){const i=$(s,k(n));for(let r=0;r<i.length;++r){const n=r*e;let s=t[n];for(let i=0;i<e;++i){const e=t[n+i];e>s&&(s=e)}i[r]=s}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function dN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:r,keepDims:o}=s,a=n;let u=i.shape;const c=u.length,l=E(r,u);let h=l;const p=Fu(h,c);let d=a.data.get(i.dataId).values;if(null!=p){const t=new Array(c);for(let e=0;e<t.length;e++)t[e]=u[p[e]];d=FT(d,u,i.dtype,p,t),h=zu(h.length,c),u=t}WS(i,"max"),Pu("max",h,c);const[f,m]=Du(u,h),g=k(m),y=pN(d,g,f,i.dtype),b=a.write(y,f,i.dtype);let v=f;if(o){const t=Mu(f,l);v=t}return{dataId:b,shape:v,dtype:i.dtype}}const fN={kernelName:We,backendName:"cpu",kernelFunc:dN},mN=tT(((t,e)=>Math.max(t,e))),gN=gT(je,mN),yN={kernelName:je,backendName:"cpu",kernelFunc:gN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function bN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;WS(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:u}=s,c=1;v(Wo(o,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const l=No(i.shape,r,o,c,a,u);let h;if(1===l.filterWidth&&1===l.filterHeight&&S(l.inShape,l.outShape))h=QS({inputs:{x:i},backend:n});else{const t=n.data.get(i.dataId).values,e=G(i.shape),s=rI(t,i.shape,i.dtype,e,l,"max");h=n.makeTensorInfo(l.outShape,i.dtype,s.values)}return h}const vN={kernelName:Ue,backendName:"cpu",kernelFunc:bN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function wN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:u,dataFormat:c,dilations:l}=s;WS(i,"maxPool3d");let h=l;null==h&&(h=[1,1,1]);const p=Eo(i.shape,r,o,h,a,u,c),d=n.data.get(i.dataId).values,f=aI(d,i.shape,i.dtype,G(i.shape),p,"max");return n.makeTensorInfo(f.shape,"float32",f.values)}const xN={kernelName:He,backendName:"cpu",kernelFunc:wN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _N(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,{filterSize:o,strides:a,pad:u,dilations:c,dimRoundingMode:l}=s;WS([i,r],"maxPool3DGrad");const h=Eo(r.shape,o,a,c,u,l),p=n.bufferSync(r),d=uI(p,h),f=h.strideDepth,m=h.strideHeight,g=h.strideWidth,y=h.dilationDepth,b=h.dilationHeight,v=h.dilationWidth,w=h.effectiveFilterDepth,x=h.effectiveFilterHeight,_=h.effectiveFilterWidth,k=w-1-h.padInfo.front,S=_-1-h.padInfo.left,T=x-1-h.padInfo.top,I=fr(r.shape,"float32"),C=n.bufferSync(i);for(let A=0;A<h.batchSize;++A)for(let t=0;t<h.inChannels;++t)for(let e=0;e<h.inDepth;++e)for(let n=0;n<h.inHeight;++n)for(let s=0;s<h.inWidth;++s){const i=e-k,r=n-T,o=s-S;let a=0;for(let e=0;e<w;e+=y){const n=(i+e)/f;if(!(n<0||n>=h.outDepth||Math.floor(n)!==n))for(let s=0;s<x;s+=b){const i=(r+s)/m;if(!(i<0||i>=h.outHeight||Math.floor(i)!==i))for(let r=0;r<_;r+=v){const u=(o+r)/g;if(u<0||u>=h.outWidth||Math.floor(u)!==u)continue;const c=w*x*_-1-d.get(A,n,i,u,t),l=e*x*_+s*_+r,p=c===l?1:0;if(0===p)continue;const f=C.get(A,n,i,u,t);a+=f*p}}}I.set(a,A,e,n,s,t)}return n.makeTensorInfo(I.shape,I.dtype,I.values)}const kN={kernelName:Ke,backendName:"cpu",kernelFunc:_N};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SN(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r,output:o}=e,a=r;WS([r,o],"maxPoolGrad");const{filterSize:u,strides:c,pad:l,dimRoundingMode:h}=s,p=No(a.shape,u,c,1,l,h),d=n.data.get(a.dataId).values,f=fr(p.outShape,a.dtype,oI(d,a.shape,a.dtype,p).values),m=p.strideHeight,g=p.strideWidth,y=p.dilationHeight,b=p.dilationWidth,v=p.effectiveFilterHeight,w=p.effectiveFilterWidth,x=w-1-p.padInfo.left,_=v-1-p.padInfo.top,k=fr(a.shape,"float32"),S=n.data.get(i.dataId).values,T=fr(i.shape,"float32",S);for(let I=0;I<p.batchSize;++I)for(let t=0;t<p.inChannels;++t)for(let e=0;e<p.inHeight;++e)for(let n=0;n<p.inWidth;++n){const s=e-_,i=n-x;let r=0;for(let e=0;e<v;e+=y){const n=(s+e)/m;if(!(n<0||n>=p.outHeight||Math.floor(n)!==n))for(let s=0;s<w;s+=b){const o=(i+s)/g;if(o<0||o>=p.outWidth||Math.floor(o)!==o)continue;const a=v*w-1-f.get(I,n,o,t),u=e*w+s,c=a===u?1:0;if(0===c)continue;const l=T.get(I,n,o,t);r+=l*c}}k.set(r,I,e,n,t)}return n.makeTensorInfo(k.shape,k.dtype,k.values)}const TN={kernelName:Ge,backendName:"cpu",kernelFunc:SN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IN(t,e,n,s,i){const r=G(e),o=rI(t,e,n,r,i,"max"),a=oI(t,e,n,i,!0,s);return[o.values,a.values]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const CN={kernelName:Xe,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=e,u=n;WS(s,"MaxPoolWithArgmax");const c=u.data.get(s.dataId).values,l=No(s.shape,i,r,[1,1],o),[h,p]=IN(c,s.shape,s.dtype,a,l),d=u.write(h,l.outShape,s.dtype),f=u.write(p,l.outShape,s.dtype);return[{dataId:d,shape:l.outShape,dtype:s.dtype},{dataId:f,shape:l.outShape,dtype:"int32"}]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function AN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;let a;WS(i,"sum"),a="bool"===i.dtype?fT({inputs:{x:i},backend:n,attrs:{dtype:"int32"}}):QS({inputs:{x:i},backend:n});const u=a.shape.length,c=E(r,a.shape),l=Fu(c,u);let h=c,p=a;null!=l&&(p=LT({inputs:{x:a},backend:n,attrs:{perm:l}}),h=zu(h.length,u)),Pu("sum",h,p.shape.length);const[d,f]=Du(p.shape,h),m=Zs(p.dtype,"int32");let g=hT(n,d,m);const y=k(f),b=n.data.get(g.dataId).values,v=n.data.get(p.dataId).values;for(let w=0;w<b.length;++w){const t=w*y;let e=0;for(let n=0;n<y;++n)e+=v[t+n];b[w]=e}if(o){const t=Mu(g.shape,c),e=g;g=_T({inputs:{x:g},backend:n,attrs:{shape:t}}),n.disposeIntermediateTensorInfo(e)}return n.disposeIntermediateTensorInfo(a),null!=l&&n.disposeIntermediateTensorInfo(p),g}const NN={kernelName:zn,backendName:"cpu",kernelFunc:AN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function EN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=E(r,i.shape),u=Du(i.shape,a),c=u[1],l=k(c),h=[],p=n.makeTensorInfo([],"float32",new Float32Array([l]));h.push(p);const d=fT({inputs:{x:i},backend:n,attrs:{dtype:"float32"}});h.push(d);const f=KC({inputs:{a:d,b:p},backend:n});h.push(f);const m=AN({inputs:{x:f},backend:n,attrs:{axis:r,keepDims:o}});return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),m}const ON={kernelName:Qe,backendName:"cpu",kernelFunc:EN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $N(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;WS(i,"min");const a=E(r,i.shape);let u=a;const c=Fu(u,i.shape.length);let l=i;null!=c&&(l=LT({inputs:{x:i},backend:n,attrs:{perm:c}}),u=zu(u.length,i.shape.length)),Pu("min",u,l.shape.length);const[h,p]=Du(l.shape,u),d=k(p),f=Q(k(h),l.dtype),m=n.data.get(l.dataId).values;for(let y=0;y<f.length;++y){const t=y*d;let e=m[t];for(let n=0;n<d;++n){const s=m[t+n];s<e&&(e=s)}f[y]=e}null!=c&&n.disposeIntermediateTensorInfo(l);const g=n.makeTensorInfo(h,l.dtype,f);if(o){const t=Mu(h,a),e=_T({inputs:{x:g},backend:n,attrs:{shape:t}});return n.disposeIntermediateTensorInfo(g),e}return g}const RN={kernelName:Ye,backendName:"cpu",kernelFunc:$N},DN=tT(((t,e)=>Math.min(t,e))),MN=gT(Ze,DN),PN={kernelName:Ze,backendName:"cpu",kernelFunc:MN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FN(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,mode:o}=s;WS(i,"mirrorPad");const a=r.map(((t,e)=>t[0]+i.shape[e]+t[1])),u=r.map((t=>t[0])),c=r.map(((t,e)=>t[0]+i.shape[e])),l="reflect"===o?0:1,h=n.data.get(i.dataId).values,p=i.shape.length,d=G(i.shape),f=k(a),m=a.length,g=G(a),y=$(i.dtype,f);for(let v=0;v<f;v++){let t=tt(v,m,g);for(let n=0;n<m;n++)t[n]<u[n]?t[n]=2*u[n]-t[n]-l:t[n]>=c[n]&&(t[n]=2*(c[n]-1)-t[n]+l);t=t.map(((t,e)=>t-u[e]));const e=J(t,p,d);y[v]=h[e]}const b=n.write(y,a,i.dtype);return{dataId:b,shape:a,dtype:i.dtype}}const LN={kernelName:Je,backendName:"cpu",kernelFunc:FN},zN=tT(((t,e)=>{const n=t%e;return t<0&&e<0||t>=0&&e>=0?n:(n+e)%e})),BN=gT(tn,zN),qN={kernelName:tn,backendName:"cpu",kernelFunc:BN};var VN=n(733);
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function WN(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:r}=s,o=i.shape.length;let a=r;if(-1===a&&(a=o-1),a!==o-1)throw Error(`Softmax along a non-last dimension is not yet supported. Logits was rank ${o} and dim was ${a}`);const u=E([a],i.shape),c=dN({inputs:{x:i},backend:n,attrs:{reductionIndices:u,keepDims:!1}}),l=Mu(c.shape,u),h=_T({inputs:{x:c},backend:n,attrs:{shape:l}}),p=ZC({inputs:{a:i,b:h},backend:n}),d=PC({inputs:{x:p},backend:n}),f=AN({inputs:{x:d},backend:n,attrs:{axis:u,keepDims:!1}}),m=_T({inputs:{x:f},backend:n,attrs:{shape:l}}),g=KC({inputs:{a:d,b:m},backend:n});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(m),g}const jN={kernelName:Vn,backendName:"cpu",kernelFunc:WN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function UN(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:r,seed:o,normalized:a}=s;WS(i,"multinomial");const u=a?i:WN({inputs:{logits:i},backend:n,attrs:{dim:-1}}),c=u.shape[0],l=u.shape[1],h=n.data.get(u.dataId).values,p=[c,r],d=Q(k(p),"int32");for(let f=0;f<c;++f){const t=f*l,e=new Float32Array(l-1);e[0]=h[t];for(let i=1;i<e.length;++i)e[i]=e[i-1]+h[t+i];const n=VN.alea(o.toString()),s=f*r;for(let i=0;i<r;++i){const t=n();d[s+i]=e.length;for(let n=0;n<e.length;n++)if(t<e[n]){d[s+i]=n;break}}}return a||n.disposeIntermediateTensorInfo(u),n.makeTensorInfo(p,"int32",d)}const GN={kernelName:en,backendName:"cpu",kernelFunc:UN};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function HN(t,e,n){const s=Os(-1,n);return WC([],e,s,t,n)}function KN(t){const{inputs:e,backend:n}=t,{x:s}=e;WS(s,"neg");const i=n.data.get(s.dataId).values,[r,o]=HN(i,s.shape,s.dtype);return n.makeTensorInfo(o,s.dtype,r)}const XN={kernelName:sn,backendName:"cpu",kernelFunc:KN},QN=rh;function YN(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=s;WS(i,"NonMaxSuppression");const c=n.data.get(i.dataId).values,l=n.data.get(r.dataId).values,{selectedIndices:h}=QN(c,l,o,a,u);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const ZN={kernelName:on,backendName:"cpu",kernelFunc:YN},JN=oh;function tE(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=s;WS(i,"NonMaxSuppressionPadded");const l=n.data.get(i.dataId).values,h=n.data.get(r.dataId).values,{selectedIndices:p,validOutputs:d}=JN(l,h,o,a,u,c);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const eE={kernelName:an,backendName:"cpu",kernelFunc:tE},nE=ah;function sE(t){const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=s;WS(i,"NonMaxSuppressionWithScore");const l=n.data.get(i.dataId).values,h=n.data.get(r.dataId).values,p=o,d=a,f=u,m=c,{selectedIndices:g,selectedScores:y}=nE(l,h,p,d,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const iE={kernelName:un,backendName:"cpu",kernelFunc:sE},rE=tT(((t,e)=>t!==e?1:0)),oE=gT(rn,rE,null,"bool"),aE={kernelName:rn,backendName:"cpu",kernelFunc:oE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uE(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{depth:r,onValue:o,offValue:a}=s;WS(i,"oneHot");const u=k(i.shape),c=new Float32Array(u*r);c.fill(a);const l=n.data.get(i.dataId).values;for(let h=0;h<u;++h)l[h]>=0&&l[h]<r&&(c[h*r+l[h]]=o);return n.makeTensorInfo([...i.shape,r],"int32",c)}const cE={kernelName:ln,backendName:"cpu",kernelFunc:uE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lE(t){const{inputs:e,backend:n}=t,{x:s}=e;if("string"===s.dtype)throw new Error("zerosLike is not supported for string tensors");if("complex64"===s.dtype){const t=pT({inputs:{input:s},backend:n}),e=lE({inputs:{x:t},backend:n}),i=FI({inputs:{input:s},backend:n}),r=lE({inputs:{x:i},backend:n}),o=cT({inputs:{real:e,imag:r},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),o}return aA({backend:n,attrs:{shape:s.shape,value:0,dtype:s.dtype}})}const hE={kernelName:ns,backendName:"cpu",kernelFunc:lE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pE(t){const{inputs:e,backend:n}=t,{x:s}=e;if("string"===s.dtype)throw new Error("onesLike is not supported for string tensors");if("complex64"===s.dtype){const t=pT({inputs:{input:s},backend:n}),e=pE({inputs:{x:t},backend:n}),i=FI({inputs:{input:s},backend:n}),r=lE({inputs:{x:i},backend:n}),o=cT({inputs:{real:e,imag:r},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),o}return aA({backend:n,attrs:{shape:s.shape,value:1,dtype:s.dtype}})}const dE={kernelName:cn,backendName:"cpu",kernelFunc:pE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fE(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(1===e.length)return LC({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const r=e[0].shape,o=e[0].dtype;e.forEach((t=>{w(r,t.shape,"All tensors passed to stack must have matching shapes"),v(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],u=e.map((t=>{const e=LC({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),c=zI({inputs:u,backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}const mE={kernelName:hn,backendName:"cpu",kernelFunc:fE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gE(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,constantValue:o}=s;WS(i,"pad");const a=r.map(((t,e)=>t[0]+i.shape[e]+t[1])),u=r.map((t=>t[0])),c=n.data.get(i.dataId).values,l=k(i.shape),h=i.shape.length,p=G(i.shape),d=k(a),f=a.length,m=G(a),g=$(i.dtype,d);0!==o&&g.fill(o);for(let b=0;b<l;b++){const t=tt(b,h,p),e=t.map(((t,e)=>t+u[e])),n=J(e,f,m);g[n]=c[b]}const y=n.write(g,a,i.dtype);return{dataId:y,shape:a,dtype:i.dtype}}const yE={kernelName:pn,backendName:"cpu",kernelFunc:gE},bE=tT(((t,e)=>Math.pow(t,e))),vE=gT(dn,bE),wE={kernelName:dn,backendName:"cpu",kernelFunc:vE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xE(t,e,n,s){const[i,r]=Du(t,s),o=Zs(e,"int32"),a=Q(k(i),o),u=k(r);for(let c=0;c<a.length;++c){const t=c*u;let e=1;for(let s=0;s<u;++s)e*=n[t+s];a[c]=e}return{outVals:a,outShape:i,outDtype:o}}function _E(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;WS(i,"prod");const a=i.shape.length,u=E(r,i.shape),c=Fu(u,a);let l=u,h=i;const p=[];null!=c&&(h=LT({inputs:{x:i},backend:n,attrs:{perm:c}}),p.push(h),l=zu(l.length,a));const d=n.data.get(h.dataId).values,{outVals:f,outShape:m,outDtype:g}=xE(h.shape,h.dtype,d,l);let y=m;return o&&(y=Mu(m,u)),p.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(y,g,f)}const kE={kernelName:mn,backendName:"cpu",kernelFunc:_E};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SE(t,e,n,s){const i=t===e,r=t<e&&n<0,o=e<t&&n>1;if(i||r||o)return Q(0,s);const a=Math.abs(Math.ceil((e-t)/n)),u=Q(a,s);e<t&&1===n&&(n=-1),u[0]=t;for(let c=1;c<u.length;c++)u[c]=u[c-1]+n;return u}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function TE(t){const{backend:e,attrs:n}=t,{start:s,stop:i,dtype:r,step:o}=n,a=SE(s,i,o,r);return e.makeTensorInfo([a.length],r,a)}const IE={kernelName:gn,backendName:"cpu",kernelFunc:TE},CE=GS(bn,(t=>1/t)),AE={kernelName:bn,backendName:"cpu",kernelFunc:CE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function NE(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s;WS(i,"resizeBilinear");const u=G(i.shape),[c,l]=a,[h,p,d,f]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(k([h,c,l,f])),y=[r&&c>1?p-1:p,r&&l>1?d-1:d],b=[r&&c>1?c-1:c,r&&l>1?l-1:l];let v=0;const w=y[0]/b[0],x=y[1]/b[1];for(let _=0;_<h;_++)for(let t=0;t<c;t++){let e;e=o?w*(t+.5)-.5:w*t;const n=Math.max(0,Math.floor(e)),s=e-n,i=Math.min(p-1,Math.ceil(e)),r=_*u[0]+n*u[1],a=_*u[0]+i*u[1];for(let t=0;t<l;t++){let e;e=o?x*(t+.5)-.5:x*t;const n=Math.max(0,Math.floor(e)),i=e-n,c=Math.min(d-1,Math.ceil(e)),l=r+n*u[2],h=a+n*u[2],p=r+c*u[2],y=a+c*u[2];for(let t=0;t<f;t++){const e=m[l+t],n=m[h+t],r=m[p+t],o=m[y+t],a=e+(r-e)*i,u=n+(o-n)*i,c=a+(u-a)*s;g[v++]=c}}}return n.makeTensorInfo([h,c,l,f],"float32",g)}const EE={kernelName:kn,backendName:"cpu",kernelFunc:NE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function OE(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s;WS([r,i],"resizeBilinearGrad");const a=G(i.shape),[u,c,l,h]=i.shape,[,p,d]=r.shape,f=new Float32Array(u*c*l*h),m=[o&&p>1?c-1:c,o&&d>1?l-1:l],g=[o&&p>1?p-1:p,o&&d>1?d-1:d],y=m[0]/g[0],b=m[1]/g[1],v=n.data.get(r.dataId).values;let w=0;for(let x=0;x<u;x++){const t=x*a[0];for(let e=0;e<p;e++){const n=e*y,s=Math.floor(n),i=Math.min(Math.ceil(n),c-1),r=t+s*a[1],o=t+i*a[1],u=n-s,p=1-u;for(let t=0;t<d;t++){const e=t*b,n=Math.floor(e),s=Math.min(Math.ceil(e),l-1),i=e-n,c=1-i,d=r+n*a[2],m=r+s*a[2],g=o+n*a[2],y=o+s*a[2],x=p*c,_=p*i,k=u*c,S=u*i;for(let t=0;t<h;t++){const e=v[w++];f[d+t]+=e*x,f[m+t]+=e*_,f[g+t]+=e*k,f[y+t]+=e*S}}}}return n.makeTensorInfo([u,l,c,h],"float32",f)}const $E={kernelName:Sn,backendName:"cpu",kernelFunc:OE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function RE(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s;WS(i,"resizeNearestNeighbor");const u=G(i.shape),[c,l]=a,[h,p,d,f]=i.shape,m=n.data.get(i.dataId).values,g=new Float32Array(h*c*l*f),y=[r&&c>1?p-1:p,r&&l>1?d-1:d],b=[r&&c>1?c-1:c,r&&l>1?l-1:l],v=y[0]/b[0],w=y[1]/b[1];let x=0;for(let _=0;_<h;_++){const t=_*u[0];for(let e=0;e<c;e++){const n=o?v*(e+.5):v*e;let s=Math.min(p-1,r?Math.round(n):Math.floor(n));o&&(s=Math.max(0,s));const i=t+s*u[1];for(let t=0;t<l;t++){const e=o?w*(t+.5):w*t;let n=Math.min(d-1,r?Math.round(e):Math.floor(e));o&&(n=Math.max(0,n));const s=i+n*u[2];for(let t=0;t<f;t++){const e=m[s+t];g[x++]=e}}}}return n.makeTensorInfo([h,c,l,f],i.dtype,g)}const DE={kernelName:xn,backendName:"cpu",kernelFunc:RE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ME(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s;WS([r,i],"resizeNearestNeighborGrad");const a=G(i.shape),u=G(r.shape),[c,l,h,p]=i.shape,[,d,f]=r.shape,m=new Float32Array(c*l*h*p),g=n.data.get(r.dataId).values,y=[o&&d>1?l-1:l,o&&f>1?h-1:h],b=[o&&d>1?d-1:d,o&&f>1?f-1:f],v=y[0]/b[0],w=y[1]/b[1],x=1/v,_=1/w,k=2*Math.ceil(x)+2,S=2*Math.ceil(_)+2;for(let T=0;T<c;T++){const t=T*a[0];for(let e=0;e<l;e++){const n=t+e*a[1],s=Math.floor(e*x),i=Math.floor(s-k/2);for(let r=0;r<h;r++){const s=n+r*a[2],c=Math.floor(r*_),y=Math.floor(c-S/2);for(let n=0;n<p;n++){let a=0;for(let s=0;s<k;s++){const c=s+i;if(c<0||c>=d)continue;const p=t+c*u[1],m=c*v,b=Math.min(l-1,o?Math.round(m):Math.floor(m));if(e===b)for(let t=0;t<S;t++){const e=t+y;if(e<0||e>=f)continue;const s=p+e*u[2],i=e*w,c=Math.min(h-1,o?Math.round(i):Math.floor(i));r===c&&(a+=g[s+n])}}m[s+n]=a}}}}return n.makeTensorInfo(i.shape,i.dtype,m)}const PE={kernelName:_n,backendName:"cpu",kernelFunc:ME};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FE(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:r}=s;WS(i,"reverse");const o=i.shape.length,a=E(r,i.shape);if(0===o)return QS({inputs:{x:i},backend:n});const u=new Fs(i.shape,i.dtype),c=n.bufferSync(i);for(let l=0;l<u.size;l++){const t=u.indexToLoc(l),e=t.slice();a.forEach((t=>e[t]=i.shape[t]-1-e[t])),u.set(c.get(...e),...t)}return n.makeTensorInfo(u.shape,u.dtype,u.values)}const LE={kernelName:In,backendName:"cpu",kernelFunc:FE},zE={kernelName:rs,backendName:"cpu",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:r,center:o}=e,a=n,u=$(s.dtype,k(s.shape)),[c,l,h,p]=s.shape,[d,f]=fp(o,l,h),m=255,g=Math.sin(i),y=Math.cos(i),b=a.data.get(s.dataId).values;for(let w=0;w<c;w++){const t=w*h*l*p;for(let e=0;e<l;e++){const n=e*(h*p);for(let s=0;s<h;s++){const i=s*p;for(let o=0;o<p;o++){const a=[c,e,s,o],v=a[2],w=a[1];let x=(v-d)*y-(w-f)*g,_=(v-d)*g+(w-f)*y;x=Math.round(x+d),_=Math.round(_+f);let k=r;if("number"!==typeof r&&(k=3===o?m:r[o]),x>=0&&x<h&&_>=0&&_<l){const e=_*(h*p),n=x*p,s=t+e+n+o;k=b[s]}const S=t+n+i+o;u[S]=k}}}}const v=a.write(u,s.shape,s.dtype);return{dataId:v,shape:s.shape,dtype:s.dtype}}},BE=GS(Cn,(t=>{const e=Math.floor(t);return t-e<.5?Math.floor(t):t-e>.5?Math.ceil(t):e%2===0?e:e+1})),qE={kernelName:Cn,backendName:"cpu",kernelFunc:BE},VE=AI((t=>1/Math.sqrt(t))),WE=HS(An,VE),jE={kernelName:An,backendName:"cpu",kernelFunc:WE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function UE(t,e,n,s,i,r,o,a,u,c){const l=[s/i,i],h=t.values,p=e.values;if(0===s)return fr(n,e.dtype);const d=fr(l,e.dtype);d.values.fill(u);for(let f=0;f<r;f++){const t=[];let r=0;for(let e=0;e<o;e++){const n=h[f*o+e];t.push(n),r+=n*a[e]}if(r<0||r>=s/i)throw new Error(`Invalid indices: ${t} does not index into ${n}`);for(let n=0;n<i;n++)c?d.values[r*i+n]+=p[f*i+n]:d.values[r*i+n]=0===e.rank?p[0]:p[f*i+n]}return d}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GE(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:r}=e,{shape:o}=s,{sliceRank:a,numUpdates:u,sliceSize:c,strides:l,outputSize:h}=kp(r,i,o),p=!0,d=n.bufferSync(i),f=n.bufferSync(r),m=UE(d,f,o,h,c,u,a,l,0,p);return n.makeTensorInfo(o,m.dtype,m.values)}const HE={kernelName:Nn,backendName:"cpu",kernelFunc:GE};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function KE(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:r}=e;WS([s,i,r],"select");const o=s.shape.length,a=n.data.get(s.dataId).values,u=n.data.get(i.dataId).values,c=n.data.get(r.dataId).values,l=Zs(i.dtype,r.dtype),h=Q(k(i.shape),l);let p=0;const d=0===o||o>1||1===i.shape.length?1:k(i.shape.slice(1));for(let f=0;f<a.length;f++)for(let t=0;t<d;t++)1===a[f]?h[p++]=u[f]:h[p++]=c[f];return n.makeTensorInfo(i.shape,l,h)}const XE={kernelName:En,backendName:"cpu",kernelFunc:KE},QE=Sp,YE=Tp,ZE=GS(On,(t=>t>=0?YE*t:QE*(Math.exp(t)-1))),JE={kernelName:On,backendName:"cpu",kernelFunc:ZE},tO=GS(Pn,(t=>1/(1+Math.exp(-t)))),eO={kernelName:Pn,backendName:"cpu",kernelFunc:tO},nO=GS(Mn,(t=>t<0?-1:t>0?1:0)),sO={kernelName:Mn,backendName:"cpu",kernelFunc:nO},iO=GS(Rn,(t=>Math.sin(t))),rO={kernelName:Rn,backendName:"cpu",kernelFunc:iO},oO=GS(Dn,(t=>Math.sinh(t))),aO={kernelName:Dn,backendName:"cpu",kernelFunc:oO},uO=1.1920928955078125e-7,cO=Math.log(uO)+2,lO=GS(Fn,(t=>{const e=t>-cO,n=t<cO,s=Math.exp(t);let i;return i=n?s:e?t:Math.log(1+s),i})),hO={kernelName:Fn,backendName:"cpu",kernelFunc:lO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pO(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,paddings:o}=s;WS([i],"spaceToBatchND");const a=k(r),u=[[0,0]];u.push(...o);for(let _=1+r.length;_<i.shape.length;++_)u.push([0,0]);const c=yE.kernelFunc({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),l=mp(c.shape,r,a,!1),h=gp(l.length,r.length,!1),p=yp(c.shape,r,a,!1),d={x:c},f={shape:l},m=_T({inputs:d,backend:n,attrs:f}),g={x:m},y={perm:h},b=LT({inputs:g,backend:n,attrs:y}),v={x:b},w={shape:p},x=_T({inputs:v,backend:n,attrs:w});return n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(b),x}const dO={kernelName:Bn,backendName:"cpu",kernelFunc:pO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fO(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:r,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:u,numUpdates:c,sliceSize:l,strides:h,outputSize:p}=kp(r,i,a),d=!1,f=n.bufferSync(i),m=n.bufferSync(r),g=n.data.get(o.dataId).values[0],y=UE(f,m,a,p,l,c,u,h,g,d);return n.makeTensorInfo(a,y.dtype,y.values)}const mO={kernelName:Gn,backendName:"cpu",kernelFunc:fO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gO(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:r,axis:o}=s,a=E(o,i.shape)[0],u=Vp(i,r,a),c=new Array(i.shape.length).fill(0),l=i.shape.slice();return u.map((t=>{const e=[...l];e[a]=t;const s=wI({inputs:{x:i},backend:n,attrs:{begin:c,size:e}});return c[a]+=t,s}))}const yO={kernelName:qn,backendName:"cpu",kernelFunc:gO},bO=GS(Ln,(t=>Math.sqrt(t))),vO={kernelName:Ln,backendName:"cpu",kernelFunc:bO},wO={kernelName:jn,backendName:"cpu",kernelFunc:({inputs:t,backend:e})=>{const{x:n}=t,s=e;WS(n,"square");const i=s.data.get(n.dataId).values,r=new Float32Array(i.length);for(let a=0;a<i.length;++a){const t=i[a];r[a]=t*t}const o=s.write(r,n.shape,n.dtype);return{dataId:o,shape:n.shape,dtype:n.dtype}}},xO=tT(((t,e)=>{const n=t-e;return n*n})),_O=gT(Wn,xO),kO={kernelName:Wn,backendName:"cpu",kernelFunc:_O},SO=GS(ss,((t,e)=>{const n=e;return isNaN(t)?NaN:t>0?1:n.alpha})),TO={kernelName:ss,backendName:"cpu",kernelFunc:SO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IO(t,e,n,s){const i=fr(t,e.dtype);for(let r=0;r<i.size;r++){const t=i.indexToLoc(r),o=new Array(t.length);for(let e=0;e<o.length;e++)o[e]=t[e]*n[e]+s[e];i.set(e.get(...o),...t)}return i}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function CO(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,end:o,strides:a,beginMask:u,endMask:c,ellipsisMask:l,newAxisMask:h,shrinkAxisMask:p}=s;WS(i,"stridedSlice");const{nonStrided:d,$begin:f,$strides:m,size:g,newShape:y,outShape:b}=eo(i.shape,r,o,a,u,c,l,h,p),v=_T({inputs:{x:i},backend:n,attrs:{shape:y}});let w;if(d){const t=wI({inputs:{x:v},backend:n,attrs:{begin:f,size:g}});w=_T({inputs:{x:t},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(t)}else if(b.some((t=>0===t)))w=n.makeTensorInfo(b,i.dtype,[]);else{const t=n.bufferSync(v),e=IO(b,t,m,f);w=n.makeTensorInfo(e.shape,e.dtype,e.values)}const x=_T({inputs:{x:w},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(w),x}const AO={kernelName:Hn,backendName:"cpu",kernelFunc:CO},NO=GS(Kn,(t=>Math.tan(t))),EO={kernelName:Kn,backendName:"cpu",kernelFunc:NO},OO=GS(Xn,(t=>Math.tanh(t))),$O={kernelName:Xn,backendName:"cpu",kernelFunc:OO};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function RO(t,e){const n=new Array(t.rank);for(let i=0;i<n.length;i++)n[i]=t.shape[i]*e[i];const s=fr(n,t.dtype);for(let i=0;i<s.values.length;++i){const e=s.indexToLoc(i),n=new Array(t.rank);for(let s=0;s<n.length;s++)n[s]=e[s]%t.shape[s];const r=t.locToIndex(n);s.values[i]=t.values[r]}return s}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function DO(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:r}=s;WS(i,"tile");const o=RO(n.bufferSync(i),r);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const MO={kernelName:Qn,backendName:"cpu",kernelFunc:DO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function PO(t,e,n,s,i){const r=e[e.length-1],[o,a]=[t.length/r,r],u=$(n,o*s),c=$("int32",o*s);for(let h=0;h<o;h++){const e=h*a,n=t.subarray(e,e+a),i=[];for(let t=0;t<n.length;t++)i.push({value:n[t],index:t});i.sort(((t,e)=>e.value-t.value));const r=h*s,o=u.subarray(r,r+s),l=c.subarray(r,r+s);for(let t=0;t<s;t++)o[t]=i[t].value,l[t]=i[t].index}const l=e.slice();return l[l.length-1]=s,[fr(l,n,u),fr(l,"int32",c)]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FO(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:r,sorted:o}=s;WS(i,"topk");const a=n.data.get(i.dataId).values,[u,c]=PO(a,i.shape,i.dtype,r,o);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const LO={kernelName:Yn,backendName:"cpu",kernelFunc:FO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zO(t,e,n,s){const i=E(e,n)[0],r=[1,n[0],1];for(let f=0;f<i;f++)r[0]*=n[f];r[1]=n[i];for(let f=i+1;f<n.length;f++)r[2]*=n[f];const o={},a=new Int32Array(n[i]),u=new Fs(r,s,t),c=[],l=1===r[0]&&1===r[2];for(let f=0;f<n[i];f++){let e;if(l)e=t[f].toString();else{const t=[];for(let e=0;e<r[0];e++)for(let n=0;n<r[2];n++)t.push(u.get(e,f,n));e=t.join(",")}if(void 0!==o[e])a[f]=o[e];else{const t=Object.keys(o).length;o[e]=t,a[f]=t,c.push(f)}}const h=r.slice();h[1]=Object.keys(o).length;const p=new Fs(h,s);c.forEach(((t,e)=>{for(let n=0;n<r[0];n++)for(let s=0;s<r[2];s++)p.set(u.get(n,t,s),n,e,s)}));const d=n.slice();return d[i]=h[1],{outputValues:p.values,outputShape:d,indices:a}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function BO(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:r}=e;WS(r,"unique");const o=s.data.get(r.dataId).values,{outputValues:a,outputShape:u,indices:c}=zO(o,i,r.shape,r.dtype);return[s.makeTensorInfo(u,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const qO={kernelName:Jn,backendName:"cpu",kernelFunc:BO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function VO(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i.shape.length,a=i.shape[r],u=new Array(o-1);let c=0;for(let d=0;d<o;d++)d!==r&&(u[c++]=i.shape[d]);const l=new Array(o).fill(0),h=i.shape.slice();h[r]=1;const p=new Array(a);for(let d=0;d<p.length;d++){l[r]=d;const t=wI({inputs:{x:i},backend:n,attrs:{begin:l,size:h}});p[d]=_T({inputs:{x:t},backend:n,attrs:{shape:u}}),n.disposeIntermediateTensorInfo(t)}return p}const WO={kernelName:ts,backendName:"cpu",kernelFunc:VO};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jO(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:r}=e,{numSegments:o}=s;WS(i,"unsortedSegmentSum");const a=i.shape.length,u=r.shape.length,c=[],l=[],h=a-u;let p=r;for(let f=0;f<h;++f){const t=LC({inputs:{input:p},backend:n,attrs:{dim:f+1}});p=t,l.push(t)}for(let f=0;f<o;++f){const t=Os(f,"int32"),e=n.makeTensorInfo([],"int32",t),s=TC({inputs:{a:e,b:p},backend:n}),r=fT({inputs:{x:s},backend:n,attrs:{dtype:"float32"}}),o=UC({inputs:{a:r,b:i},backend:n}),a=AN({inputs:{x:o},backend:n,attrs:{axis:0,keepDims:!1}});c.push(a),l.push(e),l.push(s),l.push(r),l.push(o),l.push(a)}const d=fE({inputs:c,backend:n,attrs:{axis:0}});return l.forEach((t=>n.disposeIntermediateTensorInfo(t))),d}const UO={kernelName:es,backendName:"cpu",kernelFunc:jO},GO=[CT,ET,$T,DT,xT,PT,qT,WT,UT,HT,XT,YT,JT,nI,iI,lI,pI,fI,gI,TT,bI,kI,CI,mT,OI,RI,lT,MI,BI,jI,GI,VI,QI,ZI,KI,tC,nC,iC,oC,uC,lC,pC,fC,gC,bC,vC,xC,wC,XC,XS,kC,IC,DC,FC,zC,VC,oA,uA,lA,dA,gA,bA,wA,_A,TA,AA,OA,YS,RA,LI,MA,FA,zA,JS,VA,UA,KA,YA,JA,nN,iN,aN,cN,hN,yN,vN,xN,kN,TN,CN,fN,ON,RN,PN,LN,qN,GN,GC,XN,ZN,eE,iE,aE,cE,dE,mE,yE,wE,sT,kE,IE,dT,AE,rT,aT,kT,EE,$E,DE,PE,LE,zE,qE,jE,HE,XE,JE,eO,sO,rO,aO,xI,jN,hO,dO,mO,yO,vO,wO,kO,TO,AO,JC,NN,EO,$O,MO,LO,zT,qO,WO,UO,hE];for(const _6 of GO)fs(_6);
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const HO={},KO={alpha:!1,antialias:!1,premultipliedAlpha:!1,preserveDrawingBuffer:!1,depth:!1,stencil:!1,failIfMajorPerformanceCaveat:!0};function XO(t,e){HO[t]=e}function QO(t){if(!(t in HO)){const e=ZO(t);if(null===e)return console.log("Could not get context for WebGL version",t),null;HO[t]=e}const e=HO[t];return e.isContextLost()?(delete HO[t],QO(t)):(e.disable(e.DEPTH_TEST),e.disable(e.STENCIL_TEST),e.disable(e.BLEND),e.disable(e.DITHER),e.disable(e.POLYGON_OFFSET_FILL),e.disable(e.SAMPLE_COVERAGE),e.enable(e.SCISSOR_TEST),e.enable(e.CULL_FACE),e.cullFace(e.BACK),HO[t])}function YO(t){if("undefined"!==typeof OffscreenCanvas&&2===t)return new OffscreenCanvas(300,150);if("undefined"!==typeof document)return document.createElement("canvas");throw new Error("Cannot create a canvas in this context")}function ZO(t){if(1!==t&&2!==t)throw new Error("Cannot get WebGL rendering context, WebGL is disabled.");const e=YO(t);return e.addEventListener("webglcontextlost",(e=>{e.preventDefault(),delete HO[t]}),!1),1===t?e.getContext("webgl",KO)||e.getContext("experimental-webgl",KO):e.getContext("webgl2",KO)}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
var JO,t$,e$;function n$(t,e){return[e,t]}function s$(t,e){return t*e}function i$(t){const e=k(t),n=Math.ceil(e/4);return I(n)}function r$(t,e){return[Math.max(1,Math.ceil(e/2)),Math.max(1,Math.ceil(t/2))]}function o$(t,e){const[n,s]=r$(t,e);return n*s*4}function a$(t,e){const n=t;let s,i,r,o,a,u,c,l,h,p;return 2===at().getNumber("WEBGL_VERSION")?(s=n.R32F,i=n.R16F,r=n.RGBA16F,o=n.RGBA32F,a=n.RED,c=4,l=1,h=n.HALF_FLOAT,p=n.FLOAT):(s=t.RGBA,i=t.RGBA,r=t.RGBA,o=n.RGBA,a=t.RGBA,c=4,l=4,h=null!=e?e.HALF_FLOAT_OES:null,p=t.FLOAT),u=t.RGBA,{internalFormatFloat:s,internalFormatHalfFloat:i,internalFormatPackedHalfFloat:r,internalFormatPackedFloat:o,textureFormatFloat:a,downloadTextureFormat:u,downloadUnpackNumChannels:c,defaultNumChannels:l,textureTypeHalfFloat:h,textureTypeFloat:p}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function u$(t,e){const n=e();return at().getBool("DEBUG")&&c$(t),n}function c$(t){const e=t.getError();if(e!==t.NO_ERROR)throw new Error("WebGL Error: "+d$(t,e))}(function(t){t[t["DENSE"]=0]="DENSE",t[t["SHARED_BATCH"]=1]="SHARED_BATCH"})(JO||(JO={})),function(t){t[t["RENDER"]=0]="RENDER",t[t["UPLOAD"]=1]="UPLOAD",t[t["PIXELS"]=2]="PIXELS",t[t["DOWNLOAD"]=3]="DOWNLOAD"}(t$||(t$={})),function(t){t[t["UNPACKED_FLOAT16"]=0]="UNPACKED_FLOAT16",t[t["UNPACKED_FLOAT32"]=1]="UNPACKED_FLOAT32",t[t["PACKED_4X1_UNSIGNED_BYTE"]=2]="PACKED_4X1_UNSIGNED_BYTE",t[t["PACKED_2X2_FLOAT32"]=3]="PACKED_2X2_FLOAT32",t[t["PACKED_2X2_FLOAT16"]=4]="PACKED_2X2_FLOAT16"}(e$||(e$={}));const l$=5.96e-8,h$=65504;function p$(t){return!!(at().getBool("WEBGL_RENDER_FLOAT32_ENABLED")||0===t||l$<Math.abs(t)&&Math.abs(t)<h$)}function d$(t,e){switch(e){case t.NO_ERROR:return"NO_ERROR";case t.INVALID_ENUM:return"INVALID_ENUM";case t.INVALID_VALUE:return"INVALID_VALUE";case t.INVALID_OPERATION:return"INVALID_OPERATION";case t.INVALID_FRAMEBUFFER_OPERATION:return"INVALID_FRAMEBUFFER_OPERATION";case t.OUT_OF_MEMORY:return"OUT_OF_MEMORY";case t.CONTEXT_LOST_WEBGL:return"CONTEXT_LOST_WEBGL";default:return`Unknown error code ${e}`}}function f$(t,e){return P$(t,(()=>t.getExtension(e)),'Extension "'+e+'" not supported on this browser.')}function m$(t,e){const n=P$(t,(()=>t.createShader(t.VERTEX_SHADER)),"Unable to create vertex WebGLShader.");if(u$(t,(()=>t.shaderSource(n,e))),u$(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw console.log(t.getShaderInfoLog(n)),new Error("Failed to compile vertex shader.");return n}function g$(t,e){const n=P$(t,(()=>t.createShader(t.FRAGMENT_SHADER)),"Unable to create fragment WebGLShader.");if(u$(t,(()=>t.shaderSource(n,e))),u$(t,(()=>t.compileShader(n))),!1===t.getShaderParameter(n,t.COMPILE_STATUS))throw b$(e,t.getShaderInfoLog(n)),new Error("Failed to compile fragment shader.");return n}const y$=/ERROR: [0-9]+:([0-9]+):/g;function b$(t,e){const n=y$.exec(e);if(null==n)return console.log(`Couldn't parse line number in error: ${e}`),void console.log(t);const s=+n[1],i=t.split("\n"),r=i.length.toString().length+2,o=i.map(((t,e)=>C((e+1).toString(),r)+t));let a=0;for(let h=0;h<o.length;h++)a=Math.max(o[h].length,a);const u=o.slice(0,s-1),c=o.slice(s-1,s),l=o.slice(s);console.log(u.join("\n")),console.log(e.split("\n")[0]),console.log(`%c ${C(c[0],a)}`,"border:1px solid red; background-color:#e3d2d2; color:#a61717"),console.log(l.join("\n"))}function v$(t){return P$(t,(()=>t.createProgram()),"Unable to create WebGLProgram.")}function w$(t,e){if(u$(t,(()=>t.linkProgram(e))),!1===t.getProgramParameter(e,t.LINK_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Failed to link vertex and fragment shaders.")}function x$(t,e){if(u$(t,(()=>t.validateProgram(e))),!1===t.getProgramParameter(e,t.VALIDATE_STATUS))throw console.log(t.getProgramInfoLog(e)),new Error("Shader program validation failed.")}function _$(t,e){const n=P$(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return u$(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n))),u$(t,(()=>t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW))),n}function k$(t,e){const n=P$(t,(()=>t.createBuffer()),"Unable to create WebGLBuffer");return u$(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n))),u$(t,(()=>t.bufferData(t.ELEMENT_ARRAY_BUFFER,e,t.STATIC_DRAW))),n}function S$(t){return P$(t,(()=>t.createTexture()),"Unable to create WebGLTexture.")}function T$(t,e){const n=at().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(t<=0||e<=0){const n=`[${t}x${e}]`;throw new Error("Requested texture size "+n+" is invalid.")}if(t>n||e>n){const s=`[${t}x${e}]`,i=`[${n}x${n}]`;throw new Error("Requested texture size "+s+" greater than WebGL maximum on this browser / GPU "+i+".")}}function I$(t){return P$(t,(()=>t.createFramebuffer()),"Unable to create WebGLFramebuffer.")}function C$(t,e,n,s,i,r,o){const a=t.getAttribLocation(e,n);return-1!==a&&(u$(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,s))),u$(t,(()=>t.vertexAttribPointer(a,i,t.FLOAT,!1,r,o))),u$(t,(()=>t.enableVertexAttribArray(a))),!0)}function A$(t,e,n){F$(t,n),u$(t,(()=>t.activeTexture(t.TEXTURE0+n))),u$(t,(()=>t.bindTexture(t.TEXTURE_2D,e)))}function N$(t,e,n){return P$(t,(()=>t.getUniformLocation(e,n)),'uniform "'+n+'" not present in program.')}function E$(t,e,n){return t.getUniformLocation(e,n)}function O$(t,e,n,s){u$(t,(()=>A$(t,e,s))),u$(t,(()=>t.uniform1i(n,s)))}function $$(t,e,n){u$(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,n))),u$(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,e,0)))}function R$(t,e){u$(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,e))),u$(t,(()=>t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,null,0)))}function D$(t){const e=t.checkFramebufferStatus(t.FRAMEBUFFER);if(e!==t.FRAMEBUFFER_COMPLETE)throw new Error("Error binding framebuffer: "+M$(t,e))}function M$(t,e){switch(e){case t.FRAMEBUFFER_INCOMPLETE_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:return"FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT";case t.FRAMEBUFFER_INCOMPLETE_DIMENSIONS:return"FRAMEBUFFER_INCOMPLETE_DIMENSIONS";case t.FRAMEBUFFER_UNSUPPORTED:return"FRAMEBUFFER_UNSUPPORTED";default:return`unknown error ${e}`}}function P$(t,e,n){const s=u$(t,(()=>e()));if(null==s)throw new Error(n);return s}function F$(t,e){const n=t.MAX_COMBINED_TEXTURE_IMAGE_UNITS-1,s=e+t.TEXTURE0;if(s<t.TEXTURE0||s>n){const t=`[gl.TEXTURE0, gl.TEXTURE${n}]`;throw new Error(`textureUnit must be in ${t}.`)}}function L$(t,e=2){return k(t.slice(0,t.length-e))}function z$(t){if(0===t.length)throw Error("Cannot get rows and columns of an empty shape array.");return[t.length>1?t[t.length-2]:1,t[t.length-1]]}function B$(t){let e=[1,1,1];const n=0===t.length||1===t.length&&1===t[0];return n||(e=[L$(t),...z$(t)]),e}function q$(t,e=!1){let n=at().getNumber("WEBGL_MAX_TEXTURE_SIZE");if(e&&(n*=2,t=t.map(((e,n)=>n>=t.length-2?y(t[n]):t[n])),1===t.length&&(t=[2,t[0]])),2!==t.length){const e=O(t);t=e.newShape}let s=k(t);if(t.length<=1&&s<=n)return[1,s];if(2===t.length&&t[0]<=n&&t[1]<=n)return t;if(3===t.length&&t[0]*t[1]<=n&&t[2]<=n)return[t[0]*t[1],t[2]];if(3===t.length&&t[0]<=n&&t[1]*t[2]<=n)return[t[0],t[1]*t[2]];if(4===t.length&&t[0]*t[1]*t[2]<=n&&t[3]<=n)return[t[0]*t[1]*t[2],t[3]];if(4===t.length&&t[0]<=n&&t[1]*t[2]*t[3]<=n)return[t[0],t[1]*t[2]*t[3]];if(e){const e=L$(t);let n=2,i=2;return t.length&&([n,i]=z$(t)),s=e*(n/2)*(i/2),I(s).map((t=>2*t))}return I(s)}function V$(t){return t%2===0}function W$(t,e){if(t=t.slice(-2),e=e.slice(-2),S(t,e))return!0;if(!t.length||!e.length)return!0;if(0===t[0]||0===t[1]||0===e[0]||0===e[1])return!0;if(t.length!==e.length){const n=t.slice(-1)[0],s=e.slice(-1)[0];if(n===s)return!0;if(V$(n)&&V$(s)&&(1===t[0]||1===e[0]))return!0}return t[1]===e[1]&&V$(t[0])&&V$(e[0])}let j$,U$;function G$(t){if(null==j$){const e=QO(t);j$=e.getParameter(e.MAX_TEXTURE_SIZE)}return j$}function H$(t){if(null==U$){const e=QO(t);U$=e.getParameter(e.MAX_TEXTURE_IMAGE_UNITS)}return Math.min(16,U$)}function K$(t){if(0===t)return 0;let e;const n=QO(t);return e=X$(n,"EXT_disjoint_timer_query_webgl2")&&2===t?2:X$(n,"EXT_disjoint_timer_query")?1:0,e}function X$(t,e){const n=t.getExtension(e);return null!=n}function Q$(t){try{const e=QO(t);if(null!=e)return!0}catch(e){return console.log("Error when getting WebGL context: ",e),!1}return!1}function Y$(t){if(0===t)return!1;const e=QO(t);if(1===t){if(!X$(e,"OES_texture_float"))return!1}else if(!X$(e,"EXT_color_buffer_float"))return!1;const n=J$(e);return n}function Z$(t){if(0===t)return!1;const e=QO(t);if(1!==t){if(X$(e,"EXT_color_buffer_float"))return J$(e);const t="EXT_color_buffer_half_float";if(X$(e,t)){const n=e.getExtension(t);return tR(e,n)}return!1}if(!X$(e,"OES_texture_float"))return!1;if(!X$(e,"WEBGL_color_buffer_float"))return!1;const n=J$(e);return n}function J$(t){const e=a$(t),n=t.createTexture();t.bindTexture(t.TEXTURE_2D,n);const s=1,i=1;t.texImage2D(t.TEXTURE_2D,0,e.internalFormatFloat,s,i,0,e.textureFormatFloat,e.textureTypeFloat,null);const r=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,r),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0);const o=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(n),t.deleteFramebuffer(r),o}function tR(t,e){const n=a$(t,e),s=t.createTexture();t.bindTexture(t.TEXTURE_2D,s);const i=1,r=1;t.texImage2D(t.TEXTURE_2D,0,n.internalFormatHalfFloat,i,r,0,n.textureFormatFloat,n.textureTypeHalfFloat,null);const o=t.createFramebuffer();t.bindFramebuffer(t.FRAMEBUFFER,o),t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,s,0);const a=t.checkFramebufferStatus(t.FRAMEBUFFER)===t.FRAMEBUFFER_COMPLETE;return t.bindTexture(t.TEXTURE_2D,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.deleteTexture(s),t.deleteFramebuffer(o),a}function eR(t){if(2!==t)return!1;const e=QO(t),n=null!=e.fenceSync;return n}function nR(t,e){Array.isArray(t)||(t=[t]),t.forEach((t=>{null!=t&&v("complex64"!==t.dtype,(()=>`${e} does not support complex64 tensors in the WebGL backend.`))}))}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const sR=at();
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iR(){let t,e,n,s,i,r,o,a,u,c;return 2===at().getNumber("WEBGL_VERSION")?(t="#version 300 es",e="in",n="out",s="in",i="texture",r="outputColor",o="out vec4 outputColor;",a="\n      bool isnan_custom(float val) {\n        return (val > 0.0 || val < 0.0) ? false : val != 0.0;\n      }\n\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan_custom(val.x),\n          isnan_custom(val.y), isnan_custom(val.z), isnan_custom(val.w));\n      }\n\n      #define isnan(value) isnan_custom(value)\n    ",u="",c="\n      #define round(value) newRound(value)\n      int newRound(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 newRound(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "):(t="",e="attribute",n="varying",s="varying",i="texture2D",r="gl_FragColor",o="",a="\n      #define isnan(value) isnan_custom(value)\n      bool isnan_custom(float val) {\n        return (val > 0. || val < 1. || val == 0.) ? false : true;\n      }\n      bvec4 isnan_custom(vec4 val) {\n        return bvec4(isnan(val.x), isnan(val.y), isnan(val.z), isnan(val.w));\n      }\n    ",u="\n      uniform float INFINITY;\n\n      bool isinf(float val) {\n        return abs(val) == INFINITY;\n      }\n      bvec4 isinf(vec4 val) {\n        return equal(abs(val), vec4(INFINITY));\n      }\n    ",c="\n      int round(float value) {\n        return int(floor(value + 0.5));\n      }\n\n      ivec4 round(vec4 value) {\n        return ivec4(floor(value + vec4(0.5)));\n      }\n    "),{version:t,attribute:e,varyingVs:n,varyingFs:s,texture2D:i,output:r,defineOutput:o,defineSpecialNaN:a,defineSpecialInf:u,defineRound:c}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rR(t,e,n="index"){const s=G(e);return s.map(((e,i)=>{const r=`int ${t[i]} = ${n} / ${e}`,o=i===s.length-1?`int ${t[i+1]} = ${n} - ${t[i]} * ${e}`:`index -= ${t[i]} * ${e}`;return`${r}; ${o};`})).join("")}function oR(t){const e=G(t).map((t=>t.toString()));return`\n  int getFlatIndex(ivec3 coords) {\n    return coords.x * ${e[0]} + coords.y * ${e[1]} + coords.z;\n  }\n`}sR.registerFlag("HAS_WEBGL",(()=>sR.getNumber("WEBGL_VERSION")>0)),sR.registerFlag("WEBGL_VERSION",(()=>Q$(2)?2:Q$(1)?1:0)),sR.registerFlag("WEBGL_CHECK_NUMERICAL_PROBLEMS",(()=>!1)),sR.registerFlag("WEBGL_BUFFER_SUPPORTED",(()=>2===sR.get("WEBGL_VERSION"))),sR.registerFlag("WEBGL_CPU_FORWARD",(()=>!0)),sR.registerFlag("WEBGL_FORCE_F16_TEXTURES",(()=>!1)),sR.registerFlag("WEBGL_PACK",(()=>sR.getBool("HAS_WEBGL"))),sR.registerFlag("WEBGL_PACK_NORMALIZATION",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_PACK_CLIP",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_PACK_DEPTHWISECONV",(()=>!1)),sR.registerFlag("WEBGL_PACK_BINARY_OPERATIONS",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_PACK_UNARY_OPERATIONS",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_PACK_ARRAY_OPERATIONS",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_PACK_IMAGE_OPERATIONS",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_PACK_REDUCE",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_LAZILY_UNPACK",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_CONV_IM2COL",(()=>sR.getBool("WEBGL_PACK"))),sR.registerFlag("WEBGL_MAX_TEXTURE_SIZE",(()=>G$(sR.getNumber("WEBGL_VERSION")))),sR.registerFlag("WEBGL_MAX_TEXTURES_IN_SHADER",(()=>H$(sR.getNumber("WEBGL_VERSION")))),sR.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION",(()=>{const t=sR.getNumber("WEBGL_VERSION");return 0===t?0:K$(t)})),sR.registerFlag("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE",(()=>sR.getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0&&!pi())),sR.registerFlag("WEBGL_RENDER_FLOAT32_CAPABLE",(()=>Y$(sR.getNumber("WEBGL_VERSION")))),sR.registerFlag("WEBGL_RENDER_FLOAT32_ENABLED",(()=>!sR.getBool("WEBGL_FORCE_F16_TEXTURES")&&sR.getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))),sR.registerFlag("WEBGL_DOWNLOAD_FLOAT_ENABLED",(()=>Z$(sR.getNumber("WEBGL_VERSION")))),sR.registerFlag("WEBGL_FENCE_API_ENABLED",(()=>eR(sR.getNumber("WEBGL_VERSION")))),sR.registerFlag("WEBGL_SIZE_UPLOAD_UNIFORM",(()=>{const t=sR.getBool("WEBGL_RENDER_FLOAT32_ENABLED");return t?4:0})),sR.registerFlag("WEBGL_DELETE_TEXTURE_THRESHOLD",(()=>-1),(t=>{if(t<0&&-1!==t)throw new Error(`WEBGL_DELETE_TEXTURE_THRESHOLD must be -1 (indicating never delete) or at least 0, but got ${t}.`)}));const aR="\n  const float FLOAT_MAX = 1.70141184e38;\n  const float FLOAT_MIN = 1.17549435e-38;\n\n  lowp vec4 encode_float(highp float v) {\n    if (isnan(v)) {\n      return vec4(255, 255, 255, 255);\n    }\n\n    highp float av = abs(v);\n\n    if(av < FLOAT_MIN) {\n      return vec4(0.0, 0.0, 0.0, 0.0);\n    } else if(v > FLOAT_MAX) {\n      return vec4(0.0, 0.0, 128.0, 127.0) / 255.0;\n    } else if(v < -FLOAT_MAX) {\n      return vec4(0.0, 0.0,  128.0, 255.0) / 255.0;\n    }\n\n    highp vec4 c = vec4(0,0,0,0);\n\n    highp float e = floor(log2(av));\n    highp float m = exp2(fract(log2(av))) - 1.0;\n\n    c[2] = floor(128.0 * m);\n    m -= c[2] / 128.0;\n    c[1] = floor(32768.0 * m);\n    m -= c[1] / 32768.0;\n    c[0] = floor(8388608.0 * m);\n\n    highp float ebias = e + 127.0;\n    c[3] = floor(ebias / 2.0);\n    ebias -= c[3] * 2.0;\n    c[2] += floor(ebias) * 128.0;\n\n    c[3] += 128.0 * step(0.0, -v);\n\n    return c / 255.0;\n  }\n";
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class uR{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outPackingScheme=JO.DENSE;const e=i$(t),n=iR();this.outputShape=t,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${rR(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${e[0]}, ${e[1]}));\n        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getA(rc.x, rc.y, rc.z);\n        }\n\n        ${n.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class cR{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outPackingScheme=JO.DENSE;const e=i$(t),n=iR();this.outputShape=t,this.userCode=`\n      ivec3 outCoordsFromFlatIndex(int index) {\n        ${rR(["r","c","d"],t)}\n        return ivec3(r, c, d);\n      }\n\n      void main() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n          vec2(${e[0]}, ${e[1]}));\n        int index = 4 * (resTexRC.x * ${e[1]} + resTexRC.y);\n\n        vec4 result = vec4(0.);\n\n        for (int i=0; i<4; i++) {\n          int flatIndex = index + i;\n          ivec3 rc = outCoordsFromFlatIndex(flatIndex);\n          result[i] = getChannel(getA(rc.x, rc.y, rc.z), vec2(rc.y, rc.z));\n        }\n\n        ${n.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class lR{constructor(t){this.variableNames=["A"],this.outTexUsage=t$.DOWNLOAD;const e=iR();this.outputShape=t,this.userCode=`\n      ${aR}\n\n      void main() {\n        float x = getAAtOutCoords();\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class hR{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outTexUsage=t$.DOWNLOAD;const e=iR();this.outputShape=t,this.userCode=`\n      ${aR}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n        float x = getChannel(getAAtOutCoords(), vec2(coords.y, coords.z));\n        ${e.output} = encode_float(x);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class pR{constructor(t,e,n=!1){this.variableNames=["A"];const s=iR(),[i,r]=e;this.outputShape=t;let o="result";n&&(o="floor(result * 255. + 0.5)"),this.userCode=`\n      ${oR(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        int flatIndex = getFlatIndex(coords);\n        int offset = imod(flatIndex, 4);\n\n        flatIndex = idiv(flatIndex, 4, 1.);\n\n        int r = flatIndex / ${r};\n        int c = imod(flatIndex, ${r});\n        vec2 uv = (vec2(c, r) + halfCR) / vec2(${r}.0, ${i}.0);\n        vec4 values = ${s.texture2D}(A, uv);\n\n        float result;\n\n        if(offset == 0) {\n          result = values[0];\n        } else if(offset == 1) {\n          result = values[1];\n        } else if(offset == 2) {\n          result = values[2];\n        } else {\n          result = values[3];\n        }\n\n        ${s.output} = vec4(${o}, 0., 0., 0.);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class dR{constructor(t,e,n=!1){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const s=iR(),[i,r]=e;this.outputShape=t;let o="",a="result";n&&(a="floor(result * 255. + 0.5)");for(let u=0;u<=1;u++)for(let e=0;e<=1;e++){const n=2*u+e;o+=`\n          localCoords = coords;\n          if(localCoords[2] + ${e} < ${t[2]}) {\n            localCoords[2] += ${e};\n            if(localCoords[1] + ${u} < ${t[1]}) {\n              localCoords[1] += ${u};\n\n              flatIndex = getFlatIndex(localCoords);\n              offset = imod(flatIndex, 4);\n\n              flatIndex = idiv(flatIndex, 4, 1.);\n\n              r = flatIndex / ${r};\n              c = imod(flatIndex, ${r});\n              uv = (vec2(c, r) + halfCR) / vec2(${r}.0, ${i}.0);\n              values = ${s.texture2D}(A, uv);\n\n              if(offset == 0) {\n                result[${n}] = values[0];\n              } else if(offset == 1) {\n                result[${n}] = values[1];\n              } else if(offset == 2) {\n                result[${n}] = values[2];\n              } else {\n                result[${n}] = values[3];\n              }\n            }\n          }\n        `}this.userCode=`\n      ${oR(t)}\n\n      void main() {\n        ivec3 coords = getOutputCoords();\n\n        vec4 result = vec4(0.);\n        int flatIndex, r, c, offset;\n        ivec3 localCoords;\n        vec2 uv;\n        vec4 values;\n\n        ${o}\n\n        ${s.output} = ${a};\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fR(t){const e=iR(),n=`${e.version}\n    precision highp float;\n    ${e.attribute} vec3 clipSpacePos;\n    ${e.attribute} vec2 uv;\n    ${e.varyingVs} vec2 resultUV;\n\n    void main() {\n      gl_Position = vec4(clipSpacePos, 1);\n      resultUV = uv;\n    }`;return m$(t,n)}function mR(t){const e=new Float32Array([-1,1,0,0,1,-1,-1,0,0,0,1,1,0,1,1,1,-1,0,1,0]);return _$(t,e)}function gR(t){const e=new Uint16Array([0,1,2,2,1,3]);return k$(t,e)}function yR(t,e,n,s,i,r){T$(e,n);const o=S$(t),a=t.TEXTURE_2D;return u$(t,(()=>t.bindTexture(a,o))),u$(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE))),u$(t,(()=>t.texParameteri(a,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE))),u$(t,(()=>t.texParameteri(a,t.TEXTURE_MIN_FILTER,t.NEAREST))),u$(t,(()=>t.texParameteri(a,t.TEXTURE_MAG_FILTER,t.NEAREST))),u$(t,(()=>t.texImage2D(a,0,s,e,n,0,i,r,null))),u$(t,(()=>t.bindTexture(t.TEXTURE_2D,null))),o}function bR(t){return t.internalFormatFloat}function vR(t,e,n,s){const[i,r]=n$(e,n);return yR(t,i,r,bR(s),s.textureFormatFloat,t.FLOAT)}function wR(t){return t.internalFormatHalfFloat}function xR(t,e,n,s){const[i,r]=n$(e,n);return yR(t,i,r,wR(s),s.textureFormatFloat,s.textureTypeHalfFloat)}function _R(t){return t.downloadTextureFormat}function kR(t,e,n,s){const[i,r]=n$(e,n);return yR(t,i,r,_R(s),t.RGBA,t.UNSIGNED_BYTE)}function SR(t){return t.internalFormatPackedFloat}function TR(t,e,n,s){const[i,r]=r$(e,n);return yR(t,i,r,SR(s),t.RGBA,t.FLOAT)}function IR(t){return t.internalFormatPackedHalfFloat}function CR(t,e,n,s){const[i,r]=r$(e,n);return yR(t,i,r,IR(s),t.RGBA,s.textureTypeHalfFloat)}function AR(t,e,n){const s=0,i=12,r=20;u$(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,n)));const o=C$(t,e,"clipSpacePos",n,3,r,s);return o&&C$(t,e,"uv",n,2,r,i)}function NR(t,e,n,s,i,r){let o,a,u;u$(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),i instanceof Uint8Array?(o=new Uint8Array(n*s*4),a=t.UNSIGNED_BYTE,u=t.RGBA):(o=new Float32Array(n*s*4),a=t.FLOAT,u=r.internalFormatPackedFloat),o.set(i),u$(t,(()=>t.texImage2D(t.TEXTURE_2D,0,u,n,s,0,t.RGBA,a,o))),u$(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}function ER(t,e,n){u$(t,(()=>t.bindTexture(t.TEXTURE_2D,e))),n.data instanceof Uint8Array?u$(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,n.width,n.height,0,t.RGBA,t.UNSIGNED_BYTE,n.data))):u$(t,(()=>t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n))),u$(t,(()=>t.bindTexture(t.TEXTURE_2D,null)))}function OR(t,e,n,s){const i=t.createBuffer();u$(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,i)));const r=4,o=4,a=r*o*e*n;return u$(t,(()=>t.bufferData(t.PIXEL_PACK_BUFFER,a,t.STREAM_READ))),u$(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,0))),u$(t,(()=>t.bindBuffer(t.PIXEL_PACK_BUFFER,null))),i}function $R(t,e,n){const s=t,i=new Float32Array(n);return s.bindBuffer(s.PIXEL_PACK_BUFFER,e),s.getBufferSubData(s.PIXEL_PACK_BUFFER,0,i),s.bindBuffer(s.PIXEL_PACK_BUFFER,null),i}function RR(t,e,n,s){const[i,r]=n$(e,n),o=4,a=new Uint8Array(s$(e*n,o));return u$(t,(()=>t.readPixels(0,0,i,r,s.downloadTextureFormat,t.UNSIGNED_BYTE,a))),new Float32Array(a.buffer)}function DR(t,e,n,s,i,r,o,a){const u=t,c=new Float32Array(o$(r,o));return u.bindBuffer(u.PIXEL_PACK_BUFFER,e),u.getBufferSubData(u.PIXEL_PACK_BUFFER,0,c),u.bindBuffer(u.PIXEL_PACK_BUFFER,null),c}function MR(t,e,n){const s=new Float32Array(e*n*4);return u$(t,(()=>t.readPixels(0,0,n,e,t.RGBA,t.FLOAT,s))),s}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class PR{constructor(t){this.outputTexture=null,this.program=null,this.disposed=!1,this.vertexAttrsAreBound=!1,this.itemsToPoll=[];const e=at().getNumber("WEBGL_VERSION");null!=t?(this.gl=t,XO(e,t)):this.gl=QO(e);let n="WEBGL_color_buffer_float";const s="EXT_color_buffer_half_float";if(1===at().getNumber("WEBGL_VERSION")){const t="OES_texture_float",e="OES_texture_half_float";if(this.textureFloatExtension=f$(this.gl,t),X$(this.gl,e))this.textureHalfFloatExtension=f$(this.gl,e);else if(at().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support half float textures, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.");if(this.colorBufferFloatExtension=this.gl.getExtension(n),X$(this.gl,s))this.colorBufferHalfFloatExtension=f$(this.gl,s);else if(at().get("WEBGL_FORCE_F16_TEXTURES"))throw new Error("GL context does not support color renderable half floats, yet the environment flag WEBGL_FORCE_F16_TEXTURES is set to true.")}else if(n="EXT_color_buffer_float",X$(this.gl,n))this.colorBufferFloatExtension=this.gl.getExtension(n);else{if(!X$(this.gl,s))throw new Error("GL context does not support color renderable floats");this.colorBufferHalfFloatExtension=this.gl.getExtension(s)}this.vertexBuffer=mR(this.gl),this.indexBuffer=gR(this.gl),this.framebuffer=I$(this.gl),this.textureConfig=a$(this.gl,this.textureHalfFloatExtension)}get debug(){return at().getBool("DEBUG")}dispose(){if(this.disposed)return;null!=this.program&&console.warn("Disposing a GPGPUContext that still has a bound WebGLProgram. This is probably a resource leak, delete the program with GPGPUContext.deleteProgram before disposing."),null!=this.outputTexture&&console.warn("Disposing a GPGPUContext that still has a bound output matrix texture.  This is probably a resource leak, delete the output matrix texture with GPGPUContext.deleteMatrixTexture before disposing.");const t=this.gl;u$(t,(()=>t.finish())),u$(t,(()=>t.bindFramebuffer(t.FRAMEBUFFER,null))),u$(t,(()=>t.deleteFramebuffer(this.framebuffer))),u$(t,(()=>t.bindBuffer(t.ARRAY_BUFFER,null))),u$(t,(()=>t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null))),u$(t,(()=>t.deleteBuffer(this.indexBuffer))),this.disposed=!0}createFloat32MatrixTexture(t,e){return this.throwIfDisposed(),vR(this.gl,t,e,this.textureConfig)}createFloat16MatrixTexture(t,e){return this.throwIfDisposed(),xR(this.gl,t,e,this.textureConfig)}createUnsignedBytesMatrixTexture(t,e){return this.throwIfDisposed(),kR(this.gl,t,e,this.textureConfig)}uploadPixelDataToTexture(t,e){this.throwIfDisposed(),ER(this.gl,t,e)}uploadDenseMatrixToTexture(t,e,n,s){this.throwIfDisposed(),NR(this.gl,t,e,n,s,this.textureConfig)}createFloat16PackedMatrixTexture(t,e){return this.throwIfDisposed(),CR(this.gl,t,e,this.textureConfig)}createPackedMatrixTexture(t,e){return this.throwIfDisposed(),TR(this.gl,t,e,this.textureConfig)}deleteMatrixTexture(t){this.throwIfDisposed(),this.outputTexture===t&&(R$(this.gl,this.framebuffer),this.outputTexture=null),u$(this.gl,(()=>this.gl.deleteTexture(t)))}downloadByteEncodedFloatMatrixFromOutputTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>RR(this.gl,e,n,this.textureConfig)))}downloadPackedMatrixFromBuffer(t,e,n,s,i,r){return DR(this.gl,t,e,n,s,i,r,this.textureConfig)}downloadFloat32MatrixFromBuffer(t,e){return $R(this.gl,t,e)}createBufferFromTexture(t,e,n){this.bindTextureToFrameBuffer(t);const s=OR(this.gl,e,n,this.textureConfig);return this.unbindTextureToFrameBuffer(),s}createAndWaitForFence(){const t=this.createFence(this.gl);return this.pollFence(t)}createFence(t){let e,n;if(at().getBool("WEBGL_FENCE_API_ENABLED")){const s=t,i=s.fenceSync(s.SYNC_GPU_COMMANDS_COMPLETE,0);t.flush(),n=()=>{const t=s.clientWaitSync(i,0,0);return t===s.ALREADY_SIGNALED||t===s.CONDITION_SATISFIED},e=i}else at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")>0?(e=this.beginQuery(),this.endQuery(),n=()=>this.isQueryAvailable(e,at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))):n=()=>!0;return{query:e,isFencePassed:n}}downloadMatrixFromPackedTexture(t,e,n){return this.downloadMatrixDriver(t,(()=>MR(this.gl,e,n)))}createProgram(t){this.throwIfDisposed();const e=this.gl,n=g$(e,t),s=fR(e),i=v$(e);return u$(e,(()=>e.attachShader(i,s))),u$(e,(()=>e.attachShader(i,n))),w$(e,i),this.debug&&x$(e,i),this.vertexAttrsAreBound||(this.setProgram(i),this.vertexAttrsAreBound=AR(e,this.program,this.vertexBuffer)),i}deleteProgram(t){this.throwIfDisposed(),t===this.program&&(this.program=null),null!=t&&u$(this.gl,(()=>this.gl.deleteProgram(t)))}setProgram(t){this.throwIfDisposed(),this.program=t,null!=this.program&&this.debug&&x$(this.gl,this.program),u$(this.gl,(()=>this.gl.useProgram(t)))}getUniformLocation(t,e,n=!0){return this.throwIfDisposed(),n?N$(this.gl,t,e):E$(this.gl,t,e)}getAttributeLocation(t,e){return this.throwIfDisposed(),u$(this.gl,(()=>this.gl.getAttribLocation(t,e)))}getUniformLocationNoThrow(t,e){return this.throwIfDisposed(),this.gl.getUniformLocation(t,e)}setInputMatrixTexture(t,e,n){this.throwIfDisposed(),this.throwIfNoProgram(),O$(this.gl,t,e,n)}setOutputMatrixTexture(t,e,n){this.setOutputMatrixTextureDriver(t,n,e)}setOutputPackedMatrixTexture(t,e,n){this.throwIfDisposed();const[s,i]=r$(e,n);this.setOutputMatrixTextureDriver(t,s,i)}setOutputMatrixWriteRegion(t,e,n,s){this.setOutputMatrixWriteRegionDriver(n,t,s,e)}setOutputPackedMatrixWriteRegion(t,e,n,s){throw new Error("setOutputPackedMatrixWriteRegion not implemented.")}debugValidate(){null!=this.program&&x$(this.gl,this.program),D$(this.gl)}executeProgram(){this.throwIfDisposed(),this.throwIfNoProgram();const t=this.gl;this.debug&&this.debugValidate(),u$(t,(()=>t.drawElements(t.TRIANGLES,6,t.UNSIGNED_SHORT,0)))}blockUntilAllProgramsCompleted(){this.throwIfDisposed(),u$(this.gl,(()=>this.gl.finish()))}getQueryTimerExtension(){return null==this.disjointQueryTimerExtension&&(this.disjointQueryTimerExtension=f$(this.gl,2===at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")?"EXT_disjoint_timer_query_webgl2":"EXT_disjoint_timer_query")),this.disjointQueryTimerExtension}getQueryTimerExtensionWebGL2(){return this.getQueryTimerExtension()}getQueryTimerExtensionWebGL1(){return this.getQueryTimerExtension()}beginQuery(){if(2===at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2(),n=t.createQuery();return t.beginQuery(e.TIME_ELAPSED_EXT,n),n}const t=this.getQueryTimerExtensionWebGL1(),e=t.createQueryEXT();return t.beginQueryEXT(t.TIME_ELAPSED_EXT,e),e}endQuery(){if(2===at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")){const t=this.gl,e=this.getQueryTimerExtensionWebGL2();return void t.endQuery(e.TIME_ELAPSED_EXT)}const t=this.getQueryTimerExtensionWebGL1();t.endQueryEXT(t.TIME_ELAPSED_EXT)}async waitForQueryAndGetTime(t){return await A((()=>this.disposed||this.isQueryAvailable(t,at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION")))),this.getQueryTime(t,at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_VERSION"))}getQueryTime(t,e){if(0===e)return null;if(2===e){const e=this.gl,n=e.getQueryParameter(t,e.QUERY_RESULT);return n/1e6}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_EXT);return n/1e6}}isQueryAvailable(t,e){if(0===e)return!0;if(2===e){const e=this.gl,n=this.getQueryTimerExtensionWebGL2(),s=e.getQueryParameter(t,e.QUERY_RESULT_AVAILABLE);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(n.GPU_DISJOINT_EXT)),s&&!this.disjoint}{const e=this.getQueryTimerExtensionWebGL1(),n=e.getQueryObjectEXT(t,e.QUERY_RESULT_AVAILABLE_EXT);return null==this.disjoint&&(this.disjoint=this.gl.getParameter(e.GPU_DISJOINT_EXT)),n&&!this.disjoint}}pollFence(t){return new Promise((e=>{this.addItemToPoll((()=>t.isFencePassed()),(()=>e()))}))}pollItems(){const t=FR(this.itemsToPoll.map((t=>t.isDoneFn)));for(let e=0;e<=t;++e){const{resolveFn:t}=this.itemsToPoll[e];t()}this.itemsToPoll=this.itemsToPoll.slice(t+1)}addItemToPoll(t,e){this.itemsToPoll.push({isDoneFn:t,resolveFn:e}),this.itemsToPoll.length>1||A((()=>(this.pollItems(),0===this.itemsToPoll.length)))}bindTextureToFrameBuffer(t){this.throwIfDisposed(),$$(this.gl,t,this.framebuffer),this.debug&&D$(this.gl)}unbindTextureToFrameBuffer(){null!=this.outputTexture?($$(this.gl,this.outputTexture,this.framebuffer),this.debug&&D$(this.gl)):R$(this.gl,this.framebuffer)}downloadMatrixDriver(t,e){this.bindTextureToFrameBuffer(t);const n=e();return this.unbindTextureToFrameBuffer(),n}setOutputMatrixTextureDriver(t,e,n){this.throwIfDisposed();const s=this.gl;$$(s,t,this.framebuffer),this.debug&&D$(s),this.outputTexture=t,u$(s,(()=>s.viewport(0,0,e,n))),u$(s,(()=>s.scissor(0,0,e,n)))}setOutputMatrixWriteRegionDriver(t,e,n,s){this.throwIfDisposed(),u$(this.gl,(()=>this.gl.scissor(t,e,n,s)))}throwIfDisposed(){if(this.disposed)throw new Error("Attempted to use disposed GPGPUContext.")}throwIfNoProgram(){if(null==this.program)throw new Error("No GPU program is currently set.")}}function FR(t){let e=0;for(;e<t.length;++e){const n=t[e]();if(!n)break}return e-1}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const{getBroadcastDims:LR}=r;function zR(t,e,n,s){const i=[];t.forEach((t=>{const e=k(t.shapeInfo.logicalShape);t.shapeInfo.isUniform?i.push(`uniform float ${t.name}${e>1?`[${e}]`:""};`):(i.push(`uniform sampler2D ${t.name};`),i.push(`uniform int offset${t.name};`))}));const r=i.join("\n"),o=t.map((t=>VR(t,e,s))).join("\n"),a=e.texShape,u=iR(),c=UR(u);let l,h,p=KR(u);e.isPacked?(l=WR(e.logicalShape,a),h=HR(u)):(l=jR(e.logicalShape,a),h=GR(u)),s&&(p+=ZR);const d=[p,c,h,r,l,o,n].join("\n");return d}function BR(t){const e=t.shapeInfo.logicalShape;switch(e.length){case 0:return pD(t);case 1:return fD(t);case 2:return gD(t);case 3:return bD(t);case 4:return wD(t);case 5:return xD(t);case 6:return _D(t);default:throw new Error(`${e.length}-D input sampling is not yet supported`)}}function qR(t){const e=t.shapeInfo.logicalShape;switch(e.length){case 0:return hD(t);case 1:return dD(t);case 2:return mD(t);case 3:return yD(t);default:return vD(t)}}function VR(t,e,n=!1){let s="";s+=n?qR(t):BR(t);const i=t.shapeInfo.logicalShape,r=e.logicalShape;return i.length<=r.length&&(s+=n?SD(t,e):TD(t,e)),s}function WR(t,e){switch(t.length){case 0:return JR();case 1:return tD(t,e);case 2:return uD(t,e);case 3:return nD(t,e);default:return iD(t,e)}}function jR(t,e){switch(t.length){case 0:return JR();case 1:return eD(t,e);case 2:return cD(t,e);case 3:return sD(t,e);case 4:return rD(t,e);case 5:return oD(t,e);case 6:return aD(t,e);default:throw new Error(`${t.length}-D output sampling is not yet supported`)}}function UR(t){return`\n    float sampleTexture(sampler2D textureSampler, vec2 uv) {\n      return ${t.texture2D}(textureSampler, uv).r;\n    }\n  `}function GR(t){return`\n    void setOutput(float val) {\n      ${t.output} = vec4(val, 0, 0, 0);\n    }\n  `}function HR(t){return`\n    void setOutput(vec4 val) {\n      ${t.output} = val;\n    }\n  `}function KR(t){const e=`${t.version}\n    precision highp float;\n    precision highp int;\n    precision highp sampler2D;\n    ${t.varyingFs} vec2 resultUV;\n    ${t.defineOutput}\n    const vec2 halfCR = vec2(0.5, 0.5);\n\n    struct ivec5\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n    };\n\n    struct ivec6\n    {\n      int x;\n      int y;\n      int z;\n      int w;\n      int u;\n      int v;\n    };\n\n    uniform float NAN;\n    ${t.defineSpecialNaN}\n    ${t.defineSpecialInf}\n    ${t.defineRound}\n\n    int imod(int x, int y) {\n      return x - y * (x / y);\n    }\n\n    int idiv(int a, int b, float sign) {\n      int res = a / b;\n      int mod = imod(a, b);\n      if (sign < 0. && mod != 0) {\n        res -= 1;\n      }\n      return res;\n    }\n\n    //Based on the work of Dave Hoskins\n    //https://www.shadertoy.com/view/4djSRW\n    #define HASHSCALE1 443.8975\n    float random(float seed){\n      vec2 p = resultUV * seed;\n      vec3 p3  = fract(vec3(p.xyx) * HASHSCALE1);\n      p3 += dot(p3, p3.yzx + 19.19);\n      return fract((p3.x + p3.y) * p3.z);\n    }\n\n    ${XR}\n    ${QR}\n    ${YR}\n  `;return e}const XR="\nvec2 uvFromFlat(int texNumR, int texNumC, int index) {\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\nvec2 packedUVfrom1D(int texNumR, int texNumC, int index) {\n  int texelIndex = index / 2;\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",QR="\nvec2 packedUVfrom2D(int texelsInLogicalRow, int texNumR,\n  int texNumC, int row, int col) {\n  int texelIndex = (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = texelIndex / texNumC;\n  int texC = texelIndex - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",YR="\nvec2 packedUVfrom3D(int texNumR, int texNumC,\n    int texelsInBatch, int texelsInLogicalRow, int b,\n    int row, int col) {\n  int index = b * texelsInBatch + (row / 2) * texelsInLogicalRow + (col / 2);\n  int texR = index / texNumC;\n  int texC = index - texR * texNumC;\n  return (vec2(texC, texR) + halfCR) / vec2(texNumC, texNumR);\n}\n",ZR="\n  float getChannel(vec4 frag, vec2 innerDims) {\n    vec2 modCoord = mod(innerDims, 2.);\n    return modCoord.x == 0. ?\n      (modCoord.y == 0. ? frag.r : frag.g) :\n      (modCoord.y == 0. ? frag.b : frag.a);\n  }\n  float getChannel(vec4 frag, int dim) {\n    float modCoord = mod(float(dim), 2.);\n    return modCoord == 0. ? frag.r : frag.g;\n  }\n";function JR(){return"\n    int getOutputCoords() {\n      return 0;\n    }\n  "}function tD(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];return 1===n[0]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.x * ${n[1]}.0);\n      }\n    `:1===n[1]?`\n      int getOutputCoords() {\n        return 2 * int(resultUV.y * ${n[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      return 2 * (resTexRC.x * ${n[1]} + resTexRC.y);\n    }\n  `}function eD(t,e){return 1===e[0]?`\n      int getOutputCoords() {\n        return int(resultUV.x * ${e[1]}.0);\n      }\n    `:1===e[1]?`\n      int getOutputCoords() {\n        return int(resultUV.y * ${e[0]}.0);\n      }\n    `:`\n    int getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      return resTexRC.x * ${e[1]} + resTexRC.y;\n    }\n  `}function nD(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[2]/2),i=s*Math.ceil(t[1]/2);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec3(b, r, c);\n    }\n  `}function sD(t,e){const n=rR(["r","c","d"],t);return`\n    ivec3 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${n}\n      return ivec3(r, c, d);\n    }\n  `}function iD(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)],s=Math.ceil(t[t.length-1]/2),i=s*Math.ceil(t[t.length-2]/2);let r=i,o="",a="b, r, c";for(let u=2;u<t.length-1;u++)r*=t[t.length-u-1],o=`\n      int b${u} = index / ${r};\n      index -= b${u} * ${r};\n    `+o,a=`b${u}, `+a;return`\n    ivec${t.length} getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n\n      ${o}\n\n      int b = index / ${i};\n      index -= b * ${i};\n\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec${t.length}(${a});\n    }\n  `}function rD(t,e){const n=rR(["r","c","d","d2"],t);return`\n    ivec4 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      ${n}\n      return ivec4(r, c, d, d2);\n    }\n  `}function oD(t,e){const n=rR(["r","c","d","d2","d3"],t);return`\n    ivec5 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx * vec2(${e[0]},\n                             ${e[1]}));\n\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec5 outShape = ivec5(r, c, d, d2, d3);\n      return outShape;\n    }\n  `}function aD(t,e){const n=rR(["r","c","d","d2","d3","d4"],t);return`\n    ivec6 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n        vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n\n      ${n}\n\n      ivec6 result = ivec6(r, c, d, d2, d3, d4);\n      return result;\n    }\n  `}function uD(t,e){const n=[Math.ceil(e[0]/2),Math.ceil(e[1]/2)];if(S(t,e))return`\n      ivec2 getOutputCoords() {\n        return 2 * ivec2(resultUV.yx * vec2(${n[0]}, ${n[1]}));\n      }\n    `;const s=Math.ceil(t[1]/2);return`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${n[0]}, ${n[1]}));\n\n      int index = resTexRC.x * ${n[1]} + resTexRC.y;\n      int r = 2 * (index / ${s});\n      int c = imod(index, ${s}) * 2;\n\n      return ivec2(r, c);\n    }\n  `}function cD(t,e){return S(t,e)?`\n      ivec2 getOutputCoords() {\n        return ivec2(resultUV.yx * vec2(${e[0]}, ${e[1]}));\n      }\n    `:1===t[1]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(index, 0);\n      }\n    `:1===t[0]?`\n      ivec2 getOutputCoords() {\n        ivec2 resTexRC = ivec2(resultUV.yx *\n                               vec2(${e[0]}, ${e[1]}));\n        int index = resTexRC.x * ${e[1]} + resTexRC.y;\n        return ivec2(0, index);\n      }\n    `:`\n    ivec2 getOutputCoords() {\n      ivec2 resTexRC = ivec2(resultUV.yx *\n                             vec2(${e[0]}, ${e[1]}));\n      int index = resTexRC.x * ${e[1]} + resTexRC.y;\n      int r = index / ${t[1]};\n      int c = index - r * ${t[1]};\n      return ivec2(r, c);\n    }\n  `}function lD(t){return`offset${t}`}function hD(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=iR();return`\n    vec4 ${n}() {\n      return ${s.texture2D}(${e}, halfCR);\n    }\n  `}function pD(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`float ${n}() {return ${e};}`;const[s,i]=t.shapeInfo.texShape;if(1===s&&1===i)return`\n      float ${n}() {\n        return sampleTexture(${e}, halfCR);\n      }\n    `;const[r,o]=t.shapeInfo.texShape,a=lD(e);return`\n    float ${n}() {\n      vec2 uv = uvFromFlat(${r}, ${o}, ${a});\n      return sampleTexture(${e}, uv);\n    }\n  `}function dD(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1),s=t.shapeInfo.texShape,i=[Math.ceil(s[0]/2),Math.ceil(s[1]/2)],r=iR();return`\n    vec4 ${n}(int index) {\n      vec2 uv = packedUVfrom1D(\n        ${i[0]}, ${i[1]}, index);\n      return ${r.texture2D}(${e}, uv);\n    }\n  `}function fD(t){const e=t.name,n="get"+e.charAt(0).toUpperCase()+e.slice(1);if(t.shapeInfo.isUniform)return`\n      float ${n}(int index) {\n        ${kD(t)}\n      }\n    `;const s=t.shapeInfo.texShape,i=s[0],r=s[1];if(1===r&&1===i)return`\n      float ${n}(int index) {\n        return sampleTexture(${e}, halfCR);\n      }\n    `;const o=lD(e);return 1===r?`\n      float ${n}(int index) {\n        vec2 uv = vec2(0.5, (float(index + ${o}) + 0.5) / ${i}.0);\n        return sampleTexture(${e}, uv);\n      }\n    `:1===i?`\n      float ${n}(int index) {\n        vec2 uv = vec2((float(index + ${o}) + 0.5) / ${r}.0, 0.5);\n        return sampleTexture(${e}, uv);\n      }\n    `:`\n    float ${n}(int index) {\n      vec2 uv = uvFromFlat(${i}, ${r}, index + ${o});\n      return sampleTexture(${e}, uv);\n    }\n  `}function mD(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,r=i[0],o=i[1],a=iR();if(null!=i&&S(e,i))return`\n      vec4 ${s}(int row, int col) {\n        vec2 uv = (vec2(col, row) + halfCR) / vec2(${o}.0, ${r}.0);\n\n        return ${a.texture2D}(${n}, uv);\n      }\n    `;const u=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)],c=Math.ceil(e[1]/2);return`\n    vec4 ${s}(int row, int col) {\n      vec2 uv = packedUVfrom2D(${c}, ${u[0]}, ${u[1]}, row, col);\n      return ${a.texture2D}(${n}, uv);\n    }\n  `}function gD(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape;if(null!=i&&S(e,i)){const t=i[0],e=i[1];return`\n    float ${s}(int row, int col) {\n      vec2 uv = (vec2(col, row) + halfCR) / vec2(${e}.0, ${t}.0);\n      return sampleTexture(${n}, uv);\n    }\n  `}const{newShape:r,keptDims:o}=O(e),a=r;if(a.length<e.length){const e=CD(t,a),n=["row","col"];return`\n      ${BR(e)}\n      float ${s}(int row, int col) {\n        return ${s}(${AD(n,o)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col) {\n        int index = round(dot(vec2(row, col), vec2(${e[1]}, 1)));\n        ${kD(t)}\n      }\n    `;const u=i[0],c=i[1],l=lD(n);return 1===c?`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${l}), vec3(${e[1]}, 1, 1));\n      vec2 uv = vec2(0.5, (index + 0.5) / ${u}.0);\n      return sampleTexture(${n}, uv);\n    }\n  `:1===u?`\n    float ${s}(int row, int col) {\n      float index = dot(vec3(row, col, ${l}), vec3(${e[1]}, 1, 1));\n      vec2 uv = vec2((index + 0.5) / ${c}.0, 0.5);\n      return sampleTexture(${n}, uv);\n    }\n  `:`\n  float ${s}(int row, int col) {\n    // Explicitly use integer operations as dot() only works on floats.\n    int index = row * ${e[1]} + col + ${l};\n    vec2 uv = uvFromFlat(${u}, ${c}, index);\n    return sampleTexture(${n}, uv);\n  }\n`}function yD(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=t.shapeInfo.texShape,r=[Math.ceil(i[0]/2),Math.ceil(i[1]/2)];if(1===e[0]){const n=e.slice(1),i=[1,2],r=CD(t,n),o=["b","row","col"];return`\n        ${qR(r)}\n        vec4 ${s}(int b, int row, int col) {\n          return ${s}(${AD(o,i)});\n        }\n      `}const o=r[0],a=r[1],u=Math.ceil(e[2]/2),c=u*Math.ceil(e[1]/2),l=iR();return`\n    vec4 ${s}(int b, int row, int col) {\n      vec2 uv = packedUVfrom3D(\n        ${o}, ${a}, ${c}, ${u}, b, row, col);\n      return ${l.texture2D}(${n}, uv);\n    }\n  `}function bD(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[1]*e[2],r=e[2],{newShape:o,keptDims:a}=O(e),u=o;if(u.length<e.length){const e=CD(t,u),n=["row","col","depth"];return`\n        ${BR(e)}\n        float ${s}(int row, int col, int depth) {\n          return ${s}(${AD(n,a)});\n        }\n      `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth) {\n        int index = round(dot(vec3(row, col, depth),\n                          vec3(${i}, ${r}, 1)));\n        ${kD(t)}\n      }\n    `;const c=t.shapeInfo.texShape,l=c[0],h=c[1],p=t.shapeInfo.flatOffset;if(h===i&&null==p)return`\n        float ${s}(int row, int col, int depth) {\n          float texR = float(row);\n          float texC = dot(vec2(col, depth), vec2(${r}, 1));\n          vec2 uv = (vec2(texC, texR) + halfCR) /\n                     vec2(${h}.0, ${l}.0);\n          return sampleTexture(${n}, uv);\n        }\n      `;if(h===r&&null==p)return`\n    float ${s}(int row, int col, int depth) {\n      float texR = dot(vec2(row, col), vec2(${e[1]}, 1));\n      float texC = float(depth);\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${h}.0, ${l}.0);\n      return sampleTexture(${n}, uv);\n    }\n  `;const d=lD(n);return`\n      float ${s}(int row, int col, int depth) {\n        // Explicitly use integer operations as dot() only works on floats.\n        int index = row * ${i} + col * ${r} + depth + ${d};\n        vec2 uv = uvFromFlat(${l}, ${h}, index);\n        return sampleTexture(${n}, uv);\n      }\n  `}function vD(t){const e=t.shapeInfo.logicalShape,n=e.length,s=t.name,i="get"+s.charAt(0).toUpperCase()+s.slice(1),r=t.shapeInfo.texShape,o=[Math.ceil(r[0]/2),Math.ceil(r[1]/2)],a=o[0],u=o[1],c=Math.ceil(e[n-1]/2);let l=c*Math.ceil(e[n-2]/2),h="int b, int row, int col",p=`b * ${l} + (row / 2) * ${c} + (col / 2)`;for(let f=2;f<n-1;f++)h=`int b${f}, `+h,l*=e[n-f-1],p=`b${f} * ${l} + `+p;const d=iR();return`\n    vec4 ${i}(${h}) {\n      int index = ${p};\n      int texR = index / ${u};\n      int texC = index - texR * ${u};\n      vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${u}, ${a});\n      return ${d.texture2D}(${s}, uv);\n    }\n  `}function wD(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[3],r=e[2]*i,o=e[1]*r,{newShape:a,keptDims:u}=O(e);if(a.length<e.length){const e=CD(t,a),n=["row","col","depth","depth2"];return`\n      ${BR(e)}\n      float ${s}(int row, int col, int depth, int depth2) {\n        return ${s}(${AD(n,u)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth, int depth2) {\n        int index = round(dot(vec4(row, col, depth, depth2),\n                          vec4(${o}, ${r}, ${i}, 1)));\n        ${kD(t)}\n      }\n    `;const c=t.shapeInfo.flatOffset,l=t.shapeInfo.texShape,h=l[0],p=l[1];if(p===o&&null==c)return`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = float(row);\n        float texC =\n            dot(vec3(col, depth, depth2),\n                vec3(${r}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(p===i&&null==c)return`\n      float ${s}(int row, int col, int depth, int depth2) {\n        float texR = dot(vec3(row, col, depth),\n                         vec3(${e[1]*e[2]}, ${e[2]}, 1));\n        float texC = float(depth2);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${p}.0, ${h}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const d=lD(n);return`\n    float ${s}(int row, int col, int depth, int depth2) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${o} + col * ${r} +\n          depth * ${i} + depth2;\n      vec2 uv = uvFromFlat(${h}, ${p}, index + ${d});\n      return sampleTexture(${n}, uv);\n    }\n  `}function xD(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),i=e[4],r=e[3]*i,o=e[2]*r,a=e[1]*o,{newShape:u,keptDims:c}=O(e);if(u.length<e.length){const e=CD(t,u),n=["row","col","depth","depth2","depth3"];return`\n      ${BR(e)}\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        return ${s}(${AD(n,c)});\n      }\n    `}if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        float index = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${a}, ${o}, ${r}, ${i})) +\n          depth3;\n        ${kD(t)}\n      }\n    `;const l=t.shapeInfo.flatOffset,h=t.shapeInfo.texShape,p=h[0],d=h[1];if(d===a&&null==l)return`\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n                         vec4(${o}, ${r}, ${i}, 1));\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${d}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(d===i&&null==l)return`\n      float ${s}(int row, int col, int depth, int depth2, int depth3) {\n        float texR = dot(\n          vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]},\n               ${e[2]*e[3]}, ${e[3]}, 1));\n        int texC = depth3;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${d}.0, ${p}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const f=lD(n);return`\n    float ${s}(int row, int col, int depth, int depth2, int depth3) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${a} + col * ${o} + depth * ${r} +\n          depth2 * ${i} + depth3 + ${f};\n      vec2 uv = uvFromFlat(${p}, ${d}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}function _D(t){const e=t.shapeInfo.logicalShape,n=t.name,s="get"+n.charAt(0).toUpperCase()+n.slice(1),{newShape:i,keptDims:r}=O(e);if(i.length<e.length){const e=CD(t,i),n=["row","col","depth","depth2","depth3","depth4"];return`\n      ${BR(e)}\n      float ${s}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        return ${s}(${AD(n,r)});\n      }\n    `}const o=e[5],a=e[4]*o,u=e[3]*a,c=e[2]*u,l=e[1]*c;if(t.shapeInfo.isUniform)return`\n      float ${s}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n        int index = round(dot(\n          vec4(row, col, depth, depth2),\n          vec4(${l}, ${c}, ${u}, ${a})) +\n          dot(\n            vec2(depth3, depth4),\n            vec2(${o}, 1)));\n        ${kD(t)}\n      }\n    `;const h=t.shapeInfo.flatOffset,p=t.shapeInfo.texShape,d=p[0],f=p[1];if(f===l&&null==h)return`\n      float ${s}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        int texR = row;\n        float texC = dot(vec4(col, depth, depth2, depth3),\n          vec4(${c}, ${u}, ${a}, ${o})) +\n               float(depth4);\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                   vec2(${f}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;if(f===o&&null==h)return`\n      float ${s}(int row, int col, int depth,\n                    int depth2, int depth3, int depth4) {\n        float texR = dot(vec4(row, col, depth, depth2),\n          vec4(${e[1]*e[2]*e[3]*e[4]},\n               ${e[2]*e[3]*e[4]},\n               ${e[3]*e[4]},\n               ${e[4]})) + float(depth3);\n        int texC = depth4;\n        vec2 uv = (vec2(texC, texR) + halfCR) /\n                  vec2(${f}.0, ${d}.0);\n        return sampleTexture(${n}, uv);\n      }\n    `;const m=lD(n);return`\n    float ${s}(int row, int col, int depth,\n                  int depth2, int depth3, int depth4) {\n      // Explicitly use integer operations as dot() only works on floats.\n      int index = row * ${l} + col * ${c} + depth * ${u} +\n          depth2 * ${a} + depth3 * ${o} + depth4 + ${m};\n      vec2 uv = uvFromFlat(${d}, ${f}, index);\n      return sampleTexture(${n}, uv);\n    }\n  `}function kD(t){const e=t.name,n=k(t.shapeInfo.logicalShape);return n<2?`return ${e};`:`\n    for (int i = 0; i < ${n}; i++) {\n      if (i == index) {\n        return ${e}[i];\n      }\n    }\n  `}function SD(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",r=t.shapeInfo.logicalShape.length,o=e.logicalShape.length,a=LR(t.shapeInfo.logicalShape,e.logicalShape),u=ID(o),c=o-r;let l;const h=["x","y","z","w","u","v"];l=0===r?"":o<2&&a.length>=1?"coords = 0;":a.map((t=>`coords.${h[t+c]} = 0;`)).join("\n");let p="";p=o<2&&r>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${h[e+c]}`)).join(", ");let d="return outputValue;";const f=k(t.shapeInfo.logicalShape),m=1===f,g=k(e.logicalShape),y=1===g;if(1!==r||m||y){if(m&&!y)d=1===o?"\n        return vec4(outputValue.x, outputValue.x, 0., 0.);\n      ":"\n        return vec4(outputValue.x);\n      ";else if(a.length){const t=r-2,e=r-1;a.indexOf(t)>-1&&a.indexOf(e)>-1?d="return vec4(outputValue.x);":a.indexOf(t)>-1?d="return vec4(outputValue.x, outputValue.y, outputValue.x, outputValue.y);":a.indexOf(e)>-1&&(d="return vec4(outputValue.xx, outputValue.zz);")}}else d="\n      return vec4(outputValue.xy, outputValue.xy);\n    ";return`\n    vec4 ${i}() {\n      ${u} coords = getOutputCoords();\n      ${l}\n      vec4 outputValue = get${s}(${p});\n      ${d}\n    }\n  `}function TD(t,e){const n=t.name,s=n.charAt(0).toUpperCase()+n.slice(1),i="get"+s+"AtOutCoords",r=e.texShape,o=t.shapeInfo.texShape,a=t.shapeInfo.logicalShape.length,u=e.logicalShape.length;if(!t.shapeInfo.isUniform&&a===u&&null==t.shapeInfo.flatOffset&&S(o,r))return`\n      float ${i}() {\n        return sampleTexture(${n}, resultUV);\n      }\n    `;const c=ID(u),l=LR(t.shapeInfo.logicalShape,e.logicalShape),h=u-a;let p;const d=["x","y","z","w","u","v"];p=0===a?"":u<2&&l.length>=1?"coords = 0;":l.map((t=>`coords.${d[t+h]} = 0;`)).join("\n");let f="";return f=u<2&&a>0?"coords":t.shapeInfo.logicalShape.map(((t,e)=>`coords.${d[e+h]}`)).join(", "),`\n    float ${i}() {\n      ${c} coords = getOutputCoords();\n      ${p}\n      return get${s}(${f});\n    }\n  `}function ID(t){if(t<=1)return"int";if(2===t)return"ivec2";if(3===t)return"ivec3";if(4===t)return"ivec4";if(5===t)return"ivec5";if(6===t)return"ivec6";throw Error(`GPU for rank ${t} is not yet supported`)}function CD(t,e){const n=JSON.parse(JSON.stringify(t));return n.shapeInfo.logicalShape=e,n}function AD(t,e){return e.map((e=>t[e])).join(", ")}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ND(t,e,n,s){const i=e.userCode,r=n.map(((t,n)=>{const s={logicalShape:t.shape,texShape:t.isUniform?null:t.texData.texShape,isUniform:t.isUniform,isPacked:!t.isUniform&&t.texData.isPacked,flatOffset:null};return null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0&&(s.flatOffset=t.texData.slice.flatOffset),{name:e.variableNames[n],shapeInfo:s}})),o=r.map((t=>t.shapeInfo)),a={logicalShape:s.shape,texShape:s.texData.texShape,isUniform:!1,isPacked:s.texData.isPacked,flatOffset:null},u=zR(r,a,i,e.packedInputs),c=t.createProgram(u);let l=null;const h=t.getUniformLocation(c,"NAN",!1);1===at().getNumber("WEBGL_VERSION")&&(l=t.getUniformLocation(c,"INFINITY",!1));const p={};for(let d=0;d<e.variableNames.length;d++){const n=e.variableNames[d],s=!1;p[n]=t.getUniformLocation(c,n,s),p[`offset${n}`]=t.getUniformLocation(c,`offset${n}`,s)}return{program:e,source:u,webGLProgram:c,uniformLocations:p,inShapeInfos:o,outShapeInfo:a,infLoc:l,nanLoc:h}}function ED(t,e){if(t.length!==e.length)throw Error(`Binary was compiled with ${t.length} inputs, but was executed with ${e.length} inputs`);t.forEach(((t,n)=>{const s=t.logicalShape,i=e[n],r=i.shape;if(!S(s,r))throw Error(`Binary was compiled with different shapes than the current args. Shapes ${s} and ${r} must match`);if(t.isUniform&&i.isUniform)return;const o=t.texShape,a=i.isUniform?null:i.texData.texShape;if(!S(o,a))throw Error(`Binary was compiled with different texture shapes than the current args. Shape ${o} and ${a} must match`)}))}function OD(t,e,n,s,i){ED(e.inShapeInfos,n),ED([e.outShapeInfo],[s]);const r=s.texData.texture,o=s.texData.texShape;s.texData.isPacked?t.setOutputPackedMatrixTexture(r,o[0],o[1]):t.setOutputMatrixTexture(r,o[0],o[1]),t.setProgram(e.webGLProgram),1===at().getNumber("WEBGL_VERSION")&&null!==e.infLoc&&t.gl.uniform1f(e.infLoc,1/0),null!==e.nanLoc&&t.gl.uniform1f(e.nanLoc,NaN),n.forEach(((n,s)=>{const i=e.program.variableNames[s],r=e.uniformLocations[i],o=e.uniformLocations[`offset${i}`];if(null!=r)if(n.isUniform)if(k(n.shape)<2)t.gl.uniform1f(r,n.uniformValues[0]);else{let e=n.uniformValues;e instanceof Float32Array||(e=new Float32Array(e)),t.gl.uniform1fv(r,e)}else null!=n.texData.slice&&null!=o&&t.gl.uniform1i(o,n.texData.slice.flatOffset),t.setInputMatrixTexture(n.texData.texture,r,s)})),null!=i&&i(t,e.webGLProgram),t.executeProgram()}function $D(t,e,n){let s="";e.concat(n).forEach((t=>{const e=null!=t.texData&&null!=t.texData.slice&&t.texData.slice.flatOffset>0,n=t.isUniform?"uniform":t.texData.texShape;s+=`${t.shape}_${n}_${e}`}));const i=t.userCode;let r=t.constructor.name;return r+="_"+s+"_"+i,r}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const{addImpl:RD,bincountImpl:DD,bincountReduceImpl:MD,ceilImpl:PD,concatImpl:FD,expImpl:LD,expm1Impl:zD,floorImpl:BD,gatherV2Impl:qD,greaterImpl:VD,lessImpl:WD,linSpaceImpl:jD,logImpl:UD,maxImpl:GD,maximumImpl:HD,minimumImpl:KD,multiplyImpl:XD,negImpl:QD,prodImpl:YD,rangeImpl:ZD,rsqrtImpl:JD,simpleAbsImpl:tM,sliceImpl:eM,stridedSliceImpl:nM,subImpl:sM,tileImpl:iM,topKImpl:rM,transposeImpl:oM,uniqueImpl:aM}=o;
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uM(t,e){return["x","y","z","w","u","v"].slice(0,e).map((e=>`${t}.${e}`))}function cM(t,e){return 1===e?[t]:uM(t,e)}function lM(t,e){if(1===t)return"rc";let n="";for(let s=0;s<t;s++)n+=e[s],s<t-1&&(n+=",");return n}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class hM{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0,this.outputShape=t;const e=t.length;if(0===e)this.userCode="\n        void main() {\n          setOutput(vec4(getA(), 0., 0., 0.));\n        }\n      ";else{const n=cM("rc",e),s=ID(e),i=dM(e,t,n),r=fM(e,t[t.length-1],t[t.length-2],n),o=mM(t,n);this.userCode=`\n        void main() {\n          ${s} rc = getOutputCoords();\n\n          if(${i}) {\n            setOutput(vec4(0));\n          } else {\n            ${r}\n\n            setOutput(vec4(${o}));\n          }\n        }\n      `}}}function pM(t,e){const n=[];for(let s=0;s<=1;s++)for(let i=0;i<=1;i++){let r=`${0===s?"r":"rp1"}, ${0===i?"c":"cp1"}`;for(let n=2;n<t;n++)r=`${e[e.length-1-n]},`+r;n.push(r)}return n}function dM(t,e,n){if(1===t)return`rc > ${e[0]}`;let s="";for(let i=t-2;i<t;i++)s+=`${n[i]} >= ${e[i]}`,i<t-1&&(s+="||");return s}function fM(t,e,n,s){if(1===t)return"";const i=s.slice(-2);return`\n    int r = ${i[0]};\n    int c = ${i[1]};\n    int rp1 = r + 1;\n    int cp1 = c + 1;\n\n    bool cEdge = cp1 >= ${e};\n    bool rEdge = rp1 >= ${n};\n  `}function mM(t,e){const n=t.length,s=pM(n,e);return 1===n?`getA(rc),\n            rc + 1 >= ${t[0]} ? 0. : getA(rc + 1),\n            0, 0`:`getA(${s[0]}),\n          cEdge ? 0. : getA(${s[1]}),\n          rEdge ? 0. : getA(${s[2]}),\n          rEdge || cEdge ? 0. : getA(${s[3]})`}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class gM{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;let n="";for(let s=0;s<4;s++){let t="thisRC = rc;";s%2===1&&(t+="thisRC.z += 1;"),s>1&&(t+="thisRC.y += 1;"),n+=`\n        ${t}\n        ${s>0?"if(thisRC.y < rows && thisRC.z < cols){":""}\n          int flatIndex = getFlatIndex(thisRC);\n\n          ivec3 inputRC = inputCoordsFromReshapedOutCoords(flatIndex);\n          vec2 inputRCInnerDims = vec2(float(inputRC.y),float(inputRC.z));\n\n          result[${s}] =\n            getChannel(getA(inputRC.x, inputRC.y, inputRC.z), inputRCInnerDims);\n        ${s>0?"}":""}\n      `}this.userCode=`\n      ${yM(e)}\n      ${oR(t)}\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n\n        vec4 result = vec4(0.);\n\n        ivec3 thisRC;\n        int rows = ${t[1]};\n        int cols = ${t[2]};\n\n        ${n}\n\n        setOutput(result);\n      }\n    `}}function yM(t){const e=rR(["r","c","d"],t);return`\n    ivec3 inputCoordsFromReshapedOutCoords(int index) {\n      ${e}\n      return ivec3(r, c, d);\n    }\n  `}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class bM{constructor(t){this.gpgpu=t,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0,this.freeTextures={},this.logEnabled=!1,this.usedTextures={}}acquireTexture(t,e,n){const s=kM(e,n),i=SM(t,s,n);i in this.freeTextures||(this.freeTextures[i]=[]),i in this.usedTextures||(this.usedTextures[i]=[]);const r=wM(t,s,this.gpgpu.gl,this.gpgpu.textureConfig,n);if(this.freeTextures[i].length>0){this.numFreeTextures--,this.numUsedTextures++,this._numBytesFree-=r,this.log();const t=this.freeTextures[i].shift();return this.usedTextures[i].push(t),t}let o;return s===e$.PACKED_2X2_FLOAT32?o=this.gpgpu.createPackedMatrixTexture(t[0],t[1]):s===e$.PACKED_2X2_FLOAT16?o=this.gpgpu.createFloat16PackedMatrixTexture(t[0],t[1]):s===e$.UNPACKED_FLOAT32?o=this.gpgpu.createFloat32MatrixTexture(t[0],t[1]):s===e$.UNPACKED_FLOAT16?o=this.gpgpu.createFloat16MatrixTexture(t[0],t[1]):s===e$.PACKED_4X1_UNSIGNED_BYTE&&(o=this.gpgpu.createUnsignedBytesMatrixTexture(t[0],t[1])),this.usedTextures[i].push(o),this.numUsedTextures++,this._numBytesAllocated+=r,this.log(),o}releaseTexture(t,e,n,s){if(null==this.freeTextures)return;const i=kM(n,s),r=SM(e,i,s);r in this.freeTextures||(this.freeTextures[r]=[]);const o=wM(e,i,this.gpgpu.gl,this.gpgpu.textureConfig,s),a=at().get("WEBGL_DELETE_TEXTURE_THRESHOLD");-1!==a&&this._numBytesAllocated>a?(this.gpgpu.deleteMatrixTexture(t),this._numBytesAllocated-=o):(this.freeTextures[r].push(t),this.numFreeTextures++,this._numBytesFree+=o),this.numUsedTextures--;const u=this.usedTextures[r],c=u.indexOf(t);if(c<0)throw new Error("Cannot release a texture that was never provided by this texture manager");u.splice(c,1),this.log()}log(){if(!this.logEnabled)return;const t=this.numFreeTextures+this.numUsedTextures;console.log("Free/Used",`${this.numFreeTextures} / ${this.numUsedTextures}`,`(${t})`);const e=this._numBytesFree/this._numBytesAllocated;console.log(`Bytes allocated: ${this._numBytesAllocated}`),console.log(`Bytes unused: ${this._numBytesFree} (${Math.round(100*e)}%)`)}get numBytesAllocated(){return this._numBytesAllocated}get numBytesFree(){return this._numBytesFree}getNumUsedTextures(){return this.numUsedTextures}getNumFreeTextures(){return this.numFreeTextures}dispose(){if(null!=this.freeTextures){for(const t in this.freeTextures)this.freeTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t)}));for(const t in this.usedTextures)this.usedTextures[t].forEach((t=>{this.gpgpu.deleteMatrixTexture(t)}));this.freeTextures=null,this.usedTextures=null,this.numUsedTextures=0,this.numFreeTextures=0,this._numBytesAllocated=0,this._numBytesFree=0}}}function vM(t,e){const n=t;if(e===n.R32F)return 4;if(e===n.R16F)return 2;if(e===n.RGBA32F)return 16;if(e===t.RGBA)return 16;if(e===n.RGBA16F)return 8;throw new Error(`Unknown internal format ${e}`)}function wM(t,e,n,s,i){const r=xM(e,s);let o;if(i){const[e,n]=r$(t[0],t[1]);o=e*n}else{const[e,n]=n$(t[0],t[1]);o=e*n}const a=vM(n,r);return o*a}function xM(t,e){switch(t){case e$.PACKED_2X2_FLOAT32:return SR(e);case e$.PACKED_2X2_FLOAT16:return IR(e);case e$.UNPACKED_FLOAT32:return bR(e);case e$.UNPACKED_FLOAT16:return wR(e);case e$.PACKED_4X1_UNSIGNED_BYTE:return _R(e);default:throw new Error(`Unknown physical texture type ${t}`)}}function _M(t){return at().getBool("WEBGL_RENDER_FLOAT32_ENABLED")?t?e$.PACKED_2X2_FLOAT32:e$.UNPACKED_FLOAT32:t?e$.PACKED_2X2_FLOAT16:e$.UNPACKED_FLOAT16}function kM(t,e){if(t===t$.UPLOAD)return e$.PACKED_2X2_FLOAT32;if(t===t$.RENDER||null==t)return _M(e);if(t===t$.DOWNLOAD||t===t$.PIXELS)return e$.PACKED_4X1_UNSIGNED_BYTE;throw new Error(`Unknown logical texture type ${t}`)}function SM(t,e,n){return`${t[0]}_${t[1]}_${e}_${n}`}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class TM{constructor(t,e){this.variableNames=["A"],this.outputShape=t,this.userCode=`\n      float unaryOperation(float x) {\n        ${e}\n      }\n\n      void main() {\n        float x = getAAtOutCoords();\n        float y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}const IM="if (isnan(x)) return x;",CM="return x;",AM="return abs(x);";const NM="return (x >= 0.0) ? x : (exp(x) - 1.0);",EM=IM+"\n  return (x < 0.0) ? 0.0 : x;\n",OM=IM+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",$M="return x;",RM="return x;",DM="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",MM="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",PM="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n";class FM{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode=`\n      vec4 unaryOperation(vec4 x) {\n        ${e}\n      }\n\n      void main() {\n        vec4 x = getAAtOutCoords();\n        vec4 y = unaryOperation(x);\n\n        setOutput(y);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class LM{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!1,this.outputShape=t;const e=t.length,n=cM("rc",e),s=ID(e),i=lM(e,n),r=n.slice(-2),o=e<=1?"rc":`vec2(${r.join(",")})`;this.userCode=`\n      void main() {\n        ${s} rc = getOutputCoords();\n        vec4 packedInput = getA(${i});\n\n        setOutput(getChannel(packedInput, ${o}));\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const zM=Qp,BM=1e-7,qM=1e-4,VM={};function WM(t){return t in VM||(VM[t]={}),VM[t]}const jM=128,UM=600;function GM(){return null==at().global.screen?1024:at().global.screen.height*at().global.screen.width*window.devicePixelRatio*UM/1024/1024}class HM extends d{constructor(t){if(super(),this.pendingRead=new WeakMap,this.pendingDisposal=new WeakSet,this.dataRefCount=new WeakMap,this.numBytesInGPU=0,this.uploadWaitMs=0,this.downloadWaitMs=0,this.warnedAboutMemory=!1,this.warnedAboutCPUBackend=!1,this.pendingDeletes=0,this.disposed=!1,!at().getBool("HAS_WEBGL"))throw new Error("WebGL is not supported on this device");if(null==t){const t=QO(at().getNumber("WEBGL_VERSION"));this.binaryCache=WM(at().getNumber("WEBGL_VERSION")),this.gpgpu=new PR(t),this.canvas=t.canvas,this.gpgpuCreatedLocally=!0}else this.gpgpu=t,this.binaryCache={},this.gpgpuCreatedLocally=!1,this.canvas=t.gl.canvas;this.textureManager=new bM(this.gpgpu),this.numMBBeforeWarning=GM(),this.texData=new p(this,oo())}numDataIds(){return this.texData.numDataIds()+(this.cpuBackend?this.cpuBackend.numDataIds():0)-this.pendingDeletes}write(t,e,n){if((at().getBool("WEBGL_CHECK_NUMERICAL_PROBLEMS")||at().getBool("DEBUG"))&&this.checkNumericalProblems(t),"complex64"===n&&null!=t)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");const s={};return this.texData.set(s,{shape:e,dtype:n,values:t,usage:t$.UPLOAD,refCount:1,complexParentRefCount:0}),s}incRef(t){const e=this.texData.get(t);e.refCount++}decRef(t){if(this.texData.has(t)){const e=this.texData.get(t);e.refCount--}}decComplexRef(t){if(this.texData.has(t)){const e=this.texData.get(t);e.complexParentRefCount>0&&e.refCount--}}move(t,e,n,s){if(at().getBool("DEBUG")&&this.checkNumericalProblems(e),"complex64"===s)throw new Error("Cannot write to a complex64 dtype. Please use tf.complex(real, imag).");this.texData.set(t,{shape:n,dtype:s,values:e,usage:t$.UPLOAD,refCount:1,complexParentRefCount:0})}disposeIntermediateTensorInfo(t){const e=t.dataId;if(this.texData.has(e)){const t=this.texData.get(e);t.refCount--,t.refCount<1&&this.disposeData(e)}}readSync(t){const e=this.texData.get(t),{values:n,dtype:s,complexTensorInfos:i,slice:r,shape:o,isPacked:a}=e;if(null!=r){let e;e=a?new FM(o,$M):new TM(o,$M);const n=this.runWebGLProgram(e,[{dataId:t,shape:o,dtype:s}],s),i=this.readSync(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if("string"===s)return n;const u=null!=this.activeTimers;let c,l;if(u&&(c=Ds()),"complex64"===s){const t=this.readSync(i.real.dataId),e=this.readSync(i.imag.dataId);l=Dp(t,e)}else l=this.getValuesFromTexture(t);return u&&(this.downloadWaitMs+=Ds()-c),this.convertAndCacheOnCPU(t,l)}async read(t){if(this.pendingRead.has(t)){const e=this.pendingRead.get(t);return new Promise((t=>e.push(t)))}const e=this.texData.get(t),{values:n,shape:s,slice:i,dtype:r,complexTensorInfos:o,isPacked:a}=e;if(null!=i){let e;e=a?new FM(s,$M):new TM(s,$M);const n=this.runWebGLProgram(e,[{dataId:t,shape:s,dtype:r}],r),i=this.read(n.dataId);return this.disposeIntermediateTensorInfo(n),i}if(null!=n)return this.convertAndCacheOnCPU(t);if(!at().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")&&2===at().getNumber("WEBGL_VERSION"))throw new Error("tensor.data() with WEBGL_DOWNLOAD_FLOAT_ENABLED=false and WEBGL_VERSION=2 not yet supported.");let u,c,l=null;if("complex64"!==r&&at().get("WEBGL_BUFFER_SUPPORTED")){u=this.decode(t);const e=this.texData.get(u.dataId);l=this.gpgpu.createBufferFromTexture(e.texture,...i$(s))}if(this.pendingRead.set(t,[]),"complex64"!==r&&await this.gpgpu.createAndWaitForFence(),"complex64"===r){const t=await Promise.all([this.read(o.real.dataId),this.read(o.imag.dataId)]),e=t[0],n=t[1];c=Dp(e,n)}else if(null==l)c=this.getValuesFromTexture(t);else{const t=k(s);c=this.gpgpu.downloadFloat32MatrixFromBuffer(l,t)}null!=u&&this.disposeIntermediateTensorInfo(u);const h=this.convertAndCacheOnCPU(t,c),p=this.pendingRead.get(t);return this.pendingRead.delete(t),p.forEach((t=>t(h))),this.pendingDisposal.has(t)&&(this.pendingDisposal.delete(t),this.disposeData(t),this.pendingDeletes--),h}bufferSync(t){const e=this.readSync(t.dataId);let n=e;if("string"===t.dtype)try{n=e.map((t=>Ps(t)))}catch(s){throw new Error("Failed to decode encoded string bytes into utf-8")}return fr(t.shape,t.dtype,n)}checkNumericalProblems(t){if(null!=t)for(let e=0;e<t.length;e++){const n=t[e];if(!p$(n)){if(at().getBool("WEBGL_RENDER_FLOAT32_CAPABLE"))throw Error(`The value ${n} cannot be represented with your current settings. Consider enabling float32 rendering: 'tf.env().set('WEBGL_RENDER_FLOAT32_ENABLED', true);'`);throw Error(`The value ${n} cannot be represented on this device.`)}}}getValuesFromTexture(t){const{shape:e,dtype:n,isPacked:s}=this.texData.get(t),i=k(e);if(at().getBool("WEBGL_DOWNLOAD_FLOAT_ENABLED")){const n=this.decode(t),s=this.texData.get(n.dataId),r=this.gpgpu.downloadMatrixFromPackedTexture(s.texture,...i$(e)).subarray(0,i);return this.disposeIntermediateTensorInfo(n),r}const r=at().getBool("WEBGL_PACK")&&!0===s,o=r?B$(e):e,a=r?new hR(o):new lR(o),u=this.runWebGLProgram(a,[{shape:o,dtype:n,dataId:t}],"float32"),c=this.texData.get(u.dataId),l=this.gpgpu.downloadByteEncodedFloatMatrixFromOutputTexture(c.texture,c.texShape[0],c.texShape[1]).subarray(0,i);return this.disposeIntermediateTensorInfo(u),l}async time(t){const e=this.activeTimers,n=[];let s=!1;null==this.programTimersStack?(this.programTimersStack=n,s=!0):this.activeTimers.push(n),this.activeTimers=n,t();const i=_(this.activeTimers.map((t=>t.query))).filter((t=>null!=t)),r=_(this.activeTimers.map((t=>t.name))).filter((t=>null!=t));this.activeTimers=e,s&&(this.programTimersStack=null);const o={uploadWaitMs:this.uploadWaitMs,downloadWaitMs:this.downloadWaitMs,kernelMs:null,wallMs:null};if(at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0){const t=await Promise.all(i);o["kernelMs"]=b(t),o["getExtraProfileInfo"]=()=>t.map(((t,e)=>({name:r[e],ms:t}))).map((t=>`${t.name}: ${t.ms}`)).join(", ")}else o["kernelMs"]={error:"WebGL query timers are not supported in this environment."};return this.uploadWaitMs=0,this.downloadWaitMs=0,o}memory(){return{unreliable:!1,numBytesInGPU:this.numBytesInGPU,numBytesInGPUAllocated:this.textureManager.numBytesAllocated,numBytesInGPUFree:this.textureManager.numBytesFree}}startTimer(){return at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?this.gpgpu.beginQuery():{startMs:Ds(),endMs:null}}endTimer(t){return at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0?(this.gpgpu.endQuery(),t):(t.endMs=Ds(),t)}async getQueryTime(t){if(at().getNumber("WEBGL_DISJOINT_QUERY_TIMER_EXTENSION_RELIABLE")>0)return this.gpgpu.waitForQueryAndGetTime(t);const e=t;return e.endMs-e.startMs}disposeData(t){if(this.pendingDisposal.has(t))return;if(this.pendingRead.has(t))return this.pendingDisposal.add(t),void this.pendingDeletes++;if(!this.texData.has(t))return;if(this.texData.get(t).complexParentRefCount>0)return void this.texData.get(t).refCount--;this.releaseGPUData(t);const{complexTensorInfos:e}=this.texData.get(t);null!=e&&(this.texData.get(e.real.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(e.real),this.texData.get(e.imag.dataId).complexParentRefCount--,this.disposeIntermediateTensorInfo(e.imag)),this.texData.delete(t)}releaseGPUData(t){const{texture:e,dtype:n,texShape:s,usage:i,isPacked:r,slice:o}=this.texData.get(t),a=o&&o.origDataId||t,u=this.dataRefCount.get(a);u>1?this.dataRefCount.set(a,u-1):(this.dataRefCount.delete(a),null!=e&&(this.numBytesInGPU-=this.computeBytes(s,n),this.textureManager.releaseTexture(e,s,i,r)));const c=this.texData.get(t);c.texture=null,c.texShape=null,c.isPacked=!1,c.slice=null}getTexture(t){return this.uploadToGPU(t),this.texData.get(t).texture}getDataInfo(t){return this.texData.get(t)}getCPUBackend(){return at().getBool("WEBGL_CPU_FORWARD")?(null==this.cpuBackend&&(this.cpuBackend=oo().findBackend("cpu")),this.cpuBackend):null}shouldExecuteOnCPU(t,e=jM){const n=this.getCPUBackend();return at().getBool("IS_TEST")||this.warnedAboutCPUBackend||null!=n||(console.warn("Your application contains ops that are small enough to be executed on the CPU backend, however the CPU backend cannot be found. Consider importing the CPU backend (@tensorflow/tfjs-backend-cpu) for better performance."),this.warnedAboutCPUBackend=!0),null!=n&&t.every((t=>null==this.texData.get(t.dataId).texture&&k(t.shape)<e))}getGPGPUContext(){return this.gpgpu}where(t){$p("tf.where() in webgl locks the UI thread. Call tf.whereAsync() instead");const e=t.dataSync();return zM(t.shape,e)}packedUnaryOp(t,e,n){const s=new FM(t.shape,e);return this.compileAndRun(s,[t],n)}abs(t){if(this.shouldExecuteOnCPU([t])&&"complex64"!==t.dtype){const e=tM(this.texData.get(t.dataId).values);return this.makeOutput(t.shape,t.dtype,e)}if(at().getBool("WEBGL_PACK_UNARY_OPERATIONS"))return this.packedUnaryOp(t,AM,t.dtype);const e=new TM(t.shape,AM);return this.compileAndRun(e,[t])}makeTensorInfo(t,e,n){let s;if("string"===e&&null!=n&&n.length>0&&B(n[0])){const i=n.map((t=>Ms(t)));s=this.write(i,t,e)}else s=this.write(n,t,e);return this.texData.get(s).usage=null,{dataId:s,shape:t,dtype:e}}makeOutput(t,e,n){const{dataId:s}=this.makeTensorInfo(t,e,n);return oo().makeTensorFromDataId(s,t,e,this)}unpackTensor(t){const e=new LM(t.shape);return this.runWebGLProgram(e,[t],t.dtype)}packTensor(t){const e=new hM(t.shape),n=!0;return this.runWebGLProgram(e,[t],t.dtype,null,n)}packedReshape(t,e){const n=[L$(t.shape),...z$(t.shape)],s={dtype:t.dtype,shape:n,dataId:t.dataId},i=[L$(e),...z$(e)],r=new gM(i,n),o=!0,a=this.runWebGLProgram(r,[s],t.dtype,null,o);return{dataId:a.dataId,shape:e,dtype:a.dtype}}decode(t){const e=this.texData.get(t),{isPacked:n,shape:s,dtype:i}=e,r=B$(s);let o;o=n?new cR(r):new uR(r);const a=!0,u=this.runWebGLProgram(o,[{shape:r,dtype:i,dataId:t}],i,null,a);return{dtype:i,shape:s,dataId:u.dataId}}runWebGLProgram(t,e,n,s,i=!1){const r=this.makeTensorInfo(t.outputShape,n),o=this.texData.get(r.dataId);if(t.packedOutput&&(o.isPacked=!0),t.outPackingScheme===JO.DENSE){const e=i$(t.outputShape);o.texShape=e.map((t=>2*t))}if(null!=t.outTexUsage&&(o.usage=t.outTexUsage),0===k(r.shape))return o.values=$(r.dtype,0),r;const a=[],u=e.map((e=>{if("complex64"===e.dtype)throw new Error("GPGPUProgram does not support complex64 input. For complex64 dtypes, please separate the program into real and imaginary parts.");let n=this.texData.get(e.dataId);if(null==n.texture){if(!t.packedInputs&&k(e.shape)<=at().getNumber("WEBGL_SIZE_UPLOAD_UNIFORM"))return{shape:e.shape,texData:null,isUniform:!0,uniformValues:n.values};t.packedInputs&&(n.isPacked=!0,n.shape=e.shape)}else if(!!n.isPacked!==!!t.packedInputs)e=n.isPacked?this.unpackTensor(e):this.packTensor(e),a.push(e),n=this.texData.get(e.dataId);else if(n.isPacked&&!W$(n.shape,e.shape)){const t=e,s=e.shape;e.shape=n.shape,e=this.packedReshape(e,s),a.push(e),n=this.texData.get(e.dataId),t.shape=s}return this.uploadToGPU(e.dataId),{shape:e.shape,texData:n,isUniform:!1}}));this.uploadToGPU(r.dataId);const c={shape:r.shape,texData:o,isUniform:!1},l=$D(t,u,c),h=this.getAndSaveBinary(l,(()=>ND(this.gpgpu,t,u,c))),p=null!=this.activeTimers;let d;if(p&&(d=this.startTimer()),OD(this.gpgpu,h,u,c,s),a.forEach((t=>this.disposeIntermediateTensorInfo(t))),p&&(d=this.endTimer(d),this.activeTimers.push({name:t.constructor.name,query:this.getQueryTime(d)})),!at().getBool("WEBGL_LAZILY_UNPACK")&&o.isPacked&&!1===i){const t=this.unpackTensor(r);return this.disposeIntermediateTensorInfo(r),t}return r}compileAndRun(t,e,n,s,i=!1){n=n||e[0].dtype;const r=this.runWebGLProgram(t,e,n,s,i);return oo().makeTensorFromDataId(r.dataId,r.shape,r.dtype)}getAndSaveBinary(t,e){return t in this.binaryCache||(this.binaryCache[t]=e()),this.binaryCache[t]}getTextureManager(){return this.textureManager}dispose(){if(!this.disposed){if(!at().getBool("IS_TEST")){const t=Object.keys(this.binaryCache);t.forEach((t=>{this.gpgpu.deleteProgram(this.binaryCache[t].webGLProgram),delete this.binaryCache[t]}))}this.textureManager.dispose(),null!=this.canvas&&"undefined"!==typeof HTMLCanvasElement&&this.canvas instanceof HTMLCanvasElement?this.canvas.remove():this.canvas=null,this.gpgpuCreatedLocally&&(this.gpgpu.program=null,this.gpgpu.dispose()),this.disposed=!0}}floatPrecision(){return null==this.floatPrecisionValue&&(this.floatPrecisionValue=uo((()=>{if(!at().get("WEBGL_RENDER_FLOAT32_ENABLED")){const t=at().getBool("DEBUG");at().set("DEBUG",!1);const e=this.abs(go(1e-8)).dataSync()[0];if(at().set("DEBUG",t),e>0)return 32}return 16}))),this.floatPrecisionValue}epsilon(){return 32===this.floatPrecision()?BM:qM}uploadToGPU(t){const e=this.texData.get(t),{shape:n,dtype:s,values:i,texture:r,usage:o,isPacked:a}=e;if(null!=r)return;const u=null!=this.activeTimers;let c;u&&(c=Ds());let l=e.texShape;if(null==l&&(l=q$(n,a),e.texShape=l),null!=i){const t=B$(n);let r,o=l[1],h=l[0];const p=i instanceof Uint8Array;a?([o,h]=r$(l[0],l[1]),r=new dR(t,[h,o],p)):r=new pR(t,[h,o],p);const d=this.makeTensorInfo([h,o],s);this.texData.get(d.dataId).usage=p?t$.PIXELS:t$.UPLOAD,this.gpgpu.uploadDenseMatrixToTexture(this.getTexture(d.dataId),o,h,i);const f=!0,m=this.runWebGLProgram(r,[d],s,null,f),g=this.texData.get(m.dataId);e.texture=g.texture,e.texShape=g.texShape,e.isPacked=g.isPacked,e.usage=g.usage,this.disposeIntermediateTensorInfo(d),this.texData.delete(m.dataId),e.values=null,u&&(this.uploadWaitMs+=Ds()-c)}else{const t=this.acquireTexture(l,o,s,a);e.texture=t}}convertAndCacheOnCPU(t,e){const n=this.texData.get(t),{dtype:s}=n;return this.releaseGPUData(t),null!=e&&(n.values=KM(e,s)),n.values}acquireTexture(t,e,n,s){if(this.numBytesInGPU+=this.computeBytes(t,n),!this.warnedAboutMemory&&this.numBytesInGPU>1024*this.numMBBeforeWarning*1024){const t=(this.numBytesInGPU/1024/1024).toFixed(2);this.warnedAboutMemory=!0,console.warn(`High memory usage in GPU: ${t} MB, most likely due to a memory leak`)}return this.textureManager.acquireTexture(t,e,s)}computeBytes(t,e){return t[0]*t[1]*L(e)}}function KM(t,e){if("float32"===e||"complex64"===e)return t;if("int32"===e||"bool"===e){const n="int32"===e?new Int32Array(t.length):new Uint8Array(t.length);for(let e=0;e<n.length;++e)n[e]=Math.round(t[e]);return n}throw new Error(`Unknown dtype ${e}`)}
/**
 * @license
 * Copyright 2020 Google Inc. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
di()&&ho("webgl",(()=>new HM),2);const XM="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n";class QM{constructor(t,e,n){this.variableNames=["A","B"],this.outputShape=La(e,n),this.userCode=`\n      float binaryOperation(float a, float b) {\n        ${t}\n      }\n\n      void main() {\n        float a = getAAtOutCoords();\n        float b = getBAtOutCoords();\n        setOutput(binaryOperation(a, b));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const YM="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n";class ZM{constructor(t,e,n,s=!1){this.variableNames=["A","B"],this.supportsBroadcasting=!0,this.packedInputs=!0,this.packedOutput=!0,this.outputShape=La(e,n);const i=this.outputShape.length;let r="";if(s)if(0===i||1===k(this.outputShape))r="\n          result.y = 0.;\n          result.z = 0.;\n          result.w = 0.;\n        ";else{const t=ID(i);if(r=`\n          ${t} coords = getOutputCoords();\n        `,1===i)r+=`\n            result.y = (coords + 1) >= ${this.outputShape[0]} ? 0. : result.y;\n            result.z = 0.;\n            result.w = 0.;\n          `;else{const t=cM("coords",i);r+=`\n            bool nextRowOutOfBounds =\n              (${t[i-2]} + 1) >= ${this.outputShape[i-2]};\n            bool nextColOutOfBounds =\n              (${t[i-1]} + 1) >= ${this.outputShape[i-1]};\n            result.y = nextColOutOfBounds ? 0. : result.y;\n            result.z = nextRowOutOfBounds ? 0. : result.z;\n            result.w = nextColOutOfBounds || nextRowOutOfBounds ? 0. : result.w;\n          `}}this.userCode=`\n      vec4 binaryOperation(vec4 a, vec4 b) {\n        ${t}\n      }\n\n      void main() {\n        vec4 a = getAAtOutCoords();\n        vec4 b = getBAtOutCoords();\n\n        vec4 result = binaryOperation(a, b);\n        ${r}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function JM(t){const{inputs:e,backend:n}=t,{x:s}=e;return n.incRef(s.dataId),{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}const tP={kernelName:Te,backendName:"webgl",kernelFunc:JM};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function eP(t){const{inputs:e,backend:n}=t,{real:s,imag:i}=e,r=n.makeTensorInfo(s.shape,"complex64"),o=n.texData.get(r.dataId),a=JM({inputs:{x:s},backend:n}),u=n.texData.get(a.dataId);u.complexParentRefCount++;const c=JM({inputs:{x:i},backend:n}),l=n.texData.get(c.dataId);return l.complexParentRefCount++,o.complexTensorInfos={real:a,imag:c},r}const nP={kernelName:zt,backendName:"webgl",kernelFunc:eP},sP="return (a < 0.) ? b * a : a;",iP="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";function rP(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{alpha:r}=s,o=n.makeTensorInfo([],"float32",Os(r,"float32")),a=at().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZM(iP,i.shape,o.shape):new QM(sP,i.shape,o.shape),u=n.runWebGLProgram(a,[i,o],i.dtype);return n.disposeIntermediateTensorInfo(o),u}const oP={kernelName:Oe,backendName:"webgl",kernelFunc:rP},aP="return (a < 0.) ? b * a : a;",uP="\n  vec4 aLessThanZero = vec4(lessThan(a, vec4(0.)));\n  return (aLessThanZero * (b * a)) + ((vec4(1.0) - aLessThanZero) * a);\n";function cP(t){const{inputs:e,backend:n}=t,{x:s,alpha:i}=e,r=at().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZM(uP,s.shape,i.shape):new QM(aP,s.shape,i.shape);return n.runWebGLProgram(r,[s,i],s.dtype)}const lP={kernelName:fn,backendName:"webgl",kernelFunc:cP},hP="if (isnan(x)) return x;",pP="\n  if (isnan(a)) return a;\n  if (isnan(b)) return b;\n",dP="\n  result.r = isNaN.r > 0. ? NAN : result.r;\n  result.g = isNaN.g > 0. ? NAN : result.g;\n  result.b = isNaN.b > 0. ? NAN : result.b;\n  result.a = isNaN.a > 0. ? NAN : result.a;\n";function fP({opSnippet:t,packedOpSnippet:e,cpuKernelImpl:n,dtype:s}){return({inputs:i,backend:r})=>{const{x:o}=i,a=r,u=s||o.dtype;if(a.shouldExecuteOnCPU([o])&&null!=n){const t=a.texData.get(o.dataId),e=n(t.values,u);return a.makeTensorInfo(o.shape,u,e)}const c=at().getBool("WEBGL_PACK_UNARY_OPERATIONS")&&null!=e;let l;return l=c?new FM(o.shape,e):new TM(o.shape,t),a.runWebGLProgram(l,[o],u)}}function mP({opSnippet:t,packedOpSnippet:e,checkOutOfBounds:n=!1,supportsComplex:s=!1,cpuKernelImpl:i,dtype:r}){return({inputs:o,backend:a})=>{const{a:u,b:c}=o,l=a;if(s&&"complex64"===u.dtype){const e=l.texData.get(u.dataId),n=l.texData.get(c.dataId),[s,i]=[[e.complexTensorInfos.real,n.complexTensorInfos.real],[e.complexTensorInfos.imag,n.complexTensorInfos.imag]].map((e=>{const[n,s]=e,i={dataId:n.dataId,dtype:n.dtype,shape:u.shape},r={dataId:s.dataId,dtype:s.dtype,shape:c.shape},o=new QM(t,u.shape,c.shape);return l.runWebGLProgram(o,[i,r],Zs(n.dtype,s.dtype))})),r=eP({inputs:{real:s,imag:i},backend:l});return l.disposeIntermediateTensorInfo(s),l.disposeIntermediateTensorInfo(i),r}const h=r||Zs(u.dtype,c.dtype);if(l.shouldExecuteOnCPU([u,c])&&null!=i){const t=l.texData.get(u.dataId),e=l.texData.get(c.dataId),[n,s]=i(u.shape,c.shape,t.values,e.values,h),r=l.makeTensorInfo(s,h),o=l.texData.get(r.dataId);return o.values=n,r}const p=at().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&null!=e;let d;return d=p?new ZM(e,u.shape,c.shape,n):new QM(t,u.shape,c.shape),l.runWebGLProgram(d,[u,c],h)}}function gP(t,e=!1){if("linear"===t)return e?RM:CM;if("relu"===t)return e?MM:EM;if("elu"===t)return e?DM:NM;if("relu6"===t)return e?PM:OM;if("prelu"===t)return e?uP:aP;if("leakyrelu"===t)return e?iP:sP;throw new Error(`Activation ${t} has not been implemented for the WebGL backend.`)}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class yP{constructor(t,e,n,s=!1,i=!1,r=!1,o=null,a=!1,u=!1){this.variableNames=["matrixA","matrixB"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=n;const c=s?t[1]:t[2],l=Math.ceil(c/2),h=s?"i * 2, rc.y":"rc.y, i * 2",p=i?"rc.z, i * 2":"i * 2, rc.z",d=s?["a.xxyy","a.zzww"]:["a.xxzz","a.yyww"],f=i?["b.xzxz","b.ywyw"]:["b.xyxy","b.zwzw"];let m="",g="";o&&(m=a?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${o}\n        }`:u?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${o}\n        }`:`vec4 activation(vec4 x) {\n          ${o}\n        }`,g="result = activation(result);");const y=r?"result += getBiasAtOutCoords();":"";r&&this.variableNames.push("bias"),a&&this.variableNames.push("preluActivationWeights"),u&&this.variableNames.push("leakyreluAlpha");let b="rc.x",v="rc.x";t[0]<e[0]?b=`int(min(float(rc.x), ${t[0]-1}.))`:e[0]<t[0]&&(v=`int(min(float(rc.x), ${e[0]-1}.))`),this.userCode=`\n      ${m}\n\n      const float sharedDimension = ${l}.0;\n\n      vec4 dot2x2ARowBCol(ivec3 rc) {\n        vec4 result = vec4(0);\n        for (int i = 0; i < ${l}; i++) {\n          int batchA = ${b};\n          int batchB = ${v};\n          vec4 a = getMatrixA(batchA, ${h});\n          vec4 b = getMatrixB(batchB, ${p});\n\n          // These swizzled products need to be separately added.\n          // See: https://github.com/tensorflow/tfjs/issues/1735\n          result += (${d[0]} * ${f[0]});\n          result += (${d[1]} * ${f[1]});\n        }\n        return result;\n      }\n\n      void main() {\n        ivec3 rc = getOutputCoords();\n        vec4 result = dot2x2ARowBCol(rc);\n\n        ${y}\n\n        ${g}\n\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const bP={REAL:"return areal * breal - aimag * bimag;",IMAG:"return areal * bimag + aimag * breal;"};class vP{constructor(t,e,n){this.variableNames=["AReal","AImag","BReal","BImag"],this.outputShape=La(e,n),this.userCode=`\n      float binaryOpComplex(\n          float areal, float aimag, float breal, float bimag) {\n        ${t}\n      }\n\n      void main() {\n        float areal = getARealAtOutCoords();\n        float aimag = getAImagAtOutCoords();\n        float breal = getBRealAtOutCoords();\n        float bimag = getBImagAtOutCoords();\n        setOutput(binaryOpComplex(areal, aimag, breal, bimag));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const wP="return a * b;";function xP(t){const{inputs:e,backend:n}=t,{a:s,b:i}=e,r=Zs(s.dtype,i.dtype);if("complex64"===s.dtype){const t=n.texData.get(s.dataId),e=n.texData.get(i.dataId),r=new vP(bP.REAL,s.shape,i.shape),o=new vP(bP.IMAG,s.shape,i.shape),a=[{dataId:t.complexTensorInfos.real.dataId,dtype:t.complexTensorInfos.real.dtype,shape:s.shape},{dataId:t.complexTensorInfos.imag.dataId,dtype:t.complexTensorInfos.imag.dtype,shape:s.shape},{dataId:e.complexTensorInfos.real.dataId,dtype:e.complexTensorInfos.real.dtype,shape:i.shape},{dataId:e.complexTensorInfos.imag.dataId,dtype:e.complexTensorInfos.imag.dtype,shape:i.shape}],u=n.runWebGLProgram(r,a,"float32"),c=n.runWebGLProgram(o,a,"float32"),l=eP({inputs:{real:u,imag:c},backend:n});return n.disposeIntermediateTensorInfo(u),n.disposeIntermediateTensorInfo(c),l}if(n.shouldExecuteOnCPU([s,i])){const t=n.texData.get(s.dataId),e=n.texData.get(i.dataId),[o,a]=XD(s.shape,i.shape,t.values,e.values,r),u=n.makeTensorInfo(a,r),c=n.texData.get(u.dataId);return c.values=o,u}let o;return o=at().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZM(wP,s.shape,i.shape):new QM(wP,s.shape,i.shape),n.runWebGLProgram(o,[s,i],r)}const _P={kernelName:nn,backendName:"webgl",kernelFunc:xP};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kP(t,e,n){const s=[L$(t.shape),...z$(t.shape)],i={dtype:t.dtype,shape:s,dataId:t.dataId},r=[L$(e),...z$(e)],o=new gM(r,s),a=!0,u=n.runWebGLProgram(o,[i],t.dtype,null,a);return{dataId:u.dataId,shape:e,dtype:u.dtype}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function SP(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{shape:r}=s,o=n,a=k(i.shape),u=N(r,a),c=k(u);v(a===c,(()=>`The new shape (${u}) has ${c} elements and the old shape (${i.shape}) has ${a} elements. The new shape and old shape must have the same number of elements.`));const l=o.texData.get(i.dataId);return!l.isPacked||W$(i.shape,u)||null!==l.texture&&W$(l.shape,u)?(o.incRef(i.dataId),{dataId:i.dataId,shape:u,dtype:i.dtype}):kP(i,u,o)}const TP={kernelName:wn,backendName:"webgl",kernelFunc:SP};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class IP{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:s,inSize:i,outSize:r}=t;this.outputShape=[s,r];const o=4*Math.floor(n/4),a=n%4;let u="sumValue += dot(values, ones);";if(null!=e){const t=1/e;u=`sumValue += dot(values * ${T(t)?t.toPrecision(2):t}, ones);`}let c="";i%n>0&&(c=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return 0.0;\n        }\n      `),this.userCode=`\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${c}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${o}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${u}\n        }\n\n        int inIdx = inOffset + ${o};\n        if (${1===a}) {\n          vec4 values = vec4(getValue(batch, inIdx), 0.0, 0.0, 0.0);\n\n          ${u}\n        } else if (${2===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1), 0.0, 0.0);\n\n          ${u}\n        } else if (${3===a}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2), 0.0);\n\n          ${u}\n        }\n        setOutput(sumValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class CP{constructor(t,e){this.variableNames=["x"];const{windowSize:n,batchSize:s,inSize:i,outSize:r}=t;this.outputShape=[s,r];let o="0.0",a="";"prod"===e?o="1.0":"min"===e?(o="1.0 / 1e-20",a="min"):"max"===e&&(o="-1.0 / 1e-20",a="max");let u=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"sum"===e?u="sumValue":"prod"===e?u="prodValue":"all"===e?u="allValue":"any"===e&&(u="anyValue");const c=4*Math.floor(n/4),l=n%4;let h=`\n      if (${"sum"===e}) {\n        sumValue += dot(values, ones);\n      } else if (${"prod"===e}) {\n        vec2 tmp = vec2(values[0], values[1]) * vec2(values[2], values[3]);\n        prodValue *= tmp[0] * tmp[1];\n      } else {\n        minMaxValue = ${a}(values, minMaxValue);\n      }\n    `,p="vec4";"all"===e?(o="1.0",h="\n        bool reducedAllValue = all(values);\n        float floatedReducedAllValue = float(reducedAllValue);\n        allValue = float(allValue >= 1.0 && floatedReducedAllValue >= 1.0);\n      ",p="bvec4"):"any"===e&&(o="0.0",h="\n        bool reducedAnyValue = any(values);\n        float floatedReducedAnyValue = float(reducedAnyValue);\n        anyValue = float(anyValue >= 1.0 || floatedReducedAnyValue >= 1.0);\n      ",p="bvec4");let d="";i%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${o};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float getValue(int batch, int inIdx) {\n        ${d}\n        return getX(batch, inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${n};\n\n        vec4 minMaxValue = vec4(${o});\n        float prodValue = 1.0;\n        float sumValue = 0.0;\n        float allValue = 1.0;\n        float anyValue = 0.0;\n\n        for (int i = 0; i < ${c}; i += 4) {\n          int inIdx = inOffset + i;\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${c};\n        if (${1===l}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${2===l}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          ${h}\n        } else if (${3===l}) {\n          ${p} values = ${p}(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          ${h}\n        }\n        setOutput(${u});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function AP(t){const e=[];while(0===e.length||1!==e[e.length-1].outSize){const n=e.length?e[e.length-1].outSize:t[1],s=dp(n);e.push({inSize:n,windowSize:s,outSize:Math.ceil(n/s)})}return e}function NP(t,e,n,s){const i=AP(t.shape);let r=t;for(let o=0;o<i.length;o++){const{inSize:a,windowSize:u,outSize:c}=i[o];let l,h;l="mean"===n?0===o?new IP({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},a):new IP({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c}):new CP({windowSize:u,inSize:a,batchSize:t.shape[0],outSize:c},n),h=r,r=s.runWebGLProgram(l,[r],e),h.dataId!==t.dataId&&s.disposeIntermediateTensorInfo(h)}return r}
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class EP{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[e[r]];this.outputShape=n,this.rank=n.length;const s=ID(this.rank),i=OP(e);this.userCode=`\n    void main() {\n      ${s} resRC = getOutputCoords();\n      setOutput(getA(${i}));\n    }\n    `}}function OP(t){const e=t.length;if(e>6)throw Error(`Transpose for rank ${e} is not yet supported`);const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u","resRC.v"],s=new Array(e);for(let i=0;i<t.length;i++)s[t[i]]=n[i];return s.join()}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class $P{constructor(t,e){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0;const n=new Array(t.length);for(let c=0;c<n.length;c++)n[c]=t[e[c]];if(this.outputShape=n,this.rank=n.length,this.rank>6)throw Error(`Packed transpose for rank ${this.rank} is not yet supported.`);const s=ID(this.rank),i=uM("rc",this.rank),r=new Array(this.rank);for(let c=0;c<e.length;c++)r[e[c]]=i[c];const o=`vec2(${r.slice(-2).join()})`,a=`++${i[this.rank-1]} < ${n[this.rank-1]}`,u=`getChannel(getA(${r.join()}), ${o})`;this.userCode=`\n    void main() {\n      ${s} rc = getOutputCoords();\n      vec4 result = vec4(0.);\n      result[0] = ${u};\n      if(${a}) {\n        result[1] = ${u};\n      }\n      --${i[this.rank-1]};\n      if(++${i[this.rank-2]} < ${n[this.rank-2]}) {\n        result[2] = ${u};\n        if(${a}) {\n          result[3] = ${u};\n        }\n      }\n      setOutput(result);\n    }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function RP(t,e,n){const s=at().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new $P(t.shape,e):new EP(t.shape,e);return n.runWebGLProgram(s,[t],t.dtype)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function DP(t,e,n,s){const i=e,r=t.shape.length,o=E(i,t.shape);let a=o;const u=Fu(a,r),c=null!=u;let l=t;c&&(l=RP(t,u,s),a=zu(a.length,r)),Pu("sum",a,r);const[h,p]=Du(l.shape,a);let d=h;n&&(d=Mu(h,o));const f=k(p),m=k(t.shape),g=m/f,y=SP({inputs:{x:l},attrs:{shape:[g,f]},backend:s}),b=Js(t.dtype),v=NP(y,b,"sum",s),w=SP({inputs:{x:v},attrs:{shape:d},backend:s});return s.disposeIntermediateTensorInfo(y),s.disposeIntermediateTensorInfo(v),c&&s.disposeIntermediateTensorInfo(l),w}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MP(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s;return DP(i,r,o,n)}const PP={kernelName:zn,backendName:"webgl",kernelFunc:MP};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function FP(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{perm:r}=s,o=n,a=i.shape.length,u=new Array(a);for(let l=0;l<u.length;l++)u[l]=i.shape[r[l]];let c;if(o.shouldExecuteOnCPU([i])){const t=o.texData.get(i.dataId),e=t.values,n=oM(e,i.shape,i.dtype,r,u);c=o.makeTensorInfo(u,i.dtype);const s=o.texData.get(c.dataId);s.values=n}else c=RP(i,r,o);return c}const LP={kernelName:Zn,backendName:"webgl",kernelFunc:FP},zP=1e3;function BP({a:t,b:e,transposeA:n,transposeB:s,backend:i,bias:r=null,preluActivationWeights:o=null,leakyreluAlpha:a=0,activation:u=null}){const c=t.shape.length,l=e.shape.length,h=n?t.shape[c-2]:t.shape[c-1],p=s?e.shape[l-1]:e.shape[l-2],d=n?t.shape[c-1]:t.shape[c-2],f=s?e.shape[l-2]:e.shape[l-1],m=t.shape.slice(0,-2),g=e.shape.slice(0,-2),y=k(m),b=k(g),w=y===b||1===y||1===b;v(c>=2&&l>=2&&w,(()=>`Error in matMul: the input batch dimensions must either be the same or at least one input batch dimension must be 1. Got input batch dimensions of (${m}) and (${g}).`));const x=y>b?t.shape.slice(0,-2):e.shape.slice(0,-2),_=x.concat([d,f]);v(h===p,(()=>`Error in matMul: inner shapes (${h}) and (${p}) of Tensors with shapes ${t.shape} and ${e.shape} and transposeA=${n} and transposeB=${s} must match.`));const S=n?[y,h,d]:[y,d,h],T=s?[b,f,p]:[b,p,f],I=SP({inputs:{x:t},backend:i,attrs:{shape:S}}),C=SP({inputs:{x:e},backend:i,attrs:{shape:T}}),A=[I,C],N=Math.max(y,b),E=n?I.shape[1]:I.shape[2],O=null!=r,$=null!=o,R="leakyrelu"===u,D=null!=u?gP(u,!0):null,M=O||$||R||null!=D;let P;if((1===d||1===f)&&E>zP&&!1===M){let t=I,e=C;n&&(t=FP({inputs:{x:I},backend:i,attrs:{perm:[0,2,1]}}),A.push(t)),s&&(e=FP({inputs:{x:C},backend:i,attrs:{perm:[0,2,1]}}),A.push(e));const r=1!==f,o=1===f;let a=t;r&&(a=SP({inputs:{x:t},backend:i,attrs:{shape:[N,E,1]}}),A.push(a));const u=1===f?2:1;let c=e;o&&(c=SP({inputs:{x:e},backend:i,attrs:{shape:[N,1,E]}}),A.push(c));const l=xP({inputs:{a:a,b:c},backend:i});P=MP({inputs:{x:l},backend:i,attrs:{axis:u,keepDims:!0}}),A.push(l)}else{const u=Zs(t.dtype,e.dtype),c=new yP(S,T,[N,d,f],n,s,O,D,$,R),l=[I,C];if(null!=r&&l.push(r),$&&l.push(o),R){const t=i.makeTensorInfo([],"float32",Os(a,"float32"));l.push(t),A.push(t)}P=i.runWebGLProgram(c,l,u)}const F=SP({inputs:{x:P},backend:i,attrs:{shape:_}});A.push(P);for(const v of A)i.disposeIntermediateTensorInfo(v);return F}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qP(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r,bias:o,preluActivationWeights:a}=e,{transposeA:u,transposeB:c,activation:l,leakyreluAlpha:h}=s;return BP({a:i,b:r,transposeA:u,transposeB:c,backend:n,bias:o,preluActivationWeights:a,leakyreluAlpha:h,activation:l})}const VP={kernelName:os,backendName:"webgl",kernelFunc:qP},WP="return abs(x);";function jP(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])&&"complex64"!==s.dtype){const t=n.texData.get(s.dataId),e=tM(t.values);return n.makeTensorInfo(s.shape,s.dtype,e)}let i;return i=at().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new FM(s.shape,WP):new TM(s.shape,WP),n.runWebGLProgram(i,[s],s.dtype)}const UP={kernelName:ft,backendName:"webgl",kernelFunc:jP},GP=IM+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return acos(x);\n",HP=fP({opSnippet:GP}),KP={kernelName:mt,backendName:"webgl",kernelFunc:HP},XP=IM+"\n  if (x < 1.0) return NAN;\nreturn log(x + sqrt(x * x - 1.0));",QP=fP({opSnippet:XP}),YP={kernelName:gt,backendName:"webgl",kernelFunc:QP},ZP="return a + b;",JP=mP({opSnippet:ZP,packedOpSnippet:ZP,supportsComplex:!0,cpuKernelImpl:RD}),tF={kernelName:yt,backendName:"webgl",kernelFunc:JP};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class eF{constructor(t,e){this.outputShape=[],this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`float v${t} = get${t}AtOutCoords();`)}));const s=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        float result = ${s};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class nF{constructor(t,e){this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.variableNames=e.map(((t,e)=>`T${e}`));const n=[];this.variableNames.forEach((t=>{n.push(`vec4 v${t} = get${t}AtOutCoords();`)}));const s=this.variableNames.map((t=>`v${t}`)).join(" + ");this.userCode=`\n      void main() {\n        ${n.join("\n        ")}\n\n        vec4 result = ${s};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function sF(t){const{inputs:e,backend:n}=t,s=e;if(1===s.length)return JM({inputs:{x:s[0]},backend:n});if(s.length>at().get("WEBGL_MAX_TEXTURES_IN_SHADER")){const t=Math.floor(s.length/2),e=sF({inputs:s.slice(0,t),backend:n}),i=sF({inputs:s.slice(t),backend:n});return sF({inputs:[e,i],backend:n})}const i=s.map((t=>t.dtype)).reduce(((t,e)=>Zs(t,e))),r=s.map((t=>t.shape)),o=at().getBool("WEBGL_PACK"),a=o?new nF(s[0].shape,r):new eF(s[0].shape,r);return n.runWebGLProgram(a,s,i)}const iF={kernelName:bt,backendName:"webgl",kernelFunc:sF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function rF(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,u=E(r,i.shape);let c=u;const l=Fu(c,a);let h=i;null!=l&&(h=FP({inputs:{x:i},backend:n,attrs:{perm:l}}),c=zu(c.length,a)),Pu("all",c,a);const[p,d]=Du(h.shape,c),f=k(d),m=SP({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=NP(m,m.dtype,"all",n);let y;if(o){const t=Mu(p,u);y=SP({inputs:{x:g},backend:n,attrs:{shape:t}})}else y=SP({inputs:{x:g},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),y}const oF={kernelName:vt,backendName:"webgl",kernelFunc:rF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function aF(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,u=E(r,i.shape);let c=u;const l=Fu(c,a);let h=i;null!=l&&(h=FP({inputs:{x:i},backend:n,attrs:{perm:l}}),c=zu(c.length,a)),Pu("any",c,a);const[p,d]=Du(h.shape,c),f=k(d),m=SP({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=NP(m,m.dtype,"any",n);let y;if(o){const t=Mu(p,u);y=SP({inputs:{x:g},backend:n,attrs:{shape:t}})}else y=SP({inputs:{x:g},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),y}const uF={kernelName:wt,backendName:"webgl",kernelFunc:aF};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class cF{constructor(t,e,n){this.variableNames=["A"];const{windowSize:s,batchSize:i,outSize:r}=t;n||this.variableNames.push("bestIndicesA"),this.outputShape=[i,r];const o="max"===e?">":"<",a=n?"inOffset + i;":"round(getBestIndicesA(batch, inOffset + i));";this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = outIdx * ${s};\n\n        int bestIndex = inOffset;\n        float bestValue = getA(batch, bestIndex);\n\n        for (int i = 0; i < ${s}; i++) {\n          int inIdx = ${a};\n          float candidate = getA(batch, inIdx);\n          if (candidate ${o} bestValue) {\n            bestValue = candidate;\n            bestIndex = inIdx;\n          }\n        }\n        setOutput(float(bestIndex));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class lF{constructor(t,e,n,s){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,v(t.length>2,(()=>`Packed arg${n.charAt(0).toUpperCase()+n.slice(1)} supports only inputs with rank above 2.`));const i=t[t.length-1],r=Math.ceil(i/e);this.outputShape=t.slice(0,-1),r>1&&this.outputShape.push(r),s||this.variableNames.push("bestIndicesA");const o=this.outputShape,a=o.length,u=ID(a),c=cM("coords",a);let l,h;if(1===r){h=a+1;const t=ID(h);l=`\n        ${t} sourceLocR = ${t}(${c.join()}, 0);\n        ++${c[a-1]};\n        ${t} sourceLocG = ${t}(${c.join()}, 0);\n        ++${c[a-2]};\n        ${t} sourceLocA = ${t}(${c.join()}, 0);\n        --${c[a-1]};\n        ${t} sourceLocB = ${t}(${c.join()}, 0);\n        --${c[a-2]};`}else h=a,l=`\n        ${u} sourceLocR = coords;\n        ++${c[a-1]};\n        ${u} sourceLocG = coords;\n        ++${c[a-2]};\n        ${u} sourceLocA = coords;\n        --${c[a-1]};\n        ${u} sourceLocB = coords;\n        --${c[a-2]};`;const p=["x","y","z","w","u","v"].slice(0,h),d="."+p[h-1],f=p.map((t=>"int "+t)),m=cM("sourceLocR",h-1).concat("inIdx.r"),g=cM("sourceLocG",h-1).concat("inIdx.g"),y=cM("sourceLocB",h-1).concat("inIdx.b"),b=cM("sourceLocA",h-1).concat("inIdx.a"),w="max"===n?"greaterThan":"lessThan",x=s?"":`\n          inIdx = round(vec4(getBestIndicesAChannel(${m.join()}),\n                             getBestIndicesAChannel(${g.join()}),\n                             getBestIndicesAChannel(${y.join()}),\n                             getBestIndicesAChannel(${b.join()})));`,_=`vec4(\n            getAChannel(${m.join()}),\n            hasNextCol ? getAChannel(${g.join()}) : 0.,\n            hasNextRow ? getAChannel(${y.join()}) : 0.,\n            hasNextRow && hasNextCol ? getAChannel(${b.join()}) : 0.)`,k=s?"":`\n      float getBestIndicesAChannel(${f.join()}) {\n        return getChannel(getBestIndicesA(${p.join()}),\n                                          vec2(${p.slice(-2).join()}));\n      }`;this.userCode=`\n      float getAChannel(${f.join()}) {\n        return getChannel(getA(${p.join()}),\n                               vec2(${p.slice(-2).join()}));\n      }\n      ${k}\n      void main() {\n        ${u} coords = getOutputCoords();\n        bool hasNextCol = ${c[a-1]} < ${o[a-1]-1};\n        bool hasNextRow = ${c[a-2]} < ${o[a-2]-1};\n        ${l}\n        ivec4 srcIdx = ivec4(sourceLocR${d}, sourceLocG${d},\n          sourceLocB${d}, sourceLocA${d}) * ${e};\n        ivec4 inIdx = srcIdx;\n        vec4 bestIndex = vec4(inIdx);\n        vec4 bestValue = ${_};\n\n        for (int i = 0; i < ${e}; i++) {\n          inIdx = srcIdx;\n          ${x}\n          vec4 candidate = ${_};\n          bvec4 nan = isnan(candidate);\n          bvec4 replace = bvec4(\n            vec4(${w}(candidate, bestValue)) * (vec4(1.0) - vec4(nan)));\n\n          bestValue = vec4(replace.x  ? candidate.x : bestValue.x,\n                           replace.y  ? candidate.y : bestValue.y,\n                           replace.z  ? candidate.z : bestValue.z,\n                           replace.w  ? candidate.w : bestValue.w);\n          bestIndex = mix(bestIndex, vec4(inIdx), vec4(replace));\n          srcIdx++;\n        }\n        setOutput(bestIndex);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hF(t,e,n,s=null){let i=e.shape[0],r=e.shape[1];null!=s&&(i=s.shape[0],r=s.shape[1]);const o=dp(r),a={windowSize:o,inSize:r,batchSize:i,outSize:Math.ceil(r/o)},u=new cF(a,n,null==s),c=[e];null!=s&&c.push(s);const l=t.runWebGLProgram(u,c,"int32");if(1===l.shape[1])return l;const h=hF(t,e,n,l);return t.disposeIntermediateTensorInfo(l),h}function pF(t,e,n,s=null){const i=null!=s?s.shape:e.shape,r=i[i.length-1],o=dp(r),a=new lF(i,o,n,null==s),u=null==s?[e]:[e,s],c=t.runWebGLProgram(a,u,"int32");if(c.shape.length===e.shape.length){const s=pF(t,e,n,c);return t.disposeIntermediateTensorInfo(c),s}return c}function dF(t,e,n,s){const i=[n];if(Pu("arg"+s.charAt(0).toUpperCase()+s.slice(1),i,e.shape.length),!at().getBool("WEBGL_PACK_REDUCE")||e.shape.length<=2){const n=[],[r,o]=Du(e.shape,i),a=k(o),u=SP({inputs:{x:e},backend:t,attrs:{shape:[-1,a]}});n.push(u);const c=hF(t,u,s);n.push(c);const l=SP({inputs:{x:c},backend:t,attrs:{shape:r}});return n.forEach((e=>t.disposeIntermediateTensorInfo(e))),l}return pF(t,e,s)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fF(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;let o=E(r,i.shape);const a=Fu(o,i.shape.length);let u=i;const c=[];null!=a&&(u=FP({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(u),o=zu(o.length,u.shape.length)),Pu("argMax",[o[0]],u.shape.length);const l=dF(n,u,o[0],"max");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}const mF={kernelName:xt,backendName:"webgl",kernelFunc:fF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gF(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r}=s;let o=E(r,i.shape);const a=Fu(o,i.shape.length);let u=i;const c=[];null!=a&&(u=FP({inputs:{x:i},backend:n,attrs:{perm:a}}),c.push(u),o=zu(o.length,u.shape.length)),Pu("argMin",[o[0]],u.shape.length);const l=dF(n,u,o[0],"min");return c.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}const yF={kernelName:_t,backendName:"webgl",kernelFunc:gF},bF=IM+"\n  if (abs(x) > 1.) {\n    return NAN;\n  }\n  return asin(x);\n",vF=fP({opSnippet:bF}),wF={kernelName:kt,backendName:"webgl",kernelFunc:vF},xF=IM+"return log(x + sqrt(x * x + 1.0));",_F=fP({opSnippet:xF}),kF={kernelName:St,backendName:"webgl",kernelFunc:_F},SF=IM+"\n  return atan(x);\n",TF=fP({opSnippet:SF}),IF={kernelName:Tt,backendName:"webgl",kernelFunc:TF},CF=pP+"\n  return atan(a, b);\n",AF="\n  vec4 result = atan(a, b);\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+dP+"\n  return result;\n",NF=mP({opSnippet:CF,packedOpSnippet:AF}),EF={kernelName:Ct,backendName:"webgl",kernelFunc:NF},OF=IM+"\n  if ((x < -1.0) || (x > 1.0)) return NAN;\nreturn (log(1.0 + x) - log(1.0 - x)) / 2.0;",$F=fP({opSnippet:OF}),RF={kernelName:It,backendName:"webgl",kernelFunc:$F};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class DF{constructor(t,e,n,s=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const r=t.filterWidth,o=t.strideHeight,a=t.strideWidth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterHeight,h=t.effectiveFilterWidth,p=t.padInfo.top,d=t.padInfo.left;this.outputShape=t.outShape;const f="avg"===e,m=`((batch  * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + d`,g=`(xR * ${t.inWidth} + xC) * ${t.inChannels} + d`;let y="0.0";if(f||(y="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec2 strides = ivec2(${o}, ${a});\n        const ivec2 pads = ivec2(${p}, ${d});\n\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int batch = coords[0];\n          int d = coords[3];\n\n          ivec2 xRCCorner = coords.yz * strides - pads;\n          int xRCorner = xRCCorner.x;\n          int xCCorner = xRCCorner.y;\n\n          // max/min x(?, ?, d) to get y(yR, yC, d).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n          float avgValue = 0.0;\n\n          for (int wR = 0; wR < ${l};\n              wR += ${u}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${h};\n                wC += ${c}) {\n              int xC = xCCorner + wC;\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float value = getX(batch, xR, xC, d);\n\n              // If a min / max value has already been found, use it. If not,\n              // use the current value.\n              float currMinMaxValue = mix(\n                  value, minMaxValue, minMaxValueFound);\n              if (value ${e} currMinMaxValue) {\n                minMaxValue = value;\n                minMaxValueFound = 1.0;\n                minMaxPosition = ${s?i?m:g:`wR * ${h} + wC`};\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}const b="max";let v=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(v="avgValue / count");const w=4*Math.floor(r/4),x=r%4,_=`\n      if (${f}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ${b}(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec2 strides = ivec2(${o}, ${a});\n      const ivec2 pads = ivec2(${p}, ${d});\n      const float initializationValue = ${y};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xR, int xC, int d) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xR, xC, d);\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d = coords[3];\n\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // max/min x(?, ?, d) to get y(yR, yC, d).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${y});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wR = 0; wR < ${l};\n            wR += ${u}) {\n          int xR = xRCorner + wR;\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${w}; wC += 4) {\n            int xC = xCCorner + wC * ${c};\n\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              getValue(batch, xR, xC + 3 * ${c}, d)\n            );\n\n            ${_}\n          }\n\n          int xC = xCCorner + ${w};\n          if (${1===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              initializationValue,\n              initializationValue,\n              initializationValue\n            );\n\n            ${_}\n          } else if (${2===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              initializationValue,\n              initializationValue\n            );\n\n            ${_}\n          } else if (${3===x}) {\n            vec4 values = vec4(\n              getValue(batch, xR, xC, d),\n              getValue(batch, xR, xC + ${c}, d),\n              getValue(batch, xR, xC + 2 * ${c}, d),\n              initializationValue\n            );\n\n            ${_}\n          }\n        }\n        setOutput(${v});\n      }\n    `}}class MF{constructor(t,e,n,s=!1,i=!1){if(this.variableNames=["x"],"avg"===e&&n)throw new Error("Cannot compute positions for average pool.");const r=t.filterWidth,o=t.strideDepth,a=t.strideHeight,u=t.strideWidth,c=t.dilationDepth,l=t.dilationHeight,h=t.dilationWidth,p=t.effectiveFilterDepth,d=t.effectiveFilterHeight,f=t.effectiveFilterWidth,m=t.padInfo.front,g=t.padInfo.top,y=t.padInfo.left;this.outputShape=t.outShape;const b="avg"===e;let v="0.0";if(b||(v="-1.0 / 1e-20"),n){const e=">=";return void(this.userCode=`\n        const ivec3 strides =\n            ivec3(${o}, ${a}, ${u});\n        const ivec3 pads = ivec3(${m}, ${g}, ${y});\n\n        void main() {\n          ivec5 coords = getOutputCoords();\n          int batch = coords.x;\n          int ch = coords.u;\n\n          ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n          int xDCorner = xCorner.x;\n          int xRCorner = xCorner.y;\n          int xCCorner = xCorner.z;\n\n          // max/min x(?, ?, ?, ch) to get y(yD, yR, yC, ch).\n          // ? = to be determined\n          float minMaxValue = 0.0;\n          float minMaxValueFound = 0.0;\n          int minMaxPosition = 0;\n\n          for (int wD = 0; wD < ${p};\n              wD += ${c}) {\n            int xD = xDCorner + wD;\n\n            if (xD < 0 || xD >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int wR = 0; wR < ${d};\n                wR += ${l}) {\n              int xR = xRCorner + wR;\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int wC = 0; wC < ${f};\n                  wC += ${h}) {\n                int xC = xCCorner + wC;\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float value = getX(batch, xD, xR, xC, ch);\n\n                // If a min / max value has already been found, use it. If not,\n                // use the current value.\n                float currMinMaxValue = mix(\n                    value, minMaxValue, minMaxValueFound);\n                if (value ${e} currMinMaxValue) {\n                  minMaxValue = value;\n                  minMaxValueFound = 1.0;\n                  minMaxPosition = ${s?i?`(((batch * ${t.inDepth} + xD) * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`((xD * ${t.inHeight} + xR) * ${t.inWidth} + xC) * ${t.inChannels} + ch`:`wD * ${d} * ${f} +\n                      wR * ${f} + wC`};\n                }\n              }\n            }\n          }\n          setOutput(float(minMaxPosition));\n        }\n      `)}const w="max";let x=`${e}(${e}(${e}(minMaxValue[0], minMaxValue[1]), minMaxValue[2]), minMaxValue[3])`;"avg"===e&&(x="avgValue / count");const _=4*Math.floor(r/4),k=r%4,S=`\n      if (${b}) {\n        avgValue += dot(values, ones);\n      } else {\n        minMaxValue = ${w}(values, minMaxValue);\n      }\n    `;this.userCode=`\n      const ivec3 strides =\n        ivec3(${o}, ${a}, ${u});\n      const ivec3 pads = ivec3(${m}, ${g}, ${y});\n      const float initializationValue = ${v};\n      const vec4 ones = vec4(1.0, 1.0, 1.0, 1.0);\n\n      float count = 0.0;\n\n      float getValue(int batch, int xD, int xR, int xC, int ch) {\n        if (xC < 0 || xC >= ${t.inWidth}) {\n          return initializationValue;\n        }\n        count += 1.0;\n        return getX(batch, xD, xR, xC, ch);\n      }\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 xCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xDCorner = xCorner.x;\n        int xRCorner = xCorner.y;\n        int xCCorner = xCorner.z;\n\n        // max/min x(?, ?, ?, d) to get y(yD, yR, yC, ch).\n        // ? = to be determined\n        vec4 minMaxValue = vec4(${v});\n        float avgValue = 0.0;\n        count = 0.0;\n\n        for (int wD = 0; wD < ${p};\n            wD += ${c}) {\n          int xD = xDCorner + wD;\n\n          if (xD < 0 || xD >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${d};\n            wR += ${l}) {\n            int xR = xRCorner + wR;\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${_}; wC += 4) {\n              int xC = xCCorner + wC * ${h};\n\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                getValue(batch, xD, xR, xC + 3 * ${h}, ch)\n              );\n\n              ${S}\n            }\n\n            int xC = xCCorner + ${_};\n            if (${1===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                initializationValue,\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${2===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                initializationValue,\n                initializationValue\n              );\n\n              ${S}\n            } else if (${3===k}) {\n              vec4 values = vec4(\n                getValue(batch, xD, xR, xC, ch),\n                getValue(batch, xD, xR, xC + ${h}, ch),\n                getValue(batch, xD, xR, xC + 2 * ${h}, ch),\n                initializationValue\n              );\n\n              ${S}\n            }\n          }\n          setOutput(${x});\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function PF(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;nR(i,"avgPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:u}=s,c=1;v(Wo(o,c),(()=>`Error in avgPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const l=No(i.shape,r,o,c,a,u);if(1===l.filterWidth&&1===l.filterHeight&&S(l.inShape,l.outShape))return JM({inputs:{x:i},backend:n});const h=new DF(l,"avg",!1);return n.runWebGLProgram(h,[i],"float32")}const FF={kernelName:At,backendName:"webgl",kernelFunc:PF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function LF(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dimRoundingMode:u,dataFormat:c}=s,l=[1,1,1],h=Eo(i.shape,r,o,l,a,u,c),p=new MF(h,"avg",!1);return n.runWebGLProgram(p,[i],"float32")}const zF={kernelName:Et,backendName:"webgl",kernelFunc:LF};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class BF{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,s=t.strideHeight,i=t.strideWidth,r=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterHeight,u=t.effectiveFilterWidth,c=a-1-t.padInfo.top,l=u-1-t.padInfo.left,h=1/(e*n);this.userCode=`\n      const ivec2 pads = ivec2(${c}, ${l});\n      const float avgMultiplier = float(${h});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${a};\n            wR += ${r}) {\n          float dyR = float(dyRCorner + wR) / ${s}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${u};\n            wC+= ${o}) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n\n            dotProd += dyValue * avgMultiplier;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class qF{constructor(t){this.variableNames=["dy"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,s=t.filterWidth,i=t.strideDepth,r=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.effectiveFilterDepth,h=t.effectiveFilterHeight,p=t.effectiveFilterWidth,d=l-1-t.padInfo.front,f=h-1-t.padInfo.top,m=p-1-t.padInfo.left,g=1/(e*n*s);this.userCode=`\n      const ivec3 pads = ivec3(${d}, ${f}, ${m});\n      const float avgMultiplier = float(${g});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, d) with pos mask(:, :, :, ch) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${l};\n            wD += ${a}) {\n          float dyD = float(dyDCorner + wD) / ${i}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${h};\n              wR += ${u}) {\n            float dyR = float(dyRCorner + wR) / ${r}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${p};\n                wC += ${c}) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n\n              dotProd += dyValue * avgMultiplier;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function VF(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=s,h=[1,1,1],p=Eo(o.shape,a,u,h,c,l),d=new qF(p);return n.runWebGLProgram(d,[i],o.dtype)}const WF={kernelName:Ot,backendName:"webgl",kernelFunc:VF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function jF(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r;nR([i,r],"avgPoolGrad");const{filterSize:a,strides:u,pad:c}=s,l=No(o.shape,a,u,1,c),h=new BF(l);return n.runWebGLProgram(h,[i],o.dtype)}const UF={kernelName:Nt,backendName:"webgl",kernelFunc:jF};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function GF(t){const{inputs:e,backend:n,attrs:s}=t,{a:i,b:r}=e,{transposeA:o,transposeB:a}=s;return BP({a:i,b:r,transposeA:o,transposeB:a,backend:n})}const HF={kernelName:$t,backendName:"webgl",kernelFunc:GF};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class KF{constructor(t,e,n,s,i,r){this.outputShape=[],this.variableNames=["x","mean","variance"],La(t,e),La(t,n);let o="0.0";null!=s&&(La(t,s),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="1.0";null!=i&&(La(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        float x = getXAtOutCoords();\n        float mean = getMeanAtOutCoords();\n        float variance = getVarianceAtOutCoords();\n        float offset = ${o};\n        float scale = ${a};\n        float inv = scale * inversesqrt(variance + float(${r}));\n        setOutput(dot(vec3(x, -mean, offset), vec3(inv, inv, 1)));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class XF{constructor(t,e,n,s,i,r){this.packedInputs=!0,this.packedOutput=!0,this.variableNames=["x","mean","variance"],La(t,e),La(t,n);let o="vec4(0.0)";null!=s&&(La(t,s),this.variableNames.push("offset"),o="getOffsetAtOutCoords()");let a="vec4(1.0)";null!=i&&(La(t,i),this.variableNames.push("scale"),a="getScaleAtOutCoords()"),this.outputShape=t,this.userCode=`\n      void main() {\n        vec4 offset = ${o};\n        vec4 scale = ${a};\n\n        vec4 x = getXAtOutCoords();\n        vec4 mean = getMeanAtOutCoords();\n        vec4 variance = getVarianceAtOutCoords();\n\n        vec4 inv = scale * inversesqrt(variance + vec4(${r}));\n\n        setOutput((x - mean) * inv + offset);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const QF=({inputs:t,backend:e,attrs:n})=>{const{x:s,mean:i,variance:r,offset:o,scale:a}=t;v(i.shape.length===r.shape.length,(()=>"Batch normalization gradient requires mean and variance to have equal ranks.")),v(null==o||i.shape.length===o.shape.length,(()=>"Batch normalization gradient requires mean and offset to have equal ranks.")),v(null==a||i.shape.length===a.shape.length,(()=>"Batch normalization gradient requires mean and scale to have equal ranks."));let{varianceEpsilon:u}=n;null==u&&(u=.001);const c=[s,i,r];let l=null;null!=o&&(l=o.shape,c.push(o));let h=null;null!=a&&(h=a.shape,c.push(a));const p=at().getBool("WEBGL_PACK_NORMALIZATION")?new XF(s.shape,i.shape,r.shape,l,h,u):new KF(s.shape,i.shape,r.shape,l,h,u),d=e.runWebGLProgram(p,c,c[0].dtype);return d},YF={kernelName:we,backendName:"webgl",kernelFunc:QF};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ZF{constructor(t){this.variableNames=["source"],this.outputShape=t,this.rank=t.length;const e=ID(this.rank),n=`uniform int start[${this.rank}];`,s=tL(this.rank);let i;const r=t.map(((t,e)=>`sourceLoc.${JF[e]} = start[${e}] + coords.${JF[e]};`));i=`\n        ${e} sourceLoc;\n        ${e} coords = getOutputCoords();\n        ${r.join("\n")}\n      `,this.userCode=`\n      ${n}\n      void main() {\n        ${i}\n        setOutput(getSource(${s}));\n      }\n    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,n)=>{null==this.startLoc&&(this.startLoc=e.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||e.gl.uniform1iv(this.startLoc,t)}}}const JF=["x","y","z","w","u","v"];function tL(t){if(1===t)return"sourceLoc";if(t<=6)return JF.slice(0,t).map((t=>"sourceLoc."+t)).join(",");throw Error(`Slicing for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class eL{constructor(t){this.variableNames=["source"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.rank=t.length;const e=ID(this.rank),n=cM("coords",this.rank),s=cM("sourceLoc",this.rank),i=1===this.rank?"sourceLoc":`vec2(${s.slice(-2).join()})`,r=`getChannel(getSource(${s.join()}), ${i})`,o=`\n      result.x = ${r};\n      if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n        ++${s[this.rank-1]};\n        result.y = ${r};\n        --${s[this.rank-1]};\n      }\n    `,a=1===this.rank?"":`\n      --${n[this.rank-1]};\n      if (++${n[this.rank-2]} < ${t[this.rank-2]}) {\n        ++${s[this.rank-2]};\n        result.z = ${r};\n        if (++${n[this.rank-1]} < ${t[this.rank-1]}) {\n          ++${s[this.rank-1]};\n          result.w = ${r};\n        }\n      }\n    `,u=this.rank<=4?`sourceLoc = coords +\n            ${e}(${t.map(((t,e)=>`start[${e}]`)).join()});`:t.map(((t,e)=>`${s[e]} = ${n[e]} + start[${e}];`)).join("\n");this.userCode=`\n      uniform int start[${this.rank}];\n      void main() {\n        ${e} coords = getOutputCoords();\n        ${e} sourceLoc;\n        ${u}\n        vec4 result = vec4(0.);\n        ${o}\n        ${a}\n        setOutput(result);\n      }\n    `}getCustomSetupFunc(t){if(t.length!==this.rank)throw Error(`The rank (${this.rank}) of the program must match the length of start (${t.length})`);return(e,n)=>{null==this.startLoc&&(this.startLoc=e.getUniformLocationNoThrow(n,"start"),null==this.startLoc)||e.gl.uniform1iv(this.startLoc,t)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nL(t,e,n,s){const i=s.texData.get(t.dataId),r=s.makeTensorInfo(n,t.dtype),o=s.texData.get(r.dataId);Object.assign(o,i),o.complexParentRefCount=0,o.refCount=1,o.shape=n,o.dtype=t.dtype;let a=Jr(e,G(t.shape));i.slice&&(a+=i.slice.flatOffset),o.slice={flatOffset:a,origDataId:i.slice&&i.slice.origDataId||t.dataId};const u=s.dataRefCount.get(o.slice.origDataId)||1;return s.dataRefCount.set(o.slice.origDataId,u+1),r}function sL(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,size:o}=s,[a,u]=to(i,r,o);if(Br(i,a,u),0===k(u))return n.makeTensorInfo(u,i.dtype,[]);if(n.shouldExecuteOnCPU([i])||"string"===i.dtype){const t=n.texData.get(i.dataId),e=eM(t.values,a,u,i.shape,i.dtype);return n.makeTensorInfo(u,i.dtype,e)}const{isPacked:c}=n.texData.get(i.dataId),l=Zr(i.shape,a,u);if(c||!l){const t=at().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new eL(u):new ZF(u),e=t.getCustomSetupFunc(a);return n.runWebGLProgram(t,[i],i.dtype,e)}return n.uploadToGPU(i.dataId),nL(i,a,u,n)}const iL={kernelName:$n,backendName:"webgl",kernelFunc:sL},rL=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,crops:o}=s;v(i.shape.length<=4,(()=>"batchToSpaceND for rank > 4 with a WebGL backend not implemented yet"));const a=r.reduce(((t,e)=>t*e)),u=mp(i.shape,r,a),c=gp(u.length,r.length),l=yp(i.shape,r,a),h=bp(o,r.length),p=vp(l,o,r.length),d=[],f=SP({inputs:{x:i},backend:n,attrs:{shape:u}}),m=FP({inputs:{x:f},backend:n,attrs:{perm:c}}),g=SP({inputs:{x:m},backend:n,attrs:{shape:l}}),y=sL({inputs:{x:g},backend:n,attrs:{begin:h,size:p}});return d.push(f),d.push(m),d.push(g),d.forEach((t=>n.disposeIntermediateTensorInfo(t))),y},oL={kernelName:Rt,backendName:"webgl",kernelFunc:rL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function aL(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o}=s,a=n.readSync(i.dataId),u=n.readSync(r.dataId),c=DD(a,u,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,c)}const uL={kernelName:Dt,backendName:"webgl",kernelFunc:aL},cL="return float(a != b);",lL=mP({opSnippet:cL,dtype:"bool"}),hL={kernelName:rn,backendName:"webgl",kernelFunc:lL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function pL(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return JM({inputs:{x:i.complexTensorInfos.real},backend:n})}const dL={kernelName:yn,backendName:"webgl",kernelFunc:pL},fL="return float(int(x));";function mL(t,e){const n=new TM(t.shape,fL),s=e.runWebGLProgram(n,[t],"int32");return{dataId:s.dataId,shape:s.shape,dtype:s.dtype}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function gL(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dtype:r}=s;if("complex64"===r){if("complex64"===i.dtype)return JM({inputs:{x:i},backend:n});const t=Qu(i.shape),e=gL({inputs:{x:i},backend:n,attrs:{dtype:"float32"}}),s=eP({inputs:{real:e,imag:t},backend:n});return t.dispose(),n.disposeIntermediateTensorInfo(e),s}if("complex64"===i.dtype){const t=pL({inputs:{input:i},backend:n}),e=gL({inputs:{x:t},backend:n,attrs:{dtype:r}});return n.disposeIntermediateTensorInfo(t),e}if(!P(i.dtype,r)){const t=JM({inputs:{x:i},backend:n});return{dataId:t.dataId,shape:t.shape,dtype:r}}if("int32"===r)return mL(i,n);if("bool"===r){const t=n.makeTensorInfo([],"bool",$("bool",1)),e={a:i,b:t},s=lL({inputs:e,backend:n});return n.disposeIntermediateTensorInfo(t),s}throw new Error(`Error in Cast: failed to cast ${i.dtype} to ${r}`)}const yL={kernelName:Pt,backendName:"webgl",kernelFunc:gL},bL="return ceil(x);",vL=fP({opSnippet:bL,packedOpSnippet:bL,cpuKernelImpl:PD}),wL={kernelName:Ft,backendName:"webgl",kernelFunc:vL};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class xL{constructor(t){this.variableNames=["A"],this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        float value = getAAtOutCoords();\n        if (isnan(value)) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, minVal, maxVal));\n      }\n    "}getCustomSetupFunc(t,e){return(n,s)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(s,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(s,"maxVal")),n.gl.uniform1f(this.minLoc,t),n.gl.uniform1f(this.maxLoc,e)}}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class _L{constructor(t){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t,this.userCode="\n      uniform float minVal;\n      uniform float maxVal;\n\n      void main() {\n        vec4 value = getAAtOutCoords();\n\n        if (any(isnan(value))) {\n          setOutput(value);\n          return;\n        }\n\n        setOutput(clamp(value, vec4(minVal), vec4(maxVal)));\n      }\n    "}getCustomSetupFunc(t,e){return(n,s)=>{null==this.minLoc&&(this.minLoc=n.getUniformLocationNoThrow(s,"minVal"),this.maxLoc=n.getUniformLocationNoThrow(s,"maxVal")),n.gl.uniform1f(this.minLoc,t),n.gl.uniform1f(this.maxLoc,e)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kL(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{clipValueMin:r,clipValueMax:o}=s;let a;a=at().getBool("WEBGL_PACK_CLIP")?new _L(i.shape):new xL(i.shape);const u=a.getCustomSetupFunc(r,o);return n.runWebGLProgram(a,[i],i.dtype,u)}const SL={kernelName:Lt,backendName:"webgl",kernelFunc:kL};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class TL{constructor(t){this.variableNames=["real","imag"],this.outputShape=t,this.userCode="\n      void main() {\n        float re = abs(getRealAtOutCoords());\n        float im = abs(getImagAtOutCoords());\n        float mx = max(re, im);\n\n        // sadly the length function in glsl is not underflow-safe\n        // (at least not on Intel GPUs). So the safe solution is\n        // to ensure underflow-safety in all cases.\n        setOutput(\n          mx == 0.0 ? 0.0 : mx * length(vec2(1, min(re, im)/mx))\n        );\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IL(t,e){return{dataId:e.dataId,dtype:e.dtype,shape:t.shape}}function CL(t){const{inputs:e,backend:n}=t,{x:s}=e,i=n.texData.get(s.dataId),r=new TL(s.shape),o=[IL(s,i.complexTensorInfos.real),IL(s,i.complexTensorInfos.imag)];return n.runWebGLProgram(r,o,o[0].dtype)}const AL={kernelName:Bt,backendName:"webgl",kernelFunc:CL};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class NL{constructor(t){this.outputShape=[],this.outputShape=hp(t,1),this.variableNames=t.map(((t,e)=>`T${e}`));const e=new Array(t.length-1);e[0]=t[0][1];for(let r=1;r<e.length;r++)e[r]=e[r-1]+t[r][1];const n=[`if (yC < ${e[0]}) setOutput(getT0(yR, yC));`];for(let r=1;r<e.length;r++){const t=e[r-1];n.push(`else if (yC < ${e[r]}) setOutput(getT${r}(yR, yC-${t}));`)}const s=e.length,i=e[e.length-1];n.push(`else setOutput(getT${s}(yR, yC-${i}));`),this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int yR = coords.x;\n        int yC = coords.y;\n\n        ${n.join("\n        ")}\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class EL{constructor(t,e){this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[],this.outputShape=hp(t,e);const n=this.outputShape,s=n.length,i=ID(s),r=cM("coords",s),o=["x","y","z","w","u","v"].slice(0,s);this.variableNames=t.map(((t,e)=>`T${e}`));const a=new Array(t.length-1);a[0]=t[0][e];for(let f=1;f<a.length;f++)a[f]=a[f-1]+t[f][e];const u=o[e],c=o.slice(-2),l=o.join();let h=`if (${u} < ${a[0]}) {\n        return getChannel(\n            getT0(${l}), vec2(${c.join()}));\n        }`;for(let f=1;f<a.length;f++){const t=a[f-1];h+=`\n        if (${u} < ${a[f]}  && ${u} >= ${a[f-1]}) {\n          return getChannel(\n            getT${f}(${OL(o,u,t)}),\n            vec2(${OL(c,u,t)}));\n        }`}const p=a.length,d=a[a.length-1];h+=`\n        return getChannel(\n          getT${p}(${OL(o,u,d)}),\n          vec2(${OL(c,u,d)}));`,this.userCode=`\n      float getValue(${o.map((t=>"int "+t))}) {\n        ${h}\n      }\n\n      void main() {\n        ${i} coords = getOutputCoords();\n        vec4 result = vec4(getValue(${r}), 0., 0., 0.);\n\n        ${r[s-1]} = ${r[s-1]} + 1;\n        if (${r[s-1]} < ${n[s-1]}) {\n          result.g = getValue(${r});\n        }\n\n        ${r[s-2]} = ${r[s-2]} + 1;\n        if (${r[s-2]} < ${n[s-2]}) {\n          result.a = getValue(${r});\n        }\n\n        ${r[s-1]} = ${r[s-1]} - 1;\n        if (${r[s-2]} < ${n[s-2]} &&\n            ${r[s-1]} < ${n[s-1]}) {\n          result.b = getValue(${r});\n        }\n        setOutput(result);\n      }\n    `}}function OL(t,e,n){const s=t.indexOf(e),i=t.map(((t,e)=>e===s?`${t} - ${n}`:t));return i.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $L(t){const{inputs:e,backend:n}=t,{input:s}=e,i=n.texData.get(s.dataId);return JM({inputs:{x:i.complexTensorInfos.imag},backend:n})}const RL={kernelName:Ce,backendName:"webgl",kernelFunc:$L};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function DL(t,e,n){const s=t[0].dtype;if("complex64"===s){const s=t.map((t=>pL({inputs:{input:t},backend:n}))),i=t.map((t=>$L({inputs:{input:t},backend:n}))),r=DL(s,e,n),o=DL(i,e,n),a=eP({inputs:{real:r,imag:o},backend:n});return s.forEach((t=>n.disposeIntermediateTensorInfo(t))),i.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.disposeIntermediateTensorInfo(r),n.disposeIntermediateTensorInfo(o),a}if("string"===s){const{tensors2D:i,outShape:r}=ML(t,e,n),o=i.map((t=>({vals:n.readSync(t.dataId),shape:t.shape}))),a=1===i[0].shape[0],u=FD(o,r,s,a),c=hp(t.map((t=>t.shape)),e),l=n.makeTensorInfo(c,s,u);return i.forEach((t=>n.disposeIntermediateTensorInfo(t))),l}if(t.length>at().getNumber("WEBGL_MAX_TEXTURES_IN_SHADER")){const s=Math.floor(t.length/2),i=DL(t.slice(0,s),e,n),r=DL(t.slice(s),e,n),o=DL([i,r],e,n);return n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),o}if(at().getBool("WEBGL_PACK_ARRAY_OPERATIONS")&&t[0].shape.length>1){const i=new EL(t.map((t=>t.shape)),e);return n.runWebGLProgram(i,t,s)}const{tensors2D:i,outShape:r}=ML(t,e,n),o=new NL(i.map((t=>t.shape))),a=n.runWebGLProgram(o,i,s);i.forEach((t=>n.disposeIntermediateTensorInfo(t)));const u=SP({inputs:{x:a},attrs:{shape:r},backend:n});return n.disposeIntermediateTensorInfo(a),u}function ML(t,e,n){const s=hp(t.map((t=>t.shape)),e),i=t.map((t=>SP({inputs:{x:t},attrs:{shape:[-1,k(t.shape.slice(e))]},backend:n})));return{tensors2D:i,outShape:s}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function PL(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s,r=E(i,e[0].shape)[0],o=hp(e.map((t=>t.shape)),r);if(0===k(o))return n.makeTensorInfo(o,e[0].dtype,[]);const a=e.filter((t=>k(t.shape)>0));if(1===a.length)return JM({inputs:{x:a[0]},backend:n});const u=a.map((t=>t.shape));return lp(u,r),DL(a,r,n)}const FL={kernelName:qt,backendName:"webgl",kernelFunc:PL};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class LL{constructor(t,e=!1,n=null,s=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const r=t.padInfo.top,o=t.padInfo.left,a=t.strideHeight,u=t.strideWidth,c=t.dilationHeight,l=t.dilationWidth,h=t.filterHeight,p=t.filterWidth,d=4*Math.floor(t.inChannels/4),f=t.inChannels%4,m="channelsLast"===t.dataFormat,g=m?1:2,y=m?2:3,b=m?3:1;let v="",w="";n&&(v=s?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,w="result = activation(result);");const x=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${v}\n\n      const ivec2 strides = ivec2(${a}, ${u});\n      const ivec2 pads = ivec2(${r}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d2 = coords[${b}];\n\n        ivec2 xRCCorner =\n            ivec2(coords[${g}], coords[${y}]) * strides - pads;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, d2) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${h}; wR++) {\n          int xR = xRCorner + wR * ${c};\n\n          if (xR < 0 || xR >= ${t.inHeight}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${p}; wC++) {\n            int xC = xCCorner + wC * ${l};\n\n            if (xC < 0 || xC >= ${t.inWidth}) {\n              continue;\n            }\n\n            for (int d1 = 0; d1 < ${d}; d1 += 4) {\n              vec4 wValues = vec4(\n                getW(wR, wC, d1, d2),\n                getW(wR, wC, d1 + 1, d2),\n                getW(wR, wC, d1 + 2, d2),\n                getW(wR, wC, d1 + 3, d2)\n              );\n\n              if (${m}) {\n                vec4 xValues = vec4(\n                  getX(batch, xR, xC, d1),\n                  getX(batch, xR, xC, d1 + 1),\n                  getX(batch, xR, xC, d1 + 2),\n                  getX(batch, xR, xC, d1 + 3)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec4 xValues = vec4(\n                  getX(batch, d1, xR, xC),\n                  getX(batch, d1 + 1, xR, xC),\n                  getX(batch, d1 + 2, xR, xC),\n                  getX(batch, d1 + 3, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n\n            if (${1===f}) {\n\n              if (${m}) {\n                dotProd +=\n                    getX(batch, xR, xC, ${d}) *\n                    getW(wR, wC, ${d}, d2);\n              } else {\n                dotProd +=\n                    getX(batch, ${d}, xR, xC) *\n                    getW(wR, wC, ${d}, d2);\n              }\n\n            } else if (${2===f}) {\n              vec2 wValues = vec2(\n                getW(wR, wC, ${d}, d2),\n                getW(wR, wC, ${d} + 1, d2)\n              );\n\n              if (${m}) {\n                vec2 xValues = vec2(\n                  getX(batch, xR, xC, ${d}),\n                  getX(batch, xR, xC, ${d} + 1)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec2 xValues = vec2(\n                  getX(batch, ${d}, xR, xC),\n                  getX(batch, ${d} + 1, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            } else if (${3===f}) {\n              vec3 wValues = vec3(\n                getW(wR, wC, ${d}, d2),\n                getW(wR, wC, ${d} + 1, d2),\n                getW(wR, wC, ${d} + 2, d2)\n              );\n\n              if (${m}) {\n                vec3 xValues = vec3(\n                  getX(batch, xR, xC, ${d}),\n                  getX(batch, xR, xC, ${d} + 1),\n                  getX(batch, xR, xC, ${d} + 2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else {\n                vec3 xValues = vec3(\n                  getX(batch, ${d}, xR, xC),\n                  getX(batch, ${d} + 1, xR, xC),\n                  getX(batch, ${d} + 2, xR, xC)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n\n            }\n          }\n        }\n\n        float result = dotProd;\n        ${x}\n        ${w}\n        setOutput(result);\n      }\n    `}}class zL{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const e=t.padInfo.front,n=t.padInfo.top,s=t.padInfo.left,i=t.strideDepth,r=t.strideHeight,o=t.strideWidth,a=t.dilationDepth,u=t.dilationHeight,c=t.dilationWidth,l=t.filterDepth,h=t.filterHeight,p=t.filterWidth,d=4*Math.floor(t.inChannels/4),f=t.inChannels%4;this.userCode=`\n      const ivec3 strides = ivec3(${i}, ${r}, ${o});\n      const ivec3 pads = ivec3(${e}, ${n}, ${s});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d2 = coords.u;\n\n        ivec3 xFRCCorner = ivec3(coords.y, coords.z, coords.w) * strides - pads;\n        int xFCorner = xFRCCorner.x;\n        int xRCorner = xFRCCorner.y;\n        int xCCorner = xFRCCorner.z;\n\n        // Convolve x(?, ?, ?, d1) with w(:, :, :, d1, d2) to get\n        // y(yF, yR, yC, d2). ? = to be determined. : = across all\n        // values in that axis.\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${l}; wF++) {\n          int xF = xFCorner + wF * ${a};\n\n          if (xF < 0 || xF >= ${t.inDepth}) {\n            continue;\n          }\n\n          for (int wR = 0; wR < ${h}; wR++) {\n            int xR = xRCorner + wR * ${u};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int wC = 0; wC < ${p}; wC++) {\n              int xC = xCCorner + wC * ${c};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              for (int d1 = 0; d1 < ${d}; d1 += 4) {\n                vec4 xValues = vec4(\n                  getX(batch, xF, xR, xC, d1),\n                  getX(batch, xF, xR, xC, d1 + 1),\n                  getX(batch, xF, xR, xC, d1 + 2),\n                  getX(batch, xF, xR, xC, d1 + 3)\n                );\n                vec4 wValues = vec4(\n                  getW(wF, wR, wC, d1, d2),\n                  getW(wF, wR, wC, d1 + 1, d2),\n                  getW(wF, wR, wC, d1 + 2, d2),\n                  getW(wF, wR, wC, d1 + 3, d2)\n                );\n\n                dotProd += dot(xValues, wValues);\n              }\n\n              if (${1===f}) {\n                dotProd +=\n                  getX(batch, xF, xR, xC, ${d}) *\n                  getW(wF, wR, wC, ${d}, d2);\n              } else if (${2===f}) {\n                vec2 xValues = vec2(\n                  getX(batch, xF, xR, xC, ${d}),\n                  getX(batch, xF, xR, xC, ${d} + 1)\n                );\n                vec2 wValues = vec2(\n                  getW(wF, wR, wC, ${d}, d2),\n                  getW(wF, wR, wC, ${d} + 1, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              } else if (${3===f}) {\n                vec3 xValues = vec3(\n                  getX(batch, xF, xR, xC, ${d}),\n                  getX(batch, xF, xR, xC, ${d} + 1),\n                  getX(batch, xF, xR, xC, ${d} + 2)\n                );\n                vec3 wValues = vec3(\n                  getW(wF, wR, wC, ${d}, d2),\n                  getW(wF, wR, wC, ${d} + 1, d2),\n                  getW(wF, wR, wC, ${d} + 2, d2)\n                );\n                dotProd += dot(xValues, wValues);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class BL{constructor(t,e,n){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t;const{filterWidth:s,inChannels:i,strideWidth:r,strideHeight:o,padInfo:a,outWidth:u,dilationWidth:c,dilationHeight:l,dataFormat:h}=n,{left:p,top:d}=a,f=i*s,m=iR(),g="channelsLast"===h,y=g?0:1,b=g?1:2;let v="";for(let w=0;w<=1;w++)for(let n=0;n<=1;n++)v+=`\n          blockIndex = rc.y + ${n};\n          pos = rc.x + ${w};\n\n          if(blockIndex < ${t[1]} && pos < ${t[0]}) {\n            offsetY = int(blockIndex / (${u})) * ${o} - ${d};\n            d0 = offsetY + ${l} * (pos / ${f});\n\n            if(d0 < ${e[y]} && d0 >= 0) {\n\n              offsetX = int(mod(float(blockIndex), ${u}.) * ${r}. - ${p}.);\n              d1 = offsetX + ${c} * (int(mod(float(pos), ${f}.) / ${i}.));\n\n              if(d1 < ${e[b]} && d1 >= 0) {\n\n                ch = int(mod(float(pos), ${i}.));\n\n                if (${g}) {\n                  innerDims = vec2(d1, ch);\n                  result[${2*w+n}] = getChannel(\n                    getA(d0, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                } else {\n                  innerDims = vec2(d0, d1);\n                  result[${2*w+n}] = getChannel(\n                    getA(ch, int(innerDims.x),\n                    int(innerDims.y)), innerDims);\n                }\n              }\n            }\n          }\n        `;this.userCode=`\n      void main() {\n        ivec2 rc = getOutputCoords();\n\n        vec4 result = vec4(0);\n\n        int blockIndex, pos, offsetY, d0, offsetX, d1, ch;\n        vec2 innerDims;\n\n        ${v}\n\n        ${m.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qL({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const u=t.shape,c=s.texData.get(t.dataId),l=n.inChannels,h=u[0]*u[1]*u[2],p=n.outChannels,d="channelsLast"===n.dataFormat,f=!1,m=!1;let g;const y=[],b=(1===h||1===p)&&l>zP,w=u[2]%2!==0&&!!c.isPacked;if(!b&&at().getBool("WEBGL_LAZILY_UNPACK")&&at().getBool("WEBGL_PACK_BINARY_OPERATIONS")&&w){const l=d?u[0]*u[1]*(u[2]+1):u[0]*u[2]*(u[3]+1),h={dataId:t.dataId,shape:[1,l,n.inChannels],dtype:t.dtype},p=c.shape;c.shape=c.shape.slice(),c.shape[c.shape.length-2]++,v(W$(c.shape,h.shape),(()=>`packed reshape ${c.shape} to ${h.shape} isn't free`));const b=SP({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}});y.push(b);const w=BP({a:h,b:b,backend:s,transposeA:f,transposeB:m,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o}),x=s.texData.get(w.dataId);v(x.isPacked,(()=>"batchMatMul result is expected to be packed")),c.shape=p,x.shape=n.outShape,g=JM({inputs:{x:w},backend:s}),g.shape=n.outShape,y.push(w)}else{const c=d?u[0]*u[1]*u[2]:u[0]*u[2]*u[3],l=SP({inputs:{x:t},backend:s,attrs:{shape:[1,c,n.inChannels]}}),h=SP({inputs:{x:e},backend:s,attrs:{shape:[1,n.inChannels,n.outChannels]}}),p=BP({a:l,b:h,transposeA:f,transposeB:m,backend:s,bias:i,activation:a,preluActivationWeights:r,leakyreluAlpha:o});g=SP({inputs:{x:p},backend:s,attrs:{shape:n.outShape}}),y.push(l),y.push(h),y.push(p)}for(const v of y)s.disposeIntermediateTensorInfo(v);return g}function VL({x:t,filter:e,convInfo:n,backend:s,bias:i=null,preluActivationWeights:r=null,leakyreluAlpha:o=0,activation:a=null}){const{filterWidth:u,filterHeight:c,inChannels:l,outWidth:h,outHeight:p,dataFormat:d}=n,f="channelsLast"===d,m=u*c*l,g=p*h,y=[m,g],b=!0,v=!1,w=[],x=SP({inputs:{x:t},backend:s,attrs:{shape:t.shape.slice(1)}}),_=SP({inputs:{x:e},backend:s,attrs:{shape:[1,m,k(e.shape)/m]}});w.push(x),w.push(_);const S=new BL(y,x.shape,n),T=s.runWebGLProgram(S,[x],"float32"),I=SP({inputs:{x:T},backend:s,attrs:{shape:[1,y[0],y[1]]}});w.push(T),w.push(I);const C=null!=i,A=null!=r,N="leakyrelu"===a,E=a?gP(a,!0):null,O=new yP(I.shape,_.shape,[1,g,n.outChannels],b,v,C,E,A,N),$=[I,_];if(i&&$.push(i),A&&$.push(r),N){const t=s.makeTensorInfo([],"float32",Os(o,"float32"));$.push(t),w.push(t)}const R=s.runWebGLProgram(O,$,"float32"),D=f?[1,p,h,n.outChannels]:[1,n.outChannels,p,h],M=SP({inputs:{x:R},backend:s,attrs:{shape:D}});w.push(R);for(const k of w)s.disposeIntermediateTensorInfo(k);return M}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function WL(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dataFormat:u,dilations:c,dimRoundingMode:l}=s,h=jo(u),p=Oo(i.shape,r.shape,o,c,a,l,!1,h);let d;if(1!==p.filterHeight||1!==p.filterWidth||1!==p.dilationHeight||1!==p.dilationWidth||1!==p.strideHeight||1!==p.strideWidth||"SAME"!==p.padInfo.type&&"VALID"!==p.padInfo.type)if(at().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])d=VL({x:i,filter:r,convInfo:p,backend:n});else{const t=new LL(p);d=n.runWebGLProgram(t,[i,r],"float32")}else d=qL({x:i,filter:r,convInfo:p,backend:n});const f=SP({inputs:{x:d},backend:n,attrs:{shape:p.outShape}});return n.disposeIntermediateTensorInfo(d),f}const jL={kernelName:Vt,backendName:"webgl",kernelFunc:WL};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class UL{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,s=t.padInfo.top,i=t.padInfo.left,r="channelsLast"===t.dataFormat;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int d2 = coords.w;\n\n        // Convolve x(?, ?, d1) with dy(:, :, d2) to get dw(wR, wC, d1, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${s};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              if (${r}) {\n                float dyValue = getDy(b, yR, yC, d2);\n                float xValue = getX(b, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              } else {\n                float dyValue = getDy(b, d2, yR, yC);\n                float xValue = getX(b, d1, xR, xC);\n                dotProd += (xValue * dyValue);\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class GL{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,s=t.strideHeight,i=t.strideWidth,r="channelsLast"===t.dataFormat,o=e-1-t.padInfo.top,a=n-1-t.padInfo.left,u=r?1:2,c=r?2:3,l=r?3:1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[${l}];\n\n        ivec2 dyCorner = ivec2(coords[${u}], coords[${c}]) - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        // Convolve dy(?, ?, d2) with w(:, :, d1, d2) to compute dx(xR, xC, d1).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${s}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n\n              if (${r}) {\n                float xValue = getDy(batch, idyR, idyC, d2);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              } else {\n                float xValue = getDy(batch, d2, idyR, idyC);\n                float wValue = getW(wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class HL{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideDepth,n=t.strideHeight,s=t.strideWidth,i=t.padInfo.front,r=t.padInfo.top,o=t.padInfo.left;this.userCode=`\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int wF = coords.x;\n        int wR = coords.y;\n        int wC = coords.z;\n        int d1 = coords.w;\n        int d2 = coords.u;\n\n        float dotProd = 0.0;\n\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yF = 0; yF < ${t.outDepth}; yF++) {\n            int xF = wF + yF * ${e} - ${i};\n\n            if (xF < 0 || xF >= ${t.inDepth}) {\n              continue;\n            }\n\n            for (int yR = 0; yR < ${t.outHeight}; yR++) {\n              int xR = wR + yR * ${n} - ${r};\n\n              if (xR < 0 || xR >= ${t.inHeight}) {\n                continue;\n              }\n\n              for (int yC = 0; yC < ${t.outWidth}; yC++) {\n                int xC = wC + yC * ${s} - ${o};\n\n                if (xC < 0 || xC >= ${t.inWidth}) {\n                  continue;\n                }\n\n                float dyValue = getDy(b, yF, yR, yC, d2);\n                float xValue = getX(b, xF, xR, xC, d1);\n                dotProd += (xValue * dyValue);\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class KL{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterDepth,n=t.filterHeight,s=t.filterWidth,i=t.strideDepth,r=t.strideHeight,o=t.strideWidth,a=e-1-t.padInfo.front,u=n-1-t.padInfo.top,c=s-1-t.padInfo.left;this.userCode=`\n      const ivec3 pads = ivec3(${a}, ${u}, ${c});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.u;\n\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyFCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        float dotProd = 0.0;\n        for (int wF = 0; wF < ${e}; wF++) {\n          float dyF = float(dyFCorner + wF) / ${i}.0;\n\n          if (dyF < 0.0 || dyF >= ${t.outDepth}.0 || fract(dyF) > 0.0) {\n            continue;\n          }\n          int idyF = int(dyF);\n\n          int wFPerm = ${e} - 1 - wF;\n\n          for (int wR = 0; wR < ${n}; wR++) {\n            float dyR = float(dyRCorner + wR) / ${r}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n              fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            int wRPerm = ${n} - 1 - wR;\n\n            for (int wC = 0; wC < ${s}; wC++) {\n              float dyC = float(dyCCorner + wC) / ${o}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              int wCPerm = ${s} - 1 - wC;\n\n              for (int d2 = 0; d2 < ${t.outChannels}; d2++) {\n                float xValue = getDy(batch, idyF, idyR, idyC, d2);\n                float wValue = getW(wFPerm, wRPerm, wCPerm, d1, d2);\n                dotProd += xValue * wValue;\n              }\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function XL(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,dataFormat:u,dimRoundingMode:c,filterShape:l}=s,h=jo(u),p=Oo(i.shape,l,o,1,a,c,!1,h),d=new UL(p);return n.runWebGLProgram(d,[i,r],"float32")}const QL={kernelName:Wt,backendName:"webgl",kernelFunc:XL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function YL(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{inputShape:o,strides:a,pad:u,dataFormat:c,dimRoundingMode:l}=s,h=jo(c),p=Oo(o,r.shape,a,1,u,l,!1,h),d=new GL(p);return n.runWebGLProgram(d,[i,r],"float32")}const ZL={kernelName:jt,backendName:"webgl",kernelFunc:YL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function JL(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:u}=s,c=$o(i.shape,r.shape,o,u,a),l=new zL(c);return n.runWebGLProgram(l,[i,r],"float32")}const tz={kernelName:Ut,backendName:"webgl",kernelFunc:JL};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function ez(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,pad:a,filterShape:u}=s,c=$o(i.shape,u,o,1,a),l=new HL(c);return n.runWebGLProgram(l,[i,r],"float32")}const nz={kernelName:Gt,backendName:"webgl",kernelFunc:ez};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function sz(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{pad:o,strides:a,inputShape:u}=s,c=$o(u,r.shape,a,1,o),l=new KL(c);return n.runWebGLProgram(l,[i,r],"float32")}const iz={kernelName:Ht,backendName:"webgl",kernelFunc:sz},rz=hP+"\n  return cos(x);\n",oz=fP({opSnippet:rz}),az={kernelName:Kt,backendName:"webgl",kernelFunc:oz},uz="\n  float e2x = exp(-x);\n  return (e2x + 1.0 / e2x) / 2.0;\n",cz=fP({opSnippet:uz}),lz={kernelName:Xt,backendName:"webgl",kernelFunc:cz};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class hz{constructor(t,e,n,s,i){this.variableNames=["Image","Boxes","BoxInd"],this.outputShape=[];const[r,o,a,u]=t,[c]=e,[l,h]=n;this.outputShape=[c,l,h,u];const p="bilinear"===s?1:0,[d,f]=[o-1+".0",a-1+".0"],[m,g,y]=l>1?[""+(o-1)/(l-1),"(y2-y1) * height_ratio",`y1*${d} + float(y)*(height_scale)`]:["0.0","0.0",`0.5 * (y1+y2) * ${d}`],[b,v,w]=h>1?[""+(a-1)/(h-1),"(x2-x1) * width_ratio",`x1*${f} + float(x)*(width_scale)`]:["0.0","0.0",`0.5 * (x1+x2) * ${f}`];this.userCode=`\n      const float height_ratio = float(${m});\n      const float width_ratio = float(${b});\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int y = coords[1];\n        int x = coords[2];\n        int d = coords[3];\n\n        // get box vals\n        float y1 = getBoxes(b,0);\n        float x1 = getBoxes(b,1);\n        float y2 = getBoxes(b,2);\n        float x2 = getBoxes(b,3);\n\n        // get image in batch index\n        int bInd = round(getBoxInd(b));\n        if(bInd < 0 || bInd >= ${r}) {\n          return;\n        }\n\n        float height_scale = ${g};\n        float width_scale = ${v};\n\n        float in_y = ${y};\n        if( in_y < 0.0 || in_y > ${d} ) {\n          setOutput(float(${i}));\n          return;\n        }\n        float in_x = ${w};\n        if( in_x < 0.0 || in_x > ${f} ) {\n          setOutput(float(${i}));\n          return;\n        }\n\n        vec2 sourceFracIndexCR = vec2(in_x,in_y);\n        if(${p} == 1) {\n          // Compute the four integer indices.\n          ivec2 sourceFloorCR = ivec2(sourceFracIndexCR);\n          ivec2 sourceCeilCR = ivec2(ceil(sourceFracIndexCR));\n\n          float topLeft = getImage(b, sourceFloorCR.y, sourceFloorCR.x, d);\n          float bottomLeft = getImage(b, sourceCeilCR.y, sourceFloorCR.x, d);\n          float topRight = getImage(b, sourceFloorCR.y, sourceCeilCR.x, d);\n          float bottomRight = getImage(b, sourceCeilCR.y, sourceCeilCR.x, d);\n\n          vec2 fracCR = sourceFracIndexCR - vec2(sourceFloorCR);\n\n          float top = topLeft + (topRight - topLeft) * fracCR.x;\n          float bottom = bottomLeft + (bottomRight - bottomLeft) * fracCR.x;\n          float newValue = top + (bottom - top) * fracCR.y;\n          setOutput(newValue);\n        } else {\n          // Compute the coordinators of nearest neighbor point.\n          ivec2 sourceNearestCR = ivec2(floor(\n            sourceFracIndexCR + vec2(0.5,0.5)));\n          float newValue = getImage(b, sourceNearestCR.y, sourceNearestCR.x, d);\n          setOutput(newValue);\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const pz=t=>{const{inputs:e,backend:n,attrs:s}=t,{image:i,boxes:r,boxInd:o}=e,{cropSize:a,method:u,extrapolationValue:c}=s,l=new hz(i.shape,r.shape,a,u,c);return n.runWebGLProgram(l,[i,r,o],"float32")},dz={kernelName:Yt,backendName:"webgl",kernelFunc:pz};class fz{constructor(t,e,n){this.variableNames=["x"],this.outputShape=t;const s=t.length,i=e?"0.0":`getX(${mz(s,"coords")})`,r=t[t.length-1];let o="",a="";e?(o=n?"end != "+(r-1):"end != 0",a=n?"end + 1":"end - 1"):(o=n?`end + pow2 < ${r}`:"end >= pow2",a=n?"end + pow2":"end - pow2"),this.userCode=`\n      uniform float index;\n      void main() {\n        ${ID(s)} coords = getOutputCoords();\n        int end = ${gz(s,"coords")};\n        float val = ${i};\n        int pow2 = int(pow(2.0, index));\n        if (${o}) {\n          int idx = ${a};\n          ${gz(s,"coords")} = idx;\n          val += getX(${mz(s,"coords")});\n        }\n        setOutput(val);\n      }\n    `}getCustomSetupFunc(t){return(e,n)=>{null==this.index&&(this.index=e.getUniformLocation(n,"index")),e.gl.uniform1f(this.index,t)}}}function mz(t,e){if(1===t)return`${e}`;if(2===t)return`${e}.x, ${e}.y`;if(3===t)return`${e}.x, ${e}.y, ${e}.z`;if(4===t)return`${e}.x, ${e}.y, ${e}.z, ${e}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}function gz(t,e){if(1===t)return`${e}`;if(2===t)return`${e}.y`;if(3===t)return`${e}.z`;if(4===t)return`${e}.w`;throw Error(`Cumulative sum for rank ${t} is not yet supported`)}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function yz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,exclusive:o,reverse:a}=s,u=i.shape.length,c=Fu([r],u);let l=i;null!=c&&(l=FP({inputs:{x:i},backend:n,attrs:{perm:c}}));const h=zu(1,u)[0];if(h!==u-1)throw new Error(`WebGL cumsum shader expects an inner-most axis=${i.shape.length-1} but got axis=${r}`);const p=l.shape[h];let d=JM({inputs:{x:l},backend:n});for(let f=0;f<=Math.ceil(Math.log2(p))-1;f++){const t=new fz(l.shape,!1,a),e=t.getCustomSetupFunc(f),s=d;d=n.runWebGLProgram(t,[d],d.dtype,e),n.disposeIntermediateTensorInfo(s)}if(o){const t=new fz(l.shape,o,a),e=d;d=n.runWebGLProgram(t,[d],d.dtype),n.disposeIntermediateTensorInfo(e)}if(null!=c){const t=Lu(c),e=FP({inputs:{x:d},backend:n,attrs:{perm:t}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(l),e}return d}const bz={kernelName:Qt,backendName:"webgl",kernelFunc:yz};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function vz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,weights:r}=e,{size:o,binaryOutput:a}=s;if(1===i.shape.length){const t=n.readSync(i.dataId),e=n.readSync(r.dataId),s=DD(t,e,r.dtype,r.shape,o);return n.makeTensorInfo([o],r.dtype,s)}if(2===i.shape.length){const t=n.bufferSync(i),e=n.bufferSync(r),s=MD(t,e,o,a);return n.makeTensorInfo(s.shape,r.dtype,s.values)}throw new Error(`Error in denseBincount: input must be at most rank 2, but got rank${i.shape.length}.`)}const wz={kernelName:Zt,backendName:"webgl",kernelFunc:vz};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class xz{constructor(t,e,n){this.variableNames=["x"],this.outputShape=[],this.outputShape=t,this.blockSize=e,this.dataFormat=n,this.userCode=`\n    void main() {\n      ivec4 coords = getOutputCoords();\n      int b = coords[0];\n      int h = ${this.getHeightCoordString()};\n      int w = ${this.getWidthCoordString()};\n      int d = ${this.getDepthCoordString()};\n\n      int in_h = h / ${e};\n      int offset_h = imod(h, ${e});\n      int in_w = w / ${e};\n      int offset_w = imod(w, ${e});\n      int offset_d = (offset_h * ${e} + offset_w) *\n        ${this.getOutputDepthSize()};\n      int in_d = d + offset_d;\n\n      float result = ${this.getInputSamplingString()};\n      setOutput(result);\n    }\n  `}getHeightCoordString(){return"NHWC"===this.dataFormat?"coords[1]":"coords[2]"}getWidthCoordString(){return"NHWC"===this.dataFormat?"coords[2]":"coords[3]"}getDepthCoordString(){return"NHWC"===this.dataFormat?"coords[3]":"coords[1]"}getOutputDepthSize(){return"NHWC"===this.dataFormat?this.outputShape[3]:this.outputShape[1]}getInputSamplingString(){return"NHWC"===this.dataFormat?"getX(b, in_h, in_w, in_d)":"getX(b, in_d, in_h, in_w)"}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function _z(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockSize:r,dataFormat:o}=s;v(r>1,(()=>`blockSize should be > 1 for depthToSpace, but was: ${r}`));const a=i.shape[0],u="NHWC"===o?i.shape[1]:i.shape[2],c="NHWC"===o?i.shape[2]:i.shape[3],l="NHWC"===o?i.shape[3]:i.shape[1],h=u*r,p=c*r,d=l/(r*r),f="NHWC"===o?[a,h,p,d]:[a,d,h,p],m=new xz(f,r,o);return n.runWebGLProgram(m,[i],i.dtype)}const kz={kernelName:Jt,backendName:"webgl",kernelFunc:_z};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Sz{constructor(t,e=!1,n=null,s=!1,i=!1){this.variableNames=["x","W"],this.outputShape=t.outShape;const r=t.inHeight,o=t.inWidth,a=t.padInfo.top,u=t.padInfo.left,c=t.strideHeight,l=t.strideWidth,h=t.dilationHeight,p=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,m=t.outChannels/t.inChannels;let g="",y="";n&&(g=s?`float activation(float a) {\n          float b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`float activation(float a) {\n          float b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`\n          float activation(float x) {\n            ${n}\n          }\n        `,y="result = activation(result);");const b=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${g}\n\n      const ivec2 strides = ivec2(${c}, ${l});\n      const ivec2 pads = ivec2(${a}, ${u});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2 / ${m};\n        int q = d2 - d1 * ${m};\n\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        // Convolve x(?, ?, d1) with w(:, :, d1, q) to get y(yR, yC, d2).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        // TO DO(dsmilkov): Flatten the two for loops and vec4 the operations.\n        for (int wR = 0; wR < ${d}; wR++) {\n          int xR = xRCorner + wR * ${h};\n\n          if (xR < 0 || xR >= ${r}) {\n            continue;\n          }\n\n          for (int wC = 0; wC < ${f}; wC++) {\n            int xC = xCCorner + wC * ${p};\n\n            if (xC < 0 || xC >= ${o}) {\n              continue;\n            }\n\n            float xVal = getX(batch, xR, xC, d1);\n            float wVal = getW(wR, wC, d1, q);\n            dotProd += xVal * wVal;\n          }\n        }\n\n        float result = dotProd;\n        ${b}\n        ${y}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Tz{constructor(t,e=!1,n=null,s=!1,i=!1){this.variableNames=["x","W"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=t.outShape;const r=t.inHeight,o=t.inWidth,a=t.padInfo.top,u=t.padInfo.left,c=t.strideHeight,l=t.strideWidth,h=t.dilationHeight,p=t.dilationWidth,d=t.filterHeight,f=t.filterWidth,m=f;let g="int xR; int xC; int xCOffset;";for(let y=0;y<d;y++)for(let t=0;t<f;t++)g+=`\n          vec4 xTexelR${y}C${2*t} = vec4(0.);\n          vec4 wR${y}C${t} = vec4(0.);\n          vec4 xR${y}C${t} = vec4(0.);`;for(let x=0;x<d;x++)for(let t=0;t<m;t++){const e=2*t;if(g+=`\n          xR = xRCorner + ${x*h};\n          xC = xCCorner + ${e*p};\n        `,1===l){if(e<f&&(g+=u%2===1?`\n                xCOffset = xC + 1;\n                if(xR >= 0 && xR < ${r} && xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    xTexelR${x}C${e}.zw = vec2(0.);\n                  }\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                xCOffset = xC + 1 - 2;\n                if(xR >= 0 && xR < ${r} && xCOffset >= 0 && xCOffset < ${o}) {\n                  vec4 previous = getX(batch, xR, xCOffset, d1);\n\n                  // Need to manually clear unused channels in case\n                  // we're reading from recycled texture.\n                  if(xCOffset + 1 >= ${o}) {\n                    previous.zw = vec2(0.);\n                  }\n\n                  xR${x}C${e} = vec4(previous.zw, xTexelR${x}C${e}.xy);\n                } else {\n                  xR${x}C${e} = vec4(0, 0, xTexelR${x}C${e}.xy);\n                }\n              `:`\n                if(xR >= 0 && xR < ${r} && xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                xR${x}C${e} = xTexelR${x}C${e};\n              `,e+1<f)){const t=u%2===0?y(p):p;p%2===0&&u%2===1||p%2!==0&&u%2!==1?(g+=`\n                  xCOffset = xC + ${u%2} + ${t};\n\n                  if(xR >= 0 && xR < ${r} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${e+2} = getX(batch, xR, xCOffset, d1);\n                  }\n                `,p>1&&(g+=`\n                    xCOffset -= 2;\n                    if(xR >= 0 && xR < ${r} &&\n                      xCOffset >= 0 && xCOffset < ${o}) {\n                      xTexelR${x}C${e} = getX(batch, xR, xCOffset, d1);\n                    } else {\n                      xTexelR${x}C${e} = vec4(0.);\n                    }\n                  `),g+=`\n                  xR${x}C${e+1} = vec4(\n                    xTexelR${x}C${e}.zw, xTexelR${x}C${e+2}.xy);\n                `):g+=`\n                  xCOffset = xC + ${t};\n\n                  if(xR >= 0 && xR < ${r} &&\n                    xCOffset >= 0 && xCOffset < ${o}) {\n                    xTexelR${x}C${e+2} = getX(batch, xR, xCOffset, d1);\n                  }\n\n                  xR${x}C${e+1} = xTexelR${x}C${e+2};\n                `}}else e<f&&(g+=`\n              if(xR >= 0 && xR < ${r}) {\n            `,u%2===1?(g+=`\n                xCOffset = xC + 1 - ${l};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                if(xC + 1 >= 0 && xC + 1 < ${o}) {\n                  xTexelR${x}C${e+2} = getX(batch, xR, xC + 1, d1);\n                } else {\n                  xTexelR${x}C${e+2} = vec4(0.);\n                }\n\n                xR${x}C${e} = vec4(\n                  xTexelR${x}C${e}.zw, xTexelR${x}C${e+2}.zw);\n              `,e+1<f&&(g+=`\n                  vec4 final = vec4(0.);\n                  xCOffset = xC + 1 + ${l};\n                  if(xCOffset >= 0 && xCOffset < ${o}) {\n                    final = getX(batch, xR, xCOffset, d1);\n                  }\n                  xR${x}C${e+1} = vec4(xTexelR${x}C${e+2}.xy, final.xy);\n                `)):(g+=`\n                if(xC >= 0 && xC < ${o}) {\n                  xTexelR${x}C${e} = getX(batch, xR, xC, d1);\n                } else {\n                  xTexelR${x}C${e} = vec4(0.);\n                }\n\n                xCOffset = xC + ${l};\n                if(xCOffset >= 0 && xCOffset < ${o}) {\n                  xTexelR${x}C${e+2} = getX(batch, xR, xCOffset, d1);\n                } else {\n                  xTexelR${x}C${e+2} = vec4(0.);\n                }\n\n                xR${x}C${e} = vec4(\n                  xTexelR${x}C${e}.xy, xTexelR${x}C${e+2}.xy);\n              `,e+1<f&&(g+=`\n                  xR${x}C${e+1} = vec4(\n                    xTexelR${x}C${e}.zw, xTexelR${x}C${e+2}.zw);\n                `)),g+="}");e<f&&(g+=`\n            vec4 wTexelR${x}C${e} = getW(${x}, ${e}, d1, q);\n            wR${x}C${e} = vec4(wTexelR${x}C${e}.xz, wTexelR${x}C${e}.xz);\n          `,e+1<f&&(g+=`\n              vec4 wTexelR${x}C${e+1} = getW(${x}, ${e+1}, d1, q);\n              wR${x}C${e+1} =\n                vec4(wTexelR${x}C${e+1}.xz, wTexelR${x}C${e+1}.xz);`))}for(let y=0;y<d;y++)for(let t=0;t<f;t++)g+=`dotProd += xR${y}C${t} * wR${y}C${t};`;let b="",v="";n&&(b=s?`vec4 activation(vec4 a) {\n          vec4 b = getPreluActivationWeightsAtOutCoords();\n          ${n}\n        }`:i?`vec4 activation(vec4 a) {\n          vec4 b = getLeakyreluAlphaAtOutCoords();\n          ${n}\n        }`:`vec4 activation(vec4 x) {\n          ${n}\n        }`,v="result = activation(result);");const w=e?"result += getBiasAtOutCoords();":"";e&&this.variableNames.push("bias"),s&&this.variableNames.push("preluActivationWeights"),i&&this.variableNames.push("leakyreluAlpha"),this.userCode=`\n      ${b}\n\n      const ivec2 strides = ivec2(${c}, ${l});\n      const ivec2 pads = ivec2(${a}, ${u});\n\n      void main() {\n\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        ivec2 xRCCorner = coords.yz * strides - pads;\n        int d2 = coords.w;\n        int d1 = d2;\n        int q = 0;\n        int xRCorner = xRCCorner.x;\n        int xCCorner = xRCCorner.y;\n\n        vec4 dotProd = vec4(0.);\n\n        ${g}\n\n        vec4 result = dotProd;\n        ${w}\n        ${v}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Iz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:u,dimRoundingMode:c}=s;let l=u;null==l&&(l=[1,1]),v(Wo(o,l),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${o} and dilations '${l}'`));const h=Oo(i.shape,r.shape,o,l,a,c,!0);let p;return p=at().getBool("WEBGL_PACK_DEPTHWISECONV")&&h.strideWidth<=2&&h.outChannels/h.inChannels===1?new Tz(h):new Sz(h),n.runWebGLProgram(p,[i,r],"float32")}const Cz={kernelName:te,backendName:"webgl",kernelFunc:Iz};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Az{constructor(t){this.variableNames=["x","dy"],this.outputShape=t.filterShape;const e=t.strideHeight,n=t.strideWidth,s=t.padInfo.top,i=t.padInfo.left,r=t.outChannels/t.inChannels;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int wR = coords.x;\n        int wC = coords.y;\n        int d1 = coords.z;\n        int dm = coords.w;\n        int d2 = d1 * ${r} + dm;\n\n        float dotProd = 0.0;\n\n        // TO DO: Vec4 over the batch size\n        for (int b = 0; b < ${t.batchSize}; b++) {\n          for (int yR = 0; yR < ${t.outHeight}; yR++) {\n            int xR = wR + yR * ${e} - ${s};\n\n            if (xR < 0 || xR >= ${t.inHeight}) {\n              continue;\n            }\n\n            for (int yC = 0; yC < ${t.outWidth}; yC++) {\n              int xC = wC + yC * ${n} - ${i};\n\n              if (xC < 0 || xC >= ${t.inWidth}) {\n                continue;\n              }\n\n              float dyValue = getDy(b, yR, yC, d2);\n              float xValue = getX(b, xR, xC, d1);\n              dotProd += (xValue * dyValue);\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Nz{constructor(t){this.variableNames=["dy","W"],this.outputShape=t.inShape;const e=t.filterHeight,n=t.filterWidth,s=t.strideHeight,i=t.strideWidth,r=e-1-t.padInfo.top,o=n-1-t.padInfo.left,a=t.outChannels/t.inChannels;this.userCode=`\n      const ivec2 pads = ivec2(${r}, ${o});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords[0];\n        int d1 = coords[3];\n        ivec2 dyCorner = coords.yz - pads;\n        int dyRCorner = dyCorner.x;\n        int dyCCorner = dyCorner.y;\n\n        float dotProd = 0.0;\n\n        for (int wR = 0; wR < ${e}; wR++) {\n          float dyR = float(dyRCorner + wR) / ${s}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          int wRPerm = ${e} - 1 - wR;\n\n          for (int wC = 0; wC < ${n}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${i}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            int wCPerm = ${n} - 1 - wC;\n\n            // TO DO: Vec4 over the channelMul\n            for (int dm = 0; dm < ${a}; dm++) {\n              int d2 = d1 * ${a} + dm;\n              float xValue = getDy(batch, idyR, idyC, d2);\n              float wValue = getW(wRPerm, wCPerm, d1, dm);\n              dotProd += xValue * wValue;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Ez(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,dy:r}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:c,filterShape:l}=s,h=Oo(i.shape,l,o,a,u,c,!0),p=new Az(h);return n.runWebGLProgram(p,[i,r],"float32")}const Oz={kernelName:ee,backendName:"webgl",kernelFunc:Ez};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $z(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,filter:r}=e,{strides:o,dilations:a,pad:u,dimRoundingMode:c,inputShape:l}=s,h=Oo(l,r.shape,o,a,u,c,!0),p=new Nz(h);return n.runWebGLProgram(p,[i,r],"float32")}const Rz={kernelName:ne,backendName:"webgl",kernelFunc:$z};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Dz{constructor(t){this.variableNames=["X"],this.outputShape=[t,t],this.userCode="\n      void main() {\n          ivec2 coords = getOutputCoords();\n          float val = coords[0] == coords[1] ? getX(coords[0]) : 0.0;\n          setOutput(val);\n      }\n    "}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Mz(t){const{inputs:e,backend:n}=t,{x:s}=e,i=[...s.shape,...s.shape],r=k(s.shape),o=SP({inputs:{x:s},backend:n,attrs:{shape:[r]}}),a=new Dz(r),u=n.runWebGLProgram(a,[o],o.dtype),c=SP({inputs:{x:u},backend:n,attrs:{shape:i}});return n.disposeIntermediateTensorInfo(o),n.disposeIntermediateTensorInfo(u),c}const Pz={kernelName:se,backendName:"webgl",kernelFunc:Mz};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Fz{constructor(t){this.variableNames=["x","W"],this.outputShape=t.outShape;const{inHeight:e,inWidth:n,padInfo:s,strideHeight:i,strideWidth:r,filterHeight:o,filterWidth:a,dilationHeight:u,dilationWidth:c}=t,{top:l,left:h}=s;this.userCode=`\n      const ivec2 strides = ivec2(${i}, ${r});\n      const ivec2 pads = ivec2(${l}, ${h});\n      const float neg_infinity = -3.4e38;\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int batch = coords.x;\n        int d1 = coords.w;\n        ivec2 outTopLeftCorner =\n            coords.yz * strides - pads;\n        int hBeg = outTopLeftCorner.x;\n        int wBeg = outTopLeftCorner.y;\n\n        float curVal = neg_infinity;\n        for (int h = 0; h < ${o}; h++) {\n          int hIn = hBeg + h * ${u};\n\n          if (hIn >= 0 && hIn < ${e}) {\n            for (int w = 0; w < ${a}; w++) {\n              int wIn = wBeg + w * ${c};\n\n              if (wIn >= 0 && wIn < ${n}) {\n                float xVal = getX(batch, hIn, wIn, d1);\n                float wVal = getW(h, w, d1);\n\n                float val = xVal + wVal;\n                if (val > curVal) {\n                  curVal = val;\n                }\n              }\n            }\n          }\n        }\n\n        float result = curVal;\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Lz(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r}=e,{strides:o,pad:a,dilations:u}=s,c=Ao(i.shape,r.shape,o,a,"NHWC",u);let l;const h=new Fz(c);l=n.runWebGLProgram(h,[i,r],"float32");const p=SP({inputs:{x:l},backend:n,attrs:{shape:c.outShape}});return n.disposeIntermediateTensorInfo(l),p}const zz={kernelName:ie,backendName:"webgl",kernelFunc:Lz},Bz="return (x >= 0.0) ? x : (exp(x) - 1.0);",qz="\n  vec4 result;\n\n  result.r = (x.r >= 0.0) ? x.r : (exp(x.r) - 1.0);\n  result.g = (x.g >= 0.0) ? x.g : (exp(x.g) - 1.0);\n  result.b = (x.b >= 0.0) ? x.b : (exp(x.b) - 1.0);\n  result.a = (x.a >= 0.0) ? x.a : (exp(x.a) - 1.0);\n\n  return result;\n",Vz=fP({opSnippet:Bz,packedOpSnippet:qz}),Wz={kernelName:ue,backendName:"webgl",kernelFunc:Vz},jz="return (b >= 1.0) ? a : a * (b + 1.0);",Uz="\n  vec4 bGTEZero = vec4(greaterThanEqual(b, vec4(0.)));\n  return (bGTEZero * a) + ((vec4(1.0) - bGTEZero) * (a * (b + vec4(1.0))));\n",Gz=t=>{const{inputs:e,backend:n}=t,{dy:s,y:i}=e,r=at().getBool("WEBGL_PACK_BINARY_OPERATIONS")?new ZM(Uz,s.shape,i.shape):new QM(jz,s.shape,i.shape);return n.runWebGLProgram(r,[s,i],s.dtype)},Hz={kernelName:ce,backendName:"webgl",kernelFunc:Gz},Kz="\n  return vec4(equal(a, b));\n",Xz="return float(a == b);",Qz=mP({opSnippet:Xz,packedOpSnippet:Kz,dtype:"bool"}),Yz={kernelName:he,backendName:"webgl",kernelFunc:Qz},Zz=`\n  // Error function is calculated approximately with elementary function.\n  // See "Handbook of Mathematical Functions with Formulas,\n  // Graphs, and Mathematical Tables", Abramowitz and Stegun.\n  float p = ${Ip};\n  float a1 = ${Cp};\n  float a2 = ${Ap};\n  float a3 = ${Np};\n  float a4 = ${Ep};\n  float a5 = ${Op};\n\n  float sign = sign(x);\n  x = abs(x);\n  float t = 1.0 / (1.0 + p * x);\n  return sign * (1.0 - (((((a5*t + a4)*t) + a3)*t + a2)*t + a1)*t*exp(-x*x));\n`,Jz=fP({opSnippet:Zz}),tB={kernelName:le,backendName:"webgl",kernelFunc:Jz},eB="return exp(x);",nB=fP({opSnippet:eB,packedOpSnippet:eB,cpuKernelImpl:LD}),sB={kernelName:pe,backendName:"webgl",kernelFunc:nB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iB(t){const{inputs:e,attrs:n,backend:s}=t,{dim:i}=n,{input:r}=e,o=r.shape.length,a=r.shape.slice();let u=i;return i<0&&(v(-(o+1)<=i,(()=>`Axis must be in the interval [${-(o+1)}, ${o}]`)),u=o+i+1),a.splice(u,0,1),SP({inputs:{x:r},backend:s,attrs:{shape:a}})}const rB={kernelName:de,backendName:"webgl",kernelFunc:iB},oB="return exp(x) - 1.0;",aB=fP({opSnippet:oB,packedOpSnippet:oB,cpuKernelImpl:zD}),uB={kernelName:fe,backendName:"webgl",kernelFunc:aB};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class cB{constructor(t,e,n){this.variableNames=["real","imag"];const s=e[1];this.outputShape=e;const i=n?`2.0 * ${Math.PI}`:`-2.0 * ${Math.PI}`,r=n?`${s}.0`:"1.0";let o;if("real"===t)o="return real * expR - imag * expI;";else{if("imag"!==t)throw new Error(`FFT component must be either "real" or "imag", got ${t}.`);o="return real * expI + imag * expR;"}this.userCode=`\n      const float exponentMultiplier = ${i};\n\n      float unaryOpComplex(float real, float expR, float imag, float expI) {\n        ${o}\n      }\n\n      float mulMatDFT(int batch, int index) {\n        float indexRatio = float(index) / float(${s});\n        float exponentMultiplierTimesIndexRatio =\n            exponentMultiplier * indexRatio;\n\n        float result = 0.0;\n\n        for (int i = 0; i < ${s}; i++) {\n          // x = (-2|2 * PI / N) * index * i;\n          float x = exponentMultiplierTimesIndexRatio * float(i);\n          float expR = cos(x);\n          float expI = sin(x);\n          float real = getReal(batch, i);\n          float imag = getImag(batch, i);\n\n          result +=\n              unaryOpComplex(real, expR, imag, expI) / ${r};\n        }\n\n        return result;\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        setOutput(mulMatDFT(coords[0], coords[1]));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function lB(t,e,n){const s=n.texData.get(t.dataId),i=k(t.shape),r=t.shape[t.shape.length-1],o=i/r,a=SP({inputs:{x:t},backend:n,attrs:{shape:[o,r]}}),u=a.shape,c=new cB("real",u,e),l=new cB("imag",u,e),h=[{dataId:s.complexTensorInfos.real.dataId,dtype:s.complexTensorInfos.real.dtype,shape:u},{dataId:s.complexTensorInfos.imag.dataId,dtype:s.complexTensorInfos.imag.dtype,shape:u}],p=n.runWebGLProgram(c,h,"float32"),d=n.runWebGLProgram(l,h,"float32"),f=eP({inputs:{real:p,imag:d},backend:n});n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d);const m=SP({inputs:{x:f},backend:n,attrs:{shape:t.shape}});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(f),m}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function hB(t){const{inputs:e,backend:n}=t,{input:s}=e;return lB(s,!1,n)}const pB={kernelName:me,backendName:"webgl",kernelFunc:hB};
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class dB{constructor(t,e){this.outputShape=[],this.variableNames=["x"],this.outputShape=t,this.userCode="\n      uniform float value;\n      void main() {\n        // Input can be obtained from uniform value.\n        setOutput(value);\n      }\n    "}getCustomSetupFunc(t){return(e,n)=>{null==this.valueLoc&&(this.valueLoc=e.getUniformLocationNoThrow(n,"value")),e.gl.uniform1f(this.valueLoc,t)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fB(t){const{backend:e,attrs:n}=t,{shape:s,value:i}=n;let{dtype:r}=n;if(r=r||W(i),"string"===r){const t=R(r,k(s));return t.fill(i),e.makeTensorInfo(s,r,t)}{const t=new dB(s,i),n=t.getCustomSetupFunc(i);return e.runWebGLProgram(t,[],r,n)}}const mB={kernelName:ge,backendName:"webgl",kernelFunc:fB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class gB{constructor(t){this.variableNames=["Image"],this.outputShape=[];const e=t[2];this.outputShape=t,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n\n          int coordX = ${e} - x;\n          float outputValue;\n          if(coordX >= 0 && coordX < ${e}) {\n            outputValue = getImage(coords[0], coords[1], coordX, coords[3]);\n          } else {\n            outputValue = getImage(coords[0], coords[1], coords[2], coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const yB={kernelName:ye,backendName:"webgl",kernelFunc:({inputs:t,backend:e})=>{const{image:n}=t,s=e,i=new gB(n.shape),r=s.runWebGLProgram(i,[n],n.dtype);return r}},bB="return floor(x);",vB=fP({opSnippet:bB,packedOpSnippet:bB,cpuKernelImpl:BD}),wB={kernelName:be,backendName:"webgl",kernelFunc:vB},xB="\n  float s = sign(a) * sign(b);\n  int ia = round(a);\n  int ib = round(b);\n  if (ib != 0) {\n    // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n    return float(idiv(ia, ib, s));\n  } else {\n    return NAN;\n  }\n",_B="\n  ivec4 ia = round(a);\n  ivec4 ib = round(b);\n  bvec4 cond = notEqual(ib, ivec4(0));\n  ivec4 result = ivec4(0);\n  vec4 s = sign(a) * sign(b);\n\n  // Windows (D3D) wants guaranteed non-zero int division at compile-time.\n  if (cond[0]) {\n    result[0] = idiv(ia[0], ib[0], s[0]);\n  }\n  if (cond[1]) {\n    result[1] = idiv(ia[1], ib[1], s[1]);\n  }\n  if (cond[2]) {\n    result[2] = idiv(ia[2], ib[2], s[2]);\n  }\n  if (cond[3]) {\n    result[3] = idiv(ia[3], ib[3], s[3]);\n  }\n  return vec4(result);\n",kB=mP({opSnippet:xB,packedOpSnippet:_B,dtype:"int32"}),SB={kernelName:ve,backendName:"webgl",kernelFunc:kB};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class TB{constructor(t){this.variableNames=["A"];const e=iR(),[n,s]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n        vec2 uv = (vec2(texC, texR) + halfCR) / vec2(${s}.0, ${n}.0);\n\n        vec4 values = ${e.texture2D}(A, uv);\n        float value;\n        if (depth == 0) {\n          value = values.r;\n        } else if (depth == 1) {\n          value = values.g;\n        } else if (depth == 2) {\n          value = values.b;\n        } else if (depth == 3) {\n          value = values.a;\n        }\n\n        setOutput(floor(value * 255.0 + 0.5));\n      }\n    `}}
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class IB{constructor(t){this.variableNames=["A"],this.packedInputs=!1,this.packedOutput=!0;const e=iR(),[n,s]=t;this.outputShape=t,this.userCode=`\n      void main() {\n        ivec3 coords = getOutputCoords();\n        int texR = coords[0];\n        int texC = coords[1];\n        int depth = coords[2];\n\n        vec4 result = vec4(0.);\n\n        for(int row=0; row<=1; row++) {\n          for(int col=0; col<=1; col++) {\n            texC = coords[1] + row;\n            depth = coords[2] + col;\n\n            vec2 uv = (vec2(texC, texR) + halfCR) /\n                       vec2(${s}.0, ${n}.0);\n            vec4 values = ${e.texture2D}(A, uv);\n            float value;\n            if (depth == 0) {\n              value = values.r;\n            } else if (depth == 1) {\n              value = values.g;\n            } else if (depth == 2) {\n              value = values.b;\n            } else if (depth == 3) {\n              value = values.a;\n            }\n\n            result[row * 2 + col] = floor(value * 255.0 + 0.5);\n          }\n        }\n\n        ${e.output} = result;\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const CB={kernelName:is,backendName:"webgl",kernelFunc:NB};let AB;function NB(t){const{inputs:e,backend:n,attrs:s}=t;let{pixels:i}=e;const{numChannels:r}=s,o="undefined"!==typeof HTMLVideoElement&&i instanceof HTMLVideoElement,a="undefined"!==typeof HTMLImageElement&&i instanceof HTMLImageElement,u="undefined"!==typeof ImageBitmap&&i instanceof ImageBitmap,[c,l]=o?[i.videoWidth,i.videoHeight]:[i.width,i.height],h=[l,c],p=[l,c,r];(a||o||u)&&(null==AB&&(AB=document.createElement("canvas").getContext("2d")),AB.canvas.width=c,AB.canvas.height=l,AB.drawImage(i,0,0,c,l),i=AB.canvas);const d=n.makeTensorInfo(h,"int32");n.texData.get(d.dataId).usage=t$.PIXELS,n.gpgpu.uploadPixelDataToTexture(n.getTexture(d.dataId),i);const f=at().getBool("WEBGL_PACK")?new IB(p):new TB(p),m=n.runWebGLProgram(f,[d],"int32");return n.disposeData(d.dataId),m}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function EB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:u,pad:c,dataFormat:l,dilations:h,dimRoundingMode:p,activation:d,leakyreluAlpha:f}=s,m=jo(l),g=Oo(i.shape,r.shape,u,h,c,p,!1,m);let y;const b=[];if(1!==g.filterHeight||1!==g.filterWidth||1!==g.dilationHeight||1!==g.dilationWidth||1!==g.strideHeight||1!==g.strideWidth||"SAME"!==g.padInfo.type&&"VALID"!==g.padInfo.type)if(at().getBool("WEBGL_CONV_IM2COL")&&1===i.shape[0])y=VL({x:i,filter:r,convInfo:g,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:f});else{const t=null!=o,e=null!=a,s="leakyrelu"===d,u=d?gP(d,!1):null,c=new LL(g,t,u,e,s),l=[i,r];if(o&&l.push(o),a&&l.push(a),s){const t=n.makeTensorInfo([],"float32",Os(f,"float32"));l.push(t),b.push(t)}y=n.runWebGLProgram(c,l,"float32")}else y=qL({x:i,filter:r,convInfo:g,backend:n,bias:o,activation:d,preluActivationWeights:a,leakyreluAlpha:f});const v=SP({inputs:{x:y},backend:n,attrs:{shape:g.outShape}});return b.push(y),b.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}const OB={kernelName:as,backendName:"webgl",kernelFunc:EB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $B(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,filter:r,bias:o,preluActivationWeights:a}=e,{strides:u,pad:c,dilations:l,dimRoundingMode:h,activation:p,leakyreluAlpha:d}=s,f=[];let m=l;null==m&&(m=[1,1]),v(Wo(u,m),(()=>`Error in depthwiseConv2d: Either strides or dilations must be 1. Got strides ${u} and dilations '${m}'`));const g=Oo(i.shape,r.shape,u,m,c,h,!0),y=at().getBool("WEBGL_PACK_DEPTHWISECONV")&&g.strideWidth<=2&&g.outChannels/g.inChannels===1,b=p?gP(p,y):null,w=[i,r],x=null!=o,_=null!=a,k="leakyrelu"===p;if(x&&w.push(o),_&&w.push(a),k){const t=n.makeTensorInfo([],"float32",Os(d,"float32"));w.push(t),f.push(t)}let S;S=y?new Tz(g,x,b,_,k):new Sz(g,x,b,_,k);const T=n.runWebGLProgram(S,w,"float32");return f.forEach((t=>n.disposeIntermediateTensorInfo(t))),T}const RB={kernelName:us,backendName:"webgl",kernelFunc:$B};class DB{constructor(t,e,n){this.sliceDim=t,this.strides=e,this.variableNames=["x","indices"],this.outputShape=n;const s=ID(e.length),i=ID(n.length),r=this.sliceDim>1?"strides[j]":"strides";this.userCode=`\n        ${s} strides = ${s}(${this.strides});\n         void main() {\n          ${i} coords = getOutputCoords();\n          int flattenIndex = 0;\n          for (int j = 0; j < ${this.sliceDim}; j++) {\n            int index = round(getIndices(coords[0], j));\n            flattenIndex += index * ${r};\n          }\n          setOutput(getX(flattenIndex, coords[1]));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MB(t){const{inputs:e,backend:n}=t,{params:s,indices:i}=e,r=i.shape,o=r[r.length-1],[a,u,c,l]=wp(s,i),h=SP({inputs:{x:i},backend:n,attrs:{shape:[u,o]}}),p=SP({inputs:{x:s},backend:n,attrs:{shape:[k(s.shape)/c,c]}}),d=new DB(o,l,[u,c]),f=n.runWebGLProgram(d,[p,h],p.dtype),m=SP({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(f),m}const PB={kernelName:_e,backendName:"webgl",kernelFunc:MB};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class FB{constructor(t,e){this.variableNames=["A","indices"],this.outputShape=e,this.rank=e.length;const n=ID(this.rank),s=LB(t,2);this.userCode=`\n      void main() {\n        ${n} resRC = getOutputCoords();\n        setOutput(getA(${s}));\n      }\n    `}}function LB(t,e){const n=["resRC.x","resRC.y","resRC.z","resRC.w"],s=[];for(let i=0;i<t.length;i++)2===i?s.push("int(getIndices(resRC.x, resRC.z))"):s.push(`${n[i]}`);return s.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zB(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,indices:r}=e,{axis:o,batchDims:a}=s,u=E(o,i.shape)[0],c=Up(i,r,u,a),l=k(r.shape),h=[],p=SP({inputs:{x:i},backend:n,attrs:{shape:[c.batchSize,c.outerSize,c.dimSize,c.sliceSize]}}),d=SP({inputs:{x:r},backend:n,attrs:{shape:[c.batchSize,l/c.batchSize]}});h.push(p),h.push(d);const f=[c.batchSize,c.outerSize,l/c.batchSize,c.sliceSize];if(n.shouldExecuteOnCPU([i,r])||"string"===i.dtype){const t=n.bufferSync(d),e=n.bufferSync(p),s=qD(e,t,f);return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),n.makeTensorInfo(c.outputShape,s.dtype,s.values)}const m=new FB(p.shape,f),g=n.runWebGLProgram(m,[p,d],p.dtype);h.push(g);const y=SP({inputs:{x:g},backend:n,attrs:{shape:c.outputShape}});return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),y}const BB={kernelName:xe,backendName:"webgl",kernelFunc:zB},qB="return float(a > b);",VB="\n  return vec4(greaterThan(a, b));\n",WB=mP({opSnippet:qB,packedOpSnippet:VB,cpuKernelImpl:VD,dtype:"bool"}),jB={kernelName:ke,backendName:"webgl",kernelFunc:WB},UB="return float(a >= b);",GB="\n  return vec4(greaterThanEqual(a, b));\n",HB=mP({opSnippet:UB,packedOpSnippet:GB,dtype:"bool"}),KB={kernelName:Se,backendName:"webgl",kernelFunc:HB};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function XB(t){const{inputs:e,backend:n}=t,{input:s}=e;return lB(s,!0,n)}const QB={kernelName:Ie,backendName:"webgl",kernelFunc:XB},YB="return float(!isnan(x) && !isinf(x));",ZB=fP({opSnippet:YB,dtype:"bool"}),JB={kernelName:Ae,backendName:"webgl",kernelFunc:ZB},tq="return float(isinf(x));",eq=fP({opSnippet:tq,dtype:"bool"}),nq={kernelName:Ne,backendName:"webgl",kernelFunc:eq},sq="return float(isnan(x));",iq=fP({opSnippet:sq,dtype:"bool"}),rq={kernelName:Ee,backendName:"webgl",kernelFunc:iq},oq="return float(a < b);",aq="\n  return vec4(lessThan(a, b));\n",uq=mP({opSnippet:oq,packedOpSnippet:aq,cpuKernelImpl:WD,dtype:"bool"}),cq={kernelName:$e,backendName:"webgl",kernelFunc:uq},lq="return float(a <= b);",hq="\n  return vec4(lessThanEqual(a, b));\n",pq=mP({opSnippet:lq,packedOpSnippet:hq,dtype:"bool"}),dq={kernelName:Re,backendName:"webgl",kernelFunc:pq};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function fq(t){const{backend:e,attrs:n}=t,{start:s,stop:i,num:r}=n,o=jD(s,i,r);return e.makeTensorInfo([o.length],"float32",o)}const mq={kernelName:De,backendName:"webgl",kernelFunc:fq},gq="if (x < 0.0) return NAN;\n  return log(x);",yq="\n  vec4 result = log(x);\n  vec4 isNaN = vec4(lessThan(x, vec4(0.0)));\n  result.r = isNaN.r == 1.0 ? NAN : result.r;\n  result.g = isNaN.g == 1.0 ? NAN : result.g;\n  result.b = isNaN.b == 1.0 ? NAN : result.b;\n  result.a = isNaN.a == 1.0 ? NAN : result.a;\n\n  return result;\n",bq=fP({opSnippet:gq,packedOpSnippet:yq,cpuKernelImpl:UD}),vq={kernelName:Me,backendName:"webgl",kernelFunc:bq},wq="return log(1.0 + x);",xq=fP({opSnippet:wq}),_q={kernelName:Pe,backendName:"webgl",kernelFunc:xq},kq="return float(a >= 1.0 && b >= 1.0);",Sq="\n  return vec4(\n    vec4(greaterThanEqual(a, vec4(1.0))) *\n    vec4(greaterThanEqual(b, vec4(1.0))));\n",Tq=mP({opSnippet:kq,packedOpSnippet:Sq,dtype:"bool"}),Iq={kernelName:Fe,backendName:"webgl",kernelFunc:Tq},Cq="return float(!(x >= 1.0));",Aq=fP({opSnippet:Cq}),Nq={kernelName:Le,backendName:"webgl",kernelFunc:Aq},Eq="return float(a >= 1.0 || b >= 1.0);",Oq="\n  return min(\n    vec4(greaterThanEqual(a, vec4(1.0))) +\n    vec4(greaterThanEqual(b, vec4(1.0))),\n    vec4(1.0));\n",$q=mP({opSnippet:Eq,packedOpSnippet:Oq,dtype:"bool"}),Rq={kernelName:ze,backendName:"webgl",kernelFunc:$q};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Dq{constructor(t,e,n,s,i){this.variableNames=["x"],this.outputShape=[];const r=e,o=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${s}) * sum`;a=.5===i?`inversesqrt(${u})`:1===i?`1.0/(${u})`:`exp(log(${u}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n        int d = coords[3];\n        float x = getX(b, r, c, d);\n        float sum = 0.0;\n        for (int j = -${r}; j <= ${r}; j++) {\n          int idx = d + j;\n          if (idx >= 0 && idx <=  ${o}) {\n            float z = getX(b, r, c, idx);\n            sum += z * z;\n          }\n        }\n        float val = x * ${a};\n        setOutput(val);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Mq{constructor(t,e,n,s,i){this.variableNames=["x"],this.outputShape=[],this.packedInputs=!0,this.packedOutput=!0;const r=e,o=t[3]-1;let a;this.outputShape=t;const u=`float(${n}) + float(${s}) * sum`;a=.5===i?`inversesqrt(${u})`:1===i?`1.0/(${u})`:`exp(log(${u}) * float(-${i}));`,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords.x;\n        int r = coords.y;\n        int c = coords.z;\n        int d = coords.w;\n\n        bool hasNextCol = d < ${this.outputShape[3]};\n        bool hasNextRow = c < ${this.outputShape[2]};\n\n        vec4 sum = vec4(0.);\n        vec4 xFragAtOutputCoords = getX(b, r, c, d);\n\n        vec4 xAtOutputCoords = vec4(\n          getChannel(xFragAtOutputCoords, vec2(c, d)),\n          hasNextCol ?\n            getChannel(xFragAtOutputCoords, vec2(c, d + 1)) : 0.0,\n          hasNextRow ?\n            getChannel(xFragAtOutputCoords , vec2(c + 1, d)) : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getChannel(xFragAtOutputCoords, vec2(c + 1, d + 1)) : 0.0\n        );\n\n        int firstChannel = d - ${r};\n        vec2 cache = vec2(0.);\n        if(firstChannel >= 0){\n          vec4 firstChannelFrag = getX(b, r, c, firstChannel);\n          cache.x = getChannel(firstChannelFrag, vec2(c, firstChannel));\n            if(hasNextRow){\n              cache.y = getChannel(firstChannelFrag, vec2(c + 1, firstChannel));\n            }\n        }\n\n        ivec2 depth = ivec2(d, d + 1);\n        for (int j = - ${r}; j <= ${r}; j++) {\n          ivec2 idx = depth + j;\n          bvec2 aboveLowerBound = greaterThanEqual(idx, ivec2(0));\n          bvec2 belowUpperBound = lessThanEqual(idx, ivec2(${o}));\n\n          bool depthInRange = aboveLowerBound.x && belowUpperBound.x;\n          bool depthPlusOneInRange = aboveLowerBound.y && belowUpperBound.y;\n\n          if(depthInRange || depthPlusOneInRange){\n            vec4 z = vec4(0.);\n            vec4 xFragAtCurrentDepth;\n            z.xz = cache.xy;\n            if(depthPlusOneInRange && hasNextCol){\n              xFragAtCurrentDepth = idx.y != d ?\n                getX(b, r, c, idx.y) : xFragAtOutputCoords;\n              z.y = getChannel(xFragAtCurrentDepth, vec2(c, idx.y));\n              if(hasNextRow){\n                z.w = getChannel(xFragAtCurrentDepth, vec2(c + 1, idx.y));\n              }\n            }\n            cache.xy = z.yw;\n            sum += z * z;\n          }\n        }\n        vec4 result = xAtOutputCoords * ${a};\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const Pq=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{depthRadius:r,bias:o,alpha:a,beta:u}=s,c=at().getBool("WEBGL_PACK_NORMALIZATION")?new Mq(i.shape,r,o,a,u):new Dq(i.shape,r,o,a,u);return n.runWebGLProgram(c,[i],i.dtype)},Fq={kernelName:qe,backendName:"webgl",kernelFunc:Pq};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Lq{constructor(t,e,n,s,i){this.variableNames=["inputImage","outputImage","dy"],this.outputShape=[],this.outputShape=t,this.depth=t[3],this.depthRadius=e,this.bias=n,this.alpha=s,this.beta=i,this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int r = coords[1];\n        int c = coords[2];\n\n        float result = 0.0;\n        for (int d = 0; d < ${this.depth}; ++d) {\n          int depthBegin = int(max(0.0, float(d - ${e})));\n          int depthEnd = int(min(float(${this.depth}),\n              float(d + ${e} + 1)));\n\n          const int MIN_DEPTH_BEGIN = 0;\n          const int MAX_DEPTH_END = ${this.depth};\n\n          float norm = 0.0;\n          for (int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k) {\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd) {\n              norm += getInputImage(b, r, c, k) * getInputImage(b, r, c, k);\n            }\n            else {\n              break;\n            }\n          }\n\n          norm = float(${s}) * norm + float(${n});\n\n          for(int k = MIN_DEPTH_BEGIN; k < MAX_DEPTH_END; ++k){\n            if (k < depthBegin){\n              continue;\n            }\n            else if (k >= depthBegin && k < depthEnd){\n              float dyi = -2.0 * float(${s})\n                * float(${i})\n                * getInputImage(b ,r ,c, k) * getOutputImage(b, r, c, d)\n                / norm;\n              if (k == d) {\n                dyi += pow(norm, -1.0 * ${i});\n              }\n              if (k == coords[3]) {\n                dyi *= getDy(b, r, c, d);\n                result += dyi;\n              }\n            }\n            else {\n              break;\n            }\n          }\n      }\n      setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const zq=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i,y:r,dy:o}=e,{depthRadius:a,bias:u,alpha:c,beta:l}=s,h=new Lq(i.shape,a,u,c,l);return n.runWebGLProgram(h,[i,r,o],i.dtype)},Bq={kernelName:Ve,backendName:"webgl",kernelFunc:zq};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function qq(t,e,n,s){const i=k(e),r=k(t.shape),o=r/i,a=SP({inputs:{x:t},attrs:{shape:[o,i]},backend:s}),u=NP(a,t.dtype,"max",s),c=SP({inputs:{x:u},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(u),c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Vq(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reductionIndices:r,keepDims:o}=s,a=i.shape.length,u=E(r,i.shape);let c=u;const l=Fu(c,a),h=null!=l,p=n.shouldExecuteOnCPU([i]);let d=i;if(h){if(p){const t=n.texData.get(d.dataId),e=t.values,s=new Array(a);for(let n=0;n<s.length;n++)s[n]=i.shape[l[n]];const r=oM(e,i.shape,i.dtype,l,s);d=n.makeTensorInfo(s,i.dtype);const o=n.texData.get(d.dataId);o.values=r}else d=RP(i,l,n);c=zu(c.length,a)}Pu("max",c,a);const[f,m]=Du(d.shape,c);let g,y=f;if(o&&(y=Mu(f,u)),p){const t=n.texData.get(d.dataId),e=t.values,s=GD(e,k(m),y,i.dtype);g=n.makeTensorInfo(y,i.dtype);const r=n.texData.get(g.dataId);r.values=s}else g=qq(d,m,y,n);return h&&n.disposeIntermediateTensorInfo(d),g}const Wq={kernelName:We,backendName:"webgl",kernelFunc:Vq},jq=XM+"\n  return max(a, b);\n",Uq="\n  vec4 result = vec4(max(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+YM+"\n  return result;\n",Gq=mP({opSnippet:jq,packedOpSnippet:Uq,cpuKernelImpl:HD}),Hq={kernelName:je,backendName:"webgl",kernelFunc:Gq};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Kq(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e;nR(i,"maxPool");const{filterSize:r,strides:o,pad:a,dimRoundingMode:u}=s,c=1;v(Wo(o,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${o} and dilations '${c}'`));const l=No(i.shape,r,o,c,a,u);if(1===l.filterWidth&&1===l.filterHeight&&S(l.inShape,l.outShape))return JM({inputs:{x:i},backend:n});const h=new DF(l,"max",!1);return n.runWebGLProgram(h,[i],i.dtype)}const Xq={kernelName:Ue,backendName:"webgl",kernelFunc:Kq};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Qq(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{filterSize:r,strides:o,pad:a,dataFormat:u,dimRoundingMode:c}=s,l=[1,1,1],h=Eo(i.shape,r,o,l,a,c,u),p=new MF(h,"max",!1);return n.runWebGLProgram(p,[i],i.dtype)}const Yq={kernelName:He,backendName:"webgl",kernelFunc:Qq};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Zq{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideHeight,n=t.strideWidth,s=t.dilationHeight,i=t.effectiveFilterHeight,r=t.effectiveFilterWidth,o=i-1-t.padInfo.top,a=r-1-t.padInfo.left,u=i*r-1;this.userCode=`\n      const ivec2 pads = ivec2(${o}, ${a});\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n\n        ivec2 dyRCCorner = coords.yz - pads;\n        int dyRCorner = dyRCCorner.x;\n        int dyCCorner = dyRCCorner.y;\n\n        // Convolve dy(?, ?, d) with pos mask(:, :, d) to get dx(xR, xC, d).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n        for (int wR = 0; wR < ${i};\n          wR += ${s}) {\n          float dyR = float(dyRCorner + wR) / ${e}.0;\n\n          if (dyR < 0.0 || dyR >= ${t.outHeight}.0 || fract(dyR) > 0.0) {\n            continue;\n          }\n          int idyR = int(dyR);\n\n          for (int wC = 0; wC < ${r}; wC++) {\n            float dyC = float(dyCCorner + wC) / ${n}.0;\n\n            if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                fract(dyC) > 0.0) {\n              continue;\n            }\n            int idyC = int(dyC);\n\n            float dyValue = getDy(b, idyR, idyC, d);\n            int maxPosValue = ${u} - int(getMaxPos(b, idyR, idyC, d));\n\n            // Get the current value, check it against the value from the\n            // position matrix.\n            int curPosValue = wR * ${r} + wC;\n            float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n            dotProd += dyValue * mask;\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}class Jq{constructor(t){this.variableNames=["dy","maxPos"],this.outputShape=t.inShape;const e=t.strideDepth,n=t.strideHeight,s=t.strideWidth,i=t.dilationDepth,r=t.dilationHeight,o=t.dilationWidth,a=t.effectiveFilterDepth,u=t.effectiveFilterHeight,c=t.effectiveFilterWidth,l=a-1-t.padInfo.front,h=u-1-t.padInfo.top,p=c-1-t.padInfo.left,d=a*u*c-1;this.userCode=`\n      const ivec3 pads = ivec3(${l}, ${h}, ${p});\n\n      void main() {\n        ivec5 coords = getOutputCoords();\n        int batch = coords.x;\n        int ch = coords.u;\n\n        ivec3 dyCorner = ivec3(coords.y, coords.z, coords.w) - pads;\n        int dyDCorner = dyCorner.x;\n        int dyRCorner = dyCorner.y;\n        int dyCCorner = dyCorner.z;\n\n        // Convolve dy(?, ?, ?, ch) with pos mask(:, :, :, d) to get\n        // dx(xD, xR, xC, ch).\n        // ? = to be determined. : = across all values in that axis.\n        float dotProd = 0.0;\n\n        for (int wD = 0; wD < ${a};\n           wD += ${i}) {\n          float dyD = float(dyDCorner + wD) / ${e}.0;\n\n          if (dyD < 0.0 || dyD >= ${t.outDepth}.0 || fract(dyD) > 0.0) {\n            continue;\n          }\n          int idyD = int(dyD);\n\n          for (int wR = 0; wR < ${u};\n              wR += ${r}) {\n            float dyR = float(dyRCorner + wR) / ${n}.0;\n\n            if (dyR < 0.0 || dyR >= ${t.outHeight}.0 ||\n                fract(dyR) > 0.0) {\n              continue;\n            }\n            int idyR = int(dyR);\n\n            for (int wC = 0; wC < ${c};\n                wC += ${o}) {\n              float dyC = float(dyCCorner + wC) / ${s}.0;\n\n              if (dyC < 0.0 || dyC >= ${t.outWidth}.0 ||\n                  fract(dyC) > 0.0) {\n                continue;\n              }\n              int idyC = int(dyC);\n\n              float dyValue = getDy(batch, idyD, idyR, idyC, ch);\n              int maxPosValue = ${d} -\n                  int(getMaxPos(batch, idyD, idyR, idyC, ch));\n\n              // Get the current value, check it against the value from the\n              // position matrix.\n              int curPosValue =\n                  wD * ${u} * ${c} +\n                  wR * ${c} + wC;\n              float mask = float(maxPosValue == curPosValue ? 1.0 : 0.0);\n\n              dotProd += dyValue * mask;\n            }\n          }\n        }\n        setOutput(dotProd);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function tV(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r}=e,o=r,{filterSize:a,strides:u,pad:c,dimRoundingMode:l}=s,h=[1,1,1],p=Eo(o.shape,a,u,h,c,l),d=new MF(p,"max",!0),f=n.runWebGLProgram(d,[o],o.dtype),m=new Jq(p),g=n.runWebGLProgram(m,[i,f],o.dtype);return n.disposeIntermediateTensorInfo(f),g}const eV={kernelName:Ke,backendName:"webgl",kernelFunc:tV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nV(t){const{inputs:e,backend:n,attrs:s}=t,{dy:i,input:r,output:o}=e,a=r;nR([r,o],"maxPoolGrad");const{filterSize:u,strides:c,pad:l,dimRoundingMode:h}=s,p=No(a.shape,u,c,1,l,h),d=!0,f=new DF(p,"max",d),m=n.runWebGLProgram(f,[a],a.dtype),g=new Zq(p),y=n.runWebGLProgram(g,[i,m],a.dtype);return n.disposeIntermediateTensorInfo(m),y}const sV={kernelName:Ge,backendName:"webgl",kernelFunc:nV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function iV(t,e,n,s){let i=new DF(n,"max",!1);const r=s.runWebGLProgram(i,[t],"float32");i=new DF(n,"max",!0,!0,e);const o=s.runWebGLProgram(i,[t],"float32");return[r,o]}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const rV={kernelName:Xe,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{filterSize:i,strides:r,pad:o,includeBatchInIndex:a}=e,u=n;v(4===s.shape.length,(()=>`Error in maxPool: input must be rank 4 but got rank ${s.shape.length}.`));const c=[1,1];v(Wo(r,c),(()=>`Error in maxPool: Either strides or dilations must be 1. Got strides ${r} and dilations '${c}'`));const l=No(s.shape,i,r,c,o),[h,p]=iV(s,a,l,u);return[h,p]}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function oV(t,e,n,s){const i=k(e),r=k(t.shape),o=r/i,a=SP({inputs:{x:t},attrs:{shape:[o,i]},backend:s}),u=NP(a,"float32","mean",s),c=SP({inputs:{x:u},attrs:{shape:n},backend:s});return s.disposeIntermediateTensorInfo(a),s.disposeIntermediateTensorInfo(u),c}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const aV={kernelName:Qe,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{x:s}=t,{keepDims:i,axis:r}=e,o=n,a=s.shape.length,u=E(r,s.shape);let c=u;const l=Fu(c,a),h=null!=l,p=o.shouldExecuteOnCPU([s]),d=[];let f=s;if(h){if(p){const t=o.texData.get(f.dataId),e=t.values,n=new Array(a);for(let o=0;o<n.length;o++)n[o]=s.shape[l[o]];const i=oM(e,s.shape,s.dtype,l,n);f=o.makeTensorInfo(n,s.dtype);const r=o.texData.get(f.dataId);r.values=i}else f=RP(s,l,o);d.push(f),c=zu(c.length,a)}Pu("sum",c,a);const[m,g]=Du(f.shape,c);let y=m;i&&(y=Mu(m,u));const b=oV(f,g,y,o);for(const v of d)o.disposeIntermediateTensorInfo(v);return b}};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function uV(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,u=E(r,i.shape);let c=u;const l=Fu(c,a);let h=i;null!=l&&(h=FP({inputs:{x:i},backend:n,attrs:{perm:l}}),c=zu(c.length,i.shape.length)),Pu("min",c,a);const[p,d]=Du(h.shape,c),f=k(d),m=SP({inputs:{x:h},backend:n,attrs:{shape:[-1,f]}}),g=NP(m,m.dtype,"min",n);let y;if(o){const t=Mu(p,u);y=SP({inputs:{x:g},backend:n,attrs:{shape:t}})}else y=SP({inputs:{x:g},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(m),n.disposeIntermediateTensorInfo(g),null!=l&&n.disposeIntermediateTensorInfo(h),y}const cV={kernelName:Ye,backendName:"webgl",kernelFunc:uV},lV=XM+"\n  return min(a, b);\n",hV="\n  vec4 result = vec4(min(a, b));\n  vec4 isNaN = min(vec4(isnan(a)) + vec4(isnan(b)), vec4(1.0));\n  "+YM+"\n  return result;\n",pV=mP({opSnippet:lV,packedOpSnippet:hV,cpuKernelImpl:KD}),dV={kernelName:Ze,backendName:"webgl",kernelFunc:pV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class fV{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const s=t.length,i=ID(s),r=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s),u="reflect"===n?0:1;this.userCode=1!==s?`\n      ${i} start = ${i}(${r});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        for (int i = 0; i < ${s}; i++) {\n          if (outC[i] < start[i]) {\n            outC[i] = start[i] * 2 - outC[i] - ${u};\n          } else if(outC[i] >= end[i]) {\n            outC[i] = (end[i] - 1) * 2 - outC[i] + ${u};\n          }\n        }\n        ${i} coords = outC - start;\n        setOutput(getX(${a}));\n      }\n    `:`\n        int start = ${r};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start) {\n            outC = start * 2 - outC - ${u};\n          } else if(outC >= end) {\n            outC = (end - 1) * 2 - outC + ${u};\n          }\n          setOutput(getX(outC - start));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class mV{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const s=t.length,i=ID(s),r=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=cM("rc",s),u=cM("source",s),c=`${a[s-1]} < ${this.outputShape[s-1]}`,l=1===s?"source":`vec2(${u.slice(-2).join()})`,h="reflect"===n?0:1;let p="";if(1===s){const t=`\n        ${i} source = rc;\n        if (source < start) {\n          source = start * 2 - source - ${h};\n        } else if (source >= end) {\n          source = (end - 1) * 2 - source + ${h};\n        }\n        source -= start;\n      `;p=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${l});\n        ${a[s-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${l});\n        }\n      `}else{const t=`\n        ${i} source = rc;\n        ${i} lt = ${i}(lessThan(source, start));\n        ${i} gte = ${i}(greaterThanEqual(source, end));\n        ${i} orig = 1 - (lt + gte);\n        source = orig * source +\n                lt * (start * 2 - source - ${h}) +\n                gte * ((end - 1) * 2 - source + ${h});\n        source -= start;\n      `;p=`\n        ${i} rc = outputLoc;\n        ${t}\n        result[0] = getChannel(getX(${u.join()}), ${l});\n        ${a[s-1]} += 1;\n        if(${c}) {\n          ${t}\n          result[1] = getChannel(getX(${u.join()}), ${l});\n        }\n        rc = outputLoc;\n        ${a[s-2]} += 1;\n        if(${a[s-2]} < ${this.outputShape[s-2]}) {\n          ${t}\n          result[2] = getChannel(getX(${u.join()}), ${l});\n          ${a[s-1]} += 1;\n          if(${c}) {\n            ${t}\n            result[3] = getChannel(getX(${u.join()}), ${l});\n          }\n        }\n      `}this.userCode=`\n      const ${i} start = ${i}(${r});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${p}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const gV=({inputs:t,backend:e,attrs:n})=>{const{x:s}=t,{paddings:i,mode:r}=n,o=at().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new mV(s.shape,i,r):new fV(s.shape,i,r),a=e.runWebGLProgram(o,[s],s.dtype);return a},yV={kernelName:Je,backendName:"webgl",kernelFunc:gV},bV="if (b == 0.0) return NAN;\n  return mod(a, b);",vV="\n  vec4 result = mod(a, b);\n  vec4 isNaN = vec4(equal(b, vec4(0.0)));\n  "+YM+"\n  return result;\n",wV=mP({opSnippet:bV,packedOpSnippet:vV}),xV={kernelName:tn,backendName:"webgl",kernelFunc:wV};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class _V{constructor(t,e,n){this.variableNames=["probs"],this.outputShape=[t,n],this.userCode=`\n      uniform float seed;\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n\n        float r = random(seed);\n        float cdf = 0.0;\n\n        for (int i = 0; i < ${e-1}; i++) {\n          cdf += getProbs(batch, i);\n\n          if (r < cdf) {\n            setOutput(float(i));\n            return;\n          }\n        }\n\n        // If no other event happened, last event happened.\n        setOutput(float(${e-1}));\n      }\n    `}getCustomSetupFunc(t){return(e,n)=>{null==this.seedLoc&&(this.seedLoc=e.getUniformLocation(n,"seed")),e.gl.uniform1f(this.seedLoc,t)}}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const kV="\nif (a == b) {\n  return 1.0;\n};\nreturn a / b;",SV="\n  // vec4 one = vec4(equal(a, b));\n  // return one + (vec4(1.0) - one) * a / b;\n  vec4 result = a / b;\n  if(a.x == b.x) {\n    result.x = 1.;\n  }\n  if(a.y == b.y) {\n    result.y = 1.;\n  }\n  if(a.z == b.z) {\n    result.z = 1.;\n  }\n  if(a.w == b.w) {\n    result.w = 1.;\n  }\n\n  return result;\n",TV=mP({opSnippet:kV,packedOpSnippet:SV,checkOutOfBounds:!0}),IV={kernelName:ae,backendName:"webgl",kernelFunc:TV},CV="return a - b;",AV=mP({opSnippet:CV,packedOpSnippet:CV,supportsComplex:!0,cpuKernelImpl:sM}),NV={kernelName:Un,backendName:"webgl",kernelFunc:AV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function EV(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{dim:r}=s,o=E([r],i.shape),a=Vq({inputs:{x:i},backend:n,attrs:{reductionIndices:o,keepDims:!1}}),u=Mu(a.shape,o),c=SP({inputs:{x:a},backend:n,attrs:{shape:u}}),l=AV({inputs:{a:i,b:c},backend:n}),h=nB({inputs:{x:l},backend:n}),p=MP({inputs:{x:h},backend:n,attrs:{axis:o,keepDims:!1}}),d=SP({inputs:{x:p},backend:n,attrs:{shape:u}}),f=TV({inputs:{a:h,b:d},backend:n});return n.disposeIntermediateTensorInfo(a),n.disposeIntermediateTensorInfo(c),n.disposeIntermediateTensorInfo(l),n.disposeIntermediateTensorInfo(h),n.disposeIntermediateTensorInfo(p),n.disposeIntermediateTensorInfo(d),f}const OV={kernelName:Vn,backendName:"webgl",kernelFunc:EV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $V(t){const{inputs:e,backend:n,attrs:s}=t,{logits:i}=e,{numSamples:r,seed:o,normalized:a}=s,u=a?i:EV({inputs:{logits:i},backend:n,attrs:{dim:i.shape.length-1}}),c=u.shape[0],l=u.shape[1],h=new _V(c,l,r),p=h.getCustomSetupFunc(o),d=n.runWebGLProgram(h,[u],"int32",p);return a||n.disposeIntermediateTensorInfo(u),d}const RV={kernelName:en,backendName:"webgl",kernelFunc:$V},DV="return -x;";function MV(t){const{inputs:e,backend:n}=t,{x:s}=e;if(n.shouldExecuteOnCPU([s])){const t=n.texData.get(s.dataId),[e,i]=QD(t.values,s.shape,s.dtype);return n.makeTensorInfo(i,s.dtype,e)}let i;return i=at().getBool("WEBGL_PACK_UNARY_OPERATIONS")?new FM(s.shape,DV):new TM(s.shape,DV),n.runWebGLProgram(i,[s],s.dtype)}const PV={kernelName:sn,backendName:"webgl",kernelFunc:MV},FV=rh;function LV(t){$p("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u}=s,c=n.readSync(i.dataId),l=n.readSync(r.dataId),{selectedIndices:h}=FV(c,l,o,a,u);return n.makeTensorInfo([h.length],"int32",new Int32Array(h))}const zV={kernelName:on,backendName:"webgl",kernelFunc:LV},BV=oh;function qV(t){$p("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,padToMaxOutputSize:c}=s,l=n.readSync(i.dataId),h=n.readSync(r.dataId),{selectedIndices:p,validOutputs:d}=BV(l,h,o,a,u,c);return[n.makeTensorInfo([p.length],"int32",new Int32Array(p)),n.makeTensorInfo([],"int32",new Int32Array([d]))]}const VV={kernelName:an,backendName:"webgl",kernelFunc:qV},WV=ah;function jV(t){$p("tf.nonMaxSuppression() in webgl locks the UI thread. Call tf.nonMaxSuppressionAsync() instead");const{inputs:e,backend:n,attrs:s}=t,{boxes:i,scores:r}=e,{maxOutputSize:o,iouThreshold:a,scoreThreshold:u,softNmsSigma:c}=s,l=n.readSync(i.dataId),h=n.readSync(r.dataId),p=o,d=a,f=u,m=c,{selectedIndices:g,selectedScores:y}=WV(l,h,p,d,f,m);return[n.makeTensorInfo([g.length],"int32",new Int32Array(g)),n.makeTensorInfo([y.length],"float32",new Float32Array(y))]}const UV={kernelName:un,backendName:"webgl",kernelFunc:jV};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class GV{constructor(t,e,n,s){this.variableNames=["indices"],this.outputShape=[t,e],this.userCode=`\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int index = round(getIndices(coords.x));\n        setOutput(mix(float(${s}), float(${n}),\n                      float(index == coords.y)));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const HV=t=>{const{inputs:e,backend:n,attrs:s}=t,{indices:i}=e,{depth:r,onValue:o,offValue:a}=s,u=k(i.shape),c=new GV(u,r,o,a),l=SP({inputs:{x:i},backend:n,attrs:{shape:[u]}}),h=n.runWebGLProgram(c,[l],i.dtype);n.disposeIntermediateTensorInfo(l);const p=[...i.shape,r],d=SP({inputs:{x:h},backend:n,attrs:{shape:p}});return n.disposeIntermediateTensorInfo(h),d},KV={kernelName:ln,backendName:"webgl",kernelFunc:HV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function XV(t){const{inputs:e,backend:n}=t,{x:s}=e;if("complex64"===s.dtype){const t=pL({inputs:{input:s},backend:n}),e=XV({inputs:{x:t},backend:n}),i=$L({inputs:{input:s},backend:n}),r=XV({inputs:{x:i},backend:n}),o=eP({inputs:{real:e,imag:r},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),o}return fB({attrs:{shape:s.shape,dtype:s.dtype,value:"string"===s.dtype?"":0},backend:n})}const QV={kernelName:ns,backendName:"webgl",kernelFunc:XV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function YV(t){const{inputs:e,backend:n}=t,{x:s}=e;if("string"===s.dtype)throw new Error("onesLike is not supported under string dtype");if("complex64"===s.dtype){const t=pL({inputs:{input:s},backend:n}),e=YV({inputs:{x:t},backend:n}),i=$L({inputs:{input:s},backend:n}),r=XV({inputs:{x:i},backend:n}),o=eP({inputs:{real:e,imag:r},backend:n});return n.disposeIntermediateTensorInfo(t),n.disposeIntermediateTensorInfo(e),n.disposeIntermediateTensorInfo(i),n.disposeIntermediateTensorInfo(r),o}return fB({attrs:{shape:s.shape,dtype:s.dtype,value:1},backend:n})}const ZV={kernelName:cn,backendName:"webgl",kernelFunc:YV};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function JV(t){const{inputs:e,backend:n,attrs:s}=t,{axis:i}=s;if(1===e.length)return iB({inputs:{input:e[0]},backend:n,attrs:{dim:i}});const r=e[0].shape,o=e[0].dtype;e.forEach((t=>{w(r,t.shape,"All tensors passed to stack must have matching shapes"),v(o===t.dtype,(()=>"All tensors passed to stack must have matching dtypes"))}));const a=[],u=e.map((t=>{const e=iB({inputs:{input:t},backend:n,attrs:{dim:i}});return a.push(e),e})),c=PL({inputs:u,backend:n,attrs:{axis:i}});return a.forEach((t=>n.disposeIntermediateTensorInfo(t))),c}const tW={kernelName:hn,backendName:"webgl",kernelFunc:JV};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class eW{constructor(t,e,n){this.variableNames=["x"],this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const s=t.length,i=ID(s),r=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=["coords[0]","coords[1]","coords[2]","coords[3]"].slice(0,s);this.userCode=1!==s?`\n      ${i} start = ${i}(${r});\n      ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outC = getOutputCoords();\n        if (any(lessThan(outC, start)) || any(greaterThanEqual(outC, end))) {\n          setOutput(float(${n}));\n        } else {\n          ${i} coords = outC - start;\n          setOutput(getX(${a}));\n        }\n      }\n    `:`\n        int start = ${r};\n        int end = ${o};\n\n        void main() {\n          int outC = getOutputCoords();\n          if (outC < start || outC >= end) {\n            setOutput(float(${n}));\n          } else {\n            setOutput(getX(outC - start));\n          }\n        }\n      `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class nW{constructor(t,e,n){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=e.map(((e,n)=>e[0]+t[n]+e[1]));const s=t.length,i=ID(s),r=e.map((t=>t[0])).join(","),o=e.map(((e,n)=>e[0]+t[n])).join(","),a=cM("rc",s),u=cM("source",s),c=`${a[s-1]} < ${this.outputShape[s-1]}`,l=1===s?"source":`vec2(${u.slice(-2).join()})`,h=[`${i} rc = outputLoc;`,`${a[s-1]} += 1;\n       if(${c}) {\n      `,1===s?"":`}\n       rc = outputLoc;\n       ${a[s-2]} += 1;\n       if(${a[s-2]} < ${this.outputShape[s-2]}) {`,1===s?"":`  ${a[s-1]} += 1;\n         if(${c}) {`],p=1===s?"rc < start || rc >= end":"any(lessThan(rc, start)) || any(greaterThanEqual(rc, end))";let d="";for(let f=0,m=1===s?2:4;f<m;f++)d+=`\n        ${h[f]}\n        if (${p}) {\n          result[${f}] = float(${n});\n        } else {\n          ${i} source = rc - start;\n          result[${f}] = getChannel(getX(${u.join()}), ${l});\n        }\n      `;d+=1===s?"} ":"}}",this.userCode=`\n      const ${i} start = ${i}(${r});\n      const ${i} end = ${i}(${o});\n\n      void main() {\n        ${i} outputLoc = getOutputCoords();\n        vec4 result = vec4(0.);\n        ${d}\n        setOutput(result);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const sW=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{paddings:r,constantValue:o}=s,a=at().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new nW(i.shape,r,o):new eW(i.shape,r,o);return n.runWebGLProgram(a,[i],i.dtype)},iW={kernelName:pn,backendName:"webgl",kernelFunc:sW},rW="\n  if(a < 0.0 && floor(b) < b){\n    return NAN;\n  }\n  if (b == 0.0) {\n    return 1.0;\n  }\n  return (round(mod(b, 2.0)) != 1) ?\n      pow(abs(a), b) : sign(a) * pow(abs(a), b);\n",oW="\n  // isModRound1 has 1 for components with round(mod(b, 2.0)) == 1, 0 otherwise.\n  vec4 isModRound1 = vec4(equal(round(mod(b, 2.0)), ivec4(1)));\n  vec4 multiplier = sign(a) * isModRound1 + (vec4(1.0) - isModRound1);\n  vec4 result = multiplier * pow(abs(a), b);\n\n  // Ensure that a^0 = 1, including 0^0 = 1 as this correspond to TF and JS\n  bvec4 isExpZero = equal(b, vec4(0.0));\n  result.r = isExpZero.r ? 1.0 : result.r;\n  result.g = isExpZero.g ? 1.0 : result.g;\n  result.b = isExpZero.b ? 1.0 : result.b;\n  result.a = isExpZero.a ? 1.0 : result.a;\n\n  vec4 isNaN = vec4(lessThan(a, vec4(0.0))) * vec4(lessThan(floor(b), b));\n  "+YM+"\n  return result;\n",aW=mP({opSnippet:rW,packedOpSnippet:oW}),uW={kernelName:dn,backendName:"webgl",kernelFunc:aW};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function cW(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{axis:r,keepDims:o}=s,a=i.shape.length,u=[],c=E(r,i.shape);let l=c;const h=Fu(l,a);let p,d=i;if(null!=h&&(d=FP({inputs:{x:i},backend:n,attrs:{perm:h}}),l=zu(l.length,a),u.push(d)),Pu("prod",l,a),n.shouldExecuteOnCPU([d])){const t=n.texData.get(d.dataId).values,{outVals:e,outShape:s,outDtype:i}=YD(d.shape,d.dtype,t,l);p=n.makeTensorInfo(s,i,e)}else{const[t,e]=Du(d.shape,l),s=k(e),r=SP({inputs:{x:d},backend:n,attrs:{shape:[-1,s]}}),o=Js(i.dtype),a=NP(r,o,"prod",n);p=SP({inputs:{x:a},backend:n,attrs:{shape:t}}),u.push(r),u.push(a)}if(o){u.push(p);const t=Mu(p.shape,c);p=SP({inputs:{x:p},backend:n,attrs:{shape:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),p}const lW={kernelName:mn,backendName:"webgl",kernelFunc:cW},hW=t=>{const{backend:e,attrs:n}=t,{start:s,stop:i,step:r,dtype:o}=n,a=ZD(s,i,r,o);return e.makeTensorInfo([a.length],o,a)},pW={kernelName:gn,backendName:"webgl",kernelFunc:hW},dW="return 1.0 / x;",fW=fP({opSnippet:dW}),mW={kernelName:bn,backendName:"webgl",kernelFunc:fW},gW=IM+"\n  return (x < 0.0) ? 0.0 : x;\n",yW="\n  vec4 result = x * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",bW=fP({opSnippet:gW,packedOpSnippet:yW}),vW={kernelName:vn,backendName:"webgl",kernelFunc:bW},wW=IM+"\n  return (x < 0.0) ? 0.0 : min(6.0, x);\n",xW="\n  vec4 result = min(x, vec4(6.)) * vec4(greaterThanEqual(x, vec4(0.0)));\n  bvec4 isNaN = isnan(x);\n\n  result.r = isNaN.r ? x.r : result.r;\n  result.g = isNaN.g ? x.g : result.g;\n  result.b = isNaN.b ? x.b : result.b;\n  result.a = isNaN.a ? x.a : result.a;\n\n  return result;\n",_W=fP({opSnippet:wW,packedOpSnippet:xW}),kW={kernelName:Tn,backendName:"webgl",kernelFunc:_W};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class SW{constructor(t,e,n,s,i){this.variableNames=["A"],this.outputShape=[];const[r,o,a,u]=t;this.outputShape=[r,e,n,u];const c=[s&&e>1?o-1:o,s&&n>1?a-1:a],l=[s&&e>1?e-1:e,s&&n>1?n-1:n];let h;h=i?"(vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC - vec2(0.5)":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec2 sourceFloorRC = ivec2(max(sourceFracIndexRC, vec2(0.0)));\n        ivec2 sourceCeilRC = ivec2(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        float topLeft = getA(b, sourceFloorRC.x, sourceFloorRC.y, d);\n        float bottomLeft = getA(b, sourceCeilRC.x, sourceFloorRC.y, d);\n        float topRight = getA(b, sourceFloorRC.x, sourceCeilRC.y, d);\n        float bottomRight = getA(b, sourceCeilRC.x, sourceCeilRC.y, d);\n\n        vec2 fracRC = sourceFracIndexRC - vec2(sourceFloorRC);\n\n        float top = topLeft + (topRight - topLeft) * fracRC.y;\n        float bottom = bottomLeft + (bottomRight - bottomLeft) * fracRC.y;\n        float newValue = top + (bottom - top) * fracRC.x;\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class TW{constructor(t,e,n,s,i){this.variableNames=["A"],this.packedInputs=!0,this.packedOutput=!0,this.outputShape=[];const[r,o,a,u]=t;this.outputShape=[r,e,n,u];const c=[s&&e>1?o-1:o,s&&n>1?a-1:a],l=[s&&e>1?e-1:e,s&&n>1?n-1:n];let h;h=i?"(vec3(yRC) + vec3(0.5)) * effectiveInputOverOutputRatioRC - vec3(0.5)":"vec3(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec3 effectiveInputOverOutputRatioRC = vec3(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]},\n          ${c[1]/l[1]});\n      const vec3 inputShapeRC = vec3(${o}.0, ${a}.0,\n                                     ${a}.0);\n\n      float getAValue(int b, int r, int c, int d) {\n        return getChannel(getA(b, r, c, d), vec2(c, d));\n      }\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        // Calculate values for next column in yRC.z.\n        ivec3 yRC = coords.yzz + ivec3(0, 0, 1);\n\n        // Fractional source index.\n        vec3 sourceFracIndexRC = ${h};\n\n        // Compute the four integer indices.\n        ivec3 sourceFloorRC = ivec3(max(sourceFracIndexRC, vec3(0.0)));\n        ivec3 sourceCeilRC = ivec3(\n          min(inputShapeRC - 1.0, ceil(sourceFracIndexRC)));\n\n        // Should we calculate next column and row elements in 2x2 packed cell.\n        bool hasNextCol = d < ${u-1};\n        bool hasNextRow = coords.z < ${n-1};\n\n        // In parallel, construct four corners for all four components in\n        // packed 2x2 cell.\n        vec4 topLeft = vec4(\n          getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 bottomLeft = vec4(\n          getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceFloorRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceFloorRC.z, d + 1) : 0.0);\n\n        vec4 topRight = vec4(\n          getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceFloorRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceFloorRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec4 bottomRight = vec4(\n          getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d),\n          hasNextCol ? getAValue(b, sourceCeilRC.x, sourceCeilRC.y, d + 1)\n                     : 0.0,\n          hasNextRow ? getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d)\n                     : 0.0,\n          (hasNextRow && hasNextCol) ?\n            getAValue(b, sourceCeilRC.x, sourceCeilRC.z, d + 1) : 0.0);\n\n        vec3 fracRC = sourceFracIndexRC - vec3(sourceFloorRC);\n\n        vec4 top = mix(topLeft, topRight, fracRC.yyzz);\n        vec4 bottom = mix(bottomLeft, bottomRight, fracRC.yyzz);\n        vec4 newValue = mix(top, bottom, fracRC.x);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function IW(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s,[u,c]=a,l=at().getBool("WEBGL_PACK_IMAGE_OPERATIONS")?new TW(i.shape,u,c,r,o):new SW(i.shape,u,c,r,o);return n.runWebGLProgram(l,[i],"float32")}const CW={kernelName:kn,backendName:"webgl",kernelFunc:IW};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class AW{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,s,i]=e,[,r,o]=t,a=[n&&r>1?s-1:s,n&&o>1?i-1:i],u=[n&&r>1?r-1:r,n&&o>1?o-1:o],c=a[0]/u[0],l=a[1]/u[1],h=1/c,p=1/l,d=2*Math.ceil(h)+2,f=2*Math.ceil(p)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${l});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${p});\n\n        const int winHeight = int(${d});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(startRLerp - float(winHeight / 2));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(startCLerp - float(winWidth / 2));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${r}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float dxR = float(dyR) * heightScale;\n            int topDxRIndex = int(floor(dxR));\n            int bottomDxRIndex = int(min(ceil(dxR), ${s-1}.0));\n            float dxRLerp = dxR - float(topDxRIndex);\n            float inverseDxRLerp = 1.0 - dxRLerp;\n\n            float dxC = float(dyC) * widthScale;\n            int leftDxCIndex = int(floor(dxC));\n            int rightDxCIndex = int(min(ceil(dxC), ${i-1}.0));\n            float dxCLerp = dxC - float(leftDxCIndex);\n            float inverseDxCLerp = 1.0 - dxCLerp;\n\n            if (r == topDxRIndex && c == leftDxCIndex) {\n              // topLeft\n              accumulator +=\n                getDy(b, dyR, dyC, d) * inverseDxRLerp * inverseDxCLerp;\n            }\n\n            if (r == topDxRIndex && c == rightDxCIndex) {\n              // topRight\n              accumulator += getDy(b, dyR, dyC, d) * inverseDxRLerp * dxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == leftDxCIndex) {\n              // bottomLeft\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * inverseDxCLerp;\n            }\n\n            if (r == bottomDxRIndex && c == rightDxCIndex) {\n              // bottomRight\n              accumulator += getDy(b, dyR, dyC, d) * dxRLerp * dxCLerp;\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function NW(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s,a=new AW(r.shape,i.shape,o);return n.runWebGLProgram(a,[r],r.dtype)}const EW={kernelName:Sn,backendName:"webgl",kernelFunc:NW};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class OW{constructor(t,e,n,s,i){this.variableNames=["A"],this.outputShape=[];const[r,o,a,u]=t;this.outputShape=[r,e,n,u];const c=[s&&e>1?o-1:o,s&&n>1?a-1:a],l=[s&&e>1?e-1:e,s&&n>1?n-1:n],h=s?"0.5":"0.0";let p;p=i?"max((vec2(yRC) + vec2(0.5)) * effectiveInputOverOutputRatioRC, vec2(0.0))":"vec2(yRC) * effectiveInputOverOutputRatioRC",this.userCode=`\n      const vec2 effectiveInputOverOutputRatioRC = vec2(\n          ${c[0]/l[0]},\n          ${c[1]/l[1]});\n      const vec2 inputShapeRC = vec2(${o}.0, ${a}.0);\n\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        ivec2 yRC = coords.yz;\n\n        // Fractional source index.\n        vec2 sourceFracIndexRC = ${p};\n\n        // Compute the coordinators of nearest neighbor point.\n        ivec2 sourceNearestRC = ivec2(\n          min(inputShapeRC - 1.0, floor(sourceFracIndexRC + ${h})));\n        float newValue = getA(b, sourceNearestRC.x, sourceNearestRC.y, d);\n\n        setOutput(newValue);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function $W(t){const{inputs:e,backend:n,attrs:s}=t,{images:i}=e,{alignCorners:r,halfPixelCenters:o,size:a}=s,[u,c]=a,l=new OW(i.shape,u,c,r,o);return n.runWebGLProgram(l,[i],i.dtype)}const RW={kernelName:xn,backendName:"webgl",kernelFunc:$W};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class DW{constructor(t,e,n){this.variableNames=["dy"],this.outputShape=[],this.outputShape=e;const[,s,i]=e,[,r,o]=t,a=[n&&r>1?s-1:s,n&&o>1?i-1:i],u=[n&&r>1?r-1:r,n&&o>1?o-1:o],c=a[0]/u[0],l=a[1]/u[1],h=1/c,p=1/l,d=2*Math.ceil(h)+2,f=2*Math.ceil(p)+2;this.userCode=`\n      void main() {\n        ivec4 coords = getOutputCoords();\n        int b = coords[0];\n        int d = coords[3];\n        int r = coords[1];\n        int c = coords[2];\n\n        float accumulator = 0.0;\n\n        const float heightScale = float(${c});\n        const float widthScale = float(${l});\n\n        const float invHeightScale = float(${h});\n        const float invWidthScale = float(${p});\n\n        const int winHeight = int(${d});\n        const int winWidth = int(${f});\n\n        // Compute bounds for where in dy we will look\n        float startRLerp = floor(float(r) * invHeightScale);\n        int startDyR = int(floor(startRLerp - float(winHeight / 2)));\n\n        float startCLerp = floor(float(c) * invWidthScale);\n        int startDyC = int(floor(startCLerp - float(winWidth / 2)));\n\n        // Loop over dy\n        for (int dyROffset = 0; dyROffset < winHeight; dyROffset++) {\n          int dyR = dyROffset + startDyR;\n\n          // Guard against the window exceeding the bounds of dy\n          if (dyR < 0 || dyR >= ${r}) {\n            continue;\n          }\n\n          for (int dyCOffset = 0; dyCOffset < winWidth; dyCOffset++) {\n            int dyC = dyCOffset + startDyC;\n\n            // Guard against the window exceeding the bounds of dy\n            if (dyC < 0 || dyC >= ${o}) {\n              continue;\n            }\n\n            float sourceFracRow =\n              float(${a[0]}) *\n                (float(dyR) / float(${u[0]}));\n\n            float sourceFracCol =\n                float(${a[1]}) *\n                  (float(dyC) / float(${u[1]}));\n\n            int sourceNearestRow = int(min(\n                float(int(${s}) - 1),\n                ${n} ? float(round(sourceFracRow)) :\n                                  float(floor(sourceFracRow))));\n\n            int sourceNearestCol = int(min(\n                float(int(${i}) - 1),\n                ${n} ? float(round(sourceFracCol)) :\n                                  float(floor(sourceFracCol))));\n\n            if (r == sourceNearestRow && c == sourceNearestCol) {\n              accumulator += getDy(b, dyR, dyC, d);\n            }\n          }\n        }\n        // End loop over dy\n\n        setOutput(accumulator);\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function MW(t){const{inputs:e,backend:n,attrs:s}=t,{images:i,dy:r}=e,{alignCorners:o}=s,a=new DW(r.shape,i.shape,o);return n.runWebGLProgram(a,[r],r.dtype)}const PW={kernelName:_n,backendName:"webgl",kernelFunc:MW};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class FW{constructor(t,e){this.variableNames=["x"];const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);if(this.outputShape=t,1===n)return void(this.userCode=`\n        void main() {\n          int coord = getOutputCoords();\n          setOutput(getX(${t[0]} - coord - 1));\n        }\n      `);const s=n=>-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - coords[${n}] - 1`:`coords[${n}]`,i=t.map(((t,e)=>s(e))).join(","),r=ID(n);this.userCode=`\n      void main() {\n        ${r} coords = getOutputCoords();\n        setOutput(getX(${i}));\n      }\n    `}}
/**
 * @license
 * Copyright 2019 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class LW{constructor(t,e){this.variableNames=["x"],this.packedInputs=!0,this.packedOutput=!0;const n=t.length;if(n>4)throw new Error(`WebGL backend: Reverse of rank-${n} tensor is not yet supported`);this.outputShape=t;const s=cM("rc",n),i=`${s[n-1]} + 1 < ${this.outputShape[n-1]}`,r=`${s[n-2]} + 1 < ${this.outputShape[n-2]}`,o=ID(n);function a(t){return h(t)}function u(t){return t[n-1]="("+t[n-1]+" + 1)",h(t)}function c(t){return t[n-2]="("+t[n-2]+" + 1)",h(t)}function l(t){return t[n-1]="("+t[n-1]+" + 1)",t[n-2]="("+t[n-2]+" + 1)",h(t)}function h(e){const n=t.map(((t,n)=>p(n,e))),s=n.join(","),i=n.slice(-2).join(",");return`getChannel(getX(${s}), vec2(${i}))`}function p(n,s){return-1!==e.indexOf(n)&&1!==t[n]?`${t[n]} - ${s[n]} - 1`:`${s[n]}`}this.userCode=1===n?`\n        void main(){\n          int rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = getChannel(getX(${t[0]} - rc - 1),\n            ${t[0]} - rc - 1);\n          if(${i}){\n              result.g = getChannel(getX(${t[0]} - (rc  + 1) - 1),\n                ${t[0]} - (rc  + 1) - 1);\n          }\n          setOutput(result);\n        }\n      `:`\n        void main() {\n          ${o} rc = getOutputCoords();\n          vec4 result = vec4(0.);\n          result.r = ${a(s.slice())};\n          if(${i}){\n            result.g = ${u(s.slice())};\n          }\n          if(${r}) {\n            result.b = ${c(s.slice())};\n            if(${i}) {\n              result.a = ${l(s.slice())};\n            }\n          }\n          setOutput(result);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function zW(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{dims:r}=s,o=i.shape.length,a=E(r,i.shape);if(0===o)return JM({inputs:{x:i},backend:n});const u=at().getBool("WEBGL_PACK_ARRAY_OPERATIONS")?new LW(i.shape,a):new FW(i.shape,a);return n.runWebGLProgram(u,[i],i.dtype)}const BW={kernelName:In,backendName:"webgl",kernelFunc:zW};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class qW{constructor(t,e,n,s){this.variableNames=["Image"],this.outputShape=[];const i=t[1],r=t[2],o=Math.sin(e).toFixed(3),a=Math.cos(e).toFixed(3);this.outputShape=t;const[u,c]=fp(s,i,r),l=u.toFixed(3),h=c.toFixed(3);let p="";p="number"===typeof n?`float outputValue = ${n.toFixed(2)};`:`\n        vec3 fill = vec3(${n.join(",")});\n        float outputValue = fill[coords[3]];`,this.userCode=`\n        void main() {\n          ivec4 coords = getOutputCoords();\n          int x = coords[2];\n          int y = coords[1];\n          float coordXFloat = (float(x) - ${l}) * ${a} - (float(y) - ${h}) * ${o};\n          float coordYFloat = (float(x) - ${l}) * ${o} + (float(y) - ${h}) * ${a};\n          int coordX = int(round(coordXFloat + ${l}));\n          int coordY = int(round(coordYFloat + ${h}));\n          ${p}\n          if(coordX >= 0 && coordX < ${r} && coordY >= 0 && coordY < ${i}) {\n            outputValue = getImage(coords[0], coordY, coordX, coords[3]);\n          }\n          setOutput(outputValue);\n        }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
const VW={kernelName:rs,backendName:"webgl",kernelFunc:({inputs:t,attrs:e,backend:n})=>{const{image:s}=t,{radians:i,fillValue:r,center:o}=e,a=n,u=new qW(s.shape,i,r,o),c=a.runWebGLProgram(u,[s],s.dtype);return c}},WW="\n  // OpenGL ES does not support round function.\n  // The algorithm is based on banker's rounding.\n  float base = floor(x);\n  if ((x - base) < 0.5) {\n    return floor(x);\n  } else if ((x - base) > 0.5) {\n    return ceil(x);\n  } else {\n    if (mod(base, 2.0) == 0.0) {\n      return base;\n    } else {\n      return base + 1.0;\n    }\n  }\n",jW=fP({opSnippet:WW}),UW={kernelName:Cn,backendName:"webgl",kernelFunc:jW},GW="return inversesqrt(x);",HW=fP({opSnippet:GW,cpuKernelImpl:JD}),KW={kernelName:An,backendName:"webgl",kernelFunc:HW};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class XW{constructor(t,e,n,s,i,r,o=!0){this.variableNames=["updates","indices","defaultValue"],this.outputShape=r;const a=ID(i.length),u=ID(r.length);let c="";1===n?c="i":2===n&&(c="i, j");const l=`getIndices(${c})`;let h="";1===s?h="i":2===s&&(h="i, coords[1]");const p=`getUpdates(${h})`,d=e>1?"strides[j]":"strides";this.userCode=`\n        ${a} strides = ${a}(${i});\n\n        void main() {\n          ${u} coords = getOutputCoords();\n          float sum = 0.0;\n          bool found = false;\n          for (int i = 0; i < ${t}; i++) {\n            int flattenedIndex = 0;\n            for (int j = 0; j < ${e}; j++) {\n              int index = round(${l});\n              flattenedIndex += index * ${d};\n            }\n            if (flattenedIndex == coords[0]) {\n              sum += ${p};\n              found = true;\n            }\n          }\n          setOutput(mix(getDefaultValue(), sum, float(found)));\n        }\n      `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function QW(t){const{inputs:e,backend:n,attrs:s}=t,{indices:i,updates:r}=e,{shape:o}=s,{sliceRank:a,numUpdates:u,sliceSize:c,strides:l,outputSize:h}=kp(r,i,o),p=[h/c,c];if(0===h)return n.makeTensorInfo(o,i.dtype);const d=SP({inputs:{x:i},backend:n,attrs:{shape:[u,a]}}),f=SP({inputs:{x:r},backend:n,attrs:{shape:[u,c]}}),m=n.makeTensorInfo([],"float32",new Float32Array([0])),g=new XW(u,a,d.shape.length,f.shape.length,l,p),y=n.runWebGLProgram(g,[f,d,m],f.dtype),b=SP({inputs:{x:y},backend:n,attrs:{shape:o}});return n.disposeIntermediateTensorInfo(d),n.disposeIntermediateTensorInfo(f),n.disposeIntermediateTensorInfo(y),n.disposeIntermediateTensorInfo(m),b}const YW={kernelName:Nn,backendName:"webgl",kernelFunc:QW};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class ZW{constructor(t,e,n){let s,i;if(this.variableNames=["c","a","b"],this.outputShape=e,n>4)throw Error(`Where for rank ${n} is not yet supported`);if(1===n)i="resRC",s="resRC";else{const n=["resRC.x","resRC.y","resRC.z","resRC.w"],r=[],o=[];for(let s=0;s<e.length;s++)o.push(`${n[s]}`),s<t&&r.push(`${n[s]}`);s=r.join(),i=o.join()}const r=ID(n);this.userCode=`\n      void main() {\n        ${r} resRC = getOutputCoords();\n        float cVal = getC(${s});\n        if (cVal >= 1.0) {\n          setOutput(getA(${i}));\n        } else {\n          setOutput(getB(${i}));\n        }\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function JW(t){const{inputs:e,backend:n}=t,{condition:s,t:i,e:r}=e,o=new ZW(s.shape.length,i.shape,i.shape.length);return n.runWebGLProgram(o,[s,i,r],Zs(i.dtype,r.dtype))}const tj={kernelName:En,backendName:"webgl",kernelFunc:JW},ej=`\n  // Stable and Attracting Fixed Point (0, 1) for Normalized Weights.\n  // see: https://arxiv.org/abs/1706.02515\n  float scaleAlpha = ${Sp};\n  float scale = ${Tp};\n  return (x >= 0.0) ? scale * x : scaleAlpha * (exp(x) - 1.0);\n`,nj=fP({opSnippet:ej}),sj={kernelName:On,backendName:"webgl",kernelFunc:nj},ij="return 1.0 / (1.0 + exp(-1.0 * x));",rj=fP({opSnippet:ij}),oj={kernelName:Pn,backendName:"webgl",kernelFunc:rj},aj="\n  if (isnan(x)) { return 0.0; }\n  return sign(x);\n",uj=fP({opSnippet:aj}),cj={kernelName:Mn,backendName:"webgl",kernelFunc:uj},lj=hP+"\n  return sin(x);\n",hj=fP({opSnippet:lj}),pj={kernelName:Rn,backendName:"webgl",kernelFunc:hj},dj="\n  float e2x = exp(x);\n  return (e2x - 1.0 / e2x) / 2.0;\n",fj=fP({opSnippet:dj}),mj={kernelName:Dn,backendName:"webgl",kernelFunc:fj},gj="\n  float epsilon = 1.1920928955078125e-7;\n  float threshold = log(epsilon) + 2.0;\n\n  bool too_large = x > -threshold;\n  bool too_small = x < threshold;\n\n  float result;\n  float exp_x = exp(x);\n\n  if (too_large){\n    result = x;\n  }\n  else if (too_small){\n    result = exp_x;\n  }\n  else{\n    result = log(exp_x + 1.0);\n  }\n  return result;\n",yj=fP({opSnippet:gj}),bj={kernelName:Fn,backendName:"webgl",kernelFunc:yj},vj=t=>{const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{blockShape:r,paddings:o}=s;v(i.shape.length<=4,(()=>"spaceToBatchND for rank > 4 with a WebGL backend not implemented yet"));const a=r.reduce(((t,e)=>t*e)),u=[[0,0]];u.push(...o);for(let y=1+r.length;y<i.shape.length;++y)u.push([0,0]);const c=[],l=sW({inputs:{x:i},backend:n,attrs:{paddings:u,constantValue:0}}),h=mp(l.shape,r,a,!1),p=gp(h.length,r.length,!1),d=yp(l.shape,r,a,!1),f=SP({inputs:{x:l},backend:n,attrs:{shape:h}}),m=FP({inputs:{x:f},backend:n,attrs:{perm:p}}),g=SP({inputs:{x:m},backend:n,attrs:{shape:d}});return c.push(l),c.push(f),c.push(m),c.forEach((t=>n.disposeIntermediateTensorInfo(t))),g},wj={kernelName:Bn,backendName:"webgl",kernelFunc:vj};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function xj(t){const{inputs:e,backend:n,attrs:s}=t,{sparseIndices:i,sparseValues:r,defaultValue:o}=e,{outputShape:a}=s,{sliceRank:u,numUpdates:c,strides:l,outputSize:h}=kp(r,i,a),p=!1,d=new XW(c,u,i.shape.length,r.shape.length,l,[h,1],p),f=n.runWebGLProgram(d,[r,i,o],r.dtype),m=SP({inputs:{x:f},backend:n,attrs:{shape:a}});return n.disposeIntermediateTensorInfo(f),m}const _j={kernelName:Gn,backendName:"webgl",kernelFunc:xj};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function kj(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{numOrSizeSplits:r,axis:o}=s,a=E(o,i.shape)[0],u=Vp(i,r,a),c=i.shape.length,l=new Array(c).fill(0),h=i.shape.slice();return u.map((t=>{const e=[...h];e[a]=t;const s=sL({inputs:{x:i},backend:n,attrs:{begin:l,size:e}});return l[a]+=t,s}))}const Sj={kernelName:qn,backendName:"webgl",kernelFunc:kj},Tj="return sqrt(x);",Ij=fP({opSnippet:Tj}),Cj={kernelName:Ln,backendName:"webgl",kernelFunc:Ij},Aj="return x * x;",Nj=fP({opSnippet:Aj}),Ej={kernelName:jn,backendName:"webgl",kernelFunc:Nj},Oj="return (a - b) * (a - b);",$j=mP({opSnippet:Oj,packedOpSnippet:Oj}),Rj={kernelName:Wn,backendName:"webgl",kernelFunc:$j};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Dj({inputs:t,attrs:e,backend:n}){const{x:s}=t,i=IM+`\n    return x > 0.0 ? 1.0 : float(${e.alpha});\n  `,r=new TM(s.shape,i);return n.runWebGLProgram(r,[s],s.dtype)}const Mj={kernelName:ss,backendName:"webgl",kernelFunc:Dj};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Pj{constructor(t,e,n){this.variableNames=["x"],this.outputShape=n;const s=n.length,i=ID(n.length),r=ID(n.length);let o="";if(1===s)o="coords * strides + begin";else{let t=0;o=n.map(((e,s)=>(t++,1===n.length?`coords * strides[${s}] + begin[${s}]`:`coords[${t-1}] * strides[${s}] + begin[${s}]`))).join(",")}this.userCode=`\n      ${i} begin = ${i}(${t});\n      ${i} strides = ${i}(${e});\n\n      void main() {\n        ${r} coords = getOutputCoords();\n        setOutput(getX(${o}));\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Fj(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{begin:r,end:o,strides:a,beginMask:u,endMask:c,ellipsisMask:l,newAxisMask:h,shrinkAxisMask:p}=s,{nonStrided:d,$begin:f,$strides:m,size:g,newShape:y,outShape:b}=eo(i.shape,r,o,a,u,c,l,h,p),v=SP({inputs:{x:i},backend:n,attrs:{shape:y}});let w;if(d){const t=sL({inputs:{x:v},backend:n,attrs:{begin:f,size:g}});w=SP({inputs:{x:t},backend:n,attrs:{shape:b}}),n.disposeIntermediateTensorInfo(t)}else if(b.some((t=>0===t)))w=n.makeTensorInfo(b,i.dtype,[]);else{const t=n.shouldExecuteOnCPU([v]);if(t){const t=n.texData.get(v.dataId),e=t.values,s=fr(v.shape,v.dtype,e),i=nM(b,s,m,f);w=n.makeTensorInfo(b,v.dtype,i.values)}else{const t=new Pj(f,m,b);w=n.runWebGLProgram(t,[v],v.dtype)}}const x=SP({inputs:{x:w},backend:n,attrs:{shape:b}});return n.disposeIntermediateTensorInfo(v),n.disposeIntermediateTensorInfo(w),x}const Lj={kernelName:Hn,backendName:"webgl",kernelFunc:Fj},zj="return tan(x);",Bj=fP({opSnippet:zj}),qj={kernelName:Kn,backendName:"webgl",kernelFunc:Bj},Vj="\n  float e2x = exp(-2.0 * abs(x));\n  return sign(x) * (1.0 - e2x) / (1.0 + e2x);\n",Wj=fP({opSnippet:Vj}),jj={kernelName:Xn,backendName:"webgl",kernelFunc:Wj};
/**
 * @license
 * Copyright 2017 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class Uj{constructor(t,e){this.variableNames=["A"];const n=new Array(t.length);for(let r=0;r<n.length;r++)n[r]=t[r]*e[r];this.outputShape=n,this.rank=n.length;const s=ID(this.rank),i=Gj(t);this.userCode=`\n      void main() {\n        ${s} resRC = getOutputCoords();\n        setOutput(getA(${i}));\n      }\n    `}}function Gj(t){const e=t.length;if(e>5)throw Error(`Tile for rank ${e} is not yet supported`);if(1===e)return`imod(resRC, ${t[0]})`;const n=["resRC.x","resRC.y","resRC.z","resRC.w","resRC.u"],s=[];for(let i=0;i<t.length;i++)s.push(`imod(${n[i]}, ${t[i]})`);return s.join()}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Hj(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{reps:r}=s;if("string"===i.dtype){const t=n.readSync(i.dataId),e=t.map((t=>Ps(t))),s=fr(i.shape,i.dtype,e),o=iM(s,r);return n.makeTensorInfo(o.shape,o.dtype,o.values)}const o=new Uj(i.shape,r),a=n.runWebGLProgram(o,[i],i.dtype);return a}const Kj={kernelName:Qn,backendName:"webgl",kernelFunc:Hj};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Xj(t){const{inputs:e,backend:n,attrs:s}=t,{x:i}=e,{k:r,sorted:o}=s,a=n.readSync(i.dataId),[u,c]=rM(a,i.shape,i.dtype,r,o);return[n.makeTensorInfo(u.shape,u.dtype,u.values),n.makeTensorInfo(c.shape,c.dtype,c.values)]}const Qj={kernelName:Yn,backendName:"webgl",kernelFunc:Xj};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the License);
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an AS IS BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Yj(t){const{inputs:e,attrs:n,backend:s}=t,{axis:i}=n,{x:r}=e;nR(r,"unique"),console.warn("WARNING: ","UI might be locked temporarily as data is being downloaded");const o=s.readSync(r.dataId),{outputValues:a,outputShape:u,indices:c}=aM(o,i,r.shape,r.dtype);return[s.makeTensorInfo(u,r.dtype,a),s.makeTensorInfo([c.length],"int32",c)]}const Zj={kernelName:Jn,backendName:"webgl",kernelFunc:Yj};
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function Jj(t){const{inputs:e,backend:n,attrs:s}=t,{value:i}=e;let{axis:r}=s;r<0&&(r+=i.shape.length);const o=i,a=o.shape.length,u=i.shape[r],c=new Array(a-1);let l=0;for(let m=0;m<a;m++)m!==r&&(c[l++]=o.shape[m]);const h=[],p=new Array(a).fill(0),d=o.shape.slice();d[r]=1;const f=new Array(u);for(let m=0;m<f.length;m++){p[r]=m;const t=sL({inputs:{x:o},backend:n,attrs:{begin:p,size:d}}),e=SP({inputs:{x:t},backend:n,attrs:{shape:c}});f[m]=e,h.push(t)}return h.forEach((t=>n.disposeIntermediateTensorInfo(t))),f}const tU={kernelName:ts,backendName:"webgl",kernelFunc:Jj};
/**
 * @license
 * Copyright 2018 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
class eU{constructor(t,e){this.variableNames=["x","segmentIds"];const n=t.windowSize,s=t.batchSize,i=t.inSize,r=t.numSegments,o=r*Math.ceil(i/n);this.outputShape=[s,o];const a="0.0",u="sumValue",c=4*Math.floor(n/4),l=n%4,h="\n        sumValue += dot(values, segFilter);\n    ";let p="";i%n>0&&(p=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return initializationValue;\n        }\n      `);let d="";i%n>0&&(d=`\n        if (inIdx < 0 || inIdx >= ${i}) {\n          return -1.0;\n        }\n      `),this.userCode=`\n      const float initializationValue = ${a};\n\n      float getValue(int batch, int inIdx) {\n        ${p}\n        return getX(batch, inIdx);\n      }\n\n      float getSegmentIdAtIndex(int inIdx) {\n        ${d}\n        return getSegmentIds(inIdx);\n      }\n\n      void main() {\n        ivec2 coords = getOutputCoords();\n        int batch = coords[0];\n        int outIdx = coords[1];\n        int inOffset = int(floor(float(outIdx) / float(\n          ${r})) * float(${n}));\n        int currentSeg = int(mod(float(outIdx), float(${r})));\n\n        float sumValue = 0.0;\n\n        for (int i = 0; i < ${c}; i += 4) {\n          int inIdx = inOffset + i;\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            getValue(batch, inIdx + 3)\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 3)) == currentSeg ? 1 : 0\n          );\n\n          ${h}\n        }\n\n        int inIdx = inOffset + ${c};\n        if (${1===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            initializationValue,\n            initializationValue,\n            initializationValue\n          );\n\n          int inIdxSeg = int(getSegmentIdAtIndex(inIdx));\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            0,\n            0,\n            0\n          );\n\n          ${h}\n        } else if (${2===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            initializationValue,\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n              0,\n              0\n          );\n\n          ${h}\n        } else if (${3===l}) {\n          vec4 values = vec4(\n            getValue(batch, inIdx),\n            getValue(batch, inIdx + 1),\n            getValue(batch, inIdx + 2),\n            initializationValue\n          );\n\n          vec4 segFilter = vec4(\n            int(getSegmentIdAtIndex(inIdx)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 1)) == currentSeg ? 1 : 0,\n            int(getSegmentIdAtIndex(inIdx + 2)) == currentSeg ? 1 : 0,\n            0\n          );\n\n          ${h}\n        }\n        setOutput(${u});\n      }\n    `}}
/**
 * @license
 * Copyright 2020 Google LLC. All Rights Reserved.
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * =============================================================================
 */
function nU(t){const{inputs:e,backend:n,attrs:s}=t,{x:i,segmentIds:r}=e,{numSegments:o}=s,a=i.shape.length,u=[];let c=0;const l=Fu([c],a);let h=i;null!=l&&(h=FP({inputs:{x:i},backend:n,attrs:{perm:l}}),u.push(h),c=zu(1,a)[0]);const p=jp(h.shape,c,o),d=k([h.shape[c]]),f=SP({inputs:{x:h},backend:n,attrs:{shape:[-1,d]}});u.push(f);const m=Js(i.dtype),g=(t,e,s,i,r)=>{const o=t.shape[0],a=t.shape[1],c=Wp(a,r),l={windowSize:c,inSize:a,batchSize:o,numSegments:r},h=new eU(l,e),p=n.compileAndRun(h,[t,s],i);if(u.push(p),p.shape[1]===r)return p;const d=hW({backend:n,attrs:{start:0,stop:r,step:1,dtype:"float32"}}),f=Hj({inputs:{x:d},backend:n,attrs:{reps:[a/c]}});u.push(d),u.push(f);const m=g(p,e,f,i,r);return m},y=g(f,"unsortedSegmentSum",r,m,o),b=SP({inputs:{x:y},backend:n,attrs:{shape:p}});let v=b;if(null!=l){u.push(b);const t=Lu(l);v=FP({inputs:{x:v},backend:n,attrs:{perm:t}})}return u.forEach((t=>n.disposeIntermediateTensorInfo(t))),v}const sU={kernelName:es,backendName:"webgl",kernelFunc:nU},iU=[Fq,Bq,VP,UP,KP,YP,tF,iF,oF,uF,mF,yF,wF,kF,EF,IF,RF,zF,FF,WF,UF,HF,YF,oL,uL,yL,wL,SL,AL,nP,FL,QL,ZL,jL,nz,iz,tz,az,lz,dz,bz,wz,kz,Oz,Rz,Cz,Pz,zz,Wz,Hz,Yz,tB,sB,rB,uB,pB,mB,yB,wB,SB,CB,OB,RB,PB,BB,jB,KB,tP,QB,RL,JB,nq,rq,oP,cq,dq,mq,_q,vq,Iq,Nq,Rq,Wq,Yq,Xq,eV,sV,rV,Hq,aV,cV,dV,yV,xV,RV,_P,PV,zV,VV,UV,hL,KV,ZV,tW,iW,uW,lP,lW,pW,dL,IV,mW,kW,vW,TP,CW,EW,RW,PW,BW,VW,UW,KW,YW,tj,sj,oj,cj,pj,mj,iL,OV,bj,wj,_j,Sj,Cj,Ej,Rj,Mj,Lj,NV,PP,qj,jj,Kj,Qj,LP,Zj,tU,sU,QV];for(const _6 of iU)fs(_6);var rU="C C# Db D D# Eb E F F# Gb G G# Ab A A# Bb B".split(" "),oU=function(t){return"string"!==typeof t?rU.slice():rU.filter((function(e){var n=e[1]||" ";return-1!==t.indexOf(n)}))},aU=(oU(" #"),oU(" b"),/^([a-gA-G]?)(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)$/);function uU(t){"string"!==typeof t&&(t="");var e=aU.exec(t);return[e[1].toUpperCase(),e[2].replace(/x/g,"##"),e[3],e[4]]}var cU=Object.freeze({pc:null,name:null,step:null,alt:null,oct:null,octStr:null,chroma:null,midi:null,freq:null}),lU=[0,2,4,5,7,9,11],hU=function(t){var e=uU(t);if(""===e[0]||""!==e[3])return cU;var n=e[0],s=e[1],i=e[2],r={letter:n,acc:s,octStr:i,pc:n+s,name:n+s+i,step:(n.charCodeAt(0)+3)%7,alt:"b"===s[0]?-s.length:s.length,oct:i.length?+i:null,chroma:0,midi:null,freq:null};return r.chroma=(lU[r.step]+r.alt+120)%12,r.midi=null!==r.oct?lU[r.step]+r.alt+12*(r.oct+1):null,r.freq=fU(r.midi),Object.freeze(r)},pU=function(t,e){return void 0===e&&(e={}),function(n){return e[n]||(e[n]=t(n))}},dU=pU(hU),fU=function(t,e){return void 0===e&&(e=440),"number"===typeof t?Math.pow(2,(t-69)/12)*e:null},mU=(Math.log(2),Math.log(440),function(t){return dU(t).chroma});var gU="([-+]?\\d+)(d{1,4}|m|M|P|A{1,4})",yU="(AA|A|P|M|m|d|dd)([-+]?\\d+)",bU=new RegExp("^"+gU+"|"+yU+"$"),vU=[0,2,4,5,7,9,11],wU="PMMPPMM",xU=("1P 2m 2M 3m 3M 4P 5P 6m 6M 7m 7M 8P".split(" "),function(t){var e=bU.exec(""+t);return null===e?null:e[1]?[e[1],e[2]]:[e[4],e[3]]}),_U=Object.freeze({name:null,num:null,q:null,step:null,alt:null,dir:null,type:null,simple:null,semitones:null,chroma:null,oct:null}),kU=function(t,e){return"M"===e&&"M"===t||"P"===e&&"P"===t?0:"m"===e&&"M"===t?-1:/^A+$/.test(e)?e.length:/^d+$/.test(e)?"P"===t?-e.length:-e.length-1:null},SU=function(t){return(Math.abs(t)-1)%7},TU=function(t){var e=xU(t);if(null===e)return _U;var n={num:0,q:"d",name:"",type:"M",step:0,dir:-1,simple:1,alt:0,oct:0,semitones:0,chroma:0,ic:0};return n.num=+e[0],n.q=e[1],n.step=SU(n.num),n.type=wU[n.step],"M"===n.type&&"P"===n.q?_U:(n.name=""+n.num+n.q,n.dir=n.num<0?-1:1,n.simple=8===n.num||-8===n.num?n.num:n.dir*(n.step+1),n.alt=kU(n.type,n.q),n.oct=Math.floor((Math.abs(n.num)-1)/7),n.semitones=n.dir*(vU[n.step]+n.alt+12*n.oct),n.chroma=(n.dir*(vU[n.step]+n.alt)%12+12)%12,Object.freeze(n))},IU={};function CU(t){return"string"!==typeof t?_U:IU[t]||(IU[t]=TU(t))}var AU=function(t){return CU(t).chroma},NU=("P m M m M P d P m M m M".split(" "),[0,2,4,-1,1,3,5]),EU=function(t){return Math.floor(7*t/12)},OU=NU.map(EU),$U=function(t){var e=t.step,n=t.alt,s=t.oct,i=t.dir;void 0===i&&(i=1);var r=NU[e]+7*n;if(null===s)return[i*r];var o=s-OU[e]-4*n;return[i*r,i*o]};var RU=function(t,e){return void 0===e&&(e={}),function(n){return e[n]||(e[n]=t(n))}},DU=function(t){return RU((function(e){var n=t(e);return null===n.name?null:$U(n)}))};DU(dU),DU(CU);var MU=JSON.parse('{"chromatic":["1P 2m 2M 3m 3M 4P 4A 5P 6m 6M 7m 7M"],"lydian":["1P 2M 3M 4A 5P 6M 7M"],"major":["1P 2M 3M 4P 5P 6M 7M",["ionian"]],"mixolydian":["1P 2M 3M 4P 5P 6M 7m",["dominant"]],"dorian":["1P 2M 3m 4P 5P 6M 7m"],"aeolian":["1P 2M 3m 4P 5P 6m 7m",["minor"]],"phrygian":["1P 2m 3m 4P 5P 6m 7m"],"locrian":["1P 2m 3m 4P 5d 6m 7m"],"melodic minor":["1P 2M 3m 4P 5P 6M 7M"],"melodic minor second mode":["1P 2m 3m 4P 5P 6M 7m"],"lydian augmented":["1P 2M 3M 4A 5A 6M 7M"],"lydian dominant":["1P 2M 3M 4A 5P 6M 7m",["lydian b7"]],"melodic minor fifth mode":["1P 2M 3M 4P 5P 6m 7m",["hindu","mixolydian b6M"]],"locrian #2":["1P 2M 3m 4P 5d 6m 7m",["half-diminished"]],"altered":["1P 2m 3m 3M 5d 6m 7m",["super locrian","diminished whole tone","pomeroy"]],"harmonic minor":["1P 2M 3m 4P 5P 6m 7M"],"phrygian dominant":["1P 2m 3M 4P 5P 6m 7m",["spanish","phrygian major"]],"half-whole diminished":["1P 2m 3m 3M 4A 5P 6M 7m",["dominant diminished"]],"diminished":["1P 2M 3m 4P 5d 6m 6M 7M",["whole-half diminished"]],"major pentatonic":["1P 2M 3M 5P 6M",["pentatonic"]],"lydian pentatonic":["1P 3M 4A 5P 7M",["chinese"]],"mixolydian pentatonic":["1P 3M 4P 5P 7m",["indian"]],"locrian pentatonic":["1P 3m 4P 5d 7m",["minor seven flat five pentatonic"]],"minor pentatonic":["1P 3m 4P 5P 7m"],"minor six pentatonic":["1P 3m 4P 5P 6M"],"minor hexatonic":["1P 2M 3m 4P 5P 7M"],"flat three pentatonic":["1P 2M 3m 5P 6M",["kumoi"]],"flat six pentatonic":["1P 2M 3M 5P 6m"],"major flat two pentatonic":["1P 2m 3M 5P 6M"],"whole tone pentatonic":["1P 3M 5d 6m 7m"],"ionian pentatonic":["1P 3M 4P 5P 7M"],"lydian #5P pentatonic":["1P 3M 4A 5A 7M"],"lydian dominant pentatonic":["1P 3M 4A 5P 7m"],"minor #7M pentatonic":["1P 3m 4P 5P 7M"],"super locrian pentatonic":["1P 3m 4d 5d 7m"],"in-sen":["1P 2m 4P 5P 7m"],"iwato":["1P 2m 4P 5d 7m"],"hirajoshi":["1P 2M 3m 5P 6m"],"kumoijoshi":["1P 2m 4P 5P 6m"],"pelog":["1P 2m 3m 5P 6m"],"vietnamese 1":["1P 3m 4P 5P 6m"],"vietnamese 2":["1P 3m 4P 5P 7m"],"prometheus":["1P 2M 3M 4A 6M 7m"],"prometheus neopolitan":["1P 2m 3M 4A 6M 7m"],"ritusen":["1P 2M 4P 5P 6M"],"scriabin":["1P 2m 3M 5P 6M"],"piongio":["1P 2M 4P 5P 6M 7m"],"major blues":["1P 2M 3m 3M 5P 6M"],"minor blues":["1P 3m 4P 5d 5P 7m",["blues"]],"composite blues":["1P 2M 3m 3M 4P 5d 5P 6M 7m"],"augmented":["1P 2A 3M 5P 5A 7M"],"augmented heptatonic":["1P 2A 3M 4P 5P 5A 7M"],"dorian #4":["1P 2M 3m 4A 5P 6M 7m"],"lydian diminished":["1P 2M 3m 4A 5P 6M 7M"],"whole tone":["1P 2M 3M 4A 5A 7m"],"leading whole tone":["1P 2M 3M 4A 5A 7m 7M"],"lydian minor":["1P 2M 3M 4A 5P 6m 7m"],"locrian major":["1P 2M 3M 4P 5d 6m 7m",["arabian"]],"neopolitan":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan minor":["1P 2m 3m 4P 5P 6m 7M"],"neopolitan major":["1P 2m 3m 4P 5P 6M 7M",["dorian b2"]],"neopolitan major pentatonic":["1P 3M 4P 5d 7m"],"romanian minor":["1P 2M 3m 5d 5P 6M 7m"],"double harmonic lydian":["1P 2m 3M 4A 5P 6m 7M"],"harmonic major":["1P 2M 3M 4P 5P 6m 7M"],"double harmonic major":["1P 2m 3M 4P 5P 6m 7M",["gypsy"]],"egyptian":["1P 2M 4P 5P 7m"],"hungarian minor":["1P 2M 3m 4A 5P 6m 7M"],"hungarian major":["1P 2A 3M 4A 5P 6M 7m"],"oriental":["1P 2m 3M 4P 5d 6M 7m"],"spanish heptatonic":["1P 2m 3m 3M 4P 5P 6m 7m"],"flamenco":["1P 2m 3m 3M 4A 5P 7m"],"balinese":["1P 2m 3m 4P 5P 6m 7M"],"todi raga":["1P 2m 3m 4A 5P 6m 7M"],"malkos raga":["1P 3m 4P 6m 7m"],"kafi raga":["1P 3m 3M 4P 5P 6M 7m 7M"],"purvi raga":["1P 2m 3M 4P 4A 5P 6m 7M"],"persian":["1P 2m 3M 4P 5d 6m 7M"],"bebop":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop dominant":["1P 2M 3M 4P 5P 6M 7m 7M"],"bebop minor":["1P 2M 3m 3M 4P 5P 6M 7m"],"bebop major":["1P 2M 3M 4P 5P 5A 6M 7M"],"bebop locrian":["1P 2m 3m 4P 5d 5P 6m 7m"],"minor bebop":["1P 2M 3m 4P 5P 6m 7m 7M"],"mystery #1":["1P 2m 3M 5d 6m 7m"],"enigmatic":["1P 2m 3M 5d 6m 7m 7M"],"minor six diminished":["1P 2M 3m 4P 5P 6m 6M 7M"],"ionian augmented":["1P 2M 3M 4P 5A 6M 7M"],"lydian #9":["1P 2m 3M 4A 5P 6M 7M"],"ichikosucho":["1P 2M 3M 4P 5d 5P 6M 7M"],"six tone symmetric":["1P 2m 3M 4P 5A 6M"]}'),PU=JSON.parse('{"4":["1P 4P 7m 10m",["quartal"]],"5":["1P 5P"],"7":["1P 3M 5P 7m",["Dominant","Dom"]],"9":["1P 3M 5P 7m 9M",["79"]],"11":["1P 5P 7m 9M 11P"],"13":["1P 3M 5P 7m 9M 13M",["13_"]],"64":["5P 8P 10M"],"M":["1P 3M 5P",["Major",""]],"M#5":["1P 3M 5A",["augmented","maj#5","Maj#5","+","aug"]],"M#5add9":["1P 3M 5A 9M",["+add9"]],"M13":["1P 3M 5P 7M 9M 13M",["maj13","Maj13"]],"M13#11":["1P 3M 5P 7M 9M 11A 13M",["maj13#11","Maj13#11","M13+4","M13#4"]],"M6":["1P 3M 5P 13M",["6"]],"M6#11":["1P 3M 5P 6M 11A",["M6b5","6#11","6b5"]],"M69":["1P 3M 5P 6M 9M",["69"]],"M69#11":["1P 3M 5P 6M 9M 11A"],"M7#11":["1P 3M 5P 7M 11A",["maj7#11","Maj7#11","M7+4","M7#4"]],"M7#5":["1P 3M 5A 7M",["maj7#5","Maj7#5","maj9#5","M7+"]],"M7#5sus4":["1P 4P 5A 7M"],"M7#9#11":["1P 3M 5P 7M 9A 11A"],"M7add13":["1P 3M 5P 6M 7M 9M"],"M7b5":["1P 3M 5d 7M"],"M7b6":["1P 3M 6m 7M"],"M7b9":["1P 3M 5P 7M 9m"],"M7sus4":["1P 4P 5P 7M"],"M9":["1P 3M 5P 7M 9M",["maj9","Maj9"]],"M9#11":["1P 3M 5P 7M 9M 11A",["maj9#11","Maj9#11","M9+4","M9#4"]],"M9#5":["1P 3M 5A 7M 9M",["Maj9#5"]],"M9#5sus4":["1P 4P 5A 7M 9M"],"M9b5":["1P 3M 5d 7M 9M"],"M9sus4":["1P 4P 5P 7M 9M"],"Madd9":["1P 3M 5P 9M",["2","add9","add2"]],"Maj7":["1P 3M 5P 7M",["maj7","M7"]],"Mb5":["1P 3M 5d"],"Mb6":["1P 3M 13m"],"Msus2":["1P 2M 5P",["add9no3","sus2"]],"Msus4":["1P 4P 5P",["sus","sus4"]],"Maddb9":["1P 3M 5P 9m"],"11b9":["1P 5P 7m 9m 11P"],"13#11":["1P 3M 5P 7m 9M 11A 13M",["13+4","13#4"]],"13#9":["1P 3M 5P 7m 9A 13M",["13#9_"]],"13#9#11":["1P 3M 5P 7m 9A 11A 13M"],"13b5":["1P 3M 5d 6M 7m 9M"],"13b9":["1P 3M 5P 7m 9m 13M"],"13b9#11":["1P 3M 5P 7m 9m 11A 13M"],"13no5":["1P 3M 7m 9M 13M"],"13sus4":["1P 4P 5P 7m 9M 13M",["13sus"]],"69#11":["1P 3M 5P 6M 9M 11A"],"7#11":["1P 3M 5P 7m 11A",["7+4","7#4","7#11_","7#4_"]],"7#11b13":["1P 3M 5P 7m 11A 13m",["7b5b13"]],"7#5":["1P 3M 5A 7m",["+7","7aug","aug7"]],"7#5#9":["1P 3M 5A 7m 9A",["7alt","7#5#9_","7#9b13_"]],"7#5b9":["1P 3M 5A 7m 9m"],"7#5b9#11":["1P 3M 5A 7m 9m 11A"],"7#5sus4":["1P 4P 5A 7m"],"7#9":["1P 3M 5P 7m 9A",["7#9_"]],"7#9#11":["1P 3M 5P 7m 9A 11A",["7b5#9"]],"7#9#11b13":["1P 3M 5P 7m 9A 11A 13m"],"7#9b13":["1P 3M 5P 7m 9A 13m"],"7add6":["1P 3M 5P 7m 13M",["67","7add13"]],"7b13":["1P 3M 7m 13m"],"7b5":["1P 3M 5d 7m"],"7b6":["1P 3M 5P 6m 7m"],"7b9":["1P 3M 5P 7m 9m"],"7b9#11":["1P 3M 5P 7m 9m 11A",["7b5b9"]],"7b9#9":["1P 3M 5P 7m 9m 9A"],"7b9b13":["1P 3M 5P 7m 9m 13m"],"7b9b13#11":["1P 3M 5P 7m 9m 11A 13m",["7b9#11b13","7b5b9b13"]],"7no5":["1P 3M 7m"],"7sus4":["1P 4P 5P 7m",["7sus"]],"7sus4b9":["1P 4P 5P 7m 9m",["susb9","7susb9","7b9sus","7b9sus4","phryg"]],"7sus4b9b13":["1P 4P 5P 7m 9m 13m",["7b9b13sus4"]],"9#11":["1P 3M 5P 7m 9M 11A",["9+4","9#4","9#11_","9#4_"]],"9#11b13":["1P 3M 5P 7m 9M 11A 13m",["9b5b13"]],"9#5":["1P 3M 5A 7m 9M",["9+"]],"9#5#11":["1P 3M 5A 7m 9M 11A"],"9b13":["1P 3M 7m 9M 13m"],"9b5":["1P 3M 5d 7m 9M"],"9no5":["1P 3M 7m 9M"],"9sus4":["1P 4P 5P 7m 9M",["9sus"]],"m":["1P 3m 5P"],"m#5":["1P 3m 5A",["m+","mb6"]],"m11":["1P 3m 5P 7m 9M 11P",["_11"]],"m11A 5":["1P 3m 6m 7m 9M 11P"],"m11b5":["1P 3m 7m 12d 2M 4P",["h11","_11b5"]],"m13":["1P 3m 5P 7m 9M 11P 13M",["_13"]],"m6":["1P 3m 4P 5P 13M",["_6"]],"m69":["1P 3m 5P 6M 9M",["_69"]],"m7":["1P 3m 5P 7m",["minor7","_","_7"]],"m7#5":["1P 3m 6m 7m"],"m7add11":["1P 3m 5P 7m 11P",["m7add4"]],"m7b5":["1P 3m 5d 7m",["half-diminished","h7","_7b5"]],"m9":["1P 3m 5P 7m 9M",["_9"]],"m9#5":["1P 3m 6m 7m 9M"],"m9b5":["1P 3m 7m 12d 2M",["h9","-9b5"]],"mMaj7":["1P 3m 5P 7M",["mM7","_M7"]],"mMaj7b6":["1P 3m 5P 6m 7M",["mM7b6"]],"mM9":["1P 3m 5P 7M 9M",["mMaj9","-M9"]],"mM9b6":["1P 3m 5P 6m 7M 9M",["mMaj9b6"]],"mb6M7":["1P 3m 6m 7M"],"mb6b9":["1P 3m 6m 9m"],"o":["1P 3m 5d",["mb5","dim"]],"o7":["1P 3m 5d 13M",["diminished","m6b5","dim7"]],"o7M7":["1P 3m 5d 6M 7M"],"oM7":["1P 3m 5d 7M"],"sus24":["1P 2M 4P 5P",["sus4add9"]],"+add#9":["1P 3M 5A 9A"],"madd4":["1P 3m 4P 5P"],"madd9":["1P 3m 5P 9M"]}'),FU=function(t){return mU(t)||AU(t)||0};function LU(t){if(BU(t))return t;if(!Array.isArray(t))return"";var e=[0,0,0,0,0,0,0,0,0,0,0,0];return t.map(FU).forEach((function(t){e[t]=1})),e.join("")}var zU=/^[01]{12}$/;function BU(t){return zU.test(t)}"1P 2m 2M 3m 3M 4P 5d 5P 6m 6M 7m 7M".split(" ");var qU=function(t){var e=Object.keys(t).sort(),n=[],s=[],i=function(t,e,i){n[t]=e,s[i]=s[i]||[],s[i].push(t)};e.forEach((function(e){var n=t[e][0].split(" "),s=t[e][1],r=LU(n);i(e,n,r),s&&s.forEach((function(t){return i(t,n,r)}))}));var r=Object.keys(n).sort(),o=function(t){return n[t]};return o.names=function(t){return"string"===typeof t?(s[t]||[]).slice():(!0===t?r:e).slice()},o},VU=function(t,e){var n=function(n){return t(n)||e(n)};return n.names=function(n){return t.names(n).concat(e.names(n))},n},WU=qU(MU),jU=qU(PU),UU=(VU(WU,jU),Object.freeze({name:null,intervals:[],names:[],chroma:null,setnum:null})),GU=function(t){var e=WU(t);if(!e)return UU;var n={intervals:e,name:t};return n.chroma=LU(e),n.setnum=parseInt(n.chroma,2),n.names=WU.names(n.chroma),Object.freeze(n)},HU=function(t,e){return function(n){return e[n]||(e[n]=t(n))}};HU(GU,{}),WU.names;jU.names;var KU=Object.freeze({name:null,names:[],intervals:[],chroma:null,setnum:null}),XU=function(t){var e=jU(t);if(!e)return KU;var n={intervals:e,name:t};return n.chroma=LU(e),n.setnum=parseInt(n.chroma,2),n.names=jU.names(n.chroma),n},QU=function(t,e){return void 0===e&&(e={}),function(n){return e[n]||(e[n]=t(n))}};QU(XU);const YU=120,ZU=80,JU=[[36,35],[38,27,28,31,32,33,34,37,39,40,56,65,66,75,85],[42,44,54,68,69,70,71,73,78,80],[46,67,72,74,79,81],[45,29,41,61,64,84],[48,47,60,63,77,86,87],[50,30,43,62,76,83],[49,55,57,58],[51,52,53,59,82]],tG=0,eG=127,nG=eG-tG+1,sG=0,iG=127,rG=21,oG=108,aG=35,uG=81,cG=89,lG=90,hG=9,pG=10;var dG;(function(t){t[t["Major"]=0]="Major",t[t["Minor"]=1]="Minor",t[t["Augmented"]=2]="Augmented",t[t["Diminished"]=3]="Diminished",t[t["Other"]=4]="Other"})(dG||(dG={}));Error;Error;var fG=n(1835),mG=fG.tensorflow.magenta.NoteSequence;function gG(){if("undefined"!==typeof globalThis)return globalThis;if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof n.g)return n.g;throw new Error("cannot find the global object")}const yG=gG();yG.fetch.bind(yG),yG.performance,yG.navigator,yG.webkitOfflineAudioContext,yG.WorkerGlobalScope;const bG="undefined"!==typeof n.g&&"undefined"!==typeof n.g.process,vG=bG?n(139):window.fetch.bind(window);bG?n(4845):window.performance,bG?n(6928):window.navigator;var wG;(function(t){t[t["NONE"]=0]="NONE",t[t["WARN"]=5]="WARN",t[t["INFO"]=10]="INFO",t[t["DEBUG"]=20]="DEBUG"})(wG||(wG={}));let xG=10;function _G(t,e="Magenta.js",n=10){if(0===n)throw Error("Logging level cannot be NONE.");if(xG>=n){const s=5===n?console.warn:console.log;s(`%c ${e} `,"background:magenta; color:white",t)}}Error;Error;Error;class kG extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}class SG extends Error{constructor(t){super(t),Object.setPrototypeOf(this,new.target.prototype)}}function TG(t){return mG.decode(mG.encode(t).finish())}function IG(t){return t.controlChanges.concat(t.textAnnotations)}function CG(t){if(t.tempos&&0!==t.tempos.length){if(t.tempos.sort(((t,e)=>t.time-e.time)),0!==t.tempos[0].time&&t.tempos[0].qpm!==YU)throw new kG(`NoteSequence has an implicit tempo change from initial ${YU} qpm to ${t.tempos[0].qpm} qpm at ${t.tempos[0].time} seconds.`);for(let e=1;e<t.tempos.length;e++)if(t.tempos[e].qpm!==t.tempos[0].qpm)throw new kG(`NoteSequence has at least one tempo change from ${t.tempos[0].qpm} qpm to ${t.tempos[e].qpm}qpm at ${t.tempos[e].time} seconds.`)}}function AG(t){return t.quantizationInfo&&(t.quantizationInfo.stepsPerQuarter>0||t.quantizationInfo.stepsPerSecond>0)}function NG(t){return t.quantizationInfo&&t.quantizationInfo.stepsPerQuarter>0}function EG(t){if(!NG(t))throw new SG(`NoteSequence ${t.id} is not quantized or is quantized based on absolute timing`)}function OG(t,e){EG(t),CG(t);const n=TG(t);e?n.tempos&&n.tempos.length>0?n.tempos[0].qpm=e:n.tempos.push(mG.Tempo.create({time:0,qpm:e})):e=t.tempos&&t.tempos.length>0?n.tempos[0].qpm:YU;const s=t=>t/n.quantizationInfo.stepsPerQuarter*(60/e);return n.totalTime=s(n.totalQuantizedSteps),n.notes.forEach((t=>{t.startTime=s(t.quantizedStartStep),t.endTime=s(t.quantizedEndStep),n.totalTime=Math.max(n.totalTime,t.endTime),delete t.quantizedStartStep,delete t.quantizedEndStep})),IG(n).forEach((t=>{t.time=s(t.time)})),delete n.totalQuantizedSteps,delete n.quantizationInfo,n}const $G="14.7.77";var RG=n(6404);const DG=()=>new DOMException("","AbortError"),MG=t=>(e,n,[s,i,r],o)=>{t(e[i],[n,s,r],(t=>t[0]===n&&t[1]===s),o)},PG=t=>(e,n,s)=>{const i=[];for(let t=0;t<s.numberOfInputs;t+=1)i.push(new Set);t.set(e,{activeInputs:i,outputs:new Set,passiveInputs:new WeakMap,renderer:n})},FG=t=>(e,n)=>{t.set(e,{activeInputs:new Set,passiveInputs:new WeakMap,renderer:n})},LG=new WeakSet,zG=new WeakMap,BG=new WeakMap,qG=new WeakMap,VG=new WeakMap,WG=new WeakMap,jG=new WeakMap,UG=new WeakMap,GG=new WeakMap,HG=new WeakMap,KG={construct(){return KG}},XG=t=>{try{const e=new Proxy(t,KG);new e}catch{return!1}return!0},QG=/^import(?:(?:[\s]+[\w]+|(?:[\s]+[\w]+[\s]*,)?[\s]*\{[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?(?:[\s]*,[\s]*[\w]+(?:[\s]+as[\s]+[\w]+)?)*[\s]*}|(?:[\s]+[\w]+[\s]*,)?[\s]*\*[\s]+as[\s]+[\w]+)[\s]+from)?(?:[\s]*)("([^"\\]|\\.)+"|'([^'\\]|\\.)+')(?:[\s]*);?/,YG=(t,e)=>{const n=[];let s=t.replace(/^[\s]+/,""),i=s.match(QG);while(null!==i){const t=i[1].slice(1,-1),r=i[0].replace(/([\s]+)?;?$/,"").replace(t,new URL(t,e).toString());n.push(r),s=s.slice(i[0].length).replace(/^[\s]+/,""),i=s.match(QG)}return[n.join(";"),s]},ZG=t=>{if(void 0!==t&&!Array.isArray(t))throw new TypeError("The parameterDescriptors property of given value for processorCtor is not an array.")},JG=t=>{if(!XG(t))throw new TypeError("The given value for processorCtor should be a constructor.");if(null===t.prototype||"object"!==typeof t.prototype)throw new TypeError("The given value for processorCtor should have a prototype.")},tH=(t,e,n,s,i,r,o,a,u,c,l,h,p)=>{let d=0;return(f,m,g={credentials:"omit"})=>{const y=l.get(f);if(void 0!==y&&y.has(m))return Promise.resolve();const b=c.get(f);if(void 0!==b){const t=b.get(m);if(void 0!==t)return t}const v=r(f),w=void 0===v.audioWorklet?i(m).then((([t,e])=>{const[s,i]=YG(t,e),r=`${s};((a,b)=>{(a[b]=a[b]||[]).push((AudioWorkletProcessor,global,registerProcessor,sampleRate,self,window)=>{${i}\n})})(window,'_AWGS')`;return n(r)})).then((()=>{const t=p._AWGS.pop();if(void 0===t)throw new SyntaxError;s(v.currentTime,v.sampleRate,(()=>t(class{},void 0,((t,n)=>{if(""===t.trim())throw e();const s=GG.get(v);if(void 0!==s){if(s.has(t))throw e();JG(n),ZG(n.parameterDescriptors),s.set(t,n)}else JG(n),ZG(n.parameterDescriptors),GG.set(v,new Map([[t,n]]))}),v.sampleRate,void 0,void 0)))})):Promise.all([i(m),Promise.resolve(t(h,h))]).then((([[t,e],n])=>{const s=d+1;d=s;const[i,r]=YG(t,e),c=n?"AudioWorkletProcessor":"class extends AudioWorkletProcessor {__b=new WeakSet();constructor(){super();(p=>p.postMessage=(q=>(m,t)=>q.call(p,m,t?t.filter(u=>!this.__b.has(u)):t))(p.postMessage))(this.port)}}",l=n?"":"__c = (a) => a.forEach(e=>this.__b.add(e.buffer));",h=n?"":"i.forEach(this.__c);o.forEach(this.__c);this.__c(Object.values(p));",p=`${i};((AudioWorkletProcessor,registerProcessor)=>{${r}\n})(${c},(n,p)=>registerProcessor(n,class extends p{${l}process(i,o,p){${h}return super.process(i.map(j=>j.some(k=>k.length===0)?[]:j),o,p)}}));registerProcessor('__sac${s}',class extends AudioWorkletProcessor{process(){return !1}})`,f=new Blob([p],{type:"application/javascript; charset=utf-8"}),m=URL.createObjectURL(f);return v.audioWorklet.addModule(m,g).then((()=>{if(a(v))return v;const t=o(v);return t.audioWorklet.addModule(m,g).then((()=>t))})).then((t=>{if(null===u)throw new SyntaxError;try{new u(t,`__sac${s}`)}catch{throw new SyntaxError}})).finally((()=>URL.revokeObjectURL(m)))}));return void 0===b?c.set(f,new Map([[m,w]])):b.set(m,w),w.then((()=>{const t=l.get(f);void 0===t?l.set(f,new Set([m])):t.add(m)})).finally((()=>{const t=c.get(f);void 0!==t&&t.delete(m)})),w}},eH=(t,e)=>{const n=t.get(e);if(void 0===n)throw new Error("A value with the given key could not be found.");return n},nH=(t,e)=>{const n=Array.from(t).filter(e);if(n.length>1)throw Error("More than one element was found.");if(0===n.length)throw Error("No element was found.");const[s]=n;return t.delete(s),s},sH=(t,e,n,s)=>{const i=eH(t,e),r=nH(i,(t=>t[0]===n&&t[1]===s));return 0===i.size&&t.delete(e),r},iH=t=>eH(jG,t),rH=t=>{if(LG.has(t))throw new Error("The AudioNode is already stored.");LG.add(t),iH(t).forEach((t=>t(!0)))},oH=t=>"port"in t,aH=t=>{if(!LG.has(t))throw new Error("The AudioNode is not stored.");LG.delete(t),iH(t).forEach((t=>t(!1)))},uH=(t,e)=>{!oH(t)&&e.every((t=>0===t.size))&&aH(t)},cH=(t,e,n,s,i,r,o,a,u,c,l,h,p)=>{const d=new WeakMap;return(f,m,g,y,b)=>{const{activeInputs:v,passiveInputs:w}=r(m),{outputs:x}=r(f),_=a(f),k=r=>{const a=u(m),c=u(f);if(r){const e=sH(w,f,g,y);t(v,f,e,!1),b||h(f)||n(c,a,g,y),p(m)&&rH(m)}else{const t=s(v,f,g,y);e(w,y,t,!1),b||h(f)||i(c,a,g,y);const n=o(m);if(0===n)l(m)&&uH(m,v);else{const t=d.get(m);void 0!==t&&clearTimeout(t),d.set(m,setTimeout((()=>{l(m)&&uH(m,v)}),1e3*n))}}};return!!c(x,[m,g,y],(t=>t[0]===m&&t[1]===g&&t[2]===y),!0)&&(_.add(k),l(f)?t(v,f,[g,y,k],!0):e(w,y,[f,g,k],!0),!0)}},lH=t=>(e,n,[s,i,r],o)=>{const a=e.get(s);void 0===a?e.set(s,new Set([[i,n,r]])):t(a,[i,n,r],(t=>t[0]===i&&t[1]===n),o)},hH=t=>(e,n)=>{const s=t(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});n.connect(s).connect(e.destination);const i=()=>{n.removeEventListener("ended",i),n.disconnect(s),s.disconnect()};n.addEventListener("ended",i)},pH=t=>(e,n)=>{t(e).add(n)},dH={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",fftSize:2048,maxDecibels:-30,minDecibels:-100,smoothingTimeConstant:.8},fH=(t,e,n,s,i,r)=>class extends t{constructor(t,n){const o=i(t),a={...dH,...n},u=s(o,a),c=r(o)?e():null;super(t,!1,u,c),this._nativeAnalyserNode=u}get fftSize(){return this._nativeAnalyserNode.fftSize}set fftSize(t){this._nativeAnalyserNode.fftSize=t}get frequencyBinCount(){return this._nativeAnalyserNode.frequencyBinCount}get maxDecibels(){return this._nativeAnalyserNode.maxDecibels}set maxDecibels(t){const e=this._nativeAnalyserNode.maxDecibels;if(this._nativeAnalyserNode.maxDecibels=t,!(t>this._nativeAnalyserNode.minDecibels))throw this._nativeAnalyserNode.maxDecibels=e,n()}get minDecibels(){return this._nativeAnalyserNode.minDecibels}set minDecibels(t){const e=this._nativeAnalyserNode.minDecibels;if(this._nativeAnalyserNode.minDecibels=t,!(this._nativeAnalyserNode.maxDecibels>t))throw this._nativeAnalyserNode.minDecibels=e,n()}get smoothingTimeConstant(){return this._nativeAnalyserNode.smoothingTimeConstant}set smoothingTimeConstant(t){this._nativeAnalyserNode.smoothingTimeConstant=t}getByteFrequencyData(t){this._nativeAnalyserNode.getByteFrequencyData(t)}getByteTimeDomainData(t){this._nativeAnalyserNode.getByteTimeDomainData(t)}getFloatFrequencyData(t){this._nativeAnalyserNode.getFloatFrequencyData(t)}getFloatTimeDomainData(t){this._nativeAnalyserNode.getFloatTimeDomainData(t)}},mH=(t,e)=>t.context===e,gH=(t,e,n)=>()=>{const s=new WeakMap,i=async(i,r)=>{let o=e(i);const a=mH(o,r);if(!a){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,fftSize:o.fftSize,maxDecibels:o.maxDecibels,minDecibels:o.minDecibels,smoothingTimeConstant:o.smoothingTimeConstant};o=t(r,e)}return s.set(r,o),await n(i,r,o),o};return{render(t,e){const n=s.get(e);return void 0!==n?Promise.resolve(n):i(t,e)}}},yH=t=>{try{t.copyToChannel(new Float32Array(1),0,-1)}catch{return!1}return!0},bH=()=>new DOMException("","IndexSizeError"),vH=t=>{t.getChannelData=(e=>n=>{try{return e.call(t,n)}catch(x6){if(12===x6.code)throw bH();throw x6}})(t.getChannelData)},wH={numberOfChannels:1},xH=(t,e,n,s,i,r,o,a)=>{let u=null;return class c{constructor(c){if(null===i)throw new Error("Missing the native OfflineAudioContext constructor.");const{length:l,numberOfChannels:h,sampleRate:p}={...wH,...c};null===u&&(u=new i(1,1,44100));const d=null!==s&&e(r,r)?new s({length:l,numberOfChannels:h,sampleRate:p}):u.createBuffer(h,l,p);if(0===d.numberOfChannels)throw n();return"function"!==typeof d.copyFromChannel?(o(d),vH(d)):e(yH,(()=>yH(d)))||a(d),t.add(d),d}static[Symbol.hasInstance](e){return null!==e&&"object"===typeof e&&Object.getPrototypeOf(e)===c.prototype||t.has(e)}}},_H=-34028234663852886e22,kH=-_H,SH=t=>LG.has(t),TH={buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1},IH=(t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const a=r(t),u={...TH,...s},c=i(a,u),l=o(a),h=l?e():null;super(t,!1,c,h),this._audioBufferSourceNodeRenderer=h,this._isBufferNullified=!1,this._isBufferSet=null!==u.buffer,this._nativeAudioBufferSourceNode=c,this._onended=null,this._playbackRate=n(this,l,c.playbackRate,kH,_H)}get buffer(){return this._isBufferNullified?null:this._nativeAudioBufferSourceNode.buffer}set buffer(t){if(this._nativeAudioBufferSourceNode.buffer=t,null!==t){if(this._isBufferSet)throw s();this._isBufferSet=!0}}get loop(){return this._nativeAudioBufferSourceNode.loop}set loop(t){this._nativeAudioBufferSourceNode.loop=t}get loopEnd(){return this._nativeAudioBufferSourceNode.loopEnd}set loopEnd(t){this._nativeAudioBufferSourceNode.loopEnd=t}get loopStart(){return this._nativeAudioBufferSourceNode.loopStart}set loopStart(t){this._nativeAudioBufferSourceNode.loopStart=t}get onended(){return this._onended}set onended(t){const e="function"===typeof t?a(this,t):null;this._nativeAudioBufferSourceNode.onended=e;const n=this._nativeAudioBufferSourceNode.onended;this._onended=null!==n&&n===e?t:n}get playbackRate(){return this._playbackRate}start(t=0,e=0,n){if(this._nativeAudioBufferSourceNode.start(t,e,n),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.start=void 0===n?[t,e]:[t,e,n]),"closed"!==this.context.state){rH(this);const t=()=>{this._nativeAudioBufferSourceNode.removeEventListener("ended",t),SH(this)&&aH(this)};this._nativeAudioBufferSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeAudioBufferSourceNode.stop(t),null!==this._audioBufferSourceNodeRenderer&&(this._audioBufferSourceNodeRenderer.stop=t)}},CH=(t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const u=async(u,c)=>{let l=n(u);const h=mH(l,c);if(!h){const t={buffer:l.buffer,channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,loop:l.loop,loopEnd:l.loopEnd,loopStart:l.loopStart,playbackRate:l.playbackRate.value};l=e(c,t),null!==o&&l.start(...o),null!==a&&l.stop(a)}return r.set(c,l),h?await t(c,u.playbackRate,l.playbackRate):await s(c,u.playbackRate,l.playbackRate),await i(u,c,l),l};return{set start(t){o=t},set stop(t){a=t},render(t,e){const n=r.get(e);return void 0!==n?Promise.resolve(n):u(t,e)}}},AH=t=>"playbackRate"in t,NH=t=>"frequency"in t&&"gain"in t,EH=t=>"offset"in t,OH=t=>!("frequency"in t)&&"gain"in t,$H=t=>"detune"in t&&"frequency"in t,RH=t=>"pan"in t,DH=t=>eH(zG,t),MH=t=>eH(qG,t),PH=(t,e)=>{const{activeInputs:n}=DH(t);n.forEach((n=>n.forEach((([n])=>{e.includes(t)||PH(n,[...e,t])}))));const s=AH(t)?[t.playbackRate]:oH(t)?Array.from(t.parameters.values()):NH(t)?[t.Q,t.detune,t.frequency,t.gain]:EH(t)?[t.offset]:OH(t)?[t.gain]:$H(t)?[t.detune,t.frequency]:RH(t)?[t.pan]:[];for(const i of s){const t=MH(i);void 0!==t&&t.activeInputs.forEach((([t])=>PH(t,e)))}SH(t)&&aH(t)},FH=t=>{PH(t.destination,[])},LH=t=>void 0===t||"number"===typeof t||"string"===typeof t&&("balanced"===t||"interactive"===t||"playback"===t),zH=(t,e,n,s,i,r,o,a,u)=>class extends t{constructor(t={}){if(null===u)throw new Error("Missing the native AudioContext constructor.");let e;try{e=new u(t)}catch(x6){if(12===x6.code&&"sampleRate is not in range"===x6.message)throw n();throw x6}if(null===e)throw s();if(!LH(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&e.sampleRate!==t.sampleRate)throw n();super(e,2);const{latencyHint:i}=t,{sampleRate:r}=e;if(this._baseLatency="number"===typeof e.baseLatency?e.baseLatency:"balanced"===i?512/r:"interactive"===i||void 0===i?256/r:"playback"===i?1024/r:128*Math.max(2,Math.min(128,Math.round(i*r/128)))/r,this._nativeAudioContext=e,"webkitAudioContext"===u.name?(this._nativeGainNode=e.createGain(),this._nativeOscillatorNode=e.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(e.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===e.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),e.removeEventListener("statechange",t)};e.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw e()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),FH(this)})))}createMediaElementSource(t){return new i(this,{mediaElement:t})}createMediaStreamDestination(){return new r(this)}createMediaStreamSource(t){return new o(this,{mediaStream:t})}createMediaStreamTrackSource(t){return new a(this,{mediaStreamTrack:t})}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((t=>{if(void 0===t||15===t.code)throw e();throw t}))}suspend(){return this._nativeAudioContext.suspend().catch((t=>{if(void 0===t)throw e();throw t}))}},BH=(t,e,n,s,i,r,o,a)=>class extends t{constructor(t,n){const s=r(t),u=o(s),c=i(s,n,u),l=u?e(a):null;super(t,!1,c,l),this._isNodeOfNativeOfflineAudioContext=u,this._nativeAudioDestinationNode=c}get channelCount(){return this._nativeAudioDestinationNode.channelCount}set channelCount(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();if(t>this._nativeAudioDestinationNode.maxChannelCount)throw n();this._nativeAudioDestinationNode.channelCount=t}get channelCountMode(){return this._nativeAudioDestinationNode.channelCountMode}set channelCountMode(t){if(this._isNodeOfNativeOfflineAudioContext)throw s();this._nativeAudioDestinationNode.channelCountMode=t}get maxChannelCount(){return this._nativeAudioDestinationNode.maxChannelCount}},qH=t=>{const e=new WeakMap,n=async(n,s)=>{const i=s.destination;return e.set(s,i),await t(n,s,i),i};return{render(t,s){const i=e.get(s);return void 0!==i?Promise.resolve(i):n(t,s)}}},VH=(t,e,n,s,i,r,o,a)=>(u,c)=>{const l=c.listener,h=()=>{const h=new Float32Array(1),p=e(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:9}),d=o(c);let f=!1,m=[0,0,-1,0,1,0],g=[0,0,0];const y=()=>{if(f)return;f=!0;const t=s(c,256,9,0);t.onaudioprocess=({inputBuffer:t})=>{const e=[r(t,h,0),r(t,h,1),r(t,h,2),r(t,h,3),r(t,h,4),r(t,h,5)];e.some(((t,e)=>t!==m[e]))&&(l.setOrientation(...e),m=e);const n=[r(t,h,6),r(t,h,7),r(t,h,8)];n.some(((t,e)=>t!==g[e]))&&(l.setPosition(...n),g=n)},p.connect(t)},b=t=>e=>{e!==m[t]&&(m[t]=e,l.setOrientation(...m))},v=t=>e=>{e!==g[t]&&(g[t]=e,l.setPosition(...g))},w=(e,s,r)=>{const o=n(c,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:s});o.connect(p,0,e),o.start(),Object.defineProperty(o.offset,"defaultValue",{get(){return s}});const l=t({context:u},d,o.offset,kH,_H);return a(l,"value",(t=>()=>t.call(l)),(t=>e=>{try{t.call(l,e)}catch(x6){if(9!==x6.code)throw x6}y(),d&&r(e)})),l.cancelAndHoldAtTime=(t=>d?()=>{throw i()}:(...e)=>{const n=t.apply(l,e);return y(),n})(l.cancelAndHoldAtTime),l.cancelScheduledValues=(t=>d?()=>{throw i()}:(...e)=>{const n=t.apply(l,e);return y(),n})(l.cancelScheduledValues),l.exponentialRampToValueAtTime=(t=>d?()=>{throw i()}:(...e)=>{const n=t.apply(l,e);return y(),n})(l.exponentialRampToValueAtTime),l.linearRampToValueAtTime=(t=>d?()=>{throw i()}:(...e)=>{const n=t.apply(l,e);return y(),n})(l.linearRampToValueAtTime),l.setTargetAtTime=(t=>d?()=>{throw i()}:(...e)=>{const n=t.apply(l,e);return y(),n})(l.setTargetAtTime),l.setValueAtTime=(t=>d?()=>{throw i()}:(...e)=>{const n=t.apply(l,e);return y(),n})(l.setValueAtTime),l.setValueCurveAtTime=(t=>d?()=>{throw i()}:(...e)=>{const n=t.apply(l,e);return y(),n})(l.setValueCurveAtTime),l};return{forwardX:w(0,0,b(0)),forwardY:w(1,0,b(1)),forwardZ:w(2,-1,b(2)),positionX:w(6,0,v(0)),positionY:w(7,0,v(1)),positionZ:w(8,0,v(2)),upX:w(3,0,b(3)),upY:w(4,1,b(4)),upZ:w(5,0,b(5))}},{forwardX:p,forwardY:d,forwardZ:f,positionX:m,positionY:g,positionZ:y,upX:b,upY:v,upZ:w}=void 0===l.forwardX?h():l;return{get forwardX(){return p},get forwardY(){return d},get forwardZ(){return f},get positionX(){return m},get positionY(){return g},get positionZ(){return y},get upX(){return b},get upY(){return v},get upZ(){return w}}},WH=t=>"context"in t,jH=t=>WH(t[0]),UH=(t,e,n,s)=>{for(const i of t)if(n(i)){if(s)return!1;throw Error("The set contains at least one similar element.")}return t.add(e),!0},GH=(t,e,[n,s],i)=>{UH(t,[e,n,s],(t=>t[0]===e&&t[1]===n),i)},HH=(t,[e,n,s],i)=>{const r=t.get(e);void 0===r?t.set(e,new Set([[n,s]])):UH(r,[n,s],(t=>t[0]===n),i)},KH=t=>"inputs"in t,XH=(t,e,n,s)=>{if(KH(e)){const i=e.inputs[s];return t.connect(i,n,0),[i,n,0]}return t.connect(e,n,s),[e,n,s]},QH=(t,e,n)=>{for(const s of t)if(s[0]===e&&s[1]===n)return t.delete(s),s;return null},YH=(t,e,n)=>nH(t,(t=>t[0]===e&&t[1]===n)),ZH=(t,e)=>{const n=iH(t);if(!n.delete(e))throw new Error("Missing the expected event listener.")},JH=(t,e,n)=>{const s=eH(t,e),i=nH(s,(t=>t[0]===n));return 0===s.size&&t.delete(e),i},tK=(t,e,n,s)=>{KH(e)?t.disconnect(e.inputs[s],n,0):t.disconnect(e,n,s)},eK=t=>eH(BG,t),nK=t=>eH(VG,t),sK=t=>UG.has(t),iK=t=>!LG.has(t),rK=(t,e)=>new Promise((n=>{if(null!==e)n(!0);else{const e=t.createScriptProcessor(256,1,1),s=t.createGain(),i=t.createBuffer(1,2,44100),r=i.getChannelData(0);r[0]=1,r[1]=1;const o=t.createBufferSource();o.buffer=i,o.loop=!0,o.connect(e).connect(t.destination),o.connect(s),o.disconnect(s),e.onaudioprocess=s=>{const i=s.inputBuffer.getChannelData(0);Array.prototype.some.call(i,(t=>1===t))?n(!0):n(!1),o.stop(),e.onaudioprocess=null,o.disconnect(e),e.disconnect(t.destination)},o.start()}})),oK=(t,e)=>{const n=new Map;for(const s of t)for(const t of s){const e=n.get(t);n.set(t,void 0===e?1:e+1)}n.forEach(((t,n)=>e(n,t)))},aK=t=>"context"in t,uK=t=>{const e=new Map;t.connect=(t=>(n,s=0,i=0)=>{const r=aK(n)?t(n,s,i):t(n,s),o=e.get(n);return void 0===o?e.set(n,[{input:i,output:s}]):o.every((t=>t.input!==i||t.output!==s))&&o.push({input:i,output:s}),r})(t.connect.bind(t)),t.disconnect=(n=>(s,i,r)=>{if(n.apply(t),void 0===s)e.clear();else if("number"===typeof s)for(const[t,n]of e){const i=n.filter((t=>t.output!==s));0===i.length?e.delete(t):e.set(t,i)}else if(e.has(s))if(void 0===i)e.delete(s);else{const t=e.get(s);if(void 0!==t){const n=t.filter((t=>t.output!==i&&(t.input!==r||void 0===r)));0===n.length?e.delete(s):e.set(s,n)}}for(const[n,o]of e)o.forEach((e=>{aK(n)?t.connect(n,e.output,e.input):t.connect(n,e.output)}))})(t.disconnect)},cK=(t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=MH(e),{outputs:o}=DH(t),a=iH(t),u=o=>{const a=eK(t),u=nK(e);if(o){const e=JH(r,t,n);GH(i,t,e,!1),s||sK(t)||a.connect(u,n)}else{const e=YH(i,t,n);HH(r,e,!1),s||sK(t)||a.disconnect(u,n)}};return!!UH(o,[e,n],(t=>t[0]===e&&t[1]===n),!0)&&(a.add(u),SH(t)?GH(i,t,[n,u],!0):HH(r,[t,n,u],!0),!0)},lK=(t,e,n,s)=>{const{activeInputs:i,passiveInputs:r}=DH(e),o=QH(i[s],t,n);if(null===o){const e=sH(r,t,n,s);return[e[2],!1]}return[o[2],!0]},hK=(t,e,n)=>{const{activeInputs:s,passiveInputs:i}=MH(e),r=QH(s,t,n);if(null===r){const e=JH(i,t,n);return[e[1],!1]}return[r[2],!0]},pK=(t,e,n,s,i)=>{const[r,o]=lK(t,n,s,i);if(null!==r&&(ZH(t,r),!o||e||sK(t)||tK(eK(t),eK(n),s,i)),SH(n)){const{activeInputs:t}=DH(n);uH(n,t)}},dK=(t,e,n,s)=>{const[i,r]=hK(t,n,s);null!==i&&(ZH(t,i),!r||e||sK(t)||eK(t).disconnect(nK(n),s))},fK=(t,e)=>{const n=DH(t),s=[];for(const i of n.outputs)jH(i)?pK(t,e,...i):dK(t,e,...i),s.push(i[0]);return n.outputs.clear(),s},mK=(t,e,n)=>{const s=DH(t),i=[];for(const r of s.outputs)r[1]===n&&(jH(r)?pK(t,e,...r):dK(t,e,...r),i.push(r[0]),s.outputs.delete(r));return i},gK=(t,e,n,s,i)=>{const r=DH(t);return Array.from(r.outputs).filter((t=>t[0]===n&&(void 0===s||t[1]===s)&&(void 0===i||t[2]===i))).map((n=>(jH(n)?pK(t,e,...n):dK(t,e,...n),r.outputs.delete(n),n[0])))},yK=(t,e,n,s,i,r,o,a,u,c,l,h,p,d,f,m)=>class extends c{constructor(e,s,i,r){super(i),this._context=e,this._nativeAudioNode=i;const o=l(e);h(o)&&!0!==n(rK,(()=>rK(o,m)))&&uK(i),BG.set(this,i),jG.set(this,new Set),"closed"!==e.state&&s&&rH(this),t(this,r,i)}get channelCount(){return this._nativeAudioNode.channelCount}set channelCount(t){this._nativeAudioNode.channelCount=t}get channelCountMode(){return this._nativeAudioNode.channelCountMode}set channelCountMode(t){this._nativeAudioNode.channelCountMode=t}get channelInterpretation(){return this._nativeAudioNode.channelInterpretation}set channelInterpretation(t){this._nativeAudioNode.channelInterpretation=t}get context(){return this._context}get numberOfInputs(){return this._nativeAudioNode.numberOfInputs}get numberOfOutputs(){return this._nativeAudioNode.numberOfOutputs}connect(t,n=0,a=0){if(n<0||n>=this._nativeAudioNode.numberOfOutputs)throw i();const c=l(this._context),h=f(c);if(p(t)||d(t))throw r();if(WH(t)){const i=eK(t);try{const e=XH(this._nativeAudioNode,i,n,a),s=iK(this);(h||s)&&this._nativeAudioNode.disconnect(...e),"closed"!==this.context.state&&!s&&iK(t)&&rH(t)}catch(x6){if(12===x6.code)throw r();throw x6}const o=e(this,t,n,a,h);if(o){const e=u([this],t);oK(e,s(h))}return t}const m=nK(t);if("playbackRate"===m.name&&1024===m.maxValue)throw o();try{this._nativeAudioNode.connect(m,n),(h||iK(this))&&this._nativeAudioNode.disconnect(m,n)}catch(x6){if(12===x6.code)throw r();throw x6}const g=cK(this,t,n,h);if(g){const e=u([this],t);oK(e,s(h))}}disconnect(t,e,n){let s;const o=l(this._context),c=f(o);if(void 0===t)s=fK(this,c);else if("number"===typeof t){if(t<0||t>=this.numberOfOutputs)throw i();s=mK(this,c,t)}else{if(void 0!==e&&(e<0||e>=this.numberOfOutputs))throw i();if(WH(t)&&void 0!==n&&(n<0||n>=t.numberOfInputs))throw i();if(s=gK(this,c,t,e,n),0===s.length)throw r()}for(const i of s){const t=u([this],i);oK(t,a)}}},bK=(t,e,n,s,i,r,o,a,u,c,l,h,p)=>(d,f,m,g=null,y=null)=>{const b=m.value,v=new RG.AutomationEventList(b),w=f?s(v):null,x={get defaultValue(){return b},get maxValue(){return null===g?m.maxValue:g},get minValue(){return null===y?m.minValue:y},get value(){return m.value},set value(t){m.value=t,x.setValueAtTime(t,d.context.currentTime)},cancelAndHoldAtTime(t){if("function"===typeof m.cancelAndHoldAtTime)null===w&&v.flush(d.context.currentTime),v.add(i(t)),m.cancelAndHoldAtTime(t);else{const e=Array.from(v).pop();null===w&&v.flush(d.context.currentTime),v.add(i(t));const n=Array.from(v).pop();m.cancelScheduledValues(t),e!==n&&void 0!==n&&("exponentialRampToValue"===n.type?m.exponentialRampToValueAtTime(n.value,n.endTime):"linearRampToValue"===n.type?m.linearRampToValueAtTime(n.value,n.endTime):"setValue"===n.type?m.setValueAtTime(n.value,n.startTime):"setValueCurve"===n.type&&m.setValueCurveAtTime(n.values,n.startTime,n.duration))}return x},cancelScheduledValues(t){return null===w&&v.flush(d.context.currentTime),v.add(r(t)),m.cancelScheduledValues(t),x},exponentialRampToValueAtTime(t,e){if(0===t)throw new RangeError;if(!Number.isFinite(e)||e<0)throw new RangeError;const n=d.context.currentTime;return null===w&&v.flush(n),0===Array.from(v).length&&(v.add(c(b,n)),m.setValueAtTime(b,n)),v.add(o(t,e)),m.exponentialRampToValueAtTime(t,e),x},linearRampToValueAtTime(t,e){const n=d.context.currentTime;return null===w&&v.flush(n),0===Array.from(v).length&&(v.add(c(b,n)),m.setValueAtTime(b,n)),v.add(a(t,e)),m.linearRampToValueAtTime(t,e),x},setTargetAtTime(t,e,n){return null===w&&v.flush(d.context.currentTime),v.add(u(t,e,n)),m.setTargetAtTime(t,e,n),x},setValueAtTime(t,e){return null===w&&v.flush(d.context.currentTime),v.add(c(t,e)),m.setValueAtTime(t,e),x},setValueCurveAtTime(t,e,n){const s=t instanceof Float32Array?t:new Float32Array(t);if(null!==h&&"webkitAudioContext"===h.name){const t=e+n,i=d.context.sampleRate,r=Math.ceil(e*i),o=Math.floor(t*i),a=o-r,u=new Float32Array(a);for(let l=0;l<a;l+=1){const t=(s.length-1)/n*((r+l)/i-e),o=Math.floor(t),a=Math.ceil(t);u[l]=o===a?s[o]:(1-(t-o))*s[o]+(1-(a-t))*s[a]}null===w&&v.flush(d.context.currentTime),v.add(l(u,e,n)),m.setValueCurveAtTime(u,e,n);const c=o/i;c<t&&p(x,u[u.length-1],c),p(x,s[s.length-1],t)}else null===w&&v.flush(d.context.currentTime),v.add(l(s,e,n)),m.setValueCurveAtTime(s,e,n);return x}};return n.set(x,m),e.set(x,d),t(x,w),x},vK=t=>({replay(e){for(const n of t)if("exponentialRampToValue"===n.type){const{endTime:t,value:s}=n;e.exponentialRampToValueAtTime(s,t)}else if("linearRampToValue"===n.type){const{endTime:t,value:s}=n;e.linearRampToValueAtTime(s,t)}else if("setTarget"===n.type){const{startTime:t,target:s,timeConstant:i}=n;e.setTargetAtTime(s,t,i)}else if("setValue"===n.type){const{startTime:t,value:s}=n;e.setValueAtTime(s,t)}else{if("setValueCurve"!==n.type)throw new Error("Can't apply an unknown automation.");{const{duration:t,startTime:s,values:i}=n;e.setValueCurveAtTime(i,s,t)}}}});class wK{constructor(t){this._map=new Map(t)}get size(){return this._map.size}entries(){return this._map.entries()}forEach(t,e=null){return this._map.forEach(((n,s)=>t.call(e,n,s,this)))}get(t){return this._map.get(t)}has(t){return this._map.has(t)}keys(){return this._map.keys()}values(){return this._map.values()}}const xK={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:1,numberOfOutputs:1,parameterData:{},processorOptions:{}},_K=(t,e,n,s,i,r,o,a,u,c,l,h,p,d)=>class extends e{constructor(e,d,f){var m;const g=a(e),y=u(g),b=l({...xK,...f});p(b);const v=GG.get(g),w=null===v||void 0===v?void 0:v.get(d),x=y||"closed"!==g.state?g:null!==(m=o(g))&&void 0!==m?m:g,_=i(x,y?null:e.baseLatency,c,d,w,b),k=y?s(d,b,w):null;super(e,!0,_,k);const S=[];_.parameters.forEach(((t,e)=>{const s=n(this,y,t);S.push([e,s])})),this._nativeAudioWorkletNode=_,this._onprocessorerror=null,this._parameters=new wK(S),y&&t(g,this);const{activeInputs:T}=r(this);h(_,T)}get onprocessorerror(){return this._onprocessorerror}set onprocessorerror(t){const e="function"===typeof t?d(this,t):null;this._nativeAudioWorkletNode.onprocessorerror=e;const n=this._nativeAudioWorkletNode.onprocessorerror;this._onprocessorerror=null!==n&&n===e?t:n}get parameters(){return null===this._parameters?this._nativeAudioWorkletNode.parameters:this._parameters}get port(){return this._nativeAudioWorkletNode.port}};function kK(t,e,n,s,i){if("function"===typeof t.copyFromChannel)0===e[n].byteLength&&(e[n]=new Float32Array(128)),t.copyFromChannel(e[n],s,i);else{const r=t.getChannelData(s);if(0===e[n].byteLength)e[n]=r.slice(i,i+128);else{const t=new Float32Array(r.buffer,i*Float32Array.BYTES_PER_ELEMENT,128);e[n].set(t)}}}const SK=(t,e,n,s,i)=>{"function"===typeof t.copyToChannel?0!==e[n].byteLength&&t.copyToChannel(e[n],s,i):0!==e[n].byteLength&&t.getChannelData(s).set(e[n],i)},TK=(t,e)=>{const n=[];for(let s=0;s<t;s+=1){const t=[],i="number"===typeof e?e:e[s];for(let e=0;e<i;e+=1)t.push(new Float32Array(128));n.push(t)}return n},IK=(t,e)=>{const n=eH(HG,t),s=eK(e);return eH(n,s)},CK=async(t,e,n,s,i,r,o)=>{const a=null===e?128*Math.ceil(t.context.length/128):e.length,u=s.channelCount*s.numberOfInputs,c=i.reduce(((t,e)=>t+e),0),l=0===c?null:n.createBuffer(c,a,n.sampleRate);if(void 0===r)throw new Error("Missing the processor constructor.");const h=DH(t),p=await IK(n,t),d=TK(s.numberOfInputs,s.channelCount),f=TK(s.numberOfOutputs,i),m=Array.from(t.parameters.keys()).reduce(((t,e)=>({...t,[e]:new Float32Array(128)})),{});for(let y=0;y<a;y+=128){if(s.numberOfInputs>0&&null!==e)for(let t=0;t<s.numberOfInputs;t+=1)for(let n=0;n<s.channelCount;n+=1)kK(e,d[t],n,n,y);void 0!==r.parameterDescriptors&&null!==e&&r.parameterDescriptors.forEach((({name:t},n)=>{kK(e,m,t,u+n,y)}));for(let t=0;t<s.numberOfInputs;t+=1)for(let e=0;e<i[t];e+=1)0===f[t][e].byteLength&&(f[t][e]=new Float32Array(128));try{const t=d.map(((t,e)=>0===h.activeInputs[e].size?[]:t)),e=o(y/n.sampleRate,n.sampleRate,(()=>p.process(t,f,m)));if(null!==l)for(let n=0,r=0;n<s.numberOfOutputs;n+=1){for(let t=0;t<i[n];t+=1)SK(l,f[n],t,r+t,y);r+=i[n]}if(!e)break}catch(g){t.dispatchEvent(new ErrorEvent("processorerror",{colno:g.colno,filename:g.filename,lineno:g.lineno,message:g.message}));break}}return l},AK=(t,e,n,s,i,r,o,a,u,c,l,h,p,d,f,m)=>(g,y,b)=>{const v=new WeakMap;let w=null;const x=async(a,x)=>{let _=l(a),k=null;const S=mH(_,x),T=Array.isArray(y.outputChannelCount)?y.outputChannelCount:Array.from(y.outputChannelCount);if(null===h){const t=T.reduce(((t,e)=>t+e),0),n=i(x,{channelCount:Math.max(1,t),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,t)}),r=[];for(let e=0;e<a.numberOfOutputs;e+=1)r.push(s(x,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:T[e]}));const c=o(x,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1});c.connect=e.bind(null,r),c.disconnect=u.bind(null,r),k=[n,r,c]}else S||(_=new h(x,g));if(v.set(x,null===k?_:k[2]),null!==k){if(null===w){if(void 0===b)throw new Error("Missing the processor constructor.");if(null===p)throw new Error("Missing the native OfflineAudioContext constructor.");const t=a.channelCount*a.numberOfInputs,e=void 0===b.parameterDescriptors?0:b.parameterDescriptors.length,n=t+e,u=async()=>{const u=new p(n,128*Math.ceil(a.context.length/128),x.sampleRate),c=[],l=[];for(let t=0;t<y.numberOfInputs;t+=1)c.push(o(u,{channelCount:y.channelCount,channelCountMode:y.channelCountMode,channelInterpretation:y.channelInterpretation,gain:1})),l.push(i(u,{channelCount:y.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:y.channelCount}));const h=await Promise.all(Array.from(a.parameters.values()).map((async t=>{const e=r(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:t.value});return await d(u,t,e.offset),e}))),g=s(u,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,t+e)});for(let t=0;t<y.numberOfInputs;t+=1){c[t].connect(l[t]);for(let e=0;e<y.channelCount;e+=1)l[t].connect(g,e,t*y.channelCount+e)}for(const[e,n]of h.entries())n.connect(g,0,t+e),n.start(0);return g.connect(u.destination),await Promise.all(c.map((t=>f(a,u,t)))),m(u)};w=CK(a,0===n?null:await u(),x,y,T,b,c)}const t=await w,e=n(x,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),[u,l,h]=k;null!==t&&(e.buffer=t,e.start(0)),e.connect(u);for(let n=0,s=0;n<a.numberOfOutputs;n+=1){const t=l[n];for(let e=0;e<T[n];e+=1)u.connect(t,s+e,e);s+=T[n]}return h}if(S)for(const[e,n]of a.parameters.entries())await t(x,n,_.parameters.get(e));else for(const[t,e]of a.parameters.entries())await d(x,e,_.parameters.get(t));return await f(a,x,_),_};return{render(t,e){a(e,t);const n=v.get(e);return void 0!==n?Promise.resolve(n):x(t,e)}}},NK=(t,e,n,s,i,r,o,a,u,c,l,h,p,d,f,m,g,y,b,v)=>class extends f{constructor(e,n){super(e,n),this._nativeContext=e,this._audioWorklet=void 0===t?void 0:{addModule:(e,n)=>t(this,e,n)}}get audioWorklet(){return this._audioWorklet}createAnalyser(){return new e(this)}createBiquadFilter(){return new i(this)}createBuffer(t,e,s){return new n({length:e,numberOfChannels:t,sampleRate:s})}createBufferSource(){return new s(this)}createChannelMerger(t=6){return new r(this,{numberOfInputs:t})}createChannelSplitter(t=6){return new o(this,{numberOfOutputs:t})}createConstantSource(){return new a(this)}createConvolver(){return new u(this)}createDelay(t=1){return new l(this,{maxDelayTime:t})}createDynamicsCompressor(){return new h(this)}createGain(){return new p(this)}createIIRFilter(t,e){return new d(this,{feedback:e,feedforward:t})}createOscillator(){return new m(this)}createPanner(){return new g(this)}createPeriodicWave(t,e,n={disableNormalization:!1}){return new y(this,{...n,imag:e,real:t})}createStereoPanner(){return new b(this)}createWaveShaper(){return new v(this)}decodeAudioData(t,e,n){return c(this._nativeContext,t).then((t=>("function"===typeof e&&e(t),t)),(t=>{throw"function"===typeof n&&n(t),t}))}},EK={Q:1,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:350,gain:0,type:"lowpass"},OK=(t,e,n,s,i,r,o,a)=>class extends t{constructor(t,s){const u=r(t),c={...EK,...s},l=i(u,c),h=o(u),p=h?n():null;super(t,!1,l,p),this._Q=e(this,h,l.Q,kH,_H),this._detune=e(this,h,l.detune,1200*Math.log2(kH),-1200*Math.log2(kH)),this._frequency=e(this,h,l.frequency,t.sampleRate/2,0),this._gain=e(this,h,l.gain,40*Math.log10(kH),_H),this._nativeBiquadFilterNode=l,a(this,1)}get detune(){return this._detune}get frequency(){return this._frequency}get gain(){return this._gain}get Q(){return this._Q}get type(){return this._nativeBiquadFilterNode.type}set type(t){this._nativeBiquadFilterNode.type=t}getFrequencyResponse(t,e,n){try{this._nativeBiquadFilterNode.getFrequencyResponse(t,e,n)}catch(x6){if(11===x6.code)throw s();throw x6}if(t.length!==e.length||e.length!==n.length)throw s()}},$K=(t,e,n,s,i)=>()=>{const r=new WeakMap,o=async(o,a)=>{let u=n(o);const c=mH(u,a);if(!c){const t={Q:u.Q.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,detune:u.detune.value,frequency:u.frequency.value,gain:u.gain.value,type:u.type};u=e(a,t)}return r.set(a,u),c?(await t(a,o.Q,u.Q),await t(a,o.detune,u.detune),await t(a,o.frequency,u.frequency),await t(a,o.gain,u.gain)):(await s(a,o.Q,u.Q),await s(a,o.detune,u.detune),await s(a,o.frequency,u.frequency),await s(a,o.gain,u.gain)),await i(o,a,u),u};return{render(t,e){const n=r.get(e);return void 0!==n?Promise.resolve(n):o(t,e)}}},RK=(t,e)=>(n,s)=>{const i=e.get(n);if(void 0!==i)return i;const r=t.get(n);if(void 0!==r)return r;try{const i=s();return i instanceof Promise?(t.set(n,i),i.catch((()=>!1)).then((s=>(t.delete(n),e.set(n,s),s)))):(e.set(n,i),i)}catch{return e.set(n,!1),!1}},DK={channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6},MK=(t,e,n,s,i)=>class extends t{constructor(t,r){const o=s(t),a={...DK,...r},u=n(o,a),c=i(o)?e():null;super(t,!1,u,c)}},PK=(t,e,n)=>()=>{const s=new WeakMap,i=async(i,r)=>{let o=e(i);const a=mH(o,r);if(!a){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfInputs:o.numberOfInputs};o=t(r,e)}return s.set(r,o),await n(i,r,o),o};return{render(t,e){const n=s.get(e);return void 0!==n?Promise.resolve(n):i(t,e)}}},FK={channelCount:6,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:6},LK=(t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),u=r({...FK,...o}),c=n(a,u),l=i(a)?e():null;super(t,!1,c,l)}},zK=(t,e,n)=>()=>{const s=new WeakMap,i=async(i,r)=>{let o=e(i);const a=mH(o,r);if(!a){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,numberOfOutputs:o.numberOfOutputs};o=t(r,e)}return s.set(r,o),await n(i,r,o),o};return{render(t,e){const n=s.get(e);return void 0!==n?Promise.resolve(n):i(t,e)}}},BK=t=>(e,n,s)=>t(n,e,s),qK=t=>(e,n,s=0,i=0)=>{const r=e[s];if(void 0===r)throw t();return aK(n)?r.connect(n,0,i):r.connect(n,0)},VK=t=>(e,n)=>{const s=t(e,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),i=e.createBuffer(1,2,44100);return s.buffer=i,s.loop=!0,s.connect(n),s.start(),()=>{s.stop(),s.disconnect(n)}},WK={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",offset:1},jK=(t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),u={...WK,...o},c=s(a,u),l=r(a),h=l?n():null;super(t,!1,c,h),this._constantSourceNodeRenderer=h,this._nativeConstantSourceNode=c,this._offset=e(this,l,c.offset,kH,_H),this._onended=null}get offset(){return this._offset}get onended(){return this._onended}set onended(t){const e="function"===typeof t?o(this,t):null;this._nativeConstantSourceNode.onended=e;const n=this._nativeConstantSourceNode.onended;this._onended=null!==n&&n===e?t:n}start(t=0){if(this._nativeConstantSourceNode.start(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.start=t),"closed"!==this.context.state){rH(this);const t=()=>{this._nativeConstantSourceNode.removeEventListener("ended",t),SH(this)&&aH(this)};this._nativeConstantSourceNode.addEventListener("ended",t)}}stop(t=0){this._nativeConstantSourceNode.stop(t),null!==this._constantSourceNodeRenderer&&(this._constantSourceNodeRenderer.stop=t)}},UK=(t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null;const u=async(u,c)=>{let l=n(u);const h=mH(l,c);if(!h){const t={channelCount:l.channelCount,channelCountMode:l.channelCountMode,channelInterpretation:l.channelInterpretation,offset:l.offset.value};l=e(c,t),null!==o&&l.start(o),null!==a&&l.stop(a)}return r.set(c,l),h?await t(c,u.offset,l.offset):await s(c,u.offset,l.offset),await i(u,c,l),l};return{set start(t){o=t},set stop(t){a=t},render(t,e){const n=r.get(e);return void 0!==n?Promise.resolve(n):u(t,e)}}},GK=t=>e=>(t[0]=e,t[0]),HK={buffer:null,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",disableNormalization:!1},KK=(t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),u={...HK,...o},c=n(a,u),l=i(a),h=l?e():null;super(t,!1,c,h),this._isBufferNullified=!1,this._nativeConvolverNode=c,null!==u.buffer&&r(this,u.buffer.duration)}get buffer(){return this._isBufferNullified?null:this._nativeConvolverNode.buffer}set buffer(t){if(this._nativeConvolverNode.buffer=t,null===t&&null!==this._nativeConvolverNode.buffer){const t=this._nativeConvolverNode.context;this._nativeConvolverNode.buffer=t.createBuffer(1,1,t.sampleRate),this._isBufferNullified=!0,r(this,0)}else this._isBufferNullified=!1,r(this,null===this._nativeConvolverNode.buffer?0:this._nativeConvolverNode.buffer.duration)}get normalize(){return this._nativeConvolverNode.normalize}set normalize(t){this._nativeConvolverNode.normalize=t}},XK=(t,e,n)=>()=>{const s=new WeakMap,i=async(i,r)=>{let o=e(i);const a=mH(o,r);if(!a){const e={buffer:o.buffer,channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,disableNormalization:!o.normalize};o=t(r,e)}return s.set(r,o),KH(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o};return{render(t,e){const n=s.get(e);return void 0!==n?Promise.resolve(n):i(t,e)}}},QK=(t,e)=>(n,s,i)=>{if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");try{return new e(n,s,i)}catch(x6){if("SyntaxError"===x6.name)throw t();throw x6}},YK=()=>new DOMException("","DataCloneError"),ZK=t=>{const{port1:e,port2:n}=new MessageChannel;return new Promise((s=>{const i=()=>{n.onmessage=null,e.close(),n.close(),s()};n.onmessage=()=>i();try{e.postMessage(t,[t])}catch{}finally{i()}}))},JK=(t,e,n,s,i,r,o,a,u,c,l)=>(h,p)=>{const d=o(h)?h:r(h);if(i.has(p)){const t=n();return Promise.reject(t)}try{i.add(p)}catch{}return e(u,(()=>u(d)))?d.decodeAudioData(p).then((n=>(ZK(p).catch((()=>{})),e(a,(()=>a(n)))||l(n),t.add(n),n))):new Promise(((e,n)=>{const i=async()=>{try{await ZK(p)}catch{}},r=t=>{n(t),i()};try{d.decodeAudioData(p,(n=>{"function"!==typeof n.copyFromChannel&&(c(n),vH(n)),t.add(n),i().then((()=>e(n)))}),(t=>{r(null===t?s():t)}))}catch(x6){r(x6)}}))},tX=(t,e,n,s,i,r,o,a)=>(u,c)=>{const l=e.get(u);if(void 0===l)throw new Error("Missing the expected cycle count.");const h=r(u.context),p=a(h);if(l===c){if(e.delete(u),!p&&o(u)){const e=s(u),{outputs:r}=n(u);for(const n of r)if(jH(n)){const i=s(n[0]);t(e,i,n[1],n[2])}else{const t=i(n[0]);e.connect(t,n[1])}}}else e.set(u,l-c)},eX={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",delayTime:0,maxDelayTime:1},nX=(t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const u=i(t),c={...eX,...a},l=s(u,c),h=r(u),p=h?n(c.maxDelayTime):null;super(t,!1,l,p),this._delayTime=e(this,h,l.delayTime),o(this,c.maxDelayTime)}get delayTime(){return this._delayTime}},sX=(t,e,n,s,i)=>r=>{const o=new WeakMap,a=async(a,u)=>{let c=n(a);const l=mH(c,u);if(!l){const t={channelCount:c.channelCount,channelCountMode:c.channelCountMode,channelInterpretation:c.channelInterpretation,delayTime:c.delayTime.value,maxDelayTime:r};c=e(u,t)}return o.set(u,c),l?await t(u,a.delayTime,c.delayTime):await s(u,a.delayTime,c.delayTime),await i(a,u,c),c};return{render(t,e){const n=o.get(e);return void 0!==n?Promise.resolve(n):a(t,e)}}},iX=t=>(e,n,s,i)=>t(e[i],(t=>t[0]===n&&t[1]===s)),rX=t=>(e,n)=>{t(e).delete(n)},oX=t=>"delayTime"in t,aX=(t,e,n)=>function s(i,r){const o=WH(r)?r:n(t,r);if(oX(o))return[];if(i[0]===o)return[i];if(i.includes(o))return[];const{outputs:a}=e(o);return Array.from(a).map((t=>s([...i,o],t[0]))).reduce(((t,e)=>t.concat(e)),[])},uX=(t,e,n)=>{const s=e[n];if(void 0===s)throw t();return s},cX=t=>(e,n=void 0,s=void 0,i=0)=>void 0===n?e.forEach((t=>t.disconnect())):"number"===typeof n?uX(t,e,n).disconnect():aK(n)?void 0===s?e.forEach((t=>t.disconnect(n))):void 0===i?uX(t,e,s).disconnect(n,0):uX(t,e,s).disconnect(n,0,i):void 0===s?e.forEach((t=>t.disconnect(n))):uX(t,e,s).disconnect(n,0),lX={attack:.003,channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",knee:30,ratio:12,release:.25,threshold:-24},hX=(t,e,n,s,i,r,o,a)=>class extends t{constructor(t,i){const u=r(t),c={...lX,...i},l=s(u,c),h=o(u),p=h?n():null;super(t,!1,l,p),this._attack=e(this,h,l.attack),this._knee=e(this,h,l.knee),this._nativeDynamicsCompressorNode=l,this._ratio=e(this,h,l.ratio),this._release=e(this,h,l.release),this._threshold=e(this,h,l.threshold),a(this,.006)}get attack(){return this._attack}get channelCount(){return this._nativeDynamicsCompressorNode.channelCount}set channelCount(t){const e=this._nativeDynamicsCompressorNode.channelCount;if(this._nativeDynamicsCompressorNode.channelCount=t,t>2)throw this._nativeDynamicsCompressorNode.channelCount=e,i()}get channelCountMode(){return this._nativeDynamicsCompressorNode.channelCountMode}set channelCountMode(t){const e=this._nativeDynamicsCompressorNode.channelCountMode;if(this._nativeDynamicsCompressorNode.channelCountMode=t,"max"===t)throw this._nativeDynamicsCompressorNode.channelCountMode=e,i()}get knee(){return this._knee}get ratio(){return this._ratio}get reduction(){return"number"===typeof this._nativeDynamicsCompressorNode.reduction.value?this._nativeDynamicsCompressorNode.reduction.value:this._nativeDynamicsCompressorNode.reduction}get release(){return this._release}get threshold(){return this._threshold}},pX=(t,e,n,s,i)=>()=>{const r=new WeakMap,o=async(o,a)=>{let u=n(o);const c=mH(u,a);if(!c){const t={attack:u.attack.value,channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,knee:u.knee.value,ratio:u.ratio.value,release:u.release.value,threshold:u.threshold.value};u=e(a,t)}return r.set(a,u),c?(await t(a,o.attack,u.attack),await t(a,o.knee,u.knee),await t(a,o.ratio,u.ratio),await t(a,o.release,u.release),await t(a,o.threshold,u.threshold)):(await s(a,o.attack,u.attack),await s(a,o.knee,u.knee),await s(a,o.ratio,u.ratio),await s(a,o.release,u.release),await s(a,o.threshold,u.threshold)),await i(o,a,u),u};return{render(t,e){const n=r.get(e);return void 0!==n?Promise.resolve(n):o(t,e)}}},dX=()=>new DOMException("","EncodingError"),fX=t=>e=>new Promise(((n,s)=>{if(null===t)return void s(new SyntaxError);const i=t.document.head;if(null===i)s(new SyntaxError);else{const r=t.document.createElement("script"),o=new Blob([e],{type:"application/javascript"}),a=URL.createObjectURL(o),u=t.onerror,c=()=>{t.onerror=u,URL.revokeObjectURL(a)};t.onerror=(e,n,i,r,o)=>n===a||n===t.location.href&&1===i&&1===r?(c(),s(o),!1):null!==u?u(e,n,i,r,o):void 0,r.onerror=()=>{c(),s(new SyntaxError)},r.onload=()=>{c(),n()},r.src=a,r.type="module",i.appendChild(r)}})),mX=t=>class{constructor(t){this._nativeEventTarget=t,this._listeners=new WeakMap}addEventListener(e,n,s){if(null!==n){let i=this._listeners.get(n);void 0===i&&(i=t(this,n),"function"===typeof n&&this._listeners.set(n,i)),this._nativeEventTarget.addEventListener(e,i,s)}}dispatchEvent(t){return this._nativeEventTarget.dispatchEvent(t)}removeEventListener(t,e,n){const s=null===e?void 0:this._listeners.get(e);this._nativeEventTarget.removeEventListener(t,void 0===s?null:s,n)}},gX=t=>(e,n,s)=>{Object.defineProperties(t,{currentFrame:{configurable:!0,get(){return Math.round(e*n)}},currentTime:{configurable:!0,get(){return e}}});try{return s()}finally{null!==t&&(delete t.currentFrame,delete t.currentTime)}},yX=t=>async e=>{try{const t=await fetch(e);if(t.ok)return[await t.text(),t.url]}catch{}throw t()},bX={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",gain:1},vX=(t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),u={...bX,...o},c=s(a,u),l=r(a),h=l?n():null;super(t,!1,c,h),this._gain=e(this,l,c.gain,kH,_H)}get gain(){return this._gain}},wX=(t,e,n,s,i)=>()=>{const r=new WeakMap,o=async(o,a)=>{let u=n(o);const c=mH(u,a);if(!c){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,gain:u.gain.value};u=e(a,t)}return r.set(a,u),c?await t(a,o.gain,u.gain):await s(a,o.gain,u.gain),await i(o,a,u),u};return{render(t,e){const n=r.get(e);return void 0!==n?Promise.resolve(n):o(t,e)}}},xX=(t,e)=>n=>e(t,n),_X=t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioNode in the audio graph.");return n.renderer},kX=t=>e=>{var n;return null!==(n=t.get(e))&&void 0!==n?n:0},SX=t=>e=>{const n=t(e);if(null===n.renderer)throw new Error("Missing the renderer of the given AudioParam in the audio graph.");return n.renderer},TX=t=>e=>t.get(e),IX=()=>new DOMException("","InvalidStateError"),CX=t=>e=>{const n=t.get(e);if(void 0===n)throw IX();return n},AX=(t,e)=>n=>{let s=t.get(n);if(void 0!==s)return s;if(null===e)throw new Error("Missing the native OfflineAudioContext constructor.");return s=new e(1,1,44100),t.set(n,s),s},NX=t=>e=>{const n=t.get(e);if(void 0===n)throw new Error("The context has no set of AudioWorkletNodes.");return n},EX=()=>new DOMException("","InvalidAccessError"),OX=t=>{t.getFrequencyResponse=(e=>(n,s,i)=>{if(n.length!==s.length||s.length!==i.length)throw EX();return e.call(t,n,s,i)})(t.getFrequencyResponse)},$X={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers"},RX=(t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=s(t),u=i(a),c={...$X,...o},l=e(a,u?null:t.baseLatency,c),h=u?n(c.feedback,c.feedforward):null;super(t,!1,l,h),OX(l),this._nativeIIRFilterNode=l,r(this,1)}getFrequencyResponse(t,e,n){return this._nativeIIRFilterNode.getFrequencyResponse(t,e,n)}},DX=(t,e,n,s,i,r,o,a,u,c,l)=>{const h=c.length;let p=a;for(let d=0;d<h;d+=1){let a=n[0]*c[d];for(let e=1;e<i;e+=1){const s=p-e&u-1;a+=n[e]*r[s],a-=t[e]*o[s]}for(let t=i;t<s;t+=1)a+=n[t]*r[p-t&u-1];for(let n=i;n<e;n+=1)a-=t[n]*o[p-n&u-1];r[p]=c[d],o[p]=a,p=p+1&u-1,l[d]=a}return p},MX=(t,e,n,s)=>{const i=n instanceof Float64Array?n:new Float64Array(n),r=s instanceof Float64Array?s:new Float64Array(s),o=i.length,a=r.length,u=Math.min(o,a);if(1!==i[0]){for(let t=0;t<o;t+=1)r[t]/=i[0];for(let t=1;t<a;t+=1)i[t]/=i[0]}const c=32,l=new Float32Array(c),h=new Float32Array(c),p=e.createBuffer(t.numberOfChannels,t.length,t.sampleRate),d=t.numberOfChannels;for(let f=0;f<d;f+=1){const e=t.getChannelData(f),n=p.getChannelData(f);l.fill(0),h.fill(0),DX(i,o,r,a,u,l,h,0,c,e,n)}return p},PX=(t,e,n,s,i)=>(r,o)=>{const a=new WeakMap;let u=null;const c=async(c,l)=>{let h=null,p=e(c);const d=mH(p,l);if(void 0===l.createIIRFilter?h=t(l,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}):d||(p=l.createIIRFilter(o,r)),a.set(l,null===h?p:h),null!==h){if(null===u){if(null===n)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new n(c.context.destination.channelCount,c.context.length,l.sampleRate);u=(async()=>{await s(c,t,t.destination);const e=await i(t);return MX(e,l,r,o)})()}const t=await u;return h.buffer=t,h.start(0),h}return await s(c,l,p),p};return{render(t,e){const n=a.get(e);return void 0!==n?Promise.resolve(n):c(t,e)}}},FX=(t,e,n,s,i,r)=>o=>(a,u)=>{const c=t.get(a);if(void 0===c){if(!o&&r(a)){const t=s(a),{outputs:r}=n(a);for(const n of r)if(jH(n)){const i=s(n[0]);e(t,i,n[1],n[2])}else{const e=i(n[0]);t.disconnect(e,n[1])}}t.set(a,u)}else t.set(a,c+u)},LX=(t,e)=>n=>{const s=t.get(n);return e(s)||e(n)},zX=(t,e)=>n=>t.has(n)||e(n),BX=(t,e)=>n=>t.has(n)||e(n),qX=(t,e)=>n=>{const s=t.get(n);return e(s)||e(n)},VX=t=>e=>null!==t&&e instanceof t,WX=t=>e=>null!==t&&"function"===typeof t.AudioNode&&e instanceof t.AudioNode,jX=t=>e=>null!==t&&"function"===typeof t.AudioParam&&e instanceof t.AudioParam,UX=(t,e)=>n=>t(n)||e(n),GX=t=>e=>null!==t&&e instanceof t,HX=t=>null!==t&&t.isSecureContext,KX=async(t,e,n,s,i,r,o,a,u,c,l,h,p,d,f,m)=>{if(t(e,e)&&t(n,n)&&t(i,i)&&t(r,r)&&t(a,a)&&t(u,u)&&t(c,c)&&t(l,l)&&t(h,h)&&t(p,p)&&t(d,d)){const e=await Promise.all([t(s,s),t(o,o),t(f,f),t(m,m)]);return e.every((t=>t))}return!1},XX=(t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw TypeError();super(t,!0,o,null),this._nativeMediaElementAudioSourceNode=o}get mediaElement(){return this._nativeMediaElementAudioSourceNode.mediaElement}},QX={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers"},YX=(t,e,n,s)=>class extends t{constructor(t,i){const r=n(t);if(s(r))throw new TypeError;const o={...QX,...i},a=e(r,o);super(t,!1,a,null),this._nativeMediaStreamAudioDestinationNode=a}get stream(){return this._nativeMediaStreamAudioDestinationNode.stream}},ZX=(t,e,n,s)=>class extends t{constructor(t,i){const r=n(t),o=e(r,i);if(s(r))throw new TypeError;super(t,!0,o,null),this._nativeMediaStreamAudioSourceNode=o}get mediaStream(){return this._nativeMediaStreamAudioSourceNode.mediaStream}},JX=(t,e,n)=>class extends t{constructor(t,s){const i=n(t),r=e(i,s);super(t,!0,r,null)}},tQ=(t,e,n,s,i)=>class extends s{constructor(t={}){if(null===i)throw new Error("Missing the native AudioContext constructor.");let s;try{s=new i(t)}catch(x6){if(12===x6.code&&"sampleRate is not in range"===x6.message)throw e();throw x6}if(null===s)throw n();if(!LH(t.latencyHint))throw new TypeError(`The provided value '${t.latencyHint}' is not a valid enum value of type AudioContextLatencyCategory.`);if(void 0!==t.sampleRate&&s.sampleRate!==t.sampleRate)throw e();super(s,2);const{latencyHint:r}=t,{sampleRate:o}=s;if(this._baseLatency="number"===typeof s.baseLatency?s.baseLatency:"balanced"===r?512/o:"interactive"===r||void 0===r?256/o:"playback"===r?1024/o:128*Math.max(2,Math.min(128,Math.round(r*o/128)))/o,this._nativeAudioContext=s,"webkitAudioContext"===i.name?(this._nativeGainNode=s.createGain(),this._nativeOscillatorNode=s.createOscillator(),this._nativeGainNode.gain.value=1e-37,this._nativeOscillatorNode.connect(this._nativeGainNode).connect(s.destination),this._nativeOscillatorNode.start()):(this._nativeGainNode=null,this._nativeOscillatorNode=null),this._state=null,"running"===s.state){this._state="suspended";const t=()=>{"suspended"===this._state&&(this._state=null),s.removeEventListener("statechange",t)};s.addEventListener("statechange",t)}}get baseLatency(){return this._baseLatency}get state(){return null!==this._state?this._state:this._nativeAudioContext.state}close(){return"closed"===this.state?this._nativeAudioContext.close().then((()=>{throw t()})):("suspended"===this._state&&(this._state=null),this._nativeAudioContext.close().then((()=>{null!==this._nativeGainNode&&null!==this._nativeOscillatorNode&&(this._nativeOscillatorNode.stop(),this._nativeGainNode.disconnect(),this._nativeOscillatorNode.disconnect()),FH(this)})))}resume(){return"suspended"===this._state?new Promise(((t,e)=>{const n=()=>{this._nativeAudioContext.removeEventListener("statechange",n),"running"===this._nativeAudioContext.state?t():this.resume().then(t,e)};this._nativeAudioContext.addEventListener("statechange",n)})):this._nativeAudioContext.resume().catch((e=>{if(void 0===e||15===e.code)throw t();throw e}))}suspend(){return this._nativeAudioContext.suspend().catch((e=>{if(void 0===e)throw t();throw e}))}},eQ=(t,e,n,s,i,r)=>class extends n{constructor(n,r){super(n),this._nativeContext=n,WG.set(this,n),s(n)&&i.set(n,new Set),this._destination=new t(this,r),this._listener=e(this,n),this._onstatechange=null}get currentTime(){return this._nativeContext.currentTime}get destination(){return this._destination}get listener(){return this._listener}get onstatechange(){return this._onstatechange}set onstatechange(t){const e="function"===typeof t?r(this,t):null;this._nativeContext.onstatechange=e;const n=this._nativeContext.onstatechange;this._onstatechange=null!==n&&n===e?t:n}get sampleRate(){return this._nativeContext.sampleRate}get state(){return this._nativeContext.state}},nQ=t=>{const e=new Uint32Array([1179011410,40,1163280727,544501094,16,131073,44100,176400,1048580,1635017060,4,0]);try{const n=t.decodeAudioData(e.buffer,(()=>{}));return void 0!==n&&(n.catch((()=>{})),!0)}catch{}return!1},sQ={numberOfChannels:1},iQ=(t,e,n,s,i)=>class extends s{constructor(e){const{length:s,numberOfChannels:i,sampleRate:r}={...sQ,...e},o=n(i,s,r);t(nQ,(()=>nQ(o)))||o.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(o.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(o,i),this._length=s,this._nativeOfflineAudioContext=o,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(e()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,FH(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}},rQ=(t,e)=>(n,s,i)=>{const r=new Set;return n.connect=(i=>(o,a=0,u=0)=>{const c=0===r.size;if(e(o))return i.call(n,o,a,u),t(r,[o,a,u],(t=>t[0]===o&&t[1]===a&&t[2]===u),!0),c&&s(),o;i.call(n,o,a),t(r,[o,a],(t=>t[0]===o&&t[1]===a),!0),c&&s()})(n.connect),n.disconnect=(t=>(s,o,a)=>{const u=r.size>0;if(void 0===s)t.apply(n),r.clear();else if("number"===typeof s){t.call(n,s);for(const t of r)t[1]===s&&r.delete(t)}else{e(s)?t.call(n,s,o,a):t.call(n,s,o);for(const t of r)t[0]!==s||void 0!==o&&t[1]!==o||void 0!==a&&t[2]!==a||r.delete(t)}const c=0===r.size;u&&c&&i()})(n.disconnect),n},oQ=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n]&&(t[n]=s)},aQ=(t,e)=>{oQ(t,e,"channelCount"),oQ(t,e,"channelCountMode"),oQ(t,e,"channelInterpretation")},uQ=t=>"function"===typeof t.getFloatTimeDomainData,cQ=t=>{t.getFloatTimeDomainData=e=>{const n=new Uint8Array(e.length);t.getByteTimeDomainData(n);const s=Math.max(n.length,t.fftSize);for(let t=0;t<s;t+=1)e[t]=.0078125*(n[t]-128);return e}},lQ=(t,e)=>(n,s)=>{const i=n.createAnalyser();if(aQ(i,s),!(s.maxDecibels>s.minDecibels))throw e();return oQ(i,s,"fftSize"),oQ(i,s,"maxDecibels"),oQ(i,s,"minDecibels"),oQ(i,s,"smoothingTimeConstant"),t(uQ,(()=>uQ(i)))||cQ(i),i},hQ=t=>null===t?null:t.hasOwnProperty("AudioBuffer")?t.AudioBuffer:null,pQ=(t,e,n)=>{const s=e[n];void 0!==s&&s!==t[n].value&&(t[n].value=s)},dQ=t=>{t.start=(e=>{let n=!1;return(s=0,i=0,r)=>{if(n)throw IX();e.call(t,s,i,r),n=!0}})(t.start)},fQ=t=>{t.start=(e=>(n=0,s=0,i)=>{if("number"===typeof i&&i<0||s<0||n<0)throw new RangeError("The parameters can't be negative.");e.call(t,n,s,i)})(t.start)},mQ=t=>{t.stop=(e=>(n=0)=>{if(n<0)throw new RangeError("The parameter can't be negative.");e.call(t,n)})(t.stop)},gQ=(t,e,n,s,i,r,o,a,u,c,l)=>(h,p)=>{const d=h.createBufferSource();return aQ(d,p),pQ(d,p,"playbackRate"),oQ(d,p,"buffer"),oQ(d,p,"loop"),oQ(d,p,"loopEnd"),oQ(d,p,"loopStart"),e(n,(()=>n(h)))||dQ(d),e(s,(()=>s(h)))||u(d),e(i,(()=>i(h)))||c(d,h),e(r,(()=>r(h)))||fQ(d),e(o,(()=>o(h)))||l(d,h),e(a,(()=>a(h)))||mQ(d),t(h,d),d},yQ=t=>null===t?null:t.hasOwnProperty("AudioContext")?t.AudioContext:t.hasOwnProperty("webkitAudioContext")?t.webkitAudioContext:null,bQ=(t,e)=>(n,s,i)=>{const r=n.destination;if(r.channelCount!==s)try{r.channelCount=s}catch{}i&&"explicit"!==r.channelCountMode&&(r.channelCountMode="explicit"),0===r.maxChannelCount&&Object.defineProperty(r,"maxChannelCount",{value:s});const o=t(n,{channelCount:s,channelCountMode:r.channelCountMode,channelInterpretation:r.channelInterpretation,gain:1});return e(o,"channelCount",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e);try{r.channelCount=e}catch(x6){if(e>r.maxChannelCount)throw x6}})),e(o,"channelCountMode",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelCountMode=e})),e(o,"channelInterpretation",(t=>()=>t.call(o)),(t=>e=>{t.call(o,e),r.channelInterpretation=e})),Object.defineProperty(o,"maxChannelCount",{get:()=>r.maxChannelCount}),o.connect(r),o},vQ=t=>null===t?null:t.hasOwnProperty("AudioWorkletNode")?t.AudioWorkletNode:null,wQ=t=>{const{port1:e}=new MessageChannel;try{e.postMessage(t)}finally{e.close()}},xQ=(t,e,n,s,i)=>(r,o,a,u,c,l)=>{if(null!==a)try{const e=new a(r,u,l),s=new Map;let o=null;if(Object.defineProperties(e,{channelCount:{get:()=>l.channelCount,set:()=>{throw t()}},channelCountMode:{get:()=>"explicit",set:()=>{throw t()}},onprocessorerror:{get:()=>o,set:t=>{"function"===typeof o&&e.removeEventListener("processorerror",o),o="function"===typeof t?t:null,"function"===typeof o&&e.addEventListener("processorerror",o)}}}),e.addEventListener=(t=>(...n)=>{if("processorerror"===n[0]){const t="function"===typeof n[1]?n[1]:"object"===typeof n[1]&&null!==n[1]&&"function"===typeof n[1].handleEvent?n[1].handleEvent:null;if(null!==t){const e=s.get(n[1]);void 0!==e?n[1]=e:(n[1]=e=>{"error"===e.type?(Object.defineProperties(e,{type:{value:"processorerror"}}),t(e)):t(new ErrorEvent(n[0],{...e}))},s.set(t,n[1]))}}return t.call(e,"error",n[1],n[2]),t.call(e,...n)})(e.addEventListener),e.removeEventListener=(t=>(...n)=>{if("processorerror"===n[0]){const t=s.get(n[1]);void 0!==t&&(s.delete(n[1]),n[1]=t)}return t.call(e,"error",n[1],n[2]),t.call(e,n[0],n[1],n[2])})(e.removeEventListener),0!==l.numberOfOutputs){const t=n(r,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});e.connect(t).connect(r.destination);const s=()=>t.disconnect(),o=()=>t.connect(r.destination);return i(e,s,o)}return e}catch(x6){if(11===x6.code)throw s();throw x6}if(void 0===c)throw s();return wQ(l),e(r,o,c,l)},_Q=(t,e)=>null===t?512:Math.max(512,Math.min(16384,Math.pow(2,Math.round(Math.log2(t*e))))),kQ=t=>new Promise(((e,n)=>{const{port1:s,port2:i}=new MessageChannel;s.onmessage=({data:t})=>{s.close(),i.close(),e(t)},s.onmessageerror=({data:t})=>{s.close(),i.close(),n(t)},i.postMessage(t)})),SQ=async(t,e)=>{const n=await kQ(e);return new t(n)},TQ=(t,e,n,s)=>{let i=HG.get(t);void 0===i&&(i=new WeakMap,HG.set(t,i));const r=SQ(n,s);return i.set(e,r),r},IQ=(t,e,n,s,i,r,o,a,u,c,l,h,p)=>(d,f,m,g)=>{if(0===g.numberOfInputs&&0===g.numberOfOutputs)throw u();const y=Array.isArray(g.outputChannelCount)?g.outputChannelCount:Array.from(g.outputChannelCount);if(y.some((t=>t<1)))throw u();if(y.length!==g.numberOfOutputs)throw e();if("explicit"!==g.channelCountMode)throw u();const b=g.channelCount*g.numberOfInputs,v=y.reduce(((t,e)=>t+e),0),w=void 0===m.parameterDescriptors?0:m.parameterDescriptors.length;if(b+w>6||v>6)throw u();const x=new MessageChannel,_=[],k=[];for(let t=0;t<g.numberOfInputs;t+=1)_.push(o(d,{channelCount:g.channelCount,channelCountMode:g.channelCountMode,channelInterpretation:g.channelInterpretation,gain:1})),k.push(i(d,{channelCount:g.channelCount,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:g.channelCount}));const S=[];if(void 0!==m.parameterDescriptors)for(const{defaultValue:t,maxValue:e,minValue:n,name:s}of m.parameterDescriptors){const i=r(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:void 0!==g.parameterData[s]?g.parameterData[s]:void 0===t?0:t});Object.defineProperties(i.offset,{defaultValue:{get:()=>void 0===t?0:t},maxValue:{get:()=>void 0===e?kH:e},minValue:{get:()=>void 0===n?_H:n}}),S.push(i)}const T=s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:Math.max(1,b+w)}),I=_Q(f,d.sampleRate),C=a(d,I,b+w,Math.max(1,v)),A=i(d,{channelCount:Math.max(1,v),channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:Math.max(1,v)}),N=[];for(let t=0;t<g.numberOfOutputs;t+=1)N.push(s(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:y[t]}));for(let t=0;t<g.numberOfInputs;t+=1){_[t].connect(k[t]);for(let e=0;e<g.channelCount;e+=1)k[t].connect(T,e,t*g.channelCount+e)}const E=new wK(void 0===m.parameterDescriptors?[]:m.parameterDescriptors.map((({name:t},e)=>{const n=S[e];return n.connect(T,0,b+e),n.start(0),[t,n.offset]})));T.connect(C);let O=g.channelInterpretation,$=null;const R=0===g.numberOfOutputs?[C]:N,D={get bufferSize(){return I},get channelCount(){return g.channelCount},set channelCount(t){throw n()},get channelCountMode(){return g.channelCountMode},set channelCountMode(t){throw n()},get channelInterpretation(){return O},set channelInterpretation(t){for(const e of _)e.channelInterpretation=t;O=t},get context(){return C.context},get inputs(){return _},get numberOfInputs(){return g.numberOfInputs},get numberOfOutputs(){return g.numberOfOutputs},get onprocessorerror(){return $},set onprocessorerror(t){"function"===typeof $&&D.removeEventListener("processorerror",$),$="function"===typeof t?t:null,"function"===typeof $&&D.addEventListener("processorerror",$)},get parameters(){return E},get port(){return x.port2},addEventListener(...t){return C.addEventListener(t[0],t[1],t[2])},connect:t.bind(null,R),disconnect:c.bind(null,R),dispatchEvent(...t){return C.dispatchEvent(t[0])},removeEventListener(...t){return C.removeEventListener(t[0],t[1],t[2])}},M=new Map;x.port1.addEventListener=(t=>(...e)=>{if("message"===e[0]){const t="function"===typeof e[1]?e[1]:"object"===typeof e[1]&&null!==e[1]&&"function"===typeof e[1].handleEvent?e[1].handleEvent:null;if(null!==t){const n=M.get(e[1]);void 0!==n?e[1]=n:(e[1]=e=>{l(d.currentTime,d.sampleRate,(()=>t(e)))},M.set(t,e[1]))}}return t.call(x.port1,e[0],e[1],e[2])})(x.port1.addEventListener),x.port1.removeEventListener=(t=>(...e)=>{if("message"===e[0]){const t=M.get(e[1]);void 0!==t&&(M.delete(e[1]),e[1]=t)}return t.call(x.port1,e[0],e[1],e[2])})(x.port1.removeEventListener);let P=null;Object.defineProperty(x.port1,"onmessage",{get:()=>P,set:t=>{"function"===typeof P&&x.port1.removeEventListener("message",P),P="function"===typeof t?t:null,"function"===typeof P&&(x.port1.addEventListener("message",P),x.port1.start())}}),m.prototype.port=x.port1;let F=null;const L=TQ(d,D,m,g);L.then((t=>F=t));const z=TK(g.numberOfInputs,g.channelCount),B=TK(g.numberOfOutputs,y),q=void 0===m.parameterDescriptors?[]:m.parameterDescriptors.reduce(((t,{name:e})=>({...t,[e]:new Float32Array(128)})),{});let V=!0;const W=()=>{g.numberOfOutputs>0&&C.disconnect(A);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=N[t];for(let s=0;s<y[t];s+=1)A.disconnect(n,e+s,s);e+=y[t]}},j=new Map;C.onaudioprocess=({inputBuffer:t,outputBuffer:e})=>{if(null!==F){const s=h(D);for(let i=0;i<I;i+=128){for(let e=0;e<g.numberOfInputs;e+=1)for(let n=0;n<g.channelCount;n+=1)kK(t,z[e],n,n,i);void 0!==m.parameterDescriptors&&m.parameterDescriptors.forEach((({name:e},n)=>{kK(t,q,e,b+n,i)}));for(let t=0;t<g.numberOfInputs;t+=1)for(let e=0;e<y[t];e+=1)0===B[t][e].byteLength&&(B[t][e]=new Float32Array(128));try{const t=z.map(((t,e)=>{const n=s[e];if(n.size>0)return j.set(e,I/128),t;const i=j.get(e);return void 0===i?[]:(t.every((t=>t.every((t=>0===t))))&&(1===i?j.delete(e):j.set(e,i-1)),t)})),n=l(d.currentTime+i/d.sampleRate,d.sampleRate,(()=>F.process(t,B,q)));V=n;for(let s=0,r=0;s<g.numberOfOutputs;s+=1){for(let t=0;t<y[s];t+=1)SK(e,B[s],t,r+t,i);r+=y[s]}}catch(n){V=!1,D.dispatchEvent(new ErrorEvent("processorerror",{colno:n.colno,filename:n.filename,lineno:n.lineno,message:n.message}))}if(!V){for(let t=0;t<g.numberOfInputs;t+=1){_[t].disconnect(k[t]);for(let e=0;e<g.channelCount;e+=1)k[i].disconnect(T,e,t*g.channelCount+e)}if(void 0!==m.parameterDescriptors){const t=m.parameterDescriptors.length;for(let e=0;e<t;e+=1){const t=S[e];t.disconnect(T,0,b+e),t.stop()}}T.disconnect(C),C.onaudioprocess=null,U?W():K();break}}}};let U=!1;const G=o(d,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0}),H=()=>C.connect(G).connect(d.destination),K=()=>{C.disconnect(G),G.disconnect()},X=()=>{if(V){K(),g.numberOfOutputs>0&&C.connect(A);for(let t=0,e=0;t<g.numberOfOutputs;t+=1){const n=N[t];for(let s=0;s<y[t];s+=1)A.connect(n,e+s,s);e+=y[t]}}U=!0},Q=()=>{V&&(H(),W()),U=!1};return H(),p(D,X,Q)},CQ=(t,e)=>{const n=t.createBiquadFilter();return aQ(n,e),pQ(n,e,"Q"),pQ(n,e,"detune"),pQ(n,e,"frequency"),pQ(n,e,"gain"),oQ(n,e,"type"),n},AQ=(t,e)=>(n,s)=>{const i=n.createChannelMerger(s.numberOfInputs);return null!==t&&"webkitAudioContext"===t.name&&e(n,i),aQ(i,s),i},NQ=t=>{const e=t.numberOfOutputs;Object.defineProperty(t,"channelCount",{get:()=>e,set:t=>{if(t!==e)throw IX()}}),Object.defineProperty(t,"channelCountMode",{get:()=>"explicit",set:t=>{if("explicit"!==t)throw IX()}}),Object.defineProperty(t,"channelInterpretation",{get:()=>"discrete",set:t=>{if("discrete"!==t)throw IX()}})},EQ=(t,e)=>{const n=t.createChannelSplitter(e.numberOfOutputs);return aQ(n,e),NQ(n),n},OQ=(t,e,n,s,i)=>(r,o)=>{if(void 0===r.createConstantSource)return n(r,o);const a=r.createConstantSource();return aQ(a,o),pQ(a,o,"offset"),e(s,(()=>s(r)))||fQ(a),e(i,(()=>i(r)))||mQ(a),t(r,a),a},$Q=(t,e)=>(t.connect=e.connect.bind(e),t.disconnect=e.disconnect.bind(e),t),RQ=(t,e,n,s)=>(i,{offset:r,...o})=>{const a=i.createBuffer(1,2,44100),u=e(i,{buffer:null,channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",loop:!1,loopEnd:0,loopStart:0,playbackRate:1}),c=n(i,{...o,gain:r}),l=a.getChannelData(0);l[0]=1,l[1]=1,u.buffer=a,u.loop=!0;const h={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){c.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){c.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){c.channelInterpretation=t},get context(){return c.context},get inputs(){return[]},get numberOfInputs(){return u.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get offset(){return c.gain},get onended(){return u.onended},set onended(t){u.onended=t},addEventListener(...t){return u.addEventListener(t[0],t[1],t[2])},dispatchEvent(...t){return u.dispatchEvent(t[0])},removeEventListener(...t){return u.removeEventListener(t[0],t[1],t[2])},start(t=0){u.start.call(u,t)},stop(t=0){u.stop.call(u,t)}},p=()=>u.connect(c),d=()=>u.disconnect(c);return t(i,u),s($Q(h,c),p,d)},DQ=(t,e)=>(n,s)=>{const i=n.createConvolver();if(aQ(i,s),s.disableNormalization===i.normalize&&(i.normalize=!s.disableNormalization),oQ(i,s,"buffer"),s.channelCount>2)throw t();if(e(i,"channelCount",(t=>()=>t.call(i)),(e=>n=>{if(n>2)throw t();return e.call(i,n)})),"max"===s.channelCountMode)throw t();return e(i,"channelCountMode",(t=>()=>t.call(i)),(e=>n=>{if("max"===n)throw t();return e.call(i,n)})),i},MQ=(t,e)=>{const n=t.createDelay(e.maxDelayTime);return aQ(n,e),pQ(n,e,"delayTime"),n},PQ=t=>(e,n)=>{const s=e.createDynamicsCompressor();if(aQ(s,n),n.channelCount>2)throw t();if("max"===n.channelCountMode)throw t();return pQ(s,n,"attack"),pQ(s,n,"knee"),pQ(s,n,"ratio"),pQ(s,n,"release"),pQ(s,n,"threshold"),s},FQ=(t,e)=>{const n=t.createGain();return aQ(n,e),pQ(n,e,"gain"),n},LQ=t=>(e,n,s)=>{if(void 0===e.createIIRFilter)return t(e,n,s);const i=e.createIIRFilter(s.feedforward,s.feedback);return aQ(i,s),i};function zQ(t,e){const n=e[0]*e[0]+e[1]*e[1];return[(t[0]*e[0]+t[1]*e[1])/n,(t[1]*e[0]-t[0]*e[1])/n]}function BQ(t,e){return[t[0]*e[0]-t[1]*e[1],t[0]*e[1]+t[1]*e[0]]}function qQ(t,e){let n=[0,0];for(let s=t.length-1;s>=0;s-=1)n=BQ(n,e),n[0]+=t[s];return n}const VQ=(t,e,n,s)=>(i,r,{channelCount:o,channelCountMode:a,channelInterpretation:u,feedback:c,feedforward:l})=>{const h=_Q(r,i.sampleRate),p=c instanceof Float64Array?c:new Float64Array(c),d=l instanceof Float64Array?l:new Float64Array(l),f=p.length,m=d.length,g=Math.min(f,m);if(0===f||f>20)throw s();if(0===p[0])throw e();if(0===m||m>20)throw s();if(0===d[0])throw e();if(1!==p[0]){for(let t=0;t<m;t+=1)d[t]/=p[0];for(let t=1;t<f;t+=1)p[t]/=p[0]}const y=n(i,h,o,o);y.channelCount=o,y.channelCountMode=a,y.channelInterpretation=u;const b=32,v=[],w=[],x=[];for(let t=0;t<o;t+=1){v.push(0);const t=new Float32Array(b),e=new Float32Array(b);t.fill(0),e.fill(0),w.push(t),x.push(e)}y.onaudioprocess=t=>{const e=t.inputBuffer,n=t.outputBuffer,s=e.numberOfChannels;for(let i=0;i<s;i+=1){const t=e.getChannelData(i),s=n.getChannelData(i);v[i]=DX(p,f,d,m,g,w[i],x[i],v[i],b,t,s)}};const _=i.sampleRate/2,k={get bufferSize(){return h},get channelCount(){return y.channelCount},set channelCount(t){y.channelCount=t},get channelCountMode(){return y.channelCountMode},set channelCountMode(t){y.channelCountMode=t},get channelInterpretation(){return y.channelInterpretation},set channelInterpretation(t){y.channelInterpretation=t},get context(){return y.context},get inputs(){return[y]},get numberOfInputs(){return y.numberOfInputs},get numberOfOutputs(){return y.numberOfOutputs},addEventListener(...t){return y.addEventListener(t[0],t[1],t[2])},dispatchEvent(...t){return y.dispatchEvent(t[0])},getFrequencyResponse(e,n,s){if(e.length!==n.length||n.length!==s.length)throw t();const i=e.length;for(let t=0;t<i;t+=1){const i=-Math.PI*(e[t]/_),r=[Math.cos(i),Math.sin(i)],o=qQ(d,r),a=qQ(p,r),u=zQ(o,a);n[t]=Math.sqrt(u[0]*u[0]+u[1]*u[1]),s[t]=Math.atan2(u[1],u[0])}},removeEventListener(...t){return y.removeEventListener(t[0],t[1],t[2])}};return $Q(k,y)},WQ=(t,e)=>t.createMediaElementSource(e.mediaElement),jQ=(t,e)=>{const n=t.createMediaStreamDestination();return aQ(n,e),1===n.numberOfOutputs&&Object.defineProperty(n,"numberOfOutputs",{get:()=>0}),n},UQ=(t,{mediaStream:e})=>{const n=e.getAudioTracks();n.sort(((t,e)=>t.id<e.id?-1:t.id>e.id?1:0));const s=n.slice(0,1),i=t.createMediaStreamSource(new MediaStream(s));return Object.defineProperty(i,"mediaStream",{value:e}),i},GQ=(t,e)=>(n,{mediaStreamTrack:s})=>{if("function"===typeof n.createMediaStreamTrackSource)return n.createMediaStreamTrackSource(s);const i=new MediaStream([s]),r=n.createMediaStreamSource(i);if("audio"!==s.kind)throw t();if(e(n))throw new TypeError;return r},HQ=t=>null===t?null:t.hasOwnProperty("OfflineAudioContext")?t.OfflineAudioContext:t.hasOwnProperty("webkitOfflineAudioContext")?t.webkitOfflineAudioContext:null,KQ=(t,e,n,s,i,r)=>(o,a)=>{const u=o.createOscillator();return aQ(u,a),pQ(u,a,"detune"),pQ(u,a,"frequency"),void 0!==a.periodicWave?u.setPeriodicWave(a.periodicWave):oQ(u,a,"type"),e(n,(()=>n(o)))||fQ(u),e(s,(()=>s(o)))||r(u,o),e(i,(()=>i(o)))||mQ(u),t(o,u),u},XQ=t=>(e,n)=>{const s=e.createPanner();return void 0===s.orientationX?t(e,n):(aQ(s,n),pQ(s,n,"orientationX"),pQ(s,n,"orientationY"),pQ(s,n,"orientationZ"),pQ(s,n,"positionX"),pQ(s,n,"positionY"),pQ(s,n,"positionZ"),oQ(s,n,"coneInnerAngle"),oQ(s,n,"coneOuterAngle"),oQ(s,n,"coneOuterGain"),oQ(s,n,"distanceModel"),oQ(s,n,"maxDistance"),oQ(s,n,"panningModel"),oQ(s,n,"refDistance"),oQ(s,n,"rolloffFactor"),s)},QQ=(t,e,n,s,i,r,o,a,u,c)=>(l,{coneInnerAngle:h,coneOuterAngle:p,coneOuterGain:d,distanceModel:f,maxDistance:m,orientationX:g,orientationY:y,orientationZ:b,panningModel:v,positionX:w,positionY:x,positionZ:_,refDistance:k,rolloffFactor:S,...T})=>{const I=l.createPanner();if(T.channelCount>2)throw o();if("max"===T.channelCountMode)throw o();aQ(I,T);const C={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},A=n(l,{...C,channelInterpretation:"speakers",numberOfInputs:6}),N=s(l,{...T,gain:1}),E=s(l,{...C,gain:1}),O=s(l,{...C,gain:0}),$=s(l,{...C,gain:0}),R=s(l,{...C,gain:0}),D=s(l,{...C,gain:0}),M=s(l,{...C,gain:0}),P=i(l,256,6,1),F=r(l,{...C,curve:new Float32Array([1,1]),oversample:"none"});let L=[g,y,b],z=[w,x,_];const B=new Float32Array(1);P.onaudioprocess=({inputBuffer:t})=>{const e=[u(t,B,0),u(t,B,1),u(t,B,2)];e.some(((t,e)=>t!==L[e]))&&(I.setOrientation(...e),L=e);const n=[u(t,B,3),u(t,B,4),u(t,B,5)];n.some(((t,e)=>t!==z[e]))&&(I.setPosition(...n),z=n)},Object.defineProperty(O.gain,"defaultValue",{get:()=>0}),Object.defineProperty($.gain,"defaultValue",{get:()=>0}),Object.defineProperty(R.gain,"defaultValue",{get:()=>0}),Object.defineProperty(D.gain,"defaultValue",{get:()=>0}),Object.defineProperty(M.gain,"defaultValue",{get:()=>0});const q={get bufferSize(){},get channelCount(){return I.channelCount},set channelCount(t){if(t>2)throw o();N.channelCount=t,I.channelCount=t},get channelCountMode(){return I.channelCountMode},set channelCountMode(t){if("max"===t)throw o();N.channelCountMode=t,I.channelCountMode=t},get channelInterpretation(){return I.channelInterpretation},set channelInterpretation(t){N.channelInterpretation=t,I.channelInterpretation=t},get coneInnerAngle(){return I.coneInnerAngle},set coneInnerAngle(t){I.coneInnerAngle=t},get coneOuterAngle(){return I.coneOuterAngle},set coneOuterAngle(t){I.coneOuterAngle=t},get coneOuterGain(){return I.coneOuterGain},set coneOuterGain(t){if(t<0||t>1)throw e();I.coneOuterGain=t},get context(){return I.context},get distanceModel(){return I.distanceModel},set distanceModel(t){I.distanceModel=t},get inputs(){return[N]},get maxDistance(){return I.maxDistance},set maxDistance(t){if(t<0)throw new RangeError;I.maxDistance=t},get numberOfInputs(){return I.numberOfInputs},get numberOfOutputs(){return I.numberOfOutputs},get orientationX(){return E.gain},get orientationY(){return O.gain},get orientationZ(){return $.gain},get panningModel(){return I.panningModel},set panningModel(t){I.panningModel=t},get positionX(){return R.gain},get positionY(){return D.gain},get positionZ(){return M.gain},get refDistance(){return I.refDistance},set refDistance(t){if(t<0)throw new RangeError;I.refDistance=t},get rolloffFactor(){return I.rolloffFactor},set rolloffFactor(t){if(t<0)throw new RangeError;I.rolloffFactor=t},addEventListener(...t){return N.addEventListener(t[0],t[1],t[2])},dispatchEvent(...t){return N.dispatchEvent(t[0])},removeEventListener(...t){return N.removeEventListener(t[0],t[1],t[2])}};h!==q.coneInnerAngle&&(q.coneInnerAngle=h),p!==q.coneOuterAngle&&(q.coneOuterAngle=p),d!==q.coneOuterGain&&(q.coneOuterGain=d),f!==q.distanceModel&&(q.distanceModel=f),m!==q.maxDistance&&(q.maxDistance=m),g!==q.orientationX.value&&(q.orientationX.value=g),y!==q.orientationY.value&&(q.orientationY.value=y),b!==q.orientationZ.value&&(q.orientationZ.value=b),v!==q.panningModel&&(q.panningModel=v),w!==q.positionX.value&&(q.positionX.value=w),x!==q.positionY.value&&(q.positionY.value=x),_!==q.positionZ.value&&(q.positionZ.value=_),k!==q.refDistance&&(q.refDistance=k),S!==q.rolloffFactor&&(q.rolloffFactor=S),1===L[0]&&0===L[1]&&0===L[2]||I.setOrientation(...L),0===z[0]&&0===z[1]&&0===z[2]||I.setPosition(...z);const V=()=>{N.connect(I),t(N,F,0,0),F.connect(E).connect(A,0,0),F.connect(O).connect(A,0,1),F.connect($).connect(A,0,2),F.connect(R).connect(A,0,3),F.connect(D).connect(A,0,4),F.connect(M).connect(A,0,5),A.connect(P).connect(l.destination)},W=()=>{N.disconnect(I),a(N,F,0,0),F.disconnect(E),E.disconnect(A),F.disconnect(O),O.disconnect(A),F.disconnect($),$.disconnect(A),F.disconnect(R),R.disconnect(A),F.disconnect(D),D.disconnect(A),F.disconnect(M),M.disconnect(A),A.disconnect(P),P.disconnect(l.destination)};return c($Q(q,I),V,W)},YQ=t=>(e,{disableNormalization:n,imag:s,real:i})=>{const r=s instanceof Float32Array?s:new Float32Array(s),o=i instanceof Float32Array?i:new Float32Array(i),a=e.createPeriodicWave(o,r,{disableNormalization:n});if(Array.from(s).length<2)throw t();return a},ZQ=(t,e,n,s)=>t.createScriptProcessor(e,n,s),JQ=(t,e)=>(n,s)=>{const i=s.channelCountMode;if("clamped-max"===i)throw e();if(void 0===n.createStereoPanner)return t(n,s);const r=n.createStereoPanner();return aQ(r,s),pQ(r,s,"pan"),Object.defineProperty(r,"channelCountMode",{get:()=>i,set:t=>{if(t!==i)throw e()}}),r},tY=(t,e,n,s,i,r)=>{const o=16385,a=new Float32Array([1,1]),u=Math.PI/2,c={channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete"},l={...c,oversample:"none"},h=(t,e,i,r)=>{const h=new Float32Array(o),p=new Float32Array(o);for(let n=0;n<o;n+=1){const t=n/(o-1)*u;h[n]=Math.cos(t),p[n]=Math.sin(t)}const d=n(t,{...c,gain:0}),f=s(t,{...l,curve:h}),m=s(t,{...l,curve:a}),g=n(t,{...c,gain:0}),y=s(t,{...l,curve:p});return{connectGraph(){e.connect(d),e.connect(void 0===m.inputs?m:m.inputs[0]),e.connect(g),m.connect(i),i.connect(void 0===f.inputs?f:f.inputs[0]),i.connect(void 0===y.inputs?y:y.inputs[0]),f.connect(d.gain),y.connect(g.gain),d.connect(r,0,0),g.connect(r,0,1)},disconnectGraph(){e.disconnect(d),e.disconnect(void 0===m.inputs?m:m.inputs[0]),e.disconnect(g),m.disconnect(i),i.disconnect(void 0===f.inputs?f:f.inputs[0]),i.disconnect(void 0===y.inputs?y:y.inputs[0]),f.disconnect(d.gain),y.disconnect(g.gain),d.disconnect(r,0,0),g.disconnect(r,0,1)}}},p=(t,i,r,h)=>{const p=new Float32Array(o),d=new Float32Array(o),f=new Float32Array(o),m=new Float32Array(o),g=Math.floor(o/2);for(let e=0;e<o;e+=1)if(e>g){const t=(e-g)/(o-1-g)*u;p[e]=Math.cos(t),d[e]=Math.sin(t),f[e]=0,m[e]=1}else{const t=e/(o-1-g)*u;p[e]=1,d[e]=0,f[e]=Math.cos(t),m[e]=Math.sin(t)}const y=e(t,{channelCount:2,channelCountMode:"explicit",channelInterpretation:"discrete",numberOfOutputs:2}),b=n(t,{...c,gain:0}),v=s(t,{...l,curve:p}),w=n(t,{...c,gain:0}),x=s(t,{...l,curve:d}),_=s(t,{...l,curve:a}),k=n(t,{...c,gain:0}),S=s(t,{...l,curve:f}),T=n(t,{...c,gain:0}),I=s(t,{...l,curve:m});return{connectGraph(){i.connect(y),i.connect(void 0===_.inputs?_:_.inputs[0]),y.connect(b,0),y.connect(w,0),y.connect(k,1),y.connect(T,1),_.connect(r),r.connect(void 0===v.inputs?v:v.inputs[0]),r.connect(void 0===x.inputs?x:x.inputs[0]),r.connect(void 0===S.inputs?S:S.inputs[0]),r.connect(void 0===I.inputs?I:I.inputs[0]),v.connect(b.gain),x.connect(w.gain),S.connect(k.gain),I.connect(T.gain),b.connect(h,0,0),k.connect(h,0,0),w.connect(h,0,1),T.connect(h,0,1)},disconnectGraph(){i.disconnect(y),i.disconnect(void 0===_.inputs?_:_.inputs[0]),y.disconnect(b,0),y.disconnect(w,0),y.disconnect(k,1),y.disconnect(T,1),_.disconnect(r),r.disconnect(void 0===v.inputs?v:v.inputs[0]),r.disconnect(void 0===x.inputs?x:x.inputs[0]),r.disconnect(void 0===S.inputs?S:S.inputs[0]),r.disconnect(void 0===I.inputs?I:I.inputs[0]),v.disconnect(b.gain),x.disconnect(w.gain),S.disconnect(k.gain),I.disconnect(T.gain),b.disconnect(h,0,0),k.disconnect(h,0,0),w.disconnect(h,0,1),T.disconnect(h,0,1)}}},d=(t,e,n,s,r)=>{if(1===e)return h(t,n,s,r);if(2===e)return p(t,n,s,r);throw i()};return(e,{channelCount:s,channelCountMode:o,pan:a,...u})=>{if("max"===o)throw i();const c=t(e,{...u,channelCount:1,channelCountMode:o,numberOfInputs:2}),l=n(e,{...u,channelCount:s,channelCountMode:o,gain:1}),h=n(e,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:a});let{connectGraph:p,disconnectGraph:f}=d(e,s,l,h,c);Object.defineProperty(h.gain,"defaultValue",{get:()=>0}),Object.defineProperty(h.gain,"maxValue",{get:()=>1}),Object.defineProperty(h.gain,"minValue",{get:()=>-1});const m={get bufferSize(){},get channelCount(){return l.channelCount},set channelCount(t){l.channelCount!==t&&(g&&f(),({connectGraph:p,disconnectGraph:f}=d(e,t,l,h,c)),g&&p()),l.channelCount=t},get channelCountMode(){return l.channelCountMode},set channelCountMode(t){if("clamped-max"===t||"max"===t)throw i();l.channelCountMode=t},get channelInterpretation(){return l.channelInterpretation},set channelInterpretation(t){l.channelInterpretation=t},get context(){return l.context},get inputs(){return[l]},get numberOfInputs(){return l.numberOfInputs},get numberOfOutputs(){return l.numberOfOutputs},get pan(){return h.gain},addEventListener(...t){return l.addEventListener(t[0],t[1],t[2])},dispatchEvent(...t){return l.dispatchEvent(t[0])},removeEventListener(...t){return l.removeEventListener(t[0],t[1],t[2])}};let g=!1;const y=()=>{p(),g=!0},b=()=>{f(),g=!1};return r($Q(m,c),y,b)}},eY=(t,e,n,s,i,r,o)=>(a,u)=>{const c=a.createWaveShaper();if(null!==r&&"webkitAudioContext"===r.name&&void 0===a.createGain().gain.automationRate)return n(a,u);aQ(c,u);const l=null===u.curve||u.curve instanceof Float32Array?u.curve:new Float32Array(u.curve);if(null!==l&&l.length<2)throw e();oQ(c,{curve:l},"curve"),oQ(c,u,"oversample");let h=null,p=!1;o(c,"curve",(t=>()=>t.call(c)),(e=>n=>(e.call(c,n),p&&(s(n)&&null===h?h=t(a,c):s(n)||null===h||(h(),h=null)),n)));const d=()=>{p=!0,s(c.curve)&&(h=t(a,c))},f=()=>{p=!1,null!==h&&(h(),h=null)};return i(c,d,f)},nY=(t,e,n,s,i)=>(r,{curve:o,oversample:a,...u})=>{const c=r.createWaveShaper(),l=r.createWaveShaper();aQ(c,u),aQ(l,u);const h=n(r,{...u,gain:1}),p=n(r,{...u,gain:-1}),d=n(r,{...u,gain:1}),f=n(r,{...u,gain:-1});let m=null,g=!1,y=null;const b={get bufferSize(){},get channelCount(){return c.channelCount},set channelCount(t){h.channelCount=t,p.channelCount=t,c.channelCount=t,d.channelCount=t,l.channelCount=t,f.channelCount=t},get channelCountMode(){return c.channelCountMode},set channelCountMode(t){h.channelCountMode=t,p.channelCountMode=t,c.channelCountMode=t,d.channelCountMode=t,l.channelCountMode=t,f.channelCountMode=t},get channelInterpretation(){return c.channelInterpretation},set channelInterpretation(t){h.channelInterpretation=t,p.channelInterpretation=t,c.channelInterpretation=t,d.channelInterpretation=t,l.channelInterpretation=t,f.channelInterpretation=t},get context(){return c.context},get curve(){return y},set curve(n){if(null!==n&&n.length<2)throw e();if(null===n)c.curve=n,l.curve=n;else{const t=n.length,e=new Float32Array(t+2-t%2),s=new Float32Array(t+2-t%2);e[0]=n[0],s[0]=-n[t-1];const i=Math.ceil((t+1)/2),r=(t+1)/2-1;for(let o=1;o<i;o+=1){const a=o/i*r,u=Math.floor(a),c=Math.ceil(a);e[o]=u===c?n[u]:(1-(a-u))*n[u]+(1-(c-a))*n[c],s[o]=u===c?-n[t-1-u]:-(1-(a-u))*n[t-1-u]-(1-(c-a))*n[t-1-c]}e[i]=t%2===1?n[i-1]:(n[i-2]+n[i-1])/2,c.curve=e,l.curve=s}y=n,g&&(s(y)&&null===m?m=t(r,h):null!==m&&(m(),m=null))},get inputs(){return[h]},get numberOfInputs(){return c.numberOfInputs},get numberOfOutputs(){return c.numberOfOutputs},get oversample(){return c.oversample},set oversample(t){c.oversample=t,l.oversample=t},addEventListener(...t){return h.addEventListener(t[0],t[1],t[2])},dispatchEvent(...t){return h.dispatchEvent(t[0])},removeEventListener(...t){return h.removeEventListener(t[0],t[1],t[2])}};null!==o&&(b.curve=o instanceof Float32Array?o:new Float32Array(o)),a!==b.oversample&&(b.oversample=a);const v=()=>{h.connect(c).connect(d),h.connect(p).connect(l).connect(f).connect(d),g=!0,s(y)&&(m=t(r,h))},w=()=>{h.disconnect(c),c.disconnect(d),h.disconnect(p),p.disconnect(l),l.disconnect(f),f.disconnect(d),g=!1,null!==m&&(m(),m=null)};return i($Q(b,d),v,w)},sY=()=>new DOMException("","NotSupportedError"),iY={numberOfChannels:1},rY=(t,e,n,s,i)=>class extends t{constructor(t,n,i){let r;if("number"===typeof t&&void 0!==n&&void 0!==i)r={length:n,numberOfChannels:t,sampleRate:i};else{if("object"!==typeof t)throw new Error("The given parameters are not valid.");r=t}const{length:o,numberOfChannels:a,sampleRate:u}={...iY,...r},c=s(a,o,u);e(nQ,(()=>nQ(c)))||c.addEventListener("statechange",(()=>{let t=0;const e=n=>{"running"===this._state&&(t>0?(c.removeEventListener("statechange",e),n.stopImmediatePropagation(),this._waitForThePromiseToSettle(n)):t+=1)};return e})()),super(c,a),this._length=o,this._nativeOfflineAudioContext=c,this._state=null}get length(){return void 0===this._nativeOfflineAudioContext.length?this._length:this._nativeOfflineAudioContext.length}get state(){return null===this._state?this._nativeOfflineAudioContext.state:this._state}startRendering(){return"running"===this._state?Promise.reject(n()):(this._state="running",i(this.destination,this._nativeOfflineAudioContext).finally((()=>{this._state=null,FH(this)})))}_waitForThePromiseToSettle(t){null===this._state?this._nativeOfflineAudioContext.dispatchEvent(t):setTimeout((()=>this._waitForThePromiseToSettle(t)))}},oY={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",detune:0,frequency:440,periodicWave:void 0,type:"sine"},aY=(t,e,n,s,i,r,o)=>class extends t{constructor(t,o){const a=i(t),u={...oY,...o},c=n(a,u),l=r(a),h=l?s():null,p=t.sampleRate/2;super(t,!1,c,h),this._detune=e(this,l,c.detune,153600,-153600),this._frequency=e(this,l,c.frequency,p,-p),this._nativeOscillatorNode=c,this._onended=null,this._oscillatorNodeRenderer=h,null!==this._oscillatorNodeRenderer&&void 0!==u.periodicWave&&(this._oscillatorNodeRenderer.periodicWave=u.periodicWave)}get detune(){return this._detune}get frequency(){return this._frequency}get onended(){return this._onended}set onended(t){const e="function"===typeof t?o(this,t):null;this._nativeOscillatorNode.onended=e;const n=this._nativeOscillatorNode.onended;this._onended=null!==n&&n===e?t:n}get type(){return this._nativeOscillatorNode.type}set type(t){this._nativeOscillatorNode.type=t,null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=null)}setPeriodicWave(t){this._nativeOscillatorNode.setPeriodicWave(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.periodicWave=t)}start(t=0){if(this._nativeOscillatorNode.start(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.start=t),"closed"!==this.context.state){rH(this);const t=()=>{this._nativeOscillatorNode.removeEventListener("ended",t),SH(this)&&aH(this)};this._nativeOscillatorNode.addEventListener("ended",t)}}stop(t=0){this._nativeOscillatorNode.stop(t),null!==this._oscillatorNodeRenderer&&(this._oscillatorNodeRenderer.stop=t)}},uY=(t,e,n,s,i)=>()=>{const r=new WeakMap;let o=null,a=null,u=null;const c=async(c,l)=>{let h=n(c);const p=mH(h,l);if(!p){const t={channelCount:h.channelCount,channelCountMode:h.channelCountMode,channelInterpretation:h.channelInterpretation,detune:h.detune.value,frequency:h.frequency.value,periodicWave:null===o?void 0:o,type:h.type};h=e(l,t),null!==a&&h.start(a),null!==u&&h.stop(u)}return r.set(l,h),p?(await t(l,c.detune,h.detune),await t(l,c.frequency,h.frequency)):(await s(l,c.detune,h.detune),await s(l,c.frequency,h.frequency)),await i(c,l,h),h};return{set periodicWave(t){o=t},set start(t){a=t},set stop(t){u=t},render(t,e){const n=r.get(e);return void 0!==n?Promise.resolve(n):c(t,e)}}},cY={channelCount:2,channelCountMode:"clamped-max",channelInterpretation:"speakers",coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:1,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1},lY=(t,e,n,s,i,r,o)=>class extends t{constructor(t,a){const u=i(t),c={...cY,...a},l=n(u,c),h=r(u),p=h?s():null;super(t,!1,l,p),this._nativePannerNode=l,this._orientationX=e(this,h,l.orientationX,kH,_H),this._orientationY=e(this,h,l.orientationY,kH,_H),this._orientationZ=e(this,h,l.orientationZ,kH,_H),this._positionX=e(this,h,l.positionX,kH,_H),this._positionY=e(this,h,l.positionY,kH,_H),this._positionZ=e(this,h,l.positionZ,kH,_H),o(this,1)}get coneInnerAngle(){return this._nativePannerNode.coneInnerAngle}set coneInnerAngle(t){this._nativePannerNode.coneInnerAngle=t}get coneOuterAngle(){return this._nativePannerNode.coneOuterAngle}set coneOuterAngle(t){this._nativePannerNode.coneOuterAngle=t}get coneOuterGain(){return this._nativePannerNode.coneOuterGain}set coneOuterGain(t){this._nativePannerNode.coneOuterGain=t}get distanceModel(){return this._nativePannerNode.distanceModel}set distanceModel(t){this._nativePannerNode.distanceModel=t}get maxDistance(){return this._nativePannerNode.maxDistance}set maxDistance(t){this._nativePannerNode.maxDistance=t}get orientationX(){return this._orientationX}get orientationY(){return this._orientationY}get orientationZ(){return this._orientationZ}get panningModel(){return this._nativePannerNode.panningModel}set panningModel(t){this._nativePannerNode.panningModel=t}get positionX(){return this._positionX}get positionY(){return this._positionY}get positionZ(){return this._positionZ}get refDistance(){return this._nativePannerNode.refDistance}set refDistance(t){this._nativePannerNode.refDistance=t}get rolloffFactor(){return this._nativePannerNode.rolloffFactor}set rolloffFactor(t){this._nativePannerNode.rolloffFactor=t}},hY=(t,e,n,s,i,r,o,a,u,c)=>()=>{const l=new WeakMap;let h=null;const p=async(p,d)=>{let f=null,m=r(p);const g={channelCount:m.channelCount,channelCountMode:m.channelCountMode,channelInterpretation:m.channelInterpretation},y={...g,coneInnerAngle:m.coneInnerAngle,coneOuterAngle:m.coneOuterAngle,coneOuterGain:m.coneOuterGain,distanceModel:m.distanceModel,maxDistance:m.maxDistance,panningModel:m.panningModel,refDistance:m.refDistance,rolloffFactor:m.rolloffFactor},b=mH(m,d);if("bufferSize"in m)f=s(d,{...g,gain:1});else if(!b){const t={...y,orientationX:m.orientationX.value,orientationY:m.orientationY.value,orientationZ:m.orientationZ.value,positionX:m.positionX.value,positionY:m.positionY.value,positionZ:m.positionZ.value};m=i(d,t)}if(l.set(d,null===f?m:f),null!==f){if(null===h){if(null===o)throw new Error("Missing the native OfflineAudioContext constructor.");const t=new o(6,p.context.length,d.sampleRate),s=e(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"speakers",numberOfInputs:6});s.connect(t.destination),h=(async()=>{const e=await Promise.all([p.orientationX,p.orientationY,p.orientationZ,p.positionX,p.positionY,p.positionZ].map((async(e,s)=>{const i=n(t,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",offset:0===s?1:0});return await a(t,e,i.offset),i})));for(let t=0;t<6;t+=1)e[t].connect(s,0,t),e[t].start(0);return c(t)})()}const t=await h,r=s(d,{...g,gain:1});await u(p,d,r);const l=[];for(let e=0;e<t.numberOfChannels;e+=1)l.push(t.getChannelData(e));let m=[l[0][0],l[1][0],l[2][0]],b=[l[3][0],l[4][0],l[5][0]],v=s(d,{...g,gain:1}),w=i(d,{...y,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:b[0],positionY:b[1],positionZ:b[2]});r.connect(v).connect(w.inputs[0]),w.connect(f);for(let e=128;e<t.length;e+=128){const t=[l[0][e],l[1][e],l[2][e]],n=[l[3][e],l[4][e],l[5][e]];if(t.some(((t,e)=>t!==m[e]))||n.some(((t,e)=>t!==b[e]))){m=t,b=n;const o=e/d.sampleRate;v.gain.setValueAtTime(0,o),v=s(d,{...g,gain:0}),w=i(d,{...y,orientationX:m[0],orientationY:m[1],orientationZ:m[2],positionX:b[0],positionY:b[1],positionZ:b[2]}),v.gain.setValueAtTime(1,o),r.connect(v).connect(w.inputs[0]),w.connect(f)}}return f}return b?(await t(d,p.orientationX,m.orientationX),await t(d,p.orientationY,m.orientationY),await t(d,p.orientationZ,m.orientationZ),await t(d,p.positionX,m.positionX),await t(d,p.positionY,m.positionY),await t(d,p.positionZ,m.positionZ)):(await a(d,p.orientationX,m.orientationX),await a(d,p.orientationY,m.orientationY),await a(d,p.orientationZ,m.orientationZ),await a(d,p.positionX,m.positionX),await a(d,p.positionY,m.positionY),await a(d,p.positionZ,m.positionZ)),KH(m)?await u(p,d,m.inputs[0]):await u(p,d,m),m};return{render(t,e){const n=l.get(e);return void 0!==n?Promise.resolve(n):p(t,e)}}},pY={disableNormalization:!1},dY=(t,e,n,s)=>class i{constructor(i,r){const o=e(i),a=s({...pY,...r}),u=t(o,a);return n.add(u),u}static[Symbol.hasInstance](t){return null!==t&&"object"===typeof t&&Object.getPrototypeOf(t)===i.prototype||n.has(t)}},fY=(t,e)=>(n,s,i)=>{const r=t(s);return r.replay(i),e(s,n,i)},mY=(t,e,n)=>async(s,i,r)=>{const o=t(s);await Promise.all(o.activeInputs.map(((t,o)=>Array.from(t).map((async([t,a])=>{const u=e(t),c=await u.render(t,i),l=s.context.destination;n(t)||s===l&&n(s)||c.connect(r,a,o)})))).reduce(((t,e)=>[...t,...e]),[]))},gY=(t,e,n)=>async(s,i,r)=>{const o=e(s);await Promise.all(Array.from(o.activeInputs).map((async([e,s])=>{const o=t(e),a=await o.render(e,i);n(e)||a.connect(r,s)})))},yY=(t,e,n,s)=>i=>t(nQ,(()=>nQ(i)))?Promise.resolve(t(s,s)).then((t=>{if(!t){const t=n(i,512,0,1);i.oncomplete=()=>{t.onaudioprocess=null,t.disconnect()},t.onaudioprocess=()=>i.currentTime,t.connect(i.destination)}return i.startRendering()})):new Promise((t=>{const n=e(i,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});i.oncomplete=e=>{n.disconnect(),t(e.renderedBuffer)},n.connect(i.destination),i.startRendering()})),bY=t=>(e,n)=>{t.set(e,n)},vY=t=>(e,n)=>t.set(e,n),wY=(t,e,n,s,i,r,o,a)=>(u,c)=>n(u).render(u,c).then((()=>Promise.all(Array.from(s(c)).map((t=>n(t).render(t,c)))))).then((()=>i(c))).then((n=>("function"!==typeof n.copyFromChannel?(o(n),vH(n)):e(r,(()=>r(n)))||a(n),t.add(n),n))),xY={channelCount:2,channelCountMode:"explicit",channelInterpretation:"speakers",pan:0},_Y=(t,e,n,s,i,r)=>class extends t{constructor(t,o){const a=i(t),u={...xY,...o},c=n(a,u),l=r(a),h=l?s():null;super(t,!1,c,h),this._pan=e(this,l,c.pan)}get pan(){return this._pan}},kY=(t,e,n,s,i)=>()=>{const r=new WeakMap,o=async(o,a)=>{let u=n(o);const c=mH(u,a);if(!c){const t={channelCount:u.channelCount,channelCountMode:u.channelCountMode,channelInterpretation:u.channelInterpretation,pan:u.pan.value};u=e(a,t)}return r.set(a,u),c?await t(a,o.pan,u.pan):await s(a,o.pan,u.pan),KH(u)?await i(o,a,u.inputs[0]):await i(o,a,u),u};return{render(t,e){const n=r.get(e);return void 0!==n?Promise.resolve(n):o(t,e)}}},SY=t=>()=>{if(null===t)return!1;try{new t({length:1,sampleRate:44100})}catch{return!1}return!0},TY=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),n=e.createBuffer(1,1,44100);if(void 0===n.copyToChannel)return!0;const s=new Float32Array(2);try{n.copyFromChannel(s,0,0)}catch{return!1}return!0},IY=t=>()=>{if(null===t)return!1;if(void 0!==t.prototype&&void 0!==t.prototype.close)return!0;const e=new t,n=void 0!==e.close;try{e.close()}catch{}return n},CY=t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);return new Promise((t=>{let n=!0;const s=s=>{n&&(n=!1,e.startRendering(),t(s instanceof TypeError))};let i;try{i=e.decodeAudioData(null,(()=>{}),s)}catch(x6){s(x6)}void 0!==i&&i.catch(s)}))},AY=t=>()=>{if(null===t)return!1;let e;try{e=new t({latencyHint:"balanced"})}catch{return!1}return e.close(),!0},NY=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),n=e.createGain(),s=n.connect(n)===n;return n.disconnect(n),s},EY=(t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['let c,p;class A extends AudioWorkletProcessor{constructor(){super();this.port.onmessage=(e)=>{p=e.data;p.onmessage=()=>{p.postMessage(c);p.close()};this.port.postMessage(0)}}process(){c=1}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new MessageChannel,i=new e(1,128,44100),r=URL.createObjectURL(n);let o=!1;try{await i.audioWorklet.addModule(r);const e=new t(i,"a",{numberOfOutputs:0}),n=i.createOscillator();await new Promise((t=>{e.port.onmessage=()=>t(),e.port.postMessage(s.port2,[s.port2])})),e.port.onmessage=()=>o=!0,n.connect(e),n.start(0),await i.startRendering(),o=await new Promise((t=>{s.port1.onmessage=({data:e})=>t(1===e),s.port1.postMessage(0)}))}catch{}finally{s.port1.close(),URL.revokeObjectURL(r)}return o},OY=(t,e)=>async()=>{if(null===t)return!0;if(null===e)return!1;const n=new Blob(['class A extends AudioWorkletProcessor{process(i){this.port.postMessage(i,[i[0][0].buffer])}}registerProcessor("a",A)'],{type:"application/javascript; charset=utf-8"}),s=new e(1,128,44100),i=URL.createObjectURL(n);let r=!1,o=!1;try{await s.audioWorklet.addModule(i);const e=new t(s,"a",{numberOfOutputs:0}),n=s.createOscillator();e.port.onmessage=()=>r=!0,e.onprocessorerror=()=>o=!0,n.connect(e),n.start(0),await s.startRendering(),await new Promise((t=>setTimeout(t)))}catch{}finally{URL.revokeObjectURL(i)}return r&&!o},$Y=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),n=e.createChannelMerger();if("max"===n.channelCountMode)return!0;try{n.channelCount=2}catch{return!0}return!1},RY=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100);if(void 0===e.createConstantSource)return!0;const n=e.createConstantSource();return n.offset.maxValue!==Number.POSITIVE_INFINITY},DY=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),n=e.createConvolver();n.buffer=e.createBuffer(1,1,e.sampleRate);try{n.buffer=e.createBuffer(1,1,e.sampleRate)}catch{return!1}return!0},MY=t=>()=>{if(null===t)return!1;const e=new t(1,1,44100),n=e.createConvolver();try{n.channelCount=1}catch{return!1}return!0},PY=t=>()=>null!==t&&t.hasOwnProperty("isSecureContext"),FY=t=>()=>{if(null===t)return!1;const e=new t;try{return e.createMediaStreamSource(new MediaStream),!1}catch(x6){return!0}finally{e.close()}},LY=(t,e)=>()=>{if(null===e)return Promise.resolve(!1);const n=new e(1,1,44100),s=t(n,{channelCount:1,channelCountMode:"explicit",channelInterpretation:"discrete",gain:0});return new Promise((t=>{n.oncomplete=()=>{s.disconnect(),t(0!==n.currentTime)},n.startRendering()}))},zY=t=>()=>{if(null===t)return Promise.resolve(!1);const e=new t(1,1,44100);if(void 0===e.createStereoPanner)return Promise.resolve(!0);if(void 0===e.createConstantSource)return Promise.resolve(!0);const n=e.createConstantSource(),s=e.createStereoPanner();return n.channelCount=1,n.offset.value=1,s.channelCount=1,n.start(),n.connect(s).connect(e.destination),e.startRendering().then((t=>1!==t.getChannelData(0)[0]))},BY=()=>new DOMException("","UnknownError"),qY={channelCount:2,channelCountMode:"max",channelInterpretation:"speakers",curve:null,oversample:"none"},VY=(t,e,n,s,i,r,o)=>class extends t{constructor(t,e){const a=i(t),u={...qY,...e},c=n(a,u),l=r(a),h=l?s():null;super(t,!0,c,h),this._isCurveNullified=!1,this._nativeWaveShaperNode=c,o(this,1)}get curve(){return this._isCurveNullified?null:this._nativeWaveShaperNode.curve}set curve(t){if(null===t)this._isCurveNullified=!0,this._nativeWaveShaperNode.curve=new Float32Array([0,0]);else{if(t.length<2)throw e();this._isCurveNullified=!1,this._nativeWaveShaperNode.curve=t}}get oversample(){return this._nativeWaveShaperNode.oversample}set oversample(t){this._nativeWaveShaperNode.oversample=t}},WY=(t,e,n)=>()=>{const s=new WeakMap,i=async(i,r)=>{let o=e(i);const a=mH(o,r);if(!a){const e={channelCount:o.channelCount,channelCountMode:o.channelCountMode,channelInterpretation:o.channelInterpretation,curve:o.curve,oversample:o.oversample};o=t(r,e)}return s.set(r,o),KH(o)?await n(i,r,o.inputs[0]):await n(i,r,o),o};return{render(t,e){const n=s.get(e);return void 0!==n?Promise.resolve(n):i(t,e)}}},jY=()=>"undefined"===typeof window?null:window,UY=(t,e)=>n=>{n.copyFromChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const u=n.length,c=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<u&&t<l;t+=1)s[t]=c[t+o]},n.copyToChannel=(s,i,r=0)=>{const o=t(r),a=t(i);if(a>=n.numberOfChannels)throw e();const u=n.length,c=n.getChannelData(a),l=s.length;for(let t=o<0?-o:0;t+o<u&&t<l;t+=1)c[t+o]=s[t]}},GY=t=>e=>{e.copyFromChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyFromChannel),e.copyToChannel=(n=>(s,i,r=0)=>{const o=t(r),a=t(i);if(o<e.length)return n.call(e,s,a,o)})(e.copyToChannel)},HY=t=>(e,n)=>{const s=n.createBuffer(1,1,44100);null===e.buffer&&(e.buffer=s),t(e,"buffer",(t=>()=>{const n=t.call(e);return n===s?null:n}),(t=>n=>t.call(e,null===n?s:n)))},KY=(t,e)=>(n,s)=>{s.channelCount=1,s.channelCountMode="explicit",Object.defineProperty(s,"channelCount",{get:()=>1,set:()=>{throw t()}}),Object.defineProperty(s,"channelCountMode",{get:()=>"explicit",set:()=>{throw t()}});const i=n.createBufferSource(),r=()=>{const t=s.numberOfInputs;for(let e=0;e<t;e+=1)i.connect(s,0,e)},o=()=>i.disconnect(s);e(s,r,o)},XY=(t,e,n)=>void 0===t.copyFromChannel?t.getChannelData(n)[0]:(t.copyFromChannel(e,n),e[0]),QY=t=>{if(null===t)return!1;const e=t.length;return e%2!==0?0!==t[Math.floor(e/2)]:t[e/2-1]+t[e/2]!==0},YY=(t,e,n,s)=>{let i=t;while(!i.hasOwnProperty(e))i=Object.getPrototypeOf(i);const{get:r,set:o}=Object.getOwnPropertyDescriptor(i,e);Object.defineProperty(t,e,{get:n(r),set:s(o)})},ZY=t=>({...t,outputChannelCount:void 0!==t.outputChannelCount?t.outputChannelCount:1===t.numberOfInputs&&1===t.numberOfOutputs?[t.channelCount]:Array.from({length:t.numberOfOutputs},(()=>1))}),JY=t=>({...t,channelCount:t.numberOfOutputs}),tZ=t=>{const{imag:e,real:n}=t;return void 0===e?void 0===n?{...t,imag:[0,0],real:[0,0]}:{...t,imag:Array.from(n,(()=>0)),real:n}:void 0===n?{...t,imag:e,real:Array.from(e,(()=>0))}:{...t,imag:e,real:n}},eZ=(t,e,n)=>{try{t.setValueAtTime(e,n)}catch(x6){if(9!==x6.code)throw x6;eZ(t,e,n+1e-7)}},nZ=t=>{const e=t.createBufferSource();e.start();try{e.start()}catch{return!0}return!1},sZ=t=>{const e=t.createBufferSource(),n=t.createBuffer(1,1,44100);e.buffer=n;try{e.start(0,1)}catch{return!1}return!0},iZ=t=>{const e=t.createBufferSource();e.start();try{e.stop()}catch{return!1}return!0},rZ=t=>{const e=t.createOscillator();try{e.start(-1)}catch(x6){return x6 instanceof RangeError}return!1},oZ=t=>{const e=t.createBuffer(1,1,44100),n=t.createBufferSource();n.buffer=e,n.start(),n.stop();try{return n.stop(),!0}catch{return!1}},aZ=t=>{const e=t.createOscillator();try{e.stop(-1)}catch(x6){return x6 instanceof RangeError}return!1},uZ=t=>{const{port1:e,port2:n}=new MessageChannel;try{e.postMessage(t)}finally{e.close(),n.close()}},cZ=()=>{try{new DOMException}catch{return!1}return!0},lZ=()=>new Promise((t=>{const e=new ArrayBuffer(0),{port1:n,port2:s}=new MessageChannel;n.onmessage=({data:e})=>t(null!==e),s.postMessage(e,[e])})),hZ=t=>{t.start=(e=>(n=0,s=0,i)=>{const r=t.buffer,o=null===r?s:Math.min(r.duration,s);null!==r&&o>r.duration-.5/t.context.sampleRate?e.call(t,n,0,0):e.call(t,n,o,i)})(t.start)},pZ=(t,e)=>{const n=e.createGain();t.connect(n);const s=(e=>()=>{e.call(t,n),t.removeEventListener("ended",s)})(t.disconnect);t.addEventListener("ended",s),$Q(t,n),t.stop=(e=>{let s=!1;return(i=0)=>{if(s)try{e.call(t,i)}catch{n.gain.setValueAtTime(0,i)}else e.call(t,i),s=!0}})(t.stop)},dZ=(t,e)=>n=>{const s={value:t};return Object.defineProperties(n,{currentTarget:s,target:s}),"function"===typeof e?e.call(t,n):e.handleEvent.call(t,n)},fZ=MG(UH),mZ=lH(UH),gZ=iX(nH),yZ=new WeakMap,bZ=kX(yZ),vZ=RK(new Map,new WeakMap),wZ=jY(),xZ=lQ(vZ,bH),_Z=_X(DH),kZ=mY(DH,_Z,sK),SZ=gH(xZ,eK,kZ),TZ=CX(WG),IZ=HQ(wZ),CZ=GX(IZ),AZ=new WeakMap,NZ=mX(dZ),EZ=yQ(wZ),OZ=VX(EZ),$Z=WX(wZ),RZ=jX(wZ),DZ=vQ(wZ),MZ=yK(PG(zG),cH(fZ,mZ,XH,gZ,tK,DH,bZ,iH,eK,UH,SH,sK,iK),vZ,FX(UG,tK,DH,eK,nK,SH),bH,EX,sY,tX(XH,UG,DH,eK,nK,TZ,SH,CZ),aX(AZ,DH,eH),NZ,TZ,OZ,$Z,RZ,CZ,DZ),PZ=fH(MZ,SZ,bH,xZ,TZ,CZ),FZ=new WeakSet,LZ=hQ(wZ),zZ=GK(new Uint32Array(1)),BZ=UY(zZ,bH),qZ=GY(zZ),VZ=xH(FZ,vZ,sY,LZ,IZ,SY(LZ),BZ,qZ),WZ=hH(FQ),jZ=gY(_Z,MH,sK),UZ=BK(jZ),GZ=gQ(WZ,vZ,nZ,sZ,iZ,rZ,oZ,aZ,hZ,HY(YY),pZ),HZ=fY(SX(MH),jZ),KZ=CH(UZ,GZ,eK,HZ,kZ),XZ=bK(FG(qG),AZ,VG,vK,RG.createCancelAndHoldAutomationEvent,RG.createCancelScheduledValuesAutomationEvent,RG.createExponentialRampToValueAutomationEvent,RG.createLinearRampToValueAutomationEvent,RG.createSetTargetAutomationEvent,RG.createSetValueAutomationEvent,RG.createSetValueCurveAutomationEvent,EZ,eZ),QZ=IH(MZ,KZ,XZ,IX,GZ,TZ,CZ,dZ),YZ=BH(MZ,qH,bH,IX,bQ(FQ,YY),TZ,CZ,kZ),ZZ=$K(UZ,CQ,eK,HZ,kZ),JZ=vY(yZ),tJ=OK(MZ,XZ,ZZ,EX,CQ,TZ,CZ,JZ),eJ=rQ(UH,$Z),nJ=KY(IX,eJ),sJ=AQ(EZ,nJ),iJ=PK(sJ,eK,kZ),rJ=MK(MZ,iJ,sJ,TZ,CZ),oJ=zK(EQ,eK,kZ),aJ=LK(MZ,oJ,EQ,TZ,CZ,JY),uJ=RQ(WZ,GZ,FQ,eJ),cJ=OQ(WZ,vZ,uJ,rZ,aZ),lJ=UK(UZ,cJ,eK,HZ,kZ),hJ=jK(MZ,XZ,lJ,cJ,TZ,CZ,dZ),pJ=DQ(sY,YY),dJ=XK(pJ,eK,kZ),fJ=KK(MZ,dJ,pJ,TZ,CZ,JZ),mJ=sX(UZ,MQ,eK,HZ,kZ),gJ=nX(MZ,XZ,mJ,MQ,TZ,CZ,JZ),yJ=PQ(sY),bJ=pX(UZ,yJ,eK,HZ,kZ),vJ=hX(MZ,XZ,bJ,yJ,sY,TZ,CZ,JZ),wJ=wX(UZ,FQ,eK,HZ,kZ),xJ=vX(MZ,XZ,wJ,FQ,TZ,CZ),_J=VQ(EX,IX,ZQ,sY),kJ=yY(vZ,FQ,ZQ,LY(FQ,IZ)),SJ=PX(GZ,eK,IZ,kZ,kJ),TJ=LQ(_J),IJ=RX(MZ,TJ,SJ,TZ,CZ,JZ),CJ=VH(XZ,sJ,cJ,ZQ,sY,XY,CZ,YY),AJ=new WeakMap,NJ=eQ(YZ,CJ,NZ,CZ,AJ,dZ),EJ=KQ(WZ,vZ,rZ,oZ,aZ,pZ),OJ=uY(UZ,EJ,eK,HZ,kZ),$J=aY(MZ,XZ,EJ,OJ,TZ,CZ,dZ),RJ=VK(GZ),DJ=nY(RJ,IX,FQ,QY,eJ),MJ=eY(RJ,IX,DJ,QY,eJ,EZ,YY),PJ=QQ(XH,IX,sJ,FQ,ZQ,MJ,sY,tK,XY,eJ),FJ=XQ(PJ),LJ=hY(UZ,sJ,cJ,FQ,FJ,eK,IZ,HZ,kZ,kJ),zJ=lY(MZ,XZ,FJ,LJ,TZ,CZ,JZ),BJ=YQ(bH),qJ=dY(BJ,TZ,new WeakSet,tZ),VJ=tY(sJ,EQ,FQ,MJ,sY,eJ),WJ=JQ(VJ,sY),jJ=kY(UZ,WJ,eK,HZ,kZ),UJ=_Y(MZ,XZ,WJ,jJ,TZ,CZ),GJ=WY(MJ,eK,kZ),HJ=VY(MZ,IX,MJ,GJ,TZ,CZ,JZ),KJ=HX(wZ),XJ=gX(wZ),QJ=new WeakMap,YJ=AX(QJ,IZ),ZJ=KJ?tH(vZ,sY,fX(wZ),XJ,yX(DG),TZ,YJ,CZ,DZ,new WeakMap,new WeakMap,OY(DZ,IZ),wZ):void 0,JJ=UX(OZ,CZ),t0=JK(FZ,vZ,YK,dX,new WeakSet,TZ,JJ,yH,nQ,BZ,qZ),e0=NK(ZJ,PZ,VZ,QZ,tJ,rJ,aJ,hJ,fJ,t0,gJ,vJ,xJ,IJ,NJ,$J,zJ,qJ,UJ,HJ),n0=XX(MZ,WQ,TZ,CZ),s0=YX(MZ,jQ,TZ,CZ),i0=ZX(MZ,UQ,TZ,CZ),r0=GQ(IX,CZ),o0=JX(MZ,r0,TZ),a0=zH(e0,IX,sY,BY,n0,s0,i0,o0,EZ),u0=NX(AJ),c0=pH(u0),l0=qK(bH),h0=rX(u0),p0=cX(bH),d0=new WeakMap,f0=xX(d0,eH),m0=IQ(l0,bH,IX,sJ,EQ,cJ,FQ,ZQ,sY,p0,XJ,f0,eJ),g0=xQ(IX,m0,FQ,sY,eJ),y0=AK(UZ,l0,GZ,sJ,EQ,cJ,FQ,h0,p0,XJ,eK,DZ,IZ,HZ,kZ,kJ),b0=TX(QJ),v0=bY(d0),w0=KJ?_K(c0,MZ,XZ,y0,g0,DH,b0,TZ,CZ,DZ,ZY,v0,uZ,dZ):void 0,x0=(tQ(IX,sY,BY,NJ,EZ),QK(sY,IZ)),_0=wY(FZ,vZ,_Z,u0,kJ,yH,BZ,qZ),k0=(iQ(vZ,IX,x0,NJ,_0),rY(e0,vZ,IX,x0,_0)),S0=LX(WG,OZ),T0=zX(BG,$Z),I0=BX(VG,RZ),C0=qX(WG,CZ),A0=()=>KX(vZ,TY(IZ),IY(EZ),CY(IZ),AY(EZ),NY(IZ),EY(DZ,IZ),$Y(IZ),RY(IZ),DY(IZ),MY(IZ),cZ,PY(wZ),FY(EZ),zY(IZ),lZ);function N0(t,e){if(!t)throw new Error(e)}function E0(t,e,n=1/0){if(!(e<=t&&t<=n))throw new RangeError(`Value must be within [${e}, ${n}], got: ${t}`)}function O0(t){t.isOffline||"running"===t.state||M0('The AudioContext is "suspended". Invoke Tone.start() from a user action to start the audio.')}let $0=console;function R0(t){$0=t}function D0(...t){$0.log(...t)}function M0(...t){$0.warn(...t)}function P0(t){return"undefined"===typeof t}function F0(t){return!P0(t)}function L0(t){return"function"===typeof t}function z0(t){return"number"===typeof t}function B0(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object}function q0(t){return"boolean"===typeof t}function V0(t){return Array.isArray(t)}function W0(t){return"string"===typeof t}function j0(t){return W0(t)&&/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i.test(t)}function U0(t){return new a0(t)}function G0(t,e,n){return new k0(t,e,n)}const H0="object"===typeof self?self:null,K0=H0&&(H0.hasOwnProperty("AudioContext")||H0.hasOwnProperty("webkitAudioContext"));function X0(t,e,n){return N0(F0(w0),"This node only works in a secure context (https or localhost)"),new w0(t,e,n)}function Q0(t,e,n,s){var i,r=arguments.length,o=r<3?e:null===s?s=Object.getOwnPropertyDescriptor(e,n):s;if("object"===typeof Reflect&&"function"===typeof Reflect.decorate)o=Reflect.decorate(t,e,n,s);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(o=(r<3?i(o):r>3?i(e,n,o):i(e,n))||o);return r>3&&o&&Object.defineProperty(e,n,o),o}function Y0(t,e,n,s){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,r){function o(t){try{u(s.next(t))}catch(e){r(e)}}function a(t){try{u(s["throw"](t))}catch(e){r(e)}}function u(t){t.done?n(t.value):i(t.value).then(o,a)}u((s=s.apply(t,e||[])).next())}))}Object.create;Object.create;"function"===typeof SuppressedError&&SuppressedError;class Z0{constructor(t,e,n){this._callback=t,this._type=e,this._updateInterval=n,this._createClock()}_createWorker(){const t=new Blob([`\n\t\t\t// the initial timeout time\n\t\t\tlet timeoutTime =  ${(1e3*this._updateInterval).toFixed(1)};\n\t\t\t// onmessage callback\n\t\t\tself.onmessage = function(msg){\n\t\t\t\ttimeoutTime = parseInt(msg.data);\n\t\t\t};\n\t\t\t// the tick function which posts a message\n\t\t\t// and schedules a new tick\n\t\t\tfunction tick(){\n\t\t\t\tsetTimeout(tick, timeoutTime);\n\t\t\t\tself.postMessage('tick');\n\t\t\t}\n\t\t\t// call tick initially\n\t\t\ttick();\n\t\t\t`],{type:"text/javascript"}),e=URL.createObjectURL(t),n=new Worker(e);n.onmessage=this._callback.bind(this),this._worker=n}_createTimeout(){this._timeout=setTimeout((()=>{this._createTimeout(),this._callback()}),1e3*this._updateInterval)}_createClock(){if("worker"===this._type)try{this._createWorker()}catch(t){this._type="timeout",this._createClock()}else"timeout"===this._type&&this._createTimeout()}_disposeClock(){this._timeout&&(clearTimeout(this._timeout),this._timeout=0),this._worker&&(this._worker.terminate(),this._worker.onmessage=null)}get updateInterval(){return this._updateInterval}set updateInterval(t){this._updateInterval=Math.max(t,128/44100),"worker"===this._type&&this._worker.postMessage(Math.max(1e3*t,1))}get type(){return this._type}set type(t){this._disposeClock(),this._type=t,this._createClock()}dispose(){this._disposeClock()}}function J0(t){return I0(t)}function t1(t){return T0(t)}function e1(t){return C0(t)}function n1(t){return S0(t)}function s1(t){return t instanceof AudioBuffer}function i1(t,e){return"value"===t||J0(e)||t1(e)||s1(e)}function r1(t,...e){if(!e.length)return t;const n=e.shift();if(B0(t)&&B0(n))for(const s in n)i1(s,n[s])?t[s]=n[s]:B0(n[s])?(t[s]||Object.assign(t,{[s]:{}}),r1(t[s],n[s])):Object.assign(t,{[s]:n[s]});return r1(t,...e)}function o1(t,e){return t.length===e.length&&t.every(((t,n)=>e[n]===t))}function a1(t,e,n=[],s){const i={},r=Array.from(e);if(B0(r[0])&&s&&!Reflect.has(r[0],s)){const e=Object.keys(r[0]).some((e=>Reflect.has(t,e)));e||(r1(i,{[s]:r[0]}),n.splice(n.indexOf(s),1),r.shift())}if(1===r.length&&B0(r[0]))r1(i,r[0]);else for(let o=0;o<n.length;o++)F0(r[o])&&(i[n[o]]=r[o]);return r1(t,i)}function u1(t){return t.constructor.getDefaults()}function c1(t,e){return P0(t)?e:t}function l1(t,e){return e.forEach((e=>{Reflect.has(t,e)&&delete t[e]})),t}
/**
 * Tone.js
 * @author Yotam Mann
 * @license http://opensource.org/licenses/MIT MIT License
 * @copyright 2014-2019 Yotam Mann
 */
class h1{constructor(){this.debug=!1,this._wasDisposed=!1}static getDefaults(){return{}}log(...t){(this.debug||H0&&this.toString()===H0.TONE_DEBUG_CLASS)&&D0(this,...t)}dispose(){return this._wasDisposed=!0,this}get disposed(){return this._wasDisposed}toString(){return this.name}}h1.version=$G;const p1=1e-6;function d1(t,e){return t>e+p1}function f1(t,e){return d1(t,e)||g1(t,e)}function m1(t,e){return t+p1<e}function g1(t,e){return Math.abs(t-e)<p1}function y1(t,e,n){return Math.max(Math.min(t,n),e)}class b1 extends h1{constructor(){super(),this.name="Timeline",this._timeline=[];const t=a1(b1.getDefaults(),arguments,["memory"]);this.memory=t.memory,this.increasing=t.increasing}static getDefaults(){return{memory:1/0,increasing:!1}}get length(){return this._timeline.length}add(t){if(N0(Reflect.has(t,"time"),"Timeline: events must have a time attribute"),t.time=t.time.valueOf(),this.increasing&&this.length){const e=this._timeline[this.length-1];N0(f1(t.time,e.time),"The time must be greater than or equal to the last scheduled time"),this._timeline.push(t)}else{const e=this._search(t.time);this._timeline.splice(e+1,0,t)}if(this.length>this.memory){const t=this.length-this.memory;this._timeline.splice(0,t)}return this}remove(t){const e=this._timeline.indexOf(t);return-1!==e&&this._timeline.splice(e,1),this}get(t,e="time"){const n=this._search(t,e);return-1!==n?this._timeline[n]:null}peek(){return this._timeline[0]}shift(){return this._timeline.shift()}getAfter(t,e="time"){const n=this._search(t,e);return n+1<this._timeline.length?this._timeline[n+1]:null}getBefore(t){const e=this._timeline.length;if(e>0&&this._timeline[e-1].time<t)return this._timeline[e-1];const n=this._search(t);return n-1>=0?this._timeline[n-1]:null}cancel(t){if(this._timeline.length>1){let e=this._search(t);if(e>=0)if(g1(this._timeline[e].time,t)){for(let n=e;n>=0;n--){if(!g1(this._timeline[n].time,t))break;e=n}this._timeline=this._timeline.slice(0,e)}else this._timeline=this._timeline.slice(0,e+1);else this._timeline=[]}else 1===this._timeline.length&&f1(this._timeline[0].time,t)&&(this._timeline=[]);return this}cancelBefore(t){const e=this._search(t);return e>=0&&(this._timeline=this._timeline.slice(e+1)),this}previousEvent(t){const e=this._timeline.indexOf(t);return e>0?this._timeline[e-1]:null}_search(t,e="time"){if(0===this._timeline.length)return-1;let n=0;const s=this._timeline.length;let i=s;if(s>0&&this._timeline[s-1][e]<=t)return s-1;while(n<i){let s=Math.floor(n+(i-n)/2);const r=this._timeline[s],o=this._timeline[s+1];if(g1(r[e],t)){for(let n=s;n<this._timeline.length;n++){const i=this._timeline[n];if(!g1(i[e],t))break;s=n}return s}if(m1(r[e],t)&&d1(o[e],t))return s;d1(r[e],t)?i=s:n=s+1}return-1}_iterate(t,e=0,n=this._timeline.length-1){this._timeline.slice(e,n+1).forEach(t)}forEach(t){return this._iterate(t),this}forEachBefore(t,e){const n=this._search(t);return-1!==n&&this._iterate(e,0,n),this}forEachAfter(t,e){const n=this._search(t);return this._iterate(e,n+1),this}forEachBetween(t,e,n){let s=this._search(t),i=this._search(e);return-1!==s&&-1!==i?(this._timeline[s].time!==t&&(s+=1),this._timeline[i].time===e&&(i-=1),this._iterate(n,s,i)):-1===s&&this._iterate(n,0,i),this}forEachFrom(t,e){let n=this._search(t);while(n>=0&&this._timeline[n].time>=t)n--;return this._iterate(e,n+1),this}forEachAtTime(t,e){const n=this._search(t);if(-1!==n&&g1(this._timeline[n].time,t)){let s=n;for(let e=n;e>=0;e--){if(!g1(this._timeline[e].time,t))break;s=e}this._iterate((t=>{e(t)}),s,n)}return this}dispose(){return super.dispose(),this._timeline=[],this}}const v1=[];function w1(t){v1.push(t)}function x1(t){v1.forEach((e=>e(t)))}const _1=[];function k1(t){_1.push(t)}function S1(t){_1.forEach((e=>e(t)))}class T1 extends h1{constructor(){super(...arguments),this.name="Emitter"}on(t,e){const n=t.split(/\W+/);return n.forEach((t=>{P0(this._events)&&(this._events={}),this._events.hasOwnProperty(t)||(this._events[t]=[]),this._events[t].push(e)})),this}once(t,e){const n=(...s)=>{e(...s),this.off(t,n)};return this.on(t,n),this}off(t,e){const n=t.split(/\W+/);return n.forEach((n=>{if(P0(this._events)&&(this._events={}),this._events.hasOwnProperty(t))if(P0(e))this._events[t]=[];else{const n=this._events[t];for(let t=n.length-1;t>=0;t--)n[t]===e&&n.splice(t,1)}})),this}emit(t,...e){if(this._events&&this._events.hasOwnProperty(t)){const n=this._events[t].slice(0);for(let t=0,s=n.length;t<s;t++)n[t].apply(this,e)}return this}static mixin(t){["on","once","off","emit"].forEach((e=>{const n=Object.getOwnPropertyDescriptor(T1.prototype,e);Object.defineProperty(t.prototype,e,n)}))}dispose(){return super.dispose(),this._events=void 0,this}}class I1 extends T1{constructor(){super(...arguments),this.isOffline=!1}toJSON(){return{}}}class C1 extends I1{constructor(){super(),this.name="Context",this._constants=new Map,this._timeouts=new b1,this._timeoutIds=0,this._initialized=!1,this.isOffline=!1,this._workletModules=new Map;const t=a1(C1.getDefaults(),arguments,["context"]);t.context?this._context=t.context:this._context=U0({latencyHint:t.latencyHint}),this._ticker=new Z0(this.emit.bind(this,"tick"),t.clockSource,t.updateInterval),this.on("tick",this._timeoutLoop.bind(this)),this._context.onstatechange=()=>{this.emit("statechange",this.state)},this._setLatencyHint(t.latencyHint),this.lookAhead=t.lookAhead}static getDefaults(){return{clockSource:"worker",latencyHint:"interactive",lookAhead:.1,updateInterval:.05}}initialize(){return this._initialized||(x1(this),this._initialized=!0),this}createAnalyser(){return this._context.createAnalyser()}createOscillator(){return this._context.createOscillator()}createBufferSource(){return this._context.createBufferSource()}createBiquadFilter(){return this._context.createBiquadFilter()}createBuffer(t,e,n){return this._context.createBuffer(t,e,n)}createChannelMerger(t){return this._context.createChannelMerger(t)}createChannelSplitter(t){return this._context.createChannelSplitter(t)}createConstantSource(){return this._context.createConstantSource()}createConvolver(){return this._context.createConvolver()}createDelay(t){return this._context.createDelay(t)}createDynamicsCompressor(){return this._context.createDynamicsCompressor()}createGain(){return this._context.createGain()}createIIRFilter(t,e){return this._context.createIIRFilter(t,e)}createPanner(){return this._context.createPanner()}createPeriodicWave(t,e,n){return this._context.createPeriodicWave(t,e,n)}createStereoPanner(){return this._context.createStereoPanner()}createWaveShaper(){return this._context.createWaveShaper()}createMediaStreamSource(t){N0(n1(this._context),"Not available if OfflineAudioContext");const e=this._context;return e.createMediaStreamSource(t)}createMediaElementSource(t){N0(n1(this._context),"Not available if OfflineAudioContext");const e=this._context;return e.createMediaElementSource(t)}createMediaStreamDestination(){N0(n1(this._context),"Not available if OfflineAudioContext");const t=this._context;return t.createMediaStreamDestination()}decodeAudioData(t){return this._context.decodeAudioData(t)}get currentTime(){return this._context.currentTime}get state(){return this._context.state}get sampleRate(){return this._context.sampleRate}get listener(){return this.initialize(),this._listener}set listener(t){N0(!this._initialized,"The listener cannot be set after initialization."),this._listener=t}get transport(){return this.initialize(),this._transport}set transport(t){N0(!this._initialized,"The transport cannot be set after initialization."),this._transport=t}get draw(){return this.initialize(),this._draw}set draw(t){N0(!this._initialized,"Draw cannot be set after initialization."),this._draw=t}get destination(){return this.initialize(),this._destination}set destination(t){N0(!this._initialized,"The destination cannot be set after initialization."),this._destination=t}createAudioWorkletNode(t,e){return X0(this.rawContext,t,e)}addAudioWorkletModule(t,e){return Y0(this,void 0,void 0,(function*(){N0(F0(this.rawContext.audioWorklet),"AudioWorkletNode is only available in a secure context (https or localhost)"),this._workletModules.has(e)||this._workletModules.set(e,this.rawContext.audioWorklet.addModule(t)),yield this._workletModules.get(e)}))}workletsAreReady(){return Y0(this,void 0,void 0,(function*(){const t=[];this._workletModules.forEach((e=>t.push(e))),yield Promise.all(t)}))}get updateInterval(){return this._ticker.updateInterval}set updateInterval(t){this._ticker.updateInterval=t}get clockSource(){return this._ticker.type}set clockSource(t){this._ticker.type=t}get latencyHint(){return this._latencyHint}_setLatencyHint(t){let e=0;if(this._latencyHint=t,W0(t))switch(t){case"interactive":e=.1;break;case"playback":e=.5;break;case"balanced":e=.25;break}this.lookAhead=e,this.updateInterval=e/2}get rawContext(){return this._context}now(){return this._context.currentTime+this.lookAhead}immediate(){return this._context.currentTime}resume(){return n1(this._context)?this._context.resume():Promise.resolve()}close(){return Y0(this,void 0,void 0,(function*(){n1(this._context)&&(yield this._context.close()),this._initialized&&S1(this)}))}getConstant(t){if(this._constants.has(t))return this._constants.get(t);{const e=this._context.createBuffer(1,128,this._context.sampleRate),n=e.getChannelData(0);for(let i=0;i<n.length;i++)n[i]=t;const s=this._context.createBufferSource();return s.channelCount=1,s.channelCountMode="explicit",s.buffer=e,s.loop=!0,s.start(0),this._constants.set(t,s),s}}dispose(){return super.dispose(),this._ticker.dispose(),this._timeouts.dispose(),Object.keys(this._constants).map((t=>this._constants[t].disconnect())),this}_timeoutLoop(){const t=this.now();let e=this._timeouts.peek();while(this._timeouts.length&&e&&e.time<=t)e.callback(),this._timeouts.shift(),e=this._timeouts.peek()}setTimeout(t,e){this._timeoutIds++;const n=this.now();return this._timeouts.add({callback:t,id:this._timeoutIds,time:n+e}),this._timeoutIds}clearTimeout(t){return this._timeouts.forEach((e=>{e.id===t&&this._timeouts.remove(e)})),this}clearInterval(t){return this.clearTimeout(t)}setInterval(t,e){const n=++this._timeoutIds,s=()=>{const i=this.now();this._timeouts.add({callback:()=>{t(),s()},id:n,time:i+e})};return s(),n}}class A1 extends I1{constructor(){super(...arguments),this.lookAhead=0,this.latencyHint=0,this.isOffline=!1}createAnalyser(){return{}}createOscillator(){return{}}createBufferSource(){return{}}createBiquadFilter(){return{}}createBuffer(t,e,n){return{}}createChannelMerger(t){return{}}createChannelSplitter(t){return{}}createConstantSource(){return{}}createConvolver(){return{}}createDelay(t){return{}}createDynamicsCompressor(){return{}}createGain(){return{}}createIIRFilter(t,e){return{}}createPanner(){return{}}createPeriodicWave(t,e,n){return{}}createStereoPanner(){return{}}createWaveShaper(){return{}}createMediaStreamSource(t){return{}}createMediaElementSource(t){return{}}createMediaStreamDestination(){return{}}decodeAudioData(t){return Promise.resolve({})}createAudioWorkletNode(t,e){return{}}get rawContext(){return{}}addAudioWorkletModule(t,e){return Y0(this,void 0,void 0,(function*(){return Promise.resolve()}))}resume(){return Promise.resolve()}setTimeout(t,e){return 0}clearTimeout(t){return this}setInterval(t,e){return 0}clearInterval(t){return this}getConstant(t){return{}}get currentTime(){return 0}get state(){return{}}get sampleRate(){return 0}get listener(){return{}}get transport(){return{}}get draw(){return{}}set draw(t){}get destination(){return{}}set destination(t){}now(){return 0}immediate(){return 0}}function N1(t,e){V0(e)?e.forEach((e=>N1(t,e))):Object.defineProperty(t,e,{enumerable:!0,writable:!1})}function E1(t,e){V0(e)?e.forEach((e=>E1(t,e))):Object.defineProperty(t,e,{writable:!0})}const O1=()=>{};class $1 extends h1{constructor(){super(),this.name="ToneAudioBuffer",this.onload=O1;const t=a1($1.getDefaults(),arguments,["url","onload","onerror"]);this.reverse=t.reverse,this.onload=t.onload,t.url&&s1(t.url)||t.url instanceof $1?this.set(t.url):W0(t.url)&&this.load(t.url).catch(t.onerror)}static getDefaults(){return{onerror:O1,onload:O1,reverse:!1}}get sampleRate(){return this._buffer?this._buffer.sampleRate:P1().sampleRate}set(t){return t instanceof $1?t.loaded?this._buffer=t.get():t.onload=()=>{this.set(t),this.onload(this)}:this._buffer=t,this._reversed&&this._reverse(),this}get(){return this._buffer}load(t){return Y0(this,void 0,void 0,(function*(){const e=$1.load(t).then((t=>{this.set(t),this.onload(this)}));$1.downloads.push(e);try{yield e}finally{const t=$1.downloads.indexOf(e);$1.downloads.splice(t,1)}return this}))}dispose(){return super.dispose(),this._buffer=void 0,this}fromArray(t){const e=V0(t)&&t[0].length>0,n=e?t.length:1,s=e?t[0].length:t.length,i=P1(),r=i.createBuffer(n,s,i.sampleRate),o=e||1!==n?t:[t];for(let a=0;a<n;a++)r.copyToChannel(o[a],a);return this._buffer=r,this}toMono(t){if(z0(t))this.fromArray(this.toArray(t));else{let t=new Float32Array(this.length);const e=this.numberOfChannels;for(let n=0;n<e;n++){const e=this.toArray(n);for(let n=0;n<e.length;n++)t[n]+=e[n]}t=t.map((t=>t/e)),this.fromArray(t)}return this}toArray(t){if(z0(t))return this.getChannelData(t);if(1===this.numberOfChannels)return this.toArray(0);{const t=[];for(let e=0;e<this.numberOfChannels;e++)t[e]=this.getChannelData(e);return t}}getChannelData(t){return this._buffer?this._buffer.getChannelData(t):new Float32Array(0)}slice(t,e=this.duration){const n=Math.floor(t*this.sampleRate),s=Math.floor(e*this.sampleRate);N0(n<s,"The start time must be less than the end time");const i=s-n,r=P1().createBuffer(this.numberOfChannels,i,this.sampleRate);for(let o=0;o<this.numberOfChannels;o++)r.copyToChannel(this.getChannelData(o).subarray(n,s),o);return new $1(r)}_reverse(){if(this.loaded)for(let t=0;t<this.numberOfChannels;t++)this.getChannelData(t).reverse();return this}get loaded(){return this.length>0}get duration(){return this._buffer?this._buffer.duration:0}get length(){return this._buffer?this._buffer.length:0}get numberOfChannels(){return this._buffer?this._buffer.numberOfChannels:0}get reverse(){return this._reversed}set reverse(t){this._reversed!==t&&(this._reversed=t,this._reverse())}static fromArray(t){return(new $1).fromArray(t)}static fromUrl(t){return Y0(this,void 0,void 0,(function*(){const e=new $1;return yield e.load(t)}))}static load(t){return Y0(this,void 0,void 0,(function*(){const e=t.match(/\[([^\]\[]+\|.+)\]$/);if(e){const n=e[1].split("|");let s=n[0];for(const t of n)if($1.supportsType(t)){s=t;break}t=t.replace(e[0],s)}const n=""===$1.baseUrl||$1.baseUrl.endsWith("/")?$1.baseUrl:$1.baseUrl+"/",s=yield fetch(n+t);if(!s.ok)throw new Error(`could not load url: ${t}`);const i=yield s.arrayBuffer(),r=yield P1().decodeAudioData(i);return r}))}static supportsType(t){const e=t.split("."),n=e[e.length-1],s=document.createElement("audio").canPlayType("audio/"+n);return""!==s}static loaded(){return Y0(this,void 0,void 0,(function*(){yield Promise.resolve();while($1.downloads.length)yield $1.downloads[0]}))}}$1.baseUrl="",$1.downloads=[];class R1 extends C1{constructor(){super({clockSource:"offline",context:e1(arguments[0])?arguments[0]:G0(arguments[0],arguments[1]*arguments[2],arguments[2]),lookAhead:0,updateInterval:e1(arguments[0])?128/arguments[0].sampleRate:128/arguments[2]}),this.name="OfflineContext",this._currentTime=0,this.isOffline=!0,this._duration=e1(arguments[0])?arguments[0].length/arguments[0].sampleRate:arguments[1]}now(){return this._currentTime}get currentTime(){return this._currentTime}_renderClock(t){return Y0(this,void 0,void 0,(function*(){let e=0;while(this._duration-this._currentTime>=0){this.emit("tick"),this._currentTime+=128/this.sampleRate,e++;const n=Math.floor(this.sampleRate/128);t&&e%n===0&&(yield new Promise((t=>setTimeout(t,1))))}}))}render(t=!0){return Y0(this,void 0,void 0,(function*(){yield this.workletsAreReady(),yield this._renderClock(t);const e=yield this._context.startRendering();return new $1(e)}))}close(){return Promise.resolve()}}const D1=new A1;let M1=D1;function P1(){return M1===D1&&K0&&F1(new C1),M1}function F1(t){M1=n1(t)?new C1(t):e1(t)?new R1(t):t}function L1(){return M1.resume()}if(H0&&!H0.TONE_SILENCE_LOGGING){let t="v";"dev"===$G&&(t="");const e=` * Tone.js ${t}${$G} * `;console.log(`%c${e}`,"background: #000; color: #fff")}function z1(t){return Math.pow(10,t/20)}function B1(t){return Math.log(t)/Math.LN10*20}function q1(t){return Math.pow(2,t/12)}let V1=440;function W1(){return V1}function j1(t){V1=t}function U1(t){return Math.round(G1(t))}function G1(t){return 69+12*Math.log2(t/V1)}function H1(t){return V1*Math.pow(2,(t-69)/12)}class K1 extends h1{constructor(t,e,n){super(),this.defaultUnits="s",this._val=e,this._units=n,this.context=t,this._expressions=this._getExpressions()}_getExpressions(){return{hz:{method:t=>this._frequencyToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)hz$/i},i:{method:t=>this._ticksToUnits(parseInt(t,10)),regexp:/^(\d+)i$/i},m:{method:t=>this._beatsToUnits(parseInt(t,10)*this._getTimeSignature()),regexp:/^(\d+)m$/i},n:{method:(t,e)=>{const n=parseInt(t,10),s="."===e?1.5:1;return 1===n?this._beatsToUnits(this._getTimeSignature())*s:this._beatsToUnits(4/n)*s},regexp:/^(\d+)n(\.?)$/i},number:{method:t=>this._expressions[this.defaultUnits].method.call(this,t),regexp:/^(\d+(?:\.\d+)?)$/},s:{method:t=>this._secondsToUnits(parseFloat(t)),regexp:/^(\d+(?:\.\d+)?)s$/},samples:{method:t=>parseInt(t,10)/this.context.sampleRate,regexp:/^(\d+)samples$/},t:{method:t=>{const e=parseInt(t,10);return this._beatsToUnits(8/(3*Math.floor(e)))},regexp:/^(\d+)t$/i},tr:{method:(t,e,n)=>{let s=0;return t&&"0"!==t&&(s+=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s+=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s+=this._beatsToUnits(parseFloat(n)/4)),s},regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?$/}}}valueOf(){if(this._val instanceof K1&&this.fromType(this._val),P0(this._val))return this._noArg();if(W0(this._val)&&P0(this._units)){for(const t in this._expressions)if(this._expressions[t].regexp.test(this._val.trim())){this._units=t;break}}else if(B0(this._val)){let t=0;for(const e in this._val)if(F0(this._val[e])){const n=this._val[e],s=new this.constructor(this.context,e).valueOf()*n;t+=s}return t}if(F0(this._units)){const t=this._expressions[this._units],e=this._val.toString().trim().match(t.regexp);return e?t.method.apply(this,e.slice(1)):t.method.call(this,this._val)}return W0(this._val)?parseFloat(this._val):this._val}_frequencyToUnits(t){return 1/t}_beatsToUnits(t){return 60/this._getBpm()*t}_secondsToUnits(t){return t}_ticksToUnits(t){return t*this._beatsToUnits(1)/this._getPPQ()}_noArg(){return this._now()}_getBpm(){return this.context.transport.bpm.value}_getTimeSignature(){return this.context.transport.timeSignature}_getPPQ(){return this.context.transport.PPQ}fromType(t){switch(this._units=void 0,this.defaultUnits){case"s":this._val=t.toSeconds();break;case"i":this._val=t.toTicks();break;case"hz":this._val=t.toFrequency();break;case"midi":this._val=t.toMidi();break}return this}toFrequency(){return 1/this.toSeconds()}toSamples(){return this.toSeconds()*this.context.sampleRate}toMilliseconds(){return 1e3*this.toSeconds()}}class X1 extends K1{constructor(){super(...arguments),this.name="TimeClass"}_getExpressions(){return Object.assign(super._getExpressions(),{now:{method:t=>this._now()+new this.constructor(this.context,t).valueOf(),regexp:/^\+(.+)/},quantize:{method:t=>{const e=new X1(this.context,t).valueOf();return this._secondsToUnits(this.context.transport.nextSubdivision(e))},regexp:/^@(.+)/}})}quantize(t,e=1){const n=new this.constructor(this.context,t).valueOf(),s=this.valueOf(),i=Math.round(s/n),r=i*n,o=r-s;return s+o*e}toNotation(){const t=this.toSeconds(),e=["1m"];for(let i=1;i<9;i++){const t=Math.pow(2,i);e.push(t+"n."),e.push(t+"n"),e.push(t+"t")}e.push("0");let n=e[0],s=new X1(this.context,e[0]).toSeconds();return e.forEach((e=>{const i=new X1(this.context,e).toSeconds();Math.abs(i-t)<Math.abs(s-t)&&(n=e,s=i)})),n}toBarsBeatsSixteenths(){const t=this._beatsToUnits(1);let e=this.valueOf()/t;e=parseFloat(e.toFixed(4));const n=Math.floor(e/this._getTimeSignature());let s=e%1*4;e=Math.floor(e)%this._getTimeSignature();const i=s.toString();i.length>3&&(s=parseFloat(parseFloat(i).toFixed(3)));const r=[n,e,s];return r.join(":")}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.round(e*this._getPPQ())}toSeconds(){return this.valueOf()}toMidi(){return U1(this.toFrequency())}_now(){return this.context.now()}}function Q1(t,e){return new X1(P1(),t,e)}class Y1 extends X1{constructor(){super(...arguments),this.name="Frequency",this.defaultUnits="hz"}static get A4(){return W1()}static set A4(t){j1(t)}_getExpressions(){return Object.assign({},super._getExpressions(),{midi:{regexp:/^(\d+(?:\.\d+)?midi)/,method(t){return"midi"===this.defaultUnits?t:Y1.mtof(t)}},note:{regexp:/^([a-g]{1}(?:b|#|x|bb)?)(-?[0-9]+)/i,method(t,e){const n=Z1[t.toLowerCase()],s=n+12*(parseInt(e,10)+1);return"midi"===this.defaultUnits?s:Y1.mtof(s)}},tr:{regexp:/^(\d+(?:\.\d+)?):(\d+(?:\.\d+)?):?(\d+(?:\.\d+)?)?/,method(t,e,n){let s=1;return t&&"0"!==t&&(s*=this._beatsToUnits(this._getTimeSignature()*parseFloat(t))),e&&"0"!==e&&(s*=this._beatsToUnits(parseFloat(e))),n&&"0"!==n&&(s*=this._beatsToUnits(parseFloat(n)/4)),s}}})}transpose(t){return new Y1(this.context,this.valueOf()*q1(t))}harmonize(t){return t.map((t=>this.transpose(t)))}toMidi(){return U1(this.valueOf())}toNote(){const t=this.toFrequency(),e=Math.log2(t/Y1.A4);let n=Math.round(12*e)+57;const s=Math.floor(n/12);s<0&&(n+=-12*s);const i=J1[n%12];return i+s.toString()}toSeconds(){return 1/super.toSeconds()}toTicks(){const t=this._beatsToUnits(1),e=this.valueOf()/t;return Math.floor(e*this._getPPQ())}_noArg(){return 0}_frequencyToUnits(t){return t}_ticksToUnits(t){return 1/(60*t/(this._getBpm()*this._getPPQ()))}_beatsToUnits(t){return 1/super._beatsToUnits(t)}_secondsToUnits(t){return 1/t}static mtof(t){return H1(t)}static ftom(t){return U1(t)}}const Z1={cbb:-2,cb:-1,c:0,"c#":1,cx:2,dbb:0,db:1,d:2,"d#":3,dx:4,ebb:2,eb:3,e:4,"e#":5,ex:6,fbb:3,fb:4,f:5,"f#":6,fx:7,gbb:5,gb:6,g:7,"g#":8,gx:9,abb:7,ab:8,a:9,"a#":10,ax:11,bbb:9,bb:10,b:11,"b#":12,bx:13},J1=["C","C#","D","D#","E","F","F#","G","G#","A","A#","B"];function t2(t,e){return new Y1(P1(),t,e)}class e2 extends X1{constructor(){super(...arguments),this.name="TransportTime"}_now(){return this.context.transport.seconds}}function n2(t,e){return new e2(P1(),t,e)}class s2 extends h1{constructor(){super();const t=a1(s2.getDefaults(),arguments,["context"]);this.defaultContext?this.context=this.defaultContext:this.context=t.context}static getDefaults(){return{context:P1()}}now(){return this.context.currentTime+this.context.lookAhead}immediate(){return this.context.currentTime}get sampleTime(){return 1/this.context.sampleRate}get blockTime(){return 128/this.context.sampleRate}toSeconds(t){return new X1(this.context,t).toSeconds()}toFrequency(t){return new Y1(this.context,t).toFrequency()}toTicks(t){return new e2(this.context,t).toTicks()}_getPartialProperties(t){const e=this.get();return Object.keys(e).forEach((n=>{P0(t[n])&&delete e[n]})),e}get(){const t=u1(this);return Object.keys(t).forEach((e=>{if(Reflect.has(this,e)){const n=this[e];F0(n)&&F0(n.value)&&F0(n.setValueAtTime)?t[e]=n.value:n instanceof s2?t[e]=n._getPartialProperties(t[e]):V0(n)||z0(n)||W0(n)||q0(n)?t[e]=n:delete t[e]}})),t}set(t){return Object.keys(t).forEach((e=>{Reflect.has(this,e)&&F0(this[e])&&(this[e]&&F0(this[e].value)&&F0(this[e].setValueAtTime)?this[e].value!==t[e]&&(this[e].value=t[e]):this[e]instanceof s2?this[e].set(t[e]):this[e]=t[e])})),this}}class i2 extends b1{constructor(t="stopped"){super(),this.name="StateTimeline",this._initial=t,this.setStateAtTime(this._initial,0)}getValueAtTime(t){const e=this.get(t);return null!==e?e.state:this._initial}setStateAtTime(t,e,n){return E0(e,0),this.add(Object.assign({},n,{state:t,time:e})),this}getLastState(t,e){const n=this._search(e);for(let s=n;s>=0;s--){const e=this._timeline[s];if(e.state===t)return e}}getNextState(t,e){const n=this._search(e);if(-1!==n)for(let s=n;s<this._timeline.length;s++){const e=this._timeline[s];if(e.state===t)return e}}}class r2 extends s2{constructor(){super(a1(r2.getDefaults(),arguments,["param","units","convert"])),this.name="Param",this.overridden=!1,this._minOutput=1e-7;const t=a1(r2.getDefaults(),arguments,["param","units","convert"]);N0(F0(t.param)&&(J0(t.param)||t.param instanceof r2),"param must be an AudioParam");while(!J0(t.param))t.param=t.param._param;this._swappable=!!F0(t.swappable)&&t.swappable,this._swappable?(this.input=this.context.createGain(),this._param=t.param,this.input.connect(this._param)):this._param=this.input=t.param,this._events=new b1(1e3),this._initialValue=this._param.defaultValue,this.units=t.units,this.convert=t.convert,this._minValue=t.minValue,this._maxValue=t.maxValue,F0(t.value)&&t.value!==this._toType(this._initialValue)&&this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(s2.getDefaults(),{convert:!0,units:"number"})}get value(){const t=this.now();return this.getValueAtTime(t)}set value(t){this.cancelScheduledValues(this.now()),this.setValueAtTime(t,this.now())}get minValue(){return F0(this._minValue)?this._minValue:"time"===this.units||"frequency"===this.units||"normalRange"===this.units||"positive"===this.units||"transportTime"===this.units||"ticks"===this.units||"bpm"===this.units||"hertz"===this.units||"samples"===this.units?0:"audioRange"===this.units?-1:"decibels"===this.units?-1/0:this._param.minValue}get maxValue(){return F0(this._maxValue)?this._maxValue:"normalRange"===this.units||"audioRange"===this.units?1:this._param.maxValue}_is(t,e){return this.units===e}_assertRange(t){return F0(this.maxValue)&&F0(this.minValue)&&E0(t,this._fromType(this.minValue),this._fromType(this.maxValue)),t}_fromType(t){return this.convert&&!this.overridden?this._is(t,"time")?this.toSeconds(t):this._is(t,"decibels")?z1(t):this._is(t,"frequency")?this.toFrequency(t):t:this.overridden?0:t}_toType(t){return this.convert&&"decibels"===this.units?B1(t):t}setValueAtTime(t,e){const n=this.toSeconds(e),s=this._fromType(t);return N0(isFinite(s)&&isFinite(n),`Invalid argument(s) to setValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(s),this.log(this.units,"setValueAtTime",t,n),this._events.add({time:n,type:"setValueAtTime",value:s}),this._param.setValueAtTime(s,n),this}getValueAtTime(t){const e=Math.max(this.toSeconds(t),0),n=this._events.getAfter(e),s=this._events.get(e);let i=this._initialValue;if(null===s)i=this._initialValue;else if("setTargetAtTime"!==s.type||null!==n&&"setValueAtTime"!==n.type)if(null===n)i=s.value;else if("linearRampToValueAtTime"===n.type||"exponentialRampToValueAtTime"===n.type){let t=s.value;if("setTargetAtTime"===s.type){const e=this._events.getBefore(s.time);t=null===e?this._initialValue:e.value}i="linearRampToValueAtTime"===n.type?this._linearInterpolate(s.time,t,n.time,n.value,e):this._exponentialInterpolate(s.time,t,n.time,n.value,e)}else i=s.value;else{const t=this._events.getBefore(s.time);let n;n=null===t?this._initialValue:t.value,"setTargetAtTime"===s.type&&(i=this._exponentialApproach(s.time,n,s.value,s.constant,e))}return this._toType(i)}setRampPoint(t){t=this.toSeconds(t);let e=this.getValueAtTime(t);return this.cancelAndHoldAtTime(t),0===this._fromType(e)&&(e=this._toType(this._minOutput)),this.setValueAtTime(e,t),this}linearRampToValueAtTime(t,e){const n=this._fromType(t),s=this.toSeconds(e);return N0(isFinite(n)&&isFinite(s),`Invalid argument(s) to linearRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._assertRange(n),this._events.add({time:s,type:"linearRampToValueAtTime",value:n}),this.log(this.units,"linearRampToValueAtTime",t,s),this._param.linearRampToValueAtTime(n,s),this}exponentialRampToValueAtTime(t,e){let n=this._fromType(t);n=g1(n,0)?this._minOutput:n,this._assertRange(n);const s=this.toSeconds(e);return N0(isFinite(n)&&isFinite(s),`Invalid argument(s) to exponentialRampToValueAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({time:s,type:"exponentialRampToValueAtTime",value:n}),this.log(this.units,"exponentialRampToValueAtTime",t,s),this._param.exponentialRampToValueAtTime(n,s),this}exponentialRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialRampToValueAtTime(t,n+this.toSeconds(e)),this}linearRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.linearRampToValueAtTime(t,n+this.toSeconds(e)),this}targetRampTo(t,e,n){return n=this.toSeconds(n),this.setRampPoint(n),this.exponentialApproachValueAtTime(t,n,e),this}exponentialApproachValueAtTime(t,e,n){e=this.toSeconds(e),n=this.toSeconds(n);const s=Math.log(n+1)/Math.log(200);return this.setTargetAtTime(t,e,s),this.cancelAndHoldAtTime(e+.9*n),this.linearRampToValueAtTime(t,e+n),this}setTargetAtTime(t,e,n){const s=this._fromType(t);N0(isFinite(n)&&n>0,"timeConstant must be a number greater than 0");const i=this.toSeconds(e);return this._assertRange(s),N0(isFinite(s)&&isFinite(i),`Invalid argument(s) to setTargetAtTime: ${JSON.stringify(t)}, ${JSON.stringify(e)}`),this._events.add({constant:n,time:i,type:"setTargetAtTime",value:s}),this.log(this.units,"setTargetAtTime",t,i,n),this._param.setTargetAtTime(s,i,n),this}setValueCurveAtTime(t,e,n,s=1){n=this.toSeconds(n),e=this.toSeconds(e);const i=this._fromType(t[0])*s;this.setValueAtTime(this._toType(i),e);const r=n/(t.length-1);for(let o=1;o<t.length;o++){const n=this._fromType(t[o])*s;this.linearRampToValueAtTime(this._toType(n),e+o*r)}return this}cancelScheduledValues(t){const e=this.toSeconds(t);return N0(isFinite(e),`Invalid argument to cancelScheduledValues: ${JSON.stringify(t)}`),this._events.cancel(e),this._param.cancelScheduledValues(e),this.log(this.units,"cancelScheduledValues",e),this}cancelAndHoldAtTime(t){const e=this.toSeconds(t),n=this._fromType(this.getValueAtTime(e));N0(isFinite(e),`Invalid argument to cancelAndHoldAtTime: ${JSON.stringify(t)}`),this.log(this.units,"cancelAndHoldAtTime",e,"value="+n);const s=this._events.get(e),i=this._events.getAfter(e);return s&&g1(s.time,e)?i?(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time)):(this._param.cancelAndHoldAtTime(e),this._events.cancel(e+this.sampleTime)):i&&(this._param.cancelScheduledValues(i.time),this._events.cancel(i.time),"linearRampToValueAtTime"===i.type?this.linearRampToValueAtTime(this._toType(n),e):"exponentialRampToValueAtTime"===i.type&&this.exponentialRampToValueAtTime(this._toType(n),e)),this._events.add({time:e,type:"setValueAtTime",value:n}),this._param.setValueAtTime(n,e),this}rampTo(t,e=.1,n){return"frequency"===this.units||"bpm"===this.units||"decibels"===this.units?this.exponentialRampTo(t,e,n):this.linearRampTo(t,e,n),this}apply(t){const e=this.context.currentTime;t.setValueAtTime(this.getValueAtTime(e),e);const n=this._events.get(e);if(n&&"setTargetAtTime"===n.type){const s=this._events.getAfter(n.time),i=s?s.time:e+2,r=(i-e)/10;for(let n=e;n<i;n+=r)t.linearRampToValueAtTime(this.getValueAtTime(n),n)}return this._events.forEachAfter(this.context.currentTime,(e=>{"cancelScheduledValues"===e.type?t.cancelScheduledValues(e.time):"setTargetAtTime"===e.type?t.setTargetAtTime(e.value,e.time,e.constant):t[e.type](e.value,e.time)})),this}setParam(t){N0(this._swappable,"The Param must be assigned as 'swappable' in the constructor");const e=this.input;return e.disconnect(this._param),this.apply(t),this._param=t,e.connect(this._param),this}dispose(){return super.dispose(),this._events.dispose(),this}get defaultValue(){return this._toType(this._param.defaultValue)}_exponentialApproach(t,e,n,s,i){return n+(e-n)*Math.exp(-(i-t)/s)}_linearInterpolate(t,e,n,s,i){return e+(i-t)/(n-t)*(s-e)}_exponentialInterpolate(t,e,n,s,i){return e*Math.pow(s/e,(i-t)/(n-t))}}class o2 extends s2{constructor(){super(...arguments),this.name="ToneAudioNode",this._internalChannels=[]}get numberOfInputs(){return F0(this.input)?J0(this.input)||this.input instanceof r2?1:this.input.numberOfInputs:0}get numberOfOutputs(){return F0(this.output)?this.output.numberOfOutputs:0}_isAudioNode(t){return F0(t)&&(t instanceof o2||t1(t))}_getInternalNodes(){const t=this._internalChannels.slice(0);return this._isAudioNode(this.input)&&t.push(this.input),this._isAudioNode(this.output)&&this.input!==this.output&&t.push(this.output),t}_setChannelProperties(t){const e=this._getInternalNodes();e.forEach((e=>{e.channelCount=t.channelCount,e.channelCountMode=t.channelCountMode,e.channelInterpretation=t.channelInterpretation}))}_getChannelProperties(){const t=this._getInternalNodes();N0(t.length>0,"ToneAudioNode does not have any internal nodes");const e=t[0];return{channelCount:e.channelCount,channelCountMode:e.channelCountMode,channelInterpretation:e.channelInterpretation}}get channelCount(){return this._getChannelProperties().channelCount}set channelCount(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCount:t}))}get channelCountMode(){return this._getChannelProperties().channelCountMode}set channelCountMode(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelCountMode:t}))}get channelInterpretation(){return this._getChannelProperties().channelInterpretation}set channelInterpretation(t){const e=this._getChannelProperties();this._setChannelProperties(Object.assign(e,{channelInterpretation:t}))}connect(t,e=0,n=0){return u2(this,t,e,n),this}toDestination(){return this.connect(this.context.destination),this}toMaster(){return M0("toMaster() has been renamed toDestination()"),this.toDestination()}disconnect(t,e=0,n=0){return c2(this,t,e,n),this}chain(...t){return a2(this,...t),this}fan(...t){return t.forEach((t=>this.connect(t))),this}dispose(){return super.dispose(),F0(this.input)&&(this.input instanceof o2?this.input.dispose():t1(this.input)&&this.input.disconnect()),F0(this.output)&&(this.output instanceof o2?this.output.dispose():t1(this.output)&&this.output.disconnect()),this._internalChannels=[],this}}function a2(...t){const e=t.shift();t.reduce(((t,e)=>(t instanceof o2?t.connect(e):t1(t)&&u2(t,e),e)),e)}function u2(t,e,n=0,s=0){N0(F0(t),"Cannot connect from undefined node"),N0(F0(e),"Cannot connect to undefined node"),(e instanceof o2||t1(e))&&N0(e.numberOfInputs>0,"Cannot connect to node with no inputs"),N0(t.numberOfOutputs>0,"Cannot connect from node with no outputs");while(e instanceof o2||e instanceof r2)F0(e.input)&&(e=e.input);while(t instanceof o2)F0(t.output)&&(t=t.output);J0(e)?t.connect(e,n):t.connect(e,n,s)}function c2(t,e,n=0,s=0){if(F0(e))while(e instanceof o2)e=e.input;while(!t1(t))F0(t.output)&&(t=t.output);J0(e)?t.disconnect(e,n):t1(e)?t.disconnect(e,n,s):t.disconnect()}class l2 extends o2{constructor(){super(a1(l2.getDefaults(),arguments,["gain","units"])),this.name="Gain",this._gainNode=this.context.createGain(),this.input=this._gainNode,this.output=this._gainNode;const t=a1(l2.getDefaults(),arguments,["gain","units"]);this.gain=new r2({context:this.context,convert:t.convert,param:this._gainNode.gain,units:t.units,value:t.gain,minValue:t.minValue,maxValue:t.maxValue}),N1(this,"gain")}static getDefaults(){return Object.assign(o2.getDefaults(),{convert:!0,gain:1,units:"gain"})}dispose(){return super.dispose(),this._gainNode.disconnect(),this.gain.dispose(),this}}class h2 extends o2{constructor(t){super(t),this.onended=O1,this._startTime=-1,this._stopTime=-1,this._timeout=-1,this.output=new l2({context:this.context,gain:0}),this._gainNode=this.output,this.getStateAtTime=function(t){const e=this.toSeconds(t);return-1!==this._startTime&&e>=this._startTime&&(-1===this._stopTime||e<=this._stopTime)?"started":"stopped"},this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut,this._curve=t.curve,this.onended=t.onended}static getDefaults(){return Object.assign(o2.getDefaults(),{curve:"linear",fadeIn:0,fadeOut:0,onended:O1})}_startGain(t,e=1){N0(-1===this._startTime,"Source cannot be started more than once");const n=this.toSeconds(this._fadeIn);return this._startTime=t+n,this._startTime=Math.max(this._startTime,this.context.currentTime),n>0?(this._gainNode.gain.setValueAtTime(0,t),"linear"===this._curve?this._gainNode.gain.linearRampToValueAtTime(e,t+n):this._gainNode.gain.exponentialApproachValueAtTime(e,t,n)):this._gainNode.gain.setValueAtTime(e,t),this}stop(t){return this.log("stop",t),this._stopGain(this.toSeconds(t)),this}_stopGain(t){N0(-1!==this._startTime,"'start' must be called before 'stop'"),this.cancelStop();const e=this.toSeconds(this._fadeOut);return this._stopTime=this.toSeconds(t)+e,this._stopTime=Math.max(this._stopTime,this.context.currentTime),e>0?"linear"===this._curve?this._gainNode.gain.linearRampTo(0,e,t):this._gainNode.gain.targetRampTo(0,e,t):(this._gainNode.gain.cancelAndHoldAtTime(t),this._gainNode.gain.setValueAtTime(0,t)),this.context.clearTimeout(this._timeout),this._timeout=this.context.setTimeout((()=>{const t="exponential"===this._curve?2*e:0;this._stopSource(this.now()+t),this._onended()}),this._stopTime-this.context.currentTime),this}_onended(){if(this.onended!==O1&&(this.onended(this),this.onended=O1,!this.context.isOffline)){const t=()=>this.dispose();"undefined"!==typeof window.requestIdleCallback?window.requestIdleCallback(t):setTimeout(t,1e3)}}get state(){return this.getStateAtTime(this.now())}cancelStop(){return this.log("cancelStop"),N0(-1!==this._startTime,"Source is not started"),this._gainNode.gain.cancelScheduledValues(this._startTime+this.sampleTime),this.context.clearTimeout(this._timeout),this._stopTime=-1,this}dispose(){return super.dispose(),this._gainNode.disconnect(),this}}class p2 extends h2{constructor(){super(a1(p2.getDefaults(),arguments,["offset"])),this.name="ToneConstantSource",this._source=this.context.createConstantSource();const t=a1(p2.getDefaults(),arguments,["offset"]);u2(this._source,this._gainNode),this.offset=new r2({context:this.context,convert:t.convert,param:this._source.offset,units:t.units,value:t.offset,minValue:t.minValue,maxValue:t.maxValue})}static getDefaults(){return Object.assign(h2.getDefaults(),{convert:!0,offset:1,units:"number"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._source.start(e),this}_stopSource(t){this._source.stop(t)}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._source.disconnect(),this.offset.dispose(),this}}class d2 extends o2{constructor(){super(a1(d2.getDefaults(),arguments,["value","units"])),this.name="Signal",this.override=!0;const t=a1(d2.getDefaults(),arguments,["value","units"]);this.output=this._constantSource=new p2({context:this.context,convert:t.convert,offset:t.value,units:t.units,minValue:t.minValue,maxValue:t.maxValue}),this._constantSource.start(0),this.input=this._param=this._constantSource.offset}static getDefaults(){return Object.assign(o2.getDefaults(),{convert:!0,units:"number",value:0})}connect(t,e=0,n=0){return f2(this,t,e,n),this}dispose(){return super.dispose(),this._param.dispose(),this._constantSource.dispose(),this}setValueAtTime(t,e){return this._param.setValueAtTime(t,e),this}getValueAtTime(t){return this._param.getValueAtTime(t)}setRampPoint(t){return this._param.setRampPoint(t),this}linearRampToValueAtTime(t,e){return this._param.linearRampToValueAtTime(t,e),this}exponentialRampToValueAtTime(t,e){return this._param.exponentialRampToValueAtTime(t,e),this}exponentialRampTo(t,e,n){return this._param.exponentialRampTo(t,e,n),this}linearRampTo(t,e,n){return this._param.linearRampTo(t,e,n),this}targetRampTo(t,e,n){return this._param.targetRampTo(t,e,n),this}exponentialApproachValueAtTime(t,e,n){return this._param.exponentialApproachValueAtTime(t,e,n),this}setTargetAtTime(t,e,n){return this._param.setTargetAtTime(t,e,n),this}setValueCurveAtTime(t,e,n,s){return this._param.setValueCurveAtTime(t,e,n,s),this}cancelScheduledValues(t){return this._param.cancelScheduledValues(t),this}cancelAndHoldAtTime(t){return this._param.cancelAndHoldAtTime(t),this}rampTo(t,e,n){return this._param.rampTo(t,e,n),this}get value(){return this._param.value}set value(t){this._param.value=t}get convert(){return this._param.convert}set convert(t){this._param.convert=t}get units(){return this._param.units}get overridden(){return this._param.overridden}set overridden(t){this._param.overridden=t}get maxValue(){return this._param.maxValue}get minValue(){return this._param.minValue}apply(t){return this._param.apply(t),this}}function f2(t,e,n,s){(e instanceof r2||J0(e)||e instanceof d2&&e.override)&&(e.cancelScheduledValues(0),e.setValueAtTime(0,0),e instanceof d2&&(e.overridden=!0)),u2(t,e,n,s)}class m2 extends r2{constructor(){super(a1(m2.getDefaults(),arguments,["value"])),this.name="TickParam",this._events=new b1(1/0),this._multiplier=1;const t=a1(m2.getDefaults(),arguments,["value"]);this._multiplier=t.multiplier,this._events.cancel(0),this._events.add({ticks:0,time:0,type:"setValueAtTime",value:this._fromType(t.value)}),this.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(r2.getDefaults(),{multiplier:1,units:"hertz",value:1})}setTargetAtTime(t,e,n){e=this.toSeconds(e),this.setRampPoint(e);const s=this._fromType(t),i=this._events.get(e),r=Math.round(Math.max(1/n,1));for(let o=0;o<=r;o++){const t=n*o+e,r=this._exponentialApproach(i.time,i.value,s,n,t);this.linearRampToValueAtTime(this._toType(r),t)}return this}setValueAtTime(t,e){const n=this.toSeconds(e);super.setValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}linearRampToValueAtTime(t,e){const n=this.toSeconds(e);super.linearRampToValueAtTime(t,e);const s=this._events.get(n),i=this._events.previousEvent(s),r=this._getTicksUntilEvent(i,n);return s.ticks=Math.max(r,0),this}exponentialRampToValueAtTime(t,e){e=this.toSeconds(e);const n=this._fromType(t),s=this._events.get(e),i=Math.round(Math.max(10*(e-s.time),1)),r=(e-s.time)/i;for(let o=0;o<=i;o++){const t=r*o+s.time,i=this._exponentialInterpolate(s.time,s.value,e,n,t);this.linearRampToValueAtTime(this._toType(i),t)}return this}_getTicksUntilEvent(t,e){if(null===t)t={ticks:0,time:0,type:"setValueAtTime",value:0};else if(P0(t.ticks)){const e=this._events.previousEvent(t);t.ticks=this._getTicksUntilEvent(e,t.time)}const n=this._fromType(this.getValueAtTime(t.time));let s=this._fromType(this.getValueAtTime(e));const i=this._events.get(e);return i&&i.time===e&&"setValueAtTime"===i.type&&(s=this._fromType(this.getValueAtTime(e-this.sampleTime))),.5*(e-t.time)*(n+s)+t.ticks}getTicksAtTime(t){const e=this.toSeconds(t),n=this._events.get(e);return Math.max(this._getTicksUntilEvent(n,e),0)}getDurationOfTicks(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(e);return this.getTimeOfTick(s+t)-n}getTimeOfTick(t){const e=this._events.get(t,"ticks"),n=this._events.getAfter(t,"ticks");if(e&&e.ticks===t)return e.time;if(e&&n&&"linearRampToValueAtTime"===n.type&&e.value!==n.value){const s=this._fromType(this.getValueAtTime(e.time)),i=this._fromType(this.getValueAtTime(n.time)),r=(i-s)/(n.time-e.time),o=Math.sqrt(Math.pow(s,2)-2*r*(e.ticks-t)),a=(-s+o)/r,u=(-s-o)/r;return(a>0?a:u)+e.time}return e?0===e.value?1/0:e.time+(t-e.ticks)/e.value:t/this._initialValue}ticksToTime(t,e){return this.getDurationOfTicks(t,e)}timeToTicks(t,e){const n=this.toSeconds(e),s=this.toSeconds(t),i=this.getTicksAtTime(n),r=this.getTicksAtTime(n+s);return r-i}_fromType(t){return"bpm"===this.units&&this.multiplier?1/(60/t/this.multiplier):super._fromType(t)}_toType(t){return"bpm"===this.units&&this.multiplier?t/this.multiplier*60:super._toType(t)}get multiplier(){return this._multiplier}set multiplier(t){const e=this.value;this._multiplier=t,this.cancelScheduledValues(0),this.setValueAtTime(e,0)}}class g2 extends d2{constructor(){super(a1(g2.getDefaults(),arguments,["value"])),this.name="TickSignal";const t=a1(g2.getDefaults(),arguments,["value"]);this.input=this._param=new m2({context:this.context,convert:t.convert,multiplier:t.multiplier,param:this._constantSource.offset,units:t.units,value:t.value})}static getDefaults(){return Object.assign(d2.getDefaults(),{multiplier:1,units:"hertz",value:1})}ticksToTime(t,e){return this._param.ticksToTime(t,e)}timeToTicks(t,e){return this._param.timeToTicks(t,e)}getTimeOfTick(t){return this._param.getTimeOfTick(t)}getDurationOfTicks(t,e){return this._param.getDurationOfTicks(t,e)}getTicksAtTime(t){return this._param.getTicksAtTime(t)}get multiplier(){return this._param.multiplier}set multiplier(t){this._param.multiplier=t}dispose(){return super.dispose(),this._param.dispose(),this}}class y2 extends s2{constructor(){super(a1(y2.getDefaults(),arguments,["frequency"])),this.name="TickSource",this._state=new i2,this._tickOffset=new b1;const t=a1(y2.getDefaults(),arguments,["frequency"]);this.frequency=new g2({context:this.context,units:t.units,value:t.frequency}),N1(this,"frequency"),this._state.setStateAtTime("stopped",0),this.setTicksAtTime(0,0)}static getDefaults(){return Object.assign({frequency:1,units:"hertz"},s2.getDefaults())}get state(){return this.getStateAtTime(this.now())}start(t,e){const n=this.toSeconds(t);return"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),F0(e)&&this.setTicksAtTime(e,n)),this}stop(t){const e=this.toSeconds(t);if("stopped"===this._state.getValueAtTime(e)){const t=this._state.get(e);t&&t.time>0&&(this._tickOffset.cancel(t.time),this._state.cancel(t.time))}return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this.setTicksAtTime(0,e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&this._state.setStateAtTime("paused",e),this}cancel(t){return t=this.toSeconds(t),this._state.cancel(t),this._tickOffset.cancel(t),this}getTicksAtTime(t){const e=this.toSeconds(t),n=this._state.getLastState("stopped",e),s={state:"paused",time:e};this._state.add(s);let i=n,r=0;return this._state.forEachBetween(n.time,e+this.sampleTime,(t=>{let e=i.time;const n=this._tickOffset.get(t.time);n&&n.time>=i.time&&(r=n.ticks,e=n.time),"started"===i.state&&"started"!==t.state&&(r+=this.frequency.getTicksAtTime(t.time)-this.frequency.getTicksAtTime(e)),i=t})),this._state.remove(s),r}get ticks(){return this.getTicksAtTime(this.now())}set ticks(t){this.setTicksAtTime(t,this.now())}get seconds(){return this.getSecondsAtTime(this.now())}set seconds(t){const e=this.now(),n=this.frequency.timeToTicks(t,e);this.setTicksAtTime(n,e)}getSecondsAtTime(t){t=this.toSeconds(t);const e=this._state.getLastState("stopped",t),n={state:"paused",time:t};this._state.add(n);let s=e,i=0;return this._state.forEachBetween(e.time,t+this.sampleTime,(t=>{let e=s.time;const n=this._tickOffset.get(t.time);n&&n.time>=s.time&&(i=n.seconds,e=n.time),"started"===s.state&&"started"!==t.state&&(i+=t.time-e),s=t})),this._state.remove(n),i}setTicksAtTime(t,e){return e=this.toSeconds(e),this._tickOffset.cancel(e),this._tickOffset.add({seconds:this.frequency.getDurationOfTicks(t,e),ticks:t,time:e}),this}getStateAtTime(t){return t=this.toSeconds(t),this._state.getValueAtTime(t)}getTimeOfTick(t,e=this.now()){const n=this._tickOffset.get(e),s=this._state.get(e),i=Math.max(n.time,s.time),r=this.frequency.getTicksAtTime(i)+t-n.ticks;return this.frequency.getTimeOfTick(r)}forEachTickBetween(t,e,n){let s=this._state.get(t);this._state.forEachBetween(t,e,(e=>{s&&"started"===s.state&&"started"!==e.state&&this.forEachTickBetween(Math.max(s.time,t),e.time-this.sampleTime,n),s=e}));let i=null;if(s&&"started"===s.state){const o=Math.max(s.time,t),a=this.frequency.getTicksAtTime(o),u=this.frequency.getTicksAtTime(s.time),c=a-u;let l=Math.ceil(c)-c;l=g1(l,1)?0:l;let h=this.frequency.getTimeOfTick(a+l);while(h<e){try{n(h,Math.round(this.getTicksAtTime(h)))}catch(r){i=r;break}h+=this.frequency.getDurationOfTicks(1,h)}}if(i)throw i;return this}dispose(){return super.dispose(),this._state.dispose(),this._tickOffset.dispose(),this.frequency.dispose(),this}}class b2 extends s2{constructor(){super(a1(b2.getDefaults(),arguments,["callback","frequency"])),this.name="Clock",this.callback=O1,this._lastUpdate=0,this._state=new i2("stopped"),this._boundLoop=this._loop.bind(this);const t=a1(b2.getDefaults(),arguments,["callback","frequency"]);this.callback=t.callback,this._tickSource=new y2({context:this.context,frequency:t.frequency,units:t.units}),this._lastUpdate=0,this.frequency=this._tickSource.frequency,N1(this,"frequency"),this._state.setStateAtTime("stopped",0),this.context.on("tick",this._boundLoop)}static getDefaults(){return Object.assign(s2.getDefaults(),{callback:O1,frequency:1,units:"hertz"})}get state(){return this._state.getValueAtTime(this.now())}start(t,e){O0(this.context);const n=this.toSeconds(t);return this.log("start",n),"started"!==this._state.getValueAtTime(n)&&(this._state.setStateAtTime("started",n),this._tickSource.start(n,e),n<this._lastUpdate&&this.emit("start",n,e)),this}stop(t){const e=this.toSeconds(t);return this.log("stop",e),this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._tickSource.stop(e),e<this._lastUpdate&&this.emit("stop",e),this}pause(t){const e=this.toSeconds(t);return"started"===this._state.getValueAtTime(e)&&(this._state.setStateAtTime("paused",e),this._tickSource.pause(e),e<this._lastUpdate&&this.emit("pause",e)),this}get ticks(){return Math.ceil(this.getTicksAtTime(this.now()))}set ticks(t){this._tickSource.ticks=t}get seconds(){return this._tickSource.seconds}set seconds(t){this._tickSource.seconds=t}getSecondsAtTime(t){return this._tickSource.getSecondsAtTime(t)}setTicksAtTime(t,e){return this._tickSource.setTicksAtTime(t,e),this}getTimeOfTick(t,e=this.now()){return this._tickSource.getTimeOfTick(t,e)}getTicksAtTime(t){return this._tickSource.getTicksAtTime(t)}nextTickTime(t,e){const n=this.toSeconds(e),s=this.getTicksAtTime(n);return this._tickSource.getTimeOfTick(s+t,n)}_loop(){const t=this._lastUpdate,e=this.now();this._lastUpdate=e,this.log("loop",t,e),t!==e&&(this._state.forEachBetween(t,e,(t=>{switch(t.state){case"started":const e=this._tickSource.getTicksAtTime(t.time);this.emit("start",t.time,e);break;case"stopped":0!==t.time&&this.emit("stop",t.time);break;case"paused":this.emit("pause",t.time);break}})),this._tickSource.forEachTickBetween(t,e,((t,e)=>{this.callback(t,e)})))}getStateAtTime(t){const e=this.toSeconds(t);return this._state.getValueAtTime(e)}dispose(){return super.dispose(),this.context.off("tick",this._boundLoop),this._tickSource.dispose(),this._state.dispose(),this}}T1.mixin(b2);class v2 extends o2{constructor(){super(a1(v2.getDefaults(),arguments,["delayTime","maxDelay"])),this.name="Delay";const t=a1(v2.getDefaults(),arguments,["delayTime","maxDelay"]),e=this.toSeconds(t.maxDelay);this._maxDelay=Math.max(e,this.toSeconds(t.delayTime)),this._delayNode=this.input=this.output=this.context.createDelay(e),this.delayTime=new r2({context:this.context,param:this._delayNode.delayTime,units:"time",value:t.delayTime,minValue:0,maxValue:this.maxDelay}),N1(this,"delayTime")}static getDefaults(){return Object.assign(o2.getDefaults(),{delayTime:0,maxDelay:1})}get maxDelay(){return this._maxDelay}dispose(){return super.dispose(),this._delayNode.disconnect(),this.delayTime.dispose(),this}}function w2(t,e,n=2,s=P1().sampleRate){return Y0(this,void 0,void 0,(function*(){const i=P1(),r=new R1(n,e,s);F1(r),yield t(r);const o=r.render();F1(i);const a=yield o;return new $1(a)}))}class x2 extends h1{constructor(){super(),this.name="ToneAudioBuffers",this._buffers=new Map,this._loadingCount=0;const t=a1(x2.getDefaults(),arguments,["urls","onload","baseUrl"],"urls");this.baseUrl=t.baseUrl,Object.keys(t.urls).forEach((e=>{this._loadingCount++;const n=t.urls[e];this.add(e,n,this._bufferLoaded.bind(this,t.onload),t.onerror)}))}static getDefaults(){return{baseUrl:"",onerror:O1,onload:O1,urls:{}}}has(t){return this._buffers.has(t.toString())}get(t){return N0(this.has(t),`ToneAudioBuffers has no buffer named: ${t}`),this._buffers.get(t.toString())}_bufferLoaded(t){this._loadingCount--,0===this._loadingCount&&t&&t()}get loaded(){return Array.from(this._buffers).every((([t,e])=>e.loaded))}add(t,e,n=O1,s=O1){return W0(e)?this._buffers.set(t.toString(),new $1(this.baseUrl+e,n,s)):this._buffers.set(t.toString(),new $1(e,n,s)),this}dispose(){return super.dispose(),this._buffers.forEach((t=>t.dispose())),this._buffers.clear(),this}}class _2 extends Y1{constructor(){super(...arguments),this.name="MidiClass",this.defaultUnits="midi"}_frequencyToUnits(t){return U1(super._frequencyToUnits(t))}_ticksToUnits(t){return U1(super._ticksToUnits(t))}_beatsToUnits(t){return U1(super._beatsToUnits(t))}_secondsToUnits(t){return U1(super._secondsToUnits(t))}toMidi(){return this.valueOf()}toFrequency(){return H1(this.toMidi())}transpose(t){return new _2(this.context,this.toMidi()+t)}}function k2(t,e){return new _2(P1(),t,e)}class S2 extends e2{constructor(){super(...arguments),this.name="Ticks",this.defaultUnits="i"}_now(){return this.context.transport.ticks}_beatsToUnits(t){return this._getPPQ()*t}_secondsToUnits(t){return Math.floor(t/(60/this._getBpm())*this._getPPQ())}_ticksToUnits(t){return t}toTicks(){return this.valueOf()}toSeconds(){return this.valueOf()/this._getPPQ()*(60/this._getBpm())}}function T2(t,e){return new S2(P1(),t,e)}class I2 extends s2{constructor(){super(...arguments),this.name="Draw",this.expiration=.25,this.anticipation=.008,this._events=new b1,this._boundDrawLoop=this._drawLoop.bind(this),this._animationFrame=-1}schedule(t,e){return this._events.add({callback:t,time:this.toSeconds(e)}),1===this._events.length&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop)),this}cancel(t){return this._events.cancel(this.toSeconds(t)),this}_drawLoop(){const t=this.context.currentTime;while(this._events.length&&this._events.peek().time-this.anticipation<=t){const e=this._events.shift();e&&t-e.time<=this.expiration&&e.callback()}this._events.length>0&&(this._animationFrame=requestAnimationFrame(this._boundDrawLoop))}dispose(){return super.dispose(),this._events.dispose(),cancelAnimationFrame(this._animationFrame),this}}w1((t=>{t.draw=new I2({context:t})})),k1((t=>{t.draw.dispose()}));class C2 extends h1{constructor(){super(...arguments),this.name="IntervalTimeline",this._root=null,this._length=0}add(t){N0(F0(t.time),"Events must have a time property"),N0(F0(t.duration),"Events must have a duration parameter"),t.time=t.time.valueOf();let e=new A2(t.time,t.time+t.duration,t);null===this._root?this._root=e:this._root.insert(e),this._length++;while(null!==e)e.updateHeight(),e.updateMax(),this._rebalance(e),e=e.parent;return this}remove(t){if(null!==this._root){const e=[];this._root.search(t.time,e);for(const n of e)if(n.event===t){this._removeNode(n),this._length--;break}}return this}get length(){return this._length}cancel(t){return this.forEachFrom(t,(t=>this.remove(t))),this}_setRoot(t){this._root=t,null!==this._root&&(this._root.parent=null)}_replaceNodeInParent(t,e){null!==t.parent?(t.isLeftChild()?t.parent.left=e:t.parent.right=e,this._rebalance(t.parent)):this._setRoot(e)}_removeNode(t){if(null===t.left&&null===t.right)this._replaceNodeInParent(t,null);else if(null===t.right)this._replaceNodeInParent(t,t.left);else if(null===t.left)this._replaceNodeInParent(t,t.right);else{const e=t.getBalance();let n,s=null;if(e>0)if(null===t.left.right)n=t.left,n.right=t.right,s=n;else{n=t.left.right;while(null!==n.right)n=n.right;n.parent&&(n.parent.right=n.left,s=n.parent,n.left=t.left,n.right=t.right)}else if(null===t.right.left)n=t.right,n.left=t.left,s=n;else{n=t.right.left;while(null!==n.left)n=n.left;n.parent&&(n.parent.left=n.right,s=n.parent,n.left=t.left,n.right=t.right)}null!==t.parent?t.isLeftChild()?t.parent.left=n:t.parent.right=n:this._setRoot(n),s&&this._rebalance(s)}t.dispose()}_rotateLeft(t){const e=t.parent,n=t.isLeftChild(),s=t.right;s&&(t.right=s.left,s.left=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rotateRight(t){const e=t.parent,n=t.isLeftChild(),s=t.left;s&&(t.left=s.right,s.right=t),null!==e?n?e.left=s:e.right=s:this._setRoot(s)}_rebalance(t){const e=t.getBalance();e>1&&t.left?t.left.getBalance()<0?this._rotateLeft(t.left):this._rotateRight(t):e<-1&&t.right&&(t.right.getBalance()>0?this._rotateRight(t.right):this._rotateLeft(t))}get(t){if(null!==this._root){const e=[];if(this._root.search(t,e),e.length>0){let t=e[0];for(let n=1;n<e.length;n++)e[n].low>t.low&&(t=e[n]);return t.event}}return null}forEach(t){if(null!==this._root){const e=[];this._root.traverse((t=>e.push(t))),e.forEach((e=>{e.event&&t(e.event)}))}return this}forEachAtTime(t,e){if(null!==this._root){const n=[];this._root.search(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}forEachFrom(t,e){if(null!==this._root){const n=[];this._root.searchAfter(t,n),n.forEach((t=>{t.event&&e(t.event)}))}return this}dispose(){return super.dispose(),null!==this._root&&this._root.traverse((t=>t.dispose())),this._root=null,this}}class A2{constructor(t,e,n){this._left=null,this._right=null,this.parent=null,this.height=0,this.event=n,this.low=t,this.high=e,this.max=this.high}insert(t){t.low<=this.low?null===this.left?this.left=t:this.left.insert(t):null===this.right?this.right=t:this.right.insert(t)}search(t,e){t>this.max||(null!==this.left&&this.left.search(t,e),this.low<=t&&this.high>t&&e.push(this),this.low>t||null!==this.right&&this.right.search(t,e))}searchAfter(t,e){this.low>=t&&(e.push(this),null!==this.left&&this.left.searchAfter(t,e)),null!==this.right&&this.right.searchAfter(t,e)}traverse(t){t(this),null!==this.left&&this.left.traverse(t),null!==this.right&&this.right.traverse(t)}updateHeight(){null!==this.left&&null!==this.right?this.height=Math.max(this.left.height,this.right.height)+1:null!==this.right?this.height=this.right.height+1:null!==this.left?this.height=this.left.height+1:this.height=0}updateMax(){this.max=this.high,null!==this.left&&(this.max=Math.max(this.max,this.left.max)),null!==this.right&&(this.max=Math.max(this.max,this.right.max))}getBalance(){let t=0;return null!==this.left&&null!==this.right?t=this.left.height-this.right.height:null!==this.left?t=this.left.height+1:null!==this.right&&(t=-(this.right.height+1)),t}isLeftChild(){return null!==this.parent&&this.parent.left===this}get left(){return this._left}set left(t){this._left=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}get right(){return this._right}set right(t){this._right=t,null!==t&&(t.parent=this),this.updateHeight(),this.updateMax()}dispose(){this.parent=null,this._left=null,this._right=null,this.event=null}}class N2 extends o2{constructor(){super(a1(N2.getDefaults(),arguments,["volume"])),this.name="Volume";const t=a1(N2.getDefaults(),arguments,["volume"]);this.input=this.output=new l2({context:this.context,gain:t.volume,units:"decibels"}),this.volume=this.output.gain,N1(this,"volume"),this._unmutedVolume=t.volume,this.mute=t.mute}static getDefaults(){return Object.assign(o2.getDefaults(),{mute:!1,volume:0})}get mute(){return this.volume.value===-1/0}set mute(t){!this.mute&&t?(this._unmutedVolume=this.volume.value,this.volume.value=-1/0):this.mute&&!t&&(this.volume.value=this._unmutedVolume)}dispose(){return super.dispose(),this.input.dispose(),this.volume.dispose(),this}}class E2 extends o2{constructor(){super(a1(E2.getDefaults(),arguments)),this.name="Destination",this.input=new N2({context:this.context}),this.output=new l2({context:this.context}),this.volume=this.input.volume;const t=a1(E2.getDefaults(),arguments);a2(this.input,this.output,this.context.rawContext.destination),this.mute=t.mute,this._internalChannels=[this.input,this.context.rawContext.destination,this.output]}static getDefaults(){return Object.assign(o2.getDefaults(),{mute:!1,volume:0})}get mute(){return this.input.mute}set mute(t){this.input.mute=t}chain(...t){return this.input.disconnect(),t.unshift(this.input),t.push(this.output),a2(...t),this}get maxChannelCount(){return this.context.rawContext.destination.maxChannelCount}dispose(){return super.dispose(),this.volume.dispose(),this}}w1((t=>{t.destination=new E2({context:t})})),k1((t=>{t.destination.dispose()}));class O2 extends h1{constructor(t){super(),this.name="TimelineValue",this._timeline=new b1({memory:10}),this._initialValue=t}set(t,e){return this._timeline.add({value:t,time:e}),this}get(t){const e=this._timeline.get(t);return e?e.value:this._initialValue}}class $2{constructor(t,e){this.id=$2._eventId++;const n=Object.assign($2.getDefaults(),e);this.transport=t,this.callback=n.callback,this._once=n.once,this.time=n.time}static getDefaults(){return{callback:O1,once:!1,time:0}}invoke(t){this.callback&&(this.callback(t),this._once&&this.transport.clear(this.id))}dispose(){return this.callback=void 0,this}}$2._eventId=0;class R2 extends $2{constructor(t,e){super(t,e),this._currentId=-1,this._nextId=-1,this._nextTick=this.time,this._boundRestart=this._restart.bind(this);const n=Object.assign(R2.getDefaults(),e);this.duration=new S2(t.context,n.duration).valueOf(),this._interval=new S2(t.context,n.interval).valueOf(),this._nextTick=n.time,this.transport.on("start",this._boundRestart),this.transport.on("loopStart",this._boundRestart),this.context=this.transport.context,this._restart()}static getDefaults(){return Object.assign({},$2.getDefaults(),{duration:1/0,interval:1,once:!1})}invoke(t){this._createEvents(t),super.invoke(t)}_createEvents(t){const e=this.transport.getTicksAtTime(t);e>=this.time&&e>=this._nextTick&&this._nextTick+this._interval<this.time+this.duration&&(this._nextTick+=this._interval,this._currentId=this._nextId,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new S2(this.context,this._nextTick).toSeconds()))}_restart(t){this.transport.clear(this._currentId),this.transport.clear(this._nextId),this._nextTick=this.time;const e=this.transport.getTicksAtTime(t);e>this.time&&(this._nextTick=this.time+Math.ceil((e-this.time)/this._interval)*this._interval),this._currentId=this.transport.scheduleOnce(this.invoke.bind(this),new S2(this.context,this._nextTick).toSeconds()),this._nextTick+=this._interval,this._nextId=this.transport.scheduleOnce(this.invoke.bind(this),new S2(this.context,this._nextTick).toSeconds())}dispose(){return super.dispose(),this.transport.clear(this._currentId),this.transport.clear(this._nextId),this.transport.off("start",this._boundRestart),this.transport.off("loopStart",this._boundRestart),this}}class D2 extends s2{constructor(){super(a1(D2.getDefaults(),arguments)),this.name="Transport",this._loop=new O2(!1),this._loopStart=0,this._loopEnd=0,this._scheduledEvents={},this._timeline=new b1,this._repeatedEvents=new C2,this._syncedSignals=[],this._swingAmount=0;const t=a1(D2.getDefaults(),arguments);this._ppq=t.ppq,this._clock=new b2({callback:this._processTick.bind(this),context:this.context,frequency:0,units:"bpm"}),this._bindClockEvents(),this.bpm=this._clock.frequency,this._clock.frequency.multiplier=t.ppq,this.bpm.setValueAtTime(t.bpm,0),N1(this,"bpm"),this._timeSignature=t.timeSignature,this._swingTicks=t.ppq/2}static getDefaults(){return Object.assign(s2.getDefaults(),{bpm:120,loopEnd:"4m",loopStart:0,ppq:192,swing:0,swingSubdivision:"8n",timeSignature:4})}_processTick(t,e){if(this._loop.get(t)&&e>=this._loopEnd&&(this.emit("loopEnd",t),this._clock.setTicksAtTime(this._loopStart,t),e=this._loopStart,this.emit("loopStart",t,this._clock.getSecondsAtTime(t)),this.emit("loop",t)),this._swingAmount>0&&e%this._ppq!==0&&e%(2*this._swingTicks)!==0){const n=e%(2*this._swingTicks)/(2*this._swingTicks),s=Math.sin(n*Math.PI)*this._swingAmount;t+=new S2(this.context,2*this._swingTicks/3).toSeconds()*s}this._timeline.forEachAtTime(e,(e=>e.invoke(t)))}schedule(t,e){const n=new $2(this,{callback:t,time:new e2(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}scheduleRepeat(t,e,n,s=1/0){const i=new R2(this,{callback:t,duration:new X1(this.context,s).toTicks(),interval:new X1(this.context,e).toTicks(),time:new e2(this.context,n).toTicks()});return this._addEvent(i,this._repeatedEvents)}scheduleOnce(t,e){const n=new $2(this,{callback:t,once:!0,time:new e2(this.context,e).toTicks()});return this._addEvent(n,this._timeline)}clear(t){if(this._scheduledEvents.hasOwnProperty(t)){const e=this._scheduledEvents[t.toString()];e.timeline.remove(e.event),e.event.dispose(),delete this._scheduledEvents[t.toString()]}return this}_addEvent(t,e){return this._scheduledEvents[t.id.toString()]={event:t,timeline:e},e.add(t),t.id}cancel(t=0){const e=this.toTicks(t);return this._timeline.forEachFrom(e,(t=>this.clear(t.id))),this._repeatedEvents.forEachFrom(e,(t=>this.clear(t.id))),this}_bindClockEvents(){this._clock.on("start",((t,e)=>{e=new S2(this.context,e).toSeconds(),this.emit("start",t,e)})),this._clock.on("stop",(t=>{this.emit("stop",t)})),this._clock.on("pause",(t=>{this.emit("pause",t)}))}get state(){return this._clock.getStateAtTime(this.now())}start(t,e){let n;return F0(e)&&(n=this.toTicks(e)),this._clock.start(t,n),this}stop(t){return this._clock.stop(t),this}pause(t){return this._clock.pause(t),this}toggle(t){return t=this.toSeconds(t),"started"!==this._clock.getStateAtTime(t)?this.start(t):this.stop(t),this}get timeSignature(){return this._timeSignature}set timeSignature(t){V0(t)&&(t=t[0]/t[1]*4),this._timeSignature=t}get loopStart(){return new X1(this.context,this._loopStart,"i").toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t)}get loopEnd(){return new X1(this.context,this._loopEnd,"i").toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t)}get loop(){return this._loop.get(this.now())}set loop(t){this._loop.set(t,this.now())}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get swing(){return this._swingAmount}set swing(t){this._swingAmount=t}get swingSubdivision(){return new S2(this.context,this._swingTicks).toNotation()}set swingSubdivision(t){this._swingTicks=this.toTicks(t)}get position(){const t=this.now(),e=this._clock.getTicksAtTime(t);return new S2(this.context,e).toBarsBeatsSixteenths()}set position(t){const e=this.toTicks(t);this.ticks=e}get seconds(){return this._clock.seconds}set seconds(t){const e=this.now(),n=this._clock.frequency.timeToTicks(t,e);this.ticks=n}get progress(){if(this.loop){const t=this.now(),e=this._clock.getTicksAtTime(t);return(e-this._loopStart)/(this._loopEnd-this._loopStart)}return 0}get ticks(){return this._clock.ticks}set ticks(t){if(this._clock.ticks!==t){const e=this.now();if("started"===this.state){const n=this._clock.getTicksAtTime(e),s=this._clock.frequency.getDurationOfTicks(Math.ceil(n)-n,e),i=e+s;this.emit("stop",i),this._clock.setTicksAtTime(t,i),this.emit("start",i,this._clock.getSecondsAtTime(i))}else this._clock.setTicksAtTime(t,e)}}getTicksAtTime(t){return Math.round(this._clock.getTicksAtTime(t))}getSecondsAtTime(t){return this._clock.getSecondsAtTime(t)}get PPQ(){return this._clock.frequency.multiplier}set PPQ(t){this._clock.frequency.multiplier=t}nextSubdivision(t){if(t=this.toTicks(t),"started"!==this.state)return 0;{const e=this.now(),n=this.getTicksAtTime(e),s=t-n%t;return this._clock.nextTickTime(s,e)}}syncSignal(t,e){if(!e){const n=this.now();if(0!==t.getValueAtTime(n)){const s=this.bpm.getValueAtTime(n),i=1/(60/s/this.PPQ);e=t.getValueAtTime(n)/i}else e=0}const n=new l2(e);return this.bpm.connect(n),n.connect(t._param),this._syncedSignals.push({initial:t.value,ratio:n,signal:t}),t.value=0,this}unsyncSignal(t){for(let e=this._syncedSignals.length-1;e>=0;e--){const n=this._syncedSignals[e];n.signal===t&&(n.ratio.dispose(),n.signal.value=n.initial,this._syncedSignals.splice(e,1))}return this}dispose(){return super.dispose(),this._clock.dispose(),E1(this,"bpm"),this._timeline.dispose(),this._repeatedEvents.dispose(),this}}T1.mixin(D2),w1((t=>{t.transport=new D2({context:t})})),k1((t=>{t.transport.dispose()}));class M2 extends o2{constructor(t){super(t),this.input=void 0,this._state=new i2("stopped"),this._synced=!1,this._scheduled=[],this._syncedStart=O1,this._syncedStop=O1,this._state.memory=100,this._state.increasing=!0,this._volume=this.output=new N2({context:this.context,mute:t.mute,volume:t.volume}),this.volume=this._volume.volume,N1(this,"volume"),this.onstop=t.onstop}static getDefaults(){return Object.assign(o2.getDefaults(),{mute:!1,onstop:O1,volume:0})}get state(){return this._synced?"started"===this.context.transport.state?this._state.getValueAtTime(this.context.transport.seconds):"stopped":this._state.getValueAtTime(this.now())}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}_clampToCurrentTime(t){return this._synced?t:Math.max(t,this.context.currentTime)}start(t,e,n){let s=P0(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(s=this._clampToCurrentTime(s),this._synced||"started"!==this._state.getValueAtTime(s))if(this.log("start",s),this._state.setStateAtTime("started",s),this._synced){const t=this._state.get(s);t&&(t.offset=this.toSeconds(c1(e,0)),t.duration=n?this.toSeconds(n):void 0);const i=this.context.transport.schedule((t=>{this._start(t,e,n)}),s);this._scheduled.push(i),"started"===this.context.transport.state&&this.context.transport.getSecondsAtTime(this.immediate())>s&&this._syncedStart(this.now(),this.context.transport.seconds)}else O0(this.context),this._start(s,e,n);else N0(d1(s,this._state.get(s).time),"Start time must be strictly greater than previous start time"),this._state.cancel(s),this._state.setStateAtTime("started",s),this.log("restart",s),this.restart(s,e,n);return this}stop(t){let e=P0(t)&&this._synced?this.context.transport.seconds:this.toSeconds(t);if(e=this._clampToCurrentTime(e),"started"===this._state.getValueAtTime(e)||F0(this._state.getNextState("started",e))){if(this.log("stop",e),this._synced){const t=this.context.transport.schedule(this._stop.bind(this),e);this._scheduled.push(t)}else this._stop(e);this._state.cancel(e),this._state.setStateAtTime("stopped",e)}return this}restart(t,e,n){return t=this.toSeconds(t),"started"===this._state.getValueAtTime(t)&&(this._state.cancel(t),this._restart(t,e,n)),this}sync(){return this._synced||(this._synced=!0,this._syncedStart=(t,e)=>{if(e>0){const n=this._state.get(e);if(n&&"started"===n.state&&n.time!==e){const s=e-this.toSeconds(n.time);let i;n.duration&&(i=this.toSeconds(n.duration)-s),this._start(t,this.toSeconds(n.offset)+s,i)}}},this._syncedStop=t=>{const e=this.context.transport.getSecondsAtTime(Math.max(t-this.sampleTime,0));"started"===this._state.getValueAtTime(e)&&this._stop(t)},this.context.transport.on("start",this._syncedStart),this.context.transport.on("loopStart",this._syncedStart),this.context.transport.on("stop",this._syncedStop),this.context.transport.on("pause",this._syncedStop),this.context.transport.on("loopEnd",this._syncedStop)),this}unsync(){return this._synced&&(this.context.transport.off("stop",this._syncedStop),this.context.transport.off("pause",this._syncedStop),this.context.transport.off("loopEnd",this._syncedStop),this.context.transport.off("start",this._syncedStart),this.context.transport.off("loopStart",this._syncedStart)),this._synced=!1,this._scheduled.forEach((t=>this.context.transport.clear(t))),this._scheduled=[],this._state.cancel(0),this._stop(0),this}dispose(){return super.dispose(),this.onstop=O1,this.unsync(),this._volume.dispose(),this._state.dispose(),this}}class P2 extends h2{constructor(){super(a1(P2.getDefaults(),arguments,["url","onload"])),this.name="ToneBufferSource",this._source=this.context.createBufferSource(),this._internalChannels=[this._source],this._sourceStarted=!1,this._sourceStopped=!1;const t=a1(P2.getDefaults(),arguments,["url","onload"]);u2(this._source,this._gainNode),this._source.onended=()=>this._stopSource(),this.playbackRate=new r2({context:this.context,param:this._source.playbackRate,units:"positive",value:t.playbackRate}),this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this._buffer=new $1(t.url,t.onload,t.onerror),this._internalChannels.push(this._source)}static getDefaults(){return Object.assign(h2.getDefaults(),{url:new $1,loop:!1,loopEnd:0,loopStart:0,onload:O1,onerror:O1,playbackRate:1})}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t}get curve(){return this._curve}set curve(t){this._curve=t}start(t,e,n,s=1){N0(this.buffer.loaded,"buffer is either not set or not loaded");const i=this.toSeconds(t);this._startGain(i,s),e=this.loop?c1(e,this.loopStart):c1(e,0);let r=Math.max(this.toSeconds(e),0);if(this.loop){const t=this.toSeconds(this.loopEnd)||this.buffer.duration,e=this.toSeconds(this.loopStart),n=t-e;f1(r,t)&&(r=(r-e)%n+e),g1(r,this.buffer.duration)&&(r=0)}if(this._source.buffer=this.buffer.get(),this._source.loopEnd=this.toSeconds(this.loopEnd)||this.buffer.duration,m1(r,this.buffer.duration)&&(this._sourceStarted=!0,this._source.start(i,r)),F0(n)){let t=this.toSeconds(n);t=Math.max(t,0),this.stop(i+t)}return this}_stopSource(t){!this._sourceStopped&&this._sourceStarted&&(this._sourceStopped=!0,this._source.stop(this.toSeconds(t)),this._onended())}get loopStart(){return this._source.loopStart}set loopStart(t){this._source.loopStart=this.toSeconds(t)}get loopEnd(){return this._source.loopEnd}set loopEnd(t){this._source.loopEnd=this.toSeconds(t)}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._source.loop}set loop(t){this._source.loop=t,this._sourceStarted&&this.cancelStop()}dispose(){return super.dispose(),this._source.onended=null,this._source.disconnect(),this._buffer.dispose(),this.playbackRate.dispose(),this}}class F2 extends M2{constructor(){super(a1(F2.getDefaults(),arguments,["type"])),this.name="Noise",this._source=null;const t=a1(F2.getDefaults(),arguments,["type"]);this._playbackRate=t.playbackRate,this.type=t.type,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(M2.getDefaults(),{fadeIn:0,fadeOut:0,playbackRate:1,type:"white"})}get type(){return this._type}set type(t){if(N0(t in q2,"Noise: invalid type: "+t),this._type!==t&&(this._type=t,"started"===this.state)){const t=this.now();this._stop(t),this._start(t)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._source&&(this._source.playbackRate.value=t)}_start(t){const e=q2[this._type];this._source=new P2({url:e,context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,loop:!0,onended:()=>this.onstop(this),playbackRate:this._playbackRate}).connect(this.output),this._source.start(this.toSeconds(t),Math.random()*(e.duration-.001))}_stop(t){this._source&&(this._source.stop(this.toSeconds(t)),this._source=null)}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._source&&(this._source.fadeIn=this._fadeIn)}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._source&&(this._source.fadeOut=this._fadeOut)}_restart(t){this._stop(t),this._start(t)}dispose(){return super.dispose(),this._source&&this._source.disconnect(),this}}const L2=220500,z2=2,B2={brown:null,pink:null,white:null},q2={get brown(){if(!B2.brown){const t=[];for(let e=0;e<z2;e++){const n=new Float32Array(L2);t[e]=n;let s=0;for(let t=0;t<L2;t++){const e=2*Math.random()-1;n[t]=(s+.02*e)/1.02,s=n[t],n[t]*=3.5}}B2.brown=(new $1).fromArray(t)}return B2.brown},get pink(){if(!B2.pink){const t=[];for(let e=0;e<z2;e++){const n=new Float32Array(L2);let s,i,r,o,a,u,c;t[e]=n,s=i=r=o=a=u=c=0;for(let t=0;t<L2;t++){const e=2*Math.random()-1;s=.99886*s+.0555179*e,i=.99332*i+.0750759*e,r=.969*r+.153852*e,o=.8665*o+.3104856*e,a=.55*a+.5329522*e,u=-.7616*u-.016898*e,n[t]=s+i+r+o+a+u+c+.5362*e,n[t]*=.11,c=.115926*e}}B2.pink=(new $1).fromArray(t)}return B2.pink},get white(){if(!B2.white){const t=[];for(let e=0;e<z2;e++){const n=new Float32Array(L2);t[e]=n;for(let t=0;t<L2;t++)n[t]=2*Math.random()-1}B2.white=(new $1).fromArray(t)}return B2.white}};class V2 extends o2{constructor(){super(a1(V2.getDefaults(),arguments,["volume"])),this.name="UserMedia";const t=a1(V2.getDefaults(),arguments,["volume"]);this._volume=this.output=new N2({context:this.context,volume:t.volume}),this.volume=this._volume.volume,N1(this,"volume"),this.mute=t.mute}static getDefaults(){return Object.assign(o2.getDefaults(),{mute:!1,volume:0})}open(t){return Y0(this,void 0,void 0,(function*(){N0(V2.supported,"UserMedia is not supported"),"started"===this.state&&this.close();const e=yield V2.enumerateDevices();z0(t)?this._device=e[t]:(this._device=e.find((e=>e.label===t||e.deviceId===t)),!this._device&&e.length>0&&(this._device=e[0]),N0(F0(this._device),`No matching device ${t}`));const n={audio:{echoCancellation:!1,sampleRate:this.context.sampleRate,noiseSuppression:!1,mozNoiseSuppression:!1}};this._device&&(n.audio.deviceId=this._device.deviceId);const s=yield navigator.mediaDevices.getUserMedia(n);if(!this._stream){this._stream=s;const t=this.context.createMediaStreamSource(s);u2(t,this.output),this._mediaStream=t}return this}))}close(){return this._stream&&this._mediaStream&&(this._stream.getAudioTracks().forEach((t=>{t.stop()})),this._stream=void 0,this._mediaStream.disconnect(),this._mediaStream=void 0),this._device=void 0,this}static enumerateDevices(){return Y0(this,void 0,void 0,(function*(){const t=yield navigator.mediaDevices.enumerateDevices();return t.filter((t=>"audioinput"===t.kind))}))}get state(){return this._stream&&this._stream.active?"started":"stopped"}get deviceId(){return this._device?this._device.deviceId:void 0}get groupId(){return this._device?this._device.groupId:void 0}get label(){return this._device?this._device.label:void 0}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this.close(),this._volume.dispose(),this.volume.dispose(),this}static get supported(){return F0(navigator.mediaDevices)&&F0(navigator.mediaDevices.getUserMedia)}}function W2(t,e){return Y0(this,void 0,void 0,(function*(){const n=e/t.context.sampleRate,s=new R1(1,n,t.context.sampleRate),i=new t.constructor(Object.assign(t.get(),{frequency:2/n,detune:0,context:s})).toDestination();i.start(0);const r=yield s.render();return r.getChannelData(0)}))}class j2 extends h2{constructor(){super(a1(j2.getDefaults(),arguments,["frequency","type"])),this.name="ToneOscillatorNode",this._oscillator=this.context.createOscillator(),this._internalChannels=[this._oscillator];const t=a1(j2.getDefaults(),arguments,["frequency","type"]);u2(this._oscillator,this._gainNode),this.type=t.type,this.frequency=new r2({context:this.context,param:this._oscillator.frequency,units:"frequency",value:t.frequency}),this.detune=new r2({context:this.context,param:this._oscillator.detune,units:"cents",value:t.detune}),N1(this,["frequency","detune"])}static getDefaults(){return Object.assign(h2.getDefaults(),{detune:0,frequency:440,type:"sine"})}start(t){const e=this.toSeconds(t);return this.log("start",e),this._startGain(e),this._oscillator.start(e),this}_stopSource(t){this._oscillator.stop(t)}setPeriodicWave(t){return this._oscillator.setPeriodicWave(t),this}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t}dispose(){return super.dispose(),"started"===this.state&&this.stop(),this._oscillator.disconnect(),this.frequency.dispose(),this.detune.dispose(),this}}class U2 extends M2{constructor(){super(a1(U2.getDefaults(),arguments,["frequency","type"])),this.name="Oscillator",this._oscillator=null;const t=a1(U2.getDefaults(),arguments,["frequency","type"]);this.frequency=new d2({context:this.context,units:"frequency",value:t.frequency}),N1(this,"frequency"),this.detune=new d2({context:this.context,units:"cents",value:t.detune}),N1(this,"detune"),this._partials=t.partials,this._partialCount=t.partialCount,this._type=t.type,t.partialCount&&"custom"!==t.type&&(this._type=this.baseType+t.partialCount.toString()),this.phase=t.phase}static getDefaults(){return Object.assign(M2.getDefaults(),{detune:0,frequency:440,partialCount:0,partials:[],phase:0,type:"sine"})}_start(t){const e=this.toSeconds(t),n=new j2({context:this.context,onended:()=>this.onstop(this)});this._oscillator=n,this._wave?this._oscillator.setPeriodicWave(this._wave):this._oscillator.type=this._type,this._oscillator.connect(this.output),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.start(e)}_stop(t){const e=this.toSeconds(t);this._oscillator&&this._oscillator.stop(e)}_restart(t){const e=this.toSeconds(t);return this.log("restart",e),this._oscillator&&this._oscillator.cancelStop(),this._state.cancel(e),this}syncFrequency(){return this.context.transport.syncSignal(this.frequency),this}unsyncFrequency(){return this.context.transport.unsyncSignal(this.frequency),this}_getCachedPeriodicWave(){if("custom"===this._type){const t=U2._periodicWaveCache.find((t=>t.phase===this._phase&&o1(t.partials,this._partials)));return t}{const t=U2._periodicWaveCache.find((t=>t.type===this._type&&t.phase===this._phase));return this._partialCount=t?t.partialCount:this._partialCount,t}}get type(){return this._type}set type(t){this._type=t;const e=-1!==["sine","square","sawtooth","triangle"].indexOf(t);if(0===this._phase&&e)this._wave=void 0,this._partialCount=0,null!==this._oscillator&&(this._oscillator.type=t);else{const e=this._getCachedPeriodicWave();if(F0(e)){const{partials:t,wave:n}=e;this._wave=n,this._partials=t,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave)}else{const[e,n]=this._getRealImaginary(t,this._phase),s=this.context.createPeriodicWave(e,n);this._wave=s,null!==this._oscillator&&this._oscillator.setPeriodicWave(this._wave),U2._periodicWaveCache.push({imag:n,partialCount:this._partialCount,partials:this._partials,phase:this._phase,real:e,type:this._type,wave:this._wave}),U2._periodicWaveCache.length>100&&U2._periodicWaveCache.shift()}}}get baseType(){return this._type.replace(this.partialCount.toString(),"")}set baseType(t){this.partialCount&&"custom"!==this._type&&"custom"!==t?this.type=t+this.partialCount:this.type=t}get partialCount(){return this._partialCount}set partialCount(t){E0(t,0);let e=this._type;const n=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(this._type);if(n&&(e=n[1]),"custom"!==this._type)this.type=0===t?e:e+t.toString();else{const e=new Float32Array(t);this._partials.forEach(((t,n)=>e[n]=t)),this._partials=Array.from(e),this.type=this._type}}_getRealImaginary(t,e){const n=4096;let s=n/2;const i=new Float32Array(s),r=new Float32Array(s);let o=1;if("custom"===t){if(o=this._partials.length+1,this._partialCount=this._partials.length,s=o,0===this._partials.length)return[i,r]}else{const e=/^(sine|triangle|square|sawtooth)(\d+)$/.exec(t);e?(o=parseInt(e[2],10)+1,this._partialCount=parseInt(e[2],10),t=e[1],o=Math.max(o,2),s=o):this._partialCount=0,this._partials=[]}for(let a=1;a<s;++a){const n=2/(a*Math.PI);let s;switch(t){case"sine":s=a<=o?1:0,this._partials[a-1]=s;break;case"square":s=1&a?2*n:0,this._partials[a-1]=s;break;case"sawtooth":s=n*(1&a?1:-1),this._partials[a-1]=s;break;case"triangle":s=1&a?n*n*2*(a-1>>1&1?-1:1):0,this._partials[a-1]=s;break;case"custom":s=this._partials[a-1];break;default:throw new TypeError("Oscillator: invalid type: "+t)}0!==s?(i[a]=-s*Math.sin(e*a),r[a]=s*Math.cos(e*a)):(i[a]=0,r[a]=0)}return[i,r]}_inverseFFT(t,e,n){let s=0;const i=t.length;for(let r=0;r<i;r++)s+=t[r]*Math.cos(r*n)+e[r]*Math.sin(r*n);return s}getInitialValue(){const[t,e]=this._getRealImaginary(this._type,0);let n=0;const s=2*Math.PI,i=32;for(let r=0;r<i;r++)n=Math.max(this._inverseFFT(t,e,r/i*s),n);return y1(-this._inverseFFT(t,e,this._phase)/n,-1,1)}get partials(){return this._partials.slice(0,this.partialCount)}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this.type="custom")}get phase(){return this._phase*(180/Math.PI)}set phase(t){this._phase=t*Math.PI/180,this.type=this._type}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){return W2(this,t)}))}dispose(){return super.dispose(),null!==this._oscillator&&this._oscillator.dispose(),this._wave=void 0,this.frequency.dispose(),this.detune.dispose(),this}}U2._periodicWaveCache=[];class G2 extends o2{constructor(){super(Object.assign(a1(G2.getDefaults(),arguments,["context"])))}connect(t,e=0,n=0){return f2(this,t,e,n),this}}class H2 extends G2{constructor(){super(Object.assign(a1(H2.getDefaults(),arguments,["mapping","length"]))),this.name="WaveShaper",this._shaper=this.context.createWaveShaper(),this.input=this._shaper,this.output=this._shaper;const t=a1(H2.getDefaults(),arguments,["mapping","length"]);V0(t.mapping)||t.mapping instanceof Float32Array?this.curve=Float32Array.from(t.mapping):L0(t.mapping)&&this.setMap(t.mapping,t.length)}static getDefaults(){return Object.assign(d2.getDefaults(),{length:1024})}setMap(t,e=1024){const n=new Float32Array(e);for(let s=0,i=e;s<i;s++){const e=s/(i-1)*2-1;n[s]=t(e,s)}return this.curve=n,this}get curve(){return this._shaper.curve}set curve(t){this._shaper.curve=t}get oversample(){return this._shaper.oversample}set oversample(t){const e=["none","2x","4x"].some((e=>e.includes(t)));N0(e,"oversampling must be either 'none', '2x', or '4x'"),this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.disconnect(),this}}class K2 extends G2{constructor(){super(...arguments),this.name="AudioToGain",this._norm=new H2({context:this.context,mapping:t=>(t+1)/2}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class X2 extends d2{constructor(){super(Object.assign(a1(X2.getDefaults(),arguments,["value"]))),this.name="Multiply",this.override=!1;const t=a1(X2.getDefaults(),arguments,["value"]);this._mult=this.input=this.output=new l2({context:this.context,minValue:t.minValue,maxValue:t.maxValue}),this.factor=this._param=this._mult.gain,this.factor.setValueAtTime(t.value,0)}static getDefaults(){return Object.assign(d2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._mult.dispose(),this}}class Q2 extends M2{constructor(){super(a1(Q2.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="AMOscillator",this._modulationScale=new K2({context:this.context}),this._modulationNode=new l2({context:this.context});const t=a1(Q2.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new U2({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.frequency=this._carrier.frequency,this.detune=this._carrier.detune,this._modulator=new U2({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new X2({context:this.context,units:"positive",value:t.harmonicity}),this.frequency.chain(this.harmonicity,this._modulator.frequency),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output),N1(this,["frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(U2.getDefaults(),{harmonicity:1,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){this._modulator.restart(t),this._carrier.restart(t)}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){return W2(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this._modulationScale.dispose(),this}}class Y2 extends M2{constructor(){super(a1(Y2.getDefaults(),arguments,["frequency","type","modulationType"])),this.name="FMOscillator",this._modulationNode=new l2({context:this.context,gain:0});const t=a1(Y2.getDefaults(),arguments,["frequency","type","modulationType"]);this._carrier=new U2({context:this.context,detune:t.detune,frequency:0,onstop:()=>this.onstop(this),phase:t.phase,type:t.type}),this.detune=this._carrier.detune,this.frequency=new d2({context:this.context,units:"frequency",value:t.frequency}),this._modulator=new U2({context:this.context,phase:t.phase,type:t.modulationType}),this.harmonicity=new X2({context:this.context,units:"positive",value:t.harmonicity}),this.modulationIndex=new X2({context:this.context,units:"positive",value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output),this.detune.connect(this._modulator.detune),N1(this,["modulationIndex","frequency","detune","harmonicity"])}static getDefaults(){return Object.assign(U2.getDefaults(),{harmonicity:1,modulationIndex:2,modulationType:"square"})}_start(t){this._modulator.start(t),this._carrier.start(t)}_stop(t){this._modulator.stop(t),this._carrier.stop(t)}_restart(t){return this._modulator.restart(t),this._carrier.restart(t),this}get type(){return this._carrier.type}set type(t){this._carrier.type=t}get baseType(){return this._carrier.baseType}set baseType(t){this._carrier.baseType=t}get partialCount(){return this._carrier.partialCount}set partialCount(t){this._carrier.partialCount=t}get modulationType(){return this._modulator.type}set modulationType(t){this._modulator.type=t}get phase(){return this._carrier.phase}set phase(t){this._carrier.phase=t,this._modulator.phase=t}get partials(){return this._carrier.partials}set partials(t){this._carrier.partials=t}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){return W2(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.harmonicity.dispose(),this._carrier.dispose(),this._modulator.dispose(),this._modulationNode.dispose(),this.modulationIndex.dispose(),this}}class Z2 extends M2{constructor(){super(a1(Z2.getDefaults(),arguments,["frequency","width"])),this.name="PulseOscillator",this._widthGate=new l2({context:this.context,gain:0}),this._thresh=new H2({context:this.context,mapping:t=>t<=0?-1:1});const t=a1(Z2.getDefaults(),arguments,["frequency","width"]);this.width=new d2({context:this.context,units:"audioRange",value:t.width}),this._triangle=new U2({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase,type:"triangle"}),this.frequency=this._triangle.frequency,this.detune=this._triangle.detune,this._triangle.chain(this._thresh,this.output),this.width.chain(this._widthGate,this._thresh),N1(this,["width","frequency","detune"])}static getDefaults(){return Object.assign(M2.getDefaults(),{detune:0,frequency:440,phase:0,type:"pulse",width:.2})}_start(t){t=this.toSeconds(t),this._triangle.start(t),this._widthGate.gain.setValueAtTime(1,t)}_stop(t){t=this.toSeconds(t),this._triangle.stop(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(0,t)}_restart(t){this._triangle.restart(t),this._widthGate.gain.cancelScheduledValues(t),this._widthGate.gain.setValueAtTime(1,t)}get phase(){return this._triangle.phase}set phase(t){this._triangle.phase=t}get type(){return"pulse"}get baseType(){return"pulse"}get partials(){return[]}get partialCount(){return 0}set carrierType(t){this._triangle.type=t}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){return W2(this,t)}))}dispose(){return super.dispose(),this._triangle.dispose(),this.width.dispose(),this._widthGate.dispose(),this._thresh.dispose(),this}}class J2 extends M2{constructor(){super(a1(J2.getDefaults(),arguments,["frequency","type","spread"])),this.name="FatOscillator",this._oscillators=[];const t=a1(J2.getDefaults(),arguments,["frequency","type","spread"]);this.frequency=new d2({context:this.context,units:"frequency",value:t.frequency}),this.detune=new d2({context:this.context,units:"cents",value:t.detune}),this._spread=t.spread,this._type=t.type,this._phase=t.phase,this._partials=t.partials,this._partialCount=t.partialCount,this.count=t.count,N1(this,["frequency","detune"])}static getDefaults(){return Object.assign(U2.getDefaults(),{count:3,spread:20,type:"sawtooth"})}_start(t){t=this.toSeconds(t),this._forEach((e=>e.start(t)))}_stop(t){t=this.toSeconds(t),this._forEach((e=>e.stop(t)))}_restart(t){this._forEach((e=>e.restart(t)))}_forEach(t){for(let e=0;e<this._oscillators.length;e++)t(this._oscillators[e],e)}get type(){return this._type}set type(t){this._type=t,this._forEach((e=>e.type=t))}get spread(){return this._spread}set spread(t){if(this._spread=t,this._oscillators.length>1){const e=-t/2,n=t/(this._oscillators.length-1);this._forEach(((t,s)=>t.detune.value=e+n*s))}}get count(){return this._oscillators.length}set count(t){if(E0(t,1),this._oscillators.length!==t){this._forEach((t=>t.dispose())),this._oscillators=[];for(let e=0;e<t;e++){const n=new U2({context:this.context,volume:-6-1.1*t,type:this._type,phase:this._phase+e/t*360,partialCount:this._partialCount,onstop:0===e?()=>this.onstop(this):O1});"custom"===this.type&&(n.partials=this._partials),this.frequency.connect(n.frequency),this.detune.connect(n.detune),n.detune.overridden=!1,n.connect(this.output),this._oscillators[e]=n}this.spread=this._spread,"started"===this.state&&this._forEach((t=>t.start()))}}get phase(){return this._phase}set phase(t){this._phase=t,this._forEach(((t,e)=>t.phase=this._phase+e/this.count*360))}get baseType(){return this._oscillators[0].baseType}set baseType(t){this._forEach((e=>e.baseType=t)),this._type=this._oscillators[0].type}get partials(){return this._oscillators[0].partials}set partials(t){this._partials=t,this._partialCount=this._partials.length,t.length&&(this._type="custom",this._forEach((e=>e.partials=t)))}get partialCount(){return this._oscillators[0].partialCount}set partialCount(t){this._partialCount=t,this._forEach((e=>e.partialCount=t)),this._type=this._oscillators[0].type}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){return W2(this,t)}))}dispose(){return super.dispose(),this.frequency.dispose(),this.detune.dispose(),this._forEach((t=>t.dispose())),this}}class t3 extends M2{constructor(){super(a1(t3.getDefaults(),arguments,["frequency","modulationFrequency"])),this.name="PWMOscillator",this.sourceType="pwm",this._scale=new X2({context:this.context,value:2});const t=a1(t3.getDefaults(),arguments,["frequency","modulationFrequency"]);this._pulse=new Z2({context:this.context,frequency:t.modulationFrequency}),this._pulse.carrierType="sine",this.modulationFrequency=this._pulse.frequency,this._modulator=new U2({context:this.context,detune:t.detune,frequency:t.frequency,onstop:()=>this.onstop(this),phase:t.phase}),this.frequency=this._modulator.frequency,this.detune=this._modulator.detune,this._modulator.chain(this._scale,this._pulse.width),this._pulse.connect(this.output),N1(this,["modulationFrequency","frequency","detune"])}static getDefaults(){return Object.assign(M2.getDefaults(),{detune:0,frequency:440,modulationFrequency:.4,phase:0,type:"pwm"})}_start(t){t=this.toSeconds(t),this._modulator.start(t),this._pulse.start(t)}_stop(t){t=this.toSeconds(t),this._modulator.stop(t),this._pulse.stop(t)}_restart(t){this._modulator.restart(t),this._pulse.restart(t)}get type(){return"pwm"}get baseType(){return"pwm"}get partials(){return[]}get partialCount(){return 0}get phase(){return this._modulator.phase}set phase(t){this._modulator.phase=t}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){return W2(this,t)}))}dispose(){return super.dispose(),this._pulse.dispose(),this._scale.dispose(),this._modulator.dispose(),this}}const e3={am:Q2,fat:J2,fm:Y2,oscillator:U2,pulse:Z2,pwm:t3};class n3 extends M2{constructor(){super(a1(n3.getDefaults(),arguments,["frequency","type"])),this.name="OmniOscillator";const t=a1(n3.getDefaults(),arguments,["frequency","type"]);this.frequency=new d2({context:this.context,units:"frequency",value:t.frequency}),this.detune=new d2({context:this.context,units:"cents",value:t.detune}),N1(this,["frequency","detune"]),this.set(t)}static getDefaults(){return Object.assign(U2.getDefaults(),Y2.getDefaults(),Q2.getDefaults(),J2.getDefaults(),Z2.getDefaults(),t3.getDefaults())}_start(t){this._oscillator.start(t)}_stop(t){this._oscillator.stop(t)}_restart(t){return this._oscillator.restart(t),this}get type(){let t="";return["am","fm","fat"].some((t=>this._sourceType===t))&&(t=this._sourceType),t+this._oscillator.type}set type(t){"fm"===t.substr(0,2)?(this._createNewOscillator("fm"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"am"===t.substr(0,2)?(this._createNewOscillator("am"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(2)):"fat"===t.substr(0,3)?(this._createNewOscillator("fat"),this._oscillator=this._oscillator,this._oscillator.type=t.substr(3)):"pwm"===t?(this._createNewOscillator("pwm"),this._oscillator=this._oscillator):"pulse"===t?this._createNewOscillator("pulse"):(this._createNewOscillator("oscillator"),this._oscillator=this._oscillator,this._oscillator.type=t)}get partials(){return this._oscillator.partials}set partials(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partials=t)}get partialCount(){return this._oscillator.partialCount}set partialCount(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||(this._oscillator.partialCount=t)}set(t){return Reflect.has(t,"type")&&t.type&&(this.type=t.type),super.set(t),this}_createNewOscillator(t){if(t!==this._sourceType){this._sourceType=t;const e=e3[t],n=this.now();if(this._oscillator){const t=this._oscillator;t.stop(n),this.context.setTimeout((()=>t.dispose()),this.blockTime)}this._oscillator=new e({context:this.context}),this.frequency.connect(this._oscillator.frequency),this.detune.connect(this._oscillator.detune),this._oscillator.connect(this.output),this._oscillator.onstop=()=>this.onstop(this),"started"===this.state&&this._oscillator.start(n)}}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t}get sourceType(){return this._sourceType}set sourceType(t){let e="sine";"pwm"!==this._oscillator.type&&"pulse"!==this._oscillator.type&&(e=this._oscillator.type),"fm"===t?this.type="fm"+e:"am"===t?this.type="am"+e:"fat"===t?this.type="fat"+e:"oscillator"===t?this.type=e:"pulse"===t?this.type="pulse":"pwm"===t&&(this.type="pwm")}_getOscType(t,e){return t instanceof e3[e]}get baseType(){return this._oscillator.baseType}set baseType(t){this._getOscType(this._oscillator,"pulse")||this._getOscType(this._oscillator,"pwm")||"pulse"===t||"pwm"===t||(this._oscillator.baseType=t)}get width(){return this._getOscType(this._oscillator,"pulse")?this._oscillator.width:void 0}get count(){return this._getOscType(this._oscillator,"fat")?this._oscillator.count:void 0}set count(t){this._getOscType(this._oscillator,"fat")&&z0(t)&&(this._oscillator.count=t)}get spread(){return this._getOscType(this._oscillator,"fat")?this._oscillator.spread:void 0}set spread(t){this._getOscType(this._oscillator,"fat")&&z0(t)&&(this._oscillator.spread=t)}get modulationType(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.modulationType:void 0}set modulationType(t){(this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am"))&&W0(t)&&(this._oscillator.modulationType=t)}get modulationIndex(){return this._getOscType(this._oscillator,"fm")?this._oscillator.modulationIndex:void 0}get harmonicity(){return this._getOscType(this._oscillator,"fm")||this._getOscType(this._oscillator,"am")?this._oscillator.harmonicity:void 0}get modulationFrequency(){return this._getOscType(this._oscillator,"pwm")?this._oscillator.modulationFrequency:void 0}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){return W2(this,t)}))}dispose(){return super.dispose(),this.detune.dispose(),this.frequency.dispose(),this._oscillator.dispose(),this}}class s3 extends d2{constructor(){super(Object.assign(a1(s3.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Add",this._sum=new l2({context:this.context}),this.input=this._sum,this.output=this._sum,this.addend=this._param,a2(this._constantSource,this._sum)}static getDefaults(){return Object.assign(d2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._sum.dispose(),this}}class i3 extends G2{constructor(){super(Object.assign(a1(i3.getDefaults(),arguments,["min","max"]))),this.name="Scale";const t=a1(i3.getDefaults(),arguments,["min","max"]);this._mult=this.input=new X2({context:this.context,value:t.max-t.min}),this._add=this.output=new s3({context:this.context,value:t.min}),this._min=t.min,this._max=t.max,this.input.connect(this.output)}static getDefaults(){return Object.assign(G2.getDefaults(),{max:1,min:0})}get min(){return this._min}set min(t){this._min=t,this._setRange()}get max(){return this._max}set max(t){this._max=t,this._setRange()}_setRange(){this._add.value=this._min,this._mult.value=this._max-this._min}dispose(){return super.dispose(),this._add.dispose(),this._mult.dispose(),this}}class r3 extends G2{constructor(){super(Object.assign(a1(r3.getDefaults(),arguments))),this.name="Zero",this._gain=new l2({context:this.context}),this.output=this._gain,this.input=void 0,u2(this.context.getConstant(0),this._gain)}dispose(){return super.dispose(),c2(this.context.getConstant(0),this._gain),this}}class o3 extends o2{constructor(){super(a1(o3.getDefaults(),arguments,["frequency","min","max"])),this.name="LFO",this._stoppedValue=0,this._units="number",this.convert=!0,this._fromType=r2.prototype._fromType,this._toType=r2.prototype._toType,this._is=r2.prototype._is,this._clampValue=r2.prototype._clampValue;const t=a1(o3.getDefaults(),arguments,["frequency","min","max"]);this._oscillator=new U2(t),this.frequency=this._oscillator.frequency,this._amplitudeGain=new l2({context:this.context,gain:t.amplitude,units:"normalRange"}),this.amplitude=this._amplitudeGain.gain,this._stoppedSignal=new d2({context:this.context,units:"audioRange",value:0}),this._zeros=new r3({context:this.context}),this._a2g=new K2({context:this.context}),this._scaler=this.output=new i3({context:this.context,max:t.max,min:t.min}),this.units=t.units,this.min=t.min,this.max=t.max,this._oscillator.chain(this._amplitudeGain,this._a2g,this._scaler),this._zeros.connect(this._a2g),this._stoppedSignal.connect(this._a2g),N1(this,["amplitude","frequency"]),this.phase=t.phase}static getDefaults(){return Object.assign(U2.getDefaults(),{amplitude:1,frequency:"4n",max:1,min:0,type:"sine",units:"number"})}start(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(0,t),this._oscillator.start(t),this}stop(t){return t=this.toSeconds(t),this._stoppedSignal.setValueAtTime(this._stoppedValue,t),this._oscillator.stop(t),this}sync(){return this._oscillator.sync(),this._oscillator.syncFrequency(),this}unsync(){return this._oscillator.unsync(),this._oscillator.unsyncFrequency(),this}_setStoppedValue(){this._stoppedValue=this._oscillator.getInitialValue(),this._stoppedSignal.value=this._stoppedValue}get min(){return this._toType(this._scaler.min)}set min(t){t=this._fromType(t),this._scaler.min=t}get max(){return this._toType(this._scaler.max)}set max(t){t=this._fromType(t),this._scaler.max=t}get type(){return this._oscillator.type}set type(t){this._oscillator.type=t,this._setStoppedValue()}get partials(){return this._oscillator.partials}set partials(t){this._oscillator.partials=t,this._setStoppedValue()}get phase(){return this._oscillator.phase}set phase(t){this._oscillator.phase=t,this._setStoppedValue()}get units(){return this._units}set units(t){const e=this.min,n=this.max;this._units=t,this.min=e,this.max=n}get state(){return this._oscillator.state}connect(t,e,n){return(t instanceof r2||t instanceof d2)&&(this.convert=t.convert,this.units=t.units),f2(this,t,e,n),this}dispose(){return super.dispose(),this._oscillator.dispose(),this._stoppedSignal.dispose(),this._zeros.dispose(),this._scaler.dispose(),this._a2g.dispose(),this._amplitudeGain.dispose(),this.amplitude.dispose(),this}}function a3(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){E0(s,t,e),n.set(this,s)}})}}function u3(t,e=1/0){const n=new WeakMap;return function(s,i){Reflect.defineProperty(s,i,{configurable:!0,enumerable:!0,get:function(){return n.get(this)},set:function(s){E0(this.toSeconds(s),t,e),n.set(this,s)}})}}class c3 extends M2{constructor(){super(a1(c3.getDefaults(),arguments,["url","onload"])),this.name="Player",this._activeSources=new Set;const t=a1(c3.getDefaults(),arguments,["url","onload"]);this._buffer=new $1({onload:this._onload.bind(this,t.onload),onerror:t.onerror,reverse:t.reverse,url:t.url}),this.autostart=t.autostart,this._loop=t.loop,this._loopStart=t.loopStart,this._loopEnd=t.loopEnd,this._playbackRate=t.playbackRate,this.fadeIn=t.fadeIn,this.fadeOut=t.fadeOut}static getDefaults(){return Object.assign(M2.getDefaults(),{autostart:!1,fadeIn:0,fadeOut:0,loop:!1,loopEnd:0,loopStart:0,onload:O1,onerror:O1,playbackRate:1,reverse:!1})}load(t){return Y0(this,void 0,void 0,(function*(){return yield this._buffer.load(t),this._onload(),this}))}_onload(t=O1){t(),this.autostart&&this.start()}_onSourceEnd(t){this.onstop(this),this._activeSources.delete(t),0!==this._activeSources.size||this._synced||"started"!==this._state.getValueAtTime(this.now())||(this._state.cancel(this.now()),this._state.setStateAtTime("stopped",this.now()))}start(t,e,n){return super.start(t,e,n),this}_start(t,e,n){e=this._loop?c1(e,this._loopStart):c1(e,0);const s=this.toSeconds(e),i=n;n=c1(n,Math.max(this._buffer.duration-s,0));let r=this.toSeconds(n);r/=this._playbackRate,t=this.toSeconds(t);const o=new P2({url:this._buffer,context:this.context,fadeIn:this.fadeIn,fadeOut:this.fadeOut,loop:this._loop,loopEnd:this._loopEnd,loopStart:this._loopStart,onended:this._onSourceEnd.bind(this),playbackRate:this._playbackRate}).connect(this.output);this._loop||this._synced||(this._state.cancel(t+r),this._state.setStateAtTime("stopped",t+r,{implicitEnd:!0})),this._activeSources.add(o),this._loop&&P0(i)?o.start(t,s):o.start(t,s,r-this.toSeconds(this.fadeOut))}_stop(t){const e=this.toSeconds(t);this._activeSources.forEach((t=>t.stop(e)))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}seek(t,e){const n=this.toSeconds(e);if("started"===this._state.getValueAtTime(n)){const e=this.toSeconds(t);this._stop(n),this._start(n,e)}return this}setLoopPoints(t,e){return this.loopStart=t,this.loopEnd=e,this}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this.buffer.loaded&&E0(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopStart=t}))}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this.buffer.loaded&&E0(this.toSeconds(t),0,this.buffer.duration),this._activeSources.forEach((e=>{e.loopEnd=t}))}get buffer(){return this._buffer}set buffer(t){this._buffer.set(t)}get loop(){return this._loop}set loop(t){if(this._loop!==t&&(this._loop=t,this._activeSources.forEach((e=>{e.loop=t})),t)){const t=this._state.getNextState("stopped",this.now());t&&this._state.cancel(t.time)}}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t;const e=this.now(),n=this._state.getNextState("stopped",e);n&&n.implicitEnd&&(this._state.cancel(n.time),this._activeSources.forEach((t=>t.cancelStop()))),this._activeSources.forEach((n=>{n.playbackRate.setValueAtTime(t,e)}))}get reverse(){return this._buffer.reverse}set reverse(t){this._buffer.reverse=t}get loaded(){return this._buffer.loaded}dispose(){return super.dispose(),this._activeSources.forEach((t=>t.dispose())),this._activeSources.clear(),this._buffer.dispose(),this}}Q0([u3(0)],c3.prototype,"fadeIn",void 0),Q0([u3(0)],c3.prototype,"fadeOut",void 0);class l3 extends o2{constructor(){super(a1(l3.getDefaults(),arguments,["urls","onload"],"urls")),this.name="Players",this.input=void 0,this._players=new Map;const t=a1(l3.getDefaults(),arguments,["urls","onload"],"urls");this._volume=this.output=new N2({context:this.context,volume:t.volume}),this.volume=this._volume.volume,N1(this,"volume"),this._buffers=new x2({urls:t.urls,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.mute=t.mute,this._fadeIn=t.fadeIn,this._fadeOut=t.fadeOut}static getDefaults(){return Object.assign(M2.getDefaults(),{baseUrl:"",fadeIn:0,fadeOut:0,mute:!1,onload:O1,onerror:O1,urls:{},volume:0})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}get fadeIn(){return this._fadeIn}set fadeIn(t){this._fadeIn=t,this._players.forEach((e=>{e.fadeIn=t}))}get fadeOut(){return this._fadeOut}set fadeOut(t){this._fadeOut=t,this._players.forEach((e=>{e.fadeOut=t}))}get state(){const t=Array.from(this._players).some((([t,e])=>"started"===e.state));return t?"started":"stopped"}has(t){return this._buffers.has(t)}player(t){if(N0(this.has(t),`No Player with the name ${t} exists on this object`),!this._players.has(t)){const e=new c3({context:this.context,fadeIn:this._fadeIn,fadeOut:this._fadeOut,url:this._buffers.get(t)}).connect(this.output);this._players.set(t,e)}return this._players.get(t)}get loaded(){return this._buffers.loaded}add(t,e,n){return N0(!this._buffers.has(t),"A buffer with that name already exists on this object"),this._buffers.add(t,e,n),this}stopAll(t){return this._players.forEach((e=>e.stop(t))),this}dispose(){return super.dispose(),this._volume.dispose(),this.volume.dispose(),this._players.forEach((t=>t.dispose())),this._buffers.dispose(),this}}class h3 extends M2{constructor(){super(a1(h3.getDefaults(),arguments,["url","onload"])),this.name="GrainPlayer",this._loopStart=0,this._loopEnd=0,this._activeSources=[];const t=a1(h3.getDefaults(),arguments,["url","onload"]);this.buffer=new $1({onload:t.onload,onerror:t.onerror,reverse:t.reverse,url:t.url}),this._clock=new b2({context:this.context,callback:this._tick.bind(this),frequency:1/t.grainSize}),this._playbackRate=t.playbackRate,this._grainSize=t.grainSize,this._overlap=t.overlap,this.detune=t.detune,this.overlap=t.overlap,this.loop=t.loop,this.playbackRate=t.playbackRate,this.grainSize=t.grainSize,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.reverse=t.reverse,this._clock.on("stop",this._onstop.bind(this))}static getDefaults(){return Object.assign(M2.getDefaults(),{onload:O1,onerror:O1,overlap:.1,grainSize:.2,playbackRate:1,detune:0,loop:!1,loopStart:0,loopEnd:0,reverse:!1})}_start(t,e,n){e=c1(e,0),e=this.toSeconds(e),t=this.toSeconds(t);const s=1/this._clock.frequency.getValueAtTime(t);this._clock.start(t,e/s),n&&this.stop(t+this.toSeconds(n))}restart(t,e,n){return super.restart(t,e,n),this}_restart(t,e,n){this._stop(t),this._start(t,e,n)}_stop(t){this._clock.stop(t)}_onstop(t){this._activeSources.forEach((e=>{e.fadeOut=0,e.stop(t)})),this.onstop(this)}_tick(t){const e=this._clock.getTicksAtTime(t),n=e*this._grainSize;if(this.log("offset",n),!this.loop&&n>this.buffer.duration)return void this.stop(t);const s=n<this._overlap?0:this._overlap,i=new P2({context:this.context,url:this.buffer,fadeIn:s,fadeOut:this._overlap,loop:this.loop,loopStart:this._loopStart,loopEnd:this._loopEnd,playbackRate:q1(this.detune/100)}).connect(this.output);i.start(t,this._grainSize*e),i.stop(t+this._grainSize/this.playbackRate),this._activeSources.push(i),i.onended=()=>{const t=this._activeSources.indexOf(i);-1!==t&&this._activeSources.splice(t,1)}}get playbackRate(){return this._playbackRate}set playbackRate(t){E0(t,.001),this._playbackRate=t,this.grainSize=this._grainSize}get loopStart(){return this._loopStart}set loopStart(t){this.buffer.loaded&&E0(this.toSeconds(t),0,this.buffer.duration),this._loopStart=this.toSeconds(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this.buffer.loaded&&E0(this.toSeconds(t),0,this.buffer.duration),this._loopEnd=this.toSeconds(t)}get reverse(){return this.buffer.reverse}set reverse(t){this.buffer.reverse=t}get grainSize(){return this._grainSize}set grainSize(t){this._grainSize=this.toSeconds(t),this._clock.frequency.setValueAtTime(this._playbackRate/this._grainSize,this.now())}get overlap(){return this._overlap}set overlap(t){const e=this.toSeconds(t);E0(e,0),this._overlap=e}get loaded(){return this.buffer.loaded}dispose(){return super.dispose(),this.buffer.dispose(),this._clock.dispose(),this._activeSources.forEach((t=>t.dispose())),this}}class p3 extends G2{constructor(){super(...arguments),this.name="Abs",this._abs=new H2({context:this.context,mapping:t=>Math.abs(t)<.001?0:Math.abs(t)}),this.input=this._abs,this.output=this._abs}dispose(){return super.dispose(),this._abs.dispose(),this}}class d3 extends G2{constructor(){super(...arguments),this.name="GainToAudio",this._norm=new H2({context:this.context,mapping:t=>2*Math.abs(t)-1}),this.input=this._norm,this.output=this._norm}dispose(){return super.dispose(),this._norm.dispose(),this}}class f3 extends G2{constructor(){super(...arguments),this.name="Negate",this._multiply=new X2({context:this.context,value:-1}),this.input=this._multiply,this.output=this._multiply}dispose(){return super.dispose(),this._multiply.dispose(),this}}class m3 extends d2{constructor(){super(Object.assign(a1(m3.getDefaults(),arguments,["value"]))),this.override=!1,this.name="Subtract",this._sum=new l2({context:this.context}),this.input=this._sum,this.output=this._sum,this._neg=new f3({context:this.context}),this.subtrahend=this._param,a2(this._constantSource,this._neg,this._sum)}static getDefaults(){return Object.assign(d2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._neg.dispose(),this._sum.dispose(),this}}class g3 extends G2{constructor(){super(Object.assign(a1(g3.getDefaults(),arguments))),this.name="GreaterThanZero",this._thresh=this.output=new H2({context:this.context,length:127,mapping:t=>t<=0?0:1}),this._scale=this.input=new X2({context:this.context,value:1e4}),this._scale.connect(this._thresh)}dispose(){return super.dispose(),this._scale.dispose(),this._thresh.dispose(),this}}class y3 extends d2{constructor(){super(Object.assign(a1(y3.getDefaults(),arguments,["value"]))),this.name="GreaterThan",this.override=!1;const t=a1(y3.getDefaults(),arguments,["value"]);this._subtract=this.input=new m3({context:this.context,value:t.value}),this._gtz=this.output=new g3({context:this.context}),this.comparator=this._param=this._subtract.subtrahend,N1(this,"comparator"),this._subtract.connect(this._gtz)}static getDefaults(){return Object.assign(d2.getDefaults(),{value:0})}dispose(){return super.dispose(),this._gtz.dispose(),this._subtract.dispose(),this.comparator.dispose(),this}}class b3 extends G2{constructor(){super(Object.assign(a1(b3.getDefaults(),arguments,["value"]))),this.name="Pow";const t=a1(b3.getDefaults(),arguments,["value"]);this._exponentScaler=this.input=this.output=new H2({context:this.context,mapping:this._expFunc(t.value),length:8192}),this._exponent=t.value}static getDefaults(){return Object.assign(G2.getDefaults(),{value:1})}_expFunc(t){return e=>Math.pow(Math.abs(e),t)}get value(){return this._exponent}set value(t){this._exponent=t,this._exponentScaler.setMap(this._expFunc(this._exponent))}dispose(){return super.dispose(),this._exponentScaler.dispose(),this}}class v3 extends i3{constructor(){super(Object.assign(a1(v3.getDefaults(),arguments,["min","max","exponent"]))),this.name="ScaleExp";const t=a1(v3.getDefaults(),arguments,["min","max","exponent"]);this.input=this._exp=new b3({context:this.context,value:t.exponent}),this._exp.connect(this._mult)}static getDefaults(){return Object.assign(i3.getDefaults(),{exponent:1})}get exponent(){return this._exp.value}set exponent(t){this._exp.value=t}dispose(){return super.dispose(),this._exp.dispose(),this}}class w3 extends d2{constructor(){super(a1(d2.getDefaults(),arguments,["value","units"])),this.name="SyncedSignal",this.override=!1;const t=a1(d2.getDefaults(),arguments,["value","units"]);this._lastVal=t.value,this._synced=this.context.transport.scheduleRepeat(this._onTick.bind(this),"1i"),this._syncedCallback=this._anchorValue.bind(this),this.context.transport.on("start",this._syncedCallback),this.context.transport.on("pause",this._syncedCallback),this.context.transport.on("stop",this._syncedCallback),this._constantSource.disconnect(),this._constantSource.stop(0),this._constantSource=this.output=new p2({context:this.context,offset:t.value,units:t.units}).start(0),this.setValueAtTime(t.value,0)}_onTick(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal!==e&&(this._lastVal=e,this._constantSource.offset.setValueAtTime(e,t))}_anchorValue(t){const e=super.getValueAtTime(this.context.transport.seconds);this._lastVal=e,this._constantSource.offset.cancelAndHoldAtTime(t),this._constantSource.offset.setValueAtTime(e,t)}getValueAtTime(t){const e=new e2(this.context,t).toSeconds();return super.getValueAtTime(e)}setValueAtTime(t,e){const n=new e2(this.context,e).toSeconds();return super.setValueAtTime(t,n),this}linearRampToValueAtTime(t,e){const n=new e2(this.context,e).toSeconds();return super.linearRampToValueAtTime(t,n),this}exponentialRampToValueAtTime(t,e){const n=new e2(this.context,e).toSeconds();return super.exponentialRampToValueAtTime(t,n),this}setTargetAtTime(t,e,n){const s=new e2(this.context,e).toSeconds();return super.setTargetAtTime(t,s,n),this}cancelScheduledValues(t){const e=new e2(this.context,t).toSeconds();return super.cancelScheduledValues(e),this}setValueCurveAtTime(t,e,n,s){const i=new e2(this.context,e).toSeconds();return n=this.toSeconds(n),super.setValueCurveAtTime(t,i,n,s),this}cancelAndHoldAtTime(t){const e=new e2(this.context,t).toSeconds();return super.cancelAndHoldAtTime(e),this}setRampPoint(t){const e=new e2(this.context,t).toSeconds();return super.setRampPoint(e),this}exponentialRampTo(t,e,n){const s=new e2(this.context,n).toSeconds();return super.exponentialRampTo(t,e,s),this}linearRampTo(t,e,n){const s=new e2(this.context,n).toSeconds();return super.linearRampTo(t,e,s),this}targetRampTo(t,e,n){const s=new e2(this.context,n).toSeconds();return super.targetRampTo(t,e,s),this}dispose(){return super.dispose(),this.context.transport.clear(this._synced),this.context.transport.off("start",this._syncedCallback),this.context.transport.off("pause",this._syncedCallback),this.context.transport.off("stop",this._syncedCallback),this._constantSource.dispose(),this}}class x3 extends o2{constructor(){super(a1(x3.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="Envelope",this._sig=new d2({context:this.context,value:0}),this.output=this._sig,this.input=void 0;const t=a1(x3.getDefaults(),arguments,["attack","decay","sustain","release"]);this.attack=t.attack,this.decay=t.decay,this.sustain=t.sustain,this.release=t.release,this.attackCurve=t.attackCurve,this.releaseCurve=t.releaseCurve,this.decayCurve=t.decayCurve}static getDefaults(){return Object.assign(o2.getDefaults(),{attack:.01,attackCurve:"linear",decay:.1,decayCurve:"exponential",release:1,releaseCurve:"exponential",sustain:.5})}get value(){return this.getValueAtTime(this.now())}_getCurve(t,e){if(W0(t))return t;{let n;for(n in _3)if(_3[n][e]===t)return n;return t}}_setCurve(t,e,n){if(W0(n)&&Reflect.has(_3,n)){const s=_3[n];B0(s)?"_decayCurve"!==t&&(this[t]=s[e]):this[t]=s}else{if(!V0(n)||"_decayCurve"===t)throw new Error("Envelope: invalid curve: "+n);this[t]=n}}get attackCurve(){return this._getCurve(this._attackCurve,"In")}set attackCurve(t){this._setCurve("_attackCurve","In",t)}get releaseCurve(){return this._getCurve(this._releaseCurve,"Out")}set releaseCurve(t){this._setCurve("_releaseCurve","Out",t)}get decayCurve(){return this._decayCurve}set decayCurve(t){N0(["linear","exponential"].some((e=>e===t)),`Invalid envelope curve: ${t}`),this._decayCurve=t}triggerAttack(t,e=1){this.log("triggerAttack",t,e),t=this.toSeconds(t);const n=this.toSeconds(this.attack);let s=n;const i=this.toSeconds(this.decay),r=this.getValueAtTime(t);if(r>0){const t=1/s,e=1-r;s=e/t}if(s<this.sampleTime)this._sig.cancelScheduledValues(t),this._sig.setValueAtTime(e,t);else if("linear"===this._attackCurve)this._sig.linearRampTo(e,s,t);else if("exponential"===this._attackCurve)this._sig.targetRampTo(e,s,t);else{this._sig.cancelAndHoldAtTime(t);let n=this._attackCurve;for(let t=1;t<n.length;t++)if(n[t-1]<=r&&r<=n[t]){n=this._attackCurve.slice(t),n[0]=r;break}this._sig.setValueCurveAtTime(n,t,s,e)}if(i&&this.sustain<1){const n=e*this.sustain,r=t+s;this.log("decay",r),"linear"===this._decayCurve?this._sig.linearRampToValueAtTime(n,i+r):this._sig.exponentialApproachValueAtTime(n,r,i)}return this}triggerRelease(t){this.log("triggerRelease",t),t=this.toSeconds(t);const e=this.getValueAtTime(t);if(e>0){const n=this.toSeconds(this.release);n<this.sampleTime?this._sig.setValueAtTime(0,t):"linear"===this._releaseCurve?this._sig.linearRampTo(0,n,t):"exponential"===this._releaseCurve?this._sig.targetRampTo(0,n,t):(N0(V0(this._releaseCurve),"releaseCurve must be either 'linear', 'exponential' or an array"),this._sig.cancelAndHoldAtTime(t),this._sig.setValueCurveAtTime(this._releaseCurve,t,n,e))}return this}getValueAtTime(t){return this._sig.getValueAtTime(t)}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),this.triggerAttack(e,n),this.triggerRelease(e+this.toSeconds(t)),this}cancel(t){return this._sig.cancelScheduledValues(this.toSeconds(t)),this}connect(t,e=0,n=0){return f2(this,t,e,n),this}asArray(t=1024){return Y0(this,void 0,void 0,(function*(){const e=t/this.context.sampleRate,n=new R1(1,e,this.context.sampleRate),s=this.toSeconds(this.attack)+this.toSeconds(this.decay),i=s+this.toSeconds(this.release),r=.1*i,o=i+r,a=new this.constructor(Object.assign(this.get(),{attack:e*this.toSeconds(this.attack)/o,decay:e*this.toSeconds(this.decay)/o,release:e*this.toSeconds(this.release)/o,context:n}));a._sig.toDestination(),a.triggerAttackRelease(e*(s+r)/o,0);const u=yield n.render();return u.getChannelData(0)}))}dispose(){return super.dispose(),this._sig.dispose(),this}}Q0([u3(0)],x3.prototype,"attack",void 0),Q0([u3(0)],x3.prototype,"decay",void 0),Q0([a3(0,1)],x3.prototype,"sustain",void 0),Q0([u3(0)],x3.prototype,"release",void 0);const _3=(()=>{const t=128;let e,n;const s=[];for(e=0;e<t;e++)s[e]=Math.sin(e/(t-1)*(Math.PI/2));const i=[],r=6.4;for(e=0;e<t-1;e++){n=e/(t-1);const s=Math.sin(n*(2*Math.PI)*r-Math.PI/2)+1;i[e]=s/10+.83*n}i[t-1]=1;const o=[],a=5;for(e=0;e<t;e++)o[e]=Math.ceil(e/(t-1)*a)/a;const u=[];for(e=0;e<t;e++)n=e/(t-1),u[e]=.5*(1-Math.cos(Math.PI*n));const c=[];for(e=0;e<t;e++){n=e/(t-1);const s=4*Math.pow(n,3)+.2,i=Math.cos(s*Math.PI*2*n);c[e]=Math.abs(i*(1-n))}function l(t){const e=new Array(t.length);for(let n=0;n<t.length;n++)e[n]=1-t[n];return e}function h(t){return t.slice(0).reverse()}return{bounce:{In:l(c),Out:c},cosine:{In:s,Out:h(s)},exponential:"exponential",linear:"linear",ripple:{In:i,Out:l(i)},sine:{In:u,Out:l(u)},step:{In:o,Out:l(o)}}})();class k3 extends o2{constructor(){super(a1(k3.getDefaults(),arguments)),this._scheduledEvents=[],this._synced=!1,this._original_triggerAttack=this.triggerAttack,this._original_triggerRelease=this.triggerRelease;const t=a1(k3.getDefaults(),arguments);this._volume=this.output=new N2({context:this.context,volume:t.volume}),this.volume=this._volume.volume,N1(this,"volume")}static getDefaults(){return Object.assign(o2.getDefaults(),{volume:0})}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",0)),this}_syncState(){let t=!1;return this._synced||(this._synced=!0,t=!0),t}_syncMethod(t,e){const n=this["_original_"+t]=this[t];this[t]=(...t)=>{const s=t[e],i=this.context.transport.schedule((s=>{t[e]=s,n.apply(this,t)}),s);this._scheduledEvents.push(i)}}unsync(){return this._scheduledEvents.forEach((t=>this.context.transport.clear(t))),this._scheduledEvents=[],this._synced&&(this._synced=!1,this.triggerAttack=this._original_triggerAttack,this.triggerRelease=this._original_triggerRelease),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n),r=this.toSeconds(e);return this.triggerAttack(t,i,s),this.triggerRelease(i+r),this}dispose(){return super.dispose(),this._volume.dispose(),this.unsync(),this._scheduledEvents=[],this}}class S3 extends k3{constructor(){super(a1(S3.getDefaults(),arguments));const t=a1(S3.getDefaults(),arguments);this.portamento=t.portamento,this.onsilence=t.onsilence}static getDefaults(){return Object.assign(k3.getDefaults(),{detune:0,onsilence:O1,portamento:0})}triggerAttack(t,e,n=1){this.log("triggerAttack",t,e,n);const s=this.toSeconds(e);return this._triggerEnvelopeAttack(s,n),this.setNote(t,s),this}triggerRelease(t){this.log("triggerRelease",t);const e=this.toSeconds(t);return this._triggerEnvelopeRelease(e),this}setNote(t,e){const n=this.toSeconds(e),s=t instanceof Y1?t.toFrequency():t;if(this.portamento>0&&this.getLevelAtTime(n)>.05){const t=this.toSeconds(this.portamento);this.frequency.exponentialRampTo(s,t,n)}else this.frequency.setValueAtTime(s,n);return this}}Q0([u3(0)],S3.prototype,"portamento",void 0);class T3 extends x3{constructor(){super(a1(T3.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="AmplitudeEnvelope",this._gainNode=new l2({context:this.context,gain:0}),this.output=this._gainNode,this.input=this._gainNode,this._sig.connect(this._gainNode.gain),this.output=this._gainNode,this.input=this._gainNode}dispose(){return super.dispose(),this._gainNode.dispose(),this}}class I3 extends S3{constructor(){super(a1(I3.getDefaults(),arguments)),this.name="Synth";const t=a1(I3.getDefaults(),arguments);this.oscillator=new n3(Object.assign({context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)},t.oscillator)),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.envelope=new T3(Object.assign({context:this.context},t.envelope)),this.oscillator.chain(this.envelope,this.output),N1(this,["oscillator","frequency","detune","envelope"])}static getDefaults(){return Object.assign(S3.getDefaults(),{envelope:Object.assign(l1(x3.getDefaults(),Object.keys(o2.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.3}),oscillator:Object.assign(l1(n3.getDefaults(),[...Object.keys(M2.getDefaults()),"frequency","detune"]),{type:"triangle"})})}_triggerEnvelopeAttack(t,e){if(this.envelope.triggerAttack(t,e),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this}}class C3 extends S3{constructor(){super(a1(C3.getDefaults(),arguments)),this.name="ModulationSynth";const t=a1(C3.getDefaults(),arguments);this._carrier=new I3({context:this.context,oscillator:t.oscillator,envelope:t.envelope,onsilence:()=>this.onsilence(this),volume:-10}),this._modulator=new I3({context:this.context,oscillator:t.modulation,envelope:t.modulationEnvelope,volume:-10}),this.oscillator=this._carrier.oscillator,this.envelope=this._carrier.envelope,this.modulation=this._modulator.oscillator,this.modulationEnvelope=this._modulator.envelope,this.frequency=new d2({context:this.context,units:"frequency"}),this.detune=new d2({context:this.context,value:t.detune,units:"cents"}),this.harmonicity=new X2({context:this.context,value:t.harmonicity,minValue:0}),this._modulationNode=new l2({context:this.context,gain:0}),N1(this,["frequency","harmonicity","oscillator","envelope","modulation","modulationEnvelope","detune"])}static getDefaults(){return Object.assign(S3.getDefaults(),{harmonicity:3,oscillator:Object.assign(l1(n3.getDefaults(),[...Object.keys(M2.getDefaults()),"frequency","detune"]),{type:"sine"}),envelope:Object.assign(l1(x3.getDefaults(),Object.keys(o2.getDefaults())),{attack:.01,decay:.01,sustain:1,release:.5}),modulation:Object.assign(l1(n3.getDefaults(),[...Object.keys(M2.getDefaults()),"frequency","detune"]),{type:"square"}),modulationEnvelope:Object.assign(l1(x3.getDefaults(),Object.keys(o2.getDefaults())),{attack:.5,decay:0,sustain:1,release:.5})})}_triggerEnvelopeAttack(t,e){this._carrier._triggerEnvelopeAttack(t,e),this._modulator._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this._carrier._triggerEnvelopeRelease(t),this._modulator._triggerEnvelopeRelease(t),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this._carrier.dispose(),this._modulator.dispose(),this.frequency.dispose(),this.detune.dispose(),this.harmonicity.dispose(),this._modulationNode.dispose(),this}}class A3 extends C3{constructor(){super(a1(A3.getDefaults(),arguments)),this.name="AMSynth",this._modulationScale=new K2({context:this.context}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.chain(this._modulationScale,this._modulationNode.gain),this._carrier.chain(this._modulationNode,this.output)}dispose(){return super.dispose(),this._modulationScale.dispose(),this}}class N3 extends o2{constructor(){super(a1(N3.getDefaults(),arguments,["frequency","type"])),this.name="BiquadFilter";const t=a1(N3.getDefaults(),arguments,["frequency","type"]);this._filter=this.context.createBiquadFilter(),this.input=this.output=this._filter,this.Q=new r2({context:this.context,units:"number",value:t.Q,param:this._filter.Q}),this.frequency=new r2({context:this.context,units:"frequency",value:t.frequency,param:this._filter.frequency}),this.detune=new r2({context:this.context,units:"cents",value:t.detune,param:this._filter.detune}),this.gain=new r2({context:this.context,units:"decibels",convert:!1,value:t.gain,param:this._filter.gain}),this.type=t.type}static getDefaults(){return Object.assign(o2.getDefaults(),{Q:1,type:"lowpass",frequency:350,detune:0,gain:0})}get type(){return this._filter.type}set type(t){const e=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];N0(-1!==e.indexOf(t),`Invalid filter type: ${t}`),this._filter.type=t}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let r=0;r<t;r++){const n=Math.pow(r/t,2),s=19980*n+20;e[r]=s}const n=new Float32Array(t),s=new Float32Array(t),i=this.context.createBiquadFilter();return i.type=this.type,i.Q.value=this.Q.value,i.frequency.value=this.frequency.value,i.gain.value=this.gain.value,i.getFrequencyResponse(e,n,s),n}dispose(){return super.dispose(),this._filter.disconnect(),this.Q.dispose(),this.frequency.dispose(),this.gain.dispose(),this.detune.dispose(),this}}class E3 extends o2{constructor(){super(a1(E3.getDefaults(),arguments,["frequency","type","rolloff"])),this.name="Filter",this.input=new l2({context:this.context}),this.output=new l2({context:this.context}),this._filters=[];const t=a1(E3.getDefaults(),arguments,["frequency","type","rolloff"]);this._filters=[],this.Q=new d2({context:this.context,units:"positive",value:t.Q}),this.frequency=new d2({context:this.context,units:"frequency",value:t.frequency}),this.detune=new d2({context:this.context,units:"cents",value:t.detune}),this.gain=new d2({context:this.context,units:"decibels",convert:!1,value:t.gain}),this._type=t.type,this.rolloff=t.rolloff,N1(this,["detune","frequency","gain","Q"])}static getDefaults(){return Object.assign(o2.getDefaults(),{Q:1,detune:0,frequency:350,gain:0,rolloff:-12,type:"lowpass"})}get type(){return this._type}set type(t){const e=["lowpass","highpass","bandpass","lowshelf","highshelf","notch","allpass","peaking"];N0(-1!==e.indexOf(t),`Invalid filter type: ${t}`),this._type=t,this._filters.forEach((e=>e.type=t))}get rolloff(){return this._rolloff}set rolloff(t){const e=z0(t)?t:parseInt(t,10),n=[-12,-24,-48,-96];let s=n.indexOf(e);N0(-1!==s,`rolloff can only be ${n.join(", ")}`),s+=1,this._rolloff=e,this.input.disconnect(),this._filters.forEach((t=>t.disconnect())),this._filters=new Array(s);for(let i=0;i<s;i++){const t=new N3({context:this.context});t.type=this._type,this.frequency.connect(t.frequency),this.detune.connect(t.detune),this.Q.connect(t.Q),this.gain.connect(t.gain),this._filters[i]=t}this._internalChannels=this._filters,a2(this.input,...this._internalChannels,this.output)}getFrequencyResponse(t=128){const e=new N3({frequency:this.frequency.value,gain:this.gain.value,Q:this.Q.value,type:this._type,detune:this.detune.value}),n=new Float32Array(t).map((()=>1));return this._filters.forEach((()=>{const s=e.getFrequencyResponse(t);s.forEach(((t,e)=>n[e]*=t))})),e.dispose(),n}dispose(){return super.dispose(),this._filters.forEach((t=>{t.dispose()})),E1(this,["detune","frequency","gain","Q"]),this.frequency.dispose(),this.Q.dispose(),this.detune.dispose(),this.gain.dispose(),this}}class O3 extends x3{constructor(){super(a1(O3.getDefaults(),arguments,["attack","decay","sustain","release"])),this.name="FrequencyEnvelope";const t=a1(O3.getDefaults(),arguments,["attack","decay","sustain","release"]);this._octaves=t.octaves,this._baseFrequency=this.toFrequency(t.baseFrequency),this._exponent=this.input=new b3({context:this.context,value:t.exponent}),this._scale=this.output=new i3({context:this.context,min:this._baseFrequency,max:this._baseFrequency*Math.pow(2,this._octaves)}),this._sig.chain(this._exponent,this._scale)}static getDefaults(){return Object.assign(x3.getDefaults(),{baseFrequency:200,exponent:1,octaves:4})}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){const e=this.toFrequency(t);E0(e,0),this._baseFrequency=e,this._scale.min=this._baseFrequency,this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._scale.max=this._baseFrequency*Math.pow(2,t)}get exponent(){return this._exponent.value}set exponent(t){this._exponent.value=t}dispose(){return super.dispose(),this._exponent.dispose(),this._scale.dispose(),this}}class $3 extends S3{constructor(){super(a1($3.getDefaults(),arguments)),this.name="MonoSynth";const t=a1($3.getDefaults(),arguments);this.oscillator=new n3(Object.assign(t.oscillator,{context:this.context,detune:t.detune,onstop:()=>this.onsilence(this)})),this.frequency=this.oscillator.frequency,this.detune=this.oscillator.detune,this.filter=new E3(Object.assign(t.filter,{context:this.context})),this.filterEnvelope=new O3(Object.assign(t.filterEnvelope,{context:this.context})),this.envelope=new T3(Object.assign(t.envelope,{context:this.context})),this.oscillator.chain(this.filter,this.envelope,this.output),this.filterEnvelope.connect(this.filter.frequency),N1(this,["oscillator","frequency","detune","filter","filterEnvelope","envelope"])}static getDefaults(){return Object.assign(S3.getDefaults(),{envelope:Object.assign(l1(x3.getDefaults(),Object.keys(o2.getDefaults())),{attack:.005,decay:.1,release:1,sustain:.9}),filter:Object.assign(l1(E3.getDefaults(),Object.keys(o2.getDefaults())),{Q:1,rolloff:-12,type:"lowpass"}),filterEnvelope:Object.assign(l1(O3.getDefaults(),Object.keys(o2.getDefaults())),{attack:.6,baseFrequency:200,decay:.2,exponent:2,octaves:3,release:2,sustain:.5}),oscillator:Object.assign(l1(n3.getDefaults(),Object.keys(M2.getDefaults())),{type:"sawtooth"})})}_triggerEnvelopeAttack(t,e=1){if(this.envelope.triggerAttack(t,e),this.filterEnvelope.triggerAttack(t),this.oscillator.start(t),0===this.envelope.sustain){const e=this.toSeconds(this.envelope.attack),n=this.toSeconds(this.envelope.decay);this.oscillator.stop(t+e+n)}}_triggerEnvelopeRelease(t){this.envelope.triggerRelease(t),this.filterEnvelope.triggerRelease(t),this.oscillator.stop(t+this.toSeconds(this.envelope.release))}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}dispose(){return super.dispose(),this.oscillator.dispose(),this.envelope.dispose(),this.filterEnvelope.dispose(),this.filter.dispose(),this}}class R3 extends S3{constructor(){super(a1(R3.getDefaults(),arguments)),this.name="DuoSynth";const t=a1(R3.getDefaults(),arguments);this.voice0=new $3(Object.assign(t.voice0,{context:this.context,onsilence:()=>this.onsilence(this)})),this.voice1=new $3(Object.assign(t.voice1,{context:this.context})),this.harmonicity=new X2({context:this.context,units:"positive",value:t.harmonicity}),this._vibrato=new o3({frequency:t.vibratoRate,context:this.context,min:-50,max:50}),this._vibrato.start(),this.vibratoRate=this._vibrato.frequency,this._vibratoGain=new l2({context:this.context,units:"normalRange",gain:t.vibratoAmount}),this.vibratoAmount=this._vibratoGain.gain,this.frequency=new d2({context:this.context,units:"frequency",value:440}),this.detune=new d2({context:this.context,units:"cents",value:t.detune}),this.frequency.connect(this.voice0.frequency),this.frequency.chain(this.harmonicity,this.voice1.frequency),this._vibrato.connect(this._vibratoGain),this._vibratoGain.fan(this.voice0.detune,this.voice1.detune),this.detune.fan(this.voice0.detune,this.voice1.detune),this.voice0.connect(this.output),this.voice1.connect(this.output),N1(this,["voice0","voice1","frequency","vibratoAmount","vibratoRate"])}getLevelAtTime(t){return t=this.toSeconds(t),this.voice0.envelope.getValueAtTime(t)+this.voice1.envelope.getValueAtTime(t)}static getDefaults(){return r1(S3.getDefaults(),{vibratoAmount:.5,vibratoRate:5,harmonicity:1.5,voice0:r1(l1($3.getDefaults(),Object.keys(S3.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}}),voice1:r1(l1($3.getDefaults(),Object.keys(S3.getDefaults())),{filterEnvelope:{attack:.01,decay:0,sustain:1,release:.5},envelope:{attack:.01,decay:0,sustain:1,release:.5}})})}_triggerEnvelopeAttack(t,e){this.voice0._triggerEnvelopeAttack(t,e),this.voice1._triggerEnvelopeAttack(t,e)}_triggerEnvelopeRelease(t){return this.voice0._triggerEnvelopeRelease(t),this.voice1._triggerEnvelopeRelease(t),this}dispose(){return super.dispose(),this.voice0.dispose(),this.voice1.dispose(),this.frequency.dispose(),this.detune.dispose(),this._vibrato.dispose(),this.vibratoRate.dispose(),this._vibratoGain.dispose(),this.harmonicity.dispose(),this}}class D3 extends C3{constructor(){super(a1(D3.getDefaults(),arguments)),this.name="FMSynth";const t=a1(D3.getDefaults(),arguments);this.modulationIndex=new X2({context:this.context,value:t.modulationIndex}),this.frequency.connect(this._carrier.frequency),this.frequency.chain(this.harmonicity,this._modulator.frequency),this.frequency.chain(this.modulationIndex,this._modulationNode),this.detune.fan(this._carrier.detune,this._modulator.detune),this._modulator.connect(this._modulationNode.gain),this._modulationNode.connect(this._carrier.frequency),this._carrier.connect(this.output)}static getDefaults(){return Object.assign(C3.getDefaults(),{modulationIndex:10})}dispose(){return super.dispose(),this.modulationIndex.dispose(),this}}const M3=[1,1.483,1.932,2.546,2.63,3.897];class P3 extends S3{constructor(){super(a1(P3.getDefaults(),arguments)),this.name="MetalSynth",this._oscillators=[],this._freqMultipliers=[];const t=a1(P3.getDefaults(),arguments);this.detune=new d2({context:this.context,units:"cents",value:t.detune}),this.frequency=new d2({context:this.context,units:"frequency"}),this._amplitude=new l2({context:this.context,gain:0}).connect(this.output),this._highpass=new E3({Q:0,context:this.context,type:"highpass"}).connect(this._amplitude);for(let e=0;e<M3.length;e++){const n=new Y2({context:this.context,harmonicity:t.harmonicity,modulationIndex:t.modulationIndex,modulationType:"square",onstop:0===e?()=>this.onsilence(this):O1,type:"square"});n.connect(this._highpass),this._oscillators[e]=n;const s=new X2({context:this.context,value:M3[e]});this._freqMultipliers[e]=s,this.frequency.chain(s,n.frequency),this.detune.connect(n.detune)}this._filterFreqScaler=new i3({context:this.context,max:7e3,min:this.toFrequency(t.resonance)}),this.envelope=new x3({attack:t.envelope.attack,attackCurve:"linear",context:this.context,decay:t.envelope.decay,release:t.envelope.release,sustain:0}),this.envelope.chain(this._filterFreqScaler,this._highpass.frequency),this.envelope.connect(this._amplitude.gain),this._octaves=t.octaves,this.octaves=t.octaves}static getDefaults(){return r1(S3.getDefaults(),{envelope:Object.assign(l1(x3.getDefaults(),Object.keys(o2.getDefaults())),{attack:.001,decay:1.4,release:.2}),harmonicity:5.1,modulationIndex:32,octaves:1.5,resonance:4e3})}_triggerEnvelopeAttack(t,e=1){return this.envelope.triggerAttack(t,e),this._oscillators.forEach((e=>e.start(t))),0===this.envelope.sustain&&this._oscillators.forEach((e=>{e.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay))})),this}_triggerEnvelopeRelease(t){return this.envelope.triggerRelease(t),this._oscillators.forEach((e=>e.stop(t+this.toSeconds(this.envelope.release)))),this}getLevelAtTime(t){return t=this.toSeconds(t),this.envelope.getValueAtTime(t)}get modulationIndex(){return this._oscillators[0].modulationIndex.value}set modulationIndex(t){this._oscillators.forEach((e=>e.modulationIndex.value=t))}get harmonicity(){return this._oscillators[0].harmonicity.value}set harmonicity(t){this._oscillators.forEach((e=>e.harmonicity.value=t))}get resonance(){return this._filterFreqScaler.min}set resonance(t){this._filterFreqScaler.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._filterFreqScaler.max=this._filterFreqScaler.min*Math.pow(2,t)}dispose(){return super.dispose(),this._oscillators.forEach((t=>t.dispose())),this._freqMultipliers.forEach((t=>t.dispose())),this.frequency.dispose(),this.detune.dispose(),this._filterFreqScaler.dispose(),this._amplitude.dispose(),this.envelope.dispose(),this._highpass.dispose(),this}}class F3 extends I3{constructor(){super(a1(F3.getDefaults(),arguments)),this.name="MembraneSynth",this.portamento=0;const t=a1(F3.getDefaults(),arguments);this.pitchDecay=t.pitchDecay,this.octaves=t.octaves,N1(this,["oscillator","envelope"])}static getDefaults(){return r1(S3.getDefaults(),I3.getDefaults(),{envelope:{attack:.001,attackCurve:"exponential",decay:.4,release:1.4,sustain:.01},octaves:10,oscillator:{type:"sine"},pitchDecay:.05})}setNote(t,e){const n=this.toSeconds(e),s=this.toFrequency(t instanceof Y1?t.toFrequency():t),i=s*this.octaves;return this.oscillator.frequency.setValueAtTime(i,n),this.oscillator.frequency.exponentialRampToValueAtTime(s,n+this.toSeconds(this.pitchDecay)),this}dispose(){return super.dispose(),this}}Q0([a3(0)],F3.prototype,"octaves",void 0),Q0([u3(0)],F3.prototype,"pitchDecay",void 0);class L3 extends k3{constructor(){super(a1(L3.getDefaults(),arguments)),this.name="NoiseSynth";const t=a1(L3.getDefaults(),arguments);this.noise=new F2(Object.assign({context:this.context},t.noise)),this.envelope=new T3(Object.assign({context:this.context},t.envelope)),this.noise.chain(this.envelope,this.output)}static getDefaults(){return Object.assign(k3.getDefaults(),{envelope:Object.assign(l1(x3.getDefaults(),Object.keys(o2.getDefaults())),{decay:.1,sustain:0}),noise:Object.assign(l1(F2.getDefaults(),Object.keys(M2.getDefaults())),{type:"white"})})}triggerAttack(t,e=1){return t=this.toSeconds(t),this.envelope.triggerAttack(t,e),this.noise.start(t),0===this.envelope.sustain&&this.noise.stop(t+this.toSeconds(this.envelope.attack)+this.toSeconds(this.envelope.decay)),this}triggerRelease(t){return t=this.toSeconds(t),this.envelope.triggerRelease(t),this.noise.stop(t+this.toSeconds(this.envelope.release)),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",0),this._syncMethod("triggerRelease",0)),this}triggerAttackRelease(t,e,n=1){return e=this.toSeconds(e),t=this.toSeconds(t),this.triggerAttack(e,n),this.triggerRelease(e+t),this}dispose(){return super.dispose(),this.noise.dispose(),this.envelope.dispose(),this}}const z3=new Set;function B3(t){z3.add(t)}function q3(t,e){const n=`registerProcessor("${t}", ${e})`;z3.add(n)}function V3(){return Array.from(z3).join("\n")}class W3 extends o2{constructor(t){super(t),this.name="ToneAudioWorklet",this.workletOptions={},this.onprocessorerror=O1;const e=URL.createObjectURL(new Blob([V3()],{type:"text/javascript"})),n=this._audioWorkletName();this._dummyGain=this.context.createGain(),this._dummyParam=this._dummyGain.gain,this.context.addAudioWorkletModule(e,n).then((()=>{this.disposed||(this._worklet=this.context.createAudioWorkletNode(n,this.workletOptions),this._worklet.onprocessorerror=this.onprocessorerror.bind(this),this.onReady(this._worklet))}))}dispose(){return super.dispose(),this._dummyGain.disconnect(),this._worklet&&(this._worklet.port.postMessage("dispose"),this._worklet.disconnect()),this}}const j3='\n\t/**\n\t * The base AudioWorkletProcessor for use in Tone.js. Works with the [[ToneAudioWorklet]]. \n\t */\n\tclass ToneAudioWorkletProcessor extends AudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\t\n\t\t\tsuper(options);\n\t\t\t/**\n\t\t\t * If the processor was disposed or not. Keep alive until it\'s disposed.\n\t\t\t */\n\t\t\tthis.disposed = false;\n\t\t   \t/** \n\t\t\t * The number of samples in the processing block\n\t\t\t */\n\t\t\tthis.blockSize = 128;\n\t\t\t/**\n\t\t\t * the sample rate\n\t\t\t */\n\t\t\tthis.sampleRate = sampleRate;\n\n\t\t\tthis.port.onmessage = (event) => {\n\t\t\t\t// when it receives a dispose \n\t\t\t\tif (event.data === "dispose") {\n\t\t\t\t\tthis.disposed = true;\n\t\t\t\t}\n\t\t\t};\n\t\t}\n\t}\n';B3(j3);const U3="\n\t/**\n\t * Abstract class for a single input/output processor. \n\t * has a 'generate' function which processes one sample at a time\n\t */\n\tclass SingleIOProcessor extends ToneAudioWorkletProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(Object.assign(options, {\n\t\t\t\tnumberOfInputs: 1,\n\t\t\t\tnumberOfOutputs: 1\n\t\t\t}));\n\t\t\t/**\n\t\t\t * Holds the name of the parameter and a single value of that\n\t\t\t * parameter at the current sample\n\t\t\t * @type { [name: string]: number }\n\t\t\t */\n\t\t\tthis.params = {}\n\t\t}\n\n\t\t/**\n\t\t * Generate an output sample from the input sample and parameters\n\t\t * @abstract\n\t\t * @param input number\n\t\t * @param channel number\n\t\t * @param parameters { [name: string]: number }\n\t\t * @returns number\n\t\t */\n\t\tgenerate(){}\n\n\t\t/**\n\t\t * Update the private params object with the \n\t\t * values of the parameters at the given index\n\t\t * @param parameters { [name: string]: Float32Array },\n\t\t * @param index number\n\t\t */\n\t\tupdateParams(parameters, index) {\n\t\t\tfor (const paramName in parameters) {\n\t\t\t\tconst param = parameters[paramName];\n\t\t\t\tif (param.length > 1) {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][index];\n\t\t\t\t} else {\n\t\t\t\t\tthis.params[paramName] = parameters[paramName][0];\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Process a single frame of the audio\n\t\t * @param inputs Float32Array[][]\n\t\t * @param outputs Float32Array[][]\n\t\t */\n\t\tprocess(inputs, outputs, parameters) {\n\t\t\tconst input = inputs[0];\n\t\t\tconst output = outputs[0];\n\t\t\t// get the parameter values\n\t\t\tconst channelCount = Math.max(input && input.length || 0, output.length);\n\t\t\tfor (let sample = 0; sample < this.blockSize; sample++) {\n\t\t\t\tthis.updateParams(parameters, sample);\n\t\t\t\tfor (let channel = 0; channel < channelCount; channel++) {\n\t\t\t\t\tconst inputSample = input && input.length ? input[channel][sample] : 0;\n\t\t\t\t\toutput[channel][sample] = this.generate(inputSample, channel, this.params);\n\t\t\t\t}\n\t\t\t}\n\t\t\treturn !this.disposed;\n\t\t}\n\t};\n";B3(U3);const G3="\n\t/**\n\t * A multichannel buffer for use within an AudioWorkletProcessor as a delay line\n\t */\n\tclass DelayLine {\n\t\t\n\t\tconstructor(size, channels) {\n\t\t\tthis.buffer = [];\n\t\t\tthis.writeHead = []\n\t\t\tthis.size = size;\n\n\t\t\t// create the empty channels\n\t\t\tfor (let i = 0; i < channels; i++) {\n\t\t\t\tthis.buffer[i] = new Float32Array(this.size);\n\t\t\t\tthis.writeHead[i] = 0;\n\t\t\t}\n\t\t}\n\n\t\t/**\n\t\t * Push a value onto the end\n\t\t * @param channel number\n\t\t * @param value number\n\t\t */\n\t\tpush(channel, value) {\n\t\t\tthis.writeHead[channel] += 1;\n\t\t\tif (this.writeHead[channel] > this.size) {\n\t\t\t\tthis.writeHead[channel] = 0;\n\t\t\t}\n\t\t\tthis.buffer[channel][this.writeHead[channel]] = value;\n\t\t}\n\n\t\t/**\n\t\t * Get the recorded value of the channel given the delay\n\t\t * @param channel number\n\t\t * @param delay number delay samples\n\t\t */\n\t\tget(channel, delay) {\n\t\t\tlet readHead = this.writeHead[channel] - Math.floor(delay);\n\t\t\tif (readHead < 0) {\n\t\t\t\treadHead += this.size;\n\t\t\t}\n\t\t\treturn this.buffer[channel][readHead];\n\t\t}\n\t}\n";B3(G3);const H3="feedback-comb-filter",K3='\n\tclass FeedbackCombFilterWorklet extends SingleIOProcessor {\n\n\t\tconstructor(options) {\n\t\t\tsuper(options);\n\t\t\tthis.delayLine = new DelayLine(this.sampleRate, options.channelCount || 2);\n\t\t}\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: "delayTime",\n\t\t\t\tdefaultValue: 0.1,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 1,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}, {\n\t\t\t\tname: "feedback",\n\t\t\t\tdefaultValue: 0.5,\n\t\t\t\tminValue: 0,\n\t\t\t\tmaxValue: 0.9999,\n\t\t\t\tautomationRate: "k-rate"\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, channel, parameters) {\n\t\t\tconst delayedSample = this.delayLine.get(channel, parameters.delayTime * this.sampleRate);\n\t\t\tthis.delayLine.push(channel, input + delayedSample * parameters.feedback);\n\t\t\treturn delayedSample;\n\t\t}\n\t}\n';q3(H3,K3);class X3 extends W3{constructor(){super(a1(X3.getDefaults(),arguments,["delayTime","resonance"])),this.name="FeedbackCombFilter";const t=a1(X3.getDefaults(),arguments,["delayTime","resonance"]);this.input=new l2({context:this.context}),this.output=new l2({context:this.context}),this.delayTime=new r2({context:this.context,value:t.delayTime,units:"time",minValue:0,maxValue:1,param:this._dummyParam,swappable:!0}),this.resonance=new r2({context:this.context,value:t.resonance,units:"normalRange",param:this._dummyParam,swappable:!0}),N1(this,["resonance","delayTime"])}_audioWorkletName(){return H3}static getDefaults(){return Object.assign(o2.getDefaults(),{delayTime:.1,resonance:.5})}onReady(t){a2(this.input,t,this.output);const e=t.parameters.get("delayTime");this.delayTime.setParam(e);const n=t.parameters.get("feedback");this.resonance.setParam(n)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.delayTime.dispose(),this.resonance.dispose(),this}}class Q3 extends o2{constructor(){super(a1(Q3.getDefaults(),arguments,["frequency","type"])),this.name="OnePoleFilter";const t=a1(Q3.getDefaults(),arguments,["frequency","type"]);this._frequency=t.frequency,this._type=t.type,this.input=new l2({context:this.context}),this.output=new l2({context:this.context}),this._createFilter()}static getDefaults(){return Object.assign(o2.getDefaults(),{frequency:880,type:"lowpass"})}_createFilter(){const t=this._filter,e=this.toFrequency(this._frequency),n=1/(2*Math.PI*e);if("lowpass"===this._type){const t=1/(n*this.context.sampleRate),e=t-1;this._filter=this.context.createIIRFilter([t,0],[1,e])}else{const t=1/(n*this.context.sampleRate)-1;this._filter=this.context.createIIRFilter([1,-1],[1,t])}this.input.chain(this._filter,this.output),t&&this.context.setTimeout((()=>{this.disposed||(this.input.disconnect(t),t.disconnect())}),this.blockTime)}get frequency(){return this._frequency}set frequency(t){this._frequency=t,this._createFilter()}get type(){return this._type}set type(t){this._type=t,this._createFilter()}getFrequencyResponse(t=128){const e=new Float32Array(t);for(let i=0;i<t;i++){const n=Math.pow(i/t,2),s=19980*n+20;e[i]=s}const n=new Float32Array(t),s=new Float32Array(t);return this._filter.getFrequencyResponse(e,n,s),n}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this._filter.disconnect(),this}}class Y3 extends o2{constructor(){super(a1(Y3.getDefaults(),arguments,["delayTime","resonance","dampening"])),this.name="LowpassCombFilter";const t=a1(Y3.getDefaults(),arguments,["delayTime","resonance","dampening"]);this._combFilter=this.output=new X3({context:this.context,delayTime:t.delayTime,resonance:t.resonance}),this.delayTime=this._combFilter.delayTime,this.resonance=this._combFilter.resonance,this._lowpass=this.input=new Q3({context:this.context,frequency:t.dampening,type:"lowpass"}),this._lowpass.connect(this._combFilter)}static getDefaults(){return Object.assign(o2.getDefaults(),{dampening:3e3,delayTime:.1,resonance:.5})}get dampening(){return this._lowpass.frequency}set dampening(t){this._lowpass.frequency=t}dispose(){return super.dispose(),this._combFilter.dispose(),this._lowpass.dispose(),this}}class Z3 extends k3{constructor(){super(a1(Z3.getDefaults(),arguments)),this.name="PluckSynth";const t=a1(Z3.getDefaults(),arguments);this._noise=new F2({context:this.context,type:"pink"}),this.attackNoise=t.attackNoise,this._lfcf=new Y3({context:this.context,dampening:t.dampening,resonance:t.resonance}),this.resonance=t.resonance,this.release=t.release,this._noise.connect(this._lfcf),this._lfcf.connect(this.output)}static getDefaults(){return r1(k3.getDefaults(),{attackNoise:1,dampening:4e3,resonance:.7,release:1})}get dampening(){return this._lfcf.dampening}set dampening(t){this._lfcf.dampening=t}triggerAttack(t,e){const n=this.toFrequency(t);e=this.toSeconds(e);const s=1/n;return this._lfcf.delayTime.setValueAtTime(s,e),this._noise.start(e),this._noise.stop(e+s*this.attackNoise),this._lfcf.resonance.cancelScheduledValues(e),this._lfcf.resonance.setValueAtTime(this.resonance,e),this}triggerRelease(t){return this._lfcf.resonance.linearRampTo(0,this.release,t),this}dispose(){return super.dispose(),this._noise.dispose(),this._lfcf.dispose(),this}}class J3 extends k3{constructor(){super(a1(J3.getDefaults(),arguments,["voice","options"])),this.name="PolySynth",this._availableVoices=[],this._activeVoices=[],this._voices=[],this._gcTimeout=-1,this._averageActiveVoices=0;const t=a1(J3.getDefaults(),arguments,["voice","options"]);N0(!z0(t.voice),"DEPRECATED: The polyphony count is no longer the first argument.");const e=t.voice.getDefaults();this.options=Object.assign(e,t.options),this.voice=t.voice,this.maxPolyphony=t.maxPolyphony,this._dummyVoice=this._getNextAvailableVoice();const n=this._voices.indexOf(this._dummyVoice);this._voices.splice(n,1),this._gcTimeout=this.context.setInterval(this._collectGarbage.bind(this),1)}static getDefaults(){return Object.assign(k3.getDefaults(),{maxPolyphony:32,options:{},voice:I3})}get activeVoices(){return this._activeVoices.length}_makeVoiceAvailable(t){this._availableVoices.push(t);const e=this._activeVoices.findIndex((e=>e.voice===t));this._activeVoices.splice(e,1)}_getNextAvailableVoice(){if(this._availableVoices.length)return this._availableVoices.shift();if(this._voices.length<this.maxPolyphony){const t=new this.voice(Object.assign(this.options,{context:this.context,onsilence:this._makeVoiceAvailable.bind(this)}));return t.connect(this.output),this._voices.push(t),t}M0("Max polyphony exceeded. Note dropped.")}_collectGarbage(){if(this._averageActiveVoices=Math.max(.95*this._averageActiveVoices,this.activeVoices),this._availableVoices.length&&this._voices.length>Math.ceil(this._averageActiveVoices+1)){const t=this._availableVoices.shift(),e=this._voices.indexOf(t);this._voices.splice(e,1),this.context.isOffline||t.dispose()}}_triggerAttack(t,e,n){t.forEach((t=>{const s=new _2(this.context,t).toMidi(),i=this._getNextAvailableVoice();i&&(i.triggerAttack(t,e,n),this._activeVoices.push({midi:s,voice:i,released:!1}),this.log("triggerAttack",t,e))}))}_triggerRelease(t,e){t.forEach((t=>{const n=new _2(this.context,t).toMidi(),s=this._activeVoices.find((({midi:t,released:e})=>t===n&&!e));s&&(s.voice.triggerRelease(e),s.released=!0,this.log("triggerRelease",t,e))}))}_scheduleEvent(t,e,n,s){N0(!this.disposed,"Synth was already disposed"),n<=this.now()?"attack"===t?this._triggerAttack(e,n,s):this._triggerRelease(e,n):this.context.setTimeout((()=>{this._scheduleEvent(t,e,n,s)}),n-this.now())}triggerAttack(t,e,n){Array.isArray(t)||(t=[t]);const s=this.toSeconds(e);return this._scheduleEvent("attack",t,s,n),this}triggerRelease(t,e){Array.isArray(t)||(t=[t]);const n=this.toSeconds(e);return this._scheduleEvent("release",t,n),this}triggerAttackRelease(t,e,n,s){const i=this.toSeconds(n);if(this.triggerAttack(t,i,s),V0(e)){N0(V0(t),"If the duration is an array, the notes must also be an array");for(let n=0;n<t.length;n++){const s=e[Math.min(n,e.length-1)],r=this.toSeconds(s);N0(r>0,"The duration must be greater than 0"),this.triggerRelease(t[n],i+r)}}else{const n=this.toSeconds(e);N0(n>0,"The duration must be greater than 0"),this.triggerRelease(t,i+n)}return this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}set(t){const e=l1(t,["onsilence","context"]);return this.options=r1(this.options,e),this._voices.forEach((t=>t.set(e))),this._dummyVoice.set(e),this}get(){return this._dummyVoice.get()}releaseAll(t){const e=this.toSeconds(t);return this._activeVoices.forEach((({voice:t})=>{t.triggerRelease(e)})),this}dispose(){return super.dispose(),this._dummyVoice.dispose(),this._voices.forEach((t=>t.dispose())),this._activeVoices=[],this._availableVoices=[],this.context.clearInterval(this._gcTimeout),this}}class t4 extends k3{constructor(){super(a1(t4.getDefaults(),arguments,["urls","onload","baseUrl"],"urls")),this.name="Sampler",this._activeSources=new Map;const t=a1(t4.getDefaults(),arguments,["urls","onload","baseUrl"],"urls"),e={};Object.keys(t.urls).forEach((n=>{const s=parseInt(n,10);if(N0(j0(n)||z0(s)&&isFinite(s),`url key is neither a note or midi pitch: ${n}`),j0(n)){const s=new Y1(this.context,n).toMidi();e[s]=t.urls[n]}else z0(s)&&isFinite(s)&&(e[s]=t.urls[s])})),this._buffers=new x2({urls:e,onload:t.onload,baseUrl:t.baseUrl,onerror:t.onerror}),this.attack=t.attack,this.release=t.release,this.curve=t.curve,this._buffers.loaded&&Promise.resolve().then(t.onload)}static getDefaults(){return Object.assign(k3.getDefaults(),{attack:0,baseUrl:"",curve:"exponential",onload:O1,onerror:O1,release:.1,urls:{}})}_findClosest(t){const e=96;let n=0;while(n<e){if(this._buffers.has(t+n))return-n;if(this._buffers.has(t-n))return n;n++}throw new Error(`No available buffers for note: ${t}`)}triggerAttack(t,e,n=1){return this.log("triggerAttack",t,e,n),Array.isArray(t)||(t=[t]),t.forEach((t=>{const s=G1(new Y1(this.context,t).toFrequency()),i=Math.round(s),r=s-i,o=this._findClosest(i),a=i-o,u=this._buffers.get(a),c=q1(o+r),l=new P2({url:u,context:this.context,curve:this.curve,fadeIn:this.attack,fadeOut:this.release,playbackRate:c}).connect(this.output);l.start(e,0,u.duration/c,n),V0(this._activeSources.get(i))||this._activeSources.set(i,[]),this._activeSources.get(i).push(l),l.onended=()=>{if(this._activeSources&&this._activeSources.has(i)){const t=this._activeSources.get(i),e=t.indexOf(l);-1!==e&&t.splice(e,1)}}})),this}triggerRelease(t,e){return this.log("triggerRelease",t,e),Array.isArray(t)||(t=[t]),t.forEach((t=>{const n=new Y1(this.context,t).toMidi();if(this._activeSources.has(n)&&this._activeSources.get(n).length){const t=this._activeSources.get(n);e=this.toSeconds(e),t.forEach((t=>{t.stop(e)})),this._activeSources.set(n,[])}})),this}releaseAll(t){const e=this.toSeconds(t);return this._activeSources.forEach((t=>{while(t.length){const n=t.shift();n.stop(e)}})),this}sync(){return this._syncState()&&(this._syncMethod("triggerAttack",1),this._syncMethod("triggerRelease",1)),this}triggerAttackRelease(t,e,n,s=1){const i=this.toSeconds(n);return this.triggerAttack(t,i,s),V0(e)?(N0(V0(t),"notes must be an array when duration is array"),t.forEach(((t,n)=>{const s=e[Math.min(n,e.length-1)];this.triggerRelease(t,i+this.toSeconds(s))}))):this.triggerRelease(t,i+this.toSeconds(e)),this}add(t,e,n){if(N0(j0(t)||isFinite(t),`note must be a pitch or midi: ${t}`),j0(t)){const s=new Y1(this.context,t).toMidi();this._buffers.add(s,e,n)}else this._buffers.add(t,e,n);return this}get loaded(){return this._buffers.loaded}dispose(){return super.dispose(),this._buffers.dispose(),this._activeSources.forEach((t=>{t.forEach((t=>t.dispose()))})),this._activeSources.clear(),this}}Q0([u3(0)],t4.prototype,"attack",void 0),Q0([u3(0)],t4.prototype,"release",void 0);class e4 extends s2{constructor(){super(a1(e4.getDefaults(),arguments,["callback","value"])),this.name="ToneEvent",this._state=new i2("stopped"),this._startOffset=0;const t=a1(e4.getDefaults(),arguments,["callback","value"]);this._loop=t.loop,this.callback=t.callback,this.value=t.value,this._loopStart=this.toTicks(t.loopStart),this._loopEnd=this.toTicks(t.loopEnd),this._playbackRate=t.playbackRate,this._probability=t.probability,this._humanize=t.humanize,this.mute=t.mute,this._playbackRate=t.playbackRate,this._state.increasing=!0,this._rescheduleEvents()}static getDefaults(){return Object.assign(s2.getDefaults(),{callback:O1,humanize:!1,loop:!1,loopEnd:"1m",loopStart:0,mute:!1,playbackRate:1,probability:1,value:null})}_rescheduleEvents(t=-1){this._state.forEachFrom(t,(t=>{let e;if("started"===t.state){-1!==t.id&&this.context.transport.clear(t.id);const n=t.time+Math.round(this.startOffset/this._playbackRate);if(!0===this._loop||z0(this._loop)&&this._loop>1){e=1/0,z0(this._loop)&&(e=this._loop*this._getLoopDuration());const s=this._state.getAfter(n);null!==s&&(e=Math.min(e,s.time-n)),e!==1/0&&(this._state.setStateAtTime("stopped",n+e+1,{id:-1}),e=new S2(this.context,e));const i=new S2(this.context,this._getLoopDuration());t.id=this.context.transport.scheduleRepeat(this._tick.bind(this),i,new S2(this.context,n),e)}else t.id=this.context.transport.schedule(this._tick.bind(this),new S2(this.context,n))}}))}get state(){return this._state.getValueAtTime(this.context.transport.ticks)}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t}get probability(){return this._probability}set probability(t){this._probability=t}get humanize(){return this._humanize}set humanize(t){this._humanize=t}start(t){const e=this.toTicks(t);return"stopped"===this._state.getValueAtTime(e)&&(this._state.add({id:-1,state:"started",time:e}),this._rescheduleEvents(e)),this}stop(t){this.cancel(t);const e=this.toTicks(t);if("started"===this._state.getValueAtTime(e)){this._state.setStateAtTime("stopped",e,{id:-1});const t=this._state.getBefore(e);let n=e;null!==t&&(n=t.time),this._rescheduleEvents(n)}return this}cancel(t){t=c1(t,-1/0);const e=this.toTicks(t);return this._state.forEachFrom(e,(t=>{this.context.transport.clear(t.id)})),this._state.cancel(e),this}_tick(t){const e=this.context.transport.getTicksAtTime(t);if(!this.mute&&"started"===this._state.getValueAtTime(e)){if(this.probability<1&&Math.random()>this.probability)return;if(this.humanize){let e=.02;q0(this.humanize)||(e=this.toSeconds(this.humanize)),t+=(2*Math.random()-1)*e}this.callback(t,this.value)}}_getLoopDuration(){return Math.round((this._loopEnd-this._loopStart)/this._playbackRate)}get loop(){return this._loop}set loop(t){this._loop=t,this._rescheduleEvents()}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._rescheduleEvents()}get loopEnd(){return new S2(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._rescheduleEvents()}get loopStart(){return new S2(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._rescheduleEvents()}get progress(){if(this._loop){const t=this.context.transport.ticks,e=this._state.get(t);if(null!==e&&"started"===e.state){const n=this._getLoopDuration(),s=(t-e.time)%n;return s/n}return 0}return 0}dispose(){return super.dispose(),this.cancel(),this._state.dispose(),this}}class n4 extends s2{constructor(){super(a1(n4.getDefaults(),arguments,["callback","interval"])),this.name="Loop";const t=a1(n4.getDefaults(),arguments,["callback","interval"]);this._event=new e4({context:this.context,callback:this._tick.bind(this),loop:!0,loopEnd:t.interval,playbackRate:t.playbackRate,probability:t.probability}),this.callback=t.callback,this.iterations=t.iterations}static getDefaults(){return Object.assign(s2.getDefaults(),{interval:"4n",callback:O1,playbackRate:1,iterations:1/0,probability:1,mute:!1,humanize:!1})}start(t){return this._event.start(t),this}stop(t){return this._event.stop(t),this}cancel(t){return this._event.cancel(t),this}_tick(t){this.callback(t)}get state(){return this._event.state}get progress(){return this._event.progress}get interval(){return this._event.loopEnd}set interval(t){this._event.loopEnd=t}get playbackRate(){return this._event.playbackRate}set playbackRate(t){this._event.playbackRate=t}get humanize(){return this._event.humanize}set humanize(t){this._event.humanize=t}get probability(){return this._event.probability}set probability(t){this._event.probability=t}get mute(){return this._event.mute}set mute(t){this._event.mute=t}get iterations(){return!0===this._event.loop?1/0:this._event.loop}set iterations(t){this._event.loop=t===1/0||t}dispose(){return super.dispose(),this._event.dispose(),this}}class s4 extends e4{constructor(){super(a1(s4.getDefaults(),arguments,["callback","events"])),this.name="Part",this._state=new i2("stopped"),this._events=new Set;const t=a1(s4.getDefaults(),arguments,["callback","events"]);this._state.increasing=!0,t.events.forEach((t=>{V0(t)?this.add(t[0],t[1]):this.add(t)}))}static getDefaults(){return Object.assign(e4.getDefaults(),{events:[]})}start(t,e){const n=this.toTicks(t);if("started"!==this._state.getValueAtTime(n)){e=c1(e,this._loop?this._loopStart:0),e=this._loop?c1(e,this._loopStart):c1(e,0);const t=this.toTicks(e);this._state.add({id:-1,offset:t,state:"started",time:n}),this._forEach((e=>{this._startNote(e,n,t)}))}return this}_startNote(t,e,n){e-=n,this._loop?t.startOffset>=this._loopStart&&t.startOffset<this._loopEnd?(t.startOffset<n&&(e+=this._getLoopDuration()),t.start(new S2(this.context,e))):t.startOffset<this._loopStart&&t.startOffset>=n&&(t.loop=!1,t.start(new S2(this.context,e))):t.startOffset>=n&&t.start(new S2(this.context,e))}get startOffset(){return this._startOffset}set startOffset(t){this._startOffset=t,this._forEach((t=>{t.startOffset+=this._startOffset}))}stop(t){const e=this.toTicks(t);return this._state.cancel(e),this._state.setStateAtTime("stopped",e),this._forEach((e=>{e.stop(t)})),this}at(t,e){const n=new e2(this.context,t).toTicks(),s=new S2(this.context,1).toSeconds(),i=this._events.values();let r=i.next();while(!r.done){const t=r.value;if(Math.abs(n-t.startOffset)<s)return F0(e)&&(t.value=e),t;r=i.next()}return F0(e)?(this.add(t,e),this.at(t)):null}add(t,e){t instanceof Object&&Reflect.has(t,"time")&&(e=t,t=e.time);const n=this.toTicks(t);let s;return e instanceof e4?(s=e,s.callback=this._tick.bind(this)):s=new e4({callback:this._tick.bind(this),context:this.context,value:e}),s.startOffset=n,s.set({humanize:this.humanize,loop:this.loop,loopEnd:this.loopEnd,loopStart:this.loopStart,playbackRate:this.playbackRate,probability:this.probability}),this._events.add(s),this._restartEvent(s),this}_restartEvent(t){this._state.forEach((e=>{"started"===e.state?this._startNote(t,e.time,e.offset):t.stop(new S2(this.context,e.time))}))}remove(t,e){return B0(t)&&t.hasOwnProperty("time")&&(e=t,t=e.time),t=this.toTicks(t),this._events.forEach((n=>{n.startOffset===t&&(P0(e)||F0(e)&&n.value===e)&&(this._events.delete(n),n.dispose())})),this}clear(){return this._forEach((t=>t.dispose())),this._events.clear(),this}cancel(t){return this._forEach((e=>e.cancel(t))),this._state.cancel(this.toTicks(t)),this}_forEach(t){return this._events&&this._events.forEach((e=>{e instanceof s4?e._forEach(t):t(e)})),this}_setAll(t,e){this._forEach((n=>{n[t]=e}))}_tick(t,e){this.mute||this.callback(t,e)}_testLoopBoundries(t){this._loop&&(t.startOffset<this._loopStart||t.startOffset>=this._loopEnd)?t.cancel(0):"stopped"===t.state&&this._restartEvent(t)}get probability(){return this._probability}set probability(t){this._probability=t,this._setAll("probability",t)}get humanize(){return this._humanize}set humanize(t){this._humanize=t,this._setAll("humanize",t)}get loop(){return this._loop}set loop(t){this._loop=t,this._forEach((e=>{e.loopStart=this.loopStart,e.loopEnd=this.loopEnd,e.loop=t,this._testLoopBoundries(e)}))}get loopEnd(){return new S2(this.context,this._loopEnd).toSeconds()}set loopEnd(t){this._loopEnd=this.toTicks(t),this._loop&&this._forEach((e=>{e.loopEnd=t,this._testLoopBoundries(e)}))}get loopStart(){return new S2(this.context,this._loopStart).toSeconds()}set loopStart(t){this._loopStart=this.toTicks(t),this._loop&&this._forEach((t=>{t.loopStart=this.loopStart,this._testLoopBoundries(t)}))}get playbackRate(){return this._playbackRate}set playbackRate(t){this._playbackRate=t,this._setAll("playbackRate",t)}get length(){return this._events.size}dispose(){return super.dispose(),this.clear(),this}}function*i4(t){let e=0;while(e<t.length)e=a4(e,t),yield t[e],e++}function*r4(t){let e=t.length-1;while(e>=0)e=a4(e,t),yield t[e],e--}function*o4(t,e){while(1)yield*e(t)}function a4(t,e){return y1(t,0,e.length-1)}function*u4(t,e){let n=e?0:t.length-1;while(1)n=a4(n,t),yield t[n],e?(n++,n>=t.length-1&&(e=!1)):(n--,n<=0&&(e=!0))}function*c4(t){let e=0,n=0;while(e<t.length)e=a4(e,t),yield t[e],n++,e+=n%2?2:-1}function*l4(t){let e=t.length-1,n=0;while(e>=0)e=a4(e,t),yield t[e],n++,e+=n%2?-2:1}function*h4(t){while(1){const e=Math.floor(Math.random()*t.length);yield t[e]}}function*p4(t){const e=[];for(let n=0;n<t.length;n++)e.push(n);while(e.length>0){const n=e.splice(Math.floor(e.length*Math.random()),1),s=a4(n[0],t);yield t[s]}}function*d4(t){let e=Math.floor(Math.random()*t.length);while(1)0===e?e++:e===t.length-1||Math.random()<.5?e--:e++,yield t[e]}function*f4(t,e="up",n=0){switch(N0(t.length>0,"The array must have more than one value in it"),e){case"up":yield*o4(t,i4);case"down":yield*o4(t,r4);case"upDown":yield*u4(t,!0);case"downUp":yield*u4(t,!1);case"alternateUp":yield*o4(t,c4);case"alternateDown":yield*o4(t,l4);case"random":yield*h4(t);case"randomOnce":yield*o4(t,p4);case"randomWalk":yield*d4(t)}}class m4 extends n4{constructor(){super(a1(m4.getDefaults(),arguments,["callback","values","pattern"])),this.name="Pattern";const t=a1(m4.getDefaults(),arguments,["callback","values","pattern"]);this.callback=t.callback,this._values=t.values,this._pattern=f4(t.values,t.pattern),this._type=t.pattern}static getDefaults(){return Object.assign(n4.getDefaults(),{pattern:"up",values:[],callback:O1})}_tick(t){const e=this._pattern.next();this._value=e.value,this.callback(t,this._value)}get values(){return this._values}set values(t){this._values=t,this.pattern=this._type}get value(){return this._value}get pattern(){return this._type}set pattern(t){this._type=t,this._pattern=f4(this._values,this._type)}}class g4 extends e4{constructor(){super(a1(g4.getDefaults(),arguments,["callback","events","subdivision"])),this.name="Sequence",this._part=new s4({callback:this._seqCallback.bind(this),context:this.context}),this._events=[],this._eventsArray=[];const t=a1(g4.getDefaults(),arguments,["callback","events","subdivision"]);this._subdivision=this.toTicks(t.subdivision),this.events=t.events,this.loop=t.loop,this.loopStart=t.loopStart,this.loopEnd=t.loopEnd,this.playbackRate=t.playbackRate,this.probability=t.probability,this.humanize=t.humanize,this.mute=t.mute,this.playbackRate=t.playbackRate}static getDefaults(){return Object.assign(l1(e4.getDefaults(),["value"]),{events:[],loop:!0,loopEnd:0,loopStart:0,subdivision:"8n"})}_seqCallback(t,e){null!==e&&this.callback(t,e)}get events(){return this._events}set events(t){this.clear(),this._eventsArray=t,this._events=this._createSequence(this._eventsArray),this._eventsUpdated()}start(t,e){return this._part.start(t,e?this._indexTime(e):e),this}stop(t){return this._part.stop(t),this}get subdivision(){return new S2(this.context,this._subdivision).toSeconds()}_createSequence(t){return new Proxy(t,{get:(t,e)=>t[e],set:(t,e,n)=>(W0(e)&&isFinite(parseInt(e,10))&&V0(n)?t[e]=this._createSequence(n):t[e]=n,this._eventsUpdated(),!0)})}_eventsUpdated(){this._part.clear(),this._rescheduleSequence(this._eventsArray,this._subdivision,this.startOffset),this.loopEnd=this.loopEnd}_rescheduleSequence(t,e,n){t.forEach(((t,s)=>{const i=s*e+n;if(V0(t))this._rescheduleSequence(t,e/t.length,i);else{const e=new S2(this.context,i,"i").toSeconds();this._part.add(e,t)}}))}_indexTime(t){return new S2(this.context,t*this._subdivision+this.startOffset).toSeconds()}clear(){return this._part.clear(),this}dispose(){return super.dispose(),this._part.dispose(),this}get loop(){return this._part.loop}set loop(t){this._part.loop=t}get loopStart(){return this._loopStart}set loopStart(t){this._loopStart=t,this._part.loopStart=this._indexTime(t)}get loopEnd(){return this._loopEnd}set loopEnd(t){this._loopEnd=t,this._part.loopEnd=0===t?this._indexTime(this._eventsArray.length):this._indexTime(t)}get startOffset(){return this._part.startOffset}set startOffset(t){this._part.startOffset=t}get playbackRate(){return this._part.playbackRate}set playbackRate(t){this._part.playbackRate=t}get probability(){return this._part.probability}set probability(t){this._part.probability=t}get progress(){return this._part.progress}get humanize(){return this._part.humanize}set humanize(t){this._part.humanize=t}get length(){return this._part.length}}class y4 extends o2{constructor(){super(Object.assign(a1(y4.getDefaults(),arguments,["fade"]))),this.name="CrossFade",this._panner=this.context.createStereoPanner(),this._split=this.context.createChannelSplitter(2),this._g2a=new d3({context:this.context}),this.a=new l2({context:this.context,gain:0}),this.b=new l2({context:this.context,gain:0}),this.output=new l2({context:this.context}),this._internalChannels=[this.a,this.b];const t=a1(y4.getDefaults(),arguments,["fade"]);this.fade=new d2({context:this.context,units:"normalRange",value:t.fade}),N1(this,"fade"),this.context.getConstant(1).connect(this._panner),this._panner.connect(this._split),this._panner.channelCount=1,this._panner.channelCountMode="explicit",u2(this._split,this.a.gain,0),u2(this._split,this.b.gain,1),this.fade.chain(this._g2a,this._panner.pan),this.a.connect(this.output),this.b.connect(this.output)}static getDefaults(){return Object.assign(o2.getDefaults(),{fade:.5})}dispose(){return super.dispose(),this.a.dispose(),this.b.dispose(),this.output.dispose(),this.fade.dispose(),this._g2a.dispose(),this._panner.disconnect(),this._split.disconnect(),this}}class b4 extends o2{constructor(t){super(t),this.name="Effect",this._dryWet=new y4({context:this.context}),this.wet=this._dryWet.fade,this.effectSend=new l2({context:this.context}),this.effectReturn=new l2({context:this.context}),this.input=new l2({context:this.context}),this.output=this._dryWet,this.input.fan(this._dryWet.a,this.effectSend),this.effectReturn.connect(this._dryWet.b),this.wet.setValueAtTime(t.wet,0),this._internalChannels=[this.effectReturn,this.effectSend],N1(this,"wet")}static getDefaults(){return Object.assign(o2.getDefaults(),{wet:1})}connectEffect(t){return this._internalChannels.push(t),this.effectSend.chain(t,this.effectReturn),this}dispose(){return super.dispose(),this._dryWet.dispose(),this.effectSend.dispose(),this.effectReturn.dispose(),this.wet.dispose(),this}}class v4 extends b4{constructor(t){super(t),this.name="LFOEffect",this._lfo=new o3({context:this.context,frequency:t.frequency,amplitude:t.depth}),this.depth=this._lfo.amplitude,this.frequency=this._lfo.frequency,this.type=t.type,N1(this,["frequency","depth"])}static getDefaults(){return Object.assign(b4.getDefaults(),{frequency:1,type:"sine",depth:1})}start(t){return this._lfo.start(t),this}stop(t){return this._lfo.stop(t),this}sync(){return this._lfo.sync(),this}unsync(){return this._lfo.unsync(),this}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class w4 extends v4{constructor(){super(a1(w4.getDefaults(),arguments,["frequency","baseFrequency","octaves"])),this.name="AutoFilter";const t=a1(w4.getDefaults(),arguments,["frequency","baseFrequency","octaves"]);this.filter=new E3(Object.assign(t.filter,{context:this.context})),this.connectEffect(this.filter),this._lfo.connect(this.filter.frequency),this.octaves=t.octaves,this.baseFrequency=t.baseFrequency}static getDefaults(){return Object.assign(v4.getDefaults(),{baseFrequency:200,octaves:2.6,filter:{type:"lowpass",rolloff:-12,Q:1}})}get baseFrequency(){return this._lfo.min}set baseFrequency(t){this._lfo.min=this.toFrequency(t),this.octaves=this._octaves}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._lfo.max=this._lfo.min*Math.pow(2,t)}dispose(){return super.dispose(),this.filter.dispose(),this}}class x4 extends o2{constructor(){super(Object.assign(a1(x4.getDefaults(),arguments,["pan"]))),this.name="Panner",this._panner=this.context.createStereoPanner(),this.input=this._panner,this.output=this._panner;const t=a1(x4.getDefaults(),arguments,["pan"]);this.pan=new r2({context:this.context,param:this._panner.pan,value:t.pan,minValue:-1,maxValue:1}),this._panner.channelCount=t.channelCount,this._panner.channelCountMode="explicit",N1(this,"pan")}static getDefaults(){return Object.assign(o2.getDefaults(),{pan:0,channelCount:1})}dispose(){return super.dispose(),this._panner.disconnect(),this.pan.dispose(),this}}class _4 extends v4{constructor(){super(a1(_4.getDefaults(),arguments,["frequency"])),this.name="AutoPanner";const t=a1(_4.getDefaults(),arguments,["frequency"]);this._panner=new x4({context:this.context,channelCount:t.channelCount}),this.connectEffect(this._panner),this._lfo.connect(this._panner.pan),this._lfo.min=-1,this._lfo.max=1}static getDefaults(){return Object.assign(v4.getDefaults(),{channelCount:1})}dispose(){return super.dispose(),this._panner.dispose(),this}}class k4 extends o2{constructor(){super(a1(k4.getDefaults(),arguments,["smoothing"])),this.name="Follower";const t=a1(k4.getDefaults(),arguments,["smoothing"]);this._abs=this.input=new p3({context:this.context}),this._lowpass=this.output=new Q3({context:this.context,frequency:1/this.toSeconds(t.smoothing),type:"lowpass"}),this._abs.connect(this._lowpass),this._smoothing=t.smoothing}static getDefaults(){return Object.assign(o2.getDefaults(),{smoothing:.05})}get smoothing(){return this._smoothing}set smoothing(t){this._smoothing=t,this._lowpass.frequency=1/this.toSeconds(this.smoothing)}dispose(){return super.dispose(),this._abs.dispose(),this._lowpass.dispose(),this}}class S4 extends b4{constructor(){super(a1(S4.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"])),this.name="AutoWah";const t=a1(S4.getDefaults(),arguments,["baseFrequency","octaves","sensitivity"]);this._follower=new k4({context:this.context,smoothing:t.follower}),this._sweepRange=new v3({context:this.context,min:0,max:1,exponent:.5}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this._inputBoost=new l2({context:this.context}),this._bandpass=new E3({context:this.context,rolloff:-48,frequency:0,Q:t.Q}),this._peaking=new E3({context:this.context,type:"peaking"}),this._peaking.gain.value=t.gain,this.gain=this._peaking.gain,this.Q=this._bandpass.Q,this.effectSend.chain(this._inputBoost,this._follower,this._sweepRange),this._sweepRange.connect(this._bandpass.frequency),this._sweepRange.connect(this._peaking.frequency),this.effectSend.chain(this._bandpass,this._peaking,this.effectReturn),this._setSweepRange(),this.sensitivity=t.sensitivity,N1(this,["gain","Q"])}static getDefaults(){return Object.assign(b4.getDefaults(),{baseFrequency:100,octaves:6,sensitivity:0,Q:2,gain:2,follower:.2})}get octaves(){return this._octaves}set octaves(t){this._octaves=t,this._setSweepRange()}get follower(){return this._follower.smoothing}set follower(t){this._follower.smoothing=t}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._setSweepRange()}get sensitivity(){return B1(1/this._inputBoost.gain.value)}set sensitivity(t){this._inputBoost.gain.value=1/z1(t)}_setSweepRange(){this._sweepRange.min=this._baseFrequency,this._sweepRange.max=Math.min(this._baseFrequency*Math.pow(2,this._octaves),this.context.sampleRate/2)}dispose(){return super.dispose(),this._follower.dispose(),this._sweepRange.dispose(),this._bandpass.dispose(),this._peaking.dispose(),this._inputBoost.dispose(),this}}const T4="bit-crusher",I4="\n\tclass BitCrusherWorklet extends SingleIOProcessor {\n\n\t\tstatic get parameterDescriptors() {\n\t\t\treturn [{\n\t\t\t\tname: \"bits\",\n\t\t\t\tdefaultValue: 12,\n\t\t\t\tminValue: 1,\n\t\t\t\tmaxValue: 16,\n\t\t\t\tautomationRate: 'k-rate'\n\t\t\t}];\n\t\t}\n\n\t\tgenerate(input, _channel, parameters) {\n\t\t\tconst step = Math.pow(0.5, parameters.bits - 1);\n\t\t\tconst val = step * Math.floor(input / step + 0.5);\n\t\t\treturn val;\n\t\t}\n\t}\n";q3(T4,I4);class C4 extends b4{constructor(){super(a1(C4.getDefaults(),arguments,["bits"])),this.name="BitCrusher";const t=a1(C4.getDefaults(),arguments,["bits"]);this._bitCrusherWorklet=new A4({context:this.context,bits:t.bits}),this.connectEffect(this._bitCrusherWorklet),this.bits=this._bitCrusherWorklet.bits}static getDefaults(){return Object.assign(b4.getDefaults(),{bits:4})}dispose(){return super.dispose(),this._bitCrusherWorklet.dispose(),this}}class A4 extends W3{constructor(){super(a1(A4.getDefaults(),arguments)),this.name="BitCrusherWorklet";const t=a1(A4.getDefaults(),arguments);this.input=new l2({context:this.context}),this.output=new l2({context:this.context}),this.bits=new r2({context:this.context,value:t.bits,units:"positive",minValue:1,maxValue:16,param:this._dummyParam,swappable:!0})}static getDefaults(){return Object.assign(W3.getDefaults(),{bits:12})}_audioWorkletName(){return T4}onReady(t){a2(this.input,t,this.output);const e=t.parameters.get("bits");this.bits.setParam(e)}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.bits.dispose(),this}}class N4 extends b4{constructor(){super(a1(N4.getDefaults(),arguments,["order"])),this.name="Chebyshev";const t=a1(N4.getDefaults(),arguments,["order"]);this._shaper=new H2({context:this.context,length:4096}),this._order=t.order,this.connectEffect(this._shaper),this.order=t.order,this.oversample=t.oversample}static getDefaults(){return Object.assign(b4.getDefaults(),{order:1,oversample:"none"})}_getCoefficient(t,e,n){return n.has(e)||(0===e?n.set(e,0):1===e?n.set(e,t):n.set(e,2*t*this._getCoefficient(t,e-1,n)-this._getCoefficient(t,e-2,n))),n.get(e)}get order(){return this._order}set order(t){this._order=t,this._shaper.setMap((e=>this._getCoefficient(e,t,new Map)))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class E4 extends o2{constructor(){super(a1(E4.getDefaults(),arguments,["channels"])),this.name="Split";const t=a1(E4.getDefaults(),arguments,["channels"]);this._splitter=this.input=this.output=this.context.createChannelSplitter(t.channels),this._internalChannels=[this._splitter]}static getDefaults(){return Object.assign(o2.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._splitter.disconnect(),this}}class O4 extends o2{constructor(){super(a1(O4.getDefaults(),arguments,["channels"])),this.name="Merge";const t=a1(O4.getDefaults(),arguments,["channels"]);this._merger=this.output=this.input=this.context.createChannelMerger(t.channels)}static getDefaults(){return Object.assign(o2.getDefaults(),{channels:2})}dispose(){return super.dispose(),this._merger.disconnect(),this}}class $4 extends o2{constructor(t){super(t),this.name="StereoEffect",this.input=new l2({context:this.context}),this.input.channelCount=2,this.input.channelCountMode="explicit",this._dryWet=this.output=new y4({context:this.context,fade:t.wet}),this.wet=this._dryWet.fade,this._split=new E4({context:this.context,channels:2}),this._merge=new O4({context:this.context,channels:2}),this.input.connect(this._split),this.input.connect(this._dryWet.a),this._merge.connect(this._dryWet.b),N1(this,["wet"])}connectEffectLeft(...t){this._split.connect(t[0],0,0),a2(...t),u2(t[t.length-1],this._merge,0,0)}connectEffectRight(...t){this._split.connect(t[0],1,0),a2(...t),u2(t[t.length-1],this._merge,0,1)}static getDefaults(){return Object.assign(o2.getDefaults(),{wet:1})}dispose(){return super.dispose(),this._dryWet.dispose(),this._split.dispose(),this._merge.dispose(),this}}class R4 extends $4{constructor(t){super(t),this.feedback=new d2({context:this.context,value:t.feedback,units:"normalRange"}),this._feedbackL=new l2({context:this.context}),this._feedbackR=new l2({context:this.context}),this._feedbackSplit=new E4({context:this.context,channels:2}),this._feedbackMerge=new O4({context:this.context,channels:2}),this._merge.connect(this._feedbackSplit),this._feedbackMerge.connect(this._split),this._feedbackSplit.connect(this._feedbackL,0,0),this._feedbackL.connect(this._feedbackMerge,0,0),this._feedbackSplit.connect(this._feedbackR,1,0),this._feedbackR.connect(this._feedbackMerge,0,1),this.feedback.fan(this._feedbackL.gain,this._feedbackR.gain),N1(this,["feedback"])}static getDefaults(){return Object.assign($4.getDefaults(),{feedback:.5})}dispose(){return super.dispose(),this.feedback.dispose(),this._feedbackL.dispose(),this._feedbackR.dispose(),this._feedbackSplit.dispose(),this._feedbackMerge.dispose(),this}}class D4 extends R4{constructor(){super(a1(D4.getDefaults(),arguments,["frequency","delayTime","depth"])),this.name="Chorus";const t=a1(D4.getDefaults(),arguments,["frequency","delayTime","depth"]);this._depth=t.depth,this._delayTime=t.delayTime/1e3,this._lfoL=new o3({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new o3({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._delayNodeL=new v2({context:this.context}),this._delayNodeR=new v2({context:this.context}),this.frequency=this._lfoL.frequency,N1(this,["frequency"]),this._lfoL.frequency.connect(this._lfoR.frequency),this.connectEffectLeft(this._delayNodeL),this.connectEffectRight(this._delayNodeR),this._lfoL.connect(this._delayNodeL.delayTime),this._lfoR.connect(this._delayNodeR.delayTime),this.depth=this._depth,this.type=t.type,this.spread=t.spread}static getDefaults(){return Object.assign(R4.getDefaults(),{frequency:1.5,delayTime:3.5,depth:.7,type:"sine",spread:180,feedback:0,wet:.5})}get depth(){return this._depth}set depth(t){this._depth=t;const e=this._delayTime*t;this._lfoL.min=Math.max(this._delayTime-e,0),this._lfoL.max=this._delayTime+e,this._lfoR.min=Math.max(this._delayTime-e,0),this._lfoR.max=this._delayTime+e}get delayTime(){return 1e3*this._delayTime}set delayTime(t){this._delayTime=t/1e3,this.depth=this._depth}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._delayNodeL.dispose(),this._delayNodeR.dispose(),this.frequency.dispose(),this}}class M4 extends b4{constructor(){super(a1(M4.getDefaults(),arguments,["distortion"])),this.name="Distortion";const t=a1(M4.getDefaults(),arguments,["distortion"]);this._shaper=new H2({context:this.context,length:4096}),this._distortion=t.distortion,this.connectEffect(this._shaper),this.distortion=t.distortion,this.oversample=t.oversample}static getDefaults(){return Object.assign(b4.getDefaults(),{distortion:.4,oversample:"none"})}get distortion(){return this._distortion}set distortion(t){this._distortion=t;const e=100*t,n=Math.PI/180;this._shaper.setMap((t=>Math.abs(t)<.001?0:(3+e)*t*20*n/(Math.PI+e*Math.abs(t))))}get oversample(){return this._shaper.oversample}set oversample(t){this._shaper.oversample=t}dispose(){return super.dispose(),this._shaper.dispose(),this}}class P4 extends b4{constructor(t){super(t),this.name="FeedbackEffect",this._feedbackGain=new l2({context:this.context,gain:t.feedback,units:"normalRange"}),this.feedback=this._feedbackGain.gain,N1(this,"feedback"),this.effectReturn.chain(this._feedbackGain,this.effectSend)}static getDefaults(){return Object.assign(b4.getDefaults(),{feedback:.125})}dispose(){return super.dispose(),this._feedbackGain.dispose(),this.feedback.dispose(),this}}class F4 extends P4{constructor(){super(a1(F4.getDefaults(),arguments,["delayTime","feedback"])),this.name="FeedbackDelay";const t=a1(F4.getDefaults(),arguments,["delayTime","feedback"]);this._delayNode=new v2({context:this.context,delayTime:t.delayTime,maxDelay:t.maxDelay}),this.delayTime=this._delayNode.delayTime,this.connectEffect(this._delayNode),N1(this,"delayTime")}static getDefaults(){return Object.assign(P4.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._delayNode.dispose(),this.delayTime.dispose(),this}}class L4 extends o2{constructor(t){super(t),this.name="PhaseShiftAllpass",this.input=new l2({context:this.context}),this.output=new l2({context:this.context}),this.offset90=new l2({context:this.context});const e=[.6923878,.9360654322959,.988229522686,.9987488452737],n=[.4021921162426,.856171088242,.9722909545651,.9952884791278];this._bank0=this._createAllPassFilterBank(e),this._bank1=this._createAllPassFilterBank(n),this._oneSampleDelay=this.context.createIIRFilter([0,1],[1,0]),a2(this.input,...this._bank0,this._oneSampleDelay,this.output),a2(this.input,...this._bank1,this.offset90)}_createAllPassFilterBank(t){const e=t.map((t=>{const e=[[t*t,0,-1],[1,0,-t*t]];return this.context.createIIRFilter(e[0],e[1])}));return e}dispose(){return super.dispose(),this.input.dispose(),this.output.dispose(),this.offset90.dispose(),this._bank0.forEach((t=>t.disconnect())),this._bank1.forEach((t=>t.disconnect())),this._oneSampleDelay.disconnect(),this}}class z4 extends b4{constructor(){super(a1(z4.getDefaults(),arguments,["frequency"])),this.name="FrequencyShifter";const t=a1(z4.getDefaults(),arguments,["frequency"]);this.frequency=new d2({context:this.context,units:"frequency",value:t.frequency,minValue:-this.context.sampleRate/2,maxValue:this.context.sampleRate/2}),this._sine=new j2({context:this.context,type:"sine"}),this._cosine=new U2({context:this.context,phase:-90,type:"sine"}),this._sineMultiply=new X2({context:this.context}),this._cosineMultiply=new X2({context:this.context}),this._negate=new f3({context:this.context}),this._add=new s3({context:this.context}),this._phaseShifter=new L4({context:this.context}),this.effectSend.connect(this._phaseShifter),this.frequency.fan(this._sine.frequency,this._cosine.frequency),this._phaseShifter.offset90.connect(this._cosineMultiply),this._cosine.connect(this._cosineMultiply.factor),this._phaseShifter.connect(this._sineMultiply),this._sine.connect(this._sineMultiply.factor),this._sineMultiply.connect(this._negate),this._cosineMultiply.connect(this._add),this._negate.connect(this._add.addend),this._add.connect(this.effectReturn);const e=this.immediate();this._sine.start(e),this._cosine.start(e)}static getDefaults(){return Object.assign(b4.getDefaults(),{frequency:0})}dispose(){return super.dispose(),this.frequency.dispose(),this._add.dispose(),this._cosine.dispose(),this._cosineMultiply.dispose(),this._negate.dispose(),this._phaseShifter.dispose(),this._sine.dispose(),this._sineMultiply.dispose(),this}}const B4=[1557/44100,1617/44100,1491/44100,1422/44100,1277/44100,1356/44100,1188/44100,1116/44100],q4=[225,556,441,341];class V4 extends $4{constructor(){super(a1(V4.getDefaults(),arguments,["roomSize","dampening"])),this.name="Freeverb",this._combFilters=[],this._allpassFiltersL=[],this._allpassFiltersR=[];const t=a1(V4.getDefaults(),arguments,["roomSize","dampening"]);this.roomSize=new d2({context:this.context,value:t.roomSize,units:"normalRange"}),this._allpassFiltersL=q4.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._allpassFiltersR=q4.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._combFilters=B4.map(((e,n)=>{const s=new Y3({context:this.context,dampening:t.dampening,delayTime:e});return n<B4.length/2?this.connectEffectLeft(s,...this._allpassFiltersL):this.connectEffectRight(s,...this._allpassFiltersR),this.roomSize.connect(s.resonance),s})),N1(this,["roomSize"])}static getDefaults(){return Object.assign($4.getDefaults(),{roomSize:.7,dampening:3e3})}get dampening(){return this._combFilters[0].dampening}set dampening(t){this._combFilters.forEach((e=>e.dampening=t))}dispose(){return super.dispose(),this._allpassFiltersL.forEach((t=>t.disconnect())),this._allpassFiltersR.forEach((t=>t.disconnect())),this._combFilters.forEach((t=>t.dispose())),this.roomSize.dispose(),this}}const W4=[.06748,.06404,.08212,.09004],j4=[.773,.802,.753,.733],U4=[347,113,37];class G4 extends $4{constructor(){super(a1(G4.getDefaults(),arguments,["roomSize"])),this.name="JCReverb",this._allpassFilters=[],this._feedbackCombFilters=[];const t=a1(G4.getDefaults(),arguments,["roomSize"]);this.roomSize=new d2({context:this.context,value:t.roomSize,units:"normalRange"}),this._scaleRoomSize=new i3({context:this.context,min:-.733,max:.197}),this._allpassFilters=U4.map((t=>{const e=this.context.createBiquadFilter();return e.type="allpass",e.frequency.value=t,e})),this._feedbackCombFilters=W4.map(((t,e)=>{const n=new X3({context:this.context,delayTime:t});return this._scaleRoomSize.connect(n.resonance),n.resonance.value=j4[e],e<W4.length/2?this.connectEffectLeft(...this._allpassFilters,n):this.connectEffectRight(...this._allpassFilters,n),n})),this.roomSize.connect(this._scaleRoomSize),N1(this,["roomSize"])}static getDefaults(){return Object.assign($4.getDefaults(),{roomSize:.5})}dispose(){return super.dispose(),this._allpassFilters.forEach((t=>t.disconnect())),this._feedbackCombFilters.forEach((t=>t.dispose())),this.roomSize.dispose(),this._scaleRoomSize.dispose(),this}}class H4 extends R4{constructor(t){super(t),this._feedbackL.disconnect(),this._feedbackL.connect(this._feedbackMerge,0,1),this._feedbackR.disconnect(),this._feedbackR.connect(this._feedbackMerge,0,0),N1(this,["feedback"])}}class K4 extends H4{constructor(){super(a1(K4.getDefaults(),arguments,["delayTime","feedback"])),this.name="PingPongDelay";const t=a1(K4.getDefaults(),arguments,["delayTime","feedback"]);this._leftDelay=new v2({context:this.context,maxDelay:t.maxDelay}),this._rightDelay=new v2({context:this.context,maxDelay:t.maxDelay}),this._rightPreDelay=new v2({context:this.context,maxDelay:t.maxDelay}),this.delayTime=new d2({context:this.context,units:"time",value:t.delayTime}),this.connectEffectLeft(this._leftDelay),this.connectEffectRight(this._rightPreDelay,this._rightDelay),this.delayTime.fan(this._leftDelay.delayTime,this._rightDelay.delayTime,this._rightPreDelay.delayTime),this._feedbackL.disconnect(),this._feedbackL.connect(this._rightDelay),N1(this,["delayTime"])}static getDefaults(){return Object.assign(H4.getDefaults(),{delayTime:.25,maxDelay:1})}dispose(){return super.dispose(),this._leftDelay.dispose(),this._rightDelay.dispose(),this._rightPreDelay.dispose(),this.delayTime.dispose(),this}}class X4 extends P4{constructor(){super(a1(X4.getDefaults(),arguments,["pitch"])),this.name="PitchShift";const t=a1(X4.getDefaults(),arguments,["pitch"]);this._frequency=new d2({context:this.context}),this._delayA=new v2({maxDelay:1,context:this.context}),this._lfoA=new o3({context:this.context,min:0,max:.1,type:"sawtooth"}).connect(this._delayA.delayTime),this._delayB=new v2({maxDelay:1,context:this.context}),this._lfoB=new o3({context:this.context,min:0,max:.1,type:"sawtooth",phase:180}).connect(this._delayB.delayTime),this._crossFade=new y4({context:this.context}),this._crossFadeLFO=new o3({context:this.context,min:0,max:1,type:"triangle",phase:90}).connect(this._crossFade.fade),this._feedbackDelay=new v2({delayTime:t.delayTime,context:this.context}),this.delayTime=this._feedbackDelay.delayTime,N1(this,"delayTime"),this._pitch=t.pitch,this._windowSize=t.windowSize,this._delayA.connect(this._crossFade.a),this._delayB.connect(this._crossFade.b),this._frequency.fan(this._lfoA.frequency,this._lfoB.frequency,this._crossFadeLFO.frequency),this.effectSend.fan(this._delayA,this._delayB),this._crossFade.chain(this._feedbackDelay,this.effectReturn);const e=this.now();this._lfoA.start(e),this._lfoB.start(e),this._crossFadeLFO.start(e),this.windowSize=this._windowSize}static getDefaults(){return Object.assign(P4.getDefaults(),{pitch:0,windowSize:.1,delayTime:0,feedback:0})}get pitch(){return this._pitch}set pitch(t){this._pitch=t;let e=0;t<0?(this._lfoA.min=0,this._lfoA.max=this._windowSize,this._lfoB.min=0,this._lfoB.max=this._windowSize,e=q1(t-1)+1):(this._lfoA.min=this._windowSize,this._lfoA.max=0,this._lfoB.min=this._windowSize,this._lfoB.max=0,e=q1(t)-1),this._frequency.value=e*(1.2/this._windowSize)}get windowSize(){return this._windowSize}set windowSize(t){this._windowSize=this.toSeconds(t),this.pitch=this._pitch}dispose(){return super.dispose(),this._frequency.dispose(),this._delayA.dispose(),this._delayB.dispose(),this._lfoA.dispose(),this._lfoB.dispose(),this._crossFade.dispose(),this._crossFadeLFO.dispose(),this._feedbackDelay.dispose(),this}}class Q4 extends $4{constructor(){super(a1(Q4.getDefaults(),arguments,["frequency","octaves","baseFrequency"])),this.name="Phaser";const t=a1(Q4.getDefaults(),arguments,["frequency","octaves","baseFrequency"]);this._lfoL=new o3({context:this.context,frequency:t.frequency,min:0,max:1}),this._lfoR=new o3({context:this.context,frequency:t.frequency,min:0,max:1,phase:180}),this._baseFrequency=this.toFrequency(t.baseFrequency),this._octaves=t.octaves,this.Q=new d2({context:this.context,value:t.Q,units:"positive"}),this._filtersL=this._makeFilters(t.stages,this._lfoL),this._filtersR=this._makeFilters(t.stages,this._lfoR),this.frequency=this._lfoL.frequency,this.frequency.value=t.frequency,this.connectEffectLeft(...this._filtersL),this.connectEffectRight(...this._filtersR),this._lfoL.frequency.connect(this._lfoR.frequency),this.baseFrequency=t.baseFrequency,this.octaves=t.octaves,this._lfoL.start(),this._lfoR.start(),N1(this,["frequency","Q"])}static getDefaults(){return Object.assign($4.getDefaults(),{frequency:.5,octaves:3,stages:10,Q:10,baseFrequency:350})}_makeFilters(t,e){const n=[];for(let s=0;s<t;s++){const t=this.context.createBiquadFilter();t.type="allpass",this.Q.connect(t.Q),e.connect(t.frequency),n.push(t)}return n}get octaves(){return this._octaves}set octaves(t){this._octaves=t;const e=this._baseFrequency*Math.pow(2,t);this._lfoL.max=e,this._lfoR.max=e}get baseFrequency(){return this._baseFrequency}set baseFrequency(t){this._baseFrequency=this.toFrequency(t),this._lfoL.min=this._baseFrequency,this._lfoR.min=this._baseFrequency,this.octaves=this._octaves}dispose(){return super.dispose(),this.Q.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._filtersL.forEach((t=>t.disconnect())),this._filtersR.forEach((t=>t.disconnect())),this.frequency.dispose(),this}}class Y4 extends b4{constructor(){super(a1(Y4.getDefaults(),arguments,["decay"])),this.name="Reverb",this._convolver=this.context.createConvolver(),this.ready=Promise.resolve();const t=a1(Y4.getDefaults(),arguments,["decay"]);this._decay=t.decay,this._preDelay=t.preDelay,this.generate(),this.connectEffect(this._convolver)}static getDefaults(){return Object.assign(b4.getDefaults(),{decay:1.5,preDelay:.01})}get decay(){return this._decay}set decay(t){t=this.toSeconds(t),E0(t,.001),this._decay=t,this.generate()}get preDelay(){return this._preDelay}set preDelay(t){t=this.toSeconds(t),E0(t,0),this._preDelay=t,this.generate()}generate(){return Y0(this,void 0,void 0,(function*(){const t=this.ready,e=new R1(2,this._decay+this._preDelay,this.context.sampleRate),n=new F2({context:e}),s=new F2({context:e}),i=new O4({context:e});n.connect(i,0,0),s.connect(i,0,1);const r=new l2({context:e}).toDestination();i.connect(r),n.start(0),s.start(0),r.gain.setValueAtTime(0,0),r.gain.setValueAtTime(1,this._preDelay),r.gain.exponentialApproachValueAtTime(0,this._preDelay,this.decay);const o=e.render();return this.ready=o.then(O1),yield t,this._convolver.buffer=(yield o).get(),this}))}dispose(){return super.dispose(),this._convolver.disconnect(),this}}class Z4 extends o2{constructor(){super(a1(Z4.getDefaults(),arguments)),this.name="MidSideSplit",this._split=this.input=new E4({channels:2,context:this.context}),this._midAdd=new s3({context:this.context}),this.mid=new X2({context:this.context,value:Math.SQRT1_2}),this._sideSubtract=new m3({context:this.context}),this.side=new X2({context:this.context,value:Math.SQRT1_2}),this._split.connect(this._midAdd,0),this._split.connect(this._midAdd.addend,1),this._split.connect(this._sideSubtract,0),this._split.connect(this._sideSubtract.subtrahend,1),this._midAdd.connect(this.mid),this._sideSubtract.connect(this.side)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midAdd.dispose(),this._sideSubtract.dispose(),this._split.dispose(),this}}class J4 extends o2{constructor(){super(a1(J4.getDefaults(),arguments)),this.name="MidSideMerge",this.mid=new l2({context:this.context}),this.side=new l2({context:this.context}),this._left=new s3({context:this.context}),this._leftMult=new X2({context:this.context,value:Math.SQRT1_2}),this._right=new m3({context:this.context}),this._rightMult=new X2({context:this.context,value:Math.SQRT1_2}),this._merge=this.output=new O4({context:this.context}),this.mid.fan(this._left),this.side.connect(this._left.addend),this.mid.connect(this._right),this.side.connect(this._right.subtrahend),this._left.connect(this._leftMult),this._right.connect(this._rightMult),this._leftMult.connect(this._merge,0,0),this._rightMult.connect(this._merge,0,1)}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._leftMult.dispose(),this._rightMult.dispose(),this._left.dispose(),this._right.dispose(),this}}class t5 extends b4{constructor(t){super(t),this.name="MidSideEffect",this._midSideMerge=new J4({context:this.context}),this._midSideSplit=new Z4({context:this.context}),this._midSend=this._midSideSplit.mid,this._sideSend=this._midSideSplit.side,this._midReturn=this._midSideMerge.mid,this._sideReturn=this._midSideMerge.side,this.effectSend.connect(this._midSideSplit),this._midSideMerge.connect(this.effectReturn)}connectEffectMid(...t){this._midSend.chain(...t,this._midReturn)}connectEffectSide(...t){this._sideSend.chain(...t,this._sideReturn)}dispose(){return super.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this._midSend.dispose(),this._sideSend.dispose(),this._midReturn.dispose(),this._sideReturn.dispose(),this}}class e5 extends t5{constructor(){super(a1(e5.getDefaults(),arguments,["width"])),this.name="StereoWidener";const t=a1(e5.getDefaults(),arguments,["width"]);this.width=new d2({context:this.context,value:t.width,units:"normalRange"}),N1(this,["width"]),this._twoTimesWidthMid=new X2({context:this.context,value:2}),this._twoTimesWidthSide=new X2({context:this.context,value:2}),this._midMult=new X2({context:this.context}),this._twoTimesWidthMid.connect(this._midMult.factor),this.connectEffectMid(this._midMult),this._oneMinusWidth=new m3({context:this.context}),this._oneMinusWidth.connect(this._twoTimesWidthMid),u2(this.context.getConstant(1),this._oneMinusWidth),this.width.connect(this._oneMinusWidth.subtrahend),this._sideMult=new X2({context:this.context}),this.width.connect(this._twoTimesWidthSide),this._twoTimesWidthSide.connect(this._sideMult.factor),this.connectEffectSide(this._sideMult)}static getDefaults(){return Object.assign(t5.getDefaults(),{width:.5})}dispose(){return super.dispose(),this.width.dispose(),this._midMult.dispose(),this._sideMult.dispose(),this._twoTimesWidthMid.dispose(),this._twoTimesWidthSide.dispose(),this._oneMinusWidth.dispose(),this}}class n5 extends $4{constructor(){super(a1(n5.getDefaults(),arguments,["frequency","depth"])),this.name="Tremolo";const t=a1(n5.getDefaults(),arguments,["frequency","depth"]);this._lfoL=new o3({context:this.context,type:t.type,min:1,max:0}),this._lfoR=new o3({context:this.context,type:t.type,min:1,max:0}),this._amplitudeL=new l2({context:this.context}),this._amplitudeR=new l2({context:this.context}),this.frequency=new d2({context:this.context,value:t.frequency,units:"frequency"}),this.depth=new d2({context:this.context,value:t.depth,units:"normalRange"}),N1(this,["frequency","depth"]),this.connectEffectLeft(this._amplitudeL),this.connectEffectRight(this._amplitudeR),this._lfoL.connect(this._amplitudeL.gain),this._lfoR.connect(this._amplitudeR.gain),this.frequency.fan(this._lfoL.frequency,this._lfoR.frequency),this.depth.fan(this._lfoR.amplitude,this._lfoL.amplitude),this.spread=t.spread}static getDefaults(){return Object.assign($4.getDefaults(),{frequency:10,type:"sine",depth:.5,spread:180})}start(t){return this._lfoL.start(t),this._lfoR.start(t),this}stop(t){return this._lfoL.stop(t),this._lfoR.stop(t),this}sync(){return this._lfoL.sync(),this._lfoR.sync(),this.context.transport.syncSignal(this.frequency),this}unsync(){return this._lfoL.unsync(),this._lfoR.unsync(),this.context.transport.unsyncSignal(this.frequency),this}get type(){return this._lfoL.type}set type(t){this._lfoL.type=t,this._lfoR.type=t}get spread(){return this._lfoR.phase-this._lfoL.phase}set spread(t){this._lfoL.phase=90-t/2,this._lfoR.phase=t/2+90}dispose(){return super.dispose(),this._lfoL.dispose(),this._lfoR.dispose(),this._amplitudeL.dispose(),this._amplitudeR.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class s5 extends b4{constructor(){super(a1(s5.getDefaults(),arguments,["frequency","depth"])),this.name="Vibrato";const t=a1(s5.getDefaults(),arguments,["frequency","depth"]);this._delayNode=new v2({context:this.context,delayTime:0,maxDelay:t.maxDelay}),this._lfo=new o3({context:this.context,type:t.type,min:0,max:t.maxDelay,frequency:t.frequency,phase:-90}).start().connect(this._delayNode.delayTime),this.frequency=this._lfo.frequency,this.depth=this._lfo.amplitude,this.depth.value=t.depth,N1(this,["frequency","depth"]),this.effectSend.chain(this._delayNode,this.effectReturn)}static getDefaults(){return Object.assign(b4.getDefaults(),{maxDelay:.005,frequency:5,depth:.1,type:"sine"})}get type(){return this._lfo.type}set type(t){this._lfo.type=t}dispose(){return super.dispose(),this._delayNode.dispose(),this._lfo.dispose(),this.frequency.dispose(),this.depth.dispose(),this}}class i5 extends o2{constructor(){super(a1(i5.getDefaults(),arguments,["type","size"])),this.name="Analyser",this._analysers=[],this._buffers=[];const t=a1(i5.getDefaults(),arguments,["type","size"]);this.input=this.output=this._gain=new l2({context:this.context}),this._split=new E4({context:this.context,channels:t.channels}),this.input.connect(this._split),E0(t.channels,1);for(let e=0;e<t.channels;e++)this._analysers[e]=this.context.createAnalyser(),this._split.connect(this._analysers[e],e,0);this.size=t.size,this.type=t.type}static getDefaults(){return Object.assign(o2.getDefaults(),{size:1024,smoothing:.8,type:"fft",channels:1})}getValue(){return this._analysers.forEach(((t,e)=>{const n=this._buffers[e];"fft"===this._type?t.getFloatFrequencyData(n):"waveform"===this._type&&t.getFloatTimeDomainData(n)})),1===this.channels?this._buffers[0]:this._buffers}get size(){return this._analysers[0].frequencyBinCount}set size(t){this._analysers.forEach(((e,n)=>{e.fftSize=2*t,this._buffers[n]=new Float32Array(t)}))}get channels(){return this._analysers.length}get type(){return this._type}set type(t){N0("waveform"===t||"fft"===t,`Analyser: invalid type: ${t}`),this._type=t}get smoothing(){return this._analysers[0].smoothingTimeConstant}set smoothing(t){this._analysers.forEach((e=>e.smoothingTimeConstant=t))}dispose(){return super.dispose(),this._analysers.forEach((t=>t.disconnect())),this._split.dispose(),this._gain.dispose(),this}}class r5 extends o2{constructor(){super(a1(r5.getDefaults(),arguments)),this.name="MeterBase",this.input=this.output=this._analyser=new i5({context:this.context,size:256,type:"waveform"})}dispose(){return super.dispose(),this._analyser.dispose(),this}}class o5 extends r5{constructor(){super(a1(o5.getDefaults(),arguments,["smoothing"])),this.name="Meter",this._rms=0;const t=a1(o5.getDefaults(),arguments,["smoothing"]);this.input=this.output=this._analyser=new i5({context:this.context,size:256,type:"waveform",channels:t.channels}),this.smoothing=t.smoothing,this.normalRange=t.normalRange}static getDefaults(){return Object.assign(r5.getDefaults(),{smoothing:.8,normalRange:!1,channels:1})}getLevel(){return M0("'getLevel' has been changed to 'getValue'"),this.getValue()}getValue(){const t=this._analyser.getValue(),e=1===this.channels?[t]:t,n=e.map((t=>{const e=t.reduce(((t,e)=>t+e*e),0),n=Math.sqrt(e/t.length);return this._rms=Math.max(n,this._rms*this.smoothing),this.normalRange?this._rms:B1(this._rms)}));return 1===this.channels?n[0]:n}get channels(){return this._analyser.channels}dispose(){return super.dispose(),this._analyser.dispose(),this}}class a5 extends r5{constructor(){super(a1(a5.getDefaults(),arguments,["size"])),this.name="FFT";const t=a1(a5.getDefaults(),arguments,["size"]);this.normalRange=t.normalRange,this._analyser.type="fft",this.size=t.size}static getDefaults(){return Object.assign(o2.getDefaults(),{normalRange:!1,size:1024,smoothing:.8})}getValue(){const t=this._analyser.getValue();return t.map((t=>this.normalRange?z1(t):t))}get size(){return this._analyser.size}set size(t){this._analyser.size=t}get smoothing(){return this._analyser.smoothing}set smoothing(t){this._analyser.smoothing=t}getFrequencyOfIndex(t){return N0(0<=t&&t<this.size,`index must be greater than or equal to 0 and less than ${this.size}`),t*this.context.sampleRate/(2*this.size)}}class u5 extends r5{constructor(){super(a1(u5.getDefaults(),arguments)),this.name="DCMeter",this._analyser.type="waveform",this._analyser.size=256}getValue(){const t=this._analyser.getValue();return t[0]}}class c5 extends r5{constructor(){super(a1(c5.getDefaults(),arguments,["size"])),this.name="Waveform";const t=a1(c5.getDefaults(),arguments,["size"]);this._analyser.type="waveform",this.size=t.size}static getDefaults(){return Object.assign(r5.getDefaults(),{size:1024})}getValue(){return this._analyser.getValue()}get size(){return this._analyser.size}set size(t){this._analyser.size=t}}class l5 extends o2{constructor(){super(a1(l5.getDefaults(),arguments,["solo"])),this.name="Solo";const t=a1(l5.getDefaults(),arguments,["solo"]);this.input=this.output=new l2({context:this.context}),l5._allSolos.has(this.context)||l5._allSolos.set(this.context,new Set),l5._allSolos.get(this.context).add(this),this.solo=t.solo}static getDefaults(){return Object.assign(o2.getDefaults(),{solo:!1})}get solo(){return this._isSoloed()}set solo(t){t?this._addSolo():this._removeSolo(),l5._allSolos.get(this.context).forEach((t=>t._updateSolo()))}get muted(){return 0===this.input.gain.value}_addSolo(){l5._soloed.has(this.context)||l5._soloed.set(this.context,new Set),l5._soloed.get(this.context).add(this)}_removeSolo(){l5._soloed.has(this.context)&&l5._soloed.get(this.context).delete(this)}_isSoloed(){return l5._soloed.has(this.context)&&l5._soloed.get(this.context).has(this)}_noSolos(){return!l5._soloed.has(this.context)||l5._soloed.has(this.context)&&0===l5._soloed.get(this.context).size}_updateSolo(){this._isSoloed()||this._noSolos()?this.input.gain.value=1:this.input.gain.value=0}dispose(){return super.dispose(),l5._allSolos.get(this.context).delete(this),this._removeSolo(),this}}l5._allSolos=new Map,l5._soloed=new Map;class h5 extends o2{constructor(){super(a1(h5.getDefaults(),arguments,["pan","volume"])),this.name="PanVol";const t=a1(h5.getDefaults(),arguments,["pan","volume"]);this._panner=this.input=new x4({context:this.context,pan:t.pan,channelCount:t.channelCount}),this.pan=this._panner.pan,this._volume=this.output=new N2({context:this.context,volume:t.volume}),this.volume=this._volume.volume,this._panner.connect(this._volume),this.mute=t.mute,N1(this,["pan","volume"])}static getDefaults(){return Object.assign(o2.getDefaults(),{mute:!1,pan:0,volume:0,channelCount:1})}get mute(){return this._volume.mute}set mute(t){this._volume.mute=t}dispose(){return super.dispose(),this._panner.dispose(),this.pan.dispose(),this._volume.dispose(),this.volume.dispose(),this}}class p5 extends o2{constructor(){super(a1(p5.getDefaults(),arguments,["volume","pan"])),this.name="Channel";const t=a1(p5.getDefaults(),arguments,["volume","pan"]);this._solo=this.input=new l5({solo:t.solo,context:this.context}),this._panVol=this.output=new h5({context:this.context,pan:t.pan,volume:t.volume,mute:t.mute,channelCount:t.channelCount}),this.pan=this._panVol.pan,this.volume=this._panVol.volume,this._solo.connect(this._panVol),N1(this,["pan","volume"])}static getDefaults(){return Object.assign(o2.getDefaults(),{pan:0,volume:0,mute:!1,solo:!1,channelCount:1})}get solo(){return this._solo.solo}set solo(t){this._solo.solo=t}get muted(){return this._solo.muted||this.mute}get mute(){return this._panVol.mute}set mute(t){this._panVol.mute=t}_getBus(t){return p5.buses.has(t)||p5.buses.set(t,new l2({context:this.context})),p5.buses.get(t)}send(t,e=0){const n=this._getBus(t),s=new l2({context:this.context,units:"decibels",gain:e});return this.connect(s),s.connect(n),s}receive(t){const e=this._getBus(t);return e.connect(this),this}dispose(){return super.dispose(),this._panVol.dispose(),this.pan.dispose(),this.volume.dispose(),this._solo.dispose(),this}}p5.buses=new Map;class d5 extends o2{constructor(){super(a1(d5.getDefaults(),arguments)),this.name="Mono",this.input=new l2({context:this.context}),this._merge=this.output=new O4({channels:2,context:this.context}),this.input.connect(this._merge,0,0),this.input.connect(this._merge,0,1)}dispose(){return super.dispose(),this._merge.dispose(),this.input.dispose(),this}}class f5 extends o2{constructor(){super(a1(f5.getDefaults(),arguments,["lowFrequency","highFrequency"])),this.name="MultibandSplit",this.input=new l2({context:this.context}),this.output=void 0,this.low=new E3({context:this.context,frequency:0,type:"lowpass"}),this._lowMidFilter=new E3({context:this.context,frequency:0,type:"highpass"}),this.mid=new E3({context:this.context,frequency:0,type:"lowpass"}),this.high=new E3({context:this.context,frequency:0,type:"highpass"}),this._internalChannels=[this.low,this.mid,this.high];const t=a1(f5.getDefaults(),arguments,["lowFrequency","highFrequency"]);this.lowFrequency=new d2({context:this.context,units:"frequency",value:t.lowFrequency}),this.highFrequency=new d2({context:this.context,units:"frequency",value:t.highFrequency}),this.Q=new d2({context:this.context,units:"positive",value:t.Q}),this.input.fan(this.low,this.high),this.input.chain(this._lowMidFilter,this.mid),this.lowFrequency.fan(this.low.frequency,this._lowMidFilter.frequency),this.highFrequency.fan(this.mid.frequency,this.high.frequency),this.Q.connect(this.low.Q),this.Q.connect(this._lowMidFilter.Q),this.Q.connect(this.mid.Q),this.Q.connect(this.high.Q),N1(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(o2.getDefaults(),{Q:1,highFrequency:2500,lowFrequency:400})}dispose(){return super.dispose(),E1(this,["high","mid","low","highFrequency","lowFrequency"]),this.low.dispose(),this._lowMidFilter.dispose(),this.mid.dispose(),this.high.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this.Q.dispose(),this}}class m5 extends o2{constructor(){super(...arguments),this.name="Listener",this.positionX=new r2({context:this.context,param:this.context.rawContext.listener.positionX}),this.positionY=new r2({context:this.context,param:this.context.rawContext.listener.positionY}),this.positionZ=new r2({context:this.context,param:this.context.rawContext.listener.positionZ}),this.forwardX=new r2({context:this.context,param:this.context.rawContext.listener.forwardX}),this.forwardY=new r2({context:this.context,param:this.context.rawContext.listener.forwardY}),this.forwardZ=new r2({context:this.context,param:this.context.rawContext.listener.forwardZ}),this.upX=new r2({context:this.context,param:this.context.rawContext.listener.upX}),this.upY=new r2({context:this.context,param:this.context.rawContext.listener.upY}),this.upZ=new r2({context:this.context,param:this.context.rawContext.listener.upZ})}static getDefaults(){return Object.assign(o2.getDefaults(),{positionX:0,positionY:0,positionZ:0,forwardX:0,forwardY:0,forwardZ:-1,upX:0,upY:1,upZ:0})}dispose(){return super.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this.forwardX.dispose(),this.forwardY.dispose(),this.forwardZ.dispose(),this.upX.dispose(),this.upY.dispose(),this.upZ.dispose(),this}}w1((t=>{t.listener=new m5({context:t})})),k1((t=>{t.listener.dispose()}));class g5 extends o2{constructor(){super(a1(g5.getDefaults(),arguments,["positionX","positionY","positionZ"])),this.name="Panner3D";const t=a1(g5.getDefaults(),arguments,["positionX","positionY","positionZ"]);this._panner=this.input=this.output=this.context.createPanner(),this.panningModel=t.panningModel,this.maxDistance=t.maxDistance,this.distanceModel=t.distanceModel,this.coneOuterGain=t.coneOuterGain,this.coneOuterAngle=t.coneOuterAngle,this.coneInnerAngle=t.coneInnerAngle,this.refDistance=t.refDistance,this.rolloffFactor=t.rolloffFactor,this.positionX=new r2({context:this.context,param:this._panner.positionX,value:t.positionX}),this.positionY=new r2({context:this.context,param:this._panner.positionY,value:t.positionY}),this.positionZ=new r2({context:this.context,param:this._panner.positionZ,value:t.positionZ}),this.orientationX=new r2({context:this.context,param:this._panner.orientationX,value:t.orientationX}),this.orientationY=new r2({context:this.context,param:this._panner.orientationY,value:t.orientationY}),this.orientationZ=new r2({context:this.context,param:this._panner.orientationZ,value:t.orientationZ})}static getDefaults(){return Object.assign(o2.getDefaults(),{coneInnerAngle:360,coneOuterAngle:360,coneOuterGain:0,distanceModel:"inverse",maxDistance:1e4,orientationX:0,orientationY:0,orientationZ:0,panningModel:"equalpower",positionX:0,positionY:0,positionZ:0,refDistance:1,rolloffFactor:1})}setPosition(t,e,n){return this.positionX.value=t,this.positionY.value=e,this.positionZ.value=n,this}setOrientation(t,e,n){return this.orientationX.value=t,this.orientationY.value=e,this.orientationZ.value=n,this}get panningModel(){return this._panner.panningModel}set panningModel(t){this._panner.panningModel=t}get refDistance(){return this._panner.refDistance}set refDistance(t){this._panner.refDistance=t}get rolloffFactor(){return this._panner.rolloffFactor}set rolloffFactor(t){this._panner.rolloffFactor=t}get distanceModel(){return this._panner.distanceModel}set distanceModel(t){this._panner.distanceModel=t}get coneInnerAngle(){return this._panner.coneInnerAngle}set coneInnerAngle(t){this._panner.coneInnerAngle=t}get coneOuterAngle(){return this._panner.coneOuterAngle}set coneOuterAngle(t){this._panner.coneOuterAngle=t}get coneOuterGain(){return this._panner.coneOuterGain}set coneOuterGain(t){this._panner.coneOuterGain=t}get maxDistance(){return this._panner.maxDistance}set maxDistance(t){this._panner.maxDistance=t}dispose(){return super.dispose(),this._panner.disconnect(),this.orientationX.dispose(),this.orientationY.dispose(),this.orientationZ.dispose(),this.positionX.dispose(),this.positionY.dispose(),this.positionZ.dispose(),this}}class y5 extends o2{constructor(){super(a1(y5.getDefaults(),arguments)),this.name="Recorder";const t=a1(y5.getDefaults(),arguments);this.input=new l2({context:this.context}),N0(y5.supported,"Media Recorder API is not available"),this._stream=this.context.createMediaStreamDestination(),this.input.connect(this._stream),this._recorder=new MediaRecorder(this._stream.stream,{mimeType:t.mimeType})}static getDefaults(){return o2.getDefaults()}get mimeType(){return this._recorder.mimeType}static get supported(){return null!==H0&&Reflect.has(H0,"MediaRecorder")}get state(){return"inactive"===this._recorder.state?"stopped":"paused"===this._recorder.state?"paused":"started"}start(){return Y0(this,void 0,void 0,(function*(){N0("started"!==this.state,"Recorder is already started");const t=new Promise((t=>{const e=()=>{this._recorder.removeEventListener("start",e,!1),t()};this._recorder.addEventListener("start",e,!1)}));return this._recorder.start(),yield t}))}stop(){return Y0(this,void 0,void 0,(function*(){N0("stopped"!==this.state,"Recorder is not started");const t=new Promise((t=>{const e=n=>{this._recorder.removeEventListener("dataavailable",e,!1),t(n.data)};this._recorder.addEventListener("dataavailable",e,!1)}));return this._recorder.stop(),yield t}))}pause(){return N0("started"===this.state,"Recorder must be started"),this._recorder.pause(),this}dispose(){return super.dispose(),this.input.dispose(),this._stream.disconnect(),this}}class b5 extends o2{constructor(){super(a1(b5.getDefaults(),arguments,["threshold","ratio"])),this.name="Compressor",this._compressor=this.context.createDynamicsCompressor(),this.input=this._compressor,this.output=this._compressor;const t=a1(b5.getDefaults(),arguments,["threshold","ratio"]);this.threshold=new r2({minValue:this._compressor.threshold.minValue,maxValue:this._compressor.threshold.maxValue,context:this.context,convert:!1,param:this._compressor.threshold,units:"decibels",value:t.threshold}),this.attack=new r2({minValue:this._compressor.attack.minValue,maxValue:this._compressor.attack.maxValue,context:this.context,param:this._compressor.attack,units:"time",value:t.attack}),this.release=new r2({minValue:this._compressor.release.minValue,maxValue:this._compressor.release.maxValue,context:this.context,param:this._compressor.release,units:"time",value:t.release}),this.knee=new r2({minValue:this._compressor.knee.minValue,maxValue:this._compressor.knee.maxValue,context:this.context,convert:!1,param:this._compressor.knee,units:"decibels",value:t.knee}),this.ratio=new r2({minValue:this._compressor.ratio.minValue,maxValue:this._compressor.ratio.maxValue,context:this.context,convert:!1,param:this._compressor.ratio,units:"positive",value:t.ratio}),N1(this,["knee","release","attack","ratio","threshold"])}static getDefaults(){return Object.assign(o2.getDefaults(),{attack:.003,knee:30,ratio:12,release:.25,threshold:-24})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.disconnect(),this.attack.dispose(),this.release.dispose(),this.threshold.dispose(),this.ratio.dispose(),this.knee.dispose(),this}}class v5 extends o2{constructor(){super(Object.assign(a1(v5.getDefaults(),arguments,["threshold","smoothing"]))),this.name="Gate";const t=a1(v5.getDefaults(),arguments,["threshold","smoothing"]);this._follower=new k4({context:this.context,smoothing:t.smoothing}),this._gt=new y3({context:this.context,value:z1(t.threshold)}),this.input=new l2({context:this.context}),this._gate=this.output=new l2({context:this.context}),this.input.connect(this._gate),this.input.chain(this._follower,this._gt,this._gate.gain)}static getDefaults(){return Object.assign(o2.getDefaults(),{smoothing:.1,threshold:-40})}get threshold(){return B1(this._gt.value)}set threshold(t){this._gt.value=z1(t)}get smoothing(){return this._follower.smoothing}set smoothing(t){this._follower.smoothing=t}dispose(){return super.dispose(),this.input.dispose(),this._follower.dispose(),this._gt.dispose(),this._gate.dispose(),this}}class w5 extends o2{constructor(){super(Object.assign(a1(w5.getDefaults(),arguments,["threshold"]))),this.name="Limiter";const t=a1(w5.getDefaults(),arguments,["threshold"]);this._compressor=this.input=this.output=new b5({context:this.context,ratio:20,attack:.003,release:.01,threshold:t.threshold}),this.threshold=this._compressor.threshold,N1(this,"threshold")}static getDefaults(){return Object.assign(o2.getDefaults(),{threshold:-12})}get reduction(){return this._compressor.reduction}dispose(){return super.dispose(),this._compressor.dispose(),this.threshold.dispose(),this}}class x5 extends o2{constructor(){super(Object.assign(a1(x5.getDefaults(),arguments))),this.name="MidSideCompressor";const t=a1(x5.getDefaults(),arguments);this._midSideSplit=this.input=new Z4({context:this.context}),this._midSideMerge=this.output=new J4({context:this.context}),this.mid=new b5(Object.assign(t.mid,{context:this.context})),this.side=new b5(Object.assign(t.side,{context:this.context})),this._midSideSplit.mid.chain(this.mid,this._midSideMerge.mid),this._midSideSplit.side.chain(this.side,this._midSideMerge.side),N1(this,["mid","side"])}static getDefaults(){return Object.assign(o2.getDefaults(),{mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},side:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10}})}dispose(){return super.dispose(),this.mid.dispose(),this.side.dispose(),this._midSideSplit.dispose(),this._midSideMerge.dispose(),this}}class _5 extends o2{constructor(){super(Object.assign(a1(_5.getDefaults(),arguments))),this.name="MultibandCompressor";const t=a1(_5.getDefaults(),arguments);this._splitter=this.input=new f5({context:this.context,lowFrequency:t.lowFrequency,highFrequency:t.highFrequency}),this.lowFrequency=this._splitter.lowFrequency,this.highFrequency=this._splitter.highFrequency,this.output=new l2({context:this.context}),this.low=new b5(Object.assign(t.low,{context:this.context})),this.mid=new b5(Object.assign(t.mid,{context:this.context})),this.high=new b5(Object.assign(t.high,{context:this.context})),this._splitter.low.chain(this.low,this.output),this._splitter.mid.chain(this.mid,this.output),this._splitter.high.chain(this.high,this.output),N1(this,["high","mid","low","highFrequency","lowFrequency"])}static getDefaults(){return Object.assign(o2.getDefaults(),{lowFrequency:250,highFrequency:2e3,low:{ratio:6,threshold:-30,release:.25,attack:.03,knee:10},mid:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16},high:{ratio:3,threshold:-24,release:.03,attack:.02,knee:16}})}dispose(){return super.dispose(),this._splitter.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.output.dispose(),this}}class k5 extends o2{constructor(){super(a1(k5.getDefaults(),arguments,["low","mid","high"])),this.name="EQ3",this.output=new l2({context:this.context}),this._internalChannels=[];const t=a1(k5.getDefaults(),arguments,["low","mid","high"]);this.input=this._multibandSplit=new f5({context:this.context,highFrequency:t.highFrequency,lowFrequency:t.lowFrequency}),this._lowGain=new l2({context:this.context,gain:t.low,units:"decibels"}),this._midGain=new l2({context:this.context,gain:t.mid,units:"decibels"}),this._highGain=new l2({context:this.context,gain:t.high,units:"decibels"}),this.low=this._lowGain.gain,this.mid=this._midGain.gain,this.high=this._highGain.gain,this.Q=this._multibandSplit.Q,this.lowFrequency=this._multibandSplit.lowFrequency,this.highFrequency=this._multibandSplit.highFrequency,this._multibandSplit.low.chain(this._lowGain,this.output),this._multibandSplit.mid.chain(this._midGain,this.output),this._multibandSplit.high.chain(this._highGain,this.output),N1(this,["low","mid","high","lowFrequency","highFrequency"]),this._internalChannels=[this._multibandSplit]}static getDefaults(){return Object.assign(o2.getDefaults(),{high:0,highFrequency:2500,low:0,lowFrequency:400,mid:0})}dispose(){return super.dispose(),E1(this,["low","mid","high","lowFrequency","highFrequency"]),this._multibandSplit.dispose(),this.lowFrequency.dispose(),this.highFrequency.dispose(),this._lowGain.dispose(),this._midGain.dispose(),this._highGain.dispose(),this.low.dispose(),this.mid.dispose(),this.high.dispose(),this.Q.dispose(),this}}class S5 extends o2{constructor(){super(a1(S5.getDefaults(),arguments,["url","onload"])),this.name="Convolver",this._convolver=this.context.createConvolver();const t=a1(S5.getDefaults(),arguments,["url","onload"]);this._buffer=new $1(t.url,(e=>{this.buffer=e,t.onload()})),this.input=new l2({context:this.context}),this.output=new l2({context:this.context}),this._buffer.loaded&&(this.buffer=this._buffer),this.normalize=t.normalize,this.input.chain(this._convolver,this.output)}static getDefaults(){return Object.assign(o2.getDefaults(),{normalize:!0,onload:O1})}load(t){return Y0(this,void 0,void 0,(function*(){this.buffer=yield this._buffer.load(t)}))}get buffer(){return this._buffer.length?this._buffer:null}set buffer(t){t&&this._buffer.set(t),this._convolver.buffer&&(this.input.disconnect(),this._convolver.disconnect(),this._convolver=this.context.createConvolver(),this.input.chain(this._convolver,this.output));const e=this._buffer.get();this._convolver.buffer=e||null}get normalize(){return this._convolver.normalize}set normalize(t){this._convolver.normalize=t}dispose(){return super.dispose(),this._buffer.dispose(),this._convolver.disconnect(),this}}function T5(){return P1().now()}function I5(){return P1().immediate()}const C5=P1().transport;function A5(){return P1().transport}const N5=P1().destination,E5=P1().destination;function O5(){return P1().destination}const $5=P1().listener;function R5(){return P1().listener}const D5=P1().draw;function M5(){return P1().draw}const P5=P1();function F5(){return $1.loaded()}const L5=$1,z5=x2,B5=P2;var q5=n(103);Error;function V5(t){const e=new q5.Midi(t),n=mG.create();n.ticksPerQuarter=e.header.ppq,n.sourceInfo=mG.SourceInfo.create({parser:mG.SourceInfo.Parser.TONEJS_MIDI_CONVERT,encodingType:mG.SourceInfo.EncodingType.MIDI});for(const i of e.header.timeSignatures)n.timeSignatures.push(mG.TimeSignature.create({time:e.header.ticksToSeconds(i.ticks),numerator:i.timeSignature[0],denominator:i.timeSignature[1]}));n.timeSignatures.length||n.timeSignatures.push(mG.TimeSignature.create({time:0,numerator:4,denominator:4}));for(const i of e.header.tempos)n.tempos.push(mG.Tempo.create({time:i.time,qpm:i.bpm}));let s=-1;for(const i of e.tracks){i.notes.length>0&&(s+=1);for(const r of i.notes){const t=r.time,e=r.duration,o=t+e;n.notes.push(mG.Note.create({instrument:s,program:i.instrument.number,startTime:t,endTime:o,pitch:r.midi,velocity:Math.floor(r.velocity*nG),isDrum:i.instrument.percussion})),o>n.totalTime&&(n.totalTime=o)}const t=Object.values(i.controlChanges),e=[].concat.apply([],t);for(const r of e)n.controlChanges.push(mG.ControlChange.create({time:r.time,controlNumber:r.number,controlValue:Math.floor(r.value*(nG-1)),instrument:s,program:i.instrument.number,isDrum:i.instrument.percussion}))}return n}function W5(t){return new Promise(((e,n)=>{vG(t).then((t=>t.blob())).then((t=>{e(t)})).catch((t=>n(t)))}))}function j5(t){return new Promise(((e,n)=>{const s=new FileReader;s.onload=t=>{try{const t=V5(s.result);e(t)}catch(i){n(i)}},s.onerror=t=>n(t),s.readAsArrayBuffer(t)}))}function U5(t){return W5(t).then(j5)}class G5{constructor(t){this.FADE_SECONDS=.1,this.baseURL=t,this.buffers=new x2,this.sourceMap=new Map,this.initialized=!1}async initialize(){await vG(`${this.baseURL}/instrument.json`).then((t=>t.json())).then((t=>{this.name=t.name,this.minPitch=t.minPitch,this.maxPitch=t.maxPitch,this.durationSeconds=t.durationSeconds,this.releaseSeconds=t.releaseSeconds,this.percussive=t.percussive,this.velocities=t.velocities,this.initialized=!0}))}sampleInfoToName(t){return this.velocities?`p${t.pitch}_v${t.velocity}`:`p${t.pitch}`}sampleNameToURL(t){return`${this.baseURL}/${t}.mp3`}nearestVelocity(t){if(!this.velocities)return t;let e;t||(t=ZU);let n=nG;return this.velocities.forEach((s=>{const i=Math.abs(s-t);i<n&&(e=s,n=i)})),e}async loadSamples(t){this.initialized||await this.initialize();const e=t.filter((t=>!(t.pitch<this.minPitch||t.pitch>this.maxPitch)||(_G(`Pitch ${t.pitch} is outside the valid range for ${this.name}, ignoring.`,"SoundFont"),!1))).map((t=>this.sampleInfoToName({pitch:t.pitch,velocity:this.nearestVelocity(t.velocity)}))),n=Array.from(new Set(e)).filter((t=>!this.buffers.has(t))),s=n.map((t=>({name:t,url:this.sampleNameToURL(t)})));s.length>0&&(s.forEach((t=>this.buffers.add(t.name,t.url))),await F5(),_G(`Loaded samples for ${this.name}.`,"SoundFont"))}playNote(t,e,n,s,i){const r=this.getBuffer(t,e);if(!r)return;s>this.durationSeconds&&_G(`Requested note duration longer than sample duration: ${s} > ${this.durationSeconds}`,"SoundFont");const o=new P2({url:r,fadeOut:this.FADE_SECONDS}).connect(i);if(o.start(n,0,void 0,1),!this.percussive&&s<this.durationSeconds){const t=new P2({url:r,fadeOut:this.FADE_SECONDS}).connect(i);o.stop(n+s+this.FADE_SECONDS),t.start(n+s,this.durationSeconds,void 0,1)}}playNoteDown(t,e,n){const s=this.getBuffer(t,e);if(!s)return;const i=new P2(s).connect(n);i.start(0,0,void 0,1),this.sourceMap.has(t)&&this.sourceMap.get(t).stop(T5()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.set(t,i)}playNoteUp(t,e,n){if(!this.sourceMap.has(t))return;const s=this.getBuffer(t,e);if(!s)return;const i=new P2({url:s,fadeOut:this.FADE_SECONDS}).connect(n);i.start(0,this.durationSeconds,void 0,1),this.sourceMap.get(t).stop(T5()+this.FADE_SECONDS,this.FADE_SECONDS),this.sourceMap.delete(t)}getBuffer(t,e){if(!this.initialized)throw new Error("Instrument is not initialized.");if(t<this.minPitch||t>this.maxPitch)return void _G(`Pitch ${t} is outside the valid range for ${this.name} (${this.minPitch}-${this.maxPitch})`,"SoundFont");const n=this.sampleInfoToName({pitch:t,velocity:this.nearestVelocity(e)});if(!this.buffers.has(n))throw new Error(`Buffer not found for ${this.name}: ${n}`);const s=this.buffers.get(n);if(!s.loaded)throw new Error(`Buffer not loaded for ${this.name}: ${n}`);return s}}class H5{constructor(t){this.baseURL=t,this.instruments=new Map,this.initialized=!1}async initialize(){await vG(`${this.baseURL}/soundfont.json`).then((t=>t.json())).then((t=>{this.name=t.name;for(const e in t.instruments){const n=`${this.baseURL}/${t.instruments[e]}`;this.instruments.set("drums"===e?"drums":+e,new G5(n))}this.initialized=!0}))}async loadSamples(t){this.initialized||await this.initialize();const e=new Map;t.forEach((t=>{t.isDrum=t.isDrum||!1,t.program=t.program||0;const n=t.isDrum?"drums":t.program,s={pitch:t.pitch,velocity:t.velocity};e.has(n)?e.get(n).push(s):this.instruments.has(n)?e.set(n,[s]):_G(`No instrument in ${this.name} for: program=${t.program}, isDrum=${t.isDrum}`,"SoundFont")})),await Promise.all(Array.from(e.keys()).map((t=>this.instruments.get(t).loadSamples(e.get(t)))))}playNote(t,e,n,s,i=0,r=!1,o){const a=r?"drums":i;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(a)?this.instruments.get(a).playNote(t,e,n,s,o):_G(`No instrument in ${this.name} for: program=${i}, isDrum=${r}`,"SoundFont")}playNoteDown(t,e,n=0,s=!1,i){const r=s?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(r)?this.instruments.get(r).playNoteDown(t,e,i):_G(`No instrument in ${this.name} for: program=${n}, isDrum=${s}`,"SoundFont")}playNoteUp(t,e,n=0,s=!1,i){const r=s?"drums":n;if(!this.initialized)throw new Error("SoundFont is not initialized.");this.instruments.has(r)?this.instruments.get(r).playNoteUp(t,e,i):_G(`No instrument in ${this.name} for: program=${n}, isDrum=${s}`,"SoundFont")}}function K5(t,e){return t.quantizedStartStep<e.quantizedStartStep?-1:t.quantizedStartStep>e.quantizedStartStep?1:t.pitch<e.pitch?-1:1}class X5{constructor(t=!1,e){this.playClick=t,this.callbackObject=e,this.desiredQPM=void 0}setTempo(t){this.desiredQPM=t,"started"===C5.state&&(C5.bpm.value=t)}makeClickSequence(t){const e=TG(t),n=e.notes.map((t=>t.quantizedEndStep)),s=Math.max(...n);for(let i=0;i<s;i+=4){const t={pitch:i%16===0?cG:lG,quantizedStartStep:i,isDrum:!0,quantizedEndStep:i+1};e.notes.push(t)}return e.notes.sort(K5),e}resumeContext(){P5.resume()}start(t,e,n=0){if("started"===this.getPlayState())throw new Error("Cannot start playback; player is already playing.");if("paused"===this.getPlayState())throw new Error("Cannot `start()` a paused player; use `resume()`.");if("stopped"!==C5.state)throw new Error("Cannot start playback while `Tone.Transport` is in use.");this.resumeContext();const s=AG(t);if(this.playClick&&s&&(t=this.makeClickSequence(t)),e?C5.bpm.value=e:t.tempos&&t.tempos.length>0&&t.tempos[0].qpm>0?C5.bpm.value=t.tempos[0].qpm:C5.bpm.value=YU,s)t=OG(t,e);else if(e)throw new Error("Cannot specify a `qpm` for a non-quantized sequence.");const i=new s4(((t,e)=>{this.currentPart===i&&(this.playNote(t,e),this.callbackObject&&D5.schedule((()=>{this.callbackObject.run(e,t)}),t))}),t.notes.map((t=>[t.startTime,t])));return this.currentPart=i,this.desiredQPM&&(C5.bpm.value=this.desiredQPM),this.currentPart.start(void 0,n),"started"!==C5.state&&C5.start(),new Promise((e=>{this.scheduledStop=C5.schedule((()=>{this.stop(),e(),this.callbackObject&&this.callbackObject.stop()}),`+${t.totalTime}`)}))}stop(){this.isPlaying()&&(this.currentPart.stop(),C5.stop(),this.currentPart=null),C5.clear(this.scheduledStop),this.scheduledStop=void 0,this.desiredQPM=void 0}pause(){if(!this.isPlaying())throw new Error("Cannot pause playback while the player is stopped.");C5.pause()}resume(){if("paused"!==this.getPlayState())throw new Error(`Cannot resume playback while "${this.getPlayState()}".`);C5.start()}seekTo(t){if(!this.isPlaying())throw new Error("Cannot seek while the player is stopped.");C5.seconds=t}isPlaying(){return!!this.currentPart}getPlayState(){return this.isPlaying()?C5.state:"stopped"}}class Q5{constructor(){this.DRUM_PITCH_TO_CLASS=new Map,this.kick=(new F3).toDestination(),this.tomLow=new F3({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomMid=new F3({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.tomHigh=new F3({pitchDecay:.008,envelope:{attack:.01,decay:.5,sustain:0}}).toDestination(),this.closedHihat=new P3({frequency:400,envelope:{attack:.001,decay:.1,release:.8},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.openHihat=new P3({frequency:400,envelope:{attack:.001,decay:.5,release:.8,sustain:1},harmonicity:5.1,modulationIndex:32,resonance:4e3,octaves:1}).toDestination(),this.ride=(new P3).toDestination(),this.crash=new P3({frequency:300,envelope:{attack:.001,decay:1,release:3},harmonicity:5.1,modulationIndex:64,resonance:4e3,octaves:1.5}).toDestination(),this.snare=new L3({noise:{type:"white"},envelope:{attack:.005,decay:.05,sustain:.1,release:.4}}).toDestination(),this.loClick=new F3({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.hiClick=new F3({pitchDecay:.008,envelope:{attack:.001,decay:.3,sustain:0}}).toDestination(),this.pitchPlayers=[(t,e=1)=>this.kick.triggerAttackRelease("C2","8n",t,e),(t,e=1)=>this.snare.triggerAttackRelease("16n",t,e),(t,e=1)=>this.closedHihat.triggerAttack(t,.3,e),(t,e=1)=>this.openHihat.triggerAttack(t,.3,e),(t,e=.5)=>this.tomLow.triggerAttack("G3",t,e),(t,e=.5)=>this.tomMid.triggerAttack("C4",t,e),(t,e=.5)=>this.tomHigh.triggerAttack("F4",t,e),(t,e=1)=>this.crash.triggerAttack(t,1,e),(t,e=1)=>this.ride.triggerAttack(t,.5,e),(t,e=.5)=>this.loClick.triggerAttack("G5",t,e),(t,e=.5)=>this.hiClick.triggerAttack("C6",t,e)];for(let t=0;t<JU.length;++t)JU[t].forEach((e=>{this.DRUM_PITCH_TO_CLASS.set(e,t)}));this.DRUM_PITCH_TO_CLASS.set(cG,hG),this.DRUM_PITCH_TO_CLASS.set(lG,pG)}static getInstance(){return Q5.instance||(Q5.instance=new Q5),Q5.instance}playNote(t,e,n){this.pitchPlayers[this.DRUM_PITCH_TO_CLASS.get(t)](e,n)}}class Y5 extends X5{constructor(){super(...arguments),this.drumKit=Q5.getInstance(),this.bassSynth=new I3({volume:5,oscillator:{type:"triangle"}}).toDestination(),this.polySynth=(new J3).toDestination()}playNote(t,e){const n=e.hasOwnProperty("velocity")?e.velocity/eG:void 0;if(e.isDrum)this.drumKit.playNote(e.pitch,t,n);else{const s=t2(e.pitch,"midi").toFrequency(),i=e.endTime-e.startTime;this.getSynth(e.instrument,e.program).triggerAttackRelease(s,i,t,n)}}getSynth(t,e){return void 0!==e&&e>=32&&e<=39?this.bassSynth:this.polySynth}}Y5.tone=c;class Z5 extends X5{constructor(t,e=E5,n,s,i){super(!1,i),this.soundFont=new H5(t),this.output=e,this.programOutputs=n,this.drumOutputs=s}async loadSamples(t){await this.soundFont.loadSamples(t.notes.map((t=>({pitch:t.pitch,velocity:t.velocity,program:t.program||0,isDrum:t.isDrum||!1}))))}async loadAllSamples(t=0,e=!1){const n=mG.create(),s=e?aG:rG,i=e?uG:oG;for(let r=s;r<=i;r++)for(let s=tG;s<eG;s++)n.notes.push({pitch:r,velocity:s,program:t,isDrum:e});return this.loadSamples(n)}resumeContext(){P5.resume()}start(t,e,n=0){return this.resumeContext(),this.loadSamples(t).then((()=>super.start(t,e,n)))}playNote(t,e){this.soundFont.playNote(e.pitch,e.velocity,t,e.endTime-e.startTime,e.program,e.isDrum,this.getAudioNodeOutput(e))}playNoteDown(t){this.soundFont.playNoteDown(t.pitch,t.velocity,t.program,t.isDrum,this.getAudioNodeOutput(t))}playNoteUp(t){this.soundFont.playNoteUp(t.pitch,t.velocity,t.program,t.isDrum,this.getAudioNodeOutput(t))}getAudioNodeOutput(t){let e=this.output;return this.programOutputs&&!t.isDrum?this.programOutputs.has(t.program)&&(e=this.programOutputs.get(t.program)):this.drumOutputs&&t.isDrum&&this.drumOutputs.has(t.pitch)&&(e=this.drumOutputs.get(t.pitch)),e}}var J5=n(3721);const t6=1;class e6{constructor(t,e={}){const n=AG(t),s=t.tempos&&t.tempos.length>0?t.tempos[0].qpm:void 0;this.noteSequence=n?OG(t,s):t;const i=30;this.config={noteHeight:e.noteHeight||6,noteSpacing:e.noteSpacing||1,pixelsPerTimeStep:e.pixelsPerTimeStep||i,noteRGB:e.noteRGB||"8, 41, 64",activeNoteRGB:e.activeNoteRGB||"240, 84, 119",minPitch:e.minPitch,maxPitch:e.maxPitch};const r=this.getSize();this.width=r.width,this.height=r.height}updateMinMaxPitches(t=!1){if(!this.config.minPitch||!this.config.maxPitch){void 0===this.config.minPitch&&(this.config.minPitch=iG),void 0===this.config.maxPitch&&(this.config.maxPitch=sG);for(const t of this.noteSequence.notes)this.config.minPitch=Math.min(t.pitch,this.config.minPitch),this.config.maxPitch=Math.max(t.pitch,this.config.maxPitch);t||(this.config.minPitch-=2,this.config.maxPitch+=2)}}getSize(){this.updateMinMaxPitches();const t=(this.config.maxPitch-this.config.minPitch)*this.config.noteHeight,e=this.noteSequence.totalTime;if(!e)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");const n=e*this.config.pixelsPerTimeStep;return{width:n,height:t}}getNotePosition(t,e){const n=this.getNoteEndTime(t)-this.getNoteStartTime(t),s=this.getNoteStartTime(t)*this.config.pixelsPerTimeStep,i=Math.max(this.config.pixelsPerTimeStep*n-this.config.noteSpacing,t6),r=this.height-(t.pitch-this.config.minPitch)*this.config.noteHeight;return{x:s,y:r,w:i,h:this.config.noteHeight}}scrollIntoViewIfNeeded(t,e){if(t&&this.parentElement){const t=this.parentElement.getBoundingClientRect().width;e>this.parentElement.scrollLeft+t&&(this.parentElement.scrollLeft=e-20)}}getNoteStartTime(t){return Math.round(1e8*t.startTime)/1e8}getNoteEndTime(t){return Math.round(1e8*t.endTime)/1e8}isPaintingActiveNote(t,e){const n=this.getNoteStartTime(t)===this.getNoteStartTime(e),s=this.getNoteStartTime(t)<=this.getNoteStartTime(e)&&this.getNoteEndTime(t)>=this.getNoteEndTime(e);return n||s}}class n6 extends e6{constructor(t,e={}){super(t,e),this.drawn=!1}redraw(t,e){if(this.drawn||this.draw(),!t)return null;let n;this.unfillActiveRect(this.svg);for(let s=0;s<this.noteSequence.notes.length;s++){const e=this.noteSequence.notes[s],i=t&&this.isPaintingActiveNote(e,t);if(!i)continue;const r=this.svg.querySelector(`rect[data-index="${s}"]`);this.fillActiveRect(r,e),e===t&&(n=parseFloat(r.getAttribute("x")))}return this.scrollIntoViewIfNeeded(e,n),n}fillActiveRect(t,e){t.setAttribute("fill",this.getNoteFillColor(e,!0)),t.classList.add("active")}unfillActiveRect(t){const e=t.querySelectorAll("rect.active");for(let n=0;n<e.length;++n){const t=e[n],s=this.getNoteFillColor(this.noteSequence.notes[parseInt(t.getAttribute("data-index"),10)],!1);t.setAttribute("fill",s),t.classList.remove("active")}}draw(){for(let t=0;t<this.noteSequence.notes.length;t++){const e=this.noteSequence.notes[t],n=this.getNotePosition(e,t),s=this.getNoteFillColor(e,!1),i=[["index",t],["instrument",e.instrument],["program",e.program],["isDrum",!0===e.isDrum],["pitch",e.pitch]],r=[["--midi-velocity",String(void 0!==e.velocity?e.velocity:127)]];this.drawNote(n.x,n.y,n.w,n.h,s,i,r)}this.drawn=!0}getNoteFillColor(t,e){const n=.2,s=t.velocity?t.velocity/100+n:1,i=`rgba(${e?this.config.activeNoteRGB:this.config.noteRGB},\n  ${s})`;return i}drawNote(t,e,n,s,i,r,o){if(!this.svg)return;const a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.classList.add("note"),a.setAttribute("fill",i),a.setAttribute("x",`${Math.round(t)}`),a.setAttribute("y",`${Math.round(e)}`),a.setAttribute("width",`${Math.round(n)}`),a.setAttribute("height",`${Math.round(s)}`),r.forEach((([t,e])=>{void 0!==e&&(a.dataset[t]=`${e}`)})),o.forEach((([t,e])=>{a.style.setProperty(t,e)})),this.svg.appendChild(a)}clear(){this.svg.innerHTML="",this.drawn=!1}clearActiveNotes(){this.unfillActiveRect(this.svg)}}class s6 extends n6{constructor(t,e,n={}){if(super(t,n),!(e instanceof SVGSVGElement))throw new Error("This visualizer requires an <svg> element to display the visualization");this.svg=e,this.parentElement=e.parentElement;const s=this.getSize();this.width=s.width,this.height=s.height,this.svg.style.width=`${this.width}px`,this.svg.style.height=`${this.height}px`,this.clear(),this.draw()}}class i6 extends n6{constructor(t,e,n={}){if(super(t,n),this.NOTES_PER_OCTAVE=12,this.WHITE_NOTES_PER_OCTAVE=7,this.LOW_C=24,this.firstDrawnOctave=0,this.lastDrawnOctave=6,!(e instanceof HTMLDivElement))throw new Error("This visualizer requires a <div> element to display the visualization");this.config.whiteNoteWidth=n.whiteNoteWidth||20,this.config.blackNoteWidth=n.blackNoteWidth||2*this.config.whiteNoteWidth/3,this.config.whiteNoteHeight=n.whiteNoteHeight||70,this.config.blackNoteHeight=n.blackNoteHeight||140/3,this.config.showOnlyOctavesUsed=n.showOnlyOctavesUsed,this.setupDOM(e);const s=this.getSize();this.width=s.width,this.height=s.height,this.svg.style.width=`${this.width}px`,this.svg.style.height=`${this.height}px`,this.svgPiano.style.width=`${this.width}px`,this.svgPiano.style.height=`${this.config.whiteNoteHeight}px`,this.parentElement.style.width=`${this.width+this.config.whiteNoteWidth}px`,this.parentElement.scrollTop=this.parentElement.scrollHeight,this.clear(),this.drawPiano(),this.draw()}setupDOM(t){this.parentElement=document.createElement("div"),this.parentElement.classList.add("waterfall-notes-container");const e=Math.max(t.getBoundingClientRect().height,200);this.parentElement.style.paddingTop=e-this.config.whiteNoteHeight+"px",this.parentElement.style.height=e-this.config.whiteNoteHeight+"px",this.parentElement.style.boxSizing="border-box",this.parentElement.style.overflowX="hidden",this.parentElement.style.overflowY="auto",this.svg=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svgPiano=document.createElementNS("http://www.w3.org/2000/svg","svg"),this.svg.classList.add("waterfall-notes"),this.svgPiano.classList.add("waterfall-piano"),this.parentElement.appendChild(this.svg),t.innerHTML="",t.appendChild(this.parentElement),t.appendChild(this.svgPiano)}redraw(t,e){if(this.drawn||this.draw(),!t)return null;this.clearActiveNotes(),this.parentElement.style.paddingTop=this.parentElement.style.height;for(let n=0;n<this.noteSequence.notes.length;n++){const e=this.noteSequence.notes[n],s=t&&this.isPaintingActiveNote(e,t);if(!s)continue;const i=this.svg.querySelector(`rect[data-index="${n}"]`);this.fillActiveRect(i,e);const r=this.svgPiano.querySelector(`rect[data-pitch="${e.pitch}"]`);if(this.fillActiveRect(r,e),e===t){const t=parseFloat(i.getAttribute("y")),e=parseFloat(i.getAttribute("height"));return t<this.parentElement.scrollTop-e&&(this.parentElement.scrollTop=t+e),t}}return null}getSize(){this.updateMinMaxPitches(!0);let t=52;if(this.config.showOnlyOctavesUsed){let e=!1,n=!1;for(let t=1;t<7;t++){const s=this.LOW_C+this.NOTES_PER_OCTAVE*t;!e&&s>this.config.minPitch&&(this.firstDrawnOctave=t-1,e=!0),!n&&s>this.config.maxPitch&&(this.lastDrawnOctave=t-1,n=!0)}t=(this.lastDrawnOctave-this.firstDrawnOctave+1)*this.WHITE_NOTES_PER_OCTAVE}const e=t*this.config.whiteNoteWidth,n=this.noteSequence.totalTime;if(!n)throw new Error("The sequence you are using with the visualizer does not have a totalQuantizedSteps or totalTime field set, so the visualizer can't be horizontally sized correctly.");const s=Math.max(n*this.config.pixelsPerTimeStep,t6);return{width:e,height:s}}getNotePosition(t,e){const n=this.svgPiano.querySelector(`rect[data-pitch="${t.pitch}"]`);if(!n)return null;const s=this.getNoteEndTime(t)-this.getNoteStartTime(t),i=Number(n.getAttribute("x")),r=Number(n.getAttribute("width")),o=Math.max(this.config.pixelsPerTimeStep*s-this.config.noteSpacing,t6),a=this.height-this.getNoteStartTime(t)*this.config.pixelsPerTimeStep-o;return{x:i,y:a,w:r,h:o}}drawPiano(){this.svgPiano.innerHTML="";const t=this.config.whiteNoteWidth-this.config.blackNoteWidth/2,e=[1,3,6,8,10];let n=0,s=0;this.config.showOnlyOctavesUsed?s=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C:(s=this.LOW_C-3,this.drawWhiteKey(s,n),this.drawWhiteKey(s+2,this.config.whiteNoteWidth),s+=3,n=2*this.config.whiteNoteWidth);for(let i=this.firstDrawnOctave;i<=this.lastDrawnOctave;i++)for(let t=0;t<this.NOTES_PER_OCTAVE;t++)-1===e.indexOf(t)&&(this.drawWhiteKey(s,n),n+=this.config.whiteNoteWidth),s++;this.config.showOnlyOctavesUsed?(s=this.firstDrawnOctave*this.NOTES_PER_OCTAVE+this.LOW_C,n=-this.config.whiteNoteWidth):(this.drawWhiteKey(s,n),s=this.LOW_C-3,this.drawBlackKey(s+1,t),s+=3,n=this.config.whiteNoteWidth);for(let i=this.firstDrawnOctave;i<=this.lastDrawnOctave;i++)for(let r=0;r<this.NOTES_PER_OCTAVE;r++)-1!==e.indexOf(r)?this.drawBlackKey(s,n+t):n+=this.config.whiteNoteWidth,s++}drawWhiteKey(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(t),n.setAttribute("x",String(e)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.whiteNoteWidth)),n.setAttribute("height",String(this.config.whiteNoteHeight)),n.setAttribute("fill","white"),n.setAttribute("original-fill","white"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("white"),this.svgPiano.appendChild(n),n}drawBlackKey(t,e){const n=document.createElementNS("http://www.w3.org/2000/svg","rect");return n.dataset.pitch=String(t),n.setAttribute("x",String(e)),n.setAttribute("y","0"),n.setAttribute("width",String(this.config.blackNoteWidth)),n.setAttribute("height",String(this.config.blackNoteHeight)),n.setAttribute("fill","black"),n.setAttribute("original-fill","black"),n.setAttribute("stroke","black"),n.setAttribute("stroke-width","3px"),n.classList.add("black"),this.svgPiano.appendChild(n),n}clearActiveNotes(){super.unfillActiveRect(this.svg);const t=this.svgPiano.querySelectorAll("rect.active");for(let e=0;e<t.length;++e){const n=t[e];n.setAttribute("fill",n.getAttribute("original-fill")),n.classList.remove("active")}}}var r6;(function(t){t[t["PAGE"]=0]="PAGE",t[t["NOTE"]=1]="NOTE",t[t["BAR"]=2]="BAR"})(r6||(r6={}));class o6 extends e6{constructor(t,e,n={}){super(t,n),(void 0===n.pixelsPerTimeStep||n.pixelsPerTimeStep<=0)&&(this.config.pixelsPerTimeStep=0),this.instruments=n.instruments||[],this.render=new J5.StaffSVGRender(this.getScoreInfo(t),{noteHeight:this.config.noteHeight,noteSpacing:this.config.noteSpacing,pixelsPerTimeStep:this.config.pixelsPerTimeStep,noteRGB:this.config.noteRGB,activeNoteRGB:this.config.activeNoteRGB,defaultKey:n.defaultKey||0,scrollType:n.scrollType||r6.PAGE},e),this.drawnNotes=t.notes.length,this.clear(),this.redraw()}clear(){this.render.clear()}redraw(t,e){this.drawnNotes!==this.noteSequence.notes.length&&(this.render.scoreInfo=this.getScoreInfo(this.noteSequence));const n=t?this.getNoteInfo(t):void 0;return this.render.redraw(n,e)}isNoteInInstruments(t){return void 0===t.instrument||0===this.instruments.length||this.instruments.indexOf(t.instrument)>=0}timeToQuarters(t){const e=t*this.noteSequence.tempos[0].qpm/60;return Math.round(16*e)/16}getNoteInfo(t){const e=this.timeToQuarters(t.startTime),n=this.timeToQuarters(t.endTime);return{start:e,length:n-e,pitch:t.pitch,intensity:t.velocity}}getScoreInfo(t){const e=[];return t.notes.forEach((t=>{this.isNoteInInstruments(t)&&e.push(this.getNoteInfo(t))})),{notes:e,tempos:t.tempos?t.tempos.map((t=>({start:this.timeToQuarters(t.time),qpm:t.qpm}))):[],keySignatures:t.keySignatures?t.keySignatures.map((t=>({start:this.timeToQuarters(t.time),key:t.key}))):[],timeSignatures:t.timeSignatures?t.timeSignatures.map((t=>({start:this.timeToQuarters(t.time),numerator:t.numerator,denominator:t.denominator}))):[]}}clearActiveNotes(){this.redraw()}}
/**
 * html-midi-player@1.5.0
 * https://github.com/cifkao/html-midi-player.git
 * @author Ondej Cfka (@cifkao)
 * @license BSD-2-Clause
 */
var a6='<svg width="24" height="24" version="1.1" viewBox="0 0 6.35 6.35" xmlns="http://www.w3.org/2000/svg">\n <path d="m4.4979 3.175-2.1167 1.5875v-3.175z" stroke-width=".70201"/>\n</svg>\n',u6='<svg width="24" height="24" version="1.1" viewBox="0 0 6.35 6.35" xmlns="http://www.w3.org/2000/svg">\n <path d="m1.8521 1.5875v3.175h0.92604v-3.175zm1.7198 0v3.175h0.92604v-3.175z" stroke-width=".24153"/>\n</svg>\n',c6='<svg width="24" height="24" version="1.1" viewBox="0 0 6.35 6.35" xmlns="http://www.w3.org/2000/svg">\n <path transform="scale(.26458)" d="m12 3.5a8.4993 8.4993 0 0 0-8.5 8.5 8.4993 8.4993 0 0 0 8.5 8.5 8.4993 8.4993 0 0 0 8.5-8.5 8.4993 8.4993 0 0 0-8.5-8.5zm-1.4062 3.5h3v6h-3v-6zm0 8h3v2h-3v-2z"/>\n</svg>\n',l6=":host {\n  display: inline-block;\n  width: 300px;\n  margin: 3px;\n  vertical-align: bottom;\n  font-family: sans-serif;\n  font-size: 14px;\n}\n\n:focus:not(.focus-visible) {\n  outline: none;\n}\n\n.controls {\n  width: inherit;\n  height: inherit;\n  box-sizing: border-box;\n  display: flex;\n  flex-direction: row;\n  position: relative;\n  overflow: hidden;\n  align-items: center;\n  border-radius: 100px;\n  background: #f2f5f6;\n  padding: 0 0.25em;\n  user-select: none;\n}\n.controls > * {\n  margin: 0.8em 0.45em;\n}\n.controls input, .controls button {\n  cursor: pointer;\n}\n.controls input:disabled, .controls button:disabled {\n  cursor: inherit;\n}\n.controls button {\n  text-align: center;\n  background: rgba(204, 204, 204, 0);\n  border: none;\n  width: 32px;\n  height: 32px;\n  border-radius: 100%;\n  transition: background-color 0.25s ease 0s;\n  padding: 0;\n}\n.controls button:not(:disabled):hover {\n  background: rgba(204, 204, 204, 0.3);\n}\n.controls button:not(:disabled):active {\n  background: rgba(204, 204, 204, 0.6);\n}\n.controls button .icon {\n  display: none;\n}\n.controls button .icon, .controls button .icon svg {\n  vertical-align: middle;\n}\n.controls button .icon svg {\n  fill: currentColor;\n}\n.controls .seek-bar {\n  flex: 1;\n  min-width: 0;\n  margin-right: 1.1em;\n  background: transparent;\n}\n.controls .seek-bar::-moz-range-track {\n  background-color: #555;\n}\n.controls.stopped .play-icon, .controls.playing .stop-icon, .controls.error .error-icon {\n  display: inherit;\n}\n.controls.frozen > div, .controls > button:disabled .icon {\n  opacity: 0.5;\n}\n.controls .overlay {\n  z-index: 0;\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  margin: 0;\n  box-sizing: border-box;\n  display: none;\n  opacity: 1;\n}\n.controls.loading .loading-overlay {\n  display: block;\n  background: linear-gradient(110deg, #92929200 5%, #92929288 25%, #92929200 45%);\n  background-size: 250% 100%;\n  background-repeat: repeat-y;\n  animation: shimmer 1.5s linear infinite;\n}\n\n@keyframes shimmer {\n  0% {\n    background-position: 125% 0;\n  }\n  100% {\n    background-position: -200% 0;\n  }\n}",h6=":host {\n  display: block;\n}\n\n::slotted(.piano-roll-visualizer) {\n  overflow-x: auto;\n}";const p6=document.createElement("template");p6.innerHTML=`\n<style>\n${l6}\n</style>\n<div class="controls stopped frozen" part="control-panel">\n  <button class="play" part="play-button" disabled>\n    <span class="icon play-icon">${a6}</span>\n    <span class="icon stop-icon">${u6}</span>\n    <span class="icon error-icon">${c6}</span>\n  </button>\n  <div part="time"><span class="current-time" part="current-time">0:00</span> / <span class="total-time" part="total-time">0:00</span></div>\n  <input type="range" min="0" max="0" value="0" step="any" class="seek-bar" part="seek-bar" disabled>\n  <div class="overlay loading-overlay" part="loading-overlay"></div>\n</div>\n`;const d6=document.createElement("template");function f6(t){const e=t<0;t=Math.floor(Math.abs(t||0));const n=t%60,s=(t-n)/60,i=(t-n-60*s)/3600,r=n>9?`${n}`:`0${n}`,o=s>9||!i?`${s}:`:`0${s}:`,a=i?`${i}:`:"";return(e?"-":"")+a+o+r}d6.innerHTML=`\n<style>\n${h6}\n</style>\n<slot>\n</slot>\n`;const m6=["piano-roll","waterfall","staff"];class g6 extends HTMLElement{constructor(){super(...arguments),this.domInitialized=!1,this.ns=null,this._config={}}static get observedAttributes(){return["src","type"]}connectedCallback(){this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(d6.content.cloneNode(!0)),this.domInitialized||(this.domInitialized=!0,this.wrapper=document.createElement("div"),this.appendChild(this.wrapper),this.initVisualizerNow())}attributeChangedCallback(t,e,n){"src"!==t&&"type"!==t||this.initVisualizer()}initVisualizer(){null==this.initTimeout&&(this.initTimeout=window.setTimeout((()=>this.initVisualizerNow())))}async initVisualizerNow(){if(this.initTimeout=null,this.domInitialized&&(this.src&&(this.ns=null,this.ns=await U5(this.src)),this.wrapper.innerHTML="",this.ns))if("piano-roll"===this.type){this.wrapper.classList.add("piano-roll-visualizer");const t=document.createElementNS("http://www.w3.org/2000/svg","svg");this.wrapper.appendChild(t),this.visualizer=new s6(this.ns,t,this._config)}else if("waterfall"===this.type)this.wrapper.classList.add("waterfall-visualizer"),this.visualizer=new i6(this.ns,this.wrapper,this._config);else if("staff"===this.type){this.wrapper.classList.add("staff-visualizer");const t=document.createElement("div");this.wrapper.appendChild(t),this.visualizer=new o6(this.ns,t,this._config)}}reload(){this.initVisualizerNow()}redraw(t){this.visualizer&&this.visualizer.redraw(t,null!=t)}clearActiveNotes(){this.visualizer&&this.visualizer.clearActiveNotes()}get noteSequence(){return this.ns}set noteSequence(t){this.ns!=t&&(this.ns=t,this.removeAttribute("src"),this.initVisualizer())}get src(){return this.getAttribute("src")}set src(t){this.ns=null,this.setOrRemoveAttribute("src",t),this.initVisualizer()}get type(){let t=this.getAttribute("type");return m6.indexOf(t)<0&&(t="piano-roll"),t}set type(t){if(null!=t&&m6.indexOf(t)<0)throw new Error(`Unknown visualizer type ${t}. Allowed values: ${m6.join(", ")}`);this.setOrRemoveAttribute("type",t)}get config(){return this._config}set config(t){this._config=t,this.initVisualizer()}setOrRemoveAttribute(t,e){null==e?this.removeAttribute(t):this.setAttribute(t,e)}}const y6=["start","stop","note"],b6="https://storage.googleapis.com/magentadata/js/soundfonts/sgm_plus";let v6=null;class w6 extends HTMLElement{constructor(){super(),this.domInitialized=!1,this.needInitNs=!1,this.visualizerListeners=new Map,this.ns=null,this._playing=!1,this.seeking=!1,this.attachShadow({mode:"open"}),this.shadowRoot.appendChild(p6.content.cloneNode(!0)),this.controlPanel=this.shadowRoot.querySelector(".controls"),this.playButton=this.controlPanel.querySelector(".play"),this.currentTimeLabel=this.controlPanel.querySelector(".current-time"),this.totalTimeLabel=this.controlPanel.querySelector(".total-time"),this.seekBar=this.controlPanel.querySelector(".seek-bar")}static get observedAttributes(){return["sound-font","src","visualizer"]}connectedCallback(){if(this.domInitialized)return;this.domInitialized=!0;const t=window.applyFocusVisiblePolyfill;null!=t&&t(this.shadowRoot),this.playButton.addEventListener("click",(()=>{this.player.isPlaying()?this.stop():this.start()})),this.seekBar.addEventListener("input",(()=>{this.seeking=!0,this.player&&"started"===this.player.getPlayState()&&this.player.pause()})),this.seekBar.addEventListener("change",(()=>{const t=this.currentTime;this.currentTimeLabel.textContent=f6(t),this.player&&this.player.isPlaying()&&(this.player.seekTo(t),"paused"===this.player.getPlayState()&&this.player.resume()),this.seeking=!1})),this.initPlayerNow()}attributeChangedCallback(t,e,n){if(this.hasAttribute(t)||(n=null),"sound-font"===t||"src"===t)this.initPlayer();else if("visualizer"===t){const t=()=>{this.setVisualizerSelector(n)};"loading"===document.readyState?window.addEventListener("DOMContentLoaded",t):t()}}initPlayer(t=!0){this.needInitNs=this.needInitNs||t,null==this.initTimeout&&(this.stop(),this.setLoading(),this.initTimeout=window.setTimeout((()=>this.initPlayerNow(this.needInitNs))))}async initPlayerNow(t=!0){if(this.initTimeout=null,this.needInitNs=!1,this.domInitialized)try{let e=null;if(t&&(this.src&&(this.ns=null,this.ns=await U5(this.src)),this.currentTime=0,this.ns||this.setError("No content loaded")),e=this.ns,!e)return this.seekBar.max="0",void(this.totalTimeLabel.textContent=f6(0));this.seekBar.max=String(e.totalTime),this.totalTimeLabel.textContent=f6(e.totalTime);let n=this.soundFont;const s={run:t=>this.ns===e&&this.noteCallback(t),stop:()=>{}};if(null===n?this.player=new Y5(!1,s):(""===n&&(n=b6),this.player=new Z5(n,void 0,void 0,void 0,s),await this.player.loadSamples(e)),this.ns!==e)return;this.setLoaded(),this.dispatchEvent(new CustomEvent("load"))}catch(e){throw this.setError(String(e)),e}}reload(){this.initPlayerNow()}start(){this._start()}_start(t=!1){(async()=>{if(this.player)if("stopped"==this.player.getPlayState()){!v6||!v6.playing||v6==this&&t||v6.stop(),v6=this,this._playing=!0;let n=this.currentTime;0==this.ns.notes.filter((t=>t.startTime>n)).length&&(n=0),this.currentTime=n,this.controlPanel.classList.remove("stopped"),this.controlPanel.classList.add("playing");try{for(const t of this.visualizerListeners.keys())t.noteSequence!=this.ns&&(t.noteSequence=this.ns,t.reload());const e=this.player.start(this.ns,void 0,n);t?this.dispatchEvent(new CustomEvent("loop")):this.dispatchEvent(new CustomEvent("start")),await e,this.handleStop(!0)}catch(e){throw this.handleStop(),e}}else"paused"==this.player.getPlayState()&&this.player.resume()})()}stop(){this.player&&this.player.isPlaying()&&this.player.stop(),this.handleStop(!1)}addVisualizer(t){const e={start:()=>{t.noteSequence=this.noteSequence},stop:()=>{t.clearActiveNotes()},note:e=>{t.redraw(e.detail.note)}};for(const n of y6)this.addEventListener(n,e[n]);this.visualizerListeners.set(t,e)}removeVisualizer(t){const e=this.visualizerListeners.get(t);for(const n of y6)this.removeEventListener(n,e[n]);this.visualizerListeners.delete(t)}noteCallback(t){this.playing&&(this.dispatchEvent(new CustomEvent("note",{detail:{note:t}})),this.seeking||(this.seekBar.value=String(t.startTime),this.currentTimeLabel.textContent=f6(t.startTime)))}handleStop(t=!1){if(t){if(this.loop)return this.currentTime=0,void this._start(!0);this.currentTime=this.duration}this.controlPanel.classList.remove("playing"),this.controlPanel.classList.add("stopped"),this._playing&&(this._playing=!1,this.dispatchEvent(new CustomEvent("stop",{detail:{finished:t}})))}setVisualizerSelector(t){for(const e of this.visualizerListeners.values())for(const t of y6)this.removeEventListener(t,e[t]);if(this.visualizerListeners.clear(),null!=t)for(const e of document.querySelectorAll(t))e instanceof g6?this.addVisualizer(e):console.warn(`Selector ${t} matched non-visualizer element`,e)}setLoading(){this.playButton.disabled=!0,this.seekBar.disabled=!0,this.controlPanel.classList.remove("error"),this.controlPanel.classList.add("loading","frozen"),this.controlPanel.removeAttribute("title")}setLoaded(){this.controlPanel.classList.remove("loading","frozen"),this.playButton.disabled=!1,this.seekBar.disabled=!1}setError(t){this.playButton.disabled=!0,this.seekBar.disabled=!0,this.controlPanel.classList.remove("loading","stopped","playing"),this.controlPanel.classList.add("error","frozen"),this.controlPanel.title=t}get noteSequence(){return this.ns}set noteSequence(t){this.ns!=t&&(this.ns=t,this.removeAttribute("src"),this.initPlayer())}get src(){return this.getAttribute("src")}set src(t){this.ns=null,this.setOrRemoveAttribute("src",t),this.initPlayer()}get soundFont(){return this.getAttribute("sound-font")}set soundFont(t){this.setOrRemoveAttribute("sound-font",t)}get loop(){return null!=this.getAttribute("loop")}set loop(t){this.setOrRemoveAttribute("loop",t?"":null)}get currentTime(){return parseFloat(this.seekBar.value)}set currentTime(t){this.seekBar.value=String(t),this.currentTimeLabel.textContent=f6(this.currentTime),this.player&&this.player.isPlaying()&&this.player.seekTo(t)}get duration(){return parseFloat(this.seekBar.max)}get playing(){return this._playing}setOrRemoveAttribute(t,e){null==e?this.removeAttribute(t):this.setAttribute(t,e)}}window.customElements.define("midi-player",w6),window.customElements.define("midi-visualizer",g6)},1387:function(t,e,n){"use strict";n.d(e,{aE:function(){return Qt},sC:function(){return et}});n(4114);var s=n(6768),i=n(144);
/*!
  * vue-router v4.3.0
  * (c) 2024 Eduardo San Martin Morote
  * @license MIT
  */
const r="undefined"!==typeof document;function o(t){return t.__esModule||"Module"===t[Symbol.toStringTag]}const a=Object.assign;function u(t,e){const n={};for(const s in e){const i=e[s];n[s]=l(i)?i.map(t):t(i)}return n}const c=()=>{},l=Array.isArray;const h=/#/g,p=/&/g,d=/\//g,f=/=/g,m=/\?/g,g=/\+/g,y=/%5B/g,b=/%5D/g,v=/%5E/g,w=/%60/g,x=/%7B/g,_=/%7C/g,k=/%7D/g,S=/%20/g;function T(t){return encodeURI(""+t).replace(_,"|").replace(y,"[").replace(b,"]")}function I(t){return T(t).replace(x,"{").replace(k,"}").replace(v,"^")}function C(t){return T(t).replace(g,"%2B").replace(S,"+").replace(h,"%23").replace(p,"%26").replace(w,"`").replace(x,"{").replace(k,"}").replace(v,"^")}function A(t){return C(t).replace(f,"%3D")}function N(t){return T(t).replace(h,"%23").replace(m,"%3F")}function E(t){return null==t?"":N(t).replace(d,"%2F")}function O(t){try{return decodeURIComponent(""+t)}catch(e){}return""+t}const $=/\/$/,R=t=>t.replace($,"");function D(t,e,n="/"){let s,i={},r="",o="";const a=e.indexOf("#");let u=e.indexOf("?");return a<u&&a>=0&&(u=-1),u>-1&&(s=e.slice(0,u),r=e.slice(u+1,a>-1?a:e.length),i=t(r)),a>-1&&(s=s||e.slice(0,a),o=e.slice(a,e.length)),s=q(null!=s?s:e,n),{fullPath:s+(r&&"?")+r+o,path:s,query:i,hash:O(o)}}function M(t,e){const n=e.query?t(e.query):"";return e.path+(n&&"?")+n+(e.hash||"")}function P(t,e,n){const s=e.matched.length-1,i=n.matched.length-1;return s>-1&&s===i&&F(e.matched[s],n.matched[i])&&L(e.params,n.params)&&t(e.query)===t(n.query)&&e.hash===n.hash}function F(t,e){return(t.aliasOf||t)===(e.aliasOf||e)}function L(t,e){if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!z(t[n],e[n]))return!1;return!0}function z(t,e){return l(t)?B(t,e):l(e)?B(e,t):t===e}function B(t,e){return l(e)?t.length===e.length&&t.every(((t,n)=>t===e[n])):1===t.length&&t[0]===e}function q(t,e){if(t.startsWith("/"))return t;if(!t)return e;const n=e.split("/"),s=t.split("/"),i=s[s.length-1];".."!==i&&"."!==i||s.push("");let r,o,a=n.length-1;for(r=0;r<s.length;r++)if(o=s[r],"."!==o){if(".."!==o)break;a>1&&a--}return n.slice(0,a).join("/")+"/"+s.slice(r).join("/")}var V,W;(function(t){t["pop"]="pop",t["push"]="push"})(V||(V={})),function(t){t["back"]="back",t["forward"]="forward",t["unknown"]=""}(W||(W={}));const j="";function U(t){if(!t)if(r){const e=document.querySelector("base");t=e&&e.getAttribute("href")||"/",t=t.replace(/^\w+:\/\/[^\/]+/,"")}else t="/";return"/"!==t[0]&&"#"!==t[0]&&(t="/"+t),R(t)}const G=/^[^#]+#/;function H(t,e){return t.replace(G,"#")+e}function K(t,e){const n=document.documentElement.getBoundingClientRect(),s=t.getBoundingClientRect();return{behavior:e.behavior,left:s.left-n.left-(e.left||0),top:s.top-n.top-(e.top||0)}}const X=()=>({left:window.scrollX,top:window.scrollY});function Q(t){let e;if("el"in t){const n=t.el,s="string"===typeof n&&n.startsWith("#");0;const i="string"===typeof n?s?document.getElementById(n.slice(1)):document.querySelector(n):n;if(!i)return;e=K(i,t)}else e=t;"scrollBehavior"in document.documentElement.style?window.scrollTo(e):window.scrollTo(null!=e.left?e.left:window.scrollX,null!=e.top?e.top:window.scrollY)}function Y(t,e){const n=history.state?history.state.position-e:-1;return n+t}const Z=new Map;function J(t,e){Z.set(t,e)}function tt(t){const e=Z.get(t);return Z.delete(t),e}function et(t=""){let e=[],n=[j],s=0;function i(t){s++,s!==n.length&&n.splice(s),n.push(t)}function r(t,n,{direction:s,delta:i}){const r={direction:s,delta:i,type:V.pop};for(const o of e)o(t,n,r)}t=U(t);const o={location:j,state:{},base:t,createHref:H.bind(null,t),replace(t){n.splice(s--,1),i(t)},push(t,e){i(t)},listen(t){return e.push(t),()=>{const n=e.indexOf(t);n>-1&&e.splice(n,1)}},destroy(){e=[],n=[j],s=0},go(t,e=!0){const i=this.location,o=t<0?W.back:W.forward;s=Math.max(0,Math.min(s+t,n.length-1)),e&&r(this.location,i,{direction:o,delta:t})}};return Object.defineProperty(o,"location",{enumerable:!0,get:()=>n[s]}),o}function nt(t){return"string"===typeof t||t&&"object"===typeof t}function st(t){return"string"===typeof t||"symbol"===typeof t}const it={path:"/",name:void 0,params:{},query:{},hash:"",fullPath:"/",matched:[],meta:{},redirectedFrom:void 0},rt=Symbol("");var ot;(function(t){t[t["aborted"]=4]="aborted",t[t["cancelled"]=8]="cancelled",t[t["duplicated"]=16]="duplicated"})(ot||(ot={}));function at(t,e){return a(new Error,{type:t,[rt]:!0},e)}function ut(t,e){return t instanceof Error&&rt in t&&(null==e||!!(t.type&e))}const ct="[^/]+?",lt={sensitive:!1,strict:!1,start:!0,end:!0},ht=/[.+*?^${}()[\]/\\]/g;function pt(t,e){const n=a({},lt,e),s=[];let i=n.start?"^":"";const r=[];for(const a of t){const t=a.length?[]:[90];n.strict&&!a.length&&(i+="/");for(let e=0;e<a.length;e++){const s=a[e];let o=40+(n.sensitive?.25:0);if(0===s.type)e||(i+="/"),i+=s.value.replace(ht,"\\$&"),o+=40;else if(1===s.type){const{value:t,repeatable:n,optional:u,regexp:c}=s;r.push({name:t,repeatable:n,optional:u});const l=c||ct;if(l!==ct){o+=10;try{new RegExp(`(${l})`)}catch(h){throw new Error(`Invalid custom RegExp for param "${t}" (${l}): `+h.message)}}let p=n?`((?:${l})(?:/(?:${l}))*)`:`(${l})`;e||(p=u&&a.length<2?`(?:/${p})`:"/"+p),u&&(p+="?"),i+=p,o+=20,u&&(o+=-8),n&&(o+=-20),".*"===l&&(o+=-50)}t.push(o)}s.push(t)}if(n.strict&&n.end){const t=s.length-1;s[t][s[t].length-1]+=.7000000000000001}n.strict||(i+="/?"),n.end?i+="$":n.strict&&(i+="(?:/|$)");const o=new RegExp(i,n.sensitive?"":"i");function u(t){const e=t.match(o),n={};if(!e)return null;for(let s=1;s<e.length;s++){const t=e[s]||"",i=r[s-1];n[i.name]=t&&i.repeatable?t.split("/"):t}return n}function c(e){let n="",s=!1;for(const i of t){s&&n.endsWith("/")||(n+="/"),s=!1;for(const t of i)if(0===t.type)n+=t.value;else if(1===t.type){const{value:r,repeatable:o,optional:a}=t,u=r in e?e[r]:"";if(l(u)&&!o)throw new Error(`Provided param "${r}" is an array but it is not repeatable (* or + modifiers)`);const c=l(u)?u.join("/"):u;if(!c){if(!a)throw new Error(`Missing required param "${r}"`);i.length<2&&(n.endsWith("/")?n=n.slice(0,-1):s=!0)}n+=c}}return n||"/"}return{re:o,score:s,keys:r,parse:u,stringify:c}}function dt(t,e){let n=0;while(n<t.length&&n<e.length){const s=e[n]-t[n];if(s)return s;n++}return t.length<e.length?1===t.length&&80===t[0]?-1:1:t.length>e.length?1===e.length&&80===e[0]?1:-1:0}function ft(t,e){let n=0;const s=t.score,i=e.score;while(n<s.length&&n<i.length){const t=dt(s[n],i[n]);if(t)return t;n++}if(1===Math.abs(i.length-s.length)){if(mt(s))return 1;if(mt(i))return-1}return i.length-s.length}function mt(t){const e=t[t.length-1];return t.length>0&&e[e.length-1]<0}const gt={type:0,value:""},yt=/[a-zA-Z0-9_]/;function bt(t){if(!t)return[[]];if("/"===t)return[[gt]];if(!t.startsWith("/"))throw new Error(`Invalid path "${t}"`);function e(t){throw new Error(`ERR (${n})/"${c}": ${t}`)}let n=0,s=n;const i=[];let r;function o(){r&&i.push(r),r=[]}let a,u=0,c="",l="";function h(){c&&(0===n?r.push({type:0,value:c}):1===n||2===n||3===n?(r.length>1&&("*"===a||"+"===a)&&e(`A repeatable param (${c}) must be alone in its segment. eg: '/:ids+.`),r.push({type:1,value:c,regexp:l,repeatable:"*"===a||"+"===a,optional:"*"===a||"?"===a})):e("Invalid state to consume buffer"),c="")}function p(){c+=a}while(u<t.length)if(a=t[u++],"\\"!==a||2===n)switch(n){case 0:"/"===a?(c&&h(),o()):":"===a?(h(),n=1):p();break;case 4:p(),n=s;break;case 1:"("===a?n=2:yt.test(a)?p():(h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&u--);break;case 2:")"===a?"\\"==l[l.length-1]?l=l.slice(0,-1)+a:n=3:l+=a;break;case 3:h(),n=0,"*"!==a&&"?"!==a&&"+"!==a&&u--,l="";break;default:e("Unknown state");break}else s=n,n=4;return 2===n&&e(`Unfinished custom RegExp for param "${c}"`),h(),o(),i}function vt(t,e,n){const s=pt(bt(t.path),n);const i=a(s,{record:t,parent:e,children:[],alias:[]});return e&&!i.record.aliasOf===!e.record.aliasOf&&e.children.push(i),i}function wt(t,e){const n=[],s=new Map;function i(t){return s.get(t)}function r(t,n,s){const i=!s,u=_t(t);u.aliasOf=s&&s.record;const h=It(e,t),p=[u];if("alias"in t){const e="string"===typeof t.alias?[t.alias]:t.alias;for(const t of e)p.push(a({},u,{components:s?s.record.components:u.components,path:t,aliasOf:s?s.record:u}))}let d,f;for(const e of p){const{path:a}=e;if(n&&"/"!==a[0]){const t=n.record.path,s="/"===t[t.length-1]?"":"/";e.path=n.record.path+(a&&s+a)}if(d=vt(e,n,h),s?s.alias.push(d):(f=f||d,f!==d&&f.alias.push(d),i&&t.name&&!St(d)&&o(t.name)),u.children){const t=u.children;for(let e=0;e<t.length;e++)r(t[e],d,s&&s.children[e])}s=s||d,(d.record.components&&Object.keys(d.record.components).length||d.record.name||d.record.redirect)&&l(d)}return f?()=>{o(f)}:c}function o(t){if(st(t)){const e=s.get(t);e&&(s.delete(t),n.splice(n.indexOf(e),1),e.children.forEach(o),e.alias.forEach(o))}else{const e=n.indexOf(t);e>-1&&(n.splice(e,1),t.record.name&&s.delete(t.record.name),t.children.forEach(o),t.alias.forEach(o))}}function u(){return n}function l(t){let e=0;while(e<n.length&&ft(t,n[e])>=0&&(t.record.path!==n[e].record.path||!Ct(t,n[e])))e++;n.splice(e,0,t),t.record.name&&!St(t)&&s.set(t.record.name,t)}function h(t,e){let i,r,o,u={};if("name"in t&&t.name){if(i=s.get(t.name),!i)throw at(1,{location:t});0,o=i.record.name,u=a(xt(e.params,i.keys.filter((t=>!t.optional)).concat(i.parent?i.parent.keys.filter((t=>t.optional)):[]).map((t=>t.name))),t.params&&xt(t.params,i.keys.map((t=>t.name)))),r=i.stringify(u)}else if(null!=t.path)r=t.path,i=n.find((t=>t.re.test(r))),i&&(u=i.parse(r),o=i.record.name);else{if(i=e.name?s.get(e.name):n.find((t=>t.re.test(e.path))),!i)throw at(1,{location:t,currentLocation:e});o=i.record.name,u=a({},e.params,t.params),r=i.stringify(u)}const c=[];let l=i;while(l)c.unshift(l.record),l=l.parent;return{name:o,path:r,params:u,matched:c,meta:Tt(c)}}return e=It({strict:!1,end:!0,sensitive:!1},e),t.forEach((t=>r(t))),{addRoute:r,resolve:h,removeRoute:o,getRoutes:u,getRecordMatcher:i}}function xt(t,e){const n={};for(const s of e)s in t&&(n[s]=t[s]);return n}function _t(t){return{path:t.path,redirect:t.redirect,name:t.name,meta:t.meta||{},aliasOf:void 0,beforeEnter:t.beforeEnter,props:kt(t),children:t.children||[],instances:{},leaveGuards:new Set,updateGuards:new Set,enterCallbacks:{},components:"components"in t?t.components||null:t.component&&{default:t.component}}}function kt(t){const e={},n=t.props||!1;if("component"in t)e.default=n;else for(const s in t.components)e[s]="object"===typeof n?n[s]:n;return e}function St(t){while(t){if(t.record.aliasOf)return!0;t=t.parent}return!1}function Tt(t){return t.reduce(((t,e)=>a(t,e.meta)),{})}function It(t,e){const n={};for(const s in t)n[s]=s in e?e[s]:t[s];return n}function Ct(t,e){return e.children.some((e=>e===t||Ct(t,e)))}function At(t){const e={};if(""===t||"?"===t)return e;const n="?"===t[0],s=(n?t.slice(1):t).split("&");for(let i=0;i<s.length;++i){const t=s[i].replace(g," "),n=t.indexOf("="),r=O(n<0?t:t.slice(0,n)),o=n<0?null:O(t.slice(n+1));if(r in e){let t=e[r];l(t)||(t=e[r]=[t]),t.push(o)}else e[r]=o}return e}function Nt(t){let e="";for(let n in t){const s=t[n];if(n=A(n),null==s){void 0!==s&&(e+=(e.length?"&":"")+n);continue}const i=l(s)?s.map((t=>t&&C(t))):[s&&C(s)];i.forEach((t=>{void 0!==t&&(e+=(e.length?"&":"")+n,null!=t&&(e+="="+t))}))}return e}function Et(t){const e={};for(const n in t){const s=t[n];void 0!==s&&(e[n]=l(s)?s.map((t=>null==t?null:""+t)):null==s?s:""+s)}return e}const Ot=Symbol(""),$t=Symbol(""),Rt=Symbol(""),Dt=Symbol(""),Mt=Symbol("");function Pt(){let t=[];function e(e){return t.push(e),()=>{const n=t.indexOf(e);n>-1&&t.splice(n,1)}}function n(){t=[]}return{add:e,list:()=>t.slice(),reset:n}}function Ft(t,e,n,s,i,r=(t=>t())){const o=s&&(s.enterCallbacks[i]=s.enterCallbacks[i]||[]);return()=>new Promise(((a,u)=>{const c=t=>{!1===t?u(at(4,{from:n,to:e})):t instanceof Error?u(t):nt(t)?u(at(2,{from:e,to:t})):(o&&s.enterCallbacks[i]===o&&"function"===typeof t&&o.push(t),a())},l=r((()=>t.call(s&&s.instances[i],e,n,c)));let h=Promise.resolve(l);t.length<3&&(h=h.then(c)),h.catch((t=>u(t)))}))}function Lt(t,e,n,s,i=(t=>t())){const r=[];for(const a of t){0;for(const t in a.components){let u=a.components[t];if("beforeRouteEnter"===e||a.instances[t])if(zt(u)){const o=u.__vccOpts||u,c=o[e];c&&r.push(Ft(c,n,s,a,t,i))}else{let c=u();0,r.push((()=>c.then((r=>{if(!r)return Promise.reject(new Error(`Couldn't resolve component "${t}" at "${a.path}"`));const u=o(r)?r.default:r;a.components[t]=u;const c=u.__vccOpts||u,l=c[e];return l&&Ft(l,n,s,a,t,i)()}))))}}}return r}function zt(t){return"object"===typeof t||"displayName"in t||"props"in t||"__vccOpts"in t}function Bt(t){const e=(0,s.WQ)(Rt),n=(0,s.WQ)(Dt),r=(0,s.EW)((()=>e.resolve((0,i.R1)(t.to)))),o=(0,s.EW)((()=>{const{matched:t}=r.value,{length:e}=t,s=t[e-1],i=n.matched;if(!s||!i.length)return-1;const o=i.findIndex(F.bind(null,s));if(o>-1)return o;const a=Ut(t[e-2]);return e>1&&Ut(s)===a&&i[i.length-1].path!==a?i.findIndex(F.bind(null,t[e-2])):o})),a=(0,s.EW)((()=>o.value>-1&&jt(n.params,r.value.params))),u=(0,s.EW)((()=>o.value>-1&&o.value===n.matched.length-1&&L(n.params,r.value.params)));function l(n={}){return Wt(n)?e[(0,i.R1)(t.replace)?"replace":"push"]((0,i.R1)(t.to)).catch(c):Promise.resolve()}return{route:r,href:(0,s.EW)((()=>r.value.href)),isActive:a,isExactActive:u,navigate:l}}const qt=(0,s.pM)({name:"RouterLink",compatConfig:{MODE:3},props:{to:{type:[String,Object],required:!0},replace:Boolean,activeClass:String,exactActiveClass:String,custom:Boolean,ariaCurrentValue:{type:String,default:"page"}},useLink:Bt,setup(t,{slots:e}){const n=(0,i.Kh)(Bt(t)),{options:r}=(0,s.WQ)(Rt),o=(0,s.EW)((()=>({[Gt(t.activeClass,r.linkActiveClass,"router-link-active")]:n.isActive,[Gt(t.exactActiveClass,r.linkExactActiveClass,"router-link-exact-active")]:n.isExactActive})));return()=>{const i=e.default&&e.default(n);return t.custom?i:(0,s.h)("a",{"aria-current":n.isExactActive?t.ariaCurrentValue:null,href:n.href,onClick:n.navigate,class:o.value},i)}}}),Vt=qt;function Wt(t){if(!(t.metaKey||t.altKey||t.ctrlKey||t.shiftKey)&&!t.defaultPrevented&&(void 0===t.button||0===t.button)){if(t.currentTarget&&t.currentTarget.getAttribute){const e=t.currentTarget.getAttribute("target");if(/\b_blank\b/i.test(e))return}return t.preventDefault&&t.preventDefault(),!0}}function jt(t,e){for(const n in e){const s=e[n],i=t[n];if("string"===typeof s){if(s!==i)return!1}else if(!l(i)||i.length!==s.length||s.some(((t,e)=>t!==i[e])))return!1}return!0}function Ut(t){return t?t.aliasOf?t.aliasOf.path:t.path:""}const Gt=(t,e,n)=>null!=t?t:null!=e?e:n,Ht=(0,s.pM)({name:"RouterView",inheritAttrs:!1,props:{name:{type:String,default:"default"},route:Object},compatConfig:{MODE:3},setup(t,{attrs:e,slots:n}){const r=(0,s.WQ)(Mt),o=(0,s.EW)((()=>t.route||r.value)),u=(0,s.WQ)($t,0),c=(0,s.EW)((()=>{let t=(0,i.R1)(u);const{matched:e}=o.value;let n;while((n=e[t])&&!n.components)t++;return t})),l=(0,s.EW)((()=>o.value.matched[c.value]));(0,s.Gt)($t,(0,s.EW)((()=>c.value+1))),(0,s.Gt)(Ot,l),(0,s.Gt)(Mt,o);const h=(0,i.KR)();return(0,s.wB)((()=>[h.value,l.value,t.name]),(([t,e,n],[s,i,r])=>{e&&(e.instances[n]=t,i&&i!==e&&t&&t===s&&(e.leaveGuards.size||(e.leaveGuards=i.leaveGuards),e.updateGuards.size||(e.updateGuards=i.updateGuards))),!t||!e||i&&F(e,i)&&s||(e.enterCallbacks[n]||[]).forEach((e=>e(t)))}),{flush:"post"}),()=>{const i=o.value,r=t.name,u=l.value,c=u&&u.components[r];if(!c)return Kt(n.default,{Component:c,route:i});const p=u.props[r],d=p?!0===p?i.params:"function"===typeof p?p(i):p:null,f=t=>{t.component.isUnmounted&&(u.instances[r]=null)},m=(0,s.h)(c,a({},d,e,{onVnodeUnmounted:f,ref:h}));return Kt(n.default,{Component:m,route:i})||m}}});function Kt(t,e){if(!t)return null;const n=t(e);return 1===n.length?n[0]:n}const Xt=Ht;function Qt(t){const e=wt(t.routes,t),n=t.parseQuery||At,o=t.stringifyQuery||Nt,h=t.history;const p=Pt(),d=Pt(),f=Pt(),m=(0,i.IJ)(it);let g=it;r&&t.scrollBehavior&&"scrollRestoration"in history&&(history.scrollRestoration="manual");const y=u.bind(null,(t=>""+t)),b=u.bind(null,E),v=u.bind(null,O);function w(t,n){let s,i;return st(t)?(s=e.getRecordMatcher(t),i=n):i=t,e.addRoute(i,s)}function x(t){const n=e.getRecordMatcher(t);n&&e.removeRoute(n)}function _(){return e.getRoutes().map((t=>t.record))}function k(t){return!!e.getRecordMatcher(t)}function S(t,s){if(s=a({},s||m.value),"string"===typeof t){const i=D(n,t,s.path),r=e.resolve({path:i.path},s),o=h.createHref(i.fullPath);return a(i,r,{params:v(r.params),hash:O(i.hash),redirectedFrom:void 0,href:o})}let i;if(null!=t.path)i=a({},t,{path:D(n,t.path,s.path).path});else{const e=a({},t.params);for(const t in e)null==e[t]&&delete e[t];i=a({},t,{params:b(e)}),s.params=b(s.params)}const r=e.resolve(i,s),u=t.hash||"";r.params=y(v(r.params));const c=M(o,a({},t,{hash:I(u),path:r.path})),l=h.createHref(c);return a({fullPath:c,hash:u,query:o===Nt?Et(t.query):t.query||{}},r,{redirectedFrom:void 0,href:l})}function T(t){return"string"===typeof t?D(n,t,m.value.path):a({},t)}function C(t,e){if(g!==t)return at(8,{from:e,to:t})}function A(t){return R(t)}function N(t){return A(a(T(t),{replace:!0}))}function $(t){const e=t.matched[t.matched.length-1];if(e&&e.redirect){const{redirect:n}=e;let s="function"===typeof n?n(t):n;return"string"===typeof s&&(s=s.includes("?")||s.includes("#")?s=T(s):{path:s},s.params={}),a({query:t.query,hash:t.hash,params:null!=s.path?{}:t.params},s)}}function R(t,e){const n=g=S(t),s=m.value,i=t.state,r=t.force,u=!0===t.replace,c=$(n);if(c)return R(a(T(c),{state:"object"===typeof c?a({},i,c.state):i,force:r,replace:u}),e||n);const l=n;let h;return l.redirectedFrom=e,!r&&P(o,s,n)&&(h=at(16,{to:l,from:s}),nt(s,s,!0,!1)),(h?Promise.resolve(h):z(l,s)).catch((t=>ut(t)?ut(t,2)?t:et(t):K(t,l,s))).then((t=>{if(t){if(ut(t,2))return R(a({replace:u},T(t.to),{state:"object"===typeof t.to?a({},i,t.to.state):i,force:r}),e||l)}else t=q(l,s,!0,u,i);return B(l,s,t),t}))}function F(t,e){const n=C(t,e);return n?Promise.reject(n):Promise.resolve()}function L(t){const e=ct.values().next().value;return e&&"function"===typeof e.runWithContext?e.runWithContext(t):t()}function z(t,e){let n;const[s,i,r]=Yt(t,e);n=Lt(s.reverse(),"beforeRouteLeave",t,e);for(const a of s)a.leaveGuards.forEach((s=>{n.push(Ft(s,t,e))}));const o=F.bind(null,t,e);return n.push(o),ht(n).then((()=>{n=[];for(const s of p.list())n.push(Ft(s,t,e));return n.push(o),ht(n)})).then((()=>{n=Lt(i,"beforeRouteUpdate",t,e);for(const s of i)s.updateGuards.forEach((s=>{n.push(Ft(s,t,e))}));return n.push(o),ht(n)})).then((()=>{n=[];for(const s of r)if(s.beforeEnter)if(l(s.beforeEnter))for(const i of s.beforeEnter)n.push(Ft(i,t,e));else n.push(Ft(s.beforeEnter,t,e));return n.push(o),ht(n)})).then((()=>(t.matched.forEach((t=>t.enterCallbacks={})),n=Lt(r,"beforeRouteEnter",t,e,L),n.push(o),ht(n)))).then((()=>{n=[];for(const s of d.list())n.push(Ft(s,t,e));return n.push(o),ht(n)})).catch((t=>ut(t,8)?t:Promise.reject(t)))}function B(t,e,n){f.list().forEach((s=>L((()=>s(t,e,n)))))}function q(t,e,n,s,i){const o=C(t,e);if(o)return o;const u=e===it,c=r?history.state:{};n&&(s||u?h.replace(t.fullPath,a({scroll:u&&c&&c.scroll},i)):h.push(t.fullPath,i)),m.value=t,nt(t,e,n,u),et()}let W;function j(){W||(W=h.listen(((t,e,n)=>{if(!lt.listening)return;const s=S(t),i=$(s);if(i)return void R(a(i,{replace:!0}),s).catch(c);g=s;const o=m.value;r&&J(Y(o.fullPath,n.delta),X()),z(s,o).catch((t=>ut(t,12)?t:ut(t,2)?(R(t.to,s).then((t=>{ut(t,20)&&!n.delta&&n.type===V.pop&&h.go(-1,!1)})).catch(c),Promise.reject()):(n.delta&&h.go(-n.delta,!1),K(t,s,o)))).then((t=>{t=t||q(s,o,!1),t&&(n.delta&&!ut(t,8)?h.go(-n.delta,!1):n.type===V.pop&&ut(t,20)&&h.go(-1,!1)),B(s,o,t)})).catch(c)})))}let U,G=Pt(),H=Pt();function K(t,e,n){et(t);const s=H.list();return s.length?s.forEach((s=>s(t,e,n))):console.error(t),Promise.reject(t)}function Z(){return U&&m.value!==it?Promise.resolve():new Promise(((t,e)=>{G.add([t,e])}))}function et(t){return U||(U=!t,j(),G.list().forEach((([e,n])=>t?n(t):e())),G.reset()),t}function nt(e,n,i,o){const{scrollBehavior:a}=t;if(!r||!a)return Promise.resolve();const u=!i&&tt(Y(e.fullPath,0))||(o||!i)&&history.state&&history.state.scroll||null;return(0,s.dY)().then((()=>a(e,n,u))).then((t=>t&&Q(t))).catch((t=>K(t,e,n)))}const rt=t=>h.go(t);let ot;const ct=new Set,lt={currentRoute:m,listening:!0,addRoute:w,removeRoute:x,hasRoute:k,getRoutes:_,resolve:S,options:t,push:A,replace:N,go:rt,back:()=>rt(-1),forward:()=>rt(1),beforeEach:p.add,beforeResolve:d.add,afterEach:f.add,onError:H.add,isReady:Z,install(t){const e=this;t.component("RouterLink",Vt),t.component("RouterView",Xt),t.config.globalProperties.$router=e,Object.defineProperty(t.config.globalProperties,"$route",{enumerable:!0,get:()=>(0,i.R1)(m)}),r&&!ot&&m.value===it&&(ot=!0,A(h.location).catch((t=>{0})));const n={};for(const i in it)Object.defineProperty(n,i,{get:()=>m.value[i],enumerable:!0});t.provide(Rt,e),t.provide(Dt,(0,i.Gc)(n)),t.provide(Mt,m);const s=t.unmount;ct.add(t),t.unmount=function(){ct.delete(t),ct.size<1&&(g=it,W&&W(),W=null,m.value=it,ot=!1,U=!1),s()}}};function ht(t){return t.reduce(((t,e)=>t.then((()=>L(e)))),Promise.resolve())}return lt}function Yt(t,e){const n=[],s=[],i=[],r=Math.max(e.matched.length,t.matched.length);for(let o=0;o<r;o++){const r=e.matched[o];r&&(t.matched.find((t=>F(t,r)))?s.push(r):n.push(r));const a=t.matched[o];a&&(e.matched.find((t=>F(t,a)))||i.push(a))}return[n,s,i]}}}]);
//# sourceMappingURL=chunk-vendors.5012bc59.js.map